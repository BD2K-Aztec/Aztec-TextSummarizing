Motivation: The tried and true approach of flow cytometry data analysis is to manually gate on each biomarker separately, which is feasible for a small number of biomarkers, e.g. less than five. However, this rapidly becomes confusing as the number of biomarker increases. Furthermore, multivariate structure is not taken into account. Recently, automated gating algorithms have been implemented, all of which rely on unsupervised learning methodology. However, all unsupervised learning outputs suffer the same difficulties in validation in the absence of external knowledge, regardless of application domain. Results: We present a new semi-automated algorithm for population discovery that is based on comparison to fluorescence-minus-one controls, thus transferring the problem into that of one-class classification , as opposed to being an unsupervised learning problem. The novel one-class classification algorithm is based on common principal components and can accommodate complex mixtures of multivariate densities. Computational time is short, and the simple nature of the calculations means the algorithm can easily be adapted to process large numbers of cells (10 6). Furthermore, we are able to find rare cell populations as well as populations with low biomarker concentration, both of which are inherently hard to do in an unsupervised learning context without prior knowledge of the samples composition. Availability and implementation: R scripts are available via
INTRODUCTIONThe mainstream method of flow cytometry data analysis is to 'manual hierarchical gate'. In other words, given N observations (cells) of a p-dimensional random vector, where each i 2 f1;. .. ; pg represents a biomarker coupled to a fluorescent marker, and f i is the marginal density of each biomarker, the cells are sequentially split into !2 groups corresponding to presence, absence, and possibly discretized biomarker concentration levels following visual inspection of each f i. Biomarkers are most typically antibodies; however, they can also be fluorescent proteins, among others. Gating order is based on prior biological knowledge: e.g. only a particular cell type can be positive for certain biomarkers and not others; therefore, the general strategy is to gate on highly specific biomarkers early to separate broad categories of cells. Following this, separate gating strategies may be applied to find the nuances within the broad categories. This has been a successful approach over the past three decades, where it has typically been applied to experiments comprising less than five biomarkers. With increasing numbers of biomarkers and/or novel biomarkers, manual gating becomes difficult, as well as neglecting the multivariate structure (). Compounding these difficulties is the impact of data pre-processing on gating, namely 'compensation'. Each biomarker is coupled to a fluorescent marker that is excited by the appropriate laser, and in turn, it emits light over a typical range of 400 800 nm. Each biomarker is measured with an optical bandpass filter (BP) tuned to its peak, e.g. the intensity of light between 600 and 630 nm is measured. However, the spectra of different fluorescent markers overlap; thus, measurement of total light captured in a BP has contributions from up to p dyes. This is known as 'spectral mixing', and its theoretical form is simply a linear transform from 'biomarker space' to 'spectral space'. Compensation is simply the reverse linear transformation back to the biomarker space, where the features have a direct biological meaning as they correspond directly to the biomarkers. However, compensation is based on the assumption of Gaussian distributed error, and thus distorts the data owing to the underlying Poisson distribution of the emitted photons (). Additionally, it cannot account for autofluorescence (AF) (), which occurs when a cell falsely appears to have a biomarker concentration above background, which is simply because of the cell's properties. Prior knowledge is required to account for AF, and if not accounted for, can lead to false conclusions in manual gating. Additionally, in the case of antibodies, the measurement can be confounded by unspecific binding (UB), for which there is no correction. In fact, these are such pervasive problems that a specific type of biological control has been designed for their detection: the fluorescence-minus-one (FMO) control (). For each biomarker i 2 f1;. .. ; pg, a new sample is measured with all biomarkers minus the i th biomarker. The cells that are positive for the i th biomarker shift with magnitude proportional to the original biomarker concentration, and no shift occurs *To whom correspondence should be addressed. when the cells are negative. The effects of AF and UB are minimized, as they should be unchanged between the fully stained sample (full staining) and the FMO. Superposing the full staining with each FMO is the multivariate spectral analogue of univariate gating on the biomarker marginal densities, while simultaneously taking AF and UB into account. The use of FMOs is the gold standard in experimental design, however, their use has been restricted to visual inspection thus far, to confirm that the results of manual hierarchical gating is unlikely to contain artifacts. Here we use FMOs as training sets in a one-class classifier to systematically identify cell populations in a semi-automated fashion. By definition of the spectral mixing equations, the FMOs are training sets of negative examples for each BM. The full staining (test set) is compared with the FMOs to determine positive cells for each BM, as given by those that lie outside the FMOs (). The output of all the one-class classifiers is combined to yield the final populations. Furthermore, we can use the physical constraints to improve sensitivity of positive cell detection, namely, that (i) cells are not independent events but rather they are correlated; (ii) the composition of cells is preserved between the full staining and FMO; and (iii) the cells that are negative for a given BM have the same covariance in both the full staining and FMO. Additionally, we apply the algorithm iteratively to remove populations that mask others. This gives the following statistical and technical advantages. Populations are found in direct relation to a biological control, thus avoiding unsupervised learning. As larger populations are successively removed, it becomes easier to find smaller populations even without prior knowledge. Furthermore, no prior knowledge is required as to the form of AF and UB. Given that population identification occurs directly in spectral space, spectral overlap no longer needs to be minimized to such a great extent, giving more flexibility in fluorescent marker selection, and experiments that are currently difficult are possible on standard instruments, without requiring the purchase of specialized equipment. All flow cytometry applications suffer from contamination arising from various sources: 'junk' (e.g. debris, dead cells that were not gated out, doublets, bubbles in the sheath fluid and unbound fluorescent molecules), altered fluorescence (e.g. unspecific staining, bleaching and FRET) or instrumentation (e.g. electronic noise, laser fluctuations, optical properties and variation in flow speed), among others. It can be hard to distinguish rare populations from contamination, and in traditional manual hierarchical gating, an operator would probably ignore small percentages, with the exact threshold depending on the total number of cells collected, the experience of the operator and the biological question at hand. In fact, if rare cells are indeed the focus of the biological question, then different experimental approaches would almost certainly have been taken in the first place, such as magnet pre-enrichment of the rare cell population (). For these reasons, the full algorithm is quite deliberately only semi-automated in nature, and this is based on the fact that successive iterations find increasingly smaller groups of positive cells. The issues listed above are too numerous and complex to be solved by an algorithm. The approach we therefore take is to let the operator decide the minimum population size, and return a list of putative populations for further human interpretation. The article is organized as follows. The algorithm is described in Section 2. In Section 3, the algorithm is tested on simulated data to demonstrate its increased sensitivity over alternatives. Selected clustering methods are also applied to the simulated data, to demonstrate that it is difficult to find the correct clustering in the absence of prior or external knowledge. The clustering methods discussed were evaluated in FlowCAP () and are available via Bioconductor. Finally, the algorithm is applied to a four-marker staining, and the output is confirmed with manual hierarchical gating. Selected clustering methods are also applied but they fail to find the small populations.
DISCUSSIONWe have demonstrated how FMOs can be compared with full stainings with a one-class classification approach to systematically discover the sample's composition of cell populations. The proposed algorithm requires no tuning of parameters, and each full staining-FMO comparison (CPC proj poly) is linear in the number of cells, and easily parallelizable. The cell populations found were heterogenous in terms of cell number, ranging from 0.05 to 30% of the total. When attempting to discover cell populations via unsupervised methods, the four largest populations masked the smaller ones, and it was not possible to find them using the investigated methods without further modification. It could be argued that this problem is easily avoided by firstdown-sampling (as is done in SPADE) to approximate a uniform density; however, the degree of down-sampling requires parameter tuning to ensure the smallest populations are not missed, and it is unclear how to do so without prior knowledge of the sample's composition. These difficulties are the manifestation of the general problem of unsupervised learning output validation, which is not possible in the absence of external information. When widely used biomarkers are applied, this problem is not so severe, as output can be compared against accumulated knowledge, but as novel biomarkers are increasingly used, the appropriate post hoc controls must be made, e.g. cell sorting and further tests. Alternatively, FMOs can be made at the outset. Additionally, it was noted in this data that many populations that we found (CD4-CD14, all single positive populations) are in fact on a continuum with long tails stretching down towards the unstained population. In other words, there is no distinct cut between stained and unstained, and if this is in fact a common feature of flow cytometry data, it would suggest that it is inherently ill-suited to being clustered. Unspecific contamination is an issue common to all flow cytometry applications, and we do not attempt to solve this here. As such, the algorithm is presented as being semi-automated. The major problem is to decide whether a 'rare' population is a true population or an artefact caused by contamination. As discussed in Section 1, this cannot be decided from the data alone, but rather further experiments would be necessarily. More commonly, if rare populations are specifically of interest, then alternative experimental designs would be undertaken from the beginning. These issues are widely known and lack a 'cutand-dried' solution (). Thus, our strategy has been to leave the minimum population size decision to the operator, and return a list of putative populations. A future improvement would be to additionally return a measure of scatter for each population, to improve the interpretation process. This algorithm not only represents a statistical advance in the analysis of flow cytometry experiments, but it also confers significant technical advantages. A current limitation of flow cytometry is the choice of fluorescent markers: for optimal compensation, they must be chosen so as to have minimal spectral overlap. Because all calculations are done in spectral space, it is no longer crucial that spectral overlap is minimized to such large extent. This increases the range of experiments that are technically possible on standard instrumentation already in daily use.
CONCLUSIONThe introduction of FMOs was a major step forward in the quality control of flow cytometry experiments, and they remain a gold standard but their use has largely been confined to visual inspection. We have presented a novel one-class classifying algorithm that harnesses the properties of FMOs to systematically identify cell populations. By doing so, the validation problem of unsupervised learning is circumvented. As all calculations are done in the spectral space, new technical possibilities are opened, such as a great deal more flexibility in the choice of fluorescent markers, as compensation is not required. Finally, this method is immediately available to any flow cytometry user, as it can be done on completely standard instrumentation without requiring the purchase of specialized equipment. Conflict of interest: none declared.