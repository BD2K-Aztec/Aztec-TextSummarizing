Motivation: Models of molecular evolution aim at describing the evolutionary processes at the molecular level. However, current models rarely incorporate information from protein structure. Conversely, structure-based models of protein evolution have not been commonly applied to simulate sequence evolution in a phylogenetic framework, and they often ignore relevant evolutionary processes such as recom-bination. A simulation evolutionary framework that integrates substitution models that account for protein structure stability should be able to generate more realistic in silico evolved proteins for a variety of purposes. Results: We developed a method to simulate protein evolution that combines models of protein folding stability, such that the fitness depends on the stability of the native state both with respect to unfolding and misfolding, with phylogenetic histories that can be either specified by the user or simulated with the coalescent under complex evolutionary scenarios, including recombination, demographics and migration. We have implemented this framework in a computer program called ProteinEvolver. Remarkably, comparing these models with empirical amino acid replacement models, we found that the former produce amino acid distributions closer to distributions observed in real protein families, and proteins that are predicted to be more stable. Therefore, we conclude that evolutionary models that consider protein stability and realistic evolutionary histories constitute a better approximation of the real evolutionary process. Availability: ProteinEvolver is written in C, can run in parallel and is freely available from
INTRODUCTIONThe simulation of molecular evolution is commonly used to mimic real world processes, allowing the study of complex systems that are analytically intractable or to understand the mechanisms by which an evolutionary process is modified (). A key mechanism in the simulation of molecular sequences is the substitution or replacement process. Markov substitution/replacement models are commonly used in population genetics and molecular evolution to mimic evolutionary processes at the molecular level (seeLi and). Nevertheless, most substitution models assume that sites evolve independently, and they cannot incorporate information on the structural and functional role of amino acids within proteins, which is determined by the interactions of different sites. It is known that these interactions may lead to non-independent evolution, as the evolutionary rate at a site is influenced by substitutions at neighboring sites (e.g., and references therein). Moreover, the conformational diversity of proteins may also influence their molecular evolution (). Models of evolution that incorporate structure are therefore of increasing importance (). Recently, structurally constrained models of protein evolution have been introduced to represent folding stability of a target structure as a proxy for fitness (reviewed in). These models have been studied assuming a neutral fitness landscape (e.g.,b) and as a function of population size (e.g.). However, these models have been seldom used to obtain evolutionary insights from real data, probably because of the lack of widely available and easy-to-use software. Furthermore, proteins simulated under a given substitution process might be unrealistic if common evolutionary processes are ignored. For example, recombination constitutes a fundamental evolutionary force at the molecular level () that can affect the estimation of different evolutionary parameters, like molecular adaptation (by increasing the number of false positively selected sites) (), substitution rate (lack of molecular clock) () or ancestral states (). Similarly, population genetics processes such as demographic changes, population structure and migration may influence evolutionary histories. For example, branches are short when the population size undergoes a bottleneck (e.g.), and deme sizes in structured populations may influence the topology of genealogical trees, as lineages are assumed to be in the same deme to coalesce (e.g. Neuhauser and Tavare,Tavare, 2001). These aspects could influence the number of substitutions and evolutionary trajectories generated in the simulations, which consequently influence the simulated data (). In our view, it is important that a simulation framework allows reproducing and *To whom correspondence should be addressed. testing these evolutionary features to be able to address wider biological questions. In this study, we have implemented structurally constrained substitution models (hereafter, SCS models) that allow for sitedependent substitutions, under neutral and non-neutral fitness landscapes that depend on protein stability, in the freely available computer program ProteinEvolver, which is able to simulate the evolution of proteins and protein-coding genes along evolutionary histories such as phylogenetic trees or ancestral recombinant graphs (ARGs). These phylogenetic histories can be specified by the user or simulated through the coalescent with recombination, demographics and migration (see the reviews,). Recently, Grahnen and Liberles introduced the computer program CASS that simulates protein sequence evolution under selection to fold into a specific conformation (). Our program differs from CASS in two main aspects: the representation of the protein structure, which influences the way in which we treat misfolding stability, and the possibility to represent a broad variety of demographic and evolutionary scenarios (for instance, varying recombination rates and mutation). Grahnen and Liberles adopt explicit side chain representation, and we also adopt contact matrices, which are less precise but allow a statistical mechanical treatment of the ensemble of misfolded conformations that is computationally affordable (and actually very fast with our approximation) (e.g.). Misfolding stability is important because, if only the unfolded state is considered, selection tends to artificially favor very hydrophobic sequences. Therefore, the structural approach taken by the two programs is complementary, and each of them may be suited to address different kinds of biological questions. Through extensive simulations, we compared the SCS models with commonly used empirical amino acid substitution models using as a benchmark 10 well-known protein families. We found that sequences simulated under our SCS models produce amino acid distributions closer to the observed ones. Furthermore, the folding stability of the native state, assessed by building structural models by homology and predicting their stability with a method different from the one adopted in the simulations, is significantly larger for proteins simulated under the SCS model. We conclude that substitution models that incorporate protein structure information are better approximations to the real evolutionary process and may provide more meaningful evolutionary inferences than site-independent substitution models.
DISCUSSIONDuring protein evolution, interactions within the protein structure lead to correlated evolution, as the rate at which a siteLeibler distance to the real protein alignments of the simulated alignments by the neutral and fitness SCS models with respect to the empirical amino acid substitution model. The 'y' axis indicates decline of the distance of the neutral and fitness (best and worst conditions) SCS models with respect to the distance of the empirical model. Note that the neutral SCS model was overall more robust than the fitness SCS model under different thermodynamic conditions (see Supplementaryand B). On the other hand, the fitness SCS model under the best conditions (see Supplementary Figs S2A, B and S3, left) could improve the neutral model in half of protein families; however, the worst conditions may lead to results without any improvement respect to the empirical model. Dope energy computed in the simulated proteins under the empirical and the neutral SCS substitution models and in the native protein, for the protein family 'phototactive yellow proteins'. Note that the dope energy is unnormalized with respect to the protein size, and therefore scores from different proteins cannot be compared directly experiences change is influenced by replacements at neighboring sites. To adequately model these correlations, we developed the simulation framework ProteinEvolver that integrates structurebased models of protein evolution and evolutionary histories that can be simulated under diverse evolutionary scenarios such as recombination (including hotspots and coldspots), migration and demographics. Importantly, our SCS models consider both the stability against unfolding and the stability against misfolding, which is difficult to estimate, as it requires the use of a set of alternative conformations, and it is frequently neglected in simulations of protein evolution despite the importance of negative design. Moreover, our approximation of the free energy of the misfolded state () allows us to estimate the effect of each mutation on both unfolding and misfolding performing a number of computations that grow only linearly with the number of amino acids. As a consequence, these models can be applied along long phylogenetic histories. The recently developed CASS tool (Grahnen and Liberles, 2012) can simulate protein sequence evolution accounting for selection to fold into a specific conformation. CASS is based on an explicit side chain representation of the protein, which can make it more accurate than our contact matrix-based method (although it is known that contact matrices allow reconstruction of all atom coordinates with precision), and with treatment of the misfolded ensemble, which is important to avoid bias toward hydrophobic sequences that are often unrealistically favored by energy functions. However, additional considerations in the latter might avoid this effect. An important characteristic of CASS, not included in our program, is that it allows selecting for structures that bind a target molecule, therefore allowing investigation of an important aspect of protein function [which is, nevertheless, intimately related with structural stability (e.g.. Another important feature of our framework, which is not present in the CASS approach, is that it allows modeling evolutionary mechanisms other than point mutations, such as recombination, which has been shown to be a key element in protein engineering () and could affect structural constraints (). For example,have shown that recombination may influence structural divergence. In addition, we can simulate molecular evolution in population genetics scenarios, including demographics, population structure and migration, which allows us to address a wide range of biological problems by investigating how these evolutionary scenarios influence the properties of the evolved sequences by altering the underlying genealogies and the properties of the substitution process, which in non-neutral fitness landscapes strongly depend on population size. On the other hand, including or ignoring structural considerations can affect population genetic inferences (i.e. inferences on recombination, demographics or migration). We assessed the performance of the SCS models versus more traditional empirical replacement matrices. For all 10 protein families studied and tested combinations of temperature and configurational entropy parameters, the neutral SCS model always simulated sequences with amino acid frequencies closer to the observed ones than the best-fit empirical amino acid replacement model. On the other hand, the fitness SCS model may outperform the neutral model under optimal thermodynamic parameters, but it is very sensitive to the correct choice of parameters. Consequently, we recommend the use of the neutral SCS substitution model by default because it is more robust, whereas the fitness SCS model should be only used with the default thermodynamic parameters, in which case it may simulate more realistic proteins for some protein families. This difference stems from the fact that the non-neutral model optimizes protein stability when the population size is large, and it may bias the evolutionary process if the thermodynamic model is not reliable. On the other hand, we think that this dependence on parameters is reassuring, as it shows that the agreement between observed and simulated distributions that ProteinEvolver achieves is not a trivial result. The benefits of using the SCS substitution models instead of the empirical substitution models were also observed by evaluating the adequacy between the simulated sequence and its best homology model with the DOPE energy. In particular, we found that the DOPE energy from proteins simulated by the SCS neutral model was always more negative (more stable 3D proteins) than proteins simulated under the empirical substitution model, although, not surprisingly, less negative than the energy of the experimentally observed sequence-structure pair. These findings were expected because the empirical models consider independent sites, and therefore they are unable to account for physical interactions that promote stability (e.g.). Nevertheless, they constitute a minimal test that indicates the consistency of SCS models and confirms the limitation of empirical substitution matrices. The consideration of structural information should result in more sensitive and more accurate representations of molecular evolution than those based on sequence data alone (). Our structure-based models could help for a more realistic benchmarking of methods trying to take into account site dependency induced by protein structure (e.g.) and the important influences of the unfolded and misfolded configurations on the protein stability (). At the population level, the framework may help, e.g. (i) to evaluate the range of proteins that one may expect to observe in different populations (where these populations can change their sizes with time and can exchange migration), (ii) to validate analytical frameworks (e.g. methods for the inference of ARGs, ancestral protein reconstruction, recombination breakpoints and recombination rates, from proteins or protein-coding genes while accounting for structural constrains) or even (iii) to infer evolutionary parameters of interest and carry out model choice in an approximate Bayesian computation (ABC) approach (); e.g. estimate recombination rates or select among different demographic and migration models from protein data while accounting for structural information. At the molecular level, the framework may help, for example, to study the influence of recombination events on the structure-based stability of the resulting proteins or to perform structurally constrained substitution model choice by using ABC.