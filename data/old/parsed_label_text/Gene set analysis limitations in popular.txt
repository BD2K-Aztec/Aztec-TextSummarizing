Motivation: Gene set analysis is the analysis of a set of genes that collectively contribute to a biological process. Most popular gene set analysis methods are based on empirical P-value that requires large number of permutations. Despite numerous gene set analysis methods developed in the past decade, the most popular methods still suffer from serious limitations. Results: We present a gene set analysis method (mGSZ) based on Gene Set Z-scoring function (GSZ) and asymptotic P-values. Asymptotic P-value calculation requires fewer permutations, and thus speeds up the gene set analysis process. We compare the GSZ-scoring function with seven popular gene set scoring functions and show that GSZ stands out as the best scoring function. In addition , we show improved performance of the GSA method when the max-mean statistics is replaced by the GSZ scoring function. We demonstrate the importance of both gene and sample permutations by showing the consequences in the absence of one or the other. A comparison of asymptotic and empirical methods of P-value estimation demonstrates a clear advantage of asymptotic P-value over empirical P-value. We show that mGSZ outperforms the state-of-the-art methods based on two different evaluations. We compared mGSZ results with permutation and rotation tests and show that rotation does not improve our asymptotic P-values. We also propose well-known asymptotic distribution models for three of the compared methods. Availability and implementation: mGSZ is available as R package from cran.r-project.org. Contact: pashupati.mishra@helsinki.fi Supplementary information: Available at
INTRODUCTIONInferring biological pathways from high-throughput gene expression datasets that are altered in a biological or a medical test is one of the major challenges in biosciences. The analysis of gene sets instead of individual genes results in significant reduction of noise and dimension and in greater biological interpretability. Furthermore, it enhances the statistical power of tests of association of phenotype with genetic variants by pooling signals of a set of genes linked to the same biological process. Annotation libraries like Gene Ontology (), KEGG pathways () and MIPS functional Categories () are some of the popular sources for gene sets. Several methods have been developed for gene set analysis. According to Goeman and B  uhlmann, 2007, gene set analysis methods can be categorized into two major categories, competitive and self-contained. Competitive methods focus on distinguishing the most significant gene sets among a dataset of gene sets (; T  or  onen et al., 2009;), whereas selfcontained methods focus on analysis of gene sets irrespective of other genes in the dataset (). In this article, we focus on competitive gene set analysis methods. Recent research has addressed gene set analysis problems in datasets with fewer replicates and more than two sample groups (). However, the fundamental problems in P-value calculation for gene set scores remain unaddressed. Most of the methods are still based on empirical P-value that requires a large number of permutations or rotations to be calculated accurately. In this article, we first evaluate various gene set scoring functions for their optimality and then propose improvements to empirical P-value calculation. We start with a rigorous assessment and evaluation of popular gene set analysis methods: Gene Set Analysis (GSA) (), Gene Set Z-score (GSZ) (T  or  onen et al., 2009), Allez (), methods based on KolmogorovSmirnov (KS) () and weighted KolmogorovSmirnov (wKS) (), and methods based on Wilcoxon Rank Sum (WRS) (), sum of scores (SUM) () and sum of squared scores (SS) () based on empirical P-value obtained from hundred thousand sample permutations. The selection of the methods was based on earlier comparisons (). We then test whether empirical null distribution (gene set scores from permuted data) obtained from the compared methods can be modeled by suitable asymptotic distribution models. We point out major limitations in some of the methods and propose improvements on scoring functions, permutation models and P-value estimation. We show that the efficiency of GSA can be significantly improved by replacing the *To whom correspondence should be addressed yThe authors wish it to be known that, in their opinion, the first two authors should be regarded as Joint First Authors. max-mean statistics with the GSZ scoring function and by implementing asymptotic P-value. Similarly, the performance of Allez can be significantly improved by implementing sample permutation and asymptotic P-value estimation. The improved versions of GSA and Allez are called mGSA and mAllez, respectively. We show that GSZ outperforms all the compared methods including the improved ones in our evaluation. We propose an asymptotic method of P-value estimation for GSZ, mGSA, mAllez and SUM. Asymptotic P-value estimation requires fewer permutations and significantly speeds up the gene set analysis process. Similar work that proposes asymptotic method for P-value calculation was done by. Our method is different in that it requires fewer permutations.proposed fully parametric gene set analysis methods based on normal approximation of the gene set scores (gene independence assumption). However, mGSZ is semi-parametric in the sense that we approximated the empirical null distributions of gene set scores with well-known asymptotic distribution models for asymptotic P-value estimation. The implementation resulted in significant improvement in efficiency of the methods. For gene set analysis methods with no known asymptotic model, we implement an improved version of P-value calculation based on Phipson and Smyth, 2010. P-value estimation in permutation-based gene set analysis methods uses either genes or samples or both as sampling unit. Despite its popularity, gene permutation can lead to flawed biological conclusion because of correlation among genes (Goeman and B  uhlmann,). For the competitive gene set analysis methods, however, we show that it is crucial to consider the results from gene permutation. Similar to, we show that the absence of gene permutation in competitive gene set analysis results in type I error. We argue in favor of using both gene and sample as sampling unit in competitive gene set analysis methods as proposed by Efron and,and T  or  onen et al. (2009). Once significant gene sets are reported, it is useful to evaluate a gene set in more detail to see the behavior of the gene set. This can be done by visualizing the gene set score profile across the gene list as shown in the original GSEA article (). In our opinion, it is even more relevant to compare gene set scores from original and permuted data. Original data correspond to differential gene expression test scores calculated from gene expression data with correct sample labels, and permuted data correspond to differential gene expression test scores calculated from gene expression data with permuted sample labels. Therefore, we represent an improvement on the visualization where we show the gene set scores from original data and a summary (e.g. percentiles) of the gene set scores from permuted data. This allows visualization of separation between gene set scores from original and permuted data. We compared mGSZ with program packages of GSA (), Allez () and CAMERA (). We show that mGSZ clearly outperforms the other methods. ROAST () is a state-of-the-art self-contained gene set analysis method. Even though in principle self-contained methods cannot be compared with competitive methods, we compared mGSZ with ROAST to point out the differences in gene set analysis results from the two different approaches.proposed rotation test for estimation of P-values for gene set analysis of datasets with very small sample size. We show that asymptotic P-values estimated from permutation test were equally good as that of rotation test with a dataset consisting of only three replicates in each group. Finally, we present a R statistical package 'mGSZ' that implements mGSZ and the other compared methods.
DISCUSSIONGene set analysis methods aim to identify a priori defined gene sets associated with biological pathways that are altered in a biological or medical test. Despite the decade long research into the field, some of the most popular gene set analysis methods still suffer from serious limitations that need to be addressed and rectified. In this work, we have accessed and evaluated popular gene set analysis methods, pointed out limitations in the scoring functions, permutation methods and P-value calculation methods and proposed improvements. mGSZ and mGSA are the best performers in detection of TF activity in TF data (Section 3.4.1). However, in case of p53 and gender data, mGSZ detected the highest number of relevant gene sets, closely followed by SS (Section 3.4.2). Overall, mGSZ stands out as the best performer in detection of relevant gene sets. Note that the evaluation tests, detection of TF activity in TF data and relevant gene sets in p53 and gender data were based on empirical P-values estimated with 100 000 permutations. Only the gene set scoring functions were varied in the compared methods. So, the variations in results were direct consequences of the gene set scoring functions. Despite the good performance in detection of relevant gene sets with p53, gender and TF data, SS as well as SUM had significantly high type 1 error with randomized leukemia dataset (Section 3.4.3). SS and SUM are the only methods in our comparison that lack gene permutation. Because of that the methods do not compare the member and non-member genes of the analyzed gene set and thus lose the essence of competitive GSA. Note that self-contained gene set analysis methods do not require gene permutations as they calculate gene set scores with no reference to genes other than member genes of the analyzed gene sets. The remaining six methods have gene permutation included implicitly in their scoring functions and take into consideration the results from gene permutations implicitly. This clearly points to the importance of considering results from gene permutation in competitive gene set analysis methods (Section 3.7,EVD and GEVD turned out to be the best fitting models for mGSZ data which is quite natural considering that the mGSZ score is the highest absolute value in a profile. For mGSA, EVD, GEVD and GAMMA turned out to be the best fitting models. In case of mAllez and SUM, NORM was the best fitting model. Asymptotic P-values calculated for mGSZ, mGSA, mAllez and SUM scores with the best fitting models with 500 sample permutations were more accurate than empirical P-values calculated with 2000 sample permutations, clearly demonstrating the superiority of asymptotic P-value over empirical P-value (Section 3.3). Surprisingly, despite the poor performance on the other tests, empirical P-value estimation method for KS with 500 sample permutations shows exceptionally high accuracy (Section 3.3). Comparison of mGSZ with the state-of-the-art gene set analysis methods showed the best overall performance of mGSZ. mGSZ is the best method among the compared methods based on the results from the detection of relevant gene sets from p53 and gender datasets and comparison of resolution of the Pvalues assigned to the top gene sets from p53 and gender datasets (Section 3.5). The comparison of mGSZ with ROAST was included to illustrate the differences between self-contained and competitive methods with a suitable dataset. In a signal rich dataset like leukemia, self-contained methods like ROAST fail to provide biologically conclusive results. Randomization of gene sets in leukemia dataset randomizes the member genes of the gene sets. However, as 79.9% of the individual genes are differentially expressed in the leukemia data (), ROAST identifies a significantly large number of null gene sets as significant. This effect is not seen in competitive methods as competitive methods compare the member genes with non,WRS Present Present implicitly Low SS Present Absent High SUM Present Absent High wKS Present Present implicitly Low KS Present Present implicitly Low Allez Absent Present  Ranked as worstGSA Present Present  Ranked lower than mGSZ and mGSAmember genes of the analyzed gene sets, and thus the results remain stable in datasets with varying level of biological signals. Interestingly, both mGSA and mAllez rank higher than GSA and Allez in detection of the relevant gene sets in p53 and gender dataset. Higher rank of mGSA as compared with GSA suggests that replacement of max-mean statistics in GSA with GSZ scoring function and implicit implementation of gene permutation improved the performance of the method. Note that GSA implements gene permutation explicitly. Whereas, higher rank of mAllez as compared with Allez suggests that implementation of sample permutation in addition to gene permutation in Allez improved the performance of the method, once again highlighting the importance of implementing both gene and sample permutations in competitive gene set analysis (Section 3.7,). Negligible difference was observed between the asymptotic P-values reported by mGSZ with rotation test and mGSZ with permutation test (Section 3.6) with simulated gene expression dataset with three replicates in each sample group. In addition, both the methods identified same number of positive gene sets in the simulated dataset. The results suggest that mGSZ with permutation test is applicable to gene expression datasets with sample size as small as three. Improved visualization of scoring function profiles of a gene set (the most significant gene set reported by wKS) in the case of mGSZ, KS and wKS revealed a major pitfall in KS based methods, not seen in the original visualization used by(Section 3.4.4). Based on the results of our evaluation, we therefore propose:(i) use of GSZ scoring function instead of max-mean statistics in GSA (), (ii) implementation of both gene and sample permutation in competitive gene set analysis methods and (iii) use of asymptotic P-values for the methods based on GSZ, mGSA, mAllez and SUM. These improvements are implemented in our R package, mGSZ. mGSZ takes about 10 min for a gene set data with 522 gene sets and p53 data with 500 permutations in Mac book Pro 10.7.5.