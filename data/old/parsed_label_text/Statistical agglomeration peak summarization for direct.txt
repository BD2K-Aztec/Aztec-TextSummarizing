Motivation: Quantification of lipids is a primary goal in lipidomics. In direct infusion/injection (or shotgun) lipidomics, accurate downstream identification and quantitation requires accurate summarization of repetitive peak measurements. Imprecise peak summarization multiplies downstream error by propagating into species identification and intensity estimation. To our knowledge, this is the first analysis of direct infusion peak summarization in the literature. Results: We present two novel peak summarization algorithms for direct infusion samples and compare them with an off-machine ad hoc summarization algorithm as well as with the propriety Xcalibur algorithm. Our statistical agglomeration algorithm reduces peakwise error by 38% mass/charge (m/z) and 44% (intensity) compared with the ad hoc method over three datasets. Pointwise error is reduced by 23% (m/z). Compared with Xcalibur, our statistical agglomeration algorithm produces 68% less m/z error and 51% less intensity error on average on two comparable datasets. Availability: The source code for Statistical Agglomeration and the datasets used are freely available for non-commercial purposes at https://github.com/optimusmoose/statistical_agglomeration. Modified Bin Aggolmeration is freely available in MSpire, an open source mass spectrometry package at https://github.com/princelab/mspire/.
INTRODUCTIONDirect infusion (injection) lipidomics, sometimes called 'shotgun' lipidomics for its similarity to shotgun genomics, is an emerging but a well-studied field (). Here, a liquid sample is injected into a mass spectrometer, yielding a set of [mass/charge (m/z), intensity, retention time (RT)] 3-tuples (). For our purposes, we define a data point as a single m/z and intensity observation of a given isotope at a particular RT and a peak as the data points that comprise the observation of a distinct isotope. (Hereafter, we will more accurately use the term ridge instead of peak because of the fact that direct injection lipid intensity does not vary as a function of time.) Because there is no chromatographic separation in direct infusion lipidomics, each RT scan represents an independent measurement of the sample. Ideally, the species in the sample would be uniformly distributed across RT and measured in near-identical intensities across RT, making reduction to a single 2D vector of unique ridges trivial. Unfortunately, there are several noise factors that appear in real-world direct infusion samples. Sample distribution heterogeneity results in inter-scan variance in both m/z and intensity. What is more, technical and mechanical limitations in the mass spectrometer inculcate even more error into the output. Accurately estimating the true ridge values from the resulting output file is a non-trivial challenge (). To identify and quantify each lipid, its component ridges must somehow be isolated one from another, and the additive noise ridges removed. We will call this process ridge summarization. Only after ridge summarization can the isotopic envelopes be compared with theoretical databases to identify and quantify the individual lipids in the sample. The necessity of a solution for the ridge summarization problem in every direct infusion lipidomics application and the presumed effect of the results of such a solution on downstream quantitation would suggest that a description of ridge summarization be found in every shotgun lipidomics study (). However, it is frequently left unmentioned (e.g.). Although direct infusion methods have been around since the mid-1990s, we are only aware of two published solutions to this segment of the quantitation pipeline. The first is that of treating a survey scan as a true ridge measurement (). From a glance at a typical shotgun lipidomics plot, it should be clear that treating any single RT scan of data as a representative set of true ridges would be less than ideal, as the scan would include many ridges with incorrect m/z and intensity and exclude many other true ridges (). The second, a more robust approach, applies to shotgun lipidomics a technique that has been used in several proteomics studies (). This approach, which we label the fixed-width algorithm, averages scans across the RT dimension to yield an estimation of the true contents of the sample (). Though this approach is simple to code and runs in linear time, it is nonstatistical and does not take into account the data densities along the m/z axis. Here, we present two statistical approaches to solving the ridge summarization problem and evaluate them against both synthetic and real-world ridge summarization problems. We also provide the first comparative performance analysis of Xcalibur and the fixed-width algorithm on the ridge summarization problem. *To whom correspondence should be addressed.
DISCUSSIONFixed Width, to our knowledge the only extant algorithmic solution to this problem, is simple to code, yet has some obvious limitations. In mass spectrometry, the intra-sample resolution is inherently variable (). At least for the Orbitrap, low-intensity signal groups are more dispersed, whereas high-intensity signal groups have less m/z variance. Any fixed-width solution will either chop low-intensity ridges into incorrect component ridges, incorrectly agglomerate highintensity ridges or both. As shown in the results, fixed-width methods significantly overestimate the number of ridges, cascading error downstream into identification and quantitation. MBA attempts to provide robust means for dealing with ridges that overlap, and builds on the idea of Fixed Width binning by agglomerating any adjacent non-empty bins. Although the initial fixed width and the choice of which bin splitting options to use are parameters that must be determined and set by the operator, the information in manufacturer specifications, such as resolution, should assist in deciding the MBA parameters. In practice, the machine calibration to which the specifications are tied is not always the setup desired for the practitioner due to time requirements, desire to use MS/MS and so forth. Also, the true machine resolution can vary widely outside of the m/z value the specification is provided for. However, practical experience may assist in knowing when the manufacturer specs are sufficient and what changes need to be made when they are not. Because each ridge can be a different width, SA addresses the problem of bin size in a flexible data-driven manner. The ridge agglomeration procedure is statistically driven using the data itself, handling problems like overlapping ridges and avoiding the need for users to set parameters or for a priori knowledge about the dataset. Noise filtering allows for the avoidance of boundary conditions found in fixed-width methods such as ridges with just one data point. We consider s/n  1 to be a useful a priori setting, as it was the ideal setting across all three of our datasets. SA's ability to predict a far more accurate number of ridges than the other methods suggests it will increase accuracy in downstream processes over the current methods used, including Xcalibur (). One troubling observation from this study is the difficulty in accurately assessing intensity of discovered ridges. Both species identification and quantitation require an accurate intensity measurement. Yet, even SA's performance is simply the best of several inaccurate methods. Given the amount of lipid quantitation performed currently, and also the state-of-the-art, better methods of estimating intensity are needed. We have described the need for accurate ridge summarization in direct injection lipidomics samples. Interestingly, despite the importance of accuracy in this first step of the analysis pipeline, there has been no study of solutions to this version of the ridgesummarization problem to our knowledge. We present our estimate of what is currently done in the community and also propose two novel algorithms, MBA and SA, for resolving ridges in shotgun lipidomics samples. We show that SA outperforms open source and proprietary methods on average in a measure of ridgewise error, NTPD, on three datasets. We also show that SA significantly outperforms the proprietary program Xcalibur on the two datasets for which we could use Xcalibur. Incorporation of SA into existing analysis pipelines could drastically improve downstream quantitation and identification results in a variety of lipidomics experiments. Future work should continue improving our capacity to produce summarized ridges that more accurately estimate intensity. In light of the recent calls for greater reproducibility in mass spectrometry (), and to foster development of improved algorithms, these datasets and the SA algorithm (with ample documentation) are available freely for non-commercial use at http://github.com/optimusmoose/statistical_agglomeration.