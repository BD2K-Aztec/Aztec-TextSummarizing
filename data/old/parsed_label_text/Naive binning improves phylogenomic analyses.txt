Motivation: Species tree estimation in the presence of incomplete lineage sorting (ILS) is a major challenge for phylogenomic analysis. Although many methods have been developed for this problem, little is understood about the relative performance of these methods when estimated gene trees are poorly estimated, owing to inadequate phylogenetic signal. Results: We explored the performance of some methods for estimating species trees from multiple markers on simulated datasets in which gene trees differed from the species tree owing to ILS. We included *BEAST, concatenated analysis and several summary methods: BUCKy, MP-EST, minimize deep coalescence, matrix representation with parsimony and the greedy consensus. We found that *BEAST and concatenation gave excellent results, often with substantially improved accuracy over the other methods. We observed that *BEASTs accuracy is largely due to its ability to co-estimate the gene trees and species tree. However, *BEAST is computationally intensive, making it challenging to run on datasets with 100 or more genes or with more than 20 taxa. We propose a new approach to species tree estimation in which the genes are partitioned into sets, and the species tree is estimated from the resultant supergenes. We show that this technique improves the scalability of *BEAST without affecting its accuracy and improves the accuracy of the summary methods. Thus, naive binning can improve phylogenomic analysis in the presence of ILS.
INTRODUCTIONSpecies tree estimation from multiple genes is often performed using concatenation (also called 'combined analysis'): alignments are estimated for each gene and concatenated into a supermatrix, which is then used to estimate the species tree. When gene trees are concordant, concatenation can give accurate results; however, this approach to species tree estimation is potentially problematic when gene trees differ from the species tree (and hence from each other) owing to several biological factors, including gene duplication and loss, horizontal gene transfer and incomplete lineage sorting (ILS). The best studied of these problems is species tree estimation in the presence of ILS, which is based on the multi-species coalescent (). Many methods have been developed to estimate species trees in the presence of ILS, beginning with the minimize deep coalescence (MDC) approach suggested in, and now including many different types of methods [see Degnan and Rosenberg (2009);for a discussion of some methods]. Some of these new methods [for example, MP-EST () and the population tree from BUCKy ()] have been proven to be statistically consistent in the presence of ILS. In contrast, the greedy consensus (GC), majority consensus, the concordance tree from BUCKy and MDC () can be inconsistent in the presence of ILS (i.e. there are some parameter settings under which these methods are inconsistent). The Bayesian method *BEAST () may produce a statistically consistent point estimate (e.g. the MAP tree) of the species tree, but a formal proof has not yet been provided, which proves the statistical consistency of gene tree estimation using Bayesian MCMC methods]. Simulations suggest that when true gene trees differ owing to ILS, concatenated analysis can produce incorrect estimates of the species tree, sometimes with high confidence (), leading to the conjecture that concatenated analyses are not statistically consistent. However, statistical consistency or inconsistency is a mathematical statement about performance in the limit and so requires a formal proof. Thus, while the evidence strongly suggests that, under conditions in which gene trees can differ owing to ILS, concatenation can be statistically inconsistent but *BEAST will be statistically consistent, these are still open questions. As a result of these studies and the growing awareness that ILS can be present in many phylogenomic datasets, there is great interest in using ILS-based estimation of species trees instead of concatenated analysis (). However, only a few studies have been published comparing ILS-based methods and even fewer have compared concatenated analyses to ILS-based methods. Performance in simulation has been mixed, with ILS-based methods outperforming concatenation in some cases but not all (). The performance of ILS-based methods on biological datasets has also been mixed, with concatenation often producing trees with high bootstrap support that may not be completely correct, but ILS-based methods often producing trees with low bootstrap support (). Thus, we still do not know much *To whom correspondence should be addressed. about the relative performance of ILS-based methods, how they compare with methods (such as concatenation) that do not take ILS into account and what factors impact the absolute and relative performance of methods. In this article, we report on a simulation study to evaluate a collection of methods for estimating species trees and gene trees in the presence of ILS. Our simulation study includes datasets generated under three model conditions from prior studies (). One model condition has 17-taxon datasets that evolve under a strong molecular clock, and the other two model conditions have 11-taxon datasets that do not evolve under a clock. The amount of ILS varies between the three model conditions, ranging from relatively low amounts to high amounts. Finally, estimated gene trees on these datasets have low average bootstrap support due to insufficient phylogenetic signal, reflecting conditions often encountered when sampling genes from throughout the genome. We study a wide range of methods for estimating species trees from multiple markers, including *BEAST (), both the population and concordance trees returned by BUCKy (), MP-EST (), Phylonet-MDC (), GC (also called the extended majority consensus), matrix representation with parsimony (MRP) () and concatenation using maximum likelihood (CA-ML). Our study revealed that many methods have poor accuracy when the individual gene sequence alignments have low phylogenetic signal. This vulnerability to poor signal affects all methods, but especially those that combine estimated gene trees; by comparison, *BEAST and CA-ML are relatively less impacted. We developed an approach to address the vulnerability of species tree methods to low phylogenetic signal. We randomly partitioned the genes into subsets (which we call 'supergenes'), estimated trees from these supergene alignments and then used methods to estimate the species tree from the supergene trees. This approach did not produce statistically significant changes in accuracy on the 17-taxon datasets, but improved the accuracy of the trees estimated by combining estimated gene trees, often substantially, on the 11-taxon datasets. Running *BEAST on the binned supergene alignments did not impact its accuracy, but did improve its scalability. Furthermore, when used with binning, several methods came close to being as accurate as *BEAST, while being orders of magnitude faster than *BEAST. Thus, this study suggests that highly accurate largescale phylogenomic analyses may be achievable through a naive binning technique.
DISCUSSIONThe main purpose of this study was to evaluate methods for estimating species trees in the presence of ILS under realistic conditions. Because many real-world phylogenomic analyses have to contend with genes with poor phylogenetic signal (), we specifically examined conditions in which estimated gene trees were only partially resolved. As expected, the number of genes and amount of ILS impacted the accuracy of the methods we tested, so that all methods returned more accurate trees with increasing numbers of genes and decreasing levels of ILS. However, in addition to these expected results, we make the following observations: First, all the summary methods we studied were impacted by gene tree estimation error. In contrast, although *BEAST and CA-ML were also affected by the amount of phylogenetic signal in the multiple sequence alignments, the impact was generally less. Second, CA-ML and *BEAST had similar accuracy, and were generally more accurate than the summary methods we tested. Third, *BEAST produced dramatically more accurate gene trees than ML analyses on the alignments, and summary methods on these gene trees produced species trees as accurate as *BEAST species trees, explaining why *BEAST produces more accurate species trees than other methods. Fourth, the naive binning technique we tested generally improved coalescent-based methods. It improved the scalability of *BEAST without impacting its accuracy, making it feasible to use *BEAST on datasets with many genes. Binning also improved the accuracy of species trees estimated using the summary methods we tested on the 11-taxon conditions, although the degree of impact depended on the number of genes and the level of ILS. Finally, binning had no statistically significant impact on the 17-taxon conditions. The observation that summary methods are vulnerable to poor phylogenetic signal in the gene sequences is consistent with the empirical studies reported by Salichos and Rokas (2013) and, and this study would seem to suggest that naive binning would be helpful for species tree estimation under these circumstances. However, naive binning could have unforeseen negative consequences if it puts genes with different histories into the same bin. The good performance of naive binning under the 11-taxon strongILS condition we explored suggests that it may be somewhat robust in practice, even under relatively high rates of ILS. However, because naive binning did not improve the accuracy of summary methods on the 17-taxon datasets (which had the highest rate of ILS), this suggests that naive binning could reduce accuracy when the amount of ILS is large. There is also a possibility that binning will only be helpful when concatenation is more accurate than the coalescent-based methods. Therefore, further research is needed to assess the conditions in which binning improves or reduces accuracy. See Supplementary Materials, Section 4, for additional discussion about this issue. One of the most interesting results in this article is the observation that CA-ML outperformed all the ILS-based methods that operate by combining estimated gene trees. This observation would seem to run counter to other simulation studies that have shown that concatenation can return incorrect trees with high confidence and can also produce trees that are less accurate than trees estimated by ILS-based methods (). However, these studies used simulated datasets that evolve under a strong molecular clock [a condition that may benefit some coalescent-based methods more than concatenation (, few taxa and generally had many genes relative to the number of taxa (and estimated gene trees on these alignments may have been fairly accurate). In contrast, our study had 11-and 17-taxon datasets, at most 100 genes and poorly estimated gene trees. Thus, it seems that there are conditions under which some ILS-based methods might outperform CA-ML, and other conditions under which CA-ML might outperform the ILS-based methods. In particular, it is possiblethat the critical issue is the number of genes, and that ILS-based methods will have better accuracy than concatenation when the number of genes is large enough. Clearly, further research is needed to understand which conditions favor each type of approach. See Section 4 in Supplementary Materials for more discussion of these issues.