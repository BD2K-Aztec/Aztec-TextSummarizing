Motivation: When targeted to a barcoding region, high-throughput sequencing can be used to identify species or operational taxonomical units from environmental samples, and thus to study the diversity and structure of species communities. Although there are many methods which provide confidence scores for assigning taxonomic affiliations, it is not straightforward to translate these values to unbiased probabilities. We present a probabilistic method for taxonomical classification (PROTAX) of DNA sequences. Given a pre-defined taxonomical tree structure that is partially populated by reference sequences, PROTAX decomposes the probability of one to the set of all possible outcomes. PROTAX accounts for species that are present in the taxonomy but that do not have reference sequences, the possibility of unknown taxonomical units, as well as mislabeled reference sequences. PROTAX is based on a statistical multinomial regression model, and it can utilize any kind of sequence similarity measures or the outputs of other classifiers as predictors. Results: We demonstrate the performance of PROTAX by using as predictors the output from BLAST, the phylogenetic classification software TIPP, and the RDP classifier. We show that PROTAX improves the predictions of the baseline implementations of TIPP and RDP classifiers, and that it is able to combine complementary information provided by BLAST and TIPP, resulting in accurate and unbiased classifications even with very challenging cases such as 50% mislabeling of reference sequences. Availability and implementation: Perl/R implementation of PROTAX is available at
IntroductionDNA barcoding has gained much interest in recent years, the Barcode of Life project () being the most widespread endeavour in this field. The great promise of barcoding approaches is that in principle any organism can be identified from a tissue (or other biological) sample. To be effective and practical, barcoding genes should have sufficient variation between species, but limited variation within species, to provide the necessary signal for species-level identification. Commonly used barcoding genes include COI in animals, ITS in fungi, and rbcL as well as matK in plants (). Barcoding approaches are particularly powerful when combined with next-generation sequencing (NGS) methods, which can be used to produce massive amounts of sequence data from environmental samples (). That way, entire species communities can be profiled for taxonomic affiliations. Two contrasting, although not mutually exclusive approaches have been applied to analyze the environmental sequence data. First, a number of approaches have focused on classifying samples into operational taxonomic units (OTUs), which can be done in the absence of a well-resolved taxonomy and reference sequence database. The OTU approach is especially prevalent in studies on bacteria and other micro-organisms (). The complementary problem, which we address here, and which underlies the Barcode of Life project, is the case where a sequence reference database and an established taxonomy are available. Here the problem lies in classifying the environmental sequences with respect to an existing taxonomy. In popular software packages like MOTHUR () and QIIME (), it is possible to carry out both the clustering and the taxonomic classification. Several methods exist for assigning taxonomic labels to sequence data. MEGAN () classifies sequences according to the lowest common ancestor (LCA) node of BLAST hits. BLAST is also used in MetaPhlAn (). There are fast alternatives for BLAST, e.g. LAST () which is based on suffix array and used in Taxator-tk (). PhymmBL () is based on the combination of BLAST and interpolated Markov models and mOTU () utilizes hidden Markov models (). Another set of tools uses methods from phylogenetics, e.g. TIPP () is based on a phylogenetic placement algorithm. The commonly used RDP classifier () is based on navenave Bayes classifier (NBC) which uses the 8-mer decomposition of a sequence. MyTaxa () allows the use of multiple markers simultaneously and Kraken () and CLARK () can utilize full-length genome sequences. Existing classification methods give good results if the target classes are well represented with adequate training data (), but it has remained difficult to account for taxonomic units without reference sequences (). Another typical practical problem is the presence of mislabeled training data, which the present methods to our knowledge fail to properly account for. With any method of sequence classification, a central question concerns the reliability of the classification. To move from sequence similarity to a more objective measure of the reliability of species identification, it is desirable to estimate the set of probabilities by which the query sequence represents the possible candidate species or higher taxonomical units. In our past work (), we developed a statistical model that estimates the probability by which the best matching reference sequence (for instance, based on a BLAST search) represents the true species. In this paper, we develop our previous approach into a general tool for probabilistic taxonomic classification, called PROTAX. PROTAX utilizes a reference sequence database and a taxonomic tree structure to estimate the probability with which an environmental sample can be placed in a given taxon. Outcomes of the classification include not only the species for which reference sequences are available, but also species for which no reference sequences are available, as well as speciesor higher taxonomic unitsthat are not known to science in the sense that they are missing from the taxonomy. PROTAX accounts for the possibility that some of the reference sequences are mislabeled, a complication often present with real data. PROTAX is based on a Bayesian multinomial regression model and it can use as predictors any kind of covariates, in particular any kind of sequence similarity measures. In this paper, we present the general statistical framework and illustrate the use of PROTAX in the context of classifying amplicon sequencing data based on covariates generated by BLAST sequence similarity and the TIPP and RDP classifiers, as well as a combination of BLAST and TIPP. We illustrate with simulated data that PROTAX is able to perform taxonomical classification in an accurate and unbiased manner. In particular, we show how PROTAX can improve the classification accuracies of TIPP and RDP classifiers and remove the bias that they in some cases have for the estimates of classification uncertainty. We then apply PROTAX to a fungal case study, illustrating the relevance and generality of the results obtained for simulated data.
DiscussionIn this paper, we have introduced PROTAX, a probabilistic method for taxonomical classification. PROTAX converts sequence similarities into unbiased taxon membership probabilities. It takes into account uncertainties of both the taxonomy and the content of the reference sequence database. We have demonstrated its use in the context of fungal ITS amplicon sequencing, but the method is general and can be used with any markers. In addition to DNA sequences, it can be used also for classifying other types of data. We emphasize that PROTAX can include any covariates in the regression model and thus the examples presented in this paper are demonstrations of only some possible choices. Besides using pairwise sequence similarities as a proxy for taxon membership, any node-sequence similarities can be used. As an example of this, we used the node probability from TIPP and RDP classifier as a covariate in PROTAX. Further, we note that the choice of using the maximal and mean sequence similarities in PROTAX(BLAST) is one choice among many possible sets converting sequence similarity into PROTAX predictors. We believe that all higher-level analyses, such as characterization of sample abundance profiles, benefit if the first step of assigning a sequence read into a taxonomic unit is done in a manner that enables reliable assessment of identification uncertainty. PROTAX provides a statistical model that can be used with present classifiers or their combinations. It is not a new classifier per se but it combines the information obtained from user defined covariate sources. An important feature of PROTAX is that it gives unbiased probabilities of taxonomic placement. Furthermore, it explicitly models uncertainty related to missing data and missing branches in the taxonomy which to our knowledge other classifiers do not properly take into account. In the experiments so far we have started with the simple assumption that the set of explanatory variables are the same for all nodes, and that the regression coefficients are specific to the level l only, so that b z j  b lz j , where l(z) is the level to which node z belongs. The results have been satisfactory already with this approach, but to account for sequence similarity variation between taxonomical units at the same level (e.g. between genera), it would be possible to model b z j e.g. as a random effect with a multivariate normal structure. We provide Perl and R scripts for training the models and using them for classification. Both speed and memory consumption depend mainly on the choice of covariate sources. As an example, we have constructed models for a large fungal ITS database with 75 000 reference sequences using a 6-level taxonomy with 130 000 species. For classifying 1000 sequences using a single processor on a standard Linux desktop, it took 40 s to calculate sequence similarities using LAST () and 104 s to perform the taxonomic classification and output all nodes with probabilities above 0.01. Memory consumption was 477 Mb. When classifying large amounts of sequences, speed and memory usage can be improved by pre-clustering the data and applying a naive parallelization of the algorithm.(a) Accuracy and bias of sequence identification by different versions of PROTAX, TIPP and RDP classifier for 336 fungal ITS sequences. For 262 sequences, the best outcome of PROTAX(BLAST  TIPP) was a species with reference sequences. (b) Histogram of best outcome probabilities from PROTAX(BLAST  TIPP)Unbiased probabilistic taxonomic classification