
<?xml version="1.0" encoding="UTF-8"?>
<TEI xmlns="http://www.tei-c.org/ns/1.0" 
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
xsi:schemaLocation="http://www.tei-c.org/ns/1.0 /home/joey/Project/grobid/grobid-home/schemas/xsd/Grobid.xsd"
 xmlns:xlink="http://www.w3.org/1999/xlink">
	<teiHeader xml:lang="en">
		<encodingDesc>
			<appInfo>
				<application version="0.4.2-SNAPSHOT" ident="GROBID" when="2017-08-10T23:57+0000">
					<ref target="https://github.com/kermitt2/grobid">GROBID - A machine learning software for extracting information from scholarly documents</ref>
				</application>
			</appInfo>
		</encodingDesc>
		<fileDesc>
			<titleStmt>
				<title level="a" type="main">Gene expression Intensity drift removal in LC/MS metabolomics by common variance compensation</title>
			</titleStmt>
			<publicationStmt>
				<publisher/>
				<availability status="unknown"><licence/></availability>
				<date type="published" when="2014">20 2014</date>
			</publicationStmt>
			<sourceDesc>
				<biblStruct>
					<analytic>
						<author>
							<persName>
								<forename type="first">Francesc</forename>
								<surname>Fern Andez-Albert</surname>
							</persName>
							<affiliation key="aff0">
								<orgName type="department" key="dep1">Department d&apos;Enginyeria de Sistemes</orgName>
								<orgName type="department" key="dep2">CIBER-BBN</orgName>
								<orgName type="institution" key="instit1">Autom atica i Inform atica Industrial</orgName>
								<orgName type="institution" key="instit2">Universitat Politè cnica de Catalunya</orgName>
							</affiliation>
						</author>
						<author>
							<persName>
								<forename type="first">Rafael</forename>
								<surname>Llorach</surname>
							</persName>
							<affiliation key="aff0">
								<orgName type="department" key="dep1">Department d&apos;Enginyeria de Sistemes</orgName>
								<orgName type="department" key="dep2">CIBER-BBN</orgName>
								<orgName type="institution" key="instit1">Autom atica i Inform atica Industrial</orgName>
								<orgName type="institution" key="instit2">Universitat Politè cnica de Catalunya</orgName>
							</affiliation>
						</author>
						<author>
							<persName>
								<forename type="first">Mar</forename>
								<surname>Garcia-Aloy</surname>
							</persName>
							<affiliation key="aff0">
								<orgName type="department" key="dep1">Department d&apos;Enginyeria de Sistemes</orgName>
								<orgName type="department" key="dep2">CIBER-BBN</orgName>
								<orgName type="institution" key="instit1">Autom atica i Inform atica Industrial</orgName>
								<orgName type="institution" key="instit2">Universitat Politè cnica de Catalunya</orgName>
							</affiliation>
						</author>
						<author>
							<persName>
								<forename type="first">Andrey</forename>
								<surname>Ziyatdinov</surname>
							</persName>
							<affiliation key="aff0">
								<orgName type="department" key="dep1">Department d&apos;Enginyeria de Sistemes</orgName>
								<orgName type="department" key="dep2">CIBER-BBN</orgName>
								<orgName type="institution" key="instit1">Autom atica i Inform atica Industrial</orgName>
								<orgName type="institution" key="instit2">Universitat Politè cnica de Catalunya</orgName>
							</affiliation>
						</author>
						<author>
							<persName>
								<forename type="first">Cristina</forename>
								<surname>Andres-Lacueva</surname>
							</persName>
							<affiliation key="aff0">
								<orgName type="department" key="dep1">Department d&apos;Enginyeria de Sistemes</orgName>
								<orgName type="department" key="dep2">CIBER-BBN</orgName>
								<orgName type="institution" key="instit1">Autom atica i Inform atica Industrial</orgName>
								<orgName type="institution" key="instit2">Universitat Politè cnica de Catalunya</orgName>
							</affiliation>
						</author>
						<author>
							<persName>
								<forename type="first">Alexandre</forename>
								<surname>Perera</surname>
							</persName>
							<affiliation key="aff0">
								<orgName type="department" key="dep1">Department d&apos;Enginyeria de Sistemes</orgName>
								<orgName type="department" key="dep2">CIBER-BBN</orgName>
								<orgName type="institution" key="instit1">Autom atica i Inform atica Industrial</orgName>
								<orgName type="institution" key="instit2">Universitat Politè cnica de Catalunya</orgName>
							</affiliation>
						</author>
						<author>
							<persName>
								<forename type="first">Joan</forename>
								<surname>Xxiii</surname>
							</persName>
							<affiliation key="aff1">
								<orgName type="department" key="dep1">Department of Nutrition and Food Science-XaRTA</orgName>
								<orgName type="department" key="dep2">Faculty of Pharmacy, Food and Nutrition Torribera Campus</orgName>
								<orgName type="laboratory">Biomarkers &amp; Nutrimetabolomic Lab</orgName>
								<orgName type="institution" key="instit1">INSA</orgName>
								<orgName type="institution" key="instit2">University of Barcelona</orgName>
								<address>
									<addrLine>Av. Prat de la Riba 171</addrLine>
									<postCode>08921</postCode>
									<settlement>Sta Coloma de Gramenet</settlement>
								</address>
							</affiliation>
						</author>
						<author>
							<persName>
								<forename type="first">Ziv</forename>
								<surname>Bar-Joseph</surname>
								<roleName>Barcelona, Spain Associate Editor:</roleName>
							</persName>
							<affiliation key="aff1">
								<orgName type="department" key="dep1">Department of Nutrition and Food Science-XaRTA</orgName>
								<orgName type="department" key="dep2">Faculty of Pharmacy, Food and Nutrition Torribera Campus</orgName>
								<orgName type="laboratory">Biomarkers &amp; Nutrimetabolomic Lab</orgName>
								<orgName type="institution" key="instit1">INSA</orgName>
								<orgName type="institution" key="instit2">University of Barcelona</orgName>
								<address>
									<addrLine>Av. Prat de la Riba 171</addrLine>
									<postCode>08921</postCode>
									<settlement>Sta Coloma de Gramenet</settlement>
								</address>
							</affiliation>
						</author>
						<title level="a" type="main">Gene expression Intensity drift removal in LC/MS metabolomics by common variance compensation</title>
					</analytic>
					<monogr>
						<meeting> <address><addrLine>Av</addrLine></address>
						</meeting>
						<imprint>
							<biblScope unit="volume">30</biblScope>
							<biblScope unit="page" from="2899" to="2905"/>
							<date type="published" when="2014">20 2014</date>
						</imprint>
					</monogr>
					<idno type="DOI">10.1093/bioinformatics/btu423</idno>
					<note type="submission">Received on February 11, 2014; revised on June 20, 2014; accepted on June 25, 2014</note>
					<note>BIOINFORMATICS ORIGINAL PAPER Supplementary information: Supplementary data are available at Bioinformatics online.</note>
				</biblStruct>
			</sourceDesc>
		</fileDesc>
		<profileDesc>
			<abstract>
				<p>Liquid chromatography coupled to mass spectrometry (LC/MS) has become widely used in Metabolomics. Several artefacts have been identified during the acquisition step in large LC/MS metabolomics experiments, including ion suppression, carryover or changes in the sensitivity and intensity. Several sources have been pointed out as responsible for these effects. In this context, the drift effects of the peak intensity is one of the most frequent and may even constitute the main source of variance in the data, resulting in misleading statistical results when the samples are analysed. In this article, we propose the introduction of a methodology based on a common variance analysis before the data normalization to address this issue. This methodology was tested and compared with four other methods by calculating the Dunn and Silhouette indices of the quality control classes. The results showed that our proposed methodology performed better than any of the other four methods. As far as we know, this is the first time that this kind of approach has been applied in the metabolomics context. Availability and implementation: The source code of the methods is available as the R package intCor at http://b2slab.upc.edu/software-and-downloads/intensity-drift-correction/.</p>
			</abstract>
		</profileDesc>
	</teiHeader>
	<text xml:lang="en">
		<body>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="1">INTRODUCTION</head><p>Metabolomics aims to asses the metabolic changes in a global way to infer biological functions and provide the detailed biochemical responses of cellular systems (<ref type="bibr" target="#b8">Fiehn et al., 2006</ref>). Liquid chromatography/mass spectrometry (LC/MS) devices are among the most used experimental set-ups in metabolomics. LC/MS analyses of biological samples such as urine or plasma give high-throughput data having a three index scheme: retention time, mass/charge ratio and intensity values (<ref type="bibr" target="#b0">Aihua et al., 2012;</ref><ref type="bibr" target="#b23">Xin et al., 2008</ref>). In metabolomic data, as in other types of high-dimensional data such as gas sensor arrays or microarray data, the intensity values of the variables might be biased or might suffer from variations owing to external factors. Among these factors is a contribution from the drift of the experimental devices, owing to various causes such as column ageing in the case of LC/MS, temperature variations or contamination effects (<ref type="bibr" target="#b4">Burton et al., 2008;</ref><ref type="bibr" target="#b22">Wang et al., 2013</ref>). The presence of peak intensity drift in the data is an important issue, as its effects can be important enough to mask the real statistical behaviour of the data and may indeed be the largest source of variance in the data (<ref type="bibr" target="#b21">Veselkov et al., 2011;</ref><ref type="bibr" target="#b22">Wang et al., 2013</ref>). In most LC/MS protocols, quality control (QC) samples are regularly injected to ensure good analytical device performance (<ref type="bibr" target="#b7">Dunn et al., 2011</ref>). In LC/MS metabolomics studies, the quality controls have been carried out using pools of biological samples, spikes with standards or Milli-Q water samples (<ref type="bibr" target="#b16">Llorach et al., 2009</ref>). These quality control samples consist either of a pooling of all the samples in the study or of a spike-in of some known metabolites (several classes having different types of QC samples might be injected). In the data preprocessing stage, one may distinguish two different steps: data normalization and data equalization. We understand the data normalization step as the mathematical process that makes the variables in the dataset comparable, whereas the data equalization step makes the samples from the dataset comparable. In the literature, many normalization and equalization methods, based on several different approaches and scopes, may be found. Regarding equalization methods, a methodology using certain internal known metabolites as quality standards to normalize the whole dataset has been reported (<ref type="bibr" target="#b18">Sysi-Aho et al., 2007</ref>). Another approach is to use the injected samples for internal control (i.e. QCs) to fit a smoothed model for the intensity levels of certain features, and then to correct all the biological samples accordingly (<ref type="bibr" target="#b7">Dunn et al., 2011</ref>). The R package sva includes the ComBat function, which compensates the batch effects on microarray data using an empirical Bayes approach (<ref type="bibr" target="#b13">Johnson et al., 2007;</ref><ref type="bibr" target="#b14">Leek et al., 2012</ref>). This method has been applied to normalize gene expression and methylation data (<ref type="bibr" target="#b5">Chen et al., 2013;</ref><ref type="bibr" target="#b15">Leitch et al., 2013</ref>). Equalization methods based on a sample-wise correction for LC/ MS metabolomic data have also been tested and compared by<ref type="bibr" target="#b21">Veselkov et al. (2011)</ref>. Their results suggest that a variance stabilization transformation of the data, followed by a median fold change normalization, gives the best performance as compared *To whom correspondence should be addressed. with three other methods. Their method performs a normalization and an equalization step to give a robust output when having urine samples with different concentration values. Among the equalization methods, the one proposed by Artursson et al., based on component correction (CC), was developed in the sensor-array field (<ref type="bibr" target="#b1">Artursson et al., 2000</ref>). This method is based on the assumption that, in multivariate data, the drift direction is the first principal component (PC) of a PCA decomposition for a class consisting of measurements of the same samples. Such samples are known as technical replicates (i.e. there is no biological or chemical variation in addition to the variability of the technical replication of the measure). Once the drift direction is computed, the drift is removed from the data by subtracting the data projection on the drift direction from the original data. However, if some between-class variability is aligned with the drift direction, it will also be subtracted, and some non-drift variability will be removed. A natural extension of the CC method is the one proposed by Ziyatdinov et al., which is based on a common principal component analysis (CPCA) decomposition (<ref type="bibr" target="#b24">Ziyatdinov et al., 2010</ref>). This method proposes modelling the drift contribution in the data as the direction capturing maximum variance that simultaneously diagonalizes the covariance matrices of a set of classes. All the variability of the samples in that particular direction is considered to be driftinduced variability, and the projection of the data on that direction is subtracted from the data as in the CC method. In this article, to find the drift model, we state the hypothesis that the intensity drift of the chromatograms is the common variance direction of all the QC classes that captures the maximum variance. In this context, we propose a preprocessing method based on a two-step approach by first equalizing the data through a CPCA, and then normalizing the data using a median fold change step.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="2">MATERIALS AND METHODS</head></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="2.1">Description of the data</head><p>The samples were analysed by liquid chromatography coupled with a hybrid quadrupole time-of-flight (LC-q-TOF, Hybrid quadrupole TOF QSTAR Elite, AB/MDS Sciex) in positive mode using the protocol proposed by<ref type="bibr" target="#b19">Tulipani et al. (2011)</ref>. LC was performed in High-Performance Liquid Chromatography (HPLC) Agilent (Agilent 1200 Series Rapid Resolution HPLC system) using an RP 18 Luna column (50 Â 2.0 mm, 5 m), with a sample injection volume of 15 l. A linear gradient elution was performed consisting of<ref type="bibr">[A]</ref>Milli-Q water 0.1% HCOOH (v/v) and<ref type="bibr">[B]</ref>acetonitrile 0.1% HCOOH (v/v).The gradient elution (v/v) of<ref type="bibr">[B]</ref>was as follows: (time, min; B, %):</p><formula>(0, 1), (4, 20), (6, 95), (7.5, 95),(8, 1), (12, 1</formula><p>). Q-TOF spray parameters were set as previously described (<ref type="bibr" target="#b16">Llorach et al., 2009</ref>), and full data acquisition was performed scanning from 70 to 700 m/z. The TOF was calibrated with reserpine (1 pmol/l). LC–MS data were acquired in random order to avoid possible bias and the batches equilibrated. Throughout all the analysis, data process quality control (QC) samples were analysed to monitor the stability and functionality of the system. The sample collecting span was of 18 days, and there was a replacement of the chromatographic column in the process on day 14. There were 994 study samples and 182 QC samples. Three classes of QC samples were used for each batch: Water: Milli-Q water samples (n = 96 samples). Spikes: Standard mixture solution (n = 48 samples) consisting of 12 metabolites at the final concentration of 5 ppm for all of them except for indole-3-acetic-2,2-d2 acid whose final concentration was of 10 ppm.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="2.3">Methods</head><p>The five methods compared in this article (CPCA, CC, median fold change, ComBat and our CPCA + median fold change) have different input parameters. The methods based on a CPCA decomposition or the CC method involve a class (or classes)-selection step to use them for the drift modelling. These methods also need as input the number of components of the drift decomposition, which are supposed to be captured. The ComBat method needs the batch relation for each class, whereas the median fold change method does not need any specific input parameter in addition to the data to be normalized.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="2.3.1">Component correction The hypothesis underlying this method</head><p>is that the drift direction is found in the first PC of a reference class. The methodology used to normalize these data is described in (<ref type="bibr" target="#b1">Artursson et al., 2000</ref>). As the feature pattern of the QC samples was more complex than that of the other two QC classes, the reference class was selected to generate the PCA model. Because of this higher complexity, this class is better able to capture the drift in the data than would a class with a simpler feature pattern. Mathematically, the CC method can be expressed 2900</p><formula>Y r =S Á L T +E ð1Þ</formula><p>The methodology proposed by Artursson et al. removes one PC, but the method can be generalized to remove as many PCs as can be found in the data. If Ncomps is the number of components to be removed, then S (p r Â Ncomps) is the scores matrix, L (m Â Ncomps) is the loadings matrix and E (p r Â m) is the error matrix. As only one PC is required to perform the normalization, no further increase in the dimensions of the matrices S and L is necessary. The drift direction is the first PC, which in this case corresponds to the matrix L. The next step is to project the dataset Y onto this direction to obtain the drift component in the data. This projection is mathematically expressed as the Equation (2).</p><formula>Y cc d =ðY Á LÞ Á L T ð2Þ</formula><p>where the superscript cc refers to CC and the subscript d to drift. Once the drift component Y cc d (p r Â m) of the data is computed, the last step in removing the drift is to subtract it from the data.<ref type="bibr">Equation (3)</ref>shows this last step, and the resulting matrix Z cc (p r Â m) is the corrected matrix using the CC method.<ref type="bibr" target="#b21">Veselkov et al., 2011</ref>). The first step of this method, shown in equation (4), is to compute the median for each variable, thus obtaining a vector ^ y i ð1 Â mÞ. This vector is used to rescale the original dataset Y into a new one, ^ Yðp Â mÞ IG(IG) [see</p><formula>Equation (4)]. ^ Y ij = Y ij ^ y i where ^ y i = median i ðY ij Þ ð 4Þ</formula><p>To obtain the normalized dataset Z M ðp Â mÞ, the dataset Y is divided by the sample median of the matrix ^ Y (defined as ^ w j ðp Â 1Þ) as shown in Equation (5).</p><formula>Z M ij = Y ij ^ w j where ^ w j =median j ð ^ Y ij Þ ð 5Þ</formula><p>where the superscript M refers to median fold change method.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="2.3.3">ComBat</head><p>The ComBat method is a function of the R package sva. This function aims to correct the batch effects, which are known to be a source of bias, in gene expression experiments; its extension to LC/ MS metabolomic datasets is both natural and straightforward. First, it is assumed that batch effects have multiplicative and additive contributions to the data, and that these effects can be variable dependent (gene or peak, respectively). We state a model following this hypothesis [see</p><formula>Equation (6)] Y ijb = j +X j + jb + jb ijb ð6Þ</formula><p>where Y ijb is the intensity value for sample i, variable j and batch b. j is the intensity value for variable j, X is the design matrix, j contains the regression coefficients of the model, jb is a matrix containing the additive batch effects for variable j and batch b, jb is a matrix containing the multiplicative batch effects for variable j and batch b and ijb is the residual matrix of the model. Using either a parametric or a non-parametric empirical prior estimation, the distributions for jb and 2 jb are estimated. The conditional posterior probabilities ( Ã jb and 2Ã jb ) can then be found, and the data are corrected for batch effects as shown in Equation (7). In the following, all the variables having a hat (^) on them refer to their values estimated from the data.</p><formula>Z CB ijb = ^ j ^ Ã ij ðZ ijb À ^ jb Ã Þ+ ^ j +X ^ j ð7Þ</formula><p>where the superscript CB refers to the ComBat function, Z ijb is the standardized data and ^ j is the estimated standard deviation.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="2.3.4">CPCA CPCA is a generalization of the PCA decomposition for</head><p>different classes first introduced by<ref type="bibr" target="#b11">Flury et al. (Flury, 1984</ref>). Say we have k classes and S k ðp k Â p k Þ are the set of their covariance matrices, then CPCA aims at finding a space such as the one defined by the V (in general, p k Â p k Þ matrix shown in Equation (8). In the space spanned by V, the covariance matrices for all the classes involved S k are diagonal.</p><formula>Ã k =V T Á S k Á V ð8Þ</formula><p>where Ã k ðp k Â p k Þ is the diagonalized covariance matrix for class k. Each one of the dimensions of this space is called a common principal component (CPC). The hypothesis underlying the CPCA method for drift correction is that the drift direction is contained in the CPC capturing the largest variance. The CPC will be computed by using the Y QC dataset [i.e. there are three expressions like Equation (8), using the different covariance matrices for the QC classes: S r , S water , S spikes ]. In a similar way as in a PCA decomposition, given the desired number of CPCs and following a stepwise algorithm, it is possible to compute the number of CPCs one by one (<ref type="bibr" target="#b20">Trendafilov, 2010</ref>). Setting the desired number of CPCs as Ncomps, the dimensionality of the V matrix is (p k Â Ncomps). We have tested the values Ncomps = 1, 2, 3 separately for this method. Once the CPCs are found, the dataset is projected onto this space as shown in</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="2.3.5">CPCA + median fold change</head><p>The method we propose consists of a two-step approach. First, the data are equalized by removing the drift using CPCA and, in the second step, the data are normalized by applying the median fold change method. As the CPCA method was applied three times with different number of extracted CPCs (Ncomps in previous subsection), the proposed method will be computed for the same number of components (Ncomps = 1, 2, 3).</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="2.4">Validation</head><p>From the class definition in Section 2.1, it follows that a PCA score plot of all the classes should have the classes clearly separated in different clusters. We propose a quality measure for peak intensity drift correction methods based on the standard clustering internal measures Dunn and Silhouette for the QC classes in the principal plane (the plane explaining maximum variability of the data) score plot of all the classes (including the study class). The clustering technique used was k-means. The R package clValid was used to compute the quality indices (<ref type="bibr" target="#b2">Brock et al., 2008</ref><ref type="bibr" target="#b3">Brock et al., , 2011</ref>). In general, the greater the Dunn and Silhouette indices, the better the clustering, meaning that the QC classes are more easily separable in the principal plane and that the intra-class variance is lower.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="3">RESULTS AND DISCUSSION</head><p>The top left plot in<ref type="figure" target="#fig_3">Figure 1</ref>depicts a PCA score plot for the raw data using all the classes. The<ref type="figure">Figure shows</ref>that one of the main sources of variance is the interclass variability. The drift effect on the variance becomes clear when the same PCA score plots are coloured according to the injection time or the batch of the sample. This effect is shown in<ref type="figure" target="#fig_4">Figure 2</ref>. From this Figure, we conclude that there is a clear drift component (having different sources) that is causing an important drift of the QC classes and which, in all likelihood, affects the samples in the study class as well.<ref type="figure">Table 1</ref>contains the Dunn and Silhouette values for all the methods used, whereas<ref type="figure" target="#fig_3">Figure 1</ref>depicts the PCA Scoreplots for the same methods. The CPCA + median fold change method shows the highest clustering values (highest Dunn index when two components are removed and highest Silhouette index when one component is removed) and it has a slight advantage over the CPCA and the median fold change methods. From the mathematical formulation of the Dunn index, it is important to note that its measures might give low values when there are a small number of samples some distance from the cluster centre, even if all the other samples and classes are tightly clustered (<ref type="bibr" target="#b6">Dunn, 1973</ref>). This might be the case here, as applying the CC method removing two PCs had a higher Dunn index than the CPCA + median fold change removing one CPC, when the PCA score plots showed a lower drift clustering for the latter (compare Supplementary<ref type="figure" target="#fig_3">Fig. S1</ref>versus the bottom right plot of<ref type="figure" target="#fig_3">Fig. 1</ref>). The Silhouette index (<ref type="figure">Table 1</ref>) for the different CPCA methods applied suggests that the drift seems to be contained in just the first CPC, as the quality measures go down as more CPCs are removed from the data.<ref type="figure" target="#fig_6">Figure 3</ref>depicts the originof the variance removed by each of the three CPCs and the mean chromatogram of the QC samples. Whereas the first CPC shows a smooth variation along the retention time, the second and third CPCs show abrupt changes in their values, especially close to major chromatographic peaks. In some of these peaks, the values of the second and third CPCs have a zigzag behaviour, suddenly going from negative to positive values or vice versa. This behaviour suggests that the variance captured by these two CPCs corresponds to not having the chromatograms perfectly aligned, meaning that the peaks in the chromatograms are not fully coincident across the samples. This fact further reinforces the hypothesis that the drift is contained in just the first CPC. Assuming this hypothesis, it can be noted from<ref type="figure" target="#fig_6">Figure 3</ref>that the drift of the data is not higher close to the chromatographic peaks, apparently quite the opposite, meaning that the drift affects the baselines of the chromatograms more than their peaks. The CC method corrects some of the drift in the data although a large drift component is still to be found in the data (<ref type="figure" target="#fig_3">Fig. 1</ref>). The larger Dunn index value for the CC method as compared with the raw data value is evidence for the drift correction (<ref type="figure">Table 1</ref>). However, this improvement is not validated by the Silhouette index, which remains practically unchanged as compared with the raw Silhouette value regardless of the number of components removed. The ComBat method does not seem to be the most suitable method for correcting LC/MS metabolomic data despite being used widely and successfully in the field of gene expression and methylation data. Although it corrects some batch effects in the study samples, the batch effects are still important in the QC classes after the correction (see circles A–G for some spikes and water samples compared with the H circle containing some study samples in Supplementary<ref type="figure" target="#fig_4">Fig. S2</ref>). Furthermore, the resultant PCA score plot (lower left plot of<ref type="figure" target="#fig_3">Fig. 1</ref>) for the ComBat correction suggests that some between-variance component was removed in the correction process, as the different classes are closer than for the raw data. The median fold change method considerably improves both the Dunn and the Silhouette indices. A visual inspection of the resulting PCA score plot for the median fold change method confirms this improvement (<ref type="figure" target="#fig_3">Fig. 1</ref>). Nevertheless, the PCA score plot also shows that the spikes and water classes have similar shapes and these long shapes turn out to be caused by residual uncorrected drift effects (Supplementary<ref type="figure" target="#fig_6">Fig. S3</ref>). This fact suggests that, as the median fold change method normalizes the data without specifically trying to remove the drift, there mayin the data. The three plots in the lower left show the effect of the time elapsed since the first sample was injected, whereas the plots in the top right refer to the batch of the sample. The numbers in the diagonal plots correspond to the variance captured by each PC. The order in the legend of the batches corresponds to the real injection order of the samples still be a source of variance in the data caused by the drift of the experimental device. On the other hand, because the methods based in the CPCA approach (CPCA and CPCA + median fold change methods) are developed to model the drift direction, their resultant datasets show less residual drift in their corresponding principal plane score plot (Supplementary Figs. S4 and S5 for the CPCA and the CPCA + median fold change methods, respectively). The methods have been characterised for different dataset sizes (10, 25, 33 and 50% of the dataset) through a random subsampling stage (taking 100 iterations per subsample). For each subset, we applied the proposed methodology to test the compensation effect given dataset size and to find an estimate on the variability of this effect. We computed the Silhouette index for each drift-correction method as described in Supplementary Section S1.<ref type="figure" target="#fig_7">Figure 4</ref><ref type="figure">Table  S1</ref>contains the values of the slopes, the standard errors and the P-values of the ANOVA tests for all the methods. Results show that the median fold change and the CC methods suffer from performance for large datasets. On the other hand, the ComBat method improves its correction as data availability increases. This last result is probably because of a better estimation of the batch components when having larger sample sizes. The Supplementary Table S1 also shows that the performance of the CPCA and CPCA + Medians methods is insensitive to the considered dataset size. This suggests that the mathematical approach taken, where the drift component is extracted from a multi-class QC variance analysis is more resilient to the sample size variations. Overall, in the context of LC/MS drift correction, the proposed two-step methodology shows better clustering properties of the QC samples for large metabolomic studies than the median fold change method. The method also shows a robust behaviour under small sample size conditions. Furthermore, unlike the median fold change method, the two-step method is able to capture intensity drifts that covariate with the retention time.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="4">CONCLUSIONS</head><p>Applying the combined method CPCA and the median fold change, results in a dataset that contains less drift effects than the dataset corrected solely by the median fold change, and the</p></div><figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_1"><head></head><figDesc>fold change The median fold change method is not focused on finding the drift direction. Its objective is to rescale the data to make the median fold changes of the variables close to zero. The methodology followed in applying this method is the one of Veselkov et al., based on a sample-wise approach (</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_2"><head></head><figDesc>Â p) contains the drift component in the data. To eliminate the drift from the data, the last step is to subtract this drift from the data [Equation (10)] Z CPCA =Y À Y CPCA d ð10Þ where Z CPCA (n Â p) is the corrected dataset using the CPCA method.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_3"><head>Fig.1.</head><figDesc>Fig. 1. Set of PCA Scoreplots showing the raw data and the effect on data for each method. The class labelled as sample is the study class. The numbers in brackets on the axes of the plots refer to the estimated variance for that particular direction in the data</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_4"><head>Fig.2.</head><figDesc>Fig. 2. PCA Scoreplot of all the classes in the data. The three plots in the lower left show the effect of the time elapsed since the first sample was injected, whereas the plots in the top right refer to the batch of the sample. The numbers in the diagonal plots correspond to the variance captured by each PC. The order in the legend of the batches corresponds to the real injection order of the samples</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_5"><head></head><figDesc>depicts the Silhouette values for all the methods and dataset sizes. The Figure shows that the CPCA + Medians method has the highest mean Silhouette values for all the tested values. To measure how the performance of the methods is modified as function of the dataset size, we have fitted a linear model using size as a cofactor and computed an ANalysis Of VAriance (ANOVA) test. Supplementary</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_6"><head>Fig.3.</head><figDesc>Fig. 3. CPCs loading values and mean chromatogram for the QC samples. The chromatogram is plotted in arbitrary units. The loadings of the CPCs correspond to the columns of the V matrix shown in Equation (8)</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_7"><head>Fig.4.</head><figDesc>Fig. 4. PCA Scoreplot of all the classes in the data. The three plots in the lower left show the effect of the time elapsed since the first sample was injected, whereas the plots in the top right refer to the batch of the sample. The numbers in the diagonal plots correspond to the variance captured by each PC</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" type="table" xml:id="tab_0" validated="true"><figDesc>Table 1. Dunn and Silhouette values for all the tested methods</figDesc><table>Method/index 
Dunn 
Silhouette 

None 
0.029 
0.560 
CPCA (1CPC) 
0.159 
0.749 
CPCA (2CPC) 
0.129 
0.725 
CPCA (3CPC) 
0.051 
0.680 
ComBat 
0.074 
0.553 
CC (1PC) 
0.182 
0.573 
CC (2PC) 
0.249 
0.600 
CC (3PC) 
0.209 
0.566 
Median fold change 
0.171 
0.719 
CPCA (1CPC) + Median 
0.208 
0.794 
CPCA (2CPC) + Median 
0.344 
0.690 
CPCA (3CPC) + Median 
0.101 
0.631 

Notes: The CPCA and CC methods were tested removing one, two and three com-
ponents (the number in brackets refers to the components subtracted from the data). 
The last three entries of the table correspond to sequentially using the CPCA with 
one CPC and then the median fold change method. The highest clustering indices 
are shown in bold. 

2902 

</table></figure>

			<note place="foot">at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from</note>

			<note place="foot">Reference: Urine sample belonging to the one volunteer (n = 38 samples). 2.2 Preprocessing All the methods were applied to the chromatograms without any prior feature detection. The R package XCMS was used to read the chromatograms of the mzXML files containing the sample data (Smith et al., 2006). The chromatograms were aligned using an in-house-developed R package (UB/UPC). The chromatographic data of all the files read were merged, creating an n Â m chromatogram matrix X. This step required the binning of the retention time in m bins that were given by the XCMS package. Therefore, the chromatogram matrix had samples as rows and retention time as columns (in our case, n = 1176 samples and m = 441 retention time points). Thus, the i-th row of this matrix corresponds to the chromatogram of the i-th sample. From here on, the variable j refers to the retention time bins in the chromatogram matrix. A class-wise outlier detection and removal procedure was applied to the QC classes. This procedure was based on computing the score distance (SD) and an orthogonal distance (OD) in a PCA model using the pcaPP R package (Filzmoser et al., 2013; Hubert et al., 2005). QC samples having SD and OD distances greater than the suggested critical values were considered to be outliers and were discarded from the dataset (Filzmoser and Fritz, 2007). The critical values used in the package were (i) a quantile of the chi-squared distribution for the SD and (ii) a Wilson–Hilferty approximation for the scaled chi-squared distribution for the OD (Filzmoser and Fritz, 2007; Hubert et al., 2005). Using this approach, nine outlier samples were detected (four samples in class reference, three in class water and two in class spikes). As it is known that raw LC/MS metabolomic data suffer from multiplicative noise, we took the logarithm of the data to compensate for such error sources and to convert them into additive noise sources (Veselkov et al., 2011). Once the o outliers were removed, we could then define the quantity p=n À o to be the new sample range. The resulting matrix Yðp Â mÞ was used as an input parameter for all the normalization methods tested. This matrix contains the data for both the QC classes and the study class, and it can be divided into matrices corresponding to each class (i.e. Y QC ðp QC Â mÞ for the corresponding dataset for all QC classes, Y r ðp r Â mÞ for the corresponding dataset for the reference class, etc.).</note>

			<note place="foot">Intensity drift removal in LC/MS metabolomics at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from</note>
		</body>
		<back>
			<div type="annex">
			</div>
			<div type="references">

				<listBibl>

<biblStruct   xml:id="b0">
	<analytic>
		<title level="a" type="main">Modern analytical techniques in metabolomics analysis</title>
		<author>
			<persName>
				<forename type="first">Z</forename>
				<surname>Aihua</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Analyst</title>
		<imprint>
			<biblScope unit="volume">137</biblScope>
			<biblScope unit="page" from="293" to="300" />
			<date type="published" when="2012" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b1">
	<analytic>
		<title level="a" type="main">Drift correction for gas sensors using multivariate methods</title>
		<author>
			<persName>
				<forename type="first">T</forename>
				<surname>Artursson</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">J. Chemom</title>
		<imprint>
			<biblScope unit="volume">14</biblScope>
			<biblScope unit="page" from="711" to="723" />
			<date type="published" when="2000" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b2">
	<analytic>
		<title level="a" type="main">clValid: an R package for cluster validation</title>
		<author>
			<persName>
				<forename type="first">G</forename>
				<surname>Brock</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">J. Stat. Softw</title>
		<imprint>
			<biblScope unit="volume">25</biblScope>
			<biblScope unit="page" from="1" to="22" />
			<date type="published" when="2008" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b3">
	<analytic>
		<title level="a" type="main">clValid: Validation of Clustering Results. R package version 0.6-4</title>
		<author>
			<persName>
				<forename type="first">G</forename>
				<surname>Brock</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Comprehensive R Archive Network (CRAN)</title>
		<imprint>
			<date type="published" when="2011" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b4">
	<analytic>
		<title level="a" type="main">Instrumental and experimental effects in LC-MS-based metabolomics</title>
		<author>
			<persName>
				<forename type="first">L</forename>
				<surname>Burton</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">J. Chromatogr. B Analyt. Technol. Biomed. Life Sci</title>
		<imprint>
			<biblScope unit="volume">871</biblScope>
			<biblScope unit="page" from="227" to="235" />
			<date type="published" when="2008" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b5">
	<analytic>
		<title level="a" type="main">Gene expression profile analysis of human intervertebral disc degeneration</title>
		<author>
			<persName>
				<forename type="first">K</forename>
				<surname>Chen</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Genet. Mol. Biol</title>
		<imprint>
			<biblScope unit="volume">36</biblScope>
			<biblScope unit="page" from="448" to="454" />
			<date type="published" when="2013" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b6">
	<analytic>
		<title level="a" type="main">A fuzzy relative of the ISODATA process and its use in detecting compact well-separated clusters</title>
		<author>
			<persName>
				<forename type="first">J</forename>
				<forename type="middle">C</forename>
				<surname>Dunn</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">J. Cybern</title>
		<imprint>
			<biblScope unit="volume">3</biblScope>
			<biblScope unit="page" from="32" to="57" />
			<date type="published" when="1973" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b7">
	<analytic>
		<title level="a" type="main">Procedures for large-scale metabolic profiling of serum and plasma using gas chromatography and liquid chromatography coupled to mass spectrometry</title>
		<author>
			<persName>
				<forename type="first">W</forename>
				<forename type="middle">B</forename>
				<surname>Dunn</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Nat. Protoc</title>
		<imprint>
			<biblScope unit="volume">6</biblScope>
			<biblScope unit="page" from="1060" to="1083" />
			<date type="published" when="2011" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b8">
	<analytic>
		<title level="a" type="main">Establishing reporting standards for metabolomic and metabonomic studies: a call for participation</title>
		<author>
			<persName>
				<forename type="first">O</forename>
				<surname>Fiehn</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">OMICS</title>
		<imprint>
			<biblScope unit="volume">10</biblScope>
			<biblScope unit="page" from="158" to="163" />
			<date type="published" when="2006" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b9">
	<analytic>
		<title level="a" type="main">Exploring high-dimensional data with robust principal components</title>
		<author>
			<persName>
				<forename type="first">P</forename>
				<surname>Filzmoser</surname>
			</persName>
		</author>
		<author>
			<persName>
				<forename type="first">H</forename>
				<surname>Fritz</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="m">Proceedings of the eight International Conference on Computer Data Analysis and Modeling</title>
		<editor>Aivazian,S. et al.</editor>
		<meeting>the eight International Conference on Computer Data Analysis and Modeling<address><addrLine>Minsk</addrLine></address></meeting>
		<imprint>
			<date type="published" when="2007" />
			<biblScope unit="page" from="18" to="22" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b10">
	<analytic>
		<title level="a" type="main">pcaPP: Robust PCA by Projection Pursuit. R package version 1.9-49</title>
		<author>
			<persName>
				<forename type="first">P</forename>
				<surname>Filzmoser</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Comprehensive R Archive Network (CRAN)</title>
		<imprint>
			<date type="published" when="2013" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b11">
	<analytic>
		<title level="a" type="main">Common principal components in K groups</title>
		<author>
			<persName>
				<forename type="first">B</forename>
				<forename type="middle">N</forename>
				<surname>Flury</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">J. Am. Stat. Assoc</title>
		<imprint>
			<biblScope unit="volume">79</biblScope>
			<biblScope unit="page" from="892" to="898" />
			<date type="published" when="1984" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b12">
	<analytic>
		<title level="a" type="main">ROBPCA: a new approach to robust principal component analysis</title>
		<author>
			<persName>
				<forename type="first">M</forename>
				<surname>Hubert</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Technometrics</title>
		<imprint>
			<biblScope unit="volume">47</biblScope>
			<biblScope unit="page" from="1" to="34" />
			<date type="published" when="2005" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b13">
	<analytic>
		<title level="a" type="main">Adjusting batch effects in microarray expression data using empirical Bayes methods</title>
		<author>
			<persName>
				<forename type="first">W</forename>
				<forename type="middle">E</forename>
				<surname>Johnson</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Biostatistics</title>
		<imprint>
			<biblScope unit="volume">8</biblScope>
			<biblScope unit="page" from="118" to="127" />
			<date type="published" when="2007" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b14">
	<analytic>
		<title level="a" type="main">The SVA package for removing batch effects and other unwanted variation in high-throughput experiments</title>
		<author>
			<persName>
				<forename type="first">J</forename>
				<forename type="middle">T</forename>
				<surname>Leek</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Bioinformatics</title>
		<imprint>
			<biblScope unit="volume">28</biblScope>
			<biblScope unit="page" from="882" to="883" />
			<date type="published" when="2012" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b15">
	<analytic>
		<title level="a" type="main">Naive pluripotency is associated with global DNA hypomethylation</title>
		<author>
			<persName>
				<forename type="first">H</forename>
				<forename type="middle">G</forename>
				<surname>Leitch</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Nat. Struct. Mol. Biol</title>
		<imprint>
			<biblScope unit="volume">20</biblScope>
			<biblScope unit="page" from="311" to="316" />
			<date type="published" when="2013" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b16">
	<analytic>
		<title level="a" type="main">An LC-MS-based metabolomics approach for exploring urinary metabolome modifications after cocoa consumption</title>
		<author>
			<persName>
				<forename type="first">R</forename>
				<surname>Llorach</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">J. Proteome Res</title>
		<imprint>
			<biblScope unit="volume">8</biblScope>
			<biblScope unit="page" from="5060" to="5068" />
			<date type="published" when="2009" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b17">
	<analytic>
		<title level="a" type="main">XCMS: processing mass spectrometry data for metabolite profiling using nonlinear peak alignment, matching, and identification</title>
		<author>
			<persName>
				<forename type="first">C</forename>
				<forename type="middle">A</forename>
				<surname>Smith</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Anal. Chem</title>
		<imprint>
			<biblScope unit="volume">78</biblScope>
			<biblScope unit="page" from="779" to="787" />
			<date type="published" when="2006" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b18">
	<analytic>
		<title level="a" type="main">Normalization method for metabolomics data using optimal selection of multiple internal standards</title>
		<author>
			<persName>
				<forename type="first">M</forename>
				<surname>Sysi-Aho</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">BMC Bioinformatics</title>
		<imprint>
			<biblScope unit="volume">8</biblScope>
			<biblScope unit="page">93</biblScope>
			<date type="published" when="2007" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b19">
	<analytic>
		<title level="a" type="main">Metabolomics unveils urinary changes in subjects with metabolic syndrome following 12-week nut consumption</title>
		<author>
			<persName>
				<forename type="first">S</forename>
				<surname>Tulipani</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">J. Proteome Res</title>
		<imprint>
			<biblScope unit="volume">10</biblScope>
			<biblScope unit="page" from="5047" to="5058" />
			<date type="published" when="2011" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b20">
	<analytic>
		<title level="a" type="main">Stepwise estimation of common principal components</title>
		<author>
			<persName>
				<forename type="first">N</forename>
				<forename type="middle">T</forename>
				<surname>Trendafilov</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Comput. Stat. Data Anal</title>
		<imprint>
			<biblScope unit="volume">54</biblScope>
			<biblScope unit="page" from="3446" to="3457" />
			<date type="published" when="2010" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b21">
	<analytic>
		<title level="a" type="main">Optimized preprocessing of ultra-performance liquid chromatography/mass spectrometry urinary metabolic profiles for improved information recovery</title>
		<author>
			<persName>
				<forename type="first">K</forename>
				<forename type="middle">A</forename>
				<surname>Veselkov</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Anal. Chem</title>
		<imprint>
			<biblScope unit="volume">83</biblScope>
			<biblScope unit="page" from="5864" to="5872" />
			<date type="published" when="2011" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b22">
	<analytic>
		<title level="a" type="main">Batch normalizer: a fast total abundance regression calibration method to simultaneously adjust batch and injection order effects in liquid chromatography/time-of-flight mass spectrometry-based metabolomics data and comparison with current calibration methods</title>
		<author>
			<persName>
				<forename type="first">S</forename>
				<forename type="middle">Y</forename>
				<surname>Wang</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Anal. Chem</title>
		<imprint>
			<biblScope unit="volume">85</biblScope>
			<biblScope unit="page" from="1037" to="1046" />
			<date type="published" when="2013" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b23">
	<analytic>
		<title level="a" type="main">LC-MS-based metabonomics analysis</title>
		<author>
			<persName>
				<forename type="first">L</forename>
				<surname>Xin</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">J. Chromatogr. B</title>
		<imprint>
			<biblScope unit="volume">866</biblScope>
			<biblScope unit="page" from="64" to="76" />
			<date type="published" when="2008" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b24">
	<analytic>
		<title level="a" type="main">Drift compensation of gas sensor array data by common principal component analysis</title>
		<author>
			<persName>
				<forename type="first">A</forename>
				<surname>Ziyatdinov</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Sens. Actuators B Chem</title>
		<imprint>
			<biblScope unit="volume">146</biblScope>
			<biblScope unit="page" from="460" to="465" />
			<date type="published" when="2010" />
		</imprint>
	</monogr>
</biblStruct>

				</listBibl>
			</div>
		</back>
	</text>
</TEI>