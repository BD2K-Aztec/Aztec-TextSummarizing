
<?xml version="1.0" encoding="UTF-8"?>
<TEI xmlns="http://www.tei-c.org/ns/1.0" 
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
xsi:schemaLocation="http://www.tei-c.org/ns/1.0 /home/joey/Project/grobid/grobid-home/schemas/xsd/Grobid.xsd"
 xmlns:xlink="http://www.w3.org/1999/xlink">
	<teiHeader xml:lang="en">
		<encodingDesc>
			<appInfo>
				<application version="0.4.2-SNAPSHOT" ident="GROBID" when="2017-08-10T23:58+0000">
					<ref target="https://github.com/kermitt2/grobid">GROBID - A machine learning software for extracting information from scholarly documents</ref>
				</application>
			</appInfo>
		</encodingDesc>
		<fileDesc>
			<titleStmt>
				<title level="a" type="main">BIOINFORMATICS APPLICATION NOTE Genome analysis Snakemake—a scalable bioinformatics workflow engine</title>
			</titleStmt>
			<publicationStmt>
				<publisher/>
				<availability status="unknown"><licence/></availability>
				<date type="published" when="2012">19 2012</date>
			</publicationStmt>
			<sourceDesc>
				<biblStruct>
					<analytic>
						<author>
							<persName>
								<forename type="first">Johannes</forename>
								<surname>Kö Ster</surname>
							</persName>
							<affiliation key="aff0">
								<orgName type="department" key="dep1">Genome Informatics</orgName>
								<orgName type="department" key="dep2">Institute of Human Genetics</orgName>
								<orgName type="institution">University of Duisburg-Essen</orgName>
							</affiliation>
						</author>
						<author>
							<persName>
								<forename type="first">Sven</forename>
								<surname>Rahmann</surname>
							</persName>
							<affiliation key="aff0">
								<orgName type="department" key="dep1">Genome Informatics</orgName>
								<orgName type="department" key="dep2">Institute of Human Genetics</orgName>
								<orgName type="institution">University of Duisburg-Essen</orgName>
							</affiliation>
						</author>
						<author>
							<persName>
								<forename type="first">Alfonso</forename>
								<surname>Valencia</surname>
							</persName>
							<affiliation key="aff1">
								<orgName type="department">Paediatric Oncology</orgName>
								<orgName type="institution">University Childrens Hospital</orgName>
								<address>
									<postCode>45147</postCode>
									<settlement>Essen</settlement>
									<country key="DE">Germany</country>
								</address>
							</affiliation>
						</author>
						<title level="a" type="main">BIOINFORMATICS APPLICATION NOTE Genome analysis Snakemake—a scalable bioinformatics workflow engine</title>
					</analytic>
					<monogr>
						<imprint>
							<biblScope unit="volume">28</biblScope>
							<biblScope unit="page" from="2520" to="2522"/>
							<date type="published" when="2012">19 2012</date>
						</imprint>
					</monogr>
					<idno type="DOI">10.1093/bioinformatics/bts480</idno>
					<note type="submission">Received on May 14, 2012; revised on June 28, 2012; accepted on July 28, 2012</note>
					<note>Associate Editor:</note>
				</biblStruct>
			</sourceDesc>
		</fileDesc>
		<profileDesc>
			<abstract>
				<p>Snakemake is a workflow engine that provides a readable Python-based workflow definition language and a powerful execution environment that scales from single-core workstations to compute clusters without modifying the workflow. It is the first system to support the use of automatically inferred multiple named wildcards (or variables) in input and output filenames. Availability: http://snakemake.</p>
			</abstract>
		</profileDesc>
	</teiHeader>
	<text xml:lang="en">
		<body>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="1">INTRODUCTION</head><p>Large-scale data analyses in bioinformatics involve the chained execution of many command line applications. Workflow engines help to automate these pipelines and ensure reproducibility. Systems such as Biopipe (<ref type="bibr" target="#b5">Hoon et al., 2003</ref>), Taverna (<ref type="bibr" target="#b10">Oinn et al., 2004</ref>), Galaxy (<ref type="bibr" target="#b1">Goecks et al., 2010</ref>), GeneProf (<ref type="bibr" target="#b4">Halbritter et al., 2011</ref>) or PegaSys (<ref type="bibr" target="#b12">Shah et al., 2004</ref>) are easy to learn and use through their graphical user interface. Others such as Ruffus (<ref type="bibr" target="#b3">Goodstadt, 2010</ref>), Pwrake (<ref type="bibr" target="#b14">Tanaka and Tatebe, 2010</ref>), GXP Make (<ref type="bibr" target="#b15">Taura et al., 2010</ref>) and Bpipe (<ref type="bibr" target="#b11">Sadedin et al., 2012</ref>) use text-based definition of workflows, which can be advantageous: workflows can be edited without a graphical environment (e.g. directly on a remote server); and developers can collaborate on them through source code management tools. Similar to Pwrake and GXP Make, Snakemake is inspired by the build system GNU Make (<ref type="bibr" target="#b13">Stallman and McGrath, 1991</ref>). They all infer the actual workflow (dependencies, parallelization) from a set of rules with input and output files. Snakemake complements these prior works with a syntax close to pseudocode, in the spirit of the Python language. Snakemake interoperates with any installed tool or available web service with well-defined input and output (file) formats. Although this approach lacks type checking of intermediate files, it does not require tight integration of tools into the workflow system, such as with PegaSys (<ref type="bibr" target="#b12">Shah et al., 2004</ref>), and thus is most flexible. Snakemake itself is fully portable, as only a Python installation is required to run Snakefiles. It provides automatic scalability because it optimizes the number of parallel processes w.r.t. provided CPU cores and needed threads and can make use of single machines as well as cluster engines without modifying the workflow. In contrast to Pwrake and GXP Make, Snakemake does not rely on any password-less SSH setup or custom server processes running on the cluster nodes. Finally, Snakemake is the first system to support file name inference with multiple named wildcards in rules.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="2">SNAKEMAKE LANGUAGE</head><p>A workflow is defined in a 'Snakefile' through a domain-specific language that is close to standard Python syntax. It consists of rules that denote how to create output files from input files. The workflow is implied by dependencies between the rules that arise from one rule needing an output file of another as an input file. A rule definition specifies (i) a name, (ii) any number of input and output files and (iii) either a shell command or Python code that creates the output from the input. Input and output files may contain multiple named wildcards, whose values are inferred automatically from the files desired by the user. Listing 1 shows an example Snakefile for mapping sequence reads to a reference genome, which is a typical task in, e.g. cancer genomics (<ref type="bibr" target="#b9">Meyerson et al., 2010</ref>): paired-end sequence reads are given as .fastq files for four samples named 100–103 and mapped to the human reference genome. Then, a histogram of the per-nucleotide coverage is generated. There are two variable definitions (here SAMPLES and REF) that may also be included from external files or environment variables and five rules that each start with the keyword rule followed by a name and the definitions of input and output files and shell commands or Python code. Although Python code can be directly integrated into the workflow definition, Snakemake is not limited to Python scripts: any available tool or service may be invoked in a shell-or run-block and its output further processed. The rule fastq_to_sai (l. 6–9) describes how to map the reads given the .fastq file and the reference. It uses two named wildcards, so it can be applied to the first and the second read of each read pair (wildcard {group}) from each sample (wildcard {sample}). If the rule is requested to create the file 100.1.sai, the wildcard {sample} becomes 100 and {group} becomes 1, so that the input file 100.1.fastq is expected. To resolve ambiguity, wildcards can be restricted to regular expressions (e.g. {group,<ref type="bibr">[12]</ref>} only allows a single character from the set {1,2}, while {group,\dþ} allows any number of numeric characters). Here, BWA (<ref type="bibr" target="#b7">Li and Durbin, 2009</ref>) is used for read mapping, which produces suffix array interval (.sai) files that must be converted to the common format .bam for aligned reads; this is done by the rule sai_to_ bam (l. 10–14). In the rule fastq_to_sai, input files are named (as ref and reads) and can be accessed as {input.ref} or {input.reads} in the shell block (l. 9).In the rule sai_to_bam, all input files are accessed at once through {input} (l. 14). BWAs internal.sai files can be deleted automatically once the .bam files are created, which are in turn worth to be write-protected to avoid accidental deletion. Snakemake supports this by marking files as temp (l. 8) and protected (l. 13). The rule remove_duplicates removes polymerase chain reaction-induced duplicate reads from the .bam files using the 'samtools' package (<ref type="bibr" target="#b7">Li et al., 2009</ref>). Finally, the rule plot_coverage creates a coverage histogram for each position of the reference using Python's 'matplotlib' (<ref type="bibr" target="#b6">Hunter, 2007</ref>). This rule illustrates how shell output from samtools is directly iterated over by Python code with Snakemake's built-in shell function in a run-block. When Snakemake is invoked without a specific target, the first rule (here the input-only rule all) is executed. It ensures that the coverage plot and hence all needed intermediate files are created for each sample. See http://snakemake.googlecode.com for further examples and detailed documentation.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="3">SNAKEMAKE ENGINE</head><p>Upon invocation, Snakemake creates a directed acyclic graph (DAG) that represents a plan of rule executions (<ref type="figure" target="#fig_1">Fig. 1</ref>). The nodes of the DAG are jobs (i.e. the execution of a rule), a directed edge between job A and B means that the rule underlying job B needs the output of job A as an input file. A path in the DAG represents a sequence of jobs that have to be executed serially. Importantly, two disjoint paths in the DAG can be executed independently from each other, i.e. in parallel. Since individual jobs can use multiple threads themselves, Snakemake can be instructed to solve a 0/1-knapsack problem to optimize the usage of CPUs, given a threshold of available cores. This mechanism allows to scale Snakemake to environments with a hard limit of used CPU cores, e.g. a shared compute server. Furthermore, using only as many threads as there are cores available can be beneficial for performance since it reduces the amount of context switching. By default, Snakemake only executes rules if the output files are not present or the modification time of the input files is newer. Together with the automatic deletion of output files from incomplete rule executions (e.g. due to a failing shell command), this enables Snakemake to avoid duplicate work when resuming workflows. To analyse the workflow, Snakemake provides options to perform a dry-run without actual execution of jobs, give the reason for each executed job and print the DAG to the graphviz.dot format (<ref type="bibr" target="#b0">Gansner and North, 2000</ref>) for visualization. Apart from running on single machines, Snakemake contains a generic mechanism that allows the execution of jobs on a batch system or a compute cluster engine that is only constrained by the availability of a submit command that handles shell scripts (e.g. qsub) and a shared file system accessible by all cluster nodes. Hence, a Snakefile scales from single-core workstations over multi-core servers to compute clusters of different architectures, without the need to modify the workflow.(5) for sample in SAMPLES</p><p>(6) rule fastq_to_sai:</p><p>(7) input: ref ¼ REF, reads ¼ "{sample}.{group}.fastq"</p><p>(8) output: temp("{sample}.{group}.sai")</p><formula>(9)</formula><p>shell: "bwa aln {input.ref} {input.reads} 4 {output}"</p><p>(10) rule sai_to_bam:</p><p>(11) input: REF, "{sample}.1.sai", "{sample}.2.sai",</p><p>(12) "{sample}.1.fastq", "{sample}.2.fastq"</p><p>(13) output: protected("{sample}.bam")</p><formula>(14)</formula><p>shell: "bwa sampe {input} j samtools view-Sbh-4{output}"</p><p>(15) rule remove_duplicates:</p><p>(16) input: "{sample}.bam"</p><p>(17) output: "{sample}.nodup.bam"</p><p>(18) shell: "samtools rmdup {input} {output}"</p><p>(19) rule plot_coverage_histogram:</p><p>(20) input: "{sample}.nodup.bam"</p><p>(21) output: hist ¼ "{sample}.coverage.pdf"</p><p>(22) run:</p><p>(23) from matplotlib.pyplot import hist, savefig</p><p>(24) hist(list(map(int,</p><p>(25) shell("samtools mpileup {input} j cut-f4",</p><formula>(26) iterable ¼ True))))</formula><p>(27) savefig(output.hist)</p></div><figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_0"><head>*</head><figDesc>To whom correspondence should be addressed.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_1"><head>Listing1.</head><figDesc>Example Snakefile for mapping paired-end reads with BWA.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_2"><head>Fig.1.</head><figDesc>Fig. 1. DAG of jobs for the example workflow</figDesc></figure>

			<note place="foot">ß The Author 2012. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from</note>

			<note place="foot">Snakemake at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from</note>

			<note place="foot">J.Kö ster and S.Rahmann at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from</note>
		</body>
		<back>

			<div type="acknowledgement">
<div xmlns="http://www.tei-c.org/ns/1.0"><head>ACKNOWLEDGEMENTS</head><p>The authors thank Tobias Marschall (CWI Amsterdam) and Marcel Martin (TU Dortmund) for their tremendously helpful testing work, feature requests and comments.</p></div>
			</div>

			<div type="annex">
			</div>
			<div type="references">

				<listBibl>

<biblStruct   xml:id="b0">
	<analytic>
		<title level="a" type="main">An open graph visualization system and its applications to software engineering</title>
		<author>
			<persName>
				<forename type="first">E</forename>
				<forename type="middle">R</forename>
				<surname>Gansner</surname>
			</persName>
		</author>
		<author>
			<persName>
				<forename type="first">S</forename>
				<forename type="middle">C</forename>
				<surname>North</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Software Pract Exper</title>
		<imprint>
			<biblScope unit="volume">30</biblScope>
			<biblScope unit="page" from="1203" to="1233" />
			<date type="published" when="2000" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b1">
	<monogr>
		<title level="m" type="main">Galaxy: a comprehensive approach for supporting accessible, reproducible, and transparent computational research in the life sciences</title>
		<author>
			<persName>
				<forename type="first">J</forename>
				<surname>Goecks</surname>
			</persName>
		</author>
		<imprint>
			<date type="published" when="2010" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b2">
	<analytic>
		<title/>
	</analytic>
	<monogr>
		<title level="j">Genome Biol</title>
		<imprint>
			<biblScope unit="volume">11</biblScope>
			<biblScope unit="page">86</biblScope>
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b3">
	<analytic>
		<title level="a" type="main">Ruffus: a lightweight Python library for computational pipelines</title>
		<author>
			<persName>
				<forename type="first">L</forename>
				<surname>Goodstadt</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Bioinformatics</title>
		<imprint>
			<biblScope unit="volume">26</biblScope>
			<biblScope unit="page" from="2778" to="2779" />
			<date type="published" when="2010" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b4">
	<analytic>
		<title level="a" type="main">GeneProf: analysis of high-throughput sequencing experiments</title>
		<author>
			<persName>
				<forename type="first">F</forename>
				<surname>Halbritter</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Nat. Methods</title>
		<imprint>
			<biblScope unit="volume">9</biblScope>
			<biblScope unit="page" from="7" to="8" />
			<date type="published" when="2011" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b5">
	<analytic>
		<title level="a" type="main">Biopipe: a flexible framework for protocol-based bioinformatics analysis</title>
		<author>
			<persName>
				<forename type="first">S</forename>
				<surname>Hoon</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Genome Res</title>
		<imprint>
			<biblScope unit="volume">13</biblScope>
			<biblScope unit="page" from="1904" to="1915" />
			<date type="published" when="2003" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b6">
	<analytic>
		<title level="a" type="main">Matplotlib: a 2D graphics environment</title>
		<author>
			<persName>
				<forename type="first">J</forename>
				<surname>Hunter</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Comput. Sci. Eng</title>
		<imprint>
			<biblScope unit="volume">9</biblScope>
			<biblScope unit="page" from="90" to="95" />
			<date type="published" when="2007" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b7">
	<analytic>
		<title level="a" type="main">Fast and accurate short read alignment with Burrows– Wheeler transform</title>
		<author>
			<persName>
				<forename type="first">H</forename>
				<surname>Li</surname>
			</persName>
		</author>
		<author>
			<persName>
				<forename type="first">R</forename>
				<surname>Durbin</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Bioinformatics</title>
		<imprint>
			<biblScope unit="volume">25</biblScope>
			<biblScope unit="page" from="1754" to="1760" />
			<date type="published" when="2009" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b8">
	<analytic>
		<title level="a" type="main">The sequence Alignment/Map format and SAMtools</title>
		<author>
			<persName>
				<forename type="first">H</forename>
				<surname>Li</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Bioinformatics</title>
		<imprint>
			<biblScope unit="volume">25</biblScope>
			<biblScope unit="page" from="2078" to="2079" />
			<date type="published" when="2009" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b9">
	<analytic>
		<title level="a" type="main">Advances in understanding cancer genomes through second-generation sequencing</title>
		<author>
			<persName>
				<forename type="first">M</forename>
				<surname>Meyerson</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Nat. Rev. Genet</title>
		<imprint>
			<biblScope unit="volume">11</biblScope>
			<biblScope unit="page" from="685" to="696" />
			<date type="published" when="2010" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b10">
	<analytic>
		<title level="a" type="main">Taverna: a tool for the composition and enactment of bioinformatics workflows</title>
		<author>
			<persName>
				<forename type="first">T</forename>
				<surname>Oinn</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Bioinformatics</title>
		<imprint>
			<biblScope unit="volume">20</biblScope>
			<biblScope unit="page" from="3045" to="3054" />
			<date type="published" when="2004" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b11">
	<analytic>
		<title level="a" type="main">Bpipe: a tool for running and managing bioinformatics pipelines</title>
		<author>
			<persName>
				<forename type="first">S</forename>
				<forename type="middle">P</forename>
				<surname>Sadedin</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Bioinformatics</title>
		<imprint>
			<biblScope unit="volume">28</biblScope>
			<biblScope unit="page" from="1525" to="1526" />
			<date type="published" when="2012" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b12">
	<analytic>
		<title level="a" type="main">Pegasys: software for executing and integrating analyses of biological sequences</title>
		<author>
			<persName>
				<forename type="first">S</forename>
				<forename type="middle">P</forename>
				<surname>Shah</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">BMC Bioinformatics</title>
		<imprint>
			<biblScope unit="volume">5</biblScope>
			<biblScope unit="page">40</biblScope>
			<date type="published" when="2004" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b13">
	<monogr>
		<title level="m" type="main">GNU Make—A Program for Directing Recompilation</title>
		<author>
			<persName>
				<forename type="first">R</forename>
				<forename type="middle">M</forename>
				<surname>Stallman</surname>
			</persName>
		</author>
		<author>
			<persName>
				<forename type="first">R</forename>
				<surname>Mcgrath</surname>
			</persName>
		</author>
		<imprint>
			<date type="published" when="1991" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b14">
	<analytic>
		<title level="a" type="main">Pwrake: a parallel and distributed flexible workflow management tool for wide-area data intensive computing</title>
		<author>
			<persName>
				<forename type="first">M</forename>
				<surname>Tanaka</surname>
			</persName>
		</author>
		<author>
			<persName>
				<forename type="first">O</forename>
				<surname>Tatebe</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="m">HPDC&apos;10</title>
		<imprint>
			<date type="published" when="2010" />
			<biblScope unit="page" from="356" to="359" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b15">
	<analytic>
		<title level="a" type="main">Design and Implementation of {GXP} Make – A Workflow System Based on Make</title>
		<author>
			<persName>
				<forename type="first">K</forename>
				<surname>Taura</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="m">IEEE International Conference on eScience</title>
		<meeting><address><addrLine>Los Alamitos, CA, USA</addrLine></address></meeting>
		<imprint>
			<publisher>IEEE Computer Society</publisher>
			<date type="published" when="2010" />
			<biblScope unit="page" from="214" to="221" />
		</imprint>
	</monogr>
</biblStruct>

				</listBibl>
			</div>
		</back>
	</text>
</TEI>