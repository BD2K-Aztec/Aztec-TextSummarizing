
<?xml version="1.0" encoding="UTF-8"?>
<TEI xmlns="http://www.tei-c.org/ns/1.0" 
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
xsi:schemaLocation="http://www.tei-c.org/ns/1.0 /home/joey/Project/grobid/grobid-home/schemas/xsd/Grobid.xsd"
 xmlns:xlink="http://www.w3.org/1999/xlink">
	<teiHeader xml:lang="en">
		<encodingDesc>
			<appInfo>
				<application version="0.4.2-SNAPSHOT" ident="GROBID" when="2017-08-10T23:38+0000">
					<ref target="https://github.com/kermitt2/grobid">GROBID - A machine learning software for extracting information from scholarly documents</ref>
				</application>
			</appInfo>
		</encodingDesc>
		<fileDesc>
			<titleStmt>
				<title level="a" type="main">Data and text mining A principal skeleton algorithm for standardizing confocal images of fruit fly nervous systems</title>
			</titleStmt>
			<publicationStmt>
				<publisher/>
				<availability status="unknown"><licence/></availability>
				<date type="published" when="2010">2010</date>
			</publicationStmt>
			<sourceDesc>
				<biblStruct>
					<analytic>
						<author>
							<persName>
								<forename type="first">Lei</forename>
								<surname>Qu</surname>
							</persName>
							<affiliation key="aff0">
								<orgName type="department">Janelia Farm Research Campus</orgName>
								<orgName type="institution">Howard Hughes Medical Institute</orgName>
								<address>
									<postCode>20147</postCode>
									<settlement>Ashburn</settlement>
									<region>VA</region>
									<country key="US">USA</country>
								</address>
							</affiliation>
						</author>
						<author>
							<persName>
								<forename type="first">Hanchuan</forename>
								<surname>Peng</surname>
							</persName>
							<affiliation key="aff0">
								<orgName type="department">Janelia Farm Research Campus</orgName>
								<orgName type="institution">Howard Hughes Medical Institute</orgName>
								<address>
									<postCode>20147</postCode>
									<settlement>Ashburn</settlement>
									<region>VA</region>
									<country key="US">USA</country>
								</address>
							</affiliation>
						</author>
						<author>
							<persName>
								<forename type="first">Alex</forename>
								<surname>Bateman</surname>
							</persName>
							<affiliation key="aff0">
								<orgName type="department">Janelia Farm Research Campus</orgName>
								<orgName type="institution">Howard Hughes Medical Institute</orgName>
								<address>
									<postCode>20147</postCode>
									<settlement>Ashburn</settlement>
									<region>VA</region>
									<country key="US">USA</country>
								</address>
							</affiliation>
						</author>
						<title level="a" type="main">Data and text mining A principal skeleton algorithm for standardizing confocal images of fruit fly nervous systems</title>
					</analytic>
					<monogr>
						<imprint>
							<biblScope unit="volume">26</biblScope>
							<biblScope unit="issue">8</biblScope>
							<biblScope unit="page" from="1091" to="1097"/>
							<date type="published" when="2010">2010</date>
						</imprint>
					</monogr>
					<idno type="DOI">10.1093/bioinformatics/btq072</idno>
					<note>[11:14 25/3/2010 Bioinformatics-btq072.tex] BIOINFORMATICS ORIGINAL PAPER Associate Editor: Contact: pengh@janelia.hhmi.org Supplementary information: Supplementary data are available at Bioinformatics online. * To whom correspondence should be addressed. † The authors wish it to be known that, in their opinion, the first two authors should be regarded as joint First Authors.</note>
				</biblStruct>
			</sourceDesc>
		</fileDesc>
		<profileDesc>
			<abstract>
				<p>Motivation: The fruit fly (Drosophila melanogaster) is a commonly used model organism in biology. We are currently building a 3D digital atlas of the fruit fly larval nervous system (LNS) based on a large collection of fly larva GAL4 lines, each of which targets a subset of neurons. To achieve such a goal, we need to automatically align a number of high-resolution confocal image stacks of these GAL4 lines. One commonly employed strategy in image pattern registration is to first globally align images using an affine transform, followed by local non-linear warping. Unfortunately, the spatially articulated and often twisted LNS makes it difficult to globally align the images directly using the affine method. In a parallel project to build a 3D digital map of the adult fly ventral nerve cord (VNC), we are confronted with a similar problem. Results: We proposed to standardize a larval image by best aligning its principal skeleton (PS), and thus used this method as an alternative of the usually considered affine alignment. The PS of a shape was defined as a series of connected polylines that spans the entire shape as broadly as possible, but with the shortest overall length. We developed an automatic PS detection algorithm to robustly detect the PS from an image. Then for a pair of larval images, we designed an automatic image registration method to align their PSs and the entire images simultaneously. Our experimental results on both simulated images and real datasets showed that our method does not only produce satisfactory results for real confocal larval images, but also perform robustly and consistently when there is a lot of noise in the data. We also applied this method successfully to confocal images of some other patterns such as the adult fruit fly VNC and center brain, which have more complicated PS. This demonstrates the flexibility and extensibility of our method. Availability: The supplementary movies, full size figures, test data, software, and tutorial on the software can be downloaded freely from our website http://penglab.janelia.org/proj/principal_skeleton</p>
			</abstract>
		</profileDesc>
	</teiHeader>
	<text xml:lang="en">
		<body>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="1">INTRODUCTION</head><p>The fruit fly (Drosophila melanogaster) is one of most studied model organisms in biology. It is currently widely used to understand how a real nervous system works. A systems biology approach that we are taking to study the fruit fly brain is to produce 3D digital atlases of this animal's nervous system at various developmental time points, including adult, larval and embryonic stages. We have been taking advantage of an on-going effort to generate a collection of 8000 enhancer-trap GAL4 lines that would have their neuronal patterns cover the entire set of neurons in the fruit fly nervous system (<ref type="bibr" target="#b12">Pfeiffer et al., 2008</ref>). High-resolution 3D confocal images of these GAL4 lines were produced. The scale of the problem is large, in terms of both the large size of each 3D confocal image (hundreds of megabytes to multi-gigabytes each) and the large number of the images in the database (two to five times the number of GAL4 lines, as multiple flies of the same GAL4 line need to be imaged). Therefore, an informatics challenge is how to map the neuronal patterns onto a 'standard' brain in an accurate, reliable and automatic way. A brain mapping study needs several enabling techniques, including 3D image registration (alignment), neurite tracing, neuronal pattern classification, visualization and mining methods (). It is often critical to align image patterns that have various orientations, sizes, shape deformations and intensity changes. A classic routine for 3D image pattern registration is to first align patterns globally, followed by a local alignment to transform one pattern to the other (<ref type="bibr" target="#b13">Rueckert et al., 1999;</ref><ref type="bibr" target="#b15">Toga, 1999</ref>). For a pair of image patterns, the purpose of the global alignment is to standardize the patterns as a whole so that they possess similar scales, positions and directions. The affine transformation is commonly used for global alignment. Once two patterns have been roughly aligned globally, it is much easier to use the more sophisticated local alignment (e.g.<ref type="bibr" target="#b13">Rueckert et al., 1999;</ref><ref type="bibr" target="#b14">Sorzano et al., 2005</ref>), which is often non-linear and deformable, to register the patterns precisely. The affine alignment was already successfully used in recent efforts to build digitized atlases for model animals, such as the Allen mouse brain atlas (<ref type="bibr" target="#b6">Lein et al., 2007</ref>), the adult fruit fly brain atlas (unpublished work of Peng lab) and the singlenucleus resolution atlas of the nematode Caenorhabditis elegans (<ref type="bibr" target="#b7">Long et al., 2009</ref>). However, for the alignment problem of the fruit fly larval nervous system (LNS) in this article, we found that the global affine alignment can hardly be used. As shown in<ref type="figure">Figure 1a</ref>, in the LNS the two brain hemispheres and the ventral nerve cord (VNC) form an articulated structure, which is flexible and often skews toward one side. This deformation cannot be described using global<ref type="bibr">[</ref>rotation, translation, scaling and shear as used in the affine transform.<ref type="figure">Figure 1c</ref>, which is an example of the adult VNC, displays a similar deformation of the shape. Therefore, we need a more sophisticated global alignment method to standardize the shape of these patterns, before we can proceed further to the local alignment. Intuitively, we considered aligning the 'backbone', or 'mid-line', of a curved fruit fly LNS or an adult VNC (red skeletons in<ref type="figure">Fig. 1</ref>). A related study was to straighten the strongly curved body of C.elegans () by first detecting the curved anterior– posterior axis of a worm, and then restacking the resampled image data on the entire series of 1-pixel spacing cutting-planes orthogonal to such a detected 'backbone'. This earlier method is very efficient for C.elegans confocal images and other similar cases where the backbone is a simple smooth curve, and the body of the pattern is not fat (wide) enough so that the slightly non-parallel cutting planes next to each other will not intersect within the pattern. Unfortunately, this method cannot be directly used in standardizing a fruit fly larval pattern because the articulated pattern cannot be described as a simple curve, and the fruit fly patterns are often fat/wide enough so that restacking the cutting planes may introduce artifacts especially in the articulated image regions. There are several other skeleton extraction methods (<ref type="bibr" target="#b2">Brandt et al., 1992;</ref><ref type="bibr" target="#b3">Chuang et al., 2004;</ref><ref type="bibr" target="#b5">Lam et al., 1992;</ref><ref type="bibr" target="#b8">Malandain et al., 1998</ref>). However, they cannot easily produce skeletons of the same topological structure for different input images, and thus will not be very useful for the registration. Therefore, in this work we proposed a new approach to standardize the confocal images of fruit fly LNS and adult VNC. We detected the principal skeleton (PS) of a shape using an automatic skeleton deformation algorithm (Section 2). Then we designed a smooth warping method to best align the PS of a pair of image patterns (Section 3). Our method introduces a minimum amount of degradation of the image quality during the standardization. It is also robust under a variety of conditions. In addition, our method is general. It is not limited to fly larval patterns; indeed it can be applied to any image patterns that have a reasonable PS 1 (Section 4).</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="2">DETECTING PS</head><p>Intuitively, the PS of a shape can be understood as its 'backbone', which describes the basic structure as well as the major deformation of this shape. In this article, we define the PS as a set of connected polylines that spans the entire shape as broadly as possible and at the same time has the shortest overall length and sufficient smoothness. We call each polyline a segment. Each segment consists of multiple ordered control points. Let us use the LNS (<ref type="figure">Fig. 1a</ref>) as an example. We view the nervous system as an articulated composition of three main parts: VNC, and left and right brain hemispheres. Despite the complexity in the articulation region, the deformation within each part can be approximated using a gentler curve. We define the PS of the LNS as a structure with six segments, including three branching segments, which represent the VNC, and left and right hemispheres, joined to another three segments of a triangle that models the 'hole' where the non-neuronal tissues (gut and heart) pass through the articulation area. Naturally, the PS can be viewed as a conceptual extension of the simple 'backbone' curve of a C.elegans body (), which is essentially the principal curve (<ref type="bibr">Hastie, 1994</ref>) of a distribution of image pixels. However, the PS is more than a simple collection of multiple principal curves due to the connection of segments. In addition, instead of using a smooth curve to model each skeleton segment, without loss of generality, we model them by polylines. The control points in a polyline can be further used to fit a smooth cubic-spline curve (<ref type="bibr" target="#b0">Bartels et al., 1998</ref>), similar to the C.elegans case. Similar to the case of LNS, the PS of a fruit fly adult VNC can be defined as an ¥-shape (<ref type="figure">Fig. 1c</ref>). The same algorithm is used to find the PSs for both cases. Throughout this article, we focus on LNS; experimental results on adult VNC and some other cases will be presented at the end of this article, and the corresponding movies can be found in the Supplementary Material.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="2.1">Shape prior of larval PS</head><p>The shape prior defines the initial PS including its topology and constraints of its segments and control points. It should be as simple as possible but complicated enough to capture the major topology of the shape. During the optimization, which is described below, the topology of a PS remains unchanged; however, the locations of all segment-control points will be iteratively updated. The shape prior of LNS is defined in<ref type="figure" target="#fig_0">Figure 2</ref>.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head>It contains totally</head><p>Page: 1093 1091–1097these six segments.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head>Principal skeleton algorithm</head><formula>⎧ ⎪ ⎪ ⎪ ⎪ ⎪ ⎪ ⎨ ⎪ ⎪ ⎪ ⎪ ⎪ ⎪ ⎩ B 1 ={c 1 ,c 2 ,c 3 } B 2 ={c 4 ,c 5 ,c 6 } B 3 ={c 7 ,c 8 ,c 9 ,c 10 ,c 11 } B 4 ={c 3 ,c 4 } B 5 ={c 3 ,c 7 } B 6 ={c 4 ,c 7 } (1)</formula><p>We minimize the length of each segment. Sometimes we may need to minimize the overall length of multiple segments, which indeed has a similar effect to maximizing the total smoothness of these segments when their length is short enough. For example, for the LNS, we would like to produce a very smooth skeleton for the junction area of the two brain hemispheres, which contains three segments B 1 , B 4 and B 2. This is similar to forcing B 1 , B 4 and B 2 to line up in an almost straight line; thus, their total length is as short as possible. To attain this goal, in Equation (2) we define four optimization 'domains' D 1 , ..., D 4 , each of which is a polyline and may cover multiple segments (e.g.</p><formula>D 1 ). ⎧ ⎪ ⎪ ⎨ ⎪ ⎪ ⎩ D 1 = B 1 ∪B 4 ∪B 2 ={c 1 ,c 2 ,c 3 ,c 4 ,c 5 ,c 6 } D 2 = B 3 ={c 7 ,c 8 ,c 9 ,c 10 ,c 11 } D 3 = B 5 ={c 3 ,c 7 } D 4 = B 6 ={c 4 ,c 7 }</formula><p>(2)</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="2.2">Energy minimizing deformable PS model</head><p>We design a deformable model to detect the PS, given its shape prior. We formulate an energy function consisting of an external energy term and an internal energy term. The external term is based on the image information, thus also called the 'image term', to force the PS spanning as broadly as possible to cover an entire LNS. The internal term is based on the topology and constraints of skeleton domains; this term is minimized to guarantee the least total length and maximum smoothness of the skeleton. Let p denote an image pixel, W the image area and the set of all control points of skeleton. The Voronoi region (c i ) of the control point c i is defined as the set of pixels in W that are closer to c i than to any other control points:</p><formula>(c i ) = p ∈ W :∀c j ∈ ,c i −p c j −p (3)</formula><p>We define the external term E external as:</p><formula>E external = c i ∈ c i −O (c i ) 2 ,</formula><formula>(4)</formula><p>where O() denotes the center of mass of a Voronoi region. We define the internal energy term by aggregating all optimization domains defined in Equation (2). Since there are only a few control points in each domain (e.g. five in D 2 and six in D 1 ), minimizing their length has a comparable effect to smoothing. For simplicity, we only aggregate the length energy of each domain in the internal</p><formula>term. Let U = {D 1 , D 2 , D 3 , D 4 }</formula><p>be the set of domain, we have:</p><formula>E internal = 1 D k ∈U w(D k ) D k ∈U w(D k )E length (D k ),</formula><formula>(5)</formula><p>where</p><formula>E length (D) = |D|−1 n=1 D[n]−D[n+1] 2 ,</formula><formula>(6)</formula><p>where D<ref type="bibr">[n]</ref>is the n-th element (control point) in domain D. The overall energy E takes the form:</p><formula>E = αE external +βE internal ,</formula><formula>(7)</formula><p>where α and β are two positive coefficients (both equal 0.5 in our experiments). To minimize Equation (7), we solve the following equation for every c i , i = 1, ... ,11: ∂E</p><formula>∂c i = α ∂E external ∂c i +β ∂E internal ∂c i = 0.</formula><formula>(8)</formula><p>It is easy to derive an iterative optimization method from Equation (8) to estimate the new location of each non-tip control point, c t+1 i , based on the Voronoi region's center of mass of its current position c t i , and the positions of its connected neighbor control points:</p><formula>c t+1 i = αO((c t i ))+β 1 N(c t i ) D k ∈U,c t i ∈D k w(D k ) c j ∈P(D k ,c t i ) c t j α+β 1 N(c t i ) D k ∈U,c t i ∈D k w(D k ) P(D k ,c t i ) , (9) where N(c i ) = D k ∈U,c i ∈D k w(D k ) and P(D,c i )</formula><p>denotes the set of neighboring control points of c i in domain D (in our case, since each domain is a polyline, this set includes both the left and right control points of</p><formula>c i ). Note that P(D,c i ) is null if c i / ∈ D.</formula><p>For the end points of the PS, i.e. c 1 , c 6 and c 11 , we use an empirically more robust formula based on two respective neighboring control points. Let us use c 1 as an example, the simplified formula is:</p><formula>c t+1 1 = αO((c t 1 ))+β(2c t 2 −c t 3 ) α+β (10)</formula><p>Other end points can be updated similarly. Normally, the algorithm converges within 100 loops.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head>Page: 1094 1091–1097</head></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head>L.Qu and H.Peng</head><p>(a) ( b)We have implemented the PS detection method as a plugin of the V3D software (http://penglab.janelia.org/proj/v3d;<ref type="bibr" target="#b11">Peng et al., 2010</ref>). We provide a tutorial in the Supplementary Material on how to use the program.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="3">ALIGNING PSS</head><p>Since the PS of a fly LNS has a more complicated topology than the simple curved 'backbone' of nematode C.elegans, we cannot simply reuse the cutting-plane restacking strategy in the earlier work () to standardize an LNS image. Instead, we generate a smooth displacement field (DF) to warp the fly larvae from one to another, based on their PS information. There are three general requirements of a DF.</p><p>(i) No singularity. Thus, the DF should be smooth everywhere. (ii) There should be a minimum amount of distortion to geometrically warp the PS, as well as the entire LNS. (iii) The algorithm should be extensible to other PSs; at the same time, when a PS consists of only one segment, the standardization should approximate the cutting-plane restacking method. We produce a DF using thin plate spline (TPS;<ref type="bibr" target="#b1">Bookstein, 1989</ref>), which is defined as the least-bending smooth surface spanning a set of anchor points. Thus, the requirements (i) and (ii) are met naturally. For requirement (iii), we first consider all control points of the PS as TPS anchor points. Then, we use cubic spline to find a smooth curve through each domain of the PS (as shown in<ref type="figure" target="#fig_1">Fig. 3a</ref>), and then for every consecutive pair of control points, we add the halfway point on the smooth curve as a TPS anchor point. We call the set of anchor points that consists of nicely spaced points on the PS as the PSset. Next, we define additional anchor points based on this PS-set: for each PS-set anchor point, we compute the orthogonal cutting line that intersects at this anchor point location with the respective smooth curve in the PS, and then we define two anchor points on each of the left and right sides of the cutting line (spacing = 75 pixels for LNS). We call the set of anchor points that are not on the PS as the non-PS-set. If a non-PS-set anchor point falls into the intersection region of multiple cutting lines of different domains (as highlighted in<ref type="figure" target="#fig_1">Fig. 3a</ref>), we remove it from the set of the all anchor points, and thus avoid the non-smooth wrapping around of the DF. While the choices of the number of anchor points of both PSset and non-PS-set, as well as the spacing among anchoring points, are empirical, a general guideline is to make the anchoring points distribute evenly to cover the entire image pattern. The selected parameters are then used for all images. The entire algorithm for LNS standardization is as follows:</p><p>(1) Define/initialize the shape prior of PS.</p><p>(2) Find the Voronoi region of each control point in an input image (called 'subject' image below for simplicity).</p><p>(3) Update the positions of control points using Equations (9) and (10).</p><p>(4) Check whether or not the positions of control points have converged (i.e. the maximal distance between the new and old positions of control points is &lt;0.01). If yes, go to Step 5. Otherwise go back to Step 2.</p><p>(5) Use cubic spline to interpolate PS and produce a smooth skeleton according to the defined domains.</p><p>(6) Define both the PS-set and non-PS-set of TPS anchor points, remove some non-PS-set points if they fall into the cutting line overlapping/intersection region.</p><p>(7) Compute the TPS DF of this image using the corresponding anchor points between this image and a predefined target image.</p><p>(8) Warp the subject image to a 'standard' shape using the DF.Our standardization method is general; it can be applied to both 2D and 3D image patterns. For fruit fly LNS, although our image stacks are 3D, the major variation of the shape is in the 2D plane of two brain hemispheres and the VNC. Therefore, we simplify the processing using 2D maximum intensity projection, and detect the PS in 2D. Accordingly, the TPS DF is produced in 2D; all z-sections of a fly LNS image stack will share the same DF. Of note, in our algorithm it is necessary to consider Step 9, i.e. the iterative alignment of a PS. Because TPS warping is non-linear and will cause some regions expand or shrink smoothly, the redetected PS of a warped image is slightly different from that of target image. Several iterations of the optimization will produce nicely aligned image patterns whose PSs match well. Normally, it takes about three loops to generate satisfactorily aligned PSs (Section 4.4).</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="4">EXPERIMENTS AND DISCUSSION</head><p>We first evaluated the robustness and consistency of the PS detection algorithm, and then compared our method with the commonly used morphological thinning and affine-transform-based alignment method. In the end, we show some PS detection results of other cases. For the fruit fly larva data, N-cadherin-labeled LNS was imaged in 3D using a confocal laser scanning microscope (Zeiss LSM 510) in the laboratory of J. Truman. The voxel resolution is 0.46 × 0.46×2.0µm. For the adult fly VNC data, NC-labeled VNC was imaged using a confocal microscope (Zeiss LSM Pascal 5) in J. Simpson's laboratory. The voxel resolution is 0.58 × 0.58 × 0.8µm in 3D.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head>Page: 1095 1091–1097</head></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head>Principal skeleton algorithm</head><formula>(a) (b)</formula></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="4.1">Robustness</head><p>We tested the robustness of detecting the PS when the LNS patterns in images have different orientations, scales, contrasts, articulated and twisted parts, as well as other noises.<ref type="figure" target="#fig_3">Figure 4a</ref>shows robustness test results for the twisted LNS. We simulated the deformation by rotating the right brain hemisphere from −45 @BULLET to 45 @BULLET , with a 15 @BULLET interval, to produce seven rows from top to bottom. For every row, we rotated the VNC from −45 @BULLET to 45 @BULLET similarly to produce seven columns. The detected PSs (red) from the same initialization (green) are correct, indicating that our method is robust for twisted patterns. We further added noise to the test images and changed the scale of the initialization. The results (Supplementary Material) were also robust.<ref type="figure" target="#fig_3">Figure 4b</ref>shows a perturbation test based on real LNS images. We randomly selected four LNS images that have differently twisted nervous systems. Similarly to<ref type="figure" target="#fig_3">Figure 4a</ref>, we rotated them with different angles (−45 @BULLET , −30 @BULLET , −15 @BULLET , 0 @BULLET , 15 @BULLET , 30 @BULLET and 45 @BULLET ). FromThe images 1–4 correspond to the middle column of<ref type="figure" target="#fig_3">Figure 4b</ref>. exactly the same initialization (green), our algorithm successfully detected the PSs (red), except two errors in the left-bottom corner and in the last column of the third row, which correspond to −45 @BULLET and +45 @BULLET rotations, respectively. The errors occurred when the angle between the longest axis (along the brain-VNC direction) of an LNS and the initialization of the PS is bigger than 45 @BULLET , the VNC part of the larva would more likely be interpreted as B 1 or B 2 rather than B 3 according to the shape prior we assumed in Section 2. In other words, the PS was initialized too poorly. However, practically speaking, this situation is rare in the real data. We can also avoid it completely by preprocessing an image so that its longest axis is roughly aligned with the B 3 segment. We also changed the contrast of the test images and found that our method robustly produced meaningful results (Supplementary Material).</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="4.2">Consistency</head><p>We quantified the consistency of PS detection given different initializations. For four LNS images, we rotated the respective initial shape prior of the PS in the range of ±30 @BULLET (interval = 15 @BULLET ). For any pair of the five PSs detected for each image, we computed the mean square error (MSE) of the corresponding control points of this pair of skeletons.<ref type="figure" target="#tab_1">Table 1</ref>shows the maximal and average MSE scores for all possible pairs. The MSE scores are much &lt;1 pixel, indicating that PSs were detected very consistently from different initializations.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="4.3">Comparison with morphology thinning</head><p>Morphology thinning (<ref type="bibr" target="#b5">Lam et al., 1992</ref>) is a commonly used algorithm to extract the 'backbone'of an image object that has closed contour. In order to use thinning, one needs to first segment the object from the image background. Unfortunately, the thinning algorithm is very sensitive to the segmentation. As shown in<ref type="figure">Figure 5a</ref>, direct thinning on a binary image generated too many artificial branches due to spurs in the contour of the object and unstained areas (holes). Here, we simply took the foreground as the set of the pixels whose intensity was above the mean value of all pixels in the image. After we carefully smoothed the contour and filled the holes using additional morphological opening and closing operations (with morphological element set to be 'disk' shape, with 10 and 20 pixels in diameter, respectively), we achieved better thinning results in<ref type="figure">Figure 5b</ref>and c, which however were still not as good as the detected PS in<ref type="figure">Figure 5d</ref>.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="4.4">Standardization of real LNS images</head><p>As a real application, we used the PS method to standardize a randomly selected set of 237 3D confocal images of the third instar Page: 1096 1091–1097</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head>L.Qu and H.Peng</head><p>(a)<ref type="figure">Fig. 5</ref>. Skeletons detected using image thinning (a–c) under different conditions and using the PS method (d).), as well as the respective PSs (d–f): before standardization (a and d), after a global alignment using affine transformation (b and e), and after our PS-based warping method (c and f). The skeletons are periodically colored with eight different colors, and the images are periodically colored with three colors (red, green and blue). (g–i) The density map of overlaid PSs after 1, 2 and 3 iterations of optimization. The radius of skeleton indicates the standard deviation of PSs of images after 1, 2 and 3 iterations of standardization. larval stage LNS. The comparison results of overlaid patterns are shown in<ref type="figure" target="#fig_4">Figure 6a</ref>–c, as well as the respective PSs are shown in<ref type="figure" target="#fig_4">Figure 6d</ref>–f, before and after standardization. Obviously, the affine transform-based standardization (<ref type="figure" target="#fig_4">Fig. 6b</ref>and e) did not align LNS patterns well, especially the big deviation in the VNC of an LNS. This was due to that the articulated LNS could not be wellapproximated by an affine transformation. On the contrary, the PSbased standardization scheme (<ref type="figure" target="#fig_4">Fig. 6c</ref>and f) successfully registered all images, with the PSs almost exactly overlapping on top of each other. We also quantified the spatial variations of the aligned PSs. As explained at the end of Section 3, the iterative optimization of the PS standardization, i.e. Step 9, is important.<ref type="figure" target="#fig_4">Figure 6g</ref>–i show that with 1, 2 and 3 iterations, the standard deviation of the entire set of PSs became smaller and smaller. Indeed, the average 'pair-wise distance' of the entire population of PSs dropped from 50.225 pixels before standardization to 5.661, 3.220 and 2.323 pixels in three iterations. For a better visualization, see the Supplementary Material for large frame-size movies of this experiment.</p><formula>(b) ( c) ( d)</formula><formula>(a) ( b) ( c) (d) ( e) ( f) (g) ( h) ( i)</formula><formula>(a) ( b) (a) ( b)</formula></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="4.5">Quality of standardized images</head><p>We also visually inspected the image quality of an LNS pattern before and after our standardization process.<ref type="figure" target="#fig_5">Figure 7</ref>shows that all the local features of an image before standardization (<ref type="figure" target="#fig_5">Fig. 7a</ref>and b) were well preserved in the post-standardization image (<ref type="figure" target="#fig_5">Fig. 7c</ref>and d). No visible artifact was seen. The processed image was a little bit smoother, due to the interpolation process during the TPS warping. The overall loss of information was negligible.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head>Page: 1097 1091–1097</head></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head>Principal skeleton algorithm</head><formula>(a) (b) (c) (d)</formula></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="4.6">Results of adult fruit fly VNC and others patterns</head><p>By modifying the shape prior of the PS, our algorithm can be easily adapted to other shape analysis applications. For example, in<ref type="figure">Figure 1c</ref>and d, we show that the PS method can be used to standardize an adult fruit fly VNC. Indeed the adult VNC has a more complicated shape prior, which has nine segments and seven optimization domains (<ref type="figure" target="#fig_6">Fig. 8a</ref>), than an LNS. Similar to the LNS case, the key to standardizing an adult VNC is to detect the PS robustly.<ref type="figure" target="#fig_6">Figure 8b</ref>shows the results on five arbitrarily selected adult VNC patterns (data from J. Simpson laboratory; NC82 neuropile staining was used in place of N-cadherin). It is evident that our algorithm (upper row of<ref type="figure" target="#fig_6">Fig. 8b</ref>) detected meaningful PSs, while the image thinning (lower row,<ref type="figure" target="#fig_6">Fig. 8b</ref>) produced results that were not very useful.<ref type="figure" target="#fig_6">Figure 8c and d</ref>shows additional PS detection results of adult fruit fly center brain and C.elegans. It can be noted that even when the PS was poorly initialized to even outside the object in the C.elegans case (<ref type="figure" target="#fig_6">Fig. 8d</ref>), our method still detected reasonable PS. Additional PS deformation movies can be found in the Supplementary Material. One potential problem of our PS approach is that, when a skeleton becomes more complicated, the deformation to the optimum may be more likely trapped into local minima. Generally speaking, this requires more careful initialization. One solution is to introduce hierarchical domains in optimization. Taking the adult VNC as an example, we can make our algorithm more robust by first optimizing the skeleton of the main trunk (i.e. the horizontal domain in<ref type="figure" target="#fig_6">Fig. 8a</ref>) so that we can get a good estimation of the scale, position and the orientation of the VNC, and then optimizing the remaining domains/segments to complete the entire skeleton.</p></div><figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_0"><head>Fig.2.</head><figDesc>Fig. 2. The shape prior of the fruit fly larva PS, where 11 control points c 1 , ..., c 11 form six connected segments and four domains. The domains, indicated by dotted eclipses, are used for the length constraint.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_1"><head>Fig.3.</head><figDesc>Fig. 3. Anchor points definition. (a) The curve is the cubic spline smoothed PS; the surrounded gray masks illustrate where cutting lines may take place; the overlapped/highlighted mask region in the center of hemisphere indicates where the cutting lines of different domains may intersect. (b) Defined anchor points overlaid on the PS.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_2"><head>(9)</head><figDesc>Set the warped (standardized) subject image as the input image and repeat Steps 1–8 until the PS of the image does not vary significantly (defined as the average displace of control points between two consequent iteration &lt;3 pixels).</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_3"><head>Fig.4.</head><figDesc>Fig. 4. Robustness evaluation using (a) different simulated twisted LNS and (b) different larva orientations. Green: initialization and red: detected PS.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_4"><head>Fig.6.</head><figDesc>Fig. 6. Comparison of LNS standardization using the PS method and the affine-based alignment. Overlaid patterns (a–c), as well as the respective PSs (d–f): before standardization (a and d), after a global alignment using affine transformation (b and e), and after our PS-based warping method (c and f). The skeletons are periodically colored with eight different colors, and the images are periodically colored with three colors (red, green and blue). (g–i) The density map of overlaid PSs after 1, 2 and 3 iterations of optimization. The radius of skeleton indicates the standard deviation of PSs of images after 1, 2 and 3 iterations of standardization.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_5"><head>Fig.7.</head><figDesc>Fig. 7. Comparison of the image content before (a and b) and after (c and d) standardization. (b and d) are the zoom-in view of the red boxes in (a and c). Red image channel: GFP-tagged GAL4 patterns. Green: neurotactin and blue channel: N-cadherin.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_6"><head>Fig.8.</head><figDesc>Fig. 8. (a) Shape prior of the adult VNC PS. (b) Results of PS detection (upper row) and thinning (lower row) on five adult VNC images (background image of the upper row). Green: initialization of the PS and red: detected PS. (c) PS detection of an adult fruit fly center brain. (d) PS detection result of a C.elegans confocal image.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" type="table" xml:id="tab_1" validated="false"><figDesc>w(D k ) is a coefficient that defines the contribution of domain D k. For LNS, due to the vertical asymmetry of the shape prior, in order to avoid point c 3 and c 4 will be pulled downwards seriously by D 3 and D 4 , we giveD 1 more weight (w(D 1 ) = 10, all other weights equal 1). For a general case, the weights can be uniform. E length (D k ) in Equation (6) denotes the length of domain D k :</figDesc><table></table></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" type="table" xml:id="tab_2" validated="true"><figDesc>Table 1. Consistency of PS detection under different initializations</figDesc><table>Images 
Score 

Maximal MSE (pixel) 
Average MSE (pixel) 

1 
0.035553 
0.016931 
2 
0.047522 
0.027183 
3 
0.003256 
0.001953 
4 
0.027412 
0.016448 

</table></figure>

			<note place="foot" n="11"> control points c 1 , ..., c 11 , which are arranged as 6 segments B 1 , ..., B 6 in Equation (1). The control points c 3 , c 4 , and c 7 join 1 Some image patterns may not have a uniquely well-defined principal skeleton, such as a spherical cell that has the uniform intensity. 1092 at :: on August 31, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from</note>

			<note place="foot">at :: on August 31, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from</note>
		</body>
		<back>

			<div type="acknowledgement">
<div xmlns="http://www.tei-c.org/ns/1.0"><head>ACKNOWLEDGEMENTS</head></div>
			</div>

			<div type="references">

				<listBibl>

<biblStruct   xml:id="b0">
	<monogr>
		<title level="m" type="main">An Introduction to Splines for Use in Computer Graphics and Geometric Modelling</title>
		<author>
			<persName>
				<forename type="first">R</forename>
				<forename type="middle">H</forename>
				<surname>Bartels</surname>
			</persName>
		</author>
		<imprint>
			<date type="published" when="1998" />
			<publisher>Morgan Kaufmann</publisher>
			<pubPlace>San Francisco</pubPlace>
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b1">
	<analytic>
		<title level="a" type="main">Principal warps: thin-plate spline and the decomposition</title>
		<author>
			<persName>
				<forename type="first">F</forename>
				<forename type="middle">L</forename>
				<surname>Bookstein</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">IEEE Trans. Pattern Anal. Mach. Intell</title>
		<imprint>
			<biblScope unit="volume">11</biblScope>
			<biblScope unit="page" from="567" to="585" />
			<date type="published" when="1989" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b2">
	<analytic>
		<title level="a" type="main">Continuous skeleton computation by Voronoi diagram</title>
		<author>
			<persName>
				<forename type="first">J</forename>
				<forename type="middle">W</forename>
				<surname>Brandt</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">CVGIP Image Underst</title>
		<imprint>
			<biblScope unit="volume">55</biblScope>
			<biblScope unit="page" from="329" to="338" />
			<date type="published" when="1992" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b3">
	<analytic>
		<title level="a" type="main">A potential-based generalized cylinder representation</title>
		<author>
			<persName>
				<forename type="first">J</forename>
				<forename type="middle">H</forename>
				<surname>Chuang</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Comput. Graph</title>
		<imprint>
			<biblScope unit="volume">28</biblScope>
			<biblScope unit="page" from="907" to="918" />
			<date type="published" when="2004" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b4">
	<monogr>
		<title level="m" type="main">Principal curves and surfaces</title>
		<author>
			<persName>
				<forename type="first">T</forename>
				<surname>Hastie</surname>
			</persName>
		</author>
		<imprint>
			<date type="published" when="1984" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b5">
	<analytic>
		<title level="a" type="main">Thinning methodologies-a comprehensive survey</title>
		<author>
			<persName>
				<forename type="first">L</forename>
				<surname>Lam</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">IEEE Trans. Pattern Anal. Mach. Intell</title>
		<imprint>
			<biblScope unit="volume">14</biblScope>
			<biblScope unit="page" from="869" to="885" />
			<date type="published" when="1992" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b6">
	<analytic>
		<title level="a" type="main">Genome-wide atlas of gene expression in the adult mouse brain</title>
		<author>
			<persName>
				<forename type="first">E</forename>
				<forename type="middle">S</forename>
				<surname>Lein</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Nature</title>
		<imprint>
			<biblScope unit="volume">445</biblScope>
			<biblScope unit="page" from="168" to="176" />
			<date type="published" when="2007" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b7">
	<analytic>
		<title level="a" type="main">A 3D digital atlas of C. elegans and its application to single-cell analyses</title>
		<author>
			<persName>
				<forename type="first">F</forename>
				<surname>Long</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Nat. Methods</title>
		<imprint>
			<biblScope unit="volume">6</biblScope>
			<biblScope unit="page" from="667" to="672" />
			<date type="published" when="2009" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b8">
	<analytic>
		<title level="a" type="main">Euclidean skeleton</title>
		<author>
			<persName>
				<forename type="first">G</forename>
				<surname>Malandain</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Image Vis. Comput</title>
		<imprint>
			<biblScope unit="volume">16</biblScope>
			<biblScope unit="page" from="317" to="327" />
			<date type="published" when="1998" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b9">
	<analytic>
		<title level="a" type="main">Bioimage informatics: a new area of engineering biology</title>
		<author>
			<persName>
				<forename type="first">H</forename>
				<surname>Peng</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Bioinformatics</title>
		<imprint>
			<biblScope unit="volume">24</biblScope>
			<biblScope unit="page" from="1827" to="1836" />
			<date type="published" when="2008" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b10">
	<analytic>
		<title level="a" type="main">Straightening C. elegans images</title>
		<author>
			<persName>
				<forename type="first">H</forename>
				<surname>Peng</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Bioinformatics</title>
		<imprint>
			<biblScope unit="volume">24</biblScope>
			<biblScope unit="page" from="234" to="242" />
			<date type="published" when="2008" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b11">
	<analytic>
		<title level="a" type="main">V3D enables real-time 3D visualization and quantitative analysis of large-scale biological image data sets</title>
		<author>
			<persName>
				<forename type="first">H</forename>
				<surname>Peng</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="m">Epub ahead of print</title>
		<imprint>
			<date type="published" when="2010" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b12">
	<analytic>
		<title level="a" type="main">Tools for neuroanatomy and neurogenetics in Drosophila</title>
		<author>
			<persName>
				<forename type="first">B</forename>
				<forename type="middle">D</forename>
				<surname>Pfeiffer</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="m">Proc. Natl Acad. Sci. USA</title>
		<meeting>. Natl Acad. Sci. USA</meeting>
		<imprint>
			<date type="published" when="2008" />
			<biblScope unit="page" from="9715" to="9720" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b13">
	<analytic>
		<title level="a" type="main">Nonrigid registration using free-form deformations: application to breast MR images</title>
		<author>
			<persName>
				<forename type="first">D</forename>
				<surname>Rueckert</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">IEEE Trans. Med. Imaging</title>
		<imprint>
			<biblScope unit="volume">18</biblScope>
			<biblScope unit="page" from="712" to="721" />
			<date type="published" when="1999" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b14">
	<analytic>
		<title level="a" type="main">Elastic registration of biological images using vector-spline regulization</title>
		<author>
			<persName>
				<forename type="first">C</forename>
				<forename type="middle">O S</forename>
				<surname>Sorzano</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">IEEE Trans. Biomed. Eng</title>
		<imprint>
			<biblScope unit="volume">52</biblScope>
			<biblScope unit="page" from="652" to="663" />
			<date type="published" when="2005" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b15">
	<monogr>
		<title level="m" type="main">Brain Warping</title>
		<author>
			<persName>
				<forename type="first">A</forename>
				<forename type="middle">W</forename>
				<surname>Toga</surname>
			</persName>
		</author>
		<imprint>
			<date type="published" when="1999" />
			<publisher>Academic Press</publisher>
			<pubPlace>San Diego</pubPlace>
		</imprint>
	</monogr>
</biblStruct>

				</listBibl>
			</div>
		</back>
	</text>
</TEI>