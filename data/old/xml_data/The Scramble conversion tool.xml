
<?xml version="1.0" encoding="UTF-8"?>
<TEI xmlns="http://www.tei-c.org/ns/1.0" 
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
xsi:schemaLocation="http://www.tei-c.org/ns/1.0 /home/joey/Project/grobid/grobid-home/schemas/xsd/Grobid.xsd"
 xmlns:xlink="http://www.w3.org/1999/xlink">
	<teiHeader xml:lang="en">
		<encodingDesc>
			<appInfo>
				<application version="0.4.2-SNAPSHOT" ident="GROBID" when="2017-08-10T23:44+0000">
					<ref target="https://github.com/kermitt2/grobid">GROBID - A machine learning software for extracting information from scholarly documents</ref>
				</application>
			</appInfo>
		</encodingDesc>
		<fileDesc>
			<titleStmt>
				<title level="a" type="main">Sequence analysis The Scramble conversion tool</title>
			</titleStmt>
			<publicationStmt>
				<publisher/>
				<availability status="unknown"><licence/></availability>
				<date type="published" when="2014">19 2014</date>
			</publicationStmt>
			<sourceDesc>
				<biblStruct>
					<analytic>
						<author>
							<persName>
								<forename type="first">James</forename>
								<forename type="middle">K</forename>
								<surname>Bonfield</surname>
							</persName>
							<affiliation key="aff0">
								<orgName type="department">DNA Pipelines</orgName>
								<orgName type="institution">Wellcome Trust Sanger Institute</orgName>
								<address>
									<postCode>CB10 1SA</postCode>
									<settlement>Cambridgeshire</settlement>
									<country key="GB">UK</country>
								</address>
							</affiliation>
						</author>
						<author>
							<persName>
								<forename type="first">Alfonso</forename>
								<surname>Valencia</surname>
							</persName>
							<affiliation key="aff0">
								<orgName type="department">DNA Pipelines</orgName>
								<orgName type="institution">Wellcome Trust Sanger Institute</orgName>
								<address>
									<postCode>CB10 1SA</postCode>
									<settlement>Cambridgeshire</settlement>
									<country key="GB">UK</country>
								</address>
							</affiliation>
						</author>
						<title level="a" type="main">Sequence analysis The Scramble conversion tool</title>
					</analytic>
					<monogr>
						<imprint>
							<biblScope unit="volume">30</biblScope>
							<biblScope unit="page" from="2818" to="2819"/>
							<date type="published" when="2014">19 2014</date>
						</imprint>
					</monogr>
					<idno type="DOI">10.1093/bioinformatics/btu390</idno>
					<note type="submission">Received on January 15, 2014; revised on May 30, 2014; accepted on June 12, 2014</note>
					<note>Contact: jkb@sanger.ac.uk Supplementary information: Supplementary data are available at Bioinformatics online.</note>
				</biblStruct>
			</sourceDesc>
		</fileDesc>
		<profileDesc>
			<abstract>
				<p>Motivation: The reference CRAM file format implementation is in Java. We present &apos;Scramble&apos;: a new C implementation of SAM, BAM and CRAM file I/O. Results: The C implementation of for CRAM is 1.5–1.7Â slower than BAM at decoding but 1.8–2.6Â faster at encoding. We see file size savings of 34–55%. Availability and implementation: Source code is available at http:// sourceforge.net/projects/staden/files/io_lib/ under the BSD software licence.</p>
			</abstract>
		</profileDesc>
	</teiHeader>
	<text xml:lang="en">
		<body>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="1">INTRODUCTION</head><p>Storage capacity has been the primary driver behind the development of the CRAM format (<ref type="bibr" target="#b1">Cochrane et al., 2013</ref>). The CRAM format (<ref type="bibr" target="#b4">Fritz et al., 2011</ref>) is a practical implementation of reference-based compression and is a viable alternative to the earlier BAM format (<ref type="bibr" target="#b5">Li et al., 2009</ref>). CRAM is now the preferred submission format for the European Nucleotide Archive. The initial CRAM prototype was in Python, quickly followed by a Picard (http://picard.sourceforge.net/) compatible Java reference implementation (https://www.ebi.ac.uk/ena/about/cram_ toolkit). We identified a need for a C implementation, which was implemented as part of the Staden Package's (<ref type="bibr" target="#b6">Staden et al., 1999</ref>) 'io_lib' library. Our primary conversion tool is named Scramble. It can read and write SAM, BAM and CRAM formats using a unified Application Programming Interface (API).</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="2">METHODS</head><p>We will not cover the CRAM file format here except to note that CRAM internally separates data by type before compressing with Zlib (<ref type="bibr" target="#b2">Deutsch and Gailly, 1996</ref>). Thus, we have regular blocks of quality values, blocks of sequence names and blocks of auxiliary tags, each of which may be compressed using different Zlib parameters. A key efficiency observation is that using the run-length-encoding strategy ('Z_RLE') is considerably faster than the default strategy, while also often offering slightly higher compression ratios for quality values. It also allows for applications to potentially omit decoding of irrelevant data types. Note that these tricks are not possible in the BAM format, as all data types are interleaved within the same Zlib blocks. Our implementation periodically samples both Z_RLE and the default strategy on data blocks to determine the optimal method. This ensures rapid speed without loss in compression ratio.</p><p>Multi-threading is implemented using a thread pool, shared by both encoding and decoding tasks. This contrasts well when compared with Samtools that can only parallelize file encoding. It also permits the most efficient use of threads when converting between differing file formats, automatically balancing the encoder and decoder work loads. Note that our SAM encoding and decoding is single threaded.use of Z_RLE for encoding quality values. Decoding of CRAM is not as fast as C BAM, but it is comparable with the widely used Picard's BAM decoder. The nature of a column-oriented CRAM file allows for the samtools flagstat equivalent to run considerably faster. We also observe that the CRAM files produced by Scramble are around 9% smaller than those produced by Cramtools.jar. Scramble has full multi-threading support for both reading and writing of BAM and CRAM file formats. It scales nearly linearly up to 16 cores, but with some performance inefficiencies becoming visible in CRAM with high core counts, especially for decoding. The results for conversion timings can be seen in<ref type="figure">Figure 1</ref>.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="4">CONCLUSION</head><p>We have demonstrated that the C implementation of CRAM performs well, beating Samtools, Picard and Cramtools for encoding speed. Decoding speed is not as efficient as Samtools but is still comparable with Picard and nearly twice as fast as the Java CRAM implementation. Also notable is that the nature of CRAM means some read operations (for example, flagstat and index) are faster than with BAM. CRAM is not yet capable of achieving the top compression ratios, using 3.96 bits/base with 40 quality bins and 2.05 bits/base with 8 bins compared against only 3.16 and 1.52 for fqz_comp (<ref type="bibr" target="#b0">Bonfield and Mahoney, 2013</ref>), and 41 bits per read name in CRAM versus 23 bits in fqz_comp. This demonstrates room for improvement in future CRAM versions, partially achieved by replacing Zlib with arithmetic coding or an Asymmetric Numerical System (<ref type="bibr" target="#b3">Duda, 2013</ref>). Scramble is not a drop-in replacement for the Samtools API; however, a port of the CRAM components of Scramble has been made to the HTSlib library and is available within Samtools version 1.0, available at https://github.com/samtools/.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head>ACKNOWLEDGEMENT</head><p>The authors would like to acknowledge Vadim Zalunin for his assistance and collaboration with re-implementing the CRAM specification.Note: User + System CPU times in seconds for encoding and decoding along with the produced file size. The timings correspond to a single 2.2 GHz Intel Xeon E5-2660 (of 16). The data were in the file system cache, and so these tasks are CPU-bound. Note that not all tools provide index and flagstat equivalents for all file formats, and so timings are omitted in these cases. Bold values represent the fastest or smallest figure in each column.<ref type="figure">Fig. 1</ref>. Real time taken to convert from 230 Gb BAM to BAM (Scramble, Samtools) and BAM to CRAM (Scramble) formats. The system was a 16 core 2.2 GHz Intel Xeon E5-2660 with a local RAID XFS file system. Tests on slower disks and with smaller locally cached data files are in the Supplementary Material, including benchmarks of Sambamba (https://github.com/lomereiter/sambamba) and Biobambam (<ref type="bibr" target="#b7">Tischler and Leonard, 2013</ref>)</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head>2819</head><p>The Scramble conversion tool</p></div><figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_0"><head></head><figDesc>Funding: Wellcome Trust (098051). Conflict of interest: none declared.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" type="table" xml:id="tab_0" validated="true"><figDesc>Table 1. CRAM breakdown by file percentage</figDesc><table>Data type 
File % age 
(40 Quality bins) 

File % age 
(8 Quality bins) 

Quality values 
80.9 
68.6 
Sequence identifiers 
8.3 
13.7 
Auxiliary tags 
3.9 
6.4 
Flags 
1.5 
2.5 
Alignment position 
1.4 
2.4 
CIGAR string 
1.4 
2.3 
Sequence bases 
1.3 
2.1 
Template position/size 
0.6 
1.0 
Mapping quality 
0.2 
0.4 
Other/overhead 
0.5 
0.8 

Note: Total file sizes for ERR317482: 3.46 Gb for 40 bins, 2.11 Gb for 8 
bins. 

</table></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" type="table" xml:id="tab_1" validated="false"><figDesc>Table 2.</figDesc><table>9827_2#49.bam (ERR317482) 

40 quality bins 
8 quality bins 

Tool 
Format 
Read(s) 
Write(s) 
Flagstat 
Index 
Size (Gb) 
Read(s) 
Write(s) 
Flagstat 
Index 
Size (Gb) 

Scramble 
BAM 
76.9 
773.6 
76.9 
– 
6.50 
63.3 
1063.6 
63.3 
– 
4.80 
Scramble 
CRAM 
117.1 
307.8 
28.2 
2.5 
3.46 
111.1 
299.6 
27.3 
2.1 
2.11 
Cramtools 
CRAM 
223.1 
1333.2 
– 
48.4 
3.78 
209.0 
1217.1 
– 
63.8 
2.33 
Samtools 
BAM 
89.1 
759.0 
89.1 
81.1 
6.50 
69.6 
1053.8 
69.6 
64.7 
4.80 
Picard 
BAM 
120.8 
518.4 
– 
124.8 
6.52 
111.9 
460.6 
– 
113.1 
4.90 

</table></figure>

			<note place="foot" n="3"> RESULTS AND DISCUSSION We tested our implementation against the reference Java Cramtools implementation as well as existing BAM implementations in C (Samtools) and Java (Picard). The test data used were a 4Â coverage of a Homo sapiens sample (ERR317482) aligned by BWA, with a further 1000 Genomes, and a 654Â coverage Escherichia coli test set included in the Supplementary Material. A breakdown of the file size by item type within the Scramble CRAM output can be seen in Table 1. The impact of lossy compression on quality values was also tested by applying Illumina&apos;s quantizing system that portions the 40 distinct values into eight new bins (http://res.illumina.com/documents/products/whitepa pers/whitepaper_datacompression.pdf). This reduced the file size by 39%; however, even in the reduced file the quality values still accounted for the bulk of the storage costs. Table 2 shows the time taken to read and write formats from the various tools along with their resultant file sizes. For encoding, it is clear that the C implementation of CRAM is considerably faster than the Java implementation and also beats Picard/ Samtools BAM speed despite the use of the Intel-tuned Deflate implementation by Picard. This is almost entirely down to the</note>

			<note place="foot">at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from</note>
		</body>
		<back>
			<div type="references">

				<listBibl>

<biblStruct   xml:id="b0">
	<analytic>
		<title level="a" type="main">Compression of FASTQ and SAM format sequencing data</title>
		<author>
			<persName>
				<forename type="first">J</forename>
				<forename type="middle">K</forename>
				<surname>Bonfield</surname>
			</persName>
		</author>
		<author>
			<persName>
				<forename type="first">M</forename>
				<forename type="middle">V</forename>
				<surname>Mahoney</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">PLoS One</title>
		<imprint>
			<biblScope unit="volume">8</biblScope>
			<biblScope unit="page">59190</biblScope>
			<date type="published" when="2013" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b1">
	<analytic>
		<title level="a" type="main">Facing growth in the european nucleotide archive</title>
		<author>
			<persName>
				<forename type="first">G</forename>
				<surname>Cochrane</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Nucleic Acids Res</title>
		<imprint>
			<biblScope unit="volume">41</biblScope>
			<biblScope unit="page" from="30" to="35" />
			<date type="published" when="2013" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b2">
	<monogr>
		<title level="m" type="main">ZLIB compressed data format specification version 3.3</title>
		<author>
			<persName>
				<forename type="first">P</forename>
				<surname>Deutsch</surname>
			</persName>
		</author>
		<author>
			<persName>
				<forename type="first">J</forename>
				<forename type="middle">L</forename>
				<surname>Gailly</surname>
			</persName>
		</author>
		<imprint>
			<date type="published" when="1950" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b3">
	<monogr>
		<title level="m" type="main">Asymmetric numeral systems: entropy coding combining speed of Huffman coding with compression rate of arithmetic coding</title>
		<author>
			<persName>
				<forename type="first">J</forename>
				<surname>Duda</surname>
			</persName>
		</author>
		<imprint>
			<date type="published" when="2013" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b4">
	<analytic>
		<title level="a" type="main">Efficient storage of high throughput DNA sequencing data using reference-based compression</title>
		<author>
			<persName>
				<forename type="first">M</forename>
				<forename type="middle">H</forename>
				<surname>Fritz</surname>
			</persName>
		</author>
		<author>
			<persName>
				<forename type="first">-Y</forename>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Genome Res</title>
		<imprint>
			<biblScope unit="volume">21</biblScope>
			<biblScope unit="page" from="734" to="740" />
			<date type="published" when="2011" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b5">
	<analytic>
		<title level="a" type="main">The Sequence Alignment/Map format and SAMtools</title>
		<author>
			<persName>
				<forename type="first">H</forename>
				<surname>Li</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Bioinformatics</title>
		<imprint>
			<biblScope unit="volume">16</biblScope>
			<biblScope unit="page" from="2078" to="2079" />
			<date type="published" when="2009" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b6">
	<monogr>
		<title level="m" type="main">The staden package</title>
		<author>
			<persName>
				<forename type="first">R</forename>
				<surname>Staden</surname>
			</persName>
		</author>
		<editor>Misener,S. and Krawetz,S.A.</editor>
		<imprint>
			<date type="published" when="1998" />
			<publisher>Bioinformatics Methods and Protocols. Humana Press</publisher>
			<biblScope unit="page" from="115" to="130" />
			<pubPlace>New York, NY</pubPlace>
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b7">
	<monogr>
		<title level="m" type="main">Biobambam: tools for read pair collation based algorithms on BAM files</title>
		<author>
			<persName>
				<forename type="first">G</forename>
				<surname>Tischler</surname>
			</persName>
		</author>
		<author>
			<persName>
				<forename type="first">S</forename>
				<surname>Leonard</surname>
			</persName>
		</author>
		<imprint>
			<date type="published" when="2013" />
		</imprint>
	</monogr>
</biblStruct>

				</listBibl>
			</div>
		</back>
	</text>
</TEI>