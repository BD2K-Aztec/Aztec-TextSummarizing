Bioinformatics, 32(7), 2016, 1048—1056

doi: 10.1093/bioinformatics/btv716

Advance Access Publication Date: 7 December 2015
Original Paper

 

 

Genetics and population analysis

Sampling ARG of multiple populations under
complex configurations of subdivision and
admixture

Anna Paola Carrieri,1 Filippo Utro2 and Laxmi Parida2'*

1Dipartimento Di lnformatica Sistemistica E Comunicazione, Universita Degli Studi Di Milano-Bicocca, Viale Sarca
336, Milano, Italy and 2Computational Genomics, IBM T. J. Watson Research, Yorktown Heights, NY 10598, USA

*To whom correspondence should be addressed.
Associate Editor: Alfonso Valencia

Received on 14 August 2015; revised on 3 November 2015; accepted on 28 November 2015

Abstract

Motivation: Simulating complex evolution scenarios of multiple populations is an important task
for answering many basic questions relating to population genomics. Apart from the population
samples, the underlying Ancestral Recombinations Graph (ARG) is an additional important means
in hypothesis checking and reconstruction studies. Furthermore, complex simulations require a
plethora of interdependent parameters making even the scenario—specification highly non—trivial.
Results: We present an algorithm SimRA that simulates generic multiple population evolution
model with admixture. It is based on random graphs that improve dramatically in time and space
requirements of the classical algorithm of single populations.

Using the underlying random graphs model, we also derive closed forms of expected values of the
ARG characteristics i.e., height of the graph, number of recombinations, number of mutations and
population diversity in terms of its defining parameters. This is crucial in aiding the user to specify
meaningful parameters for the complex scenario simulations, not through trial—and—error based on
raw compute power but intelligent parameter estimation. To the best of our knowledge this is the
first time closed form expressions have been computed for the ARG properties. We show that the
expected values closely match the empirical values through simulations.

Finally, we demonstrate that SimRA produces the ARG in compact forms without compromising
any accuracy. We demonstrate the compactness and accuracy through extensive experiments.
Availability and implementation: SimRA (Simulation based on Random graph Algorithms)
source, executable, user manual and sample input—output sets are available for downloading at:
https://github.com/ComputationalGenomics/SimRA

Contact: parida@us.ibm.com

Supplementary information: Supplementary data are available at Bioinformatics online.

 

9mg ‘09 1sn3nv uo sopﬁuv soq ‘etulomeg aIo Amie/xtqu 112 /§.IO'S[BU.IHO[p.IOJXO'SOUBIHJOJUIOIQ/ﬁ(1111] 11101; popeommoq

1 Introduction

We address the task of modeling and simulating complex scenarios
of related multiple populations With subdivision and admixture.
These scenarios can be used to study the effect on the genetic profiles
of extant populations as well as for testing complex hypotheses. The
aim of simulations is to not only capture the resulting populations
but also the relevant evolutionary history (for possible reconstruction

studies). In literature, most admixture models are based on rather
simplistic hypothesis of their possible inter—evolution history. One of
the bottlenecks has been the sheer size of the monolithic common his-
tory of multi—populations, each of realistic size. Under these condi—
tions simulators of even simple scenarios of just three populations
often do not terminate in reasonable time in spite of meaningful par-
ameter settings (sometimes up to 10—12 hours, for instance With

©The Author 2015. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com 1048

Sampling ARG of multiple populations with SimRA

1049

 

is"

°V°V
0;.

O

b
,3

WV

‘2.
$9

4!;
. ‘1:

'1."

11!.
AV

0
V
A

4

YA
“$7
)

«'1
1

 4‘.»
. .4". .3.»

‘1‘?“
®

,0

A\

.334»
x.
w.
3'4



‘0
a.»

‘
‘

1“?“
YA

M993»
M.“
V’I‘,‘~
V 7v

e. .45

MI
.9:
A!)
Y

A
V

 

(b)

 

 

 

 

 

 

Fig. 1. (a) shows the complete genealogical (pedigree) graph of a Wright Fisher population of 8 at each generation. Every individual has exactly two parents.
(b) shows the substructure of (a) based on tracking some chromosomal segment from four extant samples, marked in dark purple. The bold edges mark the flow
of the genetic segments of interest to the four extant units. (c) shows the relevant part by removing the extraneous parts of the network of (b). Note that a forward
simulator (moving in time from past to present) may have to simulate the network in (a) or (b), whereas the network in (c) is adequate for a backward simulator
(moving in time from present to past). In fact a backward simulator may only construct the network in (d) where every node has either multiple descendants or
multiple ascendants (termed the ARG). For visual clarity, the time scale has been adjusted. (e) The possible flow of 3 non-mixing segments in the ARG is shown
in three distinct colors, green, red and blue (from left to right on the chromosomal segment). The dashed edges imply that these do not affect any of the four ex-

tant samples, due to a recombination node in their path

COSI (Schaffner et 61]., 2005)). We observed a similar abort—and—re—
run requirement in our experiments even with the classical algorithm
(called Hudson in the paper).

We present a framework for modeling complex evolutionary
scenarios and an algorithm named SimRA that is both time and
space efficient enough to be practical. SimRA makes it possible to
run hundreds of experiments in very short time (in minutes) enabling
a very effective means of carrying out complex studies, such as in
Parida et al. (2015). We demonstrate that the algorithm does not
compromise the accuracy of the resulting simulations, all the while
being very compact in its description.

1.1 Background
ARG is a directed acyclic graph (DAG) that captures the common
evolutionary history of extant samples (Griffiths and Marjoram,
1997). SimRA is based on backward simulation of the ARG.
Backward simulations begin in the present and move in time
through the past generations and are usually more efficient than for-
ward simulations due to the elimination of many (obvious) redun—
dant paths in the evolution process. The big picture showing the
relationship between a complete genealogical network and an ARG
highlighting the backward trace of history is illustrated in Figure 1.
Complex simulation of scenarios results in complex interplay of
parameters. For instance, what should be the sample size m of a
population such that the expected number of active lineages in t gen—
erations is more than one. We present analytic forms of the expected
ARG characteristics of a population in terms of the input param—
eters. These derivations use the graph—theoretic results of the ran—
dom graph model presented in Parida (2010b). To the best of our
knowledge, this is the first time that such closed forms of the ARG
characteristics estimates have been computed. The estimated ex—
pected values can be effectively utilized by the user to design

 

II, \\\
 ,‘K =>
I‘s ” \\
I “ . \
II \\ ” ‘\ k
I, Y \\ ” \\
x i Y 

0' i 5 i

A c D B A C D B
(i) scaffold P’ (ii) ARG P

Fig. 2. An example with four populations A, B, C, D. (i) shows the scaffold P’.
(ii) shows a corresponding ARG P. Note that in general the structure of P’ is
not apparent from Pand the ARG Psimply looks like the ARG in Figure 1. See
text for more details

appropriate input regimens, removing time consuming trial and
error iterations (see case study in Supplementary Section SS).

2 Modeling multiple populations

We model the relationship between m populations by a DAG P’
with m leaf nodes, and call it a scaffold. An example is shown in
Figure 2 (i). The progress of time is assumed to be from top to bot—
tom and the m leaf nodes are annotated with the population labels.
Further, each edge e in P’ has three characteristics: the incubation
length len(e), the number of lineages at the bottom of the edge, lb(e)
and the number of lineages at the top of the edge, Me). The length is
a time parameter defined in generations. Note that two parameters,
an effective population size and a recombination rate, determine the
number of lineages Me) for a fixed pair of values of lb(e) and len(e).
We assume that the scaffold P’ is binary (i.e., each internal node in
P’ has exactly two ascendants or two descendants, but not both).
For each internal node, the junction constraints are defined as

91% ‘09 1sn3nv uo sopﬁuv soq 111110;th aIo Amie/xtqu 112 /§.IO'S[BU.IHO[p.IOJXO'SOTlBIHJOJUTOTQ/ﬁ(1111] 11101; popeommoq

1050

AP. Carrieri et al.

 

   

(i) Merge (ii) Split

Fig. 3. The two types of nodes in a scaffold P’: Merge and split nodes are
marked by the horizontal dashed lines at time t. The tiny black disc nodes and
the thin black edges are part of the underlying ARG P

follows (see also Figure 3). A node v in P’ that has two incoming
edges e1 and e2 and an outgoing edge e3 (termed a split node) the fol—
lowing relationship holds: lt(e3) g lb(e1) —l— lb(e2), i.e., the lineages
at z/ is the union of the lineages of the two incoming edges. Similarly
if node v has two outgoing edges e1 and e2 with one incoming edge
e3 (termed a merge node), then lb(e3) g lt(e1) —l— lt(e2), i.e., the lin—
eages at z/ is the union of the lineages of the two outgoing edges.
Each edge e of P’ represents the evolution of a Wright Fisher popula-
tion captured in a DAG say P6. The union of each of these DAGs by
appropriately gluing the ends of the edges corresponding to the
nodes of P’ gives the ARG P that can be written as: P : Ueep/Pe.
Such a P is shown in Figure 2 (ii) where the leaf nodes correspond to
extant units of each population of P’.

Figure 4 shows an example of parameters that define the scaffold
P’. Additionally a recombination rate (r) and effective population
size for each edge, ultimately decides the topology of the resulting
ARG. Further, the mutation rates and the short tandem repeats
(STR) details define the polymorphism in the samples of the individ-
uals of the populations.

Consider the scaffold specified in Figure 4. Each edge is simulated
as a single population (Section 3) and assume that the effective popula—
tions size Ne]. is specified for each edge e]. For instance, the edge e1
labeled with population D is simulated with 12 extant samples, i.e.,
lb(e1) : 12, len(e1) : t1. The resulting surviving lineages lt(e1) is split
in the ratio 1:1 as shown in Figure 3. Similarly, the edge e2 is labeled
with population C with 18 extant samples, lb(e2) : 18, len(e2) : t2.
The resulting surviving lineages lt(e2) is split in the ratio 1:1. Next,
lt(e1)/ 2 lineages are simulated until a time depth of t3 on edge e3 to
give lt(e3) lineages. Population B is simulated with 14 extant samples
on edge e4 until a time depth of t3, i.e., lb(e4) : 14, len(e4) : t4. The
lt(e3) lineages are combined with lt(e4) lineages. This node in the scaf—
fold is a merge node as shown in Figure 3 and the population is simu—
lated to a time depth of t6 (i.e., for time t6 — t3). Similarly all the edges
are simulated until a total time depth of t7.

3 ARG network sampling algorithm

We now address the problem of simulating each edge of the scaffold
P’ which can also be viewed as the ARG sampling of a single popula—
tion. This is a well—studied problem as discussed in (Hein et al.,
2004; Hudson, 2002). In the remainder of the paper, we refer to this
classical backward algorithm, based on Kingman coalescence, as
Hudson (Kingman, 1982). The reader is directed to (Hein et al.,
2004; Hudson, 2002) and citations therein for a comprehensive de—
scription of Hudson. However, we found that even Hudson algo—
rithm was not efficient enough to admit complex scaffold
simulations: it was too time consuming and in many instances failed
to terminate in reasonable time, forcing to abort and re—run. A single
scaffold requires multiple runs (corresponding to each edge) thus
making the algorithm prohibitively expensive. Here we present our
algorithm for simulating a single (neutral) population.

         

 

A (10)

(18)" D (12) 13 (114')

Fig. 4. Specifying the family of 4 populations, A, B, C and D with sample sizes
10, 14,18 and 12 respectively. The horizontal dashed lines correspond to time
to = 0 < t1 < t2 <  < t7. At times t1 and t2 the surviving lineages are split in
the ratio 1:1 along the diverging lines of the scaffold at the split nodes

3.1 Overview of the approach

The algorithm is based on Kingman coalescence and is along the
lines discussed in (Hein et al., 2004) and is very similar to the
Hudson algorithm. Again, to keep the discussion self—contained we
give the complete description here, along with the changes specific
to SimRA in the text of the description below. The algorithm works
back—in—time starting from the present (time 0), moving back into
the past. Further, the ARG is incrementally constructed by identify—
ing the event nodes in the graph. An event node either has multiple
incoming or multiple outgoing edges. For example a chain node is
not an event node. An important assumption, that considerably sim—
plifies the algorithm, is made: The probability of multiple events in
the same epoch (generation) is extremely low, hence the algorithm
assumes there is at most one event per generation. The design of the
overall algorithm is affected by this and at each step the algorithm
simply seeks the closest generation from the current where an event
node occurs.

3.1.1 The closest event node from the current state in the ARG

In the interest of brevity, some basic definitions are presented in
Supplementary Section 81 and use here. Let L lineages be active at
time T. Let tflgal denote the time to the coalescence of lineages la and
lb. Let tfcmb denote the time to the closest (to T) recombination event
of lineage 1. Eq. 23 (in Supplementary) shows that each of the )
coalescent events, generically written as tflgal, can be approximated
by an exponential distribution with parameter A = 1. Recall the fol—
lowing observation from (Parida, 2010b):

OBSERVATION 1. (Ancestor Without Ancestry Paradox) The edges
(and nodes) of an ARG must be annotated with the chromosomal
segment that flows through the edge.

Based on the above observation, Eq. 26 (in Supplementary) can
be approximated by an exponential distribution with parameter r;
where r; : er and r; is the recombination rate of the segment ﬂow—
ing through lineage I. These approximations to the exponential dis—
tributions are based on two assumptions (Wright Fisher
population): the population at each generation is N and a unit picks
its parent randomly from the previous generation (non—overlapping
generations and panmictic mating population). Also, note that the
factor of N in r; is due to the approximation of the distributions,
and not due to the underlying population evolution model. The task
is to find t, the time to the closest event node in the past. This event
could either be a coalescent event (merging of two lineages) or a

91% ‘09 1sn8nv uo sopﬁuv soq ‘BHIJOJHBD aIo Amie/trqu 112 /3JO'S[‘8UJHOIpJOJXO'SOTlBIHJOJUTOTQ/ﬂdllq 11101; popeommoq

Sampling ARG of multiple populations with SimRA

1051

 

recombination event (splitting of a lineage). Since all the events are
independent, then we seek overall minimum. Thus

r—W
. . - rcmb
t : m1n<m1n1£a<bSL(t;gal) 7m1n1§l§L(tl 
W

F’ﬁ
ZEXP<1+1+---+1+r3+r§+m+ri> (1)
W

using Property 1 (Supplementary Section Sl). The overbraces cap—
ture the ) coalescent events and the underbraces capture the L re—
combination events. t computes the time to the closest event back in
time from the current time T, but, is the closest event coalescent or
recombination? The answer to this comes from Property 2
(Supplementary Section Sl). The event is a coalescent event with

L

and a recombination at lineage 1 3 la 3 Lwith probability

probability

/

(air

In the implementation of the algorithm, both Eqs. 2 and 3 are
used in a single draw of a random number. Imagine a unit interval
[0, 1] is broken up into 1 —l— L sub intervals of lengths in the follow—
L :r’1 :r’2 :  : r] :  :r’L. Thus a random number drawn

2
from the interval [0,1] belongs to one of these 1 —l— L sub—intervals

ing ratio

and is appropriately interpreted: the first interval implies
coalescent event and lath (la > 1) interval implies a recombination
at the lineage lk_1. Since the events are random, t is estimated first
and then the lineages are picked at random from the L active
lineages.

3.1.2 Genetic material ﬂowing through the ARG

The chromosomal segment whose evolution history is captured by
the ARG is represented as the real interval [0, 1], without loss of gen—
erality. Every node in the ARG is annotated with union of one or
more sub—intervals of [0,1]. Thus genetic material, I, carried by a
node is: I : {[E1,u1], [€2,u2], . . . , [€S,us]}, where0 3 £1 < u1 < £2
< uz <  < E, < us 3 1. The closed intervals [€,-,u,-] E I are termed
solid and the open intervals (ui,€,-+1) are termed gaps where
1 g i < i —l— 1 g s. The length (len) of I is defined as the total span of
I, irrespective of the gaps, while density (den) of I is defined as the
total span of the solid intervals only. The definitions are summarized
as (see also Fig. 3):

solid(I) : [€1,u1] U [€2,u2] U  U [€S,us],
gaps(I) : (u1,€2) U (u2,€3) U  U (us_1,€5),
(

len I): uS —€1,

(A

(1611(1) = 141' — £1,
":1

s

[x,y] C solid(I) <=> [x,y] C [ﬁbui], forsome1 g i g s.

The union operation on segments, 1,, U I), : dub, has the natural
interpretation:

[bu] E Iaub <=> [bu] C solid(Ia) OR[€,u] C solid (1),). (4)

The splitting of I at x (£1 3 x 3 us) into 1,, and 1;, is defined as:
L, : I), : I,whenx : £1 orx : us,
I, : {[El,u1],[€2,u2],...,[6,,x]},
15111)“ 1b = {lxauila l5i+1aui+1la - - - a [Esauslla
Ia : {[El,u1], [€2,142], . . . , [6,,u,]},
I), : {[Ej+1,u,-+1], . . . , [Es,us]},

}when€,- < x < u,-,

}whenu,- g x g EH1.

3.2 On the uniqueness of GMRCA

A founding ancestor of the extant units is termed GMRCA (grand
most recent common ancestor). Let Q denote the set of all (infinite)
graphs, with nodes partitioned into distinct levels, or generations,
with N nodes at each level, and each node having no more than two
parents. For each X E Q, and any subset V of the nodes at level 0,
there is an induced subgraph of X, namely the ARG induced by V
and we call this the ARG associated with X.

Following Parida (2010a) we introduce a probability measure on
Q as follows. For X E Q and h > 0, we denote by X;7 the truncation
of X to depth h, i.e., X;7 is the finite induced graph from X on the set
of vertices of level 3 h. Similarly, for a subset E C Q, and h > 0, we
denote E], : {X},|X E  We say that E is ﬁnitely determined if
there exists some ho, such that X E E <=> X190 E E190, and in this
case we denote ,u(E) :  The family, .7-', of finitely determined
subsets E E 2Q clearly forms a field, and thus by the Caratheodory
extension theorem (see for example Varadhan (2001), Theorem 1.1,
pp. 4), ,u can be uniquely extended to the a—field generated 8 by this
family. We denote this measure also by ,u and consider Q as a prob—
ability space with measure )1.

Let Eunq C Q be the set of graphs X E Q, such that the ARG asso—
ciated to X has a unique GMRCA. The following theorem (whose
proof is presented in the Supplementary due to space constraints) fol—
lows from the definition of the measure )1. It assures us that almost
every ARG has a unique GMRCA. In fact, in over ten thousand simu—
lations, of which about three thousand are reported in this paper,
SimRA terminated in every instance with a unique GMRCA.

Theorem 1. The subset Eunq is measurable and u(Eunq) : 1.

Corollary 1. The measure of the space of all ARGs with no unique
GMR CA is zero.

3.3 Algorithm to generate the topology

INPUT: Due to historical reasons, the unit of recombination rate is
specified in centiMorgans per megabase per generation and the mu—
tation rate is specified in number of mutations per base pair per gen—
eration (X10_8). The input parameters and some typical parameter
values for a human chromosomal segment are given below.

 

 

 

 

 

 

Parameters user-speciﬁed units in bp example
units for algorithm values
g seqment length Kb x 1 0 3 bp 75 X 1 O3
V STR locations — — [O . 3, 0.7] X g
m extant units — — 1 00 X 1
N population size — — 1 0 X 1 03
l rates/generation
‘ _ { X (0.01 = 10—8)
7' recombinatlon cM/Mb/ gen W6— 0 . 1 X 1 O _ 8
Morgan/bp/ gen
)1. SNP mutation mut/bp/ gen X l 0 _ 8 x 1 mut/bp/gen 1 . 5 X 1 0 _ 8
us“ STR mutation mut/locus/ gen X 1 O _ 4 x 1 mut/locu/gen 6 . 9 x 1 O _ 4

 

ASSUMPTION: Not more than one event, coalescent or recom—
bination, occurs at a generation. Also, no back mutations, i.e., a
position undergoes no more than one mutation in the entire ARG.
The mutation rate and recombination rate are uniform over the seg—
ment being simulated.

OUTPUT: ARG; L is the number of GMRCAs.

9mg ‘09 1sn8nv uo sopﬁuv s01 ‘BHIJOJHBD aIo Amie/trqu 112 /§.IO'S[BU.IHO[p.IOJXO'SODBIHJOJUIOIQ/ﬁdllq 11101; popeommoq

 

 

 

 

 

 

 

 

 

 

 

 

1052 AP. Carrieri et al.
Algorithm I x ‘ "‘1" :5: I
1. Initialization.  10 ll
a. The enetic material, I,,, of each of the m leaf nodes, 12, . . _ _
g (a) Usmg (1611(1) 1n Eq 9- (b) Us1ng len(I) 1n Eq 9.

is set to I), = {[0, 

b. The number of live lineages L is initialized to m.

c. For lineage I, incident on leaf node v, the recombination
rate (based on Eq. 26 in Supplementary Section Sl) is:

rl’ : er where r; : grlen(L,). (6)

Since, len (Iv) : 1 for the leaf nodes, for each 1, rl’ : 0t
where

or : Ngr. (7)
d. Time T is set to 0 and iteration i to 1.

2. Loop. Iterate until L is one (or T crosses a pre—deﬁned
threshold). Iteration i is deﬁned as follows.

a. Compute the recombination rate rl’ of each lineage I
(the outgoing edge on node 12) using Eqs. 6 and 7 as
rl’ : 0t >< len(Iv). Then compute the time t,- to the next
event using the exponential distribution (Eq. 1):

L L ,
tizExp (2>+Zn . (8)
[=1

In other words, draw a random number from the
above exponential distribution.

b. Based on Eqs. 2 and 3, if coalescent event, then pick
two lineages, la and 1;, (with genetic material 1,, and
1;, respectively) at random and coalesce them to one
and update the genetic material of this new node
and lineage 1,, U1), (as deﬁned in Eq. 4). Update L to
L — 1.

c. If recombination at lineage la, then randomly pick a
point x on the segment being carried by lineage la, split—
ting the lineage into two, as deﬁned in Eq. 5. Update
the genetic material of the two lineages based on this
splitting point. Update L to L —l— 1.

d. T is updated as T —l— t,- and iteration as i —l— 1.

 

3.4 Painting ARG edges with SNP & STR mutations

Each time t of Step 2(a) can be scaled to generation as j : Nt. Let
time t be associated with an incoming edge on node 12. At this stage,
each edge is annotated with the mutation events, which is appropri-
ately reﬂected in I,,, the segment carried by node v.

3.4.1 SNP mutations
Since number of generations is N t and the span of the segment 1,, has
been normalized in the initialization step, let

p : pNt andn : gden(I,,). (9)

Each edge of the ARG, incoming on node v, is annotated with
number of mutations based on Eq. 9 as follows. X, the random
draw from a Poisson distribution with parameter np:

X : Poisson (10)

Then the X mutations are placed at random in segment 1,,
(excluding the gaps, see Fig. 5).

Fig. 5. The top line represents a chromosomal segment [carried by an edge
in both (a) and (b): gaps(I) are shown as dashed lines and solid(I) as solid
segments. Iis mapped to a normalized line segment, say [0,1], shown in the
bottom in both (a) and (b). In (a) the gaps are skipped, and the lengths of each
element in solid(I) is proportionally represented in [0, 1]. Thus any element in
[0,1] can be mapped back to a unique location in solid(I). In (b) the gaps are
not skipped, and the lengths of each element in solid(I) and in gaps(I), is pro-
portionally represented in [0,1]. Any element only in the solid section in [0,1]
can be mapped back to a unique location in solid(I); any other element maps
to a gap in I

3.4.2 STR mutations

Note that the number and positions of the STR loci are fixed by the
input specification. For each STR locus, la, carried by I,,, we compute
the following. The number of STR mutations at locus la on each
edge of the ARG, incoming on node v, is X,,, the random draw from

a Poisson distribution with parameter N tug“:

Xk = Poisson (Ntustr). (11)

Let p+ be the probability of the mutation that increases the num—
ber of copies (by 1 in one generation) and p_ be the probability of
the mutation that decreases the number of copies (by 1 in one gener-
ation). Then, Xk+, the number of times the STR mutation results in
an increase in the number of copies of the repeat follows a binomial
distribution, hence is the random draw from a binomial distribution
with parameter Xk and p+ Xk+ : Binomial (Xk,p+). Thus the re-
mainder, i.e., Xk — Xk+ must be the number of events that result in
decrease of the number of copies. Thus Ak the net change in the num-
ber of copies at locus la is: Ak : Xk+ — (Xk — Xk+) : 2X;€+ — Xk. If
unspecified, we use the default value of p+ : %, assuming

P+=P—:%-

4 Four quantitative hallmarks of ARG

The ARG is a random object defined by parameters, m, the extant
sample size; N, the population size; g, the length of the genomic seg—
ment whose common history is being tracked; r the recombination
rate; 11, SNP mutation rate. In fact, other polymorphisms, such as
STR, can be incorporated just as the SNP mutations are. Note that
the unique founding ancestor, GMRCA, is attained in an ARG with
probability 1 (see Section 3.2). We consider the following four quan—
tities as the hallmark of the random object ARG with parameters m,

N, g, r, M:

Depth of the ARG (H).
Number of non-mixing segments in the sample population (Z).
Number of polymorphic sites in the sample population (Y).

:PSNPI‘

Diversity in the sample population (D).

5 Closed-form approximations of the expected
hallmark values

We derive approximations of the expected hallmark values as
closed—form functions of the ARG parameters. We did not find ana—
lytic or closed—forms of the expected values for the general scenario
in literature, except some very specialized cases such as depth of

91% ‘09 1sn8nv uo sopﬁuv s01 ‘121u10111123 10 Amie/nun 112 /§.IO'S]BU.IHO[p.IOJXO'SOllBIHJOﬂIlOlCV/Z(1111] 111011 pop1201umoq

Sampling ARG of multiple populations with SimRA

1053

 

GMRCA in the absence of recombinations (Hein et al., 2004). Our
derivations are based on the theorems and observations in Parida
(2010a)

In fact, we found that if we required a single population only to
study the hallmark expected values, but not the sample population,
then the closed form approximations were tight enough to make the
actual simulation redundant.

Overview of the derivations. We use two notions: depth of a
node and girth of an edge. An edge length, as well as depth of a
node, is defined to be in time units. The unit of time is measured in
generations. The depth of each node is measured from the leafnodes
and the depth of a leafnode is defined to be 0. The girth of an edge is
defined to be the product of the edge length and the size of the gen—
omic segment the edge transmits.

1. The ARG network is decomposed into overlapping trees (see
Thm 2; also Figs 6 and 7 and Fig. 11 in Supplementary).

2. For each tree, we compute the depth of each node and the girth
of each edge, using Kingman coalescence. The depth of a tree is
simply the depth of its root node. The girth of the tree is the sum
of the girth of each edge of the tree.

3. The depth and girth of each tree are used for approximating the
ARG hallmark values. However, the interdependence of the
trees makes these computations non—trivial.

 

Fig. 6. The horizontal lines denote the time at which an event (coalescence or
recombination) occurs. (a) An example of an ARG. (b) depicts the flow of the
3 non-mixing segments shown in three distinct colors: green, red and blue
(from left to right on the chromosomal segment)

 

1 2

(a) 71 (b) 72

 

5.1 Mathematical details

To keep this section self—contained, we recall the following basic
identities. Let 0 < m’ < m.

 

 

 

m 1 1 1 1
12m,“ i— i m m
m 1 1 1
:1 —  —%l 1
21—1 +24r +m—1 Ogm’ (3)
m 1 , m
2 mlogm—logm :log—/. (14)
i=m’+1 _1 m

Consider a tree with m leafnodes. Using Kingman coalesence, all
the non—leaf nodes of the tree can be written in increasing depth
(from the leafnodes) as v1, v2,..., vm_1, with the active lineages
decreasing by one at each node. Let t,- denote the depth of v,- from
v,-_1 where depth of v0 is defined to be 0. Then the tree truncated at
a depth that has m’ active lineages, is written as Tmaml. Let HTmym, be
the depth of this tree. Then using Property 3 (Supplementary Section
81), linearity of expectations, and the above identities we get:

121mm,): 2 Eu): Z %
i=1+m’ i=1+m’ <2)

(15)

 

m 1 1 1 1
222,017) 22b?)-
i=1+m

Let g the length of the genomic segment carried by each edge in
the tree and the girth of the tree be thmymp Then

lE(thm7m,) : ilE(t,)g
i=1+m’

m . m 1 (16)

1

2g 2 T=2g Z ,-_—1
i=1 m’ (2) 1—1—l—m’

m

m 2g logg. (17)

The complete tree with a single root node is written as Tm71 and

lE(HTm71) 22(1 —l>, (18)

m

E(thm71) : 2g logm. (19)

 

(C) 73 (d) 7”

Fig. 7. The four trees embedded in the ARG network of Figure 6 (as captured in Eq. 20). The three marginal trees, T1 to 73 correspond to the three non-mixing

segments shown in green, red and blue

91% ‘09 1sn8nv uo sopﬁuv s01 ‘121u10111123 10 Amie/nun 112 /§.IO'S]BU.IHO[p.IOJXO'SOllBIHJOﬂIlOlCV/Z(1111] 111011 pop1201umoq

1054

AP. Carrieri et al.

 

We recall the following from Parida (2010a) relating population
genetics entities with graph entities like least common ancestor
(LCA). A non-mixing genetic segment does not have any recombin—
ation event in the common history of the m samples.

THEOREM 2 Let g be an ARG with some K 2 1 non-mixing
segments. Then K marginal trees are embedded in g and the
GMRCA ofg is the LCA of the K LCAs of the K marginal trees.

Figure 6 gives a simple illustration on an ARG on four samples
with three non-mixing segments. An alternative view of the theorem
is as follows: Let T(l, b) denote a tree defined on I leafnodes
each carrying the segment of length b. Then for some partition of
genome segment g into K non—overlapping segments, where
g=g1 ngU...UgK,

K
g 5 (kg rungs) U 7mg), (20)

where the roots of the Tk’s are the leaves of 7’. Two examples illus—
trate the embedded trees, one in Figure 7 and the other, due to space
constraints, in the Supplementary in Figure 811. In the former the
number of nodes in T’ is of the order of K while the latter has the
smallest possible size of just one node. In both, 71—73 are the mar—
ginal trees of usual shape and size.

 

I:|SimRA N=1K N=5K  N=10K
]:IHUdSOn a 8 12
g=25K I: j Z

5% 2% Bi

 

5‘:
5:3:
CE:

20 50 80 120 20 50 80 120 20 50 120

 

g=75K I4

ANN-lsmmum
m

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

s
55 Ba: n5 55 35 as as 4
I I H E
-- -- '- -' -. I I 59 EE .9 e.
20 50 80 120 20 50 80 120 20 50 80 120
(1) ARG helght H
:ISimRA x1o‘B  4 x10"  4 no“ 
|:|Hudson e 4 4
3.5 3.5
5
3 3
 >. 4 2.5 2.5
a 2 2
I. 1.5    1.5
2 g 1.15 I- .
1 II
0.5 0.5
2‘3 50 80 120  50 80 120 20 50 80 120
1x10 4_ 10 4'3 10“3
s 4 3
5 3.5 2.5
a
g=75K >~4  2
a 2 1.5 
1.5 II
2 1
1
1 05 0.5
20 50 80 120 20 50 80 120 20 50 80 120

(iii) Number of mutations Y

Corollary 2. If H 1 is the maximum of the depths of Tk (m, gk)and
H2 is the depth of T’(K,g)and H is the depth of the GMRCA of the
Q, then

H=H1+H2. (21)

Corollary 3. The girth of ARG g is the sum of the girth of each
Tk(m7 gk) and T/(Ka 

5.2 Summary of closed—form formulations
Due to space constraints, the derivations have been presented in
Supplementary Section S2 and only the results are summarized here.

Let
1
H1 22(1 ——>,
m

oc=Nrg,ﬂ:ocH1+1,y:2a—ﬂ,

2+ rz—Sodl—ﬂ)

H:
2 20¢

,whenr > 0,

K 2 (H1 -)— H2)N1’g-)— 

 

|:| SimRA ..
I:I Hudson ,5

3

N=1 K N=5K N=10K

g=25K N 2

' o
°_°¢.° °A° 05° 0&0  gal-i] . .

20 50 80 120 20 50 80 120 20 50 80 120

Ana-hmme
dmmémmum

 

 

 

 

 

 

 

 

 

O
80 120

8
1.5 6 20
0;°° 0° 0 0° 2 10 ﬁlm
'. . o o o o -'
50 so
m

20 120 20 50 so 120 20
m

5% ii 5%

(ii) Number of recombinations Z

 

 

 

 

 

 

 

 

 

 

 

 

 

120 20 50 so 120 20 50 so 120

m

I:]SimRA  N=1K . N=5K . N=1OK
.
g=25K d5 :
1 2 a! ma 5 a H
0.5 a” 1 II II .E lg
II I. II II
V 20 50 80 120 A 20 5O 80 120 A" 20 50 80 120
g=75K d . 
2 6  15 o 0 $9
4 I. 10
ea éé %  2 5
50 so " "
m

(iv) Diversity of population D

Fig. 8. The closed form expected values are compared against empirical values for different parameter values of m, g and N. The recombination rate used is
r: 0.1 x 10‘8 Morgan/bp/generation, )1 = 1.5 x 10‘8 mutations/bp/generation, and m’ = 1. For the results with m’ > 1, see Figure 812 in the Supplementary.
Note that the mutation rate affects only (iii) and (iv). Each experiment was run 100 times, using both SimRA and Hudson. The box-and-whisker diagram summar-
izes the result for each. On each box, the central mark is the median, the circle is the mean, the edges of the box are the 25th and 75th percentiles, the whiskers
extend to the most extreme data points not considered outliers, and outliers are plotted individually. In each, the green diamond is the expected value as com-
puted by the closed form, while the hollow circles are the observed empirical values by SimRA and Hudson. Notice that not only do the two algorithms give simi-

lar values; the closed form is also a tight approximation

91% ‘09 1sn8nv uo sojoﬁuv s01 ‘121u10111123 10 Amie/nun 112 /§.IO'S]BLLIHO[p.IOJXO'SOllBIIIJOJUlolCI/ﬁ(1111] 111011 pop1201umoq

Sampling ARG of multiple populations with SimRA

 

Then the four (expected) hallmark values are:

 % H1 -)— H2,
E(Z) % K — 1,

1300 E ZMgNUOgm +10gK),

m 1
lE(D) % 2ngZ i—Z.
i=2

Expected Height of Truncated ARG. H1, at and 6 values are as
above and m’ is the number of surviving lineages of the truncated
ARG. Then

 

V=20<—m’ﬂ,
: /2_ / /_
H223) V 8am<m ﬂ),whenr>0,
201m’

 % H1 -)—H2.

6 Comparison study

For a comprehensive survey of sampling algorithms and simulators
the reader is directed to (Hoban et al., 2012), which discusses both
backward and forward simulators.

Many simulators in literature address the issue of redundancy in
the simulations and they can also be classified on the basis of the ex—
tent of non—redundancy (see Parida, 2012, for instance).

The underlying mathematics of a backward simulator is non—
trivial and the classical Hudson algorithm captures the essence of
backward simulations.

SimRA simulates multiple populations under admixture and sub—
division, while other simulators incorporate other demographic
models, making it difficult for a nose—to—nose comparison. However,
the core engine of SimRA can be compared with the Hudson algo—
rithm, which forms the basis in all backward simulators. Hence in
the comparative study here, we use only the single population of
SimRA and the classical Hudson algorithm using exactly the same
input parameters. Furthermore, to keep the comparisons agnostic to
other possible extraneous factors, we use identical implementation
for the common parts of SimRA and Hudson.

6.1 Differences from Hudson algorithm

Recall that Hudson algorithm uses a single scaled recombination
rate Nr, while SimRA uses the L segmented versions
r] : Nr,, 1 : 1, .., L. This is reflected in Eqs. 1—3. Eq. 1 suggests that
in our algorithm, to account for recombination event, time t takes
into account not just the number of active lineages but also the size
of the segments carried by each of them (r1 : grlen(I,,) of Eq. 6).
Note that 21, len(IU) 7E 1 at each iteration making the two computa—
tions distinct; hence distinct algorithms. Thus if pc is the probability
of coalescence (Eq. 2), then the probability of recombination is 1
—pc with equal probability over all the lineages in Hudson algo—
rithm. But SimRA uses Eq. 3 to pick a lineage for the recombination
event. Thus Eq. 3 has no counterpart in the classical Hudson algo—
rithm. The accuracy of the two algorithms are comparable while
SimRA outperforms Hudson in time, space and non—redundancy fac—
tor, as seen below. We performed extensive comparative analysis be—
tween the two algorithms SimRA and Hudson, to measure various
outcomes. In particular, we carried out hundred runs for each par—
ameter set up, for both the algorithms.

 

 

 

 

 

 

 

 

Time Memory
60 . . . . 6000
I SimRA
50 l:l HUdson - 5000
40 - 4000
g
C .Q
8 30 2 3000
CD
CD
20 . 2000
10 . 1000
0 0
16000 .
350 -
14000 .
300 -
12000 .
g 250 - -
(C) 10000 -
.0
8 200 - - X
2 8000 -
-- 150 - -
2 ' éé
100 - ' 4000 -
50 2000

 

 

0.01x10'5 0.05x10’5 0.1x10’5 0.3x108 0.01x10'5 0.05x108 0.1x10’3 0.3x10a

r r

Fig. 9. The box-and-whisker diagrams of the time and memory performance
of SimRA and Hudson computed for 100 runs with N = 10K, 9: 150K, )1 21.5
X108 and different value of recombination rates (shown in the x-axis) and
for each parameter setting both the algorithms were run 100 times. The red
line demarcates the time and space requirement for Hudson for the rightmost
value of r. While all values of rthe time and space requirement of SimRA is
better than that of Hudson. In particular for large rSimRA is nearly two orders
of magnitude better than Hudson

6.2 Accuracy measures

We demonstrate the accuracy of the SimRA algorithm by comparing
the four hallmark values to the ones computed by Hudson. The re—
sults are shown in Figure 8. Notice that the SimRA and the Hudson
estimates are very close to each other, over 100 runs for each config-
uration. We use the same set—up to compare the closed form ex—
pected values of the last section to the observed empirical values.
Again, note the tightness of the approximations. In addition, Figure
12 in the Supplementary shows the expected height of truncated
ARG compared against the observed values using both SimRA and
Hudson, with similar accuracy.

6.3 Time and space performance

Figure 9 shows the results of the comparative time and space per—
formances. SimRA shows consistently superior performance in both
time and space, and, the difference is particularly accentuated with
increasing values of recombination rate r. For higher values of r, the
time and space requirement is nearly two orders of magnitude higher
for Hudson.

In particular, for the study summarized in Figure 10, the Hudson
algorithm had to be aborted and re—run several times and it took
over six months just to complete, while SimRA was done with the
four hundred runs in less than half a day.

6.4 Non—redundant ARGs of SimRA

How redundant is the ARG network sampled by an algorithm? If
we assume that all the marginal trees and the resulting samples are
the essential content of a simulation, then it is meaningful to ask
what portion of the ARG resulting from a simulation has no contri-
bution to the essential content. This is formally studied as the min-
imal descriptor in Parida et al. (2011) and other details pertaining to

91% ‘09 1sn8nv uo sojoﬁuv s01 ‘121u10111123 10 A11SJQA1IIH 112 /810'spaumo[p101x0's31112111101u101q//:d11q 111011 pop1201umoq

A.P. Carrieri et al.

 

 

 

 

 

 

 

 

 

1056
1 o I o I I E E I
0.98- E -
0.96—   E  '
0.94—     —
H— — .  
0.9— — —
0_88_ |:| SImRA _
I:I Hudson
0  I I I I
' 0.01 x 10'8 0.05 x 10'8 r 0.1 x108 0.3 x 10-8

Fig. 10. The box-and-whisker diagrams of the compaction factor f, for differ-
ent values of r. The other parameter values are the same as used in Figure 9
and for each parameter setting both the algorithms were run 100 times. ARGs
produced by SimRA are consistently more compact (or less redundant) than
that of Hudson

the execution of the experiments are presented in Supplementary
Section S4.

Let the compaction factor f be defined as the ratio of the number
of nodes in the minimal descriptor to the number of nodes in the ori—
ginal ARG as in (Utro et al., 2013). Thus the closer the value of f to
1, the less redundant is the ARG and thus more compact. Figure 10
shows that the ARGs produced by SimRA are systematically more
compact than the ones produced by the Hudson algorithm. This is
particularly accentuated for higher values of r.

7 Conclusion

The design of the SimRA algorithm was influenced by the implica—
tions of the Ancestor Without Ancestry Paradox, which also paved
the way for computing the closed forms of the expected values of
the ARG characteristics. To the best of our knowledge this is the
first time analytic formulae have been given for an ARG.

Such closed—forms, apart from mathematical completeness, also
serve multiple practical purposes.

Ironically, it obviates single population simulations in many situ—
ations where the interest is only in the characteristic estimates. In
others it provides a framework for evaluating correctness of the
ARG sampling algorithms. Also, for complex scenarios such as the
ones with population scaffold architectures it aids in parameter spe—
cification (this is illustrated in Supplementary Section S5).

Through extensive comparison studies, we demonstrated that
the ARGs produced by SimRA are more compact, more efficient in

time and space, without compromising accuracy. Currently we are
looking into extending SimRA to incorporate other demographic
models including selection.

Acknowledgments

We are thankful to Saugata Basu for his insights on measure theory. We are
also grateful to Daniel Platt for many useful discussions, particularly on STR
variations in populations. Part of the SimRA implementation was carried out
by APC when she was Visiting IBM Watson Research Center.

Conﬂict of Interest: none declared.

References

Grifﬁths,R.C. and Marjoram,P. (1997) An ancestral recombinations graph.
In: Donnelly,P. and Tavare,S. (eds.) Progress in Population Genetics and
Human Evolution. IMA Vols in Mathematics and Its Applications, Springer,
New York, USA, 87, pp. 25 7—270.

Hein,]. et al. (2004) Gene Genealogies, Variation and Evolution: A Primer in
Coalescent Theory. Oxford University Press, USA.

Hoban,S. et al. (2012) Computer simulations: tools for population and evolu-
tionary genetics. Nat. Rev. Genet., 13, 110—122.

Hudson,R. (2002) Generating samples under a WrightFisher neutral model of
genetic variation. Bioinformatics, 18, 337—338.

Kingman,]. (1982) On the genealogy of large populations. ]. Appl. Probab.,
19, 27—43.

Parida,L. (2010a) Ancestral recombinations graph: a reconstructability perspec-
tive using random-graphs framework. ]. Comput. Biol., 17, 1345—1350.

Parida,L. (2010b). Graph model of coalescence with recombinations. In:
Heath,L. and Ramakrishnan,N. (eds.) Problem Solving Handbook in
Computational Biology and Bioinformatics, pp. 85—100.

Parida,L. (2012). Non-redundant representation of ancestral recombinations
graphs. In: Anisimova,M. (ed.) Evolutionary Genomics: Statistical and
Computational Methods: Volume 2.

Parida,L. et al. (2011) A minimal descriptor of an ancestral recombinations
graph. BMC Bioinformatics, 12, S6

Parida,L. et al. (2015) Topological signatures for population admixture.
RECOMB LNBI, 9029, 261—275.

Schaffner,S. et al. (2005) Calibrating a coalescent simulation of human gen-
ome sequence variation. Gen. Res., 15, 1576—1583.

Utro,F. et al. (2013) Sum of parts is greater than the whole: inference of com-
mon genetic history of populations. BMC Genomics, 14, S10

Varadhan,S.R.S. (2001). Probability Theory, Volume 7 of Courant Lecture
Notes in Mathematics. New York University, Courant Institute of
Mathematical Sciences/American Mathematical Society: New York/
Providence, RI, USA.

91% ‘09 1sn8nv uo sojoﬁuv s01 ‘121u10111123 10 Amie/nun 112 /810'spaumo[p101x0's31112111101u101q//:d11q 111011 pop1201umoq

