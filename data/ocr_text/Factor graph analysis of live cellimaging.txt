Bioinformatics, 31(11), 2015, 1816—1823

doi: 10.1093/bioinformatics/btv040

Advance Access Publication Date: 31 January 2015
Original Paper

 

Bioimage informatics

Factor graph analysis of live cell—imaging data
reveals mechanisms of cell fate decisions

Theresa Niederberger”, Henrik Failmezger2'3'f, Diana Uskat”,
Don Poron3, Ingmar Glauche“, Nico Scherf4'5, lngo Roeder4,
Timm Schroeder6 and Achim Tresch1'2'3'*

1Gene Center, Department of Chemistry and Biochemistry, Ludwig-Maximilians-University Miinchen, Germany,
2Max-Planck-lnstitute for Plant Breeding Research, Cologne, Germany 3Department of Biology, Albertus-Magnus
University, Cologne, Germany, 4Institute for Medical Informatics and Biometry, Faculty of Medicine Carl Gustav
Carus, TU Dresden, Germany, 5Max Planck Institute of Molecular Cell Biology and Genetics, Dresden, Germany
and 6Department of Biosystems Science and Engineering, ETH Zurich, Basel, Switzerland

*To whom correspondence should be addressed.
TThe authors wish it to be known that, in their opinion, the first three authors should be regarded as Joint First Authors.
Associate Editor: Robert F. Murphy

Received on October 20, 2014; revised on December 31, 2014; accepted on January 19, 2015

Abstract

Motivation: Cell fate decisions have a strong stochastic component. The identification of the under—
lying mechanisms therefore requires a rigorous statistical analysis of large ensembles of single
cells that were tracked and phenotyped over time.

Results: We introduce a probabilistic framework for testing elementary hypotheses on dynamic
cell behavior using time—lapse cell—imaging data. Factor graphs, probabilistic graphical models, are
used to properly account for cell lineage and cell phenotype information. Our model is applied to
time—lapse movies of murine granulocyte—macrophage progenitor (GMP) cells. It decides between
competing hypotheses on the mechanisms of their differentiation. Our results theoretically sub—
stantiate previous experimental observations that lineage instruction, not selection is the cause for
the differentiation of GMP cells into mature monocytes or neutrophil granulocytes.

Availability and implementation: The Matlab source code is available at http://treschgroup.de/
Genealogies.html

Contact: failmezger@mpipz.mpg.de

Supplementary information: Supplementary data are available at Bioinformatics online.

 

 

1 Introduction

Cell fate decisions appear as robust phenomena on the tissue level.
However, the underlying mechanisms are hidden behind a large
variability on the level of individual cells. The deterministic and the
stochastic components of these decision processes can only be identi—
fied through the statistical analysis of a large number of cells. High
content live cell time—lapse imaging has become a major technique
for the investigation of cell behavior (Conrad and Gerlich, 2010;
Neumann et 61]., 2006, 2010; Schmid et 61]., 2013; Starkuviene and
Pepperkok, 2007). The amount of data produced by this method

requires automation at all stages, starting from cell identification
and tracking of cells, the extraction of relevant morphological fea—
tures from single cell images, up to the biological interpretation of
the results. Excellent bioinformatics tools have been developed for
the purpose of cell identification, cell tracking and feature extraction
(Buggenthin et 61]., 2013; Carpenter et 61]., 2006; Conrad et 61].,
2011; Pau et 61]., 2010; Rajaram et 61]., 2012; Scherf et 61]., 2012). So
far, biological analysis of time—lapse movies focused on the detection
of abnormal cell phenotypes after introducing perturbations like
RNA interference (Failmezger et 61]., 2013a; Fuchs et 61]., 2010).

©The Author 2015. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com 1816

112 /§JO'S{eumo [p.IOJXO'SOTlBIHJOJUTOTQ/ﬁdllq 11101; prBOIIIAAOG

9IOZ ‘09 lsnﬁnv uo ::

Factor graph analysis of live cell-imaging data 1817

 

This led to the development of hidden Markov models that, either in for maximum likelihood estimation (MLE) and the calculation of
a supervised or in an unsupervised fashion, classify cells according marginal probabilities (Kschischang et 61]., 2001). The time complex—
to their morphology and their environmental context (Failmezger ity of these algorithms is linear in the number of nodes, given that

et 61]., 2013b; Snijder et 61]., 2009; Zhong et 61]., 2012). In this work, the number of neighbors of a node is bounded (by three in our case).
we develop a factor graph model, which provides a probabilistic This allows us to run a Markov Chain Monte Carlo (MCMC) algo—

framework for testing the compatibility of biological hypotheses rithm for parameter learning. Our factor graph model for
with time—lapse imaging data. genealogies requires only seven parameters. Simulations show that
Such data allow the tracking of individual cells, comprising all of these parameters can be identified accurately. To further assess the
their progeny over extended time periods. For each cell image, fea— robustness of our model, we analyze genealogies generated by a
tures like morphology, cell—cycle time, or motility can be extracted. mathematically different and considerably more complex model of
All these different pieces of information on cellular development, stem cell differentiation (Loeffler and Roeder, 2002; Roeder and
divisional history and differentiation can be summarized into a pedi— Loeffler, 2002). We are able to recover its relevant kinetic
gree—like structure, termed cellular genealogy, in which the founder characteristics.
cell represents the root, and the progeny are arranged in the In our application, the factor graph model decides between alter—
branches (Fig. 1A). To our knowledge, only two attempts have been native hypotheses concerning the mechanisms of hematopoietic pro—
made to analyze such tree—structured data in a rigorous, probabilis— genitor cell (HPC) differentiation. It is under debate (Endele et 61].,

tic way (Durand et 61]., 2001, 2005). Using genealogies as input data, 2014; Glauche et 61]., 2009; Morrison et 61]., 1997; Rieger et 61].,
we develop a factor graph model (Kschischang et 61]., 2001), which 2009; Sarrazin and Sieweke, 2011) whether cytokines instruct the

describes the genealogy by a random biological process with mean— differentiation of progenitor cells into specific cell types, or whether
ingful and interpretable parameters. Factor graph models have been they select lineage committed cells types by allowing their prolifer—
tremendously successful in coding theory (Chung et 61]., 2001; ation or survival. Looking merely at the relative cell abundances at
Tanner, 2006) because they give rise to highly efficient algorithms the end of the differentiation process, all scenarios lead to

A Data processing B
"

.di.

. |_l
x!"  . — '_ - 7"
j ' 'l \ -'...
xﬂliﬁ .—z~———, —>
I I‘ I. all. .— uu u- - .— ' _ - - I I -
. - r I
I - II ' l  |
. I_' I '-II lI-IJ1JIIFI-IJ-lill-IHIIH-l'l I Il-IJH H: I
I g . '  | |

C Model speciﬁcation

 

     
  

 

   

    

 

PlOl O)

| l
observations hidden state

09. L

 

 

 

 

 

 

 

 

 

 

E
E E LysM-GFP - + +
E = Anti-Ly-EG — + -
‘B :5 .
anti-F4/80 - - +

 

Fig. 1. Conversion of a time lapse video into a factor graph. (A) Image processing. Left: Cell entities are identified on a series of consecutive pictures of the same
area on a cell culture plate. They are linked to their respective predecessor on the previous image. Right: The topological information on cell fates is represented
as a genealogy, a forest of rooted binary trees. Nodes represent cells at a certain time point, and edges indicate the parent-offspring relation from top to bottom.
The vertex color informally indicates phenotypic information assigned to each cell, such as the presence or absence of fluorescent cell type markers. (B)
Construction of the factor graph. Each node of the genealogy is represented by a hidden variable node (empty circle), and the probability of an event linking cells
between consecutive time points is represented by a hidden factor node (empty square). The cell image data are represented by observable variable nodes
(shaded circles). An observable factor node (black square) links each observable variable node to its corresponding hidden variable node, and it encodes the
probability of observing the image data, given the hidden cell state. The factor graph encodes the model's likelihood function, the product of all factor nodes. (C)
Specification of the local probability functions assigned to the factor nodes. We assume that each cell can be in one of three states (blue:progenitor cell state, red/
green: differentiated states). Left: Each edge in the graph represents one of four events that can occur: persistence of the cell, cell division, differentiation, and
apoptosis. The edges are labeled with the (unknown) probabilities for the respective event, which determine the probability functions of the hidden factor nodes.
Right: The functions related to the observable factor nodes are conditional probability distributions of the single cell image data, given the cell's state

112 /810'S[12umo prOJXO'SOTl‘BIHJOJUTOTQ/ﬂClllq 11101; prBOIIIAAOG

9IOZ ‘09 lsnﬁnv uo ::

1818

T.Niederberger et al.

 

indistinguishable outcomes, namely the dominance of one cell type.
We construct a reversible—jump MCMC algorithm, which is able to
identify the most realistic scenario as well as the corresponding lin-
eage specific differentiation, proliferation and cell death rates. Our
analysis of a HPC time—lapse imaging experiment (Rieger et al.,
2009) identifies unequal proliferation as the driving force for the
asymmetric differentiation of murine granulocyte—macrophage pro—
genitors (GMPs) cells into either mature monocytes or neutrophil
granulocytes.

2 Methods

2.1 Data acquistion

The data in Rieger et al. (2009) consist of genealogies generated
from live cell imaging of murine GMPs cells in the presence of only
macrophage— or granulocyte colony—stimulating factor. Cells con—
tained a LystzGFP marker, expressing enhanced green ﬂuorescent
protein (GFP) from the lysozymeM gene locus as an early molecular
reporter for unilineage commitment. Weak lysozymeMzzGFP expres—
sion is found in undifferentiated GMPs, whereas its expression is
drastically up—regulated in differentiated cells. At the end of the ex—
periment, stainings were performed according to standard immuno—
ﬂuorescence procedures (see Methods in Rieger et al., 2009). Cell
morphology and Anti-Ly-6G (Miltenyi Biotech) and anti—F4/80
(eBioscience) were used for the identification of granulocytes and
macrophages, respectively. Absence or presence of a marker was as—
sessed manually by an expert. Potential discretization errors when
converting a continuous ﬂuorescence signal to a binary signal were
accounted for in Equation (5) of the main text. To avoid biases from
incomplete tracking, cell division events in which only one daughter
cell could be tracked were discarded by cutting the tree above the
event.

2.2 Modeling of genealogies as factor graphs

Time—lapse movies encode two principally different types of infor-
mation. Apart from single—cell image data at each time point, movies
track cellular genealogies, i.e. they record the history of a cell popu—
lation at the individual cell level. Let V be the set of all single cell
images that have been acquired. Image analysis yields a set of statis—
tical features 0y, 0 : {ov|z/ E V}, derived from each single cell
image. Additionally, through cell tracking, we obtain a collection F
of rooted binary trees with node set V. An edge 11 —> w is drawn
whenever I) and w are cell images in consecutive frames of the mov—
ie, and if w shows either the same cell as v or an offspring of 11 (see
Fig. 1A). For an edge 11 —> w, z/ is called a parent of w, and w is call—
ed a child or offspring of v. The (possibly empty) set of children of a
node v is denoted by 619(1)).

Our key concept is to model dynamic cellular processes as prob—
abilistic transitions between discrete ‘states’ S of a cell. Because the
cell states typically cannot be observed directly, we call these states
hidden. For HPC differentiation, e.g. we assume that each cell at a
given time point is either in a undifferentiated (blue) cell state, or it
is in one of two (red respectively green) differentiated cell states
(Fig. 1A). Hypotheses on the differentiation mechanism can be easily
formulated in terms of these states: do red cells die faster than green
cells? Do blue cells preferentially develop into green cells rather than
red cells? In each time interval between two images, i.e. along each
edge of the genealogy, one of the following events can occur: most
likely, a cell will persist in its current state. Alternatively, the cell
may divide, die, or, in case of a progenitor cell, differentiate into a
red or a green cell. Each of these events has its own, unknown

probability (Fig. 1C). We have only indirect information on a cell’s
state, given by the features extracted from its cell image, such as the
ﬂuorescence intensity of a progenitor cell marker. Those features
provide evidence for or against a certain cell state, since each cell
state has a characteristic feature distribution. The learning of the un-
known event probabilities from uncertain information is a standard
task in statistical learning. If the genealogies were linear, i.e. if the
cells never divided, the classical approach to our problem would be
a hidden Markov model (Held et al., 2010). However, cell fate and
cellular decision making are intimately linked to cell division events,
for which reason we need to model non—linear genealogies. Our fac—
tor graph model can be viewed as a generalization of the hidden
Markov model to network topologies. Noteworthy, our factor
graph model does not belong to the class of Bayesian networks, as
Bayesian networks require cell states of two daughter cells to be con—
ditionally independent given their parent cell’s state. This property
is often violated in practice, asymmetric cell division in
Saccharomyces cerevisiae being a well—known example (Lord and
Wheals, 1980).

The factor graph assigned to a genealogy consists of two node
types, variable nodes and factor nodes (Fig. 1B). To each cell image
11 E V, we define a variable node Hy representing the cell’s hidden
state. A parent cell 11 and its daughter cell(s) 619(1)) are linked by a
factor node f,, which encodes a probability function of its adjacent
variable nodes (Fig.1C). Here, fU(HC/,(U),HU; 0) is the probability
that a cell 11 of type H1, E S : {blue, green, red} will give rise to 0,
1 or 2 offspring of type Helm) in the next time step. Here, 0 denotes
the parameters of our model. Motivated by the fact that the cell
states S cannot be observed directly, we call this part of the model
the hidden layer, and its nodes are called the hidden nodes. The se—
cond, observable layer consists of (observable) variable nodes Op,
11 E V, which represent the image features extracted from v. The ob—
servable node 0,, is linked to its corresponding hidden node Hy by a
factor node g,, encoding a probability function of its adjacent vari—
able nodes (Fig. 1C). Here, the emission function gU(OU,H,,; 0) en-
codes the probability of observing the image features OU, given that
the hidden state of cell 11 is Hy. The graph we have constructed is bi—
partite in the sense that factor nodes are connected to variable nodes
UGV, O : (OU)U€V. We assume
that the joint probability of (9, H and F decomposes according to

only, and vice versa. Let H : (Hy)

the factor graph topology, i.e. it is the product of its factor nodes g,
and by:

P((’), H; a) = P(O|H; a) -P(H; a)
= HP(OulHy; 6) Hivwa e cb(z/)|H,,; 9)] (1)

UEV UEV
::gv(ovaHv§6)

 

22ft! (Hch(v) 7Hvi6)

We point out that the factor graph representation of the joint
probability in Equation (1) does not agree with the factorization
induced by the interpretation of the genealogy as a Bayesian net—
work and its subsequent canonical conversion into a factor graph
(see Kschischang et al., 2001, Section B)

2.3 Parametrization of the factor graph model

First, we need to choose the number |S| of cell states, one for each cell
type, and then define the possible events (cell division, differentiation,
apoptosis, no event) that may occur between two observation time
points (Fig. 1B). The probabilities for these events are encoded in the
functions fU(HC/,(U),HU; 0) : P(Hw, w E ch(z/)|HU; 0). Formally, this
requires |S|, |S| -  — 1), and |S| - (|S|2 — 1) parameters for respect—
ively |ch(z/)| : 0,1,2 daughter cells of a cell 12. In our application,
S has three elements, which amounts to 32 parameters. However,

112 /§JO'S{12umo [p.IOJXO'SOIlBIHJOJUIOIQ/ﬁdillq 111011 pop1201umoq

9IOZ ‘09 lsnﬁnv uo ::

Factor graph analysis of live cell-imaging data

1819

 

prior knowledge can reduce this number substantially. The probabil—
ity of an apoptosis event (619(1)) : (D) is given by

fv(Hv : 5;  : apopsa 5 E S (2)

We set apopruc : 0, because we do not observe progenitor cell

death events during the observation period. If f,, represents a cell div—
ision event (|clo(z/)| : 2),

fl/(Hcla(v) = ($1752), Hy = S; 9) =

divides ifs1 : $2 = s
(3)

0 else

In Equation (3), we are assuming that the daughter and parent
cells in cell division events are in the same state. If fy represents per—
sistence or differentiation (|clo(z/)| : 1), we let

fv(Hch(1/) = t, Hy = S; 9)
diff, if s : blue, t 7E blue

1 — diffred — diffgreen _divideblue if s : blue, t : blue

— aPOPbiue

1 — divides — apops if s : t 7E blue

0 else
(4)

The latter choice is motivated by the fact that only progenitor
cells (blue state) are able to change their state into one of the differ-
entiated cells. Altogether, the hidden layer of our factor graph model
is determined by only seven parameters, 0 : {divideblum dividet,
apopt, difft; t : red, green}.

Second, we have to relate the cell states to the image data.
Several techniques have been developed to identify these states either
by in vivo fluorescence staining or by immunostaining after fixation.
All these methods have their drawbacks: the marker might not work
with equal efficiency in all cells. Fluorescence intensity is a continu—
ous marker, and converting it to a discrete signal can cause discret—
ization errors. The information provided by these markers may be
incomplete, e.g. in the case of the Lysm marker in our experimental
data (Rieger et al., 2009), the upregulation of Lysm ﬂuorescence sig—
nal merely indicates that the cell is no longer in the progenitor cell
state, but it does not tell whether it has become a red or a green cell.
The second marker (F4/80) is detectable only if the cell is a mono—
cyte, but it does not distinguish between progenitor cells and gran-
ulocytes. Using the combination of both markers, we have a ternary
yet error—prone readout indicating the state of each cell. We model
this by letting

(gt/(OuaHt/i  : P(OU|HU; 

0.8 if readout 0,, is indicative of states, andHU = s

P(OU|HU§ 0) Z {

0.1 if readout 0,, not indicative of states, and H1, 7E s
(5)
We verified that the concrete choice of the numerical values in

Equation (5 ) is of minor importance and does not inﬂuence our final
model decision qualitatively (data not shown).

2.4 Parameter estimation and hypothesis testing

It is crucial that the factor nodes encode ‘local’ probability functions
in the sense that they depend only on their respective neighboring
variable nodes. Because the hidden states are unknown, we are inter—
ested in calculating the marginal likelihood,

L(6) = no; a) = 2110, H = h; a) (6)
la

L(0) is obtained by summation of the full likelihood over all pos—

sible hidden state combinations lo : (19,) 19,, E S. Factor graphs

UEV7

give rise to efficient algorithms for MLE (max-sum algorithm) and the
calculation of marginal probability distributions (sum—product algo—
rithm) which are linear in the number of nodes see, e.g. (Bishop,
2006, Chapter 8) as long as the number of neighbors of a factor nodes
is bounded. The processing of genealogies with thousands of variables
with the standard algorithms is numerically unstable. The calculations
were therefore implemented in log space (see Niederberger et al.,
2012) Supplementary Material Section S2). There are two main strat—
egies for parameter estimation: Point estimation methods, foremost
MLE, and sampling methods like MCMC sampling. Point estimation
methods typically are fast, yet they suffer from the danger of getting
trapped in a local maximum of the likelihood function. Moreover, it
is not easy to construct an MLE estimator for factor graph models
(e.g. using Expectation—Maximization (Dempster et al., 1977). We
therefore implemented a Metropolis—Hastings MCMC approach
(Supplemental Methods 821 and 82.2), which generates a sequence
® : (0, 02, ..., 0T) of parameter values drawn according to the likeli-
hood function L(0). For T large enough, the empirical distribution of
® is representative of L(0), i.e. it converges in the weak sense towards
the distribution defined by L(0). In our applications, we chose T: 20
000, and trace plots were used to verify the convergence of the
Markov chain (Fig. 2C).

Although parameter estimates alone can already provide useful
information, the strength of our model lies in the opportunity to for—
mulate biological hypothesis in terms of these parameters. A biolo—
gical hypothesis H can be compatible or incompatible with the
parameter sample 0. In our application, we address the question
whether asymmetric differentiation of progenitor cells (blue state)
into two different mature cell types (green and red state) is achieved
by selection or instruction. In a hypothetical selective scenario H561,
progenitor cells divide into red and green state cells with roughly the
same probability, but the apoptosis rate of green and red state cells
may differ. As an alternative hypothesis, in an instructive scenario
Hinst, apoptosis rates of the mature cells are approximately equal,
but the probability for progenitor cells to differentiate into a green
or red state cell may differ. Both hypotheses can be formulated in
terms of the factor graph model parameters. In the selective scenario
H561, we assume dividered : dividegreen, whereas in the instructive
scenario Hinst, we assume and apopred : apopgrem. Thus, the space
@inst of parameters compatible with Hinst is different from the par-
ameter space @561 compatible with H561. We use a reversible jump
MCMC algorithm for the sampling 01, 02,  from @inst U @561 (see
Supplementary Material 823), which can switch between the two
parametrizations @inst respectively @561 of the factor graph
model.The decision between two competing hypotheses is based on

the ratio log (WTgi‘ﬂ) Large values prov1de ev1dence for the 1n—

structive, small values provide evidence for the selective scenario.
The code for the sum—product algorithm and for the reversible jump
MCMC algorithm Supplemental Methods 823.

3 Results

3.1 Parameters can be identified from a moderate
number of genealogies

Given the experimental data ((9, F), our goal is to identify the model
parameters (the unknown probabilities characterizing cell—type spe—
cific behavior) with sufficient precision to draw biological conclu—
sions from it. The success of the method depends on its
discriminatory power and on the amount of available data. We have
addressed both issues in an extensive simulation study. We check
whether a ‘true’ set of parameters can be recovered from data, which

112 /§JO'S{12umo [p.IOJXO'SOIlBIHJOJUIOIQ/ﬁdillq 111011 pop1201umoq

9IOZ ‘09 lsnﬁnv uo ::

1820 T.Niederberger et al.

 

lnstructive Scenario Selective Scenario

A

 

 

 

 

 

 

 

 

 

 

__———-
Selective

112 112
H —Stemeell —Elemeell
a: — LIneege 1 _ Lineage 1
E '11 _ Lmeagei 0.1 _ Lineage:
a Lemwﬁﬁﬁ

ﬂ -r __ __ J— J— —_I_——_I_— "' "'

111 O1

 

 

 

 

 

Plague)
T if
([s
{H

r
siﬂs

slﬂa

 

 

 

 

 

 

 

 

 

 

 

o
o: o 2
E
1;; M m
n. S
o u o
1 5 1o 2o so so so 1 5 1o so so 4o so

Number of Trees Number of Trees

11 11) “11111111

Instructive
Selective

Etemoeu
— Lmeage 1

Genealogies m

 

{'3'

 

 

— mee '1
Lineage 2

[1.1
iq'ljiLij-lfafiij' [1.05 '_ _ I I_ L” __ _ I_ l I ..Pi'lj. 1 , _. .1. ' I, . r.
in“) "11"1llllr-l In!“ {'1 "1‘ 1' +l’i‘i'
D .

 

. Idl'P ]

i 1 ' ﬂ, 1 2
 1 00111111111111 :11)
, ii ' ' ” ' '

2----F---- 12 rs
EMWW'Q L_  mikde 

o
zooo 1sooo ioooo zoooo o 1ooo zooo isooo 1oooo zoooo
Number of Iterations Number of Iterations

 

 

 

 

 

 

 

 

 

if

 

 

Fig. 2. Parameter sampling and hypothesis discrimination by reversible jump MCMC in a simulation of an instructive scenario (left-hand side) and a selective
scenario (right-hand side). (A) For each scenario, we simulated experiments with different numbers of trees (1, 5, 10, 20, 30, 40, 50). Boxplots of the predicted dif-
ferentiation, apoptosis and division probabilities, as well as the proportions of the predicted scenario depending on the number of trees are shown. The horizon-
tal lines depict the simulated ('true') parameter values which were used for the generation of these simulated genealogies. On the x-axis the numbers of trees
used for the predictions are depicted in increasing order whereas each dataset is a subset of the next one in size. The barplot at the top pictures the scenario pro-
portion, where instructive is colored in brown and the selective in yellow. The boxplots are divided into three subgroups according to the predicted probabilities
for differentation (top), apoptosis (middle) and division (bottom) whereas the used colors correspond to the three different lineages. Note that for |trees| =1 the
boxplot boxes may exceed the displayed range of values. (B) Simulated trees for selective scenario and instructive scenario, which are used for the prediction
(here: |trees| = 10). The colors correspond to the one in (A) where progenitor cells are blue and the two different lineages are red and green. (C) Trace plots for all
predicted parameters and the jumps between the two scenarios (here:|trees| = 10), to ensure convergence of the Markov chain. Note that only the beginning and
the end of the 20 000 MCMC iterations are shown. The barplot (top) describes the reversible jump between selective and instructive by depicting the respective
scenario for each given iteration step. The colors for the jump representation and the trace plots as well as for the parameters correspond to those in (A). Grey in-
dicates that the corresponding parameter is the same for both lineages in the currently selected model class. The horizontal dashed lines visualize the simulated
('true’) parameter values

112 /310'S[12u1n0 prOJXO'SOTIBIHJOJIITOTQ/ﬂClllq 11101; pep1201um0q

9IOZ ‘OE lsnﬁnv uo ::

Factor graph analysis of live cell-imaging data

1821

 

 

 

 

 

 

lﬂﬂ'i'b—

513%

ossg

113091:—

50%

DE'vf:__
25 DJ “J H} O} a:
so: :11} 3:11 :o: 3::-
s-2 s2 's-s s2 ss
:13 :13 :13 :13 :o:
my; 1:5,:- .-=3_: :21 he;
E: a} H} q; H! q; as q; d5 {:3
- I: I: n: I:
Goo _oo _oo _oo -5
'- {:3 CK} EN! hf? 1!? ENE CE} {I} '-

IIIIIIIIIIH'II'H
mmuIHHH

III}
Illlliltlllll
I :. liillllllll

II
III
III

IIIII*IIIIIIIIlI-III

IIIII“II
II II
I
IIIII
|l
HIlllll

lilllllllilllll'illll
I

IIIIIIIIIIII
III

I

I

Illimmlmm

H

I"
I

ll

“mm
'::,.irilii*'
I

"mm

H

HH'HHHIHH
u.

“H”

HI

I“

Ill
IIIIIIIIIIIIIIIIIIIIIl-II-III

HH
*III*I.t+IIIIIIiiII+iI

II
“II

I I

IIIIII
IIIIIII
IIIIIII

Fig. 3. Hypothesis discrimination between selective and instructive scenarios. Discrimination on simulated data from the factor graph model (upper row) and
from the model in (Loeffler and Roeder, 2002; Roeder and Loeffler, 2002) (lower row) (A). 10 trees were used in each of 100 MCMC runs. The 10 trees consisted of
j: 10, 8, 5, 2, 0 (left column to right column) trees taken from a selective scenario, and 10 —jtrees from a selective scenario. The illustration shows the percentage
of cases in which the MCMC algorithm preferred the selective (yellow) or the instructive scenario (brown). Examples of simulated genealogy trees for the instruct-
ive scenarion (upper row, j: 10) and the selective scenario (lower row, j: 5) are shown in (B)

has been simulated using these parameters. We generated data sets
of different sizes and ran the MCMC estimation procedure, which
gave us credible intervals for the individual parameters. As expected,
the accuracy of parameter estimation increased with the amount of
data. It turned out that for realistic parameter choices (see Fig. 2 and
Supplementary Figs. S2 and S3), a moderate number of about 20
genealogies was sufficient for accurate parameter identification and
a reliable decision between the instructive and the selective scenario.
This is substantially less than the N200 genealogieswith an average
of 12 cell division events in the experimental data.

The simulation also allowed us to exclude severe estimation
biases resulting from our MCMC procedure. By mixing genealogies
from a selective and an instructive scenario at different ratios, we
verify that the estimation procedure is robust. It generally tends to
decide for the scenario from which the majority of the genealogies
were taken from (see Fig. 3). The results also revealed that the esti—
mation procedure is slightly biased towards the selective scenario.
This has to be taken into account when evaluating the results from
experimental data.

Hypothesis discrimination in realistic models of cell
differentiation

So far, we merely verified the reliability of our method in the ab—
sence model bias, i.e. if the data used for parameter learning was
generated from the factor graph model itself. However, our model is
a gross simplification of the real biological processes. We therefore
tested the performance, in particular the model bias, in a more real-
istic model of hematopoietic stem cell organization (Loeffler and
Roeder, 2002; Roeder and Loeffler, 2002; Glauche et al., 2007). In
this model, stem cell differentiation is described as a temporally ex—
tended process with a progressive restriction in lineage potential, in
which the decision process is intrinsically random, albeit tuneable

by lineage instruction or selection. Applying our analysis to a set of
model—generated genealogies, we observe that the true scenario
(selective/instructive) can be recovered from merely 10 trees in
~90% of all cases. Again, we mixed genealogies generated by the
two scenarios at different ratios and monitored the decision of our
method. The results confirmed a slight bias towards the selective
scenario (Supplementary Fig. S3). The most likely explanation is
that selective scenarios can be recognized by a combination of fluor-
escence signal and topological information (shorter branches in the
tree are indicative of apoptosis events), while evidence for instruct—
ive scenarios arises merely from the ﬂuorescence signal. Because the
Loefﬂer/Roeder/Glauche model predicts uneven apoptosis probabil—
ities for the two differentiated cell types, even in an instructive scen—
ario, this leads to the observed bias. We emphasize that our
biological conclusions in the subsequent application are unaffected,
because they point in opposite direction, towards an instructive
scenario.

Preferential differentiation of murine GMPs into
monocytes or neutrophil granulocytes cells is achieved
by an instructive mechanism

It is still under debate how the commitment of multipotent HPCs to
single lineages is controlled (Endele et al., 2014; Morrison et al.,
1997; Glauche et al., 2009; Rieger et al., 2009). Cytokines are
known to inﬂuence cell fates, but the driving mechanism is still un-
clear: Is lineage commitment achieved only in a selective manner, by
allowing the survival and proliferation of cells belonging to one lin-
eage, or are they able to directly instruct lineage commitment?
(Rieger and Schroeder 2009) tracked the development of murine
GMPs (blue state) into mature monocytes (M, red state) or neutro—
phil granulocytes (G, green state) on the single—cell level (Rieger
et al., 2009). We applied our factor graph model to genealogies

112 /§JO'S{12umo [p.IOJXO'SOIlBIIIJOJUIOIQ/ﬁdllq 111011 pop1201umoq

9IOZ ‘09 lsnﬁnv uo ::

 

 

 

 

 

 

 

 

 

 

 

 

1822 T.Niederberger et al.
A [1.06 I B a C [135 .
Progenitor call I III: ﬂImﬁ _
I3 I35 _ Monocvte g
I Grenulocy‘te II: 3.04 F
'2 boss -
1 13.34 - —
H I
E _ I I_III one
11: one — 3‘15 ooze-
J] (D 'U
E  ooz-
F‘- o o2 - ‘3
. T g oois
I11.“)
0') [1.01
o.o1 -
E o.oos-
D I i i é J I. |

cliff1 diff2 apﬂp1apﬂp2 divIIJI div, div2

Parameter

{1.1315 I102 0.12125 [1.133 {1.133

diff1

D 1 I
D 0.01215 1101

Fig. 4. Parameters estimated from the progenitor cell differentiation data (A). Boxplots summarize the mean parameter values obtained from 10 independent
MCMC runs. (B) The instructive scenario was preferred in 88% of all steps over the selective scenario. (C) Plot of the joint parameter values (diffrednbsp;, diffgreen)
for 4 MCMC runs (yellow, light/dark blue, red). Grey dots on the main diagonal indicate steps in which the MCMC chain was in a selective scenario

from this data set to shed light onto the driving mechanism (see e.g.
Supplementary Fig. S4). Our genealogy consists of 200 trees con—
structed from data as provided by the authors of the study (Rieger
et al., 2009). This amount of data could not be processed by our
method as a whole. The data were randomly split into 10 disjoint
data sets with 20 trees each. Consistent with the findings obtained
by visual inspection in (Rieger et al., 2009), the factor graph model
identifies an instructive mechanism as the cause of a strong preferen—
tial differentiation into monocytes or granulocytes, respectively. The
reversible jump MCMC favors the instructive scenario over the se—
lective scenario in 88% (Fig. 4B). Recall that our model has a slight
estimation bias towards selective scenarios, so we can exclude bias
as the cause for our findings. In the instructive scenario, the prob—
ability for the differentiation of a progenitor cell into a granulocyte
is estimated as 0.012 per time step (median of all sampled probabil—
ities) versus 0.007 per time step for monocytes (Fig. 4A). This differ-
ence becomes even more evident in Figure 4C, which shows a
scatterplot of the two differentiation probabilities along four
MCMC chains. The sampled values of diff2 exceed the correspond—
ing values of diff1 in all but very few exceptions. The probability
of going into apoptosis is estimated as 0.002 (median of sampled
probabilities) and thus substantially smaller than the differentiation
probabilities. Further, the cell type specific growth speed, i.e. the
division rate was remarkably similar (Fig. 4A).

4 Conclusion

High throughput time—lapse imaging poses new challenges to compu—
tational biology. The analysis of cellular genealogies requires the de—
velopment of statistical methods that are able to test hypotheses on
data with a branched dependency structure. The most advanced
method so far that deal with this kind of data is Markov tree models
(Durand et al., 2001, 2005). They can be cast as factor graph models,
in which the fate of the children is assumed independent of each
other, given the (state of the) parent cell. This assumption has the ad—
vantage that Markov trees allow the straightforward generalization
of the Baum—Welch algorithm for parameter learning. However in
cases when diverging daughter cell fates are coupled, this model is not
appropriate. We have developed a simplistic, but efficient factor
graph model, which can test the compatibility of basic biological
hypotheses with this kind of data. The factor graph model has an

intuitive parametrization of its factor nodes, which reﬂects key prop—
erties of the cellular system (differentiation, proliferation, apoptosis).
Biological hypotheses can be formulated in terms of parameter restric—
tions. The local factor nodes and their parametrization can be
exchanged very easily in this framework. Thus, our model can be eas—
ily adapted to model high—dimensional readouts from each cell image,
or to model other cell states (aneuploidy, cancerosity, quiescence).
We perform hypothesis discrimination and parameter estimation
using a reversible jump MCMC algorithm. More efficient algorithms
for parameter estimation such as an EM—algorithm would be conveni—
ent; they are currently under development. Due to its ﬂexibility, we
expect the factor graph framework to have a wide range of applica—
tions, in particular because advances in microscopy allow the investi—
gation of cell—to—cell (state) variability at the subcellular level.

The factor graph model can be extended to account for the
micro-environment of a cell, given by cell contacts, cell wall turgor,
local concentration of signaling molecules, or concentration gradi—
ents. Such variables might be included into the observations vector
0,, for each cell image 12. A promising application will be the model—
ing of multicellular organism development. For example, plant em—
bryos can be tracked, and at the same time chemo—physical
properties of each cell can be measured (Kierzkowski et al., 2012),
which can reveal to which extent lineage, mechanical forces or loca—
tion within a tissue determine cell fate.

Acknowledgement

We thank Carsten Marr for help with the processing of the data published in
Rieger et al., 2009).

Funding

TN. and AT. were supported by an SFB 646 grant from the Deutsche
Forschungsgemeinschaft.

Conﬂict of Interest: none declared.

References

Bishop,C.M. (2006) Pattern Recognition and Machine Learning. Information
Science and Statistics. New York, Springer.

112 /810'S[12umo [p.IOJXO'SOIl‘BIHJOJIIIOIQ/ﬂChill] 111011 pop1201umoq

9IOZ ‘09 lsnﬁnv uo ::

Factor graph analysis of live cell-imaging data

1823

 

Buggenthin,F. et al. (2013) An automatic method for robust and fast cell detec-
tion in bright ﬁeld images from high-throughput microscopy. BMC
Bioinformatics, 14, 297.

Carpenter,A.E. et al. (2006) Cellproﬁler: image analysis software for identify-
ing and quantifying cell phenotypes. Genome B iol., 7, R100.

Chung,S.-Y. et al. (2001) On the design of low-density parity-check
codes within 0.0045 db of the shannon limit. Commun. Lett. IEEE, 5,
5 8—60.

Conrad,C. and Gerlich,D.W. (2010) Automated microscopy for high-content
rnai screening]. Cell Biol., 188, 453—461.

Conrad,C. et al. (2011) Micropilot: automation of ﬂuorescence microscopy-
based imaging for systems biology. Nat. Methods, 8, 246—249.

Dempster,A.P. et al. (1977) Maximum Likelihood from Incomplete Data Via
the EM Algorithm. ]. R. Stat. Soc. B., 39, 1—38.

Durand,].-B. Goncalves,P. (2001) Statistical Inference for Hidden Markov
Tree Models and Application to Wavelet Trees. [Research Report] RR-
4248, 2001. <inria-00072339>.

Durand,].-B. et al. (2005) Analysis of the plant architecture Via tree-structured
statistical models: the hidden markov tree models. New Phytologist, 166,
813—825.

Endele,M. et al. (2014) Instruction of hematopoietic lineage choice by cyto-
kine signaling. Exp. Cell Res., 329, 207—213.

Failmezger,H. et al. (2013a) Learning gene network structure
from time laps cell imaging in rnai knock downs. Bioinformatics, 29,
1534—1540.

Failmezger,H. et al. (2013b) Unsupervised automated high throughput pheno-
typing of rnai time-lapse movies. BMC Bioinformatics, 14, 292.

Fuchs,F. et al. (2010) Clustering phenotype populations by genome-wide rnai
and multiparametric imaging. Mol. Syst. Biol., 6, 370.

Glauche,I. et al. (2007) Lineage speciﬁcation of hematopoietic stem cells:
mathematical modeling and biological implications. Stem Cells, 25,
1791—1799.

Glauche,I. et al. (2009) A novel View on stem cell development: analysing the
shape of cellular genealogies. Cell Prolif., 42, 248—263.

Held,M. et al. (2010) Cellcognition: time-resolved phenotype annotation in
high-throughput live cell imaging. Nat. Methods, 7, 747—754.

Kierzkowski, D. et al. (2012) Elastic domains regulate growth and organogen-
esis in the plant shoot apical meristem. Science, 335, 1096—1099.

Kschischang,F.R. et al. (2001) Factor graphs and the sum-product algorithm.
Inform. Theory, IEEE Trans., 47, 49 8—5 19.

Loefﬂer,M. and Roeder,I. (2002) Tissue stem cells: deﬁnition, plasticity, het-
erogeneity, self-organization and models—a conceptual approach. Cells
Tissues Organs, 171, 8—26.

Lord,P.G. and Wheals,A.E. (1980) Asymmetrical division of saccharomyces
cerevisiae.]. Bacteriol., 142, 808—818.

Morrison,S.]. et al. (1997) Regulatory mechanisms in stem cell biology. Cell,
88, 287—298.

Neumann,B. et al. (2006 ) High-throughput rnai screening by time-lapse imag-
ing of live human cells. Nat. Methods, 3, 385—390.

Neumann,B. et al. (2010) Phenotypic proﬁling of the human genome by time-
lapse microscopy reveals cell division genes. Nature, 464, 721—727.

Niederberger,T. et al. (2012) Mc eminem maps the interaction landscape of
the mediator. PLoS Comput. Biol., 8, e1002568.

Pau,G. et al. (2010) Ebimage-an r package for image processing with applica-
tions to cellular phenotypes. Bioinformatics, 26, 979—981.

Rajaram,S. et al. (2012) Phenoripper: software for rapidly proﬁling micros-
copy images. Nat. Methods, 9, 635—637.

Rieger,M.A. and Schroeder,T. (2009) Instruction of lineage choice by hemato-
poietic cytokines. Cell Cycle, 8, 4019—4020.

Rieger,M.A. et al. (2009) Hematopoietic cytokines can instruct lineage choice.
Science, 325, 217—21 8.

Roeder,I. and Loefﬂer,M. (2002) A novel dynamic model of hematopoietic
stem cell organization based on the concept of within-tissue plasticity. Exp.
Hematol., 30, 853—861.

Sarrazin,S. and Sieweke,M. (2011) Integration of cytokine and transcription
factor signals in hematopoietic stem cell commitment. Semin. Immunol., 23,
326—334.

Scherf,N. et al. (2012) Imaging, quantiﬁcation and Visualization of spatio-tem-
poral patterning in mesc colonies under different culture conditions.
Bioinformatics, 28, i556—i561.

Schmid,B. et al. (2013) High-speed panoramic light-sheet microscopy reveals
global endodermal cell dynamics. Nat. Commun, 4, 2207.

Snijder,B. et al. (2009) Population context determines cell-to-cell variability in
endocytosis and Virus infection. Nature, 461, 520—523.

Starkuviene,V. and Pepperkok,R. (2007) The potential of high-content high-
throughput microscopy in drug discovery. Br. ]. Pharmacol., 152, 62—71.
Tanner,R. (2006) A recursive approach to low complexity codes. IEEE Trans.

Inf. Theor., 27, 533—547.

Zhong,Q. et al. (2012) Unsupervised modeling of cell morphology dynamics

for time-lapse microscopy. Nat. Methods, 9, 71 1—713.

112 /810'S{12umo [p.IOJXO'SOIlBIIIJOJUIOIQ/ﬁ(1111] 111011 pop1201umoq

9IOZ ‘09 lsnﬁnv uo ::

