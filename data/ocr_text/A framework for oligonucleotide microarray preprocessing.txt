ORIGINAL PAPER

doi:10. 1093/bioinformatics/btq431

 

Genome analysis

Advance Access publication August 5, 2010

A framework for oligonucleotide microarray preprocessing

Benilton S. CarvalhoI’* and Rafael A. lrizarry2’*

1Department of Oncology, University of Cambridge, CRUK Cambridge Research Institute, Li Ka Shing Centre,
Robinson Way, Cambridge CBZ ORE, UK and 2Department of Biostatistios, Bloomberg School of Public Health,

Johns Hopkins University, Baltimore, MD 21205, USA

Associate Editor: John Quackenbush

 

ABSTRACT

Motivation: The availability of flexible open source software for the
analysis of gene expression raw level data has greatly facilitated
the development of widely used preprocessing methods for these
technologies. However, the expansion of microarray applications has
exposed the limitation of existing tools.

Results: We developed the oligo package to provide a more
general solution that supports a wide range of applications. The
package is based on the BioConductor principles of transparency,
reproducibility and efficiency of development. It extends the existing
tools and leverages existing code for visualization, accessing
data and widely used preprocessing routines. The oligo package
implements a unified paradigm for preprocessing data and interfaces
with other BioConductor tools for downstream analysis. Our
infrastructure is general and can be used by other BioConductor
packages.

Availability: The oligo package is freely available through
BioConductor, http: / /WWW. bioconductor . org.

Contact: benilton.carvalho@cancer.org.uk; rafa@jhu.edu
Supplementary information: Supplementary data are available at
Bioinformatics online.

Received on March 21, 2010; revised on July 13, 2010; accepted on
July 21, 2010

1 INTRODUCTION

Open source software signiﬁcantly simpliﬁed the development
and distribution of preprocessing methods for gene expression
microarrays. The BioConductor project (Gentleman et al., 2004)
is one hub of tools for the analysis of genomic data and distributes,
among others, the affy package (Gautier et al., 2004), the most used
tool for analysis of Affymetrix gene expression arrays. In addition
to Affymetrix, other manufacturers (e. g. Illumina, NimbleGen and
Agilent) also commercialize microarray solutions, increasing the
number of applications of the technology.

With different microarray applications, the investigator can
analyze genomic data from different perspectives: Gitan et al. (2002)
use tiling arrays to identify, at high resolution, regions of DNA
and histone modiﬁcations; The International HapMap Consortium
(2003) uses genome—wide single nucleotide polymorphism (SNP)
and copy number variant (CNV) arrays to obtain: (i) genotype
calls, later used in association studies; and (ii) extract copy number
estimates to assess chromosomal aberrations; Clark et al. (2007)
use exon arrays to analyze alternative splicing. As new applications

 

*To whom correspondence should be addressed.

became available and designs by other manufacturers became more
popular (see Supplementary Material), users developed suboptimal
solutions to allow the use of the existing code in affy on these new
arrays. This strategy did not succeed because the new designs did not
share the structure used by the Affymetrix gene expression arrays,
such as density and array annotation standards.

Based on the BioConductor principles of transparency, repro—
ducibility and efﬁciency of development, we developed the oligo
package. Its infrastructure, presented in Section 2, is general
and can be used by other BioConductor packages. The package
natively supports feature—level data for different applications and
manufacturers, as shown in Section 3. It implements a uniﬁed
framework for preprocessing microarray data and interfaces with
other BioConductor tools for downstream analysis.

2 INFRASTRUCTURE

The package contains structures to simplify usage and interaction
with other packages. A clear distinction is made between feature—
level, summarized and annotation data, and this is reﬂected by the
different classes that are implemented using the S4 scheme intrinsic
to the R environment.

Before importing data, the researcher must have the respective
annotation package already installed in the system. The annotation
package provides array coordinates, feature types, sequences,
feature names and other relevant information for preprocessing.
Affymetrix shares these data using a number of ﬁle sufﬁxes: CDF
(expression and SNP arrays), BPMAP (tiling arrays) and PGF + CLF
(exon and gene arrays). NimbleGen distributes their annotations
through NimbleGen Design Files (NDFs), regardless of the array
type, but an additional position (POS) ﬁle, containing up—to—date
genomic coordinates, is not uncommon. Table 1 describes the
sufﬁxes used by some manufacturers, and we note that oligo
currently supports Affymetrix and NimbleGen arrays. Using the
annotation ﬁles provided by the manufacturer, the researcher
can create the annotation package using the pdlnfoBuiIder
BioConductor package.

Bolstad et al. (2003); Carvalho et al. (2007, 2010); Irizarry et al.
(2003a, 2006a, b, 2008); Ritchie et al. (2009); Scharpf et al. (2008)
show signiﬁcant improvements on the results when alternative
algorithms are used as replacement for the solutions provided by
the manufacturers. In fact, the novel methodologies described by
Carvalho et al. (2007); Irizarry et al. (2008); Scharpf et al. (2008) use
early versions of the oligo package hereby described to implement
their solutions. Regardless of the application, these depend on two
factors: (i) the ability to access the data at the rawest possible

 

© The Author 2010. Published by Oxford University Press. All rights reserved. For Permissions, please email: journals.permissions@oxfordjournals.org 2363

Vol. 26 no. 19 2010, pages 2363-236 7

112 /§.IO'SIBUJHOIPJOJXO'SOIlBIIIJOJUIOIQ/ﬁdnq 11101; prBOIUAAOG

9IOZ ‘Ig lsnﬁnv uo ::

B.S.Carvalho and R.A.Irizarry

 

Table 1. File sufﬁxes used by manufacturers for different array types

 

 

 

Manufacturer Intensities Design Type
CDF Expression/SNP
Affymetrix CEL PGF + CLF exon/ gene
BPMAP tiling
Agilent GPR GAL All
Illumina TXT BPM All
NimbleGen XYS NDF All

 

The raw data ﬁles contain observed ﬂuorescence intensities used in analysis; the design
ﬁles provide information speciﬁc to the array, such as dimensions, physical locations,
probe types and sequences. Currently, oligo supports Affymetrix and N imbleGen arrays.

Table 2. Raw data and annotation classes used by the oligo package

 

 

FeatureSet class PDInfo class Arrays
ExpressionFeatureSet ExpressionPDInfo Expression
ExonFeatureSet ExonPDInfo Exon
GeneFeatureSet GenePDInfo Gene
SoneatureSet SinDInfo SNP
SannvFeatureSet SannvPDInfo SNP+CNV
TilingFeatureSet TilingPDInfo Tiling

 

level, after image processing (which is beyond the scope of this
material); and (ii) the existence of an environment that provides
analysis and visualization tools. The manufacturers whose products
are currently supported by oligo provide these data using CEL
(Affymetrix) and XYS (NimbleGen) ﬁles. These ﬁles supply array
coordinates and observed intensities, which can be easily imported
with oligo after installing the associated annotation package created
by pdlnfoBuiIder.

The oligo package implements multiple classes to manage raw
intensities. They are used to differentiate data originating from
different applications, such as gene expression versus exon data.
Because the same method can behave differently when applied
to objects of distinct applications, we make use of this feature to
increase the ﬂexibility of the package. From the eSet class deﬁned in
Biobase, we created the FeatureSet class, the template for feature—
level data subclasses. Each application has its own FeatureSet
subclass, as shown in Table 2. We make no distinction in terms of the
manufacturer: data generated on chips of the same application, even
from different manufacturers, will belong to the same FeatureSet
extension. This uniﬁed framework increases productivity, because
the preprocessing steps for arrays on the same application are
essentially the same, regardless of the manufacturer.

This infrastructure is beneﬁcial for both developers and end—users.
Developers can use oligo solutions to facilitate the integration of
their tools with BioConductor. The researcher beneﬁts from the
uniﬁed model that the package makes available, as the consistency
in data delivery and handling improves efﬁciency.

3 APPLICATIONS

In this section, we use the oligo package with data of different
types. We demonstrate its use to preprocess gene expression data in

(a) 152mm” alumna.

E

 

 

l

 

 

densrty
0.0 0.2 0.4 0.6 0.8

 

6 7 8 9 10 11 12
log intensity
Pseudo—image Smoothed histograms

(C)  - 1521amm_.m-rala.r:EL

 

IIIE

 

 

 

 

 

 

e—lléisiilll
IRE“-
co—J__L_:__L;_:_;_1_L“' 5'
  e- r: II: M
A
Box plots MA Plot

Fig. 1. The oligo package provides several tools for the visualization of raw
data, represented in the package through the FeatureSet subclasses. In (a),
the pseudo—image can be used to visually inspect the data for spatial artifacts.
Using oligo, one can produce such ﬁgures using the image method. (b) shows
the smoothed histogram, implemented in oligo via the hist method, providing
a way to compare the distribution of intensities across multiple samples. In
(c), we show boxplots generated with the boxplot method, also used to assess
the data distribution. The MAplot method can be used to generate the MA
plot shown in ((1), used to assess the dependency of log—ratios on the average
log—intensity of the data.

Section 3.1. Section 3.2 shows how it can be used to obtain genotype
calls from SNP arrays. In Section 3.3, we show how it can be used to
preprocess exon data at both exon and transcript levels. Section 3.4
uses data from tiling arrays to show how objects created by oligo
can be used with methods deﬁned by other BioConductor packages.
The Supplementary Material contains the actual code used in these
examples.

3.1 Preprocessing expression arrays

After loading oligo, the user identiﬁes the CEL or XYS
ﬁles that represent the study in question. This is done with
the list.celfiles or list .Xysfiles functions. These
functions accept the same arguments as list . files.

The read. cel files and read . xysfiles functions import
the CEL and XYS ﬁles into the R session. The returned object
belongs to one of the FeatureSet classes shown in Table 2 and
represents the raw data. These objects can be visualized through
different strategies: Figure 1 shows, respectively, the pseudo—
image, smoothed histograms, boxplots and MA plot for the Latin
Square data on the Human Genome U95 array, made available by
Affymetrix. Figurela—d are produced, respectively, with the image,
hist, boxplot and MAplot methods.

The oligo package is tightly integrated with important
BioConductor tools. Probe sequences are stored using the
DNAStringSet objects, deﬁned in the Biostrings package.

 

2364

112 /§.IO'SIBUJHOIPJOJXO'SOIlBIIIJOJUIOIQ/ﬁdnq 11101; prBOIUAAOG

9IOZ ‘Ig lsnﬁnv uo ::

Oligo package

 

 

 

E
0.4
E

ccc
CcC c
1000 cc

14

0.2
12
|

.
l|lII

. . . . I l , . .l

i I i . I l . I:

. . . . . , I , . . I T,

. . . . . , I , . . I .,

. . . . , , I , . . I .,

. . . . , , I , . . I .,

. . . . . , I , . . I .,

. . . . . , l , . .l

. . . . . , I , . . I .,

. . . . . , I , . . I .,

. . . . . , I , . . .,

. . . . , , l . ..

. . . . , , I ,.

Effect
0 0

-)
I092 intensity
10
I

A.AAA A'A,A 
AAAAAAA ETTLT “:in I I , . - - r,
*Tirwiii L 4 f f H

I
I ' L
.I.

—0 2
I
)>
>’>/
>
)>
>\)
8
|
E:::::::
l:l:l— ---- -
—
—
_"
—
I'-

 

 

 

 

 

 

 

 

—o.4
6

 

 

5 1'0 1'5 2'0 25 1 3 5 7 911131517192123
Base Position GC Frequency in 25—mers

Afﬁnity Proﬁle Intensity vs. GC content

Fig. 2. The package is tightly integrated with other BioConductor tools to
improve the user experience. (a) shows the afﬁnity proﬁle, which can be
produced with oligo. In this ﬁgure, we can easily observe the clear interaction
of nucleotide and position on the logz—intensity. For (b), storing sequence
information using the DNAStringSet class in Biostrings provides a compact
representation of the data and allow efﬁcient calculation, as shown above
with the logz—intensity boxplot stratiﬁed by GC content.

This allows a compact representation of the data and simpliﬁes
the interfacing with other tools. The getBaseProfile
and getAffinitySplineCoefficients functions can be
combined to obtain the afﬁnity proﬁle shown in Figure 2a. The
alphabetFreqaency method in Biostrings is easily used with the
pm method in Oligo to show the dependency of logz intensities on
GC content, as shown in Figure 2b.

Expression data can be preprocessed using RMA (Irizarry et al.,
2003a, b) by applying the rma method to the ExpressionFeatureSet
object. The data will be background corrected (if the background
argument is set to TRUE), quantile normalized (if the normalize
argument is TRUE) and summarized using the median—polish. The
resulting object is an ExpressionSet, deﬁned by the Biobase
package. The Supplementary Material shows one detailed example
of how to use Oligo to preprocess the expression data.

3.2 Obtaining genotype calls from SNP arrays

Carvalho et al. (2007) describe the Corrected Robust Linear
Model with Maximum likelihood distance (CRLMM) algorithm to
genotype SNP arrays. This method is implemented in Oligo and, to
use it, the investigator needs the annotation data package speciﬁc
to the design used in the experiment. These annotation packages
are available through the BioConductor website and, because
they contain hand—curated data, we recommend users refrain from
creating (with the pdlnfoBuiIder package) their own annotation
packages for SNP chips. Table 3 describes the supported designs
and the respective annotation packages.

To demonstrate its genotyping capability, we use 269 CEL ﬁles
on the XBA array, available on the HapMap website. The crlmm
function requires the CEL ﬁle names and an output directory, where
the results are stored. The output directory must not exist prior to
the call and the software will take care of this task. The crlmm
function is applied directly on the CEL ﬁles, to minimize the memory
footprint. A detailed demonstration on how to use crlmm is shown
in the Supplementary Material.

The getCrlmmSummaries function reads the results obtained
by CRLMM back into the R session. The calls and confs methods
are accessors to genotype calls and conﬁdence values. Calls are
coded as integers 1 (AA), 2 (AB) and 3 (BB). The conﬁdence score

Table 3. SNP array designs currently supported by the oligo package and
their respective annotation packages

 

Design Annotation Package

 

Mapping 50K XBA
Mapping 50K HIND
Mapping 250K NSP
Mapping 250K STY
Genomewide SNP 5.0
Genomewide SNP 6.0

pd.mapping50k.xba240
pd.mapping50k.hind240
pd.mapping250k.nsp
pd.mapping250k.sty
pd.genomewidesnp.5
pd.genomewidesnp.6

 

These annotation packages are made available through the BioConductor website and
contain hand-curated data, required by the CRLMM algorithm.

 

 

 

 

 

 

 

 

 

(alv- (bk-
0
oo 3:33:
N— 9 N— c
@009 o
a a a3? °8e>e
g 0_ ac) o_ 90 55mg Qb
w w coo 85 00
N_ N-
I I
V'_ V-
I I I I I I I I I I
—4 2 4 -4 —2 0 2 4

 

antisense

SNP_A—1725330

antisense

SNP_A-1703121

Fig. 3. Log—ratio data used by CRLMM for genotype calling, which can be
seriously affected by probe effects. In this plot, genotype calls provided by
oligo are represented in different colors (black, AA; red, AB; green, BB)
and each point represents one sample. SNP_A—1703l21 shows signiﬁcant
discrimination on both strands and, as competing algorithms, CRLMM
has excellent performance on similar scenarios. SNP_A—l725330 presents
poor discrimination on the sense strand, because CRLMM does not average
across strands, it can successfully predict the genotype calls. In comparable
situations, competing algorithms are known to fail.

is the estimated probability that the algorithm made the right call.
The plotM function provides the visualization of the results, as
Figure 3a and b show.

3.3 Preprocessing exon arrays

The Oligo package also supports the Affymetrix exon and gene
arrays. Their annotation packages are available via BioConductor.
These chips are extensions of the 3’ IVT expression arrays and,
as such, users are often interested in preprocessing them using the
RMA algorithm. With these designs, the researcher can use Oligo to
obtain RMA summaries at exon and transcript levels.

The read . cel f i les function imports any CEL ﬁle. The
software identiﬁes speciﬁcally if the ﬁles refer to exon or gene arrays
and returns an object of the appropriate class. Raw data visualization
can also be performed using the techniques presented in Section 3.1.

Similarly, the rma method provides RMA summaries and, in the
case of the exon and gene arrays, accepts one extra argument: target.
The possible values for target are probeset, core, extended
and full. The ﬁrst value will allow summarization to the exon
level; the other three provide summarization to the gene level, using
the Affymetrix deﬁnition of meta probesets.

The ﬂexibility of oligo and its annotation packages allows
integration with other BioConductor tools. Below, we use the

 

2365

112 /§.IO'SIBUJHOIPJOJXO'SOIlBIIIJOJUIOIQ/ﬁdnq 11101; popeoprmoq

9IOZ ‘lg lsnﬁnv uo ::

B.S.Carvalho and R.A.Irizarry

 

ENSGOOOOO131748

 

 

 

 

DI]

-_
Affymetrix Gene

Fig. 4. Visual representation of the observed logz—intensities
and summarized data at the exon level for a fragment of gene
ENSG00000131748. On the top panel of the ﬁgure, each line represents one
different sample; the vertical bins represent the start and end positions for
each probe (ﬁrst subﬁgure) and probeset (second subﬁgure). On the bottom
panel, the block diagram shows the probes, gene and transcript, respectively,
in green, orange and blue. Here, the oligo, biomaRt, Biostrings,
BSgenome and GenomeGraphs packages were used together to provide
an improved visualization of the data at a speciﬁc genomic location.

biomaRt, Biostrings, BSgenome and GenomeGraphs packages
to obtain more information on probesets and to visualize the results
(see Fig. 4) at a speciﬁc genomic location. The Supplementary
Material shows detailed information on how to combine sequence
information obtained through Oligo to get updated genomic
coordinates by sequence alignment using the Biostrings and
BSgenome packages.

3.4 Interfacing with ACME to ﬁnd enriched regions
using tiling arrays

The Oligo package handles tiling data from both Affymetrix and

NimbleGen, as long as the annotation packages are created through

the pdlnfoBuiIder package and installed in the system.

The functions read. celfiles2 and read.xysfiles2
can be used to import the data into the R session. The
difference between read. cel f i les/read . xys f i les and
read. cel files2/read . xysfiles2 is that the former reads
in the data as one—channel data and the latter reads it in as two—
channel data. The getNgsColors Info function parses the names
of the XYS ﬁles and returns an object with suggested channels and
sample names that can be combined with read. xys f iles2.

Using ChIP—chip data provided by NimbleGen, we use Oligo to
import the XYS ﬁles and combine their contents to create an object
that can be used with the ACME package. The ACME package
calculates enrichment, using algorithms that are insensitive to
normalization strategies and array noise. We refer the interested user
to the Supplementary Material, which contains detailed information
on the use of Oligo interfacing the ACME package. For this
example dataset, we show below some enriched regions (ﬂagged
with TF=TRUE) found on Chromosome 1 for Sample 1:

Length TF StartInd EndInd Start End
2179 FALSE 1 2179 56753 7925574

8 TRUE 2180 2187 7943079 7943879

18 FALSE 2188 2205 7943979 8009243

8 TRUE 2206 2213 8009343 8010043

251 FALSE 2214 2464 8010143 9893203

6 TRUE 2465 2470 9893303 9893803

4 DISCUSSION

The integration of data management, visualization and analysis is
essential in current research. Weaknesses in existing tools are more
evident today that more applications and array manufacturers are
available. To overcome the deﬁciencies introduced by suboptimal
solutions and improve the delivery of original strategies, we
developed the Oligo package. It uses the commonalities of
oligonucleotide microarray designs and applications to provide an
open—source solution that centralizes the preprocessing tasks under a
solid framework that can be reused by other developers, improving
the consistency between packages within the BioConductor project.

The structure used by Oligo is ﬂexible and its objects inherit
the properties of Biobase objects, using the standards set by
the BioConductor project. Because it is implemented in R, every
feature of this statistical software is at the researcher’s disposal. This
simpliﬁes the interface with many other packages from both projects
(R and BioConductor), widening the options during analysis.
Classes used by its companion, the pdlnfoBuiIder package, are
based on a broader class, offering inheritability properties and
transparency to the user, who beneﬁts from the fact that annotation
packages use SQL databases to minimize their memory footprint.

The Oligo and affy packages are closely related: the former
uses the knowledge acquired by the latter to provide solutions
for limitations found so far. The main improvements offered
by Oligo are: (i) support to multiple vendors and platforms;
(ii) efﬁcient storage and access schemes for annotation of current
high—throughput arrays, whose metadata have become signiﬁcantly
large; and (iii) native support to manufacturer ﬁles.

Using Oligo, one can handle data from different applications
(expression, tiling, SNP/CNV, exon and gene) of two manufacturers
(Affymetrix and NimbleGen), using their native ﬁle schemes,
avoiding potential problems introduced by conversion tools. We
demonstrated how one can use our package to preprocess and
visualize oligonucleotide microarray data. We show how the
package can serve as an interface between the data ﬁles and
methodologies implemented by other BioConductor packages.
These features deﬁne a uniﬁed framework that allows the efﬁcient
use of the environment set by both R and BioConductor projects
and increase the productivity of novel methods and algorithms.

ACKNOWLEDGEMENTS

Robert Gentleman, Wolfgang Huber, Martin Morgan, Seth Falcon,
Marc Carlson, Vincent Carey, Robert Scharpf and James MacDonald
for insights, comments and lengthy discussions on the package
implementation. Ming—Wen An for suggestions that signiﬁcantly
improved the readability of the manuscript. Marvin Newhouse and
Jiong Yang for all the help with the computational environment.

F anding: Doctoral scholarship awarded by the Brazilian Funding
Agency CAPES (Coordenagao de Aprimoramento Pessoal de Nivel
Superior) and National Institutes of Health grants R01RR021967
and P41HG004059.

Conﬂict of Interest: none declared.

REFERENCES

Bolstad,B.M. et al. (2003) A comparison of normalization methods for high density
oligonucleotide array data based on variance and bias. Bioinformatics, 19, 185—193.

 

2366

112 /810'smurnofproatxosor1au1101urorq//zd11q 111011 pop1201umoq

9IOZ ‘lg lsnﬁnv uo ::

Oligo package

 

Carvalho,B.S. et al. (2007) Exploration, normalization, and genotype calls of high-
density oligonucleotide SNP array data. Biostatistics, 8, 485—499.

Carvalho,B.S. et al. (2010) Quantifying uncertainty in genotype calls. Bioinformatics,
26, 242—249.

Clark,T.A. et al. (2007) Discovery of tissue-speciﬁc exons using comprehensive human
exon microarrays. Genome Biol., 8, R64.

Gautier,L. et al. (2004) affy—analysis of affymetrix genechip data at the probe level.
Bioinformatics, 20, 307—315.

Gentleman,R.C. et al. (2004) Bioconductor: open software development for
computational biology and bioinformatics. Genome Biol., 5, R80.

Gitan,R.S. et al. (2002) Methylation—speciﬁc oligonucleotide microarray: a
new potential for high-throughput methylation analysis. Genome Res., 12,
158—164.

Irizarry,R.A. et al. (2008) Comprehensive high-throughput arrays for relative
methylation (CHARM). Genome Res., 18, 780—790.

Irizarry,R. et al. (2003a) Exploration, normalization, and summaries of high density
oligonucleotide array probe level data. Biostatistics, 4, 249—264.

Irizarry,R. et al. (2003b) Use of mixture models in a microarray-based screening
procedure for detecting differentially represented yeast mutants. Stat. Appl. Genet.
Mol. Biol, 2,Article1.

Irizarry,R. et al. (2006a) Comparison of affymetrix genechip expression measures.
Bioinformatics, 22, 789—794.

Irizarry,R. et al. (2006b) Feature-level exploration of a published affymetrix genechip
control dataset. Genome Biol, 7, 404.

Ritchie,M.E. et al. (2009) R/Bioconductor software for Illumina’s Inﬁnium whole-
genome genotyping BeadChips. Bioinformatics, 25, 2621—2623.

Scharpf,R.B. et al. (2008) Hidden Markov models for the assessment of chromosomal
alterations using high-throughput SNP arrays. Ann. Appl. Stat., 2, 687—713.

The International HapMap Consortium (2003) The International HapMap Project.
Nature, 426, 789—796.

 

2367

112 /810'smurnofproatxosor1eu1101urorq//zd11q 111011 pop1201umoq

9IOZ ‘lg lsnﬁnv uo ::

