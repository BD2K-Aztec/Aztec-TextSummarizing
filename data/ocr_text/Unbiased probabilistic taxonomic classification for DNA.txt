Bioinformatics Advance Access published June 26, 2016

Bioinformatics, 2016, 1—8

doi: 10.1093/bioinformatics/btw346

Advance Access Publication Date: 13 June 2016
Original Paper

 

Sequence analysis

Unbiased probabilistic taxonomic classification
for DNA barcoding

Panu Somervuo1'*, Sonja Koskela1, Juho Pennanen1, R. Henrik Nilsson2
and Otso Ovaskainen1'3

1Department of Biosciences, University of Helsinki, Helsinki, Finland, 2Department of Biological and Environmental
Sciences, University of Gothenburg, Gothenburg, Sweden and 3Centre for Biodiversity Dynamics, Department of
Biology, Norwegian University of Science and Technology, Trondheim, Norway

*To whom correspondence should be addressed.
Associate Editor: John Hancock

Received on September 15, 2015; revised on May 26, 2016; accepted on May 27, 2016

Abstract

Motivation: When targeted to a barcoding region, high-throughput sequencing can be used to
identify species or operational taxonomical units from environmental samples, and thus to study
the diversity and structure of species communities. Although there are many methods which pro-
vide confidence scores for assigning taxonomic affiliations, it is not straightforward to translate
these values to unbiased probabilities. We present a probabilistic method for taxonomical classifi-
cation (PROTAX) of DNA sequences. Given a pre-defined taxonomical tree structure that is partially
populated by reference sequences, PROTAX decomposes the probability of one to the set of all
possible outcomes. PROTAX accounts for species that are present in the taxonomy but that do not
have reference sequences, the possibility of unknown taxonomical units, as well as mislabeled ref-
erence sequences. PROTAX is based on a statistical multinomial regression model, and it can util-
ize any kind of sequence similarity measures or the outputs of other classifiers as predictors.
Results: We demonstrate the performance of PROTAX by using as predictors the output from BLAST,
the phylogenetic classification software TIPP, and the RDP classifier. We show that PROTAX improves
the predictions of the baseline implementations of TIPP and RDP classifiers, and that it is able to com-
bine complementary information provided by BLAST and TIPP, resulting in accurate and unbiased
classifications even with very challenging cases such as 50% mislabeling of reference sequences.
Availability and implementation: Perl/R implementation of PROTAX is available at http://www.he|
sinki.fi/science/metapop/Software.htm.

Contact: panu.somervuo@helsinki.fi

Supplementary information: Supplementary data are available at Bioinformatics online.

 

1 Introduction

 

DNA barcoding has gained much interest in recent years, the
Barcode of Life project (Sarkar and Trizna, 2011) being the most
widespread endeavour in this field. The great promise of barcoding
approaches is that in principle any organism can be identified from a
tissue (or other biological) sample. To be effective and practical,
barcoding genes should have sufficient variation between species,
but limited variation within species, to provide the necessary signal

for species-level identification. Commonly used barcoding genes in-
clude C01 in animals, ITS in fungi, and rbcL as well as matK in
plants (Hebert et al., 2003; Hollingsworth et al., 2009; Schoch
et al., 2012). Barcoding approaches are particularly powerful when
combined with next-generation sequencing (NGS) methods, which
can be used to produce massive amounts of sequence data from en-
vironmental samples (Wall et al., 2009). That way, entire species
communities can be profiled for taxonomic affiliations.

©The Author 2016. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com 1

9mg ‘09 isnﬁnV uo salaﬁuV soq ‘eiulomeg JO AiiSJQAiu [1 112 ﬂJO'sleumo[pJOJXO'soneuuoguioiq/ﬁdnq wort papeolumoq

P.Somervuo et al.

 

Two contrasting, although not mutually exclusive approaches
have been applied to analyze the environmental sequence data. First,
a number of approaches have focused on classifying samples into
operational taxonomic units (OTUs), which can be done in the ab-
sence of a well-resolved taxonomy and reference sequence database.
The OTU approach is especially prevalent in studies on bacteria and
other micro-organisms (Hao et al., 201 1). The complementary prob-
lem, which we address here, and which underlies the Barcode of Life
project, is the case where a sequence reference database and an es-
tablished taxonomy are available. Here the problem lies in classify-
ing the environmental sequences with respect to an existing
taxonomy. In popular software packages like MOTHUR (Schloss
et al., 2009) and QIIME (Caporaso et al., 2010), it is possible to
carry out both the clustering and the taxonomic classification.

Several methods exist for assigning taxonomic labels to sequence
data. MEGAN (Huson et al., 2007) classifies sequences according to
the lowest common ancestor (LCA) node of BLAST hits. BLAST is
also used in MetaPhlAn (Segata et al., 2012). There are fast alterna-
tives for BLAST, e.g. LAST (Kielbasa et al., 2011) which is based on
suffix array and used in Taxator-tk (Droge et al., 2015). PhymmBL
(Brady and Salzberg, 2009) is based on the combination of BLAST
and interpolated Markov models and mOTU (Sunagawa et al.,
2013) utilizes hidden Markov models (Eddy, 2011). Another set of
tools uses methods from phylogenetics, e.g. TIPP (Nguyen et al.,
2014) is based on a phylogenetic placement algorithm. The com-
monly used RDP classifier (Wang et al., 2007) is based on na'1've
Bayes classifier (NBC) which uses the 8-mer decomposition of a se-
quence. MyTaxa (Luo et al., 2014) allows the use of multiple
markers simultaneously and Kraken (Wood and Salzberg, 2014) and
CLARK (Ounit et al., 2015) can utilize full-length genome
sequences.

Existing classification methods give good results if the target
classes are well represented with adequate training data (Austerlitz
et al., 2009; Bazinet and Cummings, 2012), but it has remained dif-
ficult to account for taxonomic units without reference sequences
(Ross et al., 2008). Another typical practical problem is the presence
of mislabeled training data, which the present methods to our know-
ledge fail to properly account for.

With any method of sequence classification, a central question
concerns the reliability of the classification. To move from sequence
similarity to a more objective measure of the reliability of species
identification, it is desirable to estimate the set of probabilities by
which the query sequence represents the possible candidate species
or higher taxonomical units. In our past work (Ovaskainen et al.,
2010), we developed a statistical model that estimates the probabil-
ity by which the best matching reference sequence (for instance,
based on a BLAST search) represents the true species. In this paper,
we develop our previous approach into a general tool for probabilis-
tic taxonomic classification, called PROTAX. PROTAX utilizes a
reference sequence database and a taxonomic tree structure to esti-
mate the probability with which an environmental sample can be
placed in a given taxon. Outcomes of the classification include not
only the species for which reference sequences are available, but also
species for which no reference sequences are available, as well as
species—or higher taxonomic units—that are not known to science
in the sense that they are missing from the taxonomy. PROTAX ac-
counts for the possibility that some of the reference sequences are
mislabeled, a complication often present with real data.

PROTAX is based on a Bayesian multinomial regression model
and it can use as predictors any kind of covariates, in particular any
kind of sequence similarity measures. In this paper, we present the
general statistical framework and illustrate the use of PROTAX in

the context of classifying amplicon sequencing data based on covari-
ates generated by BLAST sequence similarity and the TIPP and RDP
classifiers, as well as a combination of BLAST and TIPP. We illus-
trate with simulated data that PROTAX is able to perform taxo-
nomical classification in an accurate and unbiased manner. In
particular, we show how PROTAX can improve the classification
accuracies of TIPP and RDP classifiers and remove the bias that they
in some cases have for the estimates of classification uncertainty. We
then apply PROTAX to a fungal case study, illustrating the rele-
vance and generality of the results obtained for simulated data.

2 Methods

Concerning the overall workﬂow of the PROTAX pipeline shown in
Figure 1, the input files consist of the sequence data to be identified,
the taxonomy against which the sequence data are to be identified,
and the reference sequence database that populates at least part of
the taxonomy. The output file is the classification of the sequence
data, in the fullest version the vector of probabilities of all possible
outcomes for each query sequence.

The taxonomy is viewed as a tree structure in which the leaves
correspond to species, and the other nodes to higher taxonomical lev-
els such as genera and families. The taxonomy represents the set of
known species and their assumed phylogenetic relationships, and it
includes also those species for which no reference sequences are avail-
able. PROTAX accounts for the possibility of missing taxonomical
levels, i.e. that some branches of the tree may be missing at any of the
levels, due to not-yet-discovered taxonomical units. The reference se-
quence data are associated to leaves or higher-level nodes of the tax-
onomy, depending whether they have been identified to the species-
level or say, the genus-level only. PROTAX estimates the fraction of
the reference sequences that are mislabeled, and accounts for it when
performing classifications. This is relevant, as the mislabeling rate
can be high in some species groups. For example, in fungi it is esti-
mated to be more than 10%, e.g. due to the fruit body from which
the sample is derived being misidentified, the sample being contami-
nated, or other such problems (Nilsson et al., 2012).

2.1 Modeling the probability of placement to a given
taxonomical level

The aim of PROTAX is to partition the probability of species iden-
tity to all logical outcomes that can be derived from the taxonomical

 
   

   
  
  
  

   
    
  

  
 

   
 

Reference CSleélutenge
a a o e

se uences . . .
q 1dent1f1ed

1../
G t' f
N

parameterization
Sequence data with

Predictors -
taxonom1c labels
 and their reliabilities

Fig. 1. Flowchart of PROTAX pipeline. PROTAX combines information of
user-defined predictors which can be sequence similarities e.g. based on
BLAST, or outputs of existing classifiers such as TIPP or NBC

Parameterized Sequence
model class1f1cat1on

 
 

 

     

9mg ‘09 isnﬁnV uo salaﬁuV soq ‘eiulomeg JO AiiSJQAiu [1 112 ﬂJO'smumo[pJOJXO'soiiemJOJuioiw/zdnq wort papeolumoq

Unbiased probabilistic taxonomic classification

 

tree: species present in the taxonomy (with or without reference se-
quences), unknown species belonging to one of the levels of the tax-
onomy (e.g. an unknown species belonging to a known genus, or an
unknown species belonging to an unknown genus that belongs to a
known family). The collection of all these cases forms the set of out-
comes, for each of which PROTAX estimates a probability, in such
a way that the probabilities sum to one. If the query sequence can be
classified with high certainty, one of these probabilities will be close
to one. If there remains a high level of uncertainty, even the highest
probability may be close to zero.

The algorithm works in a hierarchical manner from the root of
the tree towards the leaves. As illustrated in Figure 2, at any given
node z, the task is to decompose the probability assigned to that
node to the known branches and the possible unknown branches.
The number of missing branches is unknown in reality. We denote
the expectation for the number of missing branches under the node z
by uz. Expert knowledge about which parts of the taxonomy are
likely to be more complete than others can be used to estimate uz. In
the absence of such information, we may simply set uz= 1 for all
nodes, as we do in the rest of this paper.

We denote the levels of the nodes by l = 1,2,. . . ,L, so that for
example the levels I: 1, 2, 3 could correspond to family, genera and
species, respectively. Assume that the node z at level I has nz known
branches. Conditional on the query sequence belonging to the node
z, we aim to decompose the unit probability into 1 + 112 parts, out of

 

 

 
 

 

 

 

 

 

 

 

0. _
039/
00
o. _
a?
a)
o
c
9 O 0.9
.9 o' _
9
_ 0.8
E‘
g 0.7
 — 0.6
.3 e55—
 0.6
U)
m. _ M 0
o
o \ .
o. _
I I I I I I
0.0 0.2 0.4 0.6 0.8 1.0

similarity(query, reference A)

Fig. 2. Visualization of how PROTAX decomposes the probabilities of taxo-
nomic placement among different possibilities. We consider here classifica-
tion of one level only, e.g. from a given genus to the underlying species.
Nodes A, B and C represent three known species ofthis genus and ’unknown’
represents possible unknown species within this genus. We assume that spe-
cies A and B have reference sequences whereas species C does not have.
Classification probabilities are shown for an input sequence as a function of
the sequence similarity (value between 0 and 100%) for species A (x—axis) and
species B (y-axis). In this example, the design matrix is X: ((0,0,0),(0,1,simA),
(0,1,simB), (1,0,0)), where the rows correspond to the nodes ’unknown’, A, B
and C, respectively, and simA and simB are the sequence similarities be-
tween the query and reference sequences. In this numerical example, we
have assumed the parameter values )3 = (0.1, —2,8). In applications, this par-
ameter vector is estimated based on training data (see main text). To simplify
the illustration, we have summed here the probabilities of the unknown node
and the species C without reference sequences

which the first one (i = 0) corresponds to the possibility that the spe-
cies belongs to an unknown branch, and the remaining
(1' = 1,2,. . . ,nz) parts to the known branches. We denote by Yz the
random variable indicating to which of the branches the sequence
belongs. We model Yz by the multinomial regression model

wziexp  

i=1
:wzz-exp (2x212)
i=0 i=1

Here [if denotes the regression coefficient associated to predictor

 

H220:

['2 1,. . . ,m at node z. The matrix Xz is the (1 + 112) x m design ma-
trix which includes m predictors that are used to guide the classifica-
tion algorithm. In principle any predictors that are informative for
the classification purpose can be used. The weights wzi are set to
w”: uz for i: 0 and otherwise to wzi = 1.

While in the more general model the values of the regression co-
efficients ﬁf can be node-specific, we make here the simplifying as-
sumption that they are constant within each level, and thus we
denote them henceforth by ﬁll, with ['2 1,...,m, with l ranging
across the levels present in the tree. Thus, the parameters ﬁll- guide
the classification from the root level to the lowest taxonomical level
present in the taxonomy, and finally the parameters [fl-L guide the
classification from the genus level to the species level. In the more
general model also the number m can be node- or level-specific, but
here we assume that it is same for all nodes and levels.

To account for the possibility that the reference sequences can be
misidentified, we denote by I (s) the identity of the true species be-
hind the sequence 5, and by I * (s) the species identity that is assigned
to the sequence. For any species identity I, we denote by Y(I) the
outcome corresponding to the species identity, so that, e.g.
Y = (2,1,3), stands for family 2, genus 1 within that family and
species 3 within that genus. For another example, Y = (2,0,0)
stands for family 2, unknown genus within that family, which
implies that also the species within that genus is unknown.

Given a query sequence 5, the probability that the observed out-
come Y(I* is the outcome y is

P(Y(I*(S)) = all/3, q) = qP(Y(1*(S)) = y)
+ (1 — q)P(Y(I*(S)) = ylﬁ,1*($)= 1(5)) (2)

Here q is the probability that the training sequence is misidenti-
fied and P(Y = y) is the prior probability of the outcome y. The
probability P(Y(I* = y| ﬁ, 1* (s) = I is given by the product of
the multinomial probabilities (Eq. 1) over the relevant levels.

We fitted the model to training data (see below) with Bayesian
inference, the parameters to be estimated being the level-specific re-
gression coefficients ﬁll- and the mislabeling probability q. We as-
signed for each of the regression coefficients the essentially
uninformative N (0, 1002) prior, and used the same prior also for the
logit-transformed probability q. As described in the Supplement,
we fitted the model using the Metropolis algorithm, with normally
distributed proposal distributions adjusted adaptively during the
burn-in.

2.2 Model parameterization

As the first example, denoted by PROTAX(BLAST), we construct
the predictors using BLAST sequence similarity, with four predictors
(m =4). We set the case of a missing branch as the reference level,
and thus the first row (i = 0) of the design matrix to (0, 0, 0, 0). The
subsequent nz rows of the design matrix model the probability of the

9mg ‘09 1sn8nV uo salaﬁuV s01 ‘121u101n123 JO A1ts19Atuf1 112 ﬁhO'smumo[pJOJXO'sot112u1101utotq//:d11q 111011 papeolumoq

P.Somervuo et al.

 

species belonging to each of the known branches. If the branch does
not contain any sequence data, the row of the design matrix is set to
(1, 0, 0, 0), and thus the regression coefficient ﬁll models the prob-
ability (relative to a missing branch) that the species belongs to a
node that is included in the taxonomy but for which no reference se-
quences are available. For branches for which one or more reference
sequences are available, the row of the design matrix is set to
(0, 1, s1,s2), where s1 and s; are respectively the mean and the max-
imal sequence similarity between the query sequence and a represen-
tative subset (see Supplementary Material) of reference sequences
under the node. The mean s1 is first averaged over the sequences for
each species, then over the species within each genus, and so on, al-
ways averaging over all units for which at least one sequence is
available. Thus the regression coefficients [$12, [$13 and [$5, model the
probability by which the query sequence belongs to a node with ref-
erence sequences with a given mean and maximal similarity. The
reason for including not only maximal similarity but also mean simi-
larity is that the latter is expected to be more robust to mislabeling
error.

As the second example, denoted by PROTAX(TIPP), we con-
struct the predictors using the classification provided by TIPP, with
three predictors (m = 3). In this case the first row (i = 0) of the de-
sign matrix is (0, 0, 0), and rows for branches not containing se-
quence data are set to (1, 0, 0). The remaining rows are (0,1,s3),
where s3 = logit(e + (1 — 2e)p), where p is the probability predicted
by TIPP, logit(p) = log(p / (1 — p)), and we have set the parameter a
= 0.001 to avoid singular cases related to classifications with p = 0
and p = 1. Similarly as with PROTAX(TIPP), we also construct the
predictors for the output of RDP classifier.

As a fourth example, denoted by PROTAX(BLAST + TIPP), we
utilize the predictors s1, s2 and $3 for nodes with reference sequences,
thus ending up to a model with five predictors (m = 5).

2.3 Generation of training data
As PROTAX aims to estimate the probabilities of all possible out-
comes for query sequences derived from environmental data, the
training data should be constructed in such a way that they represent
the expected species diversity in the environmental data. In the con-
text of Bayesian analysis, information about the expected species di-
versity can be incorporated as a prior. The prior is constructed by
listing all the possible outcomes associated with the taxonomical
tree, and giving each outcome a prior probability. Training data can
then be generated by first randomizing the desired outcome from the
prior, and then generating data that mimic the chosen outcome (see
below). The prior that we assume here corresponds to the assump-
tion that it is equally likely that the environmental sequence belongs
to any node at each level, including the possibility of an unknown
branch. Thus, if the taxonomy involves e.g. two genera in a given
family, we assume that conditionally on the species belonging to this
family, it belongs to either genera with probability 1/3, and to an un-
known genus under this family with the remaining probability 1/3.
Applying this algorithm recursively generates prior probabilities for
each possible outcome, and these prior probabilities sum to unity.
Ideal training data would consist of sequences that would repre-
sent all outcomes and that would be independent of the sequences
present in the reference database. While such sequences could be
generated in a simulation study, they will not be available with real
data (e.g. sequences that represent species unknown to science, or se-
quences that represent known species without reference sequences).
Thus, we attempt to mimic ideal training data as closely as possible.

Exactly how this is done depends on the nature of the outcome to be
mimicked, for which there are the following three possibilities.

The outcome is a known species with at least one reference se-
quence available. In this case ideal training data would be an add-
itional query sequence of that species. If the species has at least two
reference sequences, we used a randomly selected sequence as the
query sequence, and left the other sequences to the reference data-
base. If the species has only one sequence, it is not possible to gener-
ate training data for that particular species, as no reference
sequences would remain available after taking the only sequence as
the query sequence. In this case we generated training data for an-
other outcome, which is as similar as possible to the originally
chosen one, but for which the required data are available. This other
outcome is the node which has the smallest taxonomic distance to
the original node and which is on the same taxonomic level as the
original node.

The outcome is a known species with no reference sequences
available. In this case ideal training data would be a test sequence
for the chosen species. As such data do not exist, we selected another
species which had at least one reference sequence and was as related
to the original species as possible, following the recursive algorithm
described above. We randomly selected one of the reference se-
quences as the query sequence, and removed all the other reference
sequences for that species to mimic the situation where no reference
sequences would be available.

The outcome is an unknown branch of a given node. In this case
ideal training data would be a sequence for a randomly selected spe-
cies under that node. As such data are not available, we mimicked
such a situation as follows: if the node had any branches with se-
quences, we selected randomly one of those branches, proceeded to
a randomly selected species with at least one sequence, and selected
randomly one of the sequences as the query sequence. We then
removed the entire branch under the node to generate training data
mimicking the case of a missing branch. If the originally chosen
node had no branches with sequences, we generated training data
for another node, which was at the same level as the originally
chosen node (e.g. both representing genera) and as related to the ori-
ginal node as possible (in the sense of the recursive algorithm as
described above), and which had the required data.

2.4 Evaluating the performance of the algorithm with
simulated data

We evaluated the performance of the algorithm with the help of
simulated data, including taxonomies, reference sequences and val-
idation sequences. We assumed that the taxonomy consists of two
levels, called here genus and species. We thus consider classification
within a single family, and assume that in the underlying reality it is
split to 10 genera, each of which is split to 10 species, thus yielding
100 species together. We model barcoding sequences by strings con-
sisting of 300 nucleotides (A, C, T or G). We first generated an ‘an—
cestral sequence’ to the root level by assigning each nucleotide
randomly to one of the four possibilities. We generated a mutated
sequence for each genus by assuming that each nucleotide mutates
to a random one with probability 61. Similarly, we generated a se-
quence for each species by mutating each nucleotide of the genus-
level sequence with probability 62. Finally, to generate multiple se-
quences for each species, we mutated the nucleotides of the species-
level sequences with probability 63. The first 50 nucleotides were
assumed to form a conserved region, and they were thus kept identi-
cal for all sequences.

9mg ‘09 1sn8nV uo salaﬁuV s01 ‘121u101n123 JO A1ts19Atuf1 112 [3108112111110[p.IOJXO'SODBIIIJOJIIIOIQ/ﬂ(11111 111011 papeolumoq

Unbiased probabilistic taxonomic classification

 

We tested the algorithm with eight case studies summarized in
Supplementary Table S1. Case 1 was chosen as an easy starting
point in which sequence identification should be successful to the
species level. In this case, we assume that all species were known to
science and thus included in the taxonomy, and that 4 sequences
were available for all species, and that none of the sequences were
mislabeled. The levels of sequence dissimilarity were set to
61 = 0.05, 62 = 002,63 2 0.01, and thus we assumed larger differ-
ences among genera than among species within a genus, and larger
differences among species within a genus than among individuals
within a species.

The remaining cases are derived from Case 1 by changing some
of the parameters. In Case 2 we made the classification more diffi-
cult by setting 61 = 62 = 63 = 0.01, and thus having only small dif-
ferences among genera and species. Case 3 is otherwise identical to
Case 1, but reference sequences are available only for the fraction
P = 0.5 of all species. Cases 4 and 5 differ from Case 3 in that we as-
sume that 20% (q = 0.2) or 50% (q = 0.5) of the sequences are mis-
labeled, respectively. Case 6 differs from Case 3 in that only 7 out of
the 10 genera are assumed to be known to science, and that within
each known genus only 7 out of the 10 species are assumed to be
known to science. Thus in this case the taxonomy file consists of 49
species while the underlying reality still consists of the full set of 100
species. Case 7 is otherwise as Case 3 but the level of sequence simi-
larity is assumed to vary within the taxonomical tree: when generat-
ing the mutations for a given node at level I, we randomized the
level of sequence dissimilarity using a uniform distribution in the
range (0,261), so that the mean mutation probability is 6]. The mo-
tivation for this case is that while such variation in sequence similar-
ity is present in real taxonomies, the statistical model ignores it.
Finally, Case 8 combines the aspects of Case 4 (mislabeled reference
sequences), Case 6 (incomplete taxonomy) and Case 7 (heterogen-
eity in levels of sequence similarity) that are expected to make taxo-
nomic classification difficult in the case of real data.

For each of these eight cases, we simulated 5 independent repli-
cates of the taxonomy and the reference database, as well as 100 in-
dependent validation sequences, one for each species. We generated
training data with 1000 data points for each of the four PROTAX
models (BLAST, TIPP, RDP classifier and BLAST + TIPP), and used
the MAP (maximum a posterior) parameter estimate for classifica-
tion. We performed a full classification of the validation sequences
by decomposing the probability of one among all possible outcomes
of the taxonomic tree. We selected the outcome with the highest
probability, and examined if it was the correct one, i.e. if it matched
with the species behind the generated validation sequence. We as-
sessed the accuracy and bias of the classifications by plotting the cu-
mulative predicted probabilities against the cumulative number of
cases in which the outcome with the highest probability was correct.
Concerning a possible bias, if an outcome is assigned e.g. the prob-
ability 0.9, it should be correct in 90% of the cases and wrong in
10% of the cases. If in reality the answer would be correct, say in
5 0% or in 99% of the cases, the assessment of classification reliabil-
ity is biased. An unbiased classification is accurate if it assigns high
probabilities to some outcomes and low to others, while it is not ac-
curate if it assigns equally low probabilities for all outcomes. For ex-
ample, if the algorithm would return just the prior probabilities, it
would be unbiased, but not accurate.

While we predicted the probabilities separately for each possible
outcome, we pooled some of them before comparing to the true spe-
cies identity in the validation data. The reason here is that if a genus
has several species with no reference sequences, the classification
probabilities for these outcomes are necessarily identical. Thus we

summed these to obtain a single probability for the outcome being
any species within a particular genus with no reference sequences.
Further, we added to this prediction the probability of the sequence
belonging to an unknown species of that genus, and thus the pooled
outcome was ‘an unknown species within this genus, or one of the
species in this genus without reference sequences’.

To compare the performance of the PROTAX models with the
baseline implementations of the TIPP and RDP classifiers, we per-
formed sequence classification with these (without the PROTAX ex-
tension) and assessed the bias and accuracy in the same way as we
did for the PROTAX models.

2.5 Singling out mislabeled reference sequences

In addition to identifying environmental sequences (mimicked
above by the validation sequences), the fitted model can be used
to single out mislabeled reference sequences by treating the
reference sequences as test sequences, and by comparing the proba-
bilities of the outcomes to the species label. While making such pre-
dictions, the sequence to be classified is removed from the set of
reference sequences to avoid circular results due to the 100% match
to itself.

We considered a reference sequence as inconsistent if the model
predicted a wrong genus with high confidence. To be conservative,
we required the probability of the most likely classification to be at
least 100 times the probability of the outcome corresponding to the
species label. We examined how well this heuristic approach per-
formed by counting the fraction of truly mislabeled sequences that
were classified as inconsistent (in the optimal case this would be
one), as well as the fraction of correctly labeled sequences that were
classified as inconsistent (in the optimal case this would be zero).
We did this test for the three PROTAX models as well as the base-
line TIPP model.

2.6 Case study of Polyporales of Finland

For the evaluation of the method with real data, we used a data-
base consisting of ITS sequences of all Polyporales (one fungal
order) species of Finland available through UNITE (Koljalg et al.,
2013). We used a two-level taxonomy consisting of the genus and
species levels. Our database involves 265 known species in 75 gen-
era, and 336 ITS sequences that belong to 162 species in 58 genera.
Sequence lengths vary between 502 and 972 bp, mean length being
688 bp. In addition to 103 species without any reference sequences,
more than half (89/162) of the species with sequence information
contained only one reference sequence. We computed pairwise se-
quence similarities with BLAST, as detailed in the Supplementary
Material.

Unlike with simulated data, with real data there are no valid-
ation sequences for which the species identity would be known with
full certainty. Thus, we tested the performance of the fitted model
by identifying each of the reference sequences against the database
from which the focal sequence was excluded. We then assessed the
performance of the model like we did with simulated data, with the
assumption that the query sequences were not mislabeled. Thus, our
assessments of the model’s identification success are likely to be con-
servative. We compared the performances between TIPP, RDP clas-
sifier, and the four versions of PROTAX as with simulated data. In
addition, we constructed PROTAX for the full combination where
BLAST, TIPP and RDP classifier were used as predictors in the same
model.

9mg ‘09 1sn8nV uo salaﬁuV s01 ‘121u101n123 JO A1ts19Atuf1 112 /810's112umo[pJOJXO'soneIIJJOJHtotq/ﬁd11q 111011 papeolumoq

P.Somervuo et al.

 

3 Results

3.1 Simulated data

The performance of PROTAX against the simulated case studies is
shown in Figure 3. As expected, in Case 1 all algorithms resulted in
almost perfect classifications, which are both accurate (cumulative
probability close to 100%) and unbiased (the lines depicting the re-
lationship between predicted and true identities fall very close to the
identity line). In other words, all algorithms assigned in almost all
cases a very high probability to only one of the outcomes, and in al-
most all cases this outcome was the correct one.

Making the test case more challenging decreased the accuracy,
and in some cases introduced a bias in the predictions (Fig. 3). The
presence of species without reference sequences (Case 3 versus Case
1) as well as the presence of species not included in the taxonomy
(Case 6 versus Case 3) made the baseline TIPP algorithm produce
conservative estimates of the identification probabilities. The
PROTAX extension of TIPP corrected the bias on identification un-
certainty, and also improved the accuracy of the identifications.
However, the presence of 50% mislabeling (Case 5 versus Case 3)
made the predictions of TIPP and RDP classifier overconfident,
which bias PROTAX was able to correct for on average (Fig. 3) but
not within the individual replicates (Supplementary Figs S2 and S4).
In contrast, PROTAX(BLAST) provided essentially unbiased esti-
mates for all cases studied here.

Interestingly, PROTAX(BLAST) performed better in some cases,
whereas PROTAX(TIPP) performed better in other cases. In particu-
lar, BLAST was a better predictor in the presence of mislabeling,
whereas TIPP was a better predictor in the presence of heterogeneity
in sequence similarity. The latter result is to be expected, as the
phylogenetic model behind TIPP does not assume that the realized
level of mutations is identical among the branches. The fact that

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

Case 1 Case 2
O O
O- o—
'5 '5
:8— $8-
.2 .2
a s- E 9r-
E E
a 8— a 8-
O- o—
I I I I I I I I I I I I
0 20 40 60 80 100 0 20 40 60 80 100
cumulative probability cumulative probability
Case 5 Case 6
O O
2- e—
‘5 '5
0 O_ O_
1., <0 3 <0
.2 .2
a s- E 9r-
E E
a 8- a 8-
O— o—
I I I I I I I I I I I I
0 20 40 60 80 100 0 20 40 60 80 100

cumulative probability cumulative probability

BLAST and TIPP carry different kinds of information suggests that
together they should perform better than either method in isolation.
This was indeed the case: PROTAX(BLAST+TIPP) performed at
least equally well as PROTAX(BLAST), PROTAX(TIPP), or the
baseline implementation of TIPP in all the cases studied. Quite unex-
pectedly, even in the very challenging Case 5, where 5 0% of the ref-
erence sequences were mislabeled, PROTAX(BLAST + TIPP)
was able to correctly classify 87% of the validation sequences, and
its estimates of identification uncertainty were essentially unbiased
(Fig. 3).

The PROTAX models which included BLAST as a predictor
were able to estimate the mislabeling probability with good accur-
acy in Cases 4 and 8 with q = 0.2 as well as in Case 5 with q = 0.5
(Supplementary Fig. S7). In contrast, the way in which the statistical
model accounts for mislabeling was not compatible with the predict-
ive information provided by TIPP, as e.g. with q = 0.5
PROTAX(TIPP) tended to estimate the mislabeling probability ei-
ther to zero or to one.

All models were successful in assessing the great majority of mis-
labeled sequences as unreliable and the great majority of the cor-
rectly labeled sequences as reliable (Supplementary Fig. S8). The
combined model PROTAX(BLAST + TIPP) worked the best also in
the task of singling out mislabeled reference sequences. Interestingly,
PROTAX(TIPP) was almost equally
PROTAX(BLAST) in singling out mislabeled reference sequences

successful as

(Supplementary Fig. S8) in spite of its poor ability to estimate mis-
labeling probability (Supplementary Fig. S7).

3.2 Case study of Polyporales of Finland
Results based on PROTAX, TIPP and RDP classifier are shown in
Figure 4. The conclusions are in concordance with the results from

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

Case 3 Case 4
O O
O— o—
'5 '5
:8— $8-
.2 .2
a s- E 9r-
E E
a 8— a 8-
O- o—
I I I I I I I I I I I I
0 20 40 60 80 100 0 20 40 60 80 100
cumulative probability cumulative probability
Case 7 Case 8
O O
2- e—
‘5 '5
0 O_ O_
1., <0 3 <0
.2 .2
a s- E 9r-
E E
a 8— a 8-
O— o—
I I I I I I I I I I I I
0 20 40 60 80 100 0 20 40 60 80 100

cumulative probability cumulative probability

*PROTAX(BLAST+TIPP) IPROTAX(BLAST) OPROTAX(T|PP) APROTAX(FIDP classifier) OTIPP ARDP classifier

Fig. 3. Accuracy and bias of sequence identification by different versions of PROTAX in comparison to the baseline TIPP and RDP classifiers. The black lines show
a cumulative plot for the predicted probabilities of the best outcome (x—axis) and the correctness of the prediction (y-axis). The grey lines show the identity line.
The model-predicted probabilities are unbiased if the black lines follow the identity line, and they are the more accurate the longer the black lines are. The panels
show the results for the Cases 1—8 (see Supplementary Table 81). Each black line is the summary of five individual test runs. Results from individual runs are

shown in Supplementary Material

9mg ‘09 1sn8nV uo salaﬁuV s01 ‘121u101n123 JO A1ts19Atuf1 112 /810's112umo[pJOJXO'sot112u1101utotq//:d11q 111011 papeolumoq

Unbiased probabilistic taxonomic classification

 

(a)o (b)
9' I: PROTAX(BLAST+TIPP+RDP) m— —
ale PROTAX(BLAST+TIPP)

 

I PROTAX(BLAST)

o PROTAX(TIPP)

A PROTAX(RDP classifier)
0 TIPP

A RDP classifier

   
  

cumulative correct °/o

 

 

 

 

 

 

 

 

I I I I |
0 20 40 60 80 100 0.0 0.2

0.4 0.6 O. 8 1 .0
cumulative probability % probability

Fig. 4. (a) Accuracy and bias of sequence identification by different versions
of PROTAX, TIPP and RDP classifier for 336 fungal ITS sequences. For 262 se-
quences, the best outcome of PROTAX(BLAST+TIPP) was a species with ref-
erence sequences. (b) Histogram of best outcome probabilities from
PROTAX(BLAST+TIPP)

the simulated data. PROTAX was able to correct the bias of the
TIPP and RDP classifiers, and the baseline correct classification rate
of 71% from TIPP and RDP classifiers increased to 80% when com-
bining BLAST and TIPP in the PROTAX model. Both in terms of
the classification accuracy and the smallest bias,
PROTAX(BLAST + TIPP) gave the best results. Including the output
of the RDP classifier to the combination of BLAST and TIPP did not
improve the results further, suggesting that TIPP and RDP classifier
did not yield complementary information.

4 Discussion

In this paper, we have introduced PROTAX, a probabilistic method
for taxonomical classification. PROTAX converts sequence similar-
ities into unbiased taxon membership probabilities. It takes into ac-
count uncertainties of both the taxonomy and the content of the
reference sequence database. We have demonstrated its use in the
context of fungal ITS amplicon sequencing, but the method is gen-
eral and can be used with any markers. In addition to DNA se-
quences, it can be used also for classifying other types of data.

We emphasize that PROTAX can include any covariates in the
regression model and thus the examples presented in this paper are
demonstrations of only some possible choices. Besides using pair-
wise sequence similarities as a proxy for taxon membership, any
node-sequence similarities can be used. As an example of this, we
used the node probability from TIPP and RDP classifier as a covari-
ate in PROTAX. Further, we note that the choice of using the max-
imal and mean sequence similarities in PROTAX(BLAST) is one
choice among many possible sets converting sequence similarity into
PROTAX predictors. We believe that all higher-level analyses, such
as characterization of sample abundance profiles, benefit if the first
step of assigning a sequence read into a taxonomic unit is done in a
manner that enables reliable assessment of identification
uncertainty.

PROTAX provides a statistical model that can be used with pre-
sent classifiers or their combinations. It is not a new classifier per se
but it combines the information obtained from user defined covari-
ate sources. An important feature of PROTAX is that it gives un-
biased probabilities of taxonomic placement. Furthermore, it
explicitly models uncertainty related to missing data and missing
branches in the taxonomy which to our knowledge other classifiers
do not properly take into account.

In the experiments so far we have started with the simple as-
sumption that the set of explanatory variables are the same for all
nodes, and that the regression coefficients are specific to the level I

only, so that [if = 652), where l(z) is the level to which node z be-
longs. The results have been satisfactory already with this approach,
but to account for sequence similarity variation between taxonom-
ical units at the same level (e.g. between genera), it would be pos-
sible to model [if e.g. as a random effect with a multivariate normal
structure.

We provide Perl and R scripts for training the models and using
them for classification. Both speed and memory consumption de-
pend mainly on the choice of covariate sources. As an example, we
have constructed models for a large fungal ITS database with 75
000 reference sequences using a 6-level taxonomy with 130 000 spe-
cies. For classifying 1000 sequences using a single processor on a
standard Linux desktop, it took 40 s to calculate sequence similar-
ities using LAST (Kielbasa et al., 2011) and 104 s to perform the
taxonomic classification and output all nodes with probabilities
above 0.01. Memory consumption was 477 Mb. When classifying
large amounts of sequences, speed and memory usage can be im-
proved by pre-clustering the data and applying a naive paralleliza-
tion of the algorithm.

Acknowledgements

We thank Otto Miettinen for comments on the manuscript and Nerea Abrego
for help with the Polyporales case study. This work was stimulated by a work-
shop organized by OO, during which Keith Harris, Jenni Nordén, Otto
Miettinen, Christopher Quince and Oscar Westesson provided valuable input.

Funding

This study was funded by the Academy of Finland (Grant no. 250444 to 00)
and the Research Council of Norway (Centres of Excellence funding scheme,
project number 223257).

Conﬂict of Interest: none declared.

References

Austerlitz,F. et al. (2009) DNA barcode analysis: a comparison of phylogen-
etic and statistical classiﬁcation methods. BMC Bioinformatics, 10, 510.

Bazinet,A. and Cummings,M. (2012) A comparative evaluation of sequence
classiﬁcation programs. BMC Bioinformatics, 13, 1471—2105.

Brady,A. and Salzberg,S. (2009) Phymm and PhymmBL: metagenomic phylo-
genetic classiﬁcation with interpolated Markov models. Nat. Methods, 6,
673—676.

Caporaso,]. et al. (2010) QIIME allows analysis of high-throughput commu-
nity sequencing data. Nat. Methods, 7, 335—336.

Dr6ge,]. et al. (2015 ) Taxator-tk: precise taxonomic assignment of metage-
nomes by fast approximation of evolutionary neighborhoods.
Bioinformatics, 31, 817—824.

Eddy,S. (2011) Accelerated proﬁle HMM searches. PLoS Comp. Biol., 7,
61002195.

Hao,X.L. et al. (2011) Clustering 16S rRNA for OTU prediction: a method of
unsupervised Bayesian clustering. Bioinformatics, 27, 61 1—618.

Hebert,P. et al. (2003) Biological identiﬁcations through DNA barcodes. Proc.
R. Soc. Lond. B Biol. Sci., 270, 313—321.

Hollingsworth,P. et al. (2009) A DNA barcode for land plants. Proc. Natl.
Acad. Sci. U. S. A., 106, 12794—12797.

Huson,D. et al. (2007) MEGAN analysis of metagenomic data. Genome Res.,
17, 377—3 86.

Kielbasa,S. et al. (2011) Adaptive seeds tame genomic sequence comparison.
Genome Res., 21, 487—493.

K61jalg,U. et al. (2013) Towards a uniﬁed paradigm for sequence-based identi-
ﬁcation of fungi. Mol. Ecol, 22, 5271—5277.

9mg ‘09 1sn8nV uo salaﬁuV s01 ‘121u101n123 JO A1ts19Atuf1 112 /810's112umo[pJOJXO'sot112u1101utotq//:d11q 111011 papeolumoq

P.Somervuo et al.

 

Luo,C. et al. (2014) MyTaxa: an advanced taxonomic classiﬁer for genomic
and metagenomic sequences. Nucleic Acids Res., 42, e73.

Nilsson,R. et al. (2012) Five simple guidelines for establishing basic authenti-
city and reliability of newly generated fungal ITS sequences. MycoKeys, 4,
37—63.

Nguyen,N. et al. (2014) TIPP: taxonomic identiﬁcation and phylogenetic
proﬁling. Bioinformatics, 30, 3548—355 5 .

Ounit,R. et al. (2015) CLARK: fast and accurate classiﬁcation of metagenomic
and genomic sequences using discriminative k-mers. BMC Genomics, 16, 236.

Ovaskainen,O. et al. (2010) Identifying wood-inhabiting fungi with 454
sequencing — what is the probability that BLAST gives the correct species.
Fungal Ecol., 3, 274—283.

Ross,H. et al. (2008) Testing the reliability of genetic methods of species iden-
tiﬁcation via simulation. Syst. Biol., 57, 216—230.

Sarkar,I.N. and Trizna,M. (2011) The Barcode of Life data portal: bridging
the biodiversity informatics divide for DNA barcoding. PLoS ONE, 6,
614689.

Schloss,P. et al. (2009) Introducing mothur: open-source, platform-independ-
ent, community-supported software for describing and comparing microbial
communities. Appl. Environ. Microbiol., 75, 75 37—7541.

Schoch,C. et al. (2012) Nuclear ribosomal internal transcribed spacer (ITS) re-
gion as a universal DNA barcode marker for fungi. Proc. Natl. Acad. Sci. U.
S. A., 109, 6241—6246.

Segata,N. et al. (2012) Metagenomic microbial community proﬁling using
unique clade-speciﬁc marker genes. Nat. Methods, 9, 811—814.

Sunagawa,S. et al. (2013) Metagenomic species proﬁling using universal
phylogenetic marker genes. Nat. Methods, 10, 1 196—1 199.

Wall,P. et al. (2009) Comparison of next generation sequencing technologies
for transcriptome characterization. BMC Genomics, 10, 347.

Wang,Q. et al. (2007) Nai've Bayesian classiﬁer for rapid assignment of rRNA
sequences into the new bacterial taxonomy. Appl. Environ. Microbiol., 73,
5261—5267.

Wood,D. and Salzberg,S. (2014) Kraken: ultrafast metagenomic sequence
classiﬁcation using exact alignments. Genome Biol., 15 , R46.

9mg ‘09 1sn8nV uo salaﬁuV s01 ‘121u101n123 JO A1ts19Atuf1 112 /810's112umo[pJOJXO'sot112u1101utotq//:d11q 111011 papeolumoq

