Bioinformatics Advance Access published July 19, 2016

Bioinformatics, 2016, 1—8

doi: 10.1093/bioinformatics/btw395

Advance Access Publication Date: 10 July 2016
Original paper

 

 

Systems biology

A subpopulation model to analyze
heterogeneous cell differentiation dynamics

Yat Hin Chan”, Jukkalntosalmi1'T'*, Sini Rautio1 and
Harri Léhdesméki1'2'*

1Department of Computer Science, Aalto University, 00076 Aalto, Finland and 2Turku Centre for Biotechnology,
University of Turku and Abo Akademi, 20521 Turku, Finland

*To whom correspondence should be addressed.
Associate Editor: Janet Kelso
TThe authors wish it to be known that, in their opinion, the first two authors should be regarded as joint First Authors.

Received on December 15, 2015; revised on April 27,2016; accepted on June 17,2016

Abstract

Motivation: Cell differentiation is steered by extracellular signals that activate a cell type specific
transcriptional program. Molecular mechanisms that drive the differentiation can be analyzed by
combining mathematical modeling with population average data. For standard mathematical mod—
els, the population average data is informative only if the measurements come from a homoge—
neous cell culture. In practice, however, the differentiation efficiencies are always imperfect.
Consequently, cell cultures are inherently mixtures of several cell types, which have different mo—
lecular mechanisms and exhibit quantitatively different dynamics. There is an urgent need for
data—driven mathematical modeling approaches that can detect possible heterogeneity and, fur—
ther, recover the molecular mechanisms from heterogeneous data.

Results: We develop a novel method that models a heterogeneous population using homogeneous
subpopulations that evolve in parallel. Different subpopulations can represent different cell types
and each subpopulation can have cell type specific molecular mechanisms. We present statistical
methodology that can be used to quantify the effect of heterogeneity and to infer the subpopulation
specific molecular interactions. After a proof of principle study with simulated data, we apply our
methodology to analyze the differentiation of human Th17 cells using time—course RNA sequencing
data. We construct putative molecular networks driving the T cell activation and Th17 differenti—
ation and allow the cell populations to be split into two subpopulations in the case of heteroge—
neous samples. Our analysis shows that the heterogeneity indeed has a statistically significant ef—
fect on observed dynamics and, furthermore, our statistical methodology can infer both the
subpopulation specific molecular mechanisms and the effect of heterogeneity.

Availability and Implementation: An implementation of the method is available at http://research.
ics.aa|to.fi/csb/software/subpopl.

Contact: jukka.intosa|mi@aalto.fi or harri.|ahdesmaki@aalto.fi

Supplementary information: Supplementary data are available at Bioinformatics online.

 

1 IntrOducuon specification is essential, e.g. for the immune system, particularly for

The capability of a cell to transform from one cell type to several its adaptiVe arm» Where T and B cells respond and differentiate upon
more specialized cell types is crucial for the development of any eXtemal Signals- cell differentiation Processes are typically Ellided
multieellular organism_ Besides developmental processes, cell by extracellular signals which activate and control intracellular

©The Author 2016. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com l

91% ‘09 1sn3nv uo sepﬁuv s01 ‘BIUJOJIIBD aIo Amie/xtqu 112 /§.IO'S[BU.IHO[p.IOJXO'SOilBIHJOJUiOIQ/ﬁdllq 11101; pep1201umoq

Y.H. Chan et al.

 

mechanisms in a cell type specific way and, eventually, change the
cell’s gene expression pattern towards the pattern of a more special—
ized cell type. Given the central role of cell differentiation in biology,
there is a keen interest to achieve a detailed understanding of the
molecular mechanisms that drive differentiation processes and, espe—
cially, to understand the mechanisms that steer the activation of cell
type specific regulatory programs. Among other approaches, math—
ematical modeling has been used to learn and predict molecular dy—
namics of cell differentiation processes (Intosalmi et al., 2015;
Schulz et al., 2009).

Mathematical modeling can be especially useful when it is com—
bined with time—course data by means of statistical techniques
(Intosalmi et al., 2015; Schulz et al., 2009; Xu et al., 2010). Using
this approach, different hypotheses about the underlying molecular
mechanisms and interactions are quantitatively expressed in the
form of mathematical models and, further, the models can be object—
ively evaluated with respect to experimental data using well—defined
statistical methods. In a typical setting, the models are informed
using population average measurements, which are informative
about the mechanisms of interest only if they come from a homoge-
neous cell culture. If the underlying cell culture turns out to be het—
erogeneous, the standard approaches can fail or provide unreliable
results. In the context of cell differentiation, it is rather common
that the cell culture of interest is a mixture of several cell types. For
instance, if we consider a population of Type A cells which are either
activated to Type B cells or stimulated to differentiate into Type C
cells, it might be that only a fraction of the cells respond to the
stimulation and the resulting cell culture is a mixture of Type B and
C cells. When these kinds of data are analyzed, the possible hetero—
geneity needs to be taken into account properly.

The importance of heterogeneity modeling has been acknowl—
edged also in other studies (Hasenauer et al., 2011, 2014). In their
recent study, Hasenauer et al. (2014) developed ordinary differential
equation (ODE) constrained mixture models that can be used to de—
tect dynamically distinct subpopulations using population snapshot
data, such as FACS measurements. We also aim to detect dynamic—
ally distinct subpopulations and use ODEs to model molecular
mechanisms. However, our approach is different in that we inform
our models using population average sequencing data and, along
with subpopulation detection, we explicitly infer the subpopulation
specific regulatory mechanisms (i.e. network structures) from data.
Further, we outline advanced statistical tools that can be used to
quantitatively assess the significance of the modeling results.

In summary, we develop a novel modeling approach that can be
applied to analyze cell differentiation dynamics in the presence of
several co—existing cell types. We show how this approach can be
used to detect the heterogeneity of the underlying cell culture and to
infer cell type specific molecular interactions. We derive our model
for naive human CD4+ helper T (Th) cells that are induced to polar—
ize towards Th17 lineage but, nevertheless, our approach is fully
general. In our Th17 cell differentiation application, we construct al—
ternative models for the core regulatory network driving the Th17
polarization in the form of ordinary differential equations and com—
bine the alternative models with different hypotheses about the pos—
sible heterogeneity of underlying cell culture. To carry out
quantitative model and parameter inference, we combine these mod—
els with time—course RNA sequencing (RNA—seq) data using a re—
cently published statistical framework that is specifically designed
for sequencing count data. Our results show that the proposed mod—
eling approach works well for both simulated and experimental
data. Further, to the best of our knowledge, we are the first ones to

analyze the regulatory mechanisms that steer human Th17 lineage
specification by means of data—driven mathematical modeling.

2 Materials and methods

2.1 Cell type specific subpopulations

We exemplify the cell type specific subpopulation model in the con—
text of differentiation of naive human CD4+T cells into Th17 lin-
eage that can be induced by the cytokines transforming growth
factor ﬂ (TGFﬂ), interleukin 6 (IL6) and interleukin 1 ﬂ (IL1 ﬂ)
(Korn et al., 2009). These cytokines are crucial for the initiation of
the differentiation process as well as for lineage maintenance (Korn
et al., 2009). In an ideal experimental setup, all naive CD4+ cells are
equally exposed to these cytokine signals and go through the differ-
entiation process as a homogeneous cell population as illustrated in
Figure 1a. In practice, however, the differentiation efficiency can be
notably lower than 100% as some fraction of cells typically re—
sponds only to the activation signal without actively going through
the differentiation program (Fig. 1b). That is, a cell culture which is
treated with the cytokines can thus consist of subpopulations of Th0
and Th17 cells. In model design, this can be taken into account by
considering two cell types, Th0 cells that are activated but not
exposed to the inducing cytokines and Th17 cells which are actively
going through the differentiation program. Consequently, if we ob—
serve some intracellular factor x through population average data in
the presence of heterogeneity, we actually observe a weighted aver—
age of the two subpopulations evolving in parallel. Formally, this
can be expressed by writing

xaverage(t) :  _ a)xTh0(t) + axTh17(t) 

where xTh0(t) and xTh17(t) are the abundances of the intracellular
molecule in Th0 and Th17 subpopulations, respectively, at time t
and or E [0,1] is the fraction of cells in Th17 subpopulation. This
subpopulation approach is very convenient as there is typically a
control experiment in which the cells are activated in the absence of
cytokines and, consequently, data on the pure Th0 cell population
dynamics is directly available. Nevertheless, our method is fully gen—
eral and such control experiments are not necessary for our method
to work.

2.2 Mathematical models for Th17 and Th0 cell types

The most crucial transcriptional regulators driving the human Th17
cell differentiation are signal transducer and activator of transcrip—
tion 3 (STAT3) and the retinoic acid receptor—related orphan recep—
tor gamma t (RORyt) (Korn et al., 2009). These two genes are
known to exhibit strong dynamics during the early phase of

(a)
A ceii population 100% differentiation effciency
consisting of naive results in a pure Th17 cell
CD4’r T cells population (black circles). "1 a homogeneous
population, all cells follow
Th17 cell type speciﬁc
cytokines transcriptional program.

@

Activation
+

 

 Imperfect differentiation efﬁciency
A cell population results in a cell population that
consisting of naive consist of Th0 cells (grey circles)

In a heterogeneous
population, Th0 and Th17
cell types follow their own
transcriptional programs.

@C)

Fig. 1. Illustration of (a) homogeneous and (b) heterogeneous cell cultures
going through Th17 cell differentiation process

CD4+ T cells and Th17 cells (black circles).
Activation

.i.
cytokines

   

9mg ‘09 1sn3nv uo soioﬁuv s01 ‘BIUJOJIIBD aIo KliSJQAiUn 112 /§.IO'S[BU.IHO[p.IOJXO'SOIlBIHJOJUiOIQ/ﬁdllq 11101; popooiumoq

Heterogeneous cell differentiation dynamics

 

polarization (Ciofani et al., 2012; Yosef et al., 2013) and, in the fol—
lowing, we derive a mechanistic description for the core Th17 net—
work consisting of activation signaling, Th17 lineage specific
cytokine signaling, as well as messenger RNA (mRNA) and protein
levels for STAT3 and RORyt.

In the presence of activation, Th17 cell differentiation process is
initiated by cytokine signals that induce STAT3 (Korn et al., 2009).
For modeling purposes, we assume that the joint effect of the activa—
tion and cytokine induction can be described using an input signal
of the form

at, 90, 91, 92) = 90(1 + 91)eXP(—92t)a (2)

which directly drives the STAT3 transcription. Here, 00 represents
the activation effect, 01 is the relative amplification of the signal due
to cytokines and 02 determines the time scale. When the input signal
is combined with basal transcription, the possible autoactivation of
STAT3 and the activation of STAT3 through RORyt derived signals,
the STAT3 mRNA (STAT3mRNA) dynamics can be described using
the differential equation

[STAT3mRNA] _

dt €(t7 007 017 02) + 03 + 04[STAT3proti

+ 05[RORytprot] — 06[STAT3mRNA], (3)

where 03, 04, 05 and 06 are unknown rate parameters (see
Supplementary Table S1). We assume linear translation dynamics
and describe the STAT3 protein (STAT3prot) level using the
equation

[STAT3pr0t] _

dt 07[STAT3mRNA] — 98 [STAT3prot], (4)

where 07 and 08 are unknown rate parameters (see Supplementary
Table S1). In our model, the RORyt activation is solely driven by
STAT3 derived signals and RORyt autoactivation and, thus, the dy—
namics of RORyt mRNA and protein (RORytmRNA and RORytprot,
respectively) levels can be described using the differential equations

ROR tm
w : 69[STAT3protl + 910[RORthrot] _ 011[R0RytmRNAi

(5)

[RORytprot] :

dt 912 [RORVtmRNA] — 913 [RORthrotla (6)

where 09, 010, 011, 012 and 013 are unknown rate parameters (see
Supplementary Table S1). By combining the activation mechanisms
and interactions introduced above, we obtain a putative core net—
work driving the Th17 lineage specification and the corresponding
ODE system describing the time—evolution of the components.
Because we do not have prior information on the parameter values,
we assume an uninformative, standard normal prior distribution in
logarithmic scale for all parameters except the translation rates 07
: 1 and 012 = 1 that are fixed. A schematic illustration of the core
network is shown in Figure 2.

To model Th0 cells, which receive only the activation signal, we
use the same mechanisms as for Th17 cells. However, we assume
that Th0 cells are not capable of producing the active RORyt protein
and, further, in these cells, the Th17 specific activating feedback
mechanisms do not exist (dashed lines in Fig. 2). The regulatory
mechanisms that are active in Th0 cells are highlighted in Figure 2
using black color. Another difference between the cell type specific
models is that the input signal for Th0 cells is of the form at, 00, 02)
: Hoexp(—02t) because Th0 cells are assumed to be affected only by
activation. Without losing any generality, the input signal can be

A

Activation 5TAT3pm: I RORytmnM
through
T cell Basal
receptor expression
STA-r3 mRNA HURT-(twat

Fig. 2. Schematic illustration of putative Th17 core network. The black con-
nectors represent mechanisms that are active in both Th0 and Th17 cell types.
The gray connectors represent mechanisms that are active only in Th17 cell
type. The dashed connectors denote the mechanisms that are considered
when alternative models are constructed (Table 1)

Table 1. Alternative regulatory mechanisms for Th17 specific
network

 

 

Mechanism M1 M2 M3 M4 M5 M6 M7 M8
RORyt autoactivation — — — — x x x x
STAT3 autoactivation — — x x — — x x
RORyt —> STAT3 — >< — >< — >< — ><

 

Symbols X and — denote active and inactive mechanisms, respectively.

scaled by a constant (40 in this study) in both cell types. The mech-
anisms that are active in both cell types are assumed to have the
same rate parameters regardless of cell type. As a result, we have
two parallel ODE systems

XMTho (t, 0) = fMTho (t,XMTho (t, 0)) (7)

XMTh17(t, 0) = fMTh17 (t, XMTh17 (t, 0)) (8)

for Th0 and Th17 cell types, respectively. Here, XMTho(t, 0) and
XMTh17(t, 0) are the solutions of the systems, 0 is a vector containing

MThl7 specify the models (i.e. struc—

the parameters and MTho and
tures of the ODE systems). Due to the linearity of the systems, XMThO
(t, 0) and XMTh17(t, 0) can be solved using analytical expressions (for

details, see Supplementary Material, Section 1).

2.3 Alternative models

We construct alternative models MThl7 by considering different
regulatory mechanisms (also called wirings) for the Th17 cell type
specific network. More precisely, we consider different combin-
ations of the activating feedback mechanisms (dashed connectors in
Fig. 2) and, as a result, we have altogether eight alternative wirings
for the network (Table 1). The model for Th0 cell type (MThO) is
kept fixed throughout this study. Further, in our application, the
data contains independent replicates in two experimental conditions
and we can form three biologically reasonable alternative hypothe—
ses H considering the heterogeneity of the population; H1: the cell
culture treated with cytokines is pure and consists only of Th17 cells
(Fig. 3, upper panel), Hz: the cell culture treated with cytokines is
heterogeneous and fractions of subpopulations in independent ex—
periments are the same (Fig. 3, middle panel), and H3: the cell cul—
ture treated with cytokines is heterogeneous and fractions of
subpopulations in independent experiments vary (Fig. 3, lower
panel). The cell culture in control experiment (activation only) is al—
ways taken to be a pure culture of Th0 cells (Fig. 3, left column).
Each of these hypotheses about the population structures results in
different expressions for the observable average behavior.

91% ‘09 1sn3nv uo soioﬁuv s01 ‘BTUJOJTIBD aIo AliSJQATUn 112 /§.IO'SIBU.IT10[p.IOJXO'SOTlBIIIJOJUTOTQ/ﬁdllq 11101; popooiumoq

Y.H. Chan et al.

 

Activation only Activation + cytokines
replicate 1 replicate 2 replicate 3 replicate 1 replicate 2 replicate 3

H1 .0. @6969
H2 .0.
H3 .0.

Fig. 3. Illustration of three hypothetical structures of the underlying cell cul-

 

 

 

 

 

 

ture. We assume that when cytokines are not added the resulting cell culture
consists only of Th0 cells. In the presence of cytokines, the culture can be a
homogeneous Th17 culture (H1) or a mixture of Th0 and Th17 cell types (H2
and H3). In addition, the fractions of the cell types can be the same between
independent cell cultures (H2) or they may vary (H3)

If we denote the predicted population average responses in con—
trol experiment (activation only) and the differentiation experiment
(activation—i—cytokines) by (152 and (15):, respectively, the hypothesis
H1 results in the expressions

¢2(t,0,MTh0) = xMTho(t,0) (9)

45,: (t, 0,MTh17) = xMThl7(t,0), (10)

which indicate that pure Th0 and Th17 populations are observed in
all independent experiments (13 = 1, 2, 3 denotes the index of the
replicate). On the other hand, under the hypothesis Hz the expres—
sion for ([52 remains the same but the cell population which is treated
with cytokines consists of Th0 and Th17 subpopulations thus
indicating

¢i(t,0,MTh0,MTh17, or) = (1 — a)xMTho(t,0) + ameeﬁ). (11)

In this expression, the subpopulation fractions are determined by
the replicate independent parameter or. Similarly, we can write the
predicted average response under the hypothesis H3 in the form

45,: (t, 0,MTh°,MTh17, or) = (1 — ak)xMTho(t,0) + akxMThl7(t,0), (12)

where or = (mi, 062, 0(3) are the parameters representing the replicate
dependent fractions of subpopulations. We treat or, M1, 062 and 013 as
free parameters with the uniform prior distribution on [0, 1].

For notational convenience, we merge or, M1, 062 and big, with 0 and
denote the predicted population average responses in control and ac—
tual differentiation experiments by ([320, 0) and ¢i(t,0,M,H), re—
: MThl7 and omit MTho from the
notation because it remains fixed. Further, we add the population

spectively. Here, we denote M

structure hypothesis H explicitly into the arguments of (i5).
Collectively, when the hypotheses (H) regarding the heterogeneity of
the underlying cell culture are combined with the alternative wirings
of the Th17 core network (M), we can specify 8 X 3 = 24 alternative
pairs (M, H) which represent our alternative models. We also note
that the dimension of the parameter vector 0 depends on the pair
(M, H) but we omit the subindex for clarity.

2.4 Statistical framework for RNA—seq data
To combine mathematical modeling with discrete, read count RNA—
seq data, we use a recently published statistical framework which

has been specifically designed for this data type (Intosalmi et al.,
2015). The framework is based on the negative binomial (NB) distri—
bution which has been found particularly suitable for RNA—seq data
(Robinson et al., 2010).

We collect time—course RNA—seq data from both experimental
conditions in three dimensional matrices D so that the element
Diik, (i: 1,...,n; ['2 1,...,m; k : 1,...,l) represents the read
count of gene 1' at the jth time point t,- in the lath replicate and use the
NB distribution to model each element in the matrix. In other
words,

ijk N NB(ijkpii/ea day), (13)

where Cf

ik : Lika10T9 (L,- is the gene length, ka is the total num—
ber of mapped reads and 6 denotes the experimental condition), dyi-
is the gene specific, time—dependent dispersion parameter and [hi-k is
the relative mRNA abundance of gene 1' at time t,- in the lath repli—
cate. In this study, we make use of genome—wide data to obtain reli—
able estimates for the dispersion parameters and parameterize the
sampling distribution accordingly. In general, however, if the
genome—wide information is not available, the dispersion parameters
can also be estimated along with the rate parameters using time—
course data on model components. Further, we denote the data
matrices corresponding to control and actual differentiation experi-
ments by D0 and D1, respectively, and, thus, the likelihood of repro—
ducing the data D : {D0, D1} using the model (M, H) can be
written in the form

n

:is
EN

P(Dl0, M,H) =

1:

NB(D?jki Cgkwng), W)
k

\
||

)_\
||

)_\

, <14)

  M7 H): $17):
k=1

3

:is

X

s

)_\
\
||

)_\

where gogkw) is the ith component of (#2 (ti, 0) and coil/kw, M, H) is
the ith component of ([5,: (ti, 0, M, H) (confer, Intosalmi et al., 2015).
According to Bayes’ theorem, the parameter posterior of model (M,
H) can now be expressed in the form p(0|D,M,H) oc
p(D|0, M,H)p(0|M, H), where p(0|M,H) is the prior distribution
for the parameters of model (M, H) (for details about Bayesian
methodology, see e.g. Gelman et al., 2013). Further, the posterior
distribution over alternative models can be written in the form
p(M, H|D) oc p(D|M, H)p(M, H), where p(M, H) is a prior distribu—
tion over alternative models (the uniform distribution in this study)
and

p<DIM.H> = j0p<D|o.M. H>p<olM.H>d0. <15)

is the marginal likelihood. In the context of mathematical models,
the marginal likelihood can only rarely be solved analytically and
different kinds of approximative and numerical approaches need to
be used (Vyshemirsky and Girolami, 2008). The posterior predictive
distribution over model dynamics can be estimated using the average
library size and an interpolated version of time—dependent dispersion
parameters as described in Intosalmi et al. (2015 ).

2.5 Population—based Markov chain Monte Carlo sam—
pling and thermodynamic integration

The posterior distributions of the models derived above might end
up being multimodal and contain complex dependencies, and it
might be problematic to carry out the posterior analysis using stand—
ard Markov chain Monte Carlo (MCMC) methods. Consequently,
we utilize the population—based MCMC sampling which is known

91% ‘09 1sn3nv uo soioﬁuv s01 ‘BTUJOJTIBD aIo AliSJQATUn 112 /§.IO'SIBU.IT10[p.IOJXO'SOTlBIIIJOJUTOTQ/ﬁdllq 11101; popcoiumoq

Heterogeneous cell differentiation dynamics

 

to perform well even with complex target distributions (Jasra et al.,
2007). Population—based MCMC sampler can be constructed by
considering a product form of the target density

NB
p*(0[3170ﬁ27 ‘ ‘ ‘ 701319, iDvMaH) : Hpﬂi(0ﬂiiD7M7H)7 (16)
i=1
where pﬁi(0|D,M,H) oc p(D|0,M,H)ﬁ"p(0|M,H) is the power pos—
terior for fixed 0 : ﬂi < . . . < ﬂNB : 1 (confer, e.g. Calderhead
and Girolami, 2009). The distributions plat, including the posterior
distribution p(D|0, M, H)p(0|M, H), are marginal distributions of
the product form of the target density and, by means of population—
based MCMC sampling, we draw samples from each of these distri—
butions in parallel. The sampling in each individual distribution pet.
can be carried out by using standard MCMC techniques and, be—
sides the local exploration of the distributions, the population—based
MCMC sampling allows global moves between the distributions
which notably improves the mixing properties of the chain. Further,
the samples obtained from the population—based MCMC sampler
can be directly used to estimate the marginal likelihood via thermo-
dynamic integration (Friel and Pettitt, 2008; Friel et al., 2014). The
derivation of the thermodynamic integration can be found in
Supplementary Material.

2.6 RNA—seq data and data pre—processing

The samples were prepared as previously described in Tuomela et al.
(2016). In brief, the samples originate from CD4+ cells that were iso—
lated from human umbilical cord blood. To induce Th17 polariza—
tion, the naive cells were activated and simultaneously treated with
IL6, ILlﬂ and TGFﬂ in the presence of neutralizing anti-interferon y
and anti-IL4. For the control experiment, the cells were activated
and cultured in the presence of neutralizing antibodies. In both ex—
periments, the samples were collected in triplicates at the indicated
time—points and the expression profiles were quantified by means of
RNA sequencing. The data used in this study can be found in the
Supplementary Table S2.

Sequence reads were mapped using Tophat (version 1.3.2) with
default parameters to the GRCh37 human reference genome and
Ensembl human transcriptome (release 63). Expression values of
Ensembl genes were calculated using Python package HTSeq
(Anders et al., 2015) (version 0.5 .3p3) with parameters ‘—type—
: exon —idattr : gene_id —stranded : no’. Bioconductor package
edgeR (Robinson et al., 2010) was used to estimate the time—
dependent dispersion parameters (Supplementary Table S3) and the
relative mRNA abundances were presented using reads per kilo base
per million (RPKM) values. The data is accessible through GEO
Series accession number GSE52260.

2.7 Computational implementation

The mathematical models and the sampling algorithm were imple-
mented in Matlab (The MathWorks Inc., Natick, MA, USA). The
initial values for mRNA levels are taken directly from data (under
hypotheses H1 and H2, we use the average expression levels). The
abundances of active proteins are assumed to be negligible in the be—
ginning of the experiment. Population—based MCMC sampling
was carried out using 10 different temperatures that were specified
by ﬂ,- :  — 1)/(10 — 1))5, i = 1, . . . , 10 [confer, e.g. Calderhead
and Girolami (2009)]. Before the actual run, the proposal distribu—
tions were tuned adaptively. After the adaption and burn—in period,
the sampler was run using fixed proposal distributions and every
1000th sample was collected until 1000 independent samples were

obtained. This procedure was repeated at least three times for each
model and, based on the resulting independent MCMC chains, the
convergence was monitored using the potential scale reduction fac—
tor (Gelman et al., 2013). Posterior analysis for each model is based
on at least 3000 independent samples.

3 Results

3.1 Benchmarking the method using simulated data

In order to test the feasibility of our modeling approach and to
evaluate the performance of our sampling algorithm, we run the in-
ference first for simulated data. We generate the data using the wir—
ing models M1, . . . ,M8 in combination with all three alternative
hypotheses about the structure of the underlying population (H1,
H2, and H3). We simulate two realizations from each model and, as
a result, obtain 2 X 24 = 48 simulated datasets. Each dataset consists
of the same number of replicates and time—points in two different
conditions as our experimental data and, in addition, we use the dis—
persion levels obtained from the real RNA—seq data to set the vari—
ation in the simulated datasets at a realistic level. For details about
data simulation and visualizations of simulated datasets, see
Supplementary Material (Section 3 and Fig. Sl). For each of the 48
datasets, we carry out posterior analysis over all 24 models, and
conclude that, in general, the posterior model distributions show
high probabilities for the models that were used to simulated the
data (Supplementary Fig. S2).

Even though the results are in a reasonably good agreement with
the ground truth, the posterior model probabilities clearly vary from
one realization to another. To assess how strong this variability is,
we carry out a more extensive testing of our method’s model ranking
performance by considering a subset of the wiring models (i.e. the
wiring models M5, . . . ,M8) in combination with all three hypotheses
H1, H2 and H3. Here, only a subset of models is considered to keep
the computational burden of the experiment feasible. We simulate
ten independent realizations from each model and carry out poster—
ior analysis for all 10 x 12 = 120 simulated datasets. The resulting
posterior model distributions are summarized in Figure 4. The pos-
terior analysis results show robust model ranking performance in
the case of models M 5 and M7 in combination with all three hypoth-
eses H1, H2 and H3 (Fig. 4, the first and third row). When models
M6 and M8 are considered, the posterior model probabilities seem to
depend more on the underlying realization and there is more scatter
in the distributions (Fig. 4, the second and fourth row). However,
also in these cases a notable amount of probability mass is concen—
trated on the correct model and, consequently, the inference is likely
to provide useful information in a wide range of practical settings.

An important aspect in our experiments with simulated data is
that we simulate the data using fixed parameters for all mechanisms
of interest and once a mechanism is removed from the model, we
simply remove the corresponding parameter. The model ranking re-
sults may, at least to some extent, depend on the selected parameter
values. To assess how sensitive our results are for the selection of the
population fraction parameters, we simulate some further data using
the well behaving model M 5 under the hypotheses H 2 and H3 so that
the population fraction parameters for each realization are drawn
from the uniform distribution. We generate ten realizations using
each combination (M 5H 2 or M 5H 3) and carry out posterior analysis
for these data. The posterior analysis results are summarized in
Supplementary Figure S3 and show that the model ranking perform-
ance is not sensitive to the population fraction parameters.

91% ‘09 1sn3nv uo soioﬁuv s01 ‘BTUJOJTIBD aIo AliSJQATUn 112 /§.IO'SIBU.IT10[p.IOJXO'SOTlBIIIJOJUTOTQ/ﬁdllq 11101; popcoiumoq

Y.H. Chan et al.

 

1 M5H1 (0.41) M5H2 (0.32) M5H3 (0.97)
o
_ o
.D
o
E o
0
M1 M2 M3 M4 M5 M6 M7 M8 M1 M2 M3 M4 M5 M6 M7 M8 M1 M2 M3 M4 M5 M6 M7 M8
1 M6H1 (0.26) Mst (0.29) MsHa (0.35)
o g 0
_ o o
3 § '
D— 8 o o l
0. .
M1M2 M3 M4 M5 M6 M7 M8 M1M2 M3 M4 M5 M6 M7 M8 M1M2 M3 M4 M5 M6 M7 M8
1 M7H1 (0.53) M7H2 (0.58) M.,H3 (0.85)
. o
‘5 E
n.
2 ° o
0.
M1 M2 M3 M4 M5 M6 M7 M8 M1 M2 M3 M4 M5 M6 M7 M8 M1 M2 M3 M4 M5 M6 M7 M8
1 M8H1 (0.27) MeHZ (0.14) MeHa (0.22)
8 g 8
45 o
9 o 0
D- O
88 o
0.

 

 

 

 

M M2 M3 M4 M5 M6 M7 M8 M M2 M3 M4 M5 M6 M7 M8 M1M2 M3 M4 M5 M6 M7 M8

Fig. 4. Model discrimination results for 120 simulated datasets that are gener-
ated using the wiring models M5, M5, M7, M8 in combination with three popu-
lation structure hypotheses. The model which is used to simulate the data is
given on top of each subplot (indicated also by the vertical line) and the aver-
age posterior probability of the correct model is given in parentheses. The
posterior probabilities of alternative models are plotted using circles and the
fill color of the circle indicates the underlying population structure hypothesis
(H1, H2 and H3 are color coded using white, gray and black circles,
respectively)

Along with the analysis of the model posterior distributions, we
study how well the proposed method performs in recovering specific
mechanisms or population structure from simulated data. For this
purpose, we compute the receiver operating characteristic (ROC)
curves with respect to methods capability of discriminating if a
mechanism or population structure is present or not. The ROC ana—
lysis is carried out using the simulated 120 datasets introduced
above (for details about the ROC curve computation, see
Supplementary Material, Section 4). The results of ROC analysis are
summarized in Figure 5. The recovery of STAT3 autoactivation is al—
most perfect (Fig. 5a) and the activation of STAT3 by RORyt can be
recovered successfully in most cases (Fig. 5b). Our method also re—
covers the underlying population structure successfully (Fig. 5c).

In addition to the good performance in the model discrimination
tests, our method provides us with the estimates of the parameter
posterior distributions. In all experiments, the parameter posterior
distributions are notably updated from the prior distributions which
indicate good model identifiability (for an example, see,
Supplementary Fig. S4). Further, successful posterior analysis can be
carried out even in the case of challenging posterior parameter distri-
butions that exhibit multimodality and include complex dependen—
cies between the parameters (for an example, see, Supplementary
Fig. S5). The good sampling properties originate from the use of the
population—based MCMC approach which is known to perform
well even with complex distributions.

3.2 Analysis of Th17 RNA—seq data reveals heterogene—
ity and the most likely core network
We initiate the analysis of real RNA—seq data by estimating the
time—dependent dispersion parameters (Supplementary Table S3).
The resulting gene—wise dispersion values are very similar to the
common dispersion values (data not shown) and, consequently, we
can use the common dispersion in our inference without causing no—
ticeable bias.

We run the inference for the real data using all eight alternative
models for the network wiring in combination with the three

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

(a) 1 _,_ (b) 1 (C) 1 , 
. f
E :
‘3
IE 0.5 0.5 0.5
8 H1:AUC = 0.971
D. ......... .. H :AUC = 0.971
g STAT3 autoactiv., ROR yt -> STAT3, 2_
i: Auc = 0.996 Auc = 0.896 - - - Ha' AUG =1
0 0 0 J
0 0.5 1 0 0.5 1 0 0.5 1

False positive rate False positive rate False positive rate

Fig. 5. ROC curves summarizing the method's performance in recovering spe-
cific mechanisms and population structure hypotheses from simulated data.
The curves are computed based on the 120 simulated datasets for which the
posterior model distributions are illustrated in Figure 4. The ROC curves are
computed for recovering (a) STAT3 autoactivation, (b) RORyt —> STAT3 and
(c) the underlying population structure. The performance is also summarized
by computing the area under a ROC curve (AUC)

Fig. 6. Model discrimination results for the RNA-seq data. (a) The estimated
posterior distribution over all combinations of wiring models and population
structure hypotheses. (b) The same as in (a) but the RNA-seq data is comple-
mented with additional qualitative data. The color coding for hypotheses H1,
H2 and H3 is the same as in Figure 4. The logarithmic marginal likelihood val-
ues that have been used to compute the posterior probabilities as well as con-
vergence diagnostics of these runs can be found in Supplementary Table S4
and Figures S6—S7

alternative heterogeneity scenarios about the cell population. The
estimated posterior distribution over the alternative models values
are shown in Figure 6a. The wiring model M6 combined with the
hypothesis H3 has clearly the highest evidence amongst the alterna—
tive scenarios (the estimated parameter posterior is illustrated in
Supplementary Fig. S8). This suggests that the underlying cell cul—
ture is indeed heterogeneous and the fractions of cells in different
cell types vary between independent experiments. Further, the result
suggests that RORyt autoactivation and STAT3 activation through
RORyt derived signals are actively affecting the differentiation pro-
cess. On the other hand, these findings suggest that STAT3 autoacti—
vation is not necessarily needed.

The above listed mechanisms inferred by our analysis have been
discussed also in the recent literature related to murine Th17 lineage
specification (see, for instance, Ciofani et al., 2012). Autocrine
mechanisms that result in positive feedback loops around RORyt
have been reported in several studies (Murphy and Stockinger,
2010) and, thus, our findings based on human data are in agreement
with these results. The inferred STAT3 activation through RORyt
derived signals is a more controversial finding. In fact, a recent study
shows that this kind of feedback mechanisms from RORyt to
STAT3 should not exist, at least when mouse system is considered
(Ciofani et al., 2012). Further, mouse studies support the view that
there should be many RORyt independent feedback mechanisms
regulating the STAT3 expression and, as explained above, our infer—
ence does not support the existence of this kind of feedbacks (in our
models, these feedback mechanisms are implicitly modeled through
the STAT3 autoactivation). Our conclusion here is that our RNA—
seq data alone is not sufficient to draw persuasive conclusions about
the STAT3 regulation by RORyt.

To perform a more comprehensive inference about the wiring
mechanisms, we complement the time—course RNA—seq data with
qualitative information from murine studies. By means of RORyt

9mg ‘09 1sn3nv uo soioﬁuv s01 ‘121u10111123 10 AliSJQATUn 112 /§.IO'S[BU.ITIO[p.IOJXO'SOTmIHJOJUTOTQﬂI(1111] 111011 popcoiumoq

Heterogeneous cell differentiation dynamics

 

knock—out experiments, Ciofani et al. (2012) have shown that
STAT3 expression level at time 48 h does not depend on RORyt ex—
pression (even though RORyt binds the vicinity of STAT3 gene). We
incorporate this qualitative information into our likelihood function
by requiring that the difference between STAT3 levels at time 48 h
in wild—type and RORyt knock—out experiments follows a normal
distribution with a relatively small variance (for details, see
Supplementary Material). The whole inference is then repeated for
all 24 alternative scenarios using this extended setting.

Even though the qualitative information is introduced only at
one time point (48 h), it has a notable effect on the posterior proba—
bilities over alternative scenarios (Fig. 6b). When the qualitative in—
formation is added, the inference still supports the population
structure hypothesis H3 but prefers the wiring model M7 (the esti-
mated parameter posterior is illustrated in Supplementary Fig. S9).
The wiring model M7 includes exactly the mechanisms that are re—
ported in murine studies, that is, RORyt and STAT3 autoactivation
but, on the other hand, does not support the controversial feedback
from RORyt to STAT3. Our view is that the extended inference pro—
duces reasonable predictions that are in agreement with the existing
results from murine studies and could be relevant also in the context
of human system.

The time—course data as well as the posterior predictive distribu—
tion of the best ranking model (M7,H 3) are illustrated in Figure 7.
All in all, the predictive distributions are in a good agreement with
the data. The estimated means of the parameters 01,-,1' : 1, 2, 3, in the
model (M7,H3) indicate that, on average, the subpopulation frac—
tions in the three independent experiments are 84, 94 and 87%. It is
noteworthy that the variation of the fractions of subpopulations dif—
fers between the replicates and this explains why evidence for H3 is
higher than the evidence for H2.

4 Discussion and conclusions

Understanding dynamic gene regulatory mechanisms is a central
challenge in the field of systems biology. Mathematical modeling in—
evitably has an essential role in this endeavor. In this study, we
introduce a general methodology for constructing mechanistic mod—
els that are based on subpopulations which evolve in parallel. The
subpopulations represent distinct cell types that are steered by differ—
ent molecular mechanisms and exhibit different dynamic behaviors
within a heterogeneous cell population. We demonstrate how the
derived models can be calibrated in a data—driven manner and, most
importantly, show how the significance of the modeling results can

Replicate 1

Replicate 2 Replicate 3

— Activation only
— Activation + cytokines

     

 

 

 

 

40 20 4o 60 20 4o 60 80
Time (h) Time (h) Time (h)

Fig. 7. Marginal posterior predictive distributions for model structure (M7,H3)
plotted against the experimental data from the control experiment (activation,
gray circles) and the actual Th17 differentiation experiment (activation + cyto-
kines, black circles). The solid lines are the medians and the dashed lines
show the 5 and 95% quantiles of the distribution. The posterior predictive dis-
tributions for all alternative wiring models under the hypothesis H3 are shown
in Supplementary Figure 810

be assessed by means of rigorous statistical testing. Our integration
of subpopulation modeling with population average data is unique
and complements well the existing models for population snapshot
data (Hasenauer et al., 2011, 2014). In general, we believe that tak—
ing possible heterogeneity of experimental samples into account can
be advantageous in many applications.

The computational implementation that we present for our
method relies heavily on advanced Markov chain Monte Carlo
(MCMC) techniques. More specifically, we use population—based
MCMC sampling (Jasra et al., 2007) to carry out posterior analysis
and estimate marginal likelihoods using thermodynamic integration
(Friel and Pettitt, 2008). Excellent performance of our statistical im—
plementation is for a great part due to these methods that can handle
also complex posterior distributions. Due to the good performance
of the sampling algorithm, our approach presumably also scales up
to moderate sized ODE models if a feasible amount of data is
available.

We apply our method to RNA—seq data that consists of activated
CD47L cells and cells polarizing towards Th17 lineage to analyze the
regulatory interactions between the core genes driving the Th17 cell
differentiation. The interactions of these core genes have been
studied by means of mechanistic models also in earlier studies in the
context of murine data (Intosalmi et al., 2015 ). However, to the best
of our knowledge, the analysis that we present here is the first one
that has been carried out for human data. Our results are in a good
agreement with the current understanding about the molecular
underpinnings of the Th17 regulatory mechanisms. Further, the pre—
dictions that we provide about the possible regulatory network top—
ologies may turn out to be useful in future studies.

Like mentioned earlier, the applicability of our method is not re—
stricted to the application presented in this study. As a matter of
fact, the method is fully general and can be extended to cover also
more than two subpopulations. In T cell biology, there are numer-
ous interesting applications that could benefit from the kind of mod-
eling we present. For instance, the differentiation from naive
CD4+ cells to the Th17 and regulatory T (Treg) cell lineages is recip—
rocal in nature (Bettelli et al., 2006) and it would be natural to con—
struct a model consisting of Th0, Th17 and Treg subpopulations
and to study the regulatory mechanisms guiding the differentiation
into these lineages. However, it is noteworthy that the amount of
required data increases when the number of subpopulations be—
comes greater and, consequently, the models need to be carefully
benchmarked using simulated data prior to application to real data.
In a similar manner, our method could be used to analyze regulatory
mechanisms of other subsets of T helper cells such as the subsets of
Th1 and Th2 cells. One further strength of our approach is that it
allows also the modeling of possible cross—talk between cell types
which is central, for instance, for achieving a proper balance be—
tween T cell subsets and, thereby, proper regulation of the immune
response.

In summary, we present a novel modeling approach that can be
used to analyze cell differentiation processes within heterogeneous
cell populations and show how it can be applied in practice. We test
the approach first using simulated data and then apply it to analyze
the gene regulatory network steering the Th17 lineage specification.

Acknowledgements

The authors acknowledge the computational resources provided by the Aalto
Science-IT project and thank Prof. Riitta Lahesmaa and her research group at
Turku Centre for Biotechnology, Turku, Finland for providing the experimen-
tal data and Henrik Mannerstom for helpful discussions.

9mg ‘09 1sn3nv uo soioﬁuv s01 ‘121u10111123 10 AliSJQATUn 112 /§.IO'S[BU.ITIO[p.IOJXO'SOTmIHJOJUTOTQﬂI(1111] 111011 popcoiumoq

Y.H. Chan et al.

 

Funding

This work has been supported by the Academy of Finland [Centre of
Excellence in Molecular Systems Immunology and Physiology Research
(2012—2017) as well as the project 275537], EU FP7 grant [EC-FP7-
SYBILLA-201 106], EU ERASysBiO ERA-NET.

References

Anders,S. et al. (2015) HTSeq — a Python framework to work with high-
throughput sequencing data. B ioinformatics, 31, 166—169.

Bettelli,E. et al. (2006) Reciprocal developmental pathways for the generation
of pathogenic effector TH17 and regulatory T cells. Nature, 441, 235—238.

Calderhead,B. and Girolami,M. (2009) Estimating Bayes factors Via thermo-
dynamic integration and population MCMC. Comput. Stat. Data Anal., 5 3,
4028—4045.

Ciofani,M. et al. (2012) A validated regulatory network for Th17 cell speciﬁ-
cation. Cell, 151, 289—303.

Friel,N. et al. (2014) Improving power posterior estimation of statistical evi-
dence. Stat. Comput., 24, 709—723.

Friel,N. and Pettitt,A.N. (2008) Marginal likelihood estimation Via power
posteriors. ]. R. Stat. Soc. Ser. B Stat. Methodol, 70, 589—607.

Gelman,A. et al. (2013). Bayesian Data Analysis. 3rd edn. Chapman 85 Hall/
CRC Texts in Statistical Science, Boca Raton, FL.

Hasenauer,]. et al. (201 1) Identiﬁcation of models of heterogeneous cell popu-
lations from population snapshot data. BMC B ioinformatics, 12, 125.

Hasenauer,]. et al. (2014) ODE constrained mixture modelling: a method for
unraveling subpopulation structures and dynamics. PLoS Comput. Biol.,
10, e1003686.

Intosalmi,]. et al. (2015) Analyzing Th17 cell differentiation dynamics using a
novel integrative modeling framework for time-course RNA sequencing
data. BMC Syst. Biol., 9, 81.

Jasra,A. et al. (2007) On population-based simulation for static inference.
Stat. Comput., 17, 263—279.

Korn,T. et al. (2009) IL-17 and Th17 Cells. Annu. Rev. Immunol, 27,
485—5 1 7.

Murphy,K.M. and Stockinger,B. (2010) Effector T cell plasticity: ﬂexibility in
the face of changing circumstances. Nat. Immunol, 11, 674—6 80.

Robinson,M. et al. (2010) edgeR: a Bioconductor package for differential ex-
pression analysis of digital gene expression data. Bioinformatics, 26,
139—140.

Schulz,E.G. et al. (2009) Sequential polarization and imprinting of type 1 T
helper lymphocytes by interferon-gamma and interleukin-12. Immunity, 30,
673—683.

Tuomela,S. et al. (2016) Comparative analysis of human and mouse transcrip-
tomes of Th17 cell priming. Oncotarget, 7, 13416—13428.

Vyshemirsky,V. and Girolami,M.A. (2008) Bayesian ranking of biochemical
system models. Bioinformatics, 24, 833—839.

Xu,T.R.R. et al. (2010) Inferring signaling pathway topologies from multiple
perturbation measurements of speciﬁc biochemical species. Sci. Sig., 3, 134.

Yosef,N. et al. (2013) Dynamic regulatory network controlling TH17 cell dif-
ferentiation. Nature, 496, 461—468.

91% ‘09 1sn3nv uo soioﬁuv s01 ‘121u10111123 aIo AltSJQATUn 112 /§.IO'S[BU.ITIO[p.IOJXO'SOTlBIHJOJUTOTQ/ﬁdllq 111011 popcoiumoq

