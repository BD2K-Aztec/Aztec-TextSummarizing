ORIGINAL PAPER

Vol. 29 no. 19 2013, pages 2460—2468
doi:10. 1093/bioinformatics/btt429

 

Bioimage informatics

Advance Access publication August 19, 2013

A pattern matching approach to the automatic selection of
particles from low-contrast electron micrographs

v. Abrishami1’2’*, A. Zaldi’var-Perazal’Z, J. M. de la Rosa-Trevinm, J. Vargasl, J. Otonl,
R. Marabini2, v. Shkolnisky3, J. M. Carazol and c. o. s. Sorzanol’4’*

1Biocomputing Unit, National Center of Biotechnology (CSIC), 2Department of Computer Science, University Autonoma
de Madrid, Campus Universidad Autonoma s/n, 28049 Cantoblanco, Madrid, Spain, 8Department Applied Mathematics,
Tel Aviv University, Ramat Aviv, Tel Aviv 89978 Israel and 4Bioengineering Lab, Escuela Politecnica Superior, University

San Pablo CEU, 28888 Boadilla del Monte, Madrid, Spain

Associate Editor: Jonathan Wren

 

ABSTRACT

Motivation: Structural information of macromolecular complexes pro-
vides key insights into the way they carry out their biological functions.
Achieving high-resolution structural details with electron microscopy
requires the identification of a large number (up to hundreds of thou-
sands) of single particles from electron micrographs, which is a labori-
ous task if it has to be manually done and constitutes a hurdle towards
high-throughput. Automatic particle selection in micrographs is far
from being settled and new and more robust algorithms are required
to reduce the number of false positives and false negatives.

Results: In this article, we introduce an automatic particle picker that
learns from the user the kind of particles he is interested in. Particle
candidates are quickly and robustly classified as particles or non-
particles. A number of new discriminative shape-related features as
well as some statistical description of the image grey intensities are
used to train two support vector machine classifiers. Experimental
results demonstrate that the proposed method: (i) has a considerably
low computational complexity and (ii) provides results better or
comparable with previously reported methods at a fraction of their
computing time.

Availability: The algorithm is fully implemented in the open-source
Xmipp package and downloadable from http://xmipp.cnb.csic.es.
Contact: vabrishami@cnb.csic.es or coss@cnb.csic.es
Supplementary Information: Supplementary data are available at
Bioinformatics online.

Received on April 26, 2013; revised on June 28, 2013; accepted on
July 19, 2013

1 INTRODUCTION

Electron Microscopy (EM) is a key tool to study the structure
and function of biological macromolecules at a medium—high
resolution. Single particle analysis is an EM modality in which
multiple copies of the same macromolecule are simultaneously
imaged into a single micrograph. Particles from several hundreds
or even thousands of micrographs are commonly employed in a
structural study. The standard data processing workﬁow of
single particle reconstruction includes: particle selection, particle
alignment, particle classiﬁcation, three-dimensional (3D)

 

*To whom correspondence should be addressed.

reconstruction and model reﬁnement (Chen and Grigorieff,
2007; Sorzano et al., 2012). Different views of a specimen are
required for the 3D reconstruction of a complex, but these views
suffer from low signal-to—noise ratio (SNR) (due to low-dose
imaging) (Glaeser, 1971), low contrast (due to close to focus
conditions), and image deformations (due to the microscope ab-
errations). It is generally accepted that high resolution can only
be achieved with thousands of projection images, so that the 3D
reconstruction algorithm can compensate for these challenging
imaging conditions. In particular, there is generally a direct re-
lationship between the number of selected particles and the maX-
imum achievable resolution (Henderson, 1995). Manually
identifying that number of particles is not just time consuming
and laborious, but also an error-prone process. A robust
automatic particle picker (APP) algorithm is, therefore, indis-
pensable to enhance the technique’s throughput.

As the selection of several thousands of particles from low-dose
micrographs is the first and one of the crucial steps towards a high-
resolution reconstruction, a large amount of effort has been made
by researchers to develop accurate methods for APP. These meth-
ods have been classiﬁed into groups by different authors (Mallick
et al., 2004; Nicholson and Glaeser, 2001; Zhu et al., 2004). Among
them, the classiﬁcation by Nicholson and Glaeser (2001), suggests
a general categorization into template matching-based and
feature-based approaches. Template matching-based methods
(Chen and Grigorieff, 2007; Huang and Penczek, 2004; Ludtke
et al., 1999; Plaisier et al., 2004; Roseman, 2003; Sigworth,
2004; Wong et al., 2004) calculate the cross-correlation (or any
other measure of similarity) between a set of templates and a
micrograph image to seek for particle candidates. Templates are
obtained either from different projections of an initial 3D volume
(Huang and Penczek, 2004; Wong et al., 2004) or from a number of
manually picked particles (Hall and Patwardhan, 2004; Roseman,
2003). Instead of using all templates (either from different projec-
tions of an initial 3D volume or from a number of manually picked
particles), which severely increases the processing time, other
alternatives can be employed, such as eigenimages of templates
(Sigworth, 2004) or some form of an average of each template
cluster Wong et al., 2004). In feature-based approaches, particles
are sought through the calculation of some prominent geometric
and/or statistical features of the particle images (Arbelaez et al.,
2011; Hall and Patwardhan, 2004; Langlois et al., 2011; Mallick

 

2460 © The Author 2013. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com

112 /§JO'S{Bumo [p.IOJXO'SOTlBIIIJOJUTOTQ/ﬂdllq 11101; prBOIIIAAOG

9IOZ ‘091sn3nv uo ::

Automatic selection of particles from electron micrographs

 

et al., 2004; Ogura and Sato, 2004; Sorzano et al., 2009; Volkmann,
2004; Yu and Bajaj, 2004; Zhao et al., 2013; Zhu et al., 2003).
Feature-based methods can be reference-free or learning-based.
In the former, features corresponding to particles are known to
fall within a certain region of the feature space and, therefore, no
training is necessary and the algorithm can start picking particles
straightaway; in the latter, however, a set of particles and non-
particles are required to train a classiﬁer which is then able to
distinguish between particles and non-particles based on the train-
ing features. Although reference-free methods require less effort
from the user, they are of limited applicability, because the space
region corresponding to particle features has to be known a priori.

We previously introduced a feature-based APP method
(Sorzano et al., 2009) that learns features from the user selected
particles via a continuous learning phase (the algorithm is avail-
able in the open-source package Xmipp 2.4). In a manual picking
step, a small dataset of particle and non-particle images is formed
to train an ensemble naive Bayesian classiﬁer. Once the classiﬁer is
trained, it suggests new particles in a new micrograph. The user
supervises this result by discarding the wrongly picked particles
and identifying the disregarded ones. This feedback information is
then submitted to the classiﬁer which is updated to accommodate
this new information. This semi-automatic picking is continued
on several micrographs until the user is satisﬁed by the results. At
this point, the trained classiﬁer carries out the selection of the
particles in the remaining micrographs in a fully automatic way.

In this article, we introduce an APP method that follows the
general learning structure of Sorzano et a]. (2009), but major im-
provements are made to increase speed and accuracy. Our new
feature vector is completely different from the previous method
and consists of a number of geometrical and statistical features; it
is robust to noise, very fast to compute and most of its features are
rotationally invariant. Instead of Naive Bayesian (NB), we now
use a support vector machine (SVM) as the base classiﬁer due to
its interesting properties, like high generalization capabilities and
small training/classiﬁcation time. In order to reduce the number
of false positives, two SVM classiﬁers are used: one for discrimi-
nating between particle candidates and non-particle objects and
the other for checking if a particle candidate recognized by the
ﬁrst classiﬁer is a real particle or not. In contrast to Sorzano et a].
(2009), which explores a big search space for particles, the pro-
posed method limits the search space to the peaks obtained from
the cross-correlation of the micrograph with some pre—computed
templates. Templates are generated during the manual picking
step by clustering [the clustering algorithm is described in
Sorzano et a]. (2010)] the hand-picked particles and selecting
the average of each cluster. As the correlation with all orientations
of the template noticeably increases the computation time, a ro-
tationally averaged template can be used instead. The algorithm
has been successfully tested on three experimental datasets and
compared with our previous algorithm (which had, in turn, been
compared with other approaches), resulting in a more than an
order of magnitude decrease in computing time while achieving
even better performance.

2 METHODS

There are three crucial steps in the proposed algorithm: identifying initial
possible locations of particles, locally characterizing the image by means

of a low-dimensional feature vector and classifying each location as
particle or non-particle. In this section, we go through the details of
each step.

2.1 Identiﬁcation of possible particle centres

In principle, each pixel of a micrograph has the potential to be the centre
of a particle. In practice, checking each pixel is rather time consuming,
and so the number of possible candidates to evaluate must be reduced.
Therefore, we cross-correlate the input micrograph with suitable tem-
plates to make an initial guess about the candidate particle positions.
In this way, not only the search space is noticeably reduced, but also
the rate of false positives. During the training phase, we cluster manually
picked up particles into a few number of classes using an algorithm simi-
lar to the one described in Sorzano et a]. (2010). The number of clusters
can be increased or decreased dynamically to facilitate user’s ongoing
control on the quality of the templates. These templates are correlated
with the input micrograph at all possible orientations (at each location of
the correlation map, we should keep the maximum observed correlation
for all templates and all orientations). If the particle is relatively globular,
the calculation of the correlation map can be further accelerated by sub-
stituting the template by its rotational average, avoiding in this way the
need to correlate with all possible orientations.

Local maxima of the correlation map are possible candidate locations
for being at the centre of a particle. We further reduce this candidate set
by ranking local maxima according to their correlation values and keep-
ing only a portion of the local maxima with a value higher than a small
threshold. This portion may not be the same for all datasets, and basically
depends on the density of particles within the micrographs.

We should note that the cross-correlation with a template in our
approach is just a ﬁrst step to have a set of possible candidates, but
that in no way do we rely on this cross-correlation for further processing
of these candidates into particles and non-particles. In fact, the chosen
threshold for local maxima is small enough such that even particles that
were related to excluded templates could still be detected at this initial
step (Fig. 1). In most practical cases we have found that the use of only
one template is generally enough. For instance, in Figure 1, only a single
class representative has been azimuthally averaged and cross-correlated
with the micrograph, to identify the local maxima. In this ﬁgure, picking

 

Fig. 1. Micrograph from the KLH training dataset with cross-correlation
peaks superimposed. The peaks have been obtained by cross-correlation
of a single class representative and the micrograph. Colours show the
energy of each peak by black as lowest and red as highest

 

2461

112 /3.IO'S[BLI.II10[pJOJXO'SOIlBIHJO}LIIOIQ//Zdllq 11101; pepEOIUAAOQ

9IOZ ‘OE lsnﬁnv uo ::

V.Abrishami et al.

 

10% of local maxima (with the highest cross-correlation values) results in
local maxima with minimum value of 0.27 and maximum value of 0.98.
As can be seen, at the location of each particle a local maximum with a
speciﬁc energy can be observed. Still, this behaviour depends on the
practical case at hand, and consequently, the number of templates is
dynamic, so if the result is not satisfactory the user can request for
more templates.

2.2 Feature extraction

We compute a feature vector at each location previously identiﬁed as a
candidate for particle centre. This vector is used by the classiﬁer in the
next step to distinguish between particles and non-particles. Two prop-
erties have been sought for the feature vector: being robust to noise (due
to the low SNR in the micrographs) and being rotationally invariant (to
save computational time and avoid having to look for the particles in
all possible orientations). We use a feature vector that is robust to noise
and most of its features are rotationally invariant. it is made of three
subsets of features: the ﬁrst two feature subsets are sensitive to the
particle shape, whereas the third one encodes the particle grey intensi-
ties. The ﬁrst and third feature subsets are rotational invariant but not
the second one.

2.2.] Particle shape description at dﬂerent frequencies Micro graphs
are submitted to a ﬁlter bank with N), raised cosine band pass ﬁlters to
decompose them into several sub-band images in order to being able later
on to extract features associated to particular frequencies (Fig. 2). The
ﬁltered micrograph by the kth (k = 1, . . . , Nh) ﬁlter, Mk(r) (i.e. kth sub-
band image) is computed by

MW) = FT1{M(R)Hk(R)}, (1)

where F T— 1 is the inverse Fourier transform and M (R) and Hk(R) show
the Fourier transform of the micrograph and kth Fourier ﬁlter in the
ﬁlter bank, respectively. R is the two-dimensional (2D) spatial frequency,
and r is the spatial coordinate within the image. Each raised cosine band
pass ﬁlter has a particular width AR and a decay of 6;; (see the last image
in column B of Fig. 2). The low-pass ﬁlter in the ﬁlter bank is deﬁned by a
transfer function given by

1, R E AR
H1(R) 2 %(1+ cos(”(R+1fR))), AR<R 3 AR + 3,, (2)
0, R>AR+3R

where R is the modulus of R. The kth band pass ﬁlter (k = 2, 3, ..., M)
is deﬁned by the transfer function Hk(R) deﬁned as

0, RS(k—1)AR—3R

%(1+ (204%)), (k —1)AR — 6R<R g (k —1)AR
1, (k—1)AR<RSkAR (3)
%(1+cos(”(Rg—:AR))), kAR<R5kAR+6R
0, 

Let us concentrate now on a given particle within a micrograph. We
will refer to this boxed image as I(r). Let us call Ik(r) the corresponding
boxed image extracted from M k(r). By considering r as the distance from
the image centre in the direction of 6, we express this boxed, ﬁltered image
in polar coordinates, Ik(r, 6) and compute the cross-correlation function
of pairs of Ik(r, 6) images [this step has been partially inspired by Schatz
and van Heel (1990)]. Note that the cross-correlation is rotationally in-
variant in 2D polar coordinates (see proof in Supplementary material).
Let us deﬁne wick/(Ar, A6) as the cross-correlation function between
polar, sub-band images Ik(r, 6) and Ikt (r, 6), as below

wick/(Ar, A6) = Z Z 1,,(r, (9)1k, (r + Ar, (9 + A6), (4)
6

l"

where Ikt (r, 6) is shifted over Ik(r, 6) by Ar ([0, rp], where rp is the radius of
the particle), and by A6 ([—1800, 1800]) along r and 6, respectively (see
column D in Fig. 2). In particular, for each k, we calculate wkki for k’ = k
(autocorrelation; k =1, ...,Nh), k’ = k+1 (k =1, ...,N), — 1) and
k’ = k + 2 (k = 1, ...,N), — 2). The autocorrelation of a given band is
related to the particle shape, and the cross-correlation between sub-bands
reveals the linear relationships between the shapes at two different
frequency bands. We can see in Figure 3 an example of how these
cross-correlation functions can, indeed, distinguish between particles
and non-particles. From this ﬁgure, it is clear that cross-correlation func-
tions for particles (ﬁrst row) are quite different from those for non-
particles (second row). It is worth mentioning that, for the sake of
speed up, we just consider the 2D projections and not the original 3D
object. According to this, cross-correlation functions are not rotationally
invariant in 3D, and therefore we need to have enough projections from
different orientations to fully cover the projection space.

The cross-correlation functions of the training set of particles for a
particular combination kk’ are highly redundant and can be easily com-
pressed using principal component analysis (PCA) (Pearson, 1901). There
are as many wkki images as candidate particles, which is a number in the
many thousands. This is the set from which the PCA basis is extracted
(there are, therefore, as many PCA’s as all combinations of k and k’). For
each (bk/,1 image, we keep its projection onto the ﬁrst Nb PCA vectors as
features to be used during the classiﬁcation step. Note that the PCA basis
is calculated for the kk’ cross-correlations of the training dataset of par-
ticles. This means that the kk’ cross-correlations of non-particles will be
poorly represented by this PCA basis. In this way, the dimensionality
reduction itself is presumed to have a positive impact on the classiﬁcation
accuracy. An example of these bases can be seen in Figure 4, where four
eigenvectors are shown for each cross-correlation function.

2.2.2 Particle shape description in a particle-adapted rotational
invariant subspace Ponce and Singer (2011) proposed to calculate
an image basis that is adapted to the kind of images being studied and
their in-plane rotations. They do this by calculating the PCA of a set of
images and all their possible rotations. We apply this principle to extract
some features from boxed particles or particle candidates [this idea is
partially the same as in Dube et al. (1993)]. Given the training particles
provided by the user, we ﬁrst align them into a few templates using a
process similar to that described in Sorzano et al. (2010). Then, we com-
pute the PCA basis associated to these templates (Fig. 5) to form a ro-
tational invariant subspace (the basis of this subspace is able to reproduce
any 2D rotation of particle images). We keep the ﬁrst Nrb projection
coefﬁcients onto this basis as part of the feature vector. Note that the
subspace that is spanned by these vectors is rotationally invariant, but not
the basis itself. Therefore, particles with different 2D orientations have
different coefﬁcients but still can be efﬁciently approximated using this
basis. Again, this basis has been especially designed to represent good
particle images; consequently, non-particles will be poorly represented by
the basis helping the classiﬁer to perform its task.

2.2.3 Particle intensity Desired particles are assumed to follow a
speciﬁed pattern of intensity distribution once the boxed image is normal-
ized to have zero mean and unit power (Sorzano et al., 2004). For
instance, particles in the carbon region are normally discarded. To cap-
ture the intensity features desired by the user we calculate the mean, the
SD as well as N,- equidistributed deciles of the intensity histogram.

2.2.4 Feature vector We collect all these features into a feature vector
that characterizes the boxed image to be classiﬁed. The vector size
is 3Nb(N), — l) + Nrb + N,- + 2. By default, we suggest to use
N1, = 4, N), = 6 (AR 2 0.025, 6;; = 0.02 in digital frequencies normalized
to 0.5), N,;, = 20 and N ,- = 9. This produces a feature vector of dimension
91. In practice, we have observed that these choices provide generally good
results on all the tested datasets. The values of the parameters depend on

 

2462

112 /§.IO'S[BU.II10[p.IOJXO'SOIlBIIIJOJUIOIQ/ﬁ(1111] 11101; pepeoIII/noq

9IOZ ‘091sn3nv uo ::

Automatic selection of particles from electron micrographs

 

   

Micrograph

F regulate],r

    

B C D

Cross-correlations

“Arr.

Filters ‘1'".
Sub-bands
1 .tl]
—3*
m.
T ‘l [1.11 {2.21 I33} I‘M]
—* Q
I

_}15.51 lets} 11.1} ILSI
r

I

[2.3] [1.4] 13:41 {3.5}

 

[3.5] I‘ll-6]

Fig. 2. Particle shape description at different frequencies. First, N h bandpass ﬁlters (column B), with a width of A R and a decay of (SR (see the last image
in this column), are applied to the input micrograph (column A) and boxed images are extracted at the location of particles or particle candidates
(column C). Sub-band images for the particle (column C) are converted to polar form, and cross-correlations between different sub-bands are
calculated (column D). A6 [(—180°, 180°)] and Ar ([0, rp], where rp is the radius of particle) are shifting parameters to slide one polar image on one
another. The indexes below each cross-correlation (column D) refer to the polar images that form it. Parameters for this ﬁgure are

N), = 6, AR 2 0.025, 6R 2 0.02, rp = 25 (see the main text)

(a) ' ,
EH '

r' I
IL” [2,1] [3.3] {4.4} 15.5] [5-51 [1.11 l1-3I' [1.3] (1.41 [3.41 l3-5l' {4.51 l14.5]

(b) I I ‘ t '
* I I I

{111111.11 I331 I‘M [5.51 IE5] 11.21 {1.51113} 11.4] [31-4] [35] “.51 [£51

    

Fig. 3. Particle shape description at different frequency bands: cross-cor-
relation among sub—bands for a particle (a) and non-particle (b). The
indexes below each cross-correlation refer to the k and k’ sub-bands.
Note the important differences between particles and non-particles for
the functions (1, 1), (2, 2), (3, 3), (1, 2), (1, 3), (2, 3) and (2, 4)

both properties of the micrographs and particles. For instance, for a low
defocus set of micrographs, we need a higher value of N), to extract the
information of higher frequencies, whereas for smaller particles we should
increase N b and Nrb to be able to regenerate them from the basis.

2.3 Classiﬁcation

Distinguishing between particles and non-particles is, in general, a com-
plex task due to the low contrast and low SNR present in the micro-
graphs. Additionally, the problem is complicated by having to distinguish
between particles and damaged particles, contaminated particles, partly
formed particles, etc., which, in general we will denote as ‘errors’. We use
non-linear, binary support vector machines (SVMs) (Boser et al., 1992;
Cortes and Vapnik, 1995) as classiﬁers due to their good performance in
other classiﬁcation problems [it is particularly used successfully in APP by
Arbelaez et al. (2011); Zhao et al. (2013)], their robustness to noise and
their speed. The general idea of the SVM classiﬁer is to ﬁnd an optimum
hyperplane in an n-dimensional space by which two different classes are
distinguishable. LIBSVM (Chang and Lin, 2011) is an efﬁcient and
widely used implementation of the SVM. This package suggests a variety
of kernels to perform the non-linear classiﬁcation. We use this package
with a radial basis function (RBF) kernel to gain a high accuracy in our
classiﬁcation (see Supplementary material for an introduction to SVM).

We use two SVM classiﬁers. The ﬁrst classiﬁer is responsible to
discriminate between particle objects and any other kind of objects
(non-particles and errors). Because of the similarity between errors and
particles, the output of the ﬁrst classiﬁer is not so accurate, and some
errors are labelled as particles. Therefore, to reduce the false positives to a
feasible extent, the second classiﬁer is dedicated to just focus on distin-
guishing particles from errors. This strategy was already used by Sorzano
et al. (2009). Figure 6 shows the behaviour of the classiﬁer for three types
of objects. As can be seen, the ﬁrst classiﬁer passes the error, but the

 

2463

112 /3.IO'S[BUJHO[pJOJXO'SOIleJOJUIOIW/Zdllq 11101; pepeommoq

9IOZ ‘OE lsnﬁnv uo ::

V.Abrishami et al.

 

LIL;

[LII

   

 

..L

[1.3] [1.“

,,.
ll

III-5| [4.5!

 

Fig. 4. First four eigenvectors corresponding to the PCA of the cross-
correlation functions between two sub-band images for manually picked
particles of the KLH dataset. The index under each group of four images
shows the contributed sub-band images (kk’, in the text)

 

Fig. 5. Eigenvectors (Ponce and Singer, 2011) corresponding to a given
template, (a) Given particle template. (b) First 20 eigenvectors of the
template that generate a rotational invariant subspace

second classiﬁer rejects it. In fact, the learning process follows the same
steps as in the algorithm by Sorzano et al. (2009). First, the user picks all
particles from the ﬁrst micrograph and they are clustered in order to
construct particle templates. All non-selected locations are assumed to
correspond to non-particles and some of them will be later used to train

Non-Particle Pa rticlc Error

    

I: :- =1.

 

 

I Non-Particles I I Particles+Errurs I

 

 

 

 

First SVM Classiﬁer

PH rticlc Error

 
    

 

 

I Errors I I Particles I

 

 

 

 

Isemnd SVM Classiﬁer

Particle

Fig. 6. Behaviour of the classiﬁers for three types of objects. The ﬁrst
classiﬁer may classify errors as particles, but the second classiﬁer is
designed to remove errors from the ﬁnal result

the classiﬁers. This manual step can be continued with more micro graphs
to expand the training set. It is worth pointing out that none of the
classiﬁers are trained at this point.

Once the training set is large enough (empirically, at least 30 training
particles are required), the process enters a supervised phase. The rota-
tionally invariant subspace as well as the PCAs for the polar, sub-band
cross-correlations are calculated on the training particles. Then, feature
vectors are calculated for the manually selected particles and non-
particles. Finally, the ﬁrst classiﬁer is trained using this data. At this
point, the algorithm tries to automatically pick the next micrograph in
the list of micrographs that was not previously manually picked. After
suggesting possible particle locations, the user can correct the results by
adding those missed particles (false negatives) and removing wrongly
picked particles (false positives). After being corrected by the user, the
ﬁrst classiﬁer is retrained using all previous information plus the new set
of false negatives and false positives. The second classiﬁer is trained to
distinguish between all particles known so far and the set of false posi-
tives. This process can be repeated several times on more micrographs till
the performance of the classiﬁers is not further improved by user correc-
tions. This ongoing learning process is particularly interesting because the
classiﬁers carefully adapt to the user’s preferences.

When the user is satisﬁed with the performance of the classiﬁer during
the semi-supervised phase, he can go to a fully automatic particle picking
mode, in which all micrographs that have not been picked yet are auto-
matically picked (in parallel). At the end of this process, the user can
supervise the result and eliminate wrongly picked particles or add missed
particles.

3 RESULTS

We applied our APP method on three datasets to assess the
speed and accuracy of the proposed algorithm for micrographs
with different contrast, density and particle shape and size. These

 

2464

112 /3.IO'S[BUJHOIpJOJXO'SOIleJOJUIOIW/Zdllq 11101; pepeommoq

9IOZ ‘OE lsnﬁnv uo ::

Automatic selection of particles from electron micrographs

 

datasets are: KLH (keyhole limpet haemocyanin), adenovirus
and helicase. All the experiments were done with the same
ﬁxed parameters (Nb 2 4, Nh = 6, Nrb = 20 and N,- = 9) on a
single core of a CPU Intel Core i5, 64 bits, 2.53 GHz (of a stand-
ard laptop with 4 gigabytes of RAM).

To show the results in a quantitative way, we have used the
performance metrics introduced by Langlois and Frank (2011).
If TP is the number of true positives, FP the number of false
positives and F N the number of false negatives, then these met-
rics are deﬁned as

. . _ TI)

0 Pre01s1on _ —FP+TP
_ TP

0 Recall_—FN+TP

X precision x recall

. Ilmeasure = 2 precision+recall

Precision shows the fraction of picked particles by the algo-
rithm that is real particles, and recall indicates the fraction of
true particles that are picked by the algorithm. F—measure is a
harmonic mean to summarize both recall and precision.

3.1 KLH dataset

This dataset was produced as a general benchmark for APP by
Zhu et al. (2003). It includes 82 micrographs of KLH particles.
A Phillips CM200 TEM was used to record the micrographs on a
2 K x 2K CCD Tietz camera at a magniﬁcation of 66 000x and
a voltage of 120 kV. The sampling rate at this magniﬁcation was
2.2A/pixel.

In the 3DEM Benchmark site (http://i2pc.cnb.csic.es/3dem
benchmark) the dataset has been split into two datasets: one
with 30 micrographs for training and another one with 50
micrographs for testing. We set the size of particles to 200
pixels, and processed 10% of the local maxima of the correlation
map.

To evaluate the connection between the number of particles
and accuracy metrics, we calculated precision, recall and F—meas-
ure for the test dataset after training the classiﬁer with different
numbers of true particles of the training dataset. Figure 7 shows
how these three parameters change as the number of training
particles is increased. As can be seen in this ﬁgure, precision,
recall and F—measure of the algorithm are increased if we keep
training the classiﬁer with more and more particles. Training
with more than 173 particles (13 micrographs), a precision
range of [80.0, 85.2] and a recall range of [73.1, 77.8] are achiev-
able. F—measure ranges as a summary of precision and recall in
the interval [77.53, 80.06]. Since there is a trade-off between recall
and precision, F—measure looks smooth, and changes in a small
range.

Training the algorithm with 39 manually picked particles took
3.5 s. After training, the algorithm needs 1 s to suggest new par-
ticles on each new micrograph and 2.5 s to retrain after being
corrected by the user. Picking particles from 50 micrographs of
the test dataset took 51 s, without any parallelization (however,
current Xmipp implementation can beneﬁt from multiple CPUs
by concurrently picking different micrographs).

According to the 3DEM benchmark, our previous APP
method was capable of selecting particles with an average time
of 47 s, precision rate 80.94% and recall rate 68.59%. For the
new algorithm, the precision and recall rates are reported as

 

 

—+— Precision

go *Flecall       ..    
«F—measure

 

 

 

Rate {as}

 

 

so 16s 1st) 260 2st) son 35s
Number of training particles

Fig. 7. Three accuracy metrics for the automatic selection of particles

from the KLH test dataset according to the number of particles used

to train. The vertical axis shows the values for precision (blue), recall

(red) and F—measure and the horizontal axis shows the number of training

particles

 

Fig. 8. The result of the algorithm for one micrograph of the KLH
dataset with nine particles. Nine objects are boxed in green as particles.
There is one false positive and one false negative, which are identiﬁed by
+ and —, respectively

85.16% and 74.81%, respectively, and the average processing
time for each micrograph is ls. Therefore, the proposed algo-
rithm is very fast and produces accurate results compared with
our previous algorithm (Sorzano et al., 2009) as well as with the
reported results in the APP challenge (Zhu et al., 2004).

Figure 8 shows the result of the algorithm for one micrograph
of the test dataset with nine particles. In this ﬁgure, nine green
squares show the selected objects, from which one long particle
with ‘+’ symbol is a false positive. One particle, marked with ‘—’
symbol, is missed from the ﬁnal result.

3.2 Adenovirus dataset

In this experiment we examined the reliability of our method by
means of a set of micrographs (Perez-Berna et al., 2009) that has
lower contrast but higher density and a larger particle size than
the KLH dataset (Fig. 9).

 

2465

112 /3.IO'SIBUJHO[pJOJXO'SOIleJOJUIOIW/Zdnq 11101; pepeommoq

9IOZ ‘OE lsnﬁnv uo ::

V.Abrishami et al.

 

 

Fig. 9. Automatic selection for one micrograph of the adenovirus data-
set, (a) The template for cross-correlation. (b) The micrograph with 115
automatically selected particles

Adenovirus type 2 is an icosahedral mammalian virus with a
molecular mass of 150 MDa, and consists of genomic DNA and
structural proteins. Samples were vitriﬁed in liquid ethane, and a
F El Tecnai G2 FEG microscope at working voltage of 200 kV
was used to analyse the samples. Micrographs were recorded on
a ﬁlm at a magniﬁcation of 5000><, and digitized in a Zeiss
Photoscan TD scanner using a step size of 7 pm, which provided
a sampling rate of 1.4A (particle size at this sampling rate is 600
pixels). True particles for this dataset were manually identiﬁed by
Perez-Berna et al. (2009).

Like in the previous experiment, the original 305 micrographs
are divided into a training dataset with 30 micrographs and a
test dataset with 275 micrographs (these two datasets can be
obtained from http://i2pc.cnb.csic.es/3dembenchmark/). The
sizes of the micrographs are not the same, but we know that
4000 < height < 15 000 and 4000 < width < 12 000 pixels. The
dimensions of the micrographs were internally reduced by a
factor of 4. We examined 90% of the local correlation
maxima, and assumed that one template was enough for the
cross-correlation.

We used 334 particles and 690 non-particles from the ﬁrst
14 micrographs to fully train the classiﬁer. The classiﬁer was
used to automatically pick the particles of the test dataset. This
experiment resulted in picking 9216 particles with precision rate
92.17% and recall rate 90.24%. Figure 9b shows the result of the
automatic picking for one micrograph of this dataset. As it can
be seen in this ﬁgure, the algorithm picks 115 particles from this
micrograph and particles close to or inside the carbon parts are
rejected.

The average processing time per micrograph was 34 s, which is
more than for the KLH dataset because it is more dense (90% of
the local maxima are checked) and the size of the micrographs

 

Fig. 10. Automatic selection for the third micrograph of the helicase
dataset, (a) The template for cross-correlation; (b) 874 automatically
picked particles from the micrograph

and particles were twice and three times larger than the KLH
dataset ones, respectively.

3.3 Helicase dataset

In this section we work with the complex of a helicase and its
leading factor with a total molecular mass of 0.39 MDa (V.A.
et al., unpublished data). This dataset consists of 160 micro-
graphs of size 4046 x 4046. The CCD of a JEOL JEM-2200F S
microscope with magniﬁcation 50 000x and voltage 200 kV pro-
vided digital micrographs with pixel size 2.16 A.

The rather dense micrographs of this dataset (the average
number of particles in each micrograph is 572) (Fig. 10b) as
well as the small particle size make them particularly difﬁcult.
Additionally, contrast is especially low due to the cryo-EM con-
ditions. This in-house dataset is not published yet, and no bench-
mark is available in order to check the accuracy quantitatively,
therefore the result is given qualitatively.

We set the size of particles to 100 pixels, and processed 90% of
the local maxima to ensure that no particle was missed. To train
the classiﬁer, 1037 positive and 2510 negative samples were ex-
tracted from the ﬁrst two micrographs, and then for the third
micrograph the algorithm automatically picked 874 particles in
50 s. Figure 10 shows the result for the third micrograph of this
dataset, qualitatively in agreement with user expectations.

4 DISCUSSION AND CONCLUSION

In this article, we proposed an APP algorithm that identiﬁes
particles from electron micrographs more accurately and faster
compared to our previous method by Sorzano et al. (2009),
already one of the best performing methods. A set of robust
shape-related and statistical features are extracted from particle
candidate locations (that are distinguished by cross-correlation
between the templates and micrograph) and a two-stage classi-
ﬁer decides if each feature vector is a particle or not. Like in

 

2466

112 /3.IO'SIBUJHO[pJOJXO'SOIleJOJUIOIW/Zdnq 11101; pepeommoq

9IOZ ‘OE lsnﬁnv uo ::

Automatic selection of particles from electron micrographs

 

Sorzano et al. (2009), the learning process of the classiﬁer is
continuous to grab the features of the user desired particles,
and the second stage of the classiﬁer is used to concentrate just
on making distinctions between particles and errors, which are
very similar to particles. Experimental results for three datasets
show that this algorithm is able to select particles accurately even
from low-contrast and highly dense micrographs.

The feature vector includes three types of features. This feature
vector is robust to noise and has a high discrimination power, so
that the classiﬁer can distinguish between particles and non-
particles. Having two types of features for shape description at
the same time helps us to reduce the probability of producing
partially similar feature vectors for particles and non-particles.
For instance, in case of the KLH dataset, the descriptors at dif-
ferent frequencies are not adequate to properly distinguish be-
tween side and top views of the particle. On the other hand, the
calculated shape descriptors from rotational invariant subspace
are not sufﬁcient to separate errors very similar to the side views
of the particle. As a summary, these two types of features con-
spire efﬁciently to decrease the false positive rate. Statistical fea-
tures are also important to catch the properties of the intensity
distribution, and prevent the APP from picking particles from
the carbon parts of micrographs. The role of this type of feature
is clearer for helicase and adenovirus datasets, where more par-
ticles lie in dark areas of the micrographs. In Supplementary
material, the classiﬁcation power of the individual features is
assessed in depth.

To decrease false positives as much as possible, a two stage
SVM classiﬁer is used to classify the feature vectors: the ﬁrst
stage to separate particles and non-particles, and the second
stage to remove errors (very similar to particles) from the
output of the previous stage. Each SVM component of the clas-
siﬁer is capable of performing the separation with an accuracy of
>90% (see Supplementary material). The second component of
the classiﬁer plays an important role in reducing the false positive
rate (e. g. 15% of wrongly selected particles were discarded by the
second classiﬁer in the KLH dataset).

There are six parameters that can be set by the user: number of
sub-bands, PCA basis, rotational PCA basis, consecutive sub-
bands to be correlated, templates and percentage of local
maxima in correlation map to keep. Although these parameters
help the user to achieve the highest possible accuracy, they can
result in complexity. To moderate this complexity, the value of
the ﬁrst four parameters is set by default, so that the user can
focus on adjusting the last two parameters (number of templates
and percentage of local maxima to keep).

Regarding the particularities of the datasets, KLH is a dataset
with highly contrasted particles, but there are two sources of
errors that make it challenging. First, a few background objects
and also noisy top views that present features similar to the ones
of the particles. Second, KLH can polymerize to some degree.
The second classiﬁer is in charge of removing these polymerized
particles, and keeping, at the same time, the recall rate at a rea-
sonable level.

For the adenovirus dataset, our algorithm achieved a better
accuracy than for the KLH dataset. The reason is that, although
the micrographs are denser and have samples with lower con-
trast, the similarity between particles and non-particles is not as
high as in the KLH dataset. The second classiﬁer rejects just 3%

of the outputs of the ﬁrst one. Difﬁcult cases in this dataset are
those particles located on carbon areas, which are efﬁciently
distinguished by statistical features.

The speed of the algorithm was examined for the three data-
sets. According to the density of micrographs, it can go from 1 s
to 50 3. Most computations are related to feature extraction, es-
pecially the shape descriptors. In order to eliminate this bottle-
neck and improve the speed even more, in our implementation
particle candidates are divided between different threads. In add-
ition to this, the automatic selection of particles from micro-
graphs is performed in parallel. In this way, our APP is
extremely fast and can be executed in a very short time.

This algorithm is included in Xmipp 3.0 and downloadable
from http://xmipp.cnb.csic.es. The APP is accessible through
the protocols described by Scheres et al. (2008).

Funding: Economical support from the Spanish Ministry of
Economy and Competitiveness (through Grants AIC-A-2011-
0638, BFU2009-09331, BIO2010-16566 and CAM(S2010/
BMD-2305); NSF (Grant 1114901); postdoctoral Juan de la
Cierva Grants (references JCI-2011-10185 and JCI-2010-
07594); la Caixa scholarship (to VA); Formacion de Personal
Investigador (FPI) fellowship (to A.Z.-P.); CSIC grant (JAE-
Predoc to J.M.de la R.-T.); Ramon y Cajal fellowship,
(to C.O.S.S.) Y.S. was partially supported by Israel Science
Foundation grant 485/10. This work was funded by Instruct,
part of the European Strategy Forum on Research
Infrastructures (ESFRI) and supported by national member
subscriptions.

Conflict of Interest: none declared.

REFERENCES

Arbelaez,P. et al. (2011) Experimental evaluation of support vector machine-based
and correlation-based approaches to automatic particle selection. J. Struct.
Biol, 175, 319—328.

Boser,B.E. et al. (1992) A training algorithm for optimal margin classiﬁers. In:
Proceedings of the fifth annual workshop on Computational learning theory,
COLT ’92. ACM, New York, NY, USA, pp. 144—152.

Chang,C-C. and Lin,C.-J. (2011) Libsvm: A library for support vector machines.
ACM Trans. Intell. Syst. Technol., 2, 27: 1—27227.

Chen,J.Z. and Grigorieff,N. (2007) Signature: a single-particle selection system for
molecular electron microscopy. J. Struct. Biol, 157, 168—173.

Cortes,C. and Vapnik,V. (1995) Support-vector networks. Mach Learning, 20,
273—297.

Dube,P. et al. (1993) The portal protein of bacteriophage SPPl: A DNA pump with
13-fold symmetry. EMBO J., 12, 1303—1309.

Glaeser,R.M. (1971) Limitations to signiﬁcant information in biological electron
microscopy as a result of radiation damage. J. Ultrastruct. Res, 36, 466—482.

Hall,R.J. and Patwardhan,A. (2004) A two step approach for semi-automated par-
ticle selection from low contrast cryo-electron micrographs. J. Struct. Biol, 145,
19—28.

Henderson,R. (1995) The potential and limitations of neutrons, electrons and x-rays
for atomic resolution microscopy of unstained biological molecules. J. Molr
Biol, 247, 726—738.

Huang,Z. and Penczek,P.A. (2004) Application of template matching technique to
particle detection in electron micrographs. J. Struct. Biol, 145, 29—40.

Langlois,R. and Frank,J. (2011) A clariﬁcation of the terms used in comparing
semi-automated particle selection algorithms in cryo-em. J. Struct. Biol, 175,
348—352.

Langlois,R. et al. (2011) Reference-free particle selection enhanced with semi-
supervised machine learning for cryo-electron microscopy. J. Struct. Biol,
175, 353—361.

 

2467

112 /810'S{eumo [p.IOJXO'SOIlBIHJOJUIOICI/ﬁdllq uIOJIj pepeommoq

9IOZ ‘091sn8nv uo ::

V.Abrishami et al.

 

Ludtke,S.J. et al. (1999) EMAN: Semiautomated software for high-resolution
single-particle reconstructions. J. Struct. Biol, 128, 82—97.

Mallick,S.P. et al. (2004) Detecting particles in cryo-em micrographs using learned
features. J. Struct. Biol, 145, 52—62.

Nicholson,W. and Glaeser,R. (2001) Review: Automatic particle detection in
electron microscopy. J. Struct. Biol, 133, 90—101.

Ogura,T. and Sato,C. (2004) Automatic particle pickup method using a neural
network has high accuracy by applying an initial weight derived from eigen-
images: a new reference free method for single-particle analysis. J. Struct. Biol,
145, 63—75.

Pearson,K. (1901) On lines and planes of closest ﬁt to systems of points in space.
Philos. Mag, 2, 559—572.

Plaisier,J.R. et al. (2004) TYSON: Robust searching, sorting, and selecting of single
particles in electron micrographs. J. Struct. Biol, 145, 76—83.

Ponce,C. and Singer,A. (2011) Computing steerable principal components of a large
set of images and their rotations. IEEE T. Image Process, 20, 3051—3062.
Perez-Berna,A.J. et al. (2009) Structure and uncoating of immature adenovirus.

J. Mol Biol, 392, 547—557.

Roseman,A. (2003) Particle ﬁnding in electron micrographs using a fast local
correlation algorithm. Ultramicroscopy, 94, 225—236.

Schatz,M. and van Heel,M. (1990) Invariant classiﬁcation of molecular views in
electron micrographs. Ultramicroscopy, 32, 255—264.

Scheres,S.H.W. et al. (2008) Image processing for electron microscopy single-
particle analysis using xmipp. Nat. Protoc., 3, 977—990.

Sigworth,F.J. (2004) Classical detection theory and the cryo-em particle selection
problem. J. Struct. Biol, 145, 111—122.

Sorzano,C.O.S. et al. (2004) Normalizing projection images: A study of image
normalizing procedures for single particle three-dimensional electron micros-
copy. Ultramicroscopy, 101, 129—138.

Sorzano,C.O.S. et al. (2009) Automatic particle selection from electron micrographs
using machine learning techniques. J. S truct. Biol, 167, 252—260.

Sorzano,C.O.S. et al. (2010) A clustering approach to multireference alignment
of single-particle projections in electron microscopy. J. Struct. Biol, 171,
197—206.

Sorzano,C.O.S. et al. (2012) Semiautomatic, high-throughput, high-resolution
protocol for three-dimensional reconstruction of Single Particles in Electron
Microscopy. In: Nanoimaging' Methods and Protocols. Methods in Molecular
Biology. Humana Press Inc., New York, NY, pp. l7l—l93.

Volkmann,N. (2004) An approach to automated particle picking from electron
micrographs based on reduced representation templates. J. Struct. Biol, 145,
152—156.

Wong,H.C. et al. (2004) Model-based particle picking for cryo-electron microscopy.
J. Struct. Biol, 145, 157—167.

Yu,Z. and Bajaj,C. (2004) Detecting circular and rectangular particles based on
geometric feature detection in electron micrographs. J. Struct. Biol, 145,
168—180.

Zhao,J. et al. (2013) Tmacs: A hybrid template matching and classiﬁcation system
for partially-automated particle selection. J. Struct. Biol, 181, 234—242.

Zhu,Y. et al. (2003) Automatic particle detection through efﬁcient hough trans-
forms. IEEE T. Med. Imaging, 22, 1053—1062.

Zhu,Y. et al. (2004) Automatic particle selection: results of a comparative study.
J. Struct. Biol, 145, 3—14.

 

2468

112 /810's113urno [p.IOJXO'SOIlBIHJOJUIOIQ/ﬁdllq urorj pepeommoq

9IOZ ‘091sn8nv uo ::

