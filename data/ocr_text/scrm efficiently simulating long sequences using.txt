Bioinformatics, 31 (1 0), 2015, 1680—1682

doi: 10.1093/bioinformatics/btu861

Advance Access Publication Date: 8 January 2015
Applications Note

 

 

Genetics and population analysis

scrm: efficiently simulating long sequences
using the approximated coalescent with

recombination

Paul R. Staab1'*, Sha Zhuz, Dirk Metzler1 and Gerton Lunter2'*

1Department of Biology, Ludwig-Maximilians-Universitat Miinchen, Planegg-Martinsried, Germany and 2Wellcome
Trust Centre for Human Genetics, University of Oxford, Oxford OX3 7BN, UK

*To whom correspondence should be addressed.
Associate editor: Gunnar Ratsch

Received on September 28, 2014; revised on December 2, 2014; accepted on December 23, 2014

Abstract

Motivation: Coalescent-based simulation software for genomic sequences allows the efficient in
silico generation of short- and medium-sized genetic sequences. However, the simulation of gen-
ome-size datasets as produced by next-generation sequencing is currently only possible using

fairly crude approximations.

Results: We present the sequential coalescent with recombination model (SCRM), a new method
that efficiently and accurately approximates the coalescent with recombination, closing the gap be-
tween current approximations and the exact model. We present an efficient implementation and
show that it can simulate genomic-scale datasets with an essentially correct linkage structure.
Availability and implementation: The open source implementation scrm is freely available at
https://scrm.github.io under the conditions of the GPLv3 license.

Contact: staab@bio.lmu.de or gerton.lunter@well.ox.ac.uk.

Supplementary information: Supplementary data are available at Bioinformatics online.

 

1 Introduction

Coalescent simulation is a valuable tool to investigate population
genetic data and the demographic processes that shaped them.
Simulation programs based on the coalescent with recombination
(CWR) such as ms (Hudson, 2002) support a wide range of evolu-
tionary scenarios and are extremely efficient for short- and medium-
sized sequences. As the number of recombination events grows ex-
ponentially with increasing sequence length, it is however infeasible
to simulate whole chromosomes using these methods. This prevents
many methods relying on simulations from being applicable to next-
generation sequencing datasets.

In order to resolve this problem, McVean and Cardin (2005)
introduced the sequentially Markov coalescence (SMC) model, a
method that approximates the CWR by partially ignoring genetic
linkage between simulated sites. Subsequently, Marjoram and Wall
(2006) proposed a modification of this model, termed SMC’, which

©The Author 2015. Published by Oxford University Press.

improved accuracy. The simulation programs MaCS (Chen et al.,
2009) and fastsimcoal (Excoffier and F011, 2011) implement SMC’
and allow rapid simulation of chromosome-sized datasets.
However, Eriksson et al. (2009) found that the decrease in genetic
linkage depends on the simulated evolutionary model, which led
them to conclude that SMC’ might not be suitable under certain
conditions, and suggested that the effect of the approximation
needed to be investigated carefully in each application.

We have developed a novel approximation of the CWR, called
the sequential coalescent with recombination model (SCRM).
Besides algorithmic optimization, it allows for user-controlled arbi-
trary precision ranging continuously from SMC’ to the full CWR.
We here present an efficient implementation of this model, termed
scrm, and show that by using an intermediate approximation level it
allows the simulation of sequences of arbitrary length with an essen-
tially correct linkage structure.

1 680

This is an Open Access article distributed under the terms of the Creative Commons Attribution License (http://creativecommons.org/licenses/by/4.0/), which permits
unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.

112 ﬂJO'sleumo[pJOJXO'sopeuuogurorq/ﬁdnq wort pepeolumoq

910K ‘09 lsnﬁnV no :2

Sequential coalescent model

 

2 Materials and Methods

SCRM is based on the sequential model for building the ancestral re-
combination graph (ARG) by Wiuf and Hein (1999). After sampling
an initial genealogy at one end of a chromosome, it moves along the
sequence and updates the genealogy as recombination events are en-
countered. The genealogy includes so-called non-local branches,
which belong to a previous genealogy but do not carry ancestral ma-
terial for the current position. These may become important at up-
stream positions.

Every recombination introduces additional non-local branches,
which causes the ARG to grow exponentially along the sequence
and makes it impractical to simulate long sequences under the
CWR. To resolve this problem, SCRM adds three modifications to
the Wiuf—Hein model:

1. SCRM uses a memory efﬁcient tree-based data structure, which
encodes recombinations as non-local leaves rather than splits in
the graph.

2. Recombination events on non-local branches are postponed
until a local tree is affected, and ignored if the local trees remain
unchanged. This requires that we account only for local recom-
binations while moving along the sequence. Non-local branches
accumulate the recombination rate until they are targeted by a
coalescence. The time until the next recombination event on this
branch is then exponentially distributed with the accumulated
rate. This modiﬁcation is similar to a model proposed by Wang
etal. (2014).

3. The most crucial modiﬁcation is that we allow to disregard
weak linkage over large genomic regions. We do this by remov-
ing non-local branches with an accumulated recombination rate
above a threshold. As this threshold corresponds to a certain
genomic distance to the local tree, this approximation is equiva-
lent to an ‘exact window’ sliding along the sequence. Positions
within the window have the same linkage as in the CWR, while
positions further apart have reduced linkage. Setting the window
size to 0 reduces the algorithm to the SMC’, while a chromo-
some-sized window recovers the CWR.

2.1 Implementation and validation
We have developed scrm, an efficient open-source implementation
of SCRM using C++11. Command line in- and output are designed
to be compatible with ms, so that scrm can be used as a drop-in re-
placement. The supported feature set is similar to ms. Additionally,
scrm supports samples at different times and variable recombination
rates along the sequence. It is optimized for sample sizes of thou-
sands of individuals.

We validated the implementation by comparing exact simula-
tions to ms. No significant deviations were found using X2 and
Kolmogorov—Smirnov tests (Supplementary Table 51).

2.2 Approximation of Linkage

We compared the genetic linkage produced for different levels of ap-
proximation by using the correlation of the total local branch length
of the genealogy at two sites as a function of their distance (Fig. 1).
The ‘exact window’ of scrm is similar to MaCS’s history parameter.
However, as MaCS ignores all non-local recombinations, it simu-
lates too much linkage for sites within its history. Consequently, it
does not converge to the CWR when reducing the approximation,
while scrm does (Fig. 2). In the settings of Figure 2 and using an
exact window size of 300 kb, scrm simulates essentially correct

 

 

 

 

 

 

 

 

 

1681
0.40 .
— ms
0.35 - — scrm Okb
— scrm10kb
0.30 - — scrm 50kb -
— scrm 300kb
2 0.25 -
.9
‘71? 0.20 -
8
0 0.15-
0.10
0.05
0.00 - - - -
5kb 10kb 30kb 50kb 100kb 200kb 400kb

Distance 6

Fig. 1. Approximation of genetic linkage. Shown is the correlation of p (y-axis)
of the total local branch length at two sites 6 base pairs apart (x—axis). The
linkage in the CWR (ms, options 20 1 -r 4000 10000001 -T) is indicated in
black. Results for scrm using different exact window sizes (see legend) are
indicated in colour

 

 

     

120 . . . .
o fastsimcoal
Okb
0 .0kb + scrm
100‘ + MaCS ‘

 

 

 

Deviation

 

 

 

 

Time (sec)

Fig. 2. Efficiency for different approximations. Shown is the deviation (y-axis)
against run-time (x—axis) for simulating 10 Mb with a recombination rate of
10‘8 per base per generation. The deviation of the approximation from the
correct values is measured as the square root of the area between the p
— 6 correlation curves for the approximate simulated data, and ms—gener-
ated data (see Fig. 1). For scrm and MaCS multiple approximation levels are
drawn using different exact window sizes or history parameters. The recently
published Cosi2 (Shlyakhter et al., 2014) does not output trees and could not
be included in this figure; for a comparison of Cosi2 and scrm using different
summary statistics see Supplementary Figure 85

linkage across 20 samples with a linear run-time cost of 0.1 s per
megabase.

Funding

This work was supported by the Deutsche Forschungsgemeinschaft
[DFG ME 3134/3-2] and the Wellcome Trust [0905 32/Z/09/Z].

Conﬂict of Interest: none declared.

References

Chen,G.K. et al. (2009) Fast and ﬂexible simulation of DNA sequence data,
Genome Res., 19, 136—142.

112 ﬂJO'sleumo[pJOJXO'sopeuuogutotq/ﬁdnq wort pepeolumoq

910K ‘09 lsnﬁnV no :2

1 682

P.R.Staab et al.

 

Eriksson,A. et al. (2009) Sequential Markov coalescent algorithms for popula-
tion models with demographic structure, Theor. Popul. Biol., 76, 84—91.

Excofﬁer,L. and Foll,M. (2011) fastsimcoal: a continuous-time coalescent
simulator of genomic diversity under arbitrarily complex evolutionary scen-
arios, Bioinformatics, 27, 1332—1334.

Hudson, RR. (2002) Generating samples under a Wright—Fisher neutral
model, Bioinformatics, 18, 337—33 8.

Marjoram,P. and Wall,]. (2006 ) Fast “coalescent” simulation, BMC Genetics,
7, 16.

McVean,G.A. and Cardin,N.J. (2005 ) Approximating the coalescent
with recombination, Philos. Trans. R. Soc. B Biol. Sci, 360,
1387—1393.

Shlyakhter,I. et al. (2014) Cosi2: an efﬁcient simulator of exact and approxi-
mate coalescent with selection. Bioinformatics, 30, 3427—3429.

Wang,Y. et al. (2014) A new method for modeling coalescent processes with
recombination, BMC Bioinformatics, 15, 273.

Wiuf,C. and Hein,]. (1999) Recombination as a point process along
sequences, Theor. Popul. Biol., 55, 248—25 9.

112 /810'S{12umo[p101x0'801112u1101utotqﬂ2d11q 111011 pepeolumoq

910K ‘09 isnﬁnV no 22

