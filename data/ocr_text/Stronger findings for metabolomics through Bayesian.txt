Vol. 30 E003 2014, pages i461-i467
doi: 10. 1 093/bioinformatics/btu455

 

Stronger findings for metabolomics through Bayesian modeling of
multiple peaks and compound correlations

Tommi Suvitaival‘, Simon Rogers2 and Samuel Kaski

1,3,*

1Helsinki Institute for Information Technology HIIT, Department of Information and Computer Science, Aalto University,
FI—OOO76 Espoo, Finland, 2School of Computing Science, University of Glasgow, Glasgow (312 800, UK and 3Helsinki
Institute for Information Technology HIIT, Department of Computer Science, University of Helsinki, Helsinki, Finland

 

ABSTRACT

Motivation: Data analysis for metabolomics suffers from uncertainty
because of the noisy measurement technology and the small sample
size of experiments. Noise and the small sample size lead to a high
probability of false findings. Further, individual compounds have nat-
ural variation between samples, which in many cases renders them
unreliable as biomarkers. However, the levels of similar compounds
are typically highly correlated, which is a phenomenon that we model
in this work.

Results: We propose a hierarchical Bayesian model for inferring dif-
ferences between groups of samples more accurately in metabolomic
studies, where the observed compounds are collinear. We discover
that the method decreases the error of weak and non-existent covari-
ate effects, and thereby reduces false-positive findings. To achieve
this, the method makes use of the mass spectral peak data by clus-
tering similar peaks into latent compounds, and by further clustering
latent compounds into groups that respond in a coherent way to the
experimental covariates. We demonstrate the method with three simu-
lated studies and validate it with a metabolomic benchmark dataset.
Availability and implementation: An implementation in R is available
at http://research.ics.aalto.fi/mi/software/peakANOVAl.

Contact: samuel.kaski@aalto.fi.

1 INTRODUCTION

Changes in metabolite concentrations provide insights into dis-
turbances in biological processes that take place in organisms.
Changes in the metabolome are informative, especially about
nutrition and metabolism (Oresié, 2009), and about the
immune system (Kau et al., 2011). Chromatography-coupled
mass spectrometry (Plumb et al., 2004) is the standard measure-
ment technology for the untargeted quantiﬁcation of metabolites
and other small molecules.

The spectral data from the measurement device are known to
be noisy with various sources of uncertainty (Katajamaa and
Oresié, 2007), starting from sample preparation and compound
ionization, and ending at peak identiﬁcation, annotation and
summarization. However, the spectra also have structure
(Steuer, 2006; Rogers et al., 2009) that is useful for the inference
of differences between groups of samples.

Because of the high level of noise, excessive false discovery has
been highlighted among the main risks in the analysis of

 

*To whom correspondence should be addressed.

metabolomic data (Broadhurst and Kell, 2006). On the other
hand, weak changes are likely to go undetected from observa-
tions of individual compounds (Saccenti et al., 2014).

Singular value decomposition (SVD)—based dimensionality re-
duction techniques, such as analysis of variance (ANOVA)-
simultaneous component analysis (ASCA; Smilde et al., 2005),
have been proposed to identifying interpretable associations be-
tween experimental covariates and multivariate changes in the
metabolome. However, as the decomposition in ASCA operates
on the covariate effects of the standard ANOVA model, the
method does not improve the quantiﬁcation of the covariate
effects compared with the standard model. Further, SVD has
been applied to interpreting changes in the variance of the sam-
ples in association to the covariates (Jansen et al., 2012), again,
building on the standard ANOVA model.

Outside metabolomics, structured ANOVA-type models have
been proposed to improve the inference of covariate effects: a
Gaussian process-based ANOVA model for spatial data
(Kaufman and Sain, 2010) enables the inference of smooth cov-
ariate effects for nearby data points, and a dependent Dirichlet
process mixture of ANOVA models (De Iorio et al., 2004) can
identify substructure in a designed experiment with low-
dimensional observations of the outcome.

For metabolomics, a Bayesian clustering model (Suvitaival
et al., 2014) has recently been proposed for improving the
inference of covariate effects through the integration of multiple
same-source spectral peaks. Individual spectral peaks have been
argued to be unreliable for the statistical analysis because of their
high level of noise. Although the mass spectrometer produces
multiple peaks that arise from one compound, there so far are
only few methods to integrate these additional observations:
Kuhl et al. (2012), Rogers et al. (2009) and Tikunov et al.
(2012) used multiple peaks to enhance peak annotation, address-
ing a major source of error in the analysis of metabolomic data.
The recently proposed multipeak model for the inference of cov-
ariate effects (Suvitaival et al., 2014) is, to our knowledge, the
ﬁrst systematic approach for using additional peaks in the stat-
istical analysis of intensity data.

In this work, we aim at reducing the risk of false associations
between experimental covariates and the observed metabolome.
We propose a structured ANOVA-type model that beneﬁts both
from the multiple spectral peaks produced by the mass spectrom-
eter and from the collinear structure (Huopaniemi et al., 2009;
Steuer, 2006) of metabolomic data. Because of the collinearity
that arises from the compounds’ concurrent involvement in
biological processes, it is reasonable to model individual
compounds as members of coherent groups of compounds.

 

© The Author 2014. Published by Oxford University Press.

This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (http://creativecommons.org/licenses/by-nc/4.0/), which permits
non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited. For commercial re-use, please contact journals.permissions@oup.com

112 ﬂJO'sreumo[pJOJXO'sopeuuogurorq/ﬁd11q IIIOJJ popeorumoq

910K ‘09 lsnﬁnV no :2

T.Suvitaival et al.

 

We achieve this by introducing another level of hierarchy to the
peak-clustering model (Suvitaival et al., 2014). We show that by
not only clustering spectral peaks into latent compounds but in
addition by clustering these compounds into coherently respond-
ing latent groups, we can detect weak covariate effects in the data
more accurately.

2 METHODS

The method introduced in this work extends the peak-clustering
model (Suvitaival et al., 2014) to reduce the risk of false discoveries in
highly collinear metabolomic data. We address the problem of small
sample size and low signal-to-noise ratio by introducing stronger struc-
ture to the model. This enables us to detect weak covariate effects that
are present in multiple compounds.

In this section, we describe the proposed hierarchical Bayesian two-
level model. In the equations that follow, we use the indices i, j, m, k and l
to denote the samples, the variables, the ﬁrst-level clusters, the second-
level clusters and the covariate level of the sample, respectively, as

i= 1, . . . , N (samples, i.e. experimental runs),

j= 1, . . . , P (variables, i.e.peaks),

m= 1, . . . , M (ﬁrst-level clusters, i.e. compounds),

k= 1, . . . , K (second-level clusters, i.e. groups of compounds),
l= 1,  , La (covariate level, i.e. sample group)

where N, P, M, K and La are their respective total numbers.

The observed data are the spectral peaks, indexed by j, following their
identiﬁcation in the samples, indexed by i. However, the association be-
tween the peaks and the compounds, indexed by m, is unknown as is the
total number, M, and the identity of the compounds.

The data on the peaks are organized into two arrays: ﬁrst, the peak
height information is arranged into a P—by—N matrix X e RPXN, which
after the log -transformation and centering based on the control group,
I = 1, is real valued with missing values where a peak was not detected.
Secondly, the peaks’ pairwise similarity information is arranged into the
array Q e [0, 1]NXPXP . We choose to measure the similarity between two
spectral peaks by computing the Pearson correlation between the peaks
over a retention time window. This leads to a measure, where peaks j and
j’, if co-occurring within the retention time window in the sample i, have a
positive similarity value qu-J-z. Similarity values for pairs with a
missing peak or a negative correlation coefﬁcient are set to zero and
thus are effectively considered as missing values in the model. The peak
similarity data enable the model to cluster together adduct and
isotope peaks, which have a different mass-to-charge ratio but which
appear at a coinciding retention time.

2.1 Peak clustering based on chromatographic similarity

We follow the approach detailed by Suvitaival et al. (2014) in the
peak-clustering stage, presented brieﬂy here for completeness.

In the following equations for inferring the P—by—M clustering
matrix V, we use the variable a”, E Vj’  e {0, 1} to indicate whether
the peaks j and j’ are in the same or different clusters (1 or 0, respectively).
In the notation, the subset operator ‘-’ indicates that the entire
dimension of the array is included—here, all the M clusters (columns)
of the clustering matrix V.

2.1.1 Peak Similarity A pair of peaks from one compound can
only occur close by in retention time, whereas a pair of peaks from
two different compounds does not have such restriction set by the
measurement device. This means that the observed similarity between
same-compound peaks is expected to be higher than between

different-compound peaks. Thus, the similarity value qu-Jv between
the peaks j and j’ in a sample i is assumed to have been generated
by one of the two components, ‘in’ or ‘out’, both of which are a spike-
and-slab mixture (Mitchell and Beauchamp, 1988) with a beta
distribution as the ‘slab’. These two components are parametrized as

P(qi,j.i' |81,j’ = 1) = (1 — Piin)Beta(ql'JJ’ Iain’ bin)

in (1)

+190 5(quJ')

for a pair of peaks in the same cluster and
P(qi.i,j' |81.i' = 0) = (1 — Pgut)Beta(quJ’ laout’ bout) (2)

+P8ut5(qi.i,j')

for a pair of peaks in different clusters. Both of the beta
distributions have parameters a and b, which are set in the way that
the same-cluster and different-cluster components favor large and small
values of similarity qu-Jz, respectively.

In Equations (1) and (2), missing values are modeled through the
‘spike’ 8, which is a Dirac delta function that introduces a point mass
at value zero of its argument. Many missing values are expected, as
peaks from two different compounds rarely appear at the same time.
The prior probability of a missing value is determined by 170, which
receives a higher value in the different-compound component than in
the same-compound component. Different retention time, thus, is
strong evidence for assigning the peaks into different clusters.

The likelihood,

NP—l P
£(QIV)=1—[1—[ H 17(Qi,j,j’|8j,j’=1)8jjl
i=1j=1j’=j+1 (3)

1— 
X 17(QiJJ’ |8i.iJ’ = 0) a“
for the data, Q, is then computed through a product over all the samples,
all the pairs of peaks, and the same-compound and different-compound
terms.

2.1.2 Unknown compounds To accommodate the unknown set
of compounds in the data, we set a Dirichlet process prior (Escobar,
1994) for the peak clusters. In this way, we not only can infer the assign-
ments of the peaks into clusters representing the compounds but we
can also infer the number of compounds, M, in the data, leading to a
P—by—M clustering matrix V.

In the Dirichlet process for the cluster assignments of the
peaks, the probability of the assignment of a peak j into an existing
cluster m,

p(Vj’m =  V_j’.) OC Sm£ (Q|V_j’ ., Vj’m =  

is weighted by the number of other peaks in the cluster, Sm E va’mLJ-Jn.
The probability is not dependent on the previous assignment of the peak
j, which is left out both from the likelihood term and from the
count. This is expressed in the equation by the subset operator ‘—j’
that excludes the row j from the clustering matrix V. As an alternative
to the existing M clusters, a new cluster is created with the probability

P(Vj,M+1=1|Q’ V) CC aDP£ (QIV—', -, Vj,M+1=1) (5)

which is affected by the Dirichlet process concentration parameter app.

We infer the posterior distribution of the model via Gibbs
sampling. Following the sampling, we acquire a point estimate of
the distribution of the clustering as the least-squares clustering GDahl,
2006) relative to the posterior mean clustering. The inferred
clustering, V, is then used as a preprocessor for the inference of
covariate effects, which is discussed next.

 

i462

112 ﬂJO'srcumo[pJOJXO'sor1chOJurorw/2d11q IIIOJJ popcorumoq

910K ‘09 lsnﬁnV no :2

Stronger findings for metabolomics through Bayesian modeling of multiple peaks

 

2.2 Compound clustering for modeling compound
correlations

Following the preprocessing, described in Section 2.1, the matrix of
observed peak intensities, X e IRPXN, for the P peaks and the N samples
has been decomposed into M clusters through the P-by-M clustering
matrix V. Then, each sample i,

x_,,~N(vX2§;t,A) (6)

is represented by a column of the latent variable matrix Xlat e IRMXN.
Again, the subset operator ‘-’ indicates that the entire dimension of the
array is included, for instance, not only the single peak j of the observa-
tions matrix X or the single cluster m of the latent variable Xlat. Following
from Equation (6), the peak intensity data are assumed to have arisen
from the clusters representing the M unknown compounds through a
generative process with additive noise A. Further, we assume that the
noise is independent by constraining the P—by—P noise matrix A into a
diagonal form with entries

of ~ Scale — Inv—x2 (no, 0%)) (7)

that follow the scaled inverse-x2 distribution with the scale 03 and no

prior observations.

In this work, we add another level of hierarchy to the model by assum-
ing that the compounds form groups that respond to the experimental
covariates in a coherent manner (Fig. 1). We deviate from the formula-
tion of the earlier work and do not let the covariate effects, or, operate
directly on the latent variable, Xlat, which represents the coherent vari-
ation within a cluster of peaks. Instead, we introduce a higher-level latent
variable, Z G IRKXN, to represent the coherent variation within a group of
compounds. The compound-speciﬁc latent variable,

xii? ~N(Wz.,,-, 1021) (8)

is then generated from the K higher-level clusters, represented by the higher-
level latent variable, Z, through the M —by—K clustering matrix W.

a) One-level model b) Two-level model

@
«9.»
exp

N N

—J—J

 

GD

 

V

.\ QIat

)

 

 

 

 

 

Fig. 1. Plate diagrams of the one-level peak-clustering model (a)
(Suvitaival et al., 2014) and the two-level compound-clustering model
(b) (proposed in this work). The two-level model has a second level of
hierarchy for modeling coherently responding groups of compounds. The
shaded variables are observed: the intensity data X, the covariate vector a
and the peak-clustering matrix V, which is acquired from the peak-clus-
tering stage. White variables are inferred: the compound-speciﬁc latent
variable Xlat, the peak-speciﬁc variance 02, the compound-clustering W,
the compound group-speciﬁc latent variable z and the covariate effects a.
The compound-level variance parameter 102 is selected via cross-
validation

The residual variation in the levels of a compound, which is not explained
by its group, is controlled by the higher-level variance parameter, 102 6 IR + ,
which scales the M —by—M identity matrix I. In this way, the model can
reﬁne the information in the noisy observations ﬁrst at the compound level
and then at the compound group level. To infer the compound clustering, we
set a uniform multinomial prior for the K higher-level clusters.

With the second level of hierarchy introduced to the model, the cov-
ariate effects, or, no longer operate directly on the compound-speciﬁc
latent variable, Xlat. Instead, we specify the effects to contribute to the
higher-level latent variable, Z. In a one-way experimental design, this
means that the higher-level latent variable for the sample i,

z.,,-~./\/'(oc.,ai, I) (9)

is generated from the K covariate effects, 0:30,, that correspond to the
covariate level of the sample i, selected by the categorical indicator, (1,.
This formulation encourages coherently responding compounds to be
clustered together in the model.

All the covariate effects, or e IRKXA, for the K higher-level clusters and
A levels of the covariate, a e {1, . . . , A}N, are independent and identically
distributed,

a l~{ 6(0LJ), [=1 (10)

N(0,1), 1=2,...,L,

except for the baseline level, I = 1, which represents the control group and
for which the effect is by deﬁnition ﬁxed to zero.

In a two-way experimental design, there is a second covariate,
b e {1, . . . , B}N, with B distinct levels and the corresponding effects,
,8 e IRKXB, analogous to a, A and 05, respectively. Additionally, in a
two-way design, there is an interaction effect, (05,8) 6 IRKXAXB, between
the two covariates. Together, these three covariate effects inﬂuence the
higher-level latent variable,

z.,,-~N(a.,,, +33,” +(a13)_,,b,i,1) (11)

additively. Again, the covariate effects are independent and identically
distributed,

one, 18-,d’ (aﬂ)-,c,d N NW, 1) (12)

at all the levels, c e {2, . . . , A} and d e {2, ... , B}, of the covariates a and
b, respectively, except for the baseline levels, c = 1 or d = 1, where the
covariate effects are by deﬁnition ﬁxed to zero.

2.3 Model selection

The lower-level clustering of peaks into compounds follows the Dirichlet
process (Escobar, 1994), leading to a non-parametric determination of the
complexity for the lower-level latent variable.

At the higher clustering level, the model is subject to complexity selec-
tion with respect to the number of higher-level clusters, K, and the higher-
level variance parameter,  For these parameters, we make the selection
jointly based on cross-validation.

The variance parameters, 102 and 02, control the ﬂow of information
from the observed data, X, up the hierarchy of the model toward the
inferred covariate effects, a. Small values of the variance parameters
allow the information to more readily propagate toward the covariate
effects, enabling the detection of weaker covariate effects, while large
values protect from excessive false-positive effects.

For data with a simple experimental design, the number of higher-level
clusters, K, can remain low while still capturing the responses to the
covariates. In a more complex experimental design with multiple covari-
ates and their levels, the number of higher-level clusters may need to be
larger to capture the richness of the association between the observed
data and the experimental covariates. However, the number of higher-
level clusters, K, is most crucially restricted by the availability of

 

i463

112 [glO'SIBILInO[plOJXO'SODBIIIJOJIIIOIQ/[i(11111 111011 popeorumoq

910K ‘09 lsnﬁnV no 2:

T.Suvitaival et al.

 

Table 1. Design in the simulated experiments 1, 2 and 3 (columns in the table; Sections 3.1.1, 3.1.2 and 3.1.3, respectively)

 

 

 

Experiment 1 2 3
Number of samples (‘case’ + ‘control’), N 10 + 10 10 + 10 10 + 10
Number of observed variables per a lower-level cluster (peaks), P 7 2 2
Number of lower-level clusters per a higher-level cluster (compounds), M 7 7 1, 3, . . . , 19
Number of higher-level clusters (groups of similarly responding compounds), K 7 1 1
Covariate effects of the higher-level clusters, 01.; [+2, —1, +0.5, 0, 0, 0, 0] 0, 0.2, . . . , 2.0 0.2
Validation range of the number higher-level clusters, K 1, . . . , 7 - -
Validation range of the higher-level variance parameter, 102 0.05, 0.1,  , 0.5 0.1, 0.2, . . . , 0.5 0.1, 0.2, . . . , 0.5

 

replicates: the required number of samples increases exponentially with
the increasing complexity of the experimental design.

3 RESULTS

Next, we show that we can beneﬁt from the inherent structure of
the mass spectral data in two ways: ﬁrst, we can make the infer-
ence of compound-speciﬁc covariate effects more accurate by
using multiple peaks from the compound. Second, in the regime
of low signal-to-noise ratio, we can further improve the accuracy
by imposing stronger structure on the model, and infer the cov-
ariate effects on groups of coherently responding compounds.

We present experimental results on simulated data and meta-
bolomic benchmark data (F ranceschi et al., 2012) with known
changes in the concentrations of chemical compounds.

In the experiments, we compare three approaches for the in-
ference of covariate effects:

0. Single peak. The standard ANOVA model, where the
covariate effects are computed as the average difference of
the intensity of a single peak between the sample groups.

1. I-level. A Bayesian approach for inferring the covariate
effects using data from multiple spectral peaks (Suvitaival
et al., 2014).

2. 2—level. The Bayesian approach proposed in this work for
inferring the covariate effects through the two-level cluster-
ing of peaks and coherently responding compounds.

We evaluate each approach by its accuracy at inferring the
covariate effects. The accuracy is measured in terms of the
mean squared error (MSE).

3.1 Simulated data

We demonstrate the new approach through simulated experi-
ments in regimes, which imitate real metabolomic experiments
by their sample size, number of peaks associated with a compound
and the general level of noise. We present three experiments where
we studied three different aspects of the inference task: (i) the
presence of multiple unchanged compounds, (ii) the strength of
the change, and (iii) the number of coherently changing com-
pounds. These three experiments are detailed in their respective
subsections that follow next. The experiments are summarized in
Table 1.

Table 2. The two-level model was more accurate at small effect sizes of
the covariate on simulated data

 

 

 

True RMSE Corrected P-value of difference
covariate of 2-level
effect

Single 1-level 2-level to Single to 1-level
0 1.16 0.53 0.51 1.1 x 10—190” 2.9 x 10-?”
+0.5 1.42 0.68 0.63 3.9 x 10-44” 4.0 x 10-3“
—1.0 1.03 0.56 0.58 1.7 x 10-27” 4.4 x 10-1
+2.0 1.22 0.90 1.13 5.0 x 10-3” 2.6 x 10-24”

 

Note: The two-level and one-level models, and the single-peak approach (‘2-level’,
‘l-level’ and ‘Single’, respectively), were compared by their MSE between the
inferred and the true covariate effect. The smallest MSE for each true effect is
highlighted in bold. The signiﬁcance of the difference between the two-level
model and the two comparison approaches was tested with the two-sided paired
t-test with the Benjamini—Hochberg control (Benjamini and Hochberg, 199 5) for the
false discovery rate. The result is from the ﬁrst simulated experiment (Section 3.1.1).
*/** Signiﬁcant difference at conﬁdence level 95/99%.

3.1.] Presence of multiple unchanged compounds In the ﬁrst
simulated experiment, we studied the simultaneous inference of
multiple zero and non-zero covariate effects. We generated data
with seven similarly responding clusters of compounds, each
compound producing seven peaks.

When comparing the inferred covariate effects with the true
effects, the two peak-clustering models always had a lower error
compared with the single-peak approach (Table 2). Most import-
antly, the added structure of the two-level model prevented the
model from overﬁtting to the noisy data and improved the ac-
curacy at small and diminishing covariate effects, leading to a
decrease in false discoveries.

The number of the higher-level clusters, K, and the variance
parameter, 102, were selected jointly via stratiﬁed nested 5-fold
cross-validation. The procedure was repeated with ﬁve independ-
ent datasets.

3.1.2 Strength of the change In the second simulated experi-
ment, we studied how the signal-to-noise ratio of the true cov-
ariate effect inﬂuences the accuracy of inference. We generated

 

i464

112 /810's112umo[pJOJXO'sor112u1101urorq//2d11q 111011 popcorn/hog

910K ‘09 isnﬁnV no 2:

Stronger findings for metabolomics through Bayesian modeling of multiple peaks

 

independent datasets with seven compounds and progressively
increased the generated covariate effect.

The covariate effect was inferred the most accurately by the
two-level model throughout the experiment (Fig. 2a). The accur-
acy of the model-based approaches decreased slightly when the
strength of the true effect increased. This followed from the prior
assumption that prevents the model from overﬁtting to unexpect-
edly strong covariate effects. The prior for the covariate effects
places most of the probability mass around zero and thus effect-
ively sets a bias for the inferred effects toward zero (Fig. 2b). The
data-based single-peak approach does not have this bias, but its
conﬁdence intervals were considerably wider, which lead to a
larger error in the inference task. The effects in any real meta-
bolomic dataset most probably are in the weak regime, where the
bias is overshadowed by the noise in the data.

3.1.3 Number of coherently changing compounds In the third
simulated experiment, we studied how the number of coherently
responding compounds inﬂuences the accuracy of the two-level
model. We generated data with a weak covariate effect and grad-
ually increased the number of compounds.

We discovered that the accuracy of the two-level model
increased as the number of coherently responding compounds
increased (Fig. 3). The experiment empirically conﬁrmed the ex-
pected connection between the two Bayesian models: when there
was only one responding compound, the two-level model ef-
fectively reduced to the one-level model in terms of the error.
As expected, the performance of the single-peak approach and
the one-level model remained constant throughout the
experiment.

 

 

 

 

 

 

 

(A) Difference in errors v. true effect
8 _ . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . ..
0'
LO
0. _
O
x l
8
n. .9
a) o' —
a, l
E
(D m 1
9 o' --2- 2—Ievel , - '1
(Lg ' -1- 1—Ievel 1/
E 0 Single peak 1 _ ,1 a '
c c\!
._ o I
8 ' 1 I
c I ‘ ‘1
9 Ln 1’
a) N _ 1 — .1 ‘ b 1 ’ ’
FE cl) 2
D 2 2/ —2
O \2/
m —
Ci /2\ /
9".
cl) I I I I I
0.0 0.5 1.0 1.5 2.0
True effect

3.2 Benchmark data with known changes in
concentrations

Next, we applied the method on real ultra performance liquid
chromatography-mass spectrometry data (Franceschi et al.,
2012). The recently published benchmark dataset of apple sam-
ples includes a set of annotated spike-in compounds with a
known increase in the concentration. The samples have been
measured in both the positive and negative ion modes.

We started with the raw spectral data [The raw spike-in
dataset by Franceschi et al. (2012) is available online at http://
cri.fmach.eu/Research/Computational—Biology/Biostatistics-and-
Data-Management/download/data/Spiked-Apple—Data (June 11,
2013, date last accessed)] to acquire the shapes of the peaks in
addition to their heights. The data were preprocessed using
MZmine 2 (Pluskal et al., 2010) with default settings.

We evaluated the approaches by the MSE between the inferred
and the true covariate effects. If a cluster contained multiple
annotated peaks, the error was computed for each of the anno-
tated peaks. Clusters with no annotated peaks were assumed to
have a 0% true effect. The effect of the single-peak approach was
computed as the average change of the strongest peak of the
cluster.

The number of higher-level clusters and the variance param-
eter were selected jointly through a stratiﬁed nested 5-fold
cross-validation from the sets K 6 {1,2, . . ., 10} and
1&2 e {0.25, 0.5, . . . , 1.5}, respectively. Model selection and valid-
ation was done independently for the positive and negative ion
mode datasets.

The analyses for the data from both the ion modes lead to an
outcome, where the Bayesian models were more accurate at

 

 

 

 

 

 

(B) Inferred effect v. true effect
m _
-2- 2—Ievel
—1— 1—Ievel ____ __
-9- Single peak ....... "
_— Mean .._,.'.'-'-_:ZZZICII'.'..
N ---- -- 95 %quantiles  /0
. /0 2
True / 
46 . . . . . . . .. 
~19 
"a3 0/ /
8 1— - /3/$
. /
a“: 994 ..
ﬂ
0 — E/
"T _
I I I I I
0.0 0.5 1.0 1.5 2.0

True effect

Fig. 2. The peak-clustering and the compound-clustering models (‘l-level’ and ‘2-level’) reduced uncertainty around the covariate effect compared with
the single-peak approach. The hierarchical models have a bias toward zero, which follows from the model assumption incorporated to the prior of the
covariate effect. The prior-induced bias lead to a slight increase in the error of the peak-clustering models as the true effect increased but acted to prevent
the models from overﬁtting and thus from false ﬁndings at normal effect sizes. (a) Pairwise difference in the error between the single-peak approach and
each of the two clustering models shown as a function of the magnitude of the true effect. 0)) Inferred effect as a function of the magnitude of the true
effect. Result from the second simulated experiment (Section 3.1.2), where the true covariate effect was varied from 0 to 2

 

112 [glO'SIBILInO[plOJXO'SODBIIIJOJIIIOIQ/[i(11111 111011 popcorn/hog

910K ‘09 isnﬁnV no 2:

T.Suvitaival et al.

 

Error v. number of compounds per cluster

 

 

 

 

0.
. 0- . .
N - 0. 0 0 0 .0...0'..0.o 0
0. _
m -E- 2—Ievel
g -1- 1—Ievel
0: 00 ~ 0- Single peak
o. _
é~ . _
\1‘.1_ 1 1- 1- 1.'1-- 1--'1
‘0. _
O
2\
2‘2\
2—2\

 

 

 

I | I
5 10 15

Number of compounds per cluster

Fig. 3. The error in the covariate effect inferred by the compound-clus-
tering model (‘2-level’) decreased when more coherently responding com-
pounds were observed. The accuracy of the peak-clustering model and
the data-based single-peak approach (‘l-level’ and ‘Single peak’, respect-
ively) remained constant. Root mean squared error (RMSE) is shown as
a function of the number of compounds (i.e. lower-level clusters) per
higher-level cluster. Result from the third simulated experiment
(Section 3.1.3), where a weak covariate effect of 0.2 was generated and
the number of compounds was gradually increased from 1 to 19

inferring the covariate effects than the single-peak approach by a
signiﬁcant margin (Table 3). The two-level model improved the
accuracy compared with the one-level model at weak effect sizes.
It is worth noting that the results were strongly in line with the
simulated experiments (Section 3.1.1).

4 CONCLUSION

Additional spectral peaks produced by the mass spectrometer as
a result of the ionization process have been shown to be useful
for the inference of covariate effects when multiple peaks can be
conﬁdently associated with one compound. However, even with
multiple peaks supporting the inference, small covariate effects
may be hidden under the between-sample variation. We ad-
dressed this problem by introducing stronger structure to the
model of the covariate effects, thereby regularising the covariate
effects and making them less dependent on the variation of in-
dividual compounds.

We achieved an improvement in the accuracy of the inferred
covariate effects by assuming a structure of coherently respond-
ing compounds in the data. We proposed a structured model for
inferring covariate effects for groups of compounds through two
layers of probabilistic clustering. Metabolomic data are known
to have collinear structure for similar compounds. This phenom-
enon is argued to arise from the biological processes that the
compounds are involved in. However, the method proposed in
this work does not restrict the groups of compounds by their

Table 3. The two-level model is most accurate at small levels of covariate
effects and both the Bayesian models are more accurate than the single-
peak approach on the metabolomic benchmark data (Section 3.2)

 

True RMSE Corrected P-value of
covariate difference of 2-level
effect (%)

 

Single 1-level 2-level to Single to 1-level

 

(a) Positive ion mode
+ 0 0.42 0.31 0.09 < 8** < 8**
+ 20 0.41 0.22 0.19 3.4 x 10-34” 2.1 x 10-13”
+40 0.44 0.28 0.33 3.8 x 10-11” 2.7 x 10-4”
+100 1.06 0.91 0.92 1.3 x 104* 1.3 x 10-5“
(b) Negative ion mode
+ 0 0.42 0.31 0.11 < 8** < 8**

+ 20 0.54 0.26 0.20 2.5 x 10“’** 4.4 x 10-43”
+ 40 0.45 0.34 0.35 6.1 x 10-30” 1.1 x 10-8“
+100 0.82 0.74 0.88 2.5 x 10-1 4.2 x 10-83”

 

Note: The two-level and one-level models, and the single-peak approach (‘2-level’,
‘l-level’ and ‘Single’, respectively), are compared by their MSE between the
inferred and the true covariate effect. The smallest MSE for each true effect is
highlighted in bold. The signiﬁcance of the difference between the two-level
model and the two comparison approaches is tested with the two-sided paired
t-test with the Benjamini—Hochberg correction (Benjamini and Hochberg, 1995)
for the P-values. A near-zero value below the machine accuracy is denoted by ‘8’.
*/** Signiﬁcant difference at conﬁdence level 95/99%.

chemical or biological similarity but infers the groups only
based on their responses to the covariates.

In the experiments, we showed that the two-level model pro-
posed in this work decreases the error of inferred covariate ef-
fects in a typical setting, where the true effects are small or
diminishing. Through three simulated experiments, testing the
approaches with multiple zero-effect clusters, varying effect size
and varying number of similarly responding compounds, we
demonstrated that the two-level model is more accurate at infer-
ring weak covariate effects from noisy multipeak data when
compared with the two comparison approaches. The outcome
was repeated on a metabolomic benchmark dataset with known
changes in the compound concentrations. Following the reduc-
tion in the error for the weak covariate effects, the two-level
model is argued to reduce false ﬁndings.

To further improve the consistency of the inferred covariate
effects, we suggest the following avenues of research: (i) prior
knowledge about the similarity of the compounds can be incor-
porated into the prior of the higher-level clustering, either in
terms of the biological processes in which the compounds are
involved or in terms of the chemical similarity of the compounds.
(ii) The lower-level clustering can be improved to detect even the
weakest peaks by incorporating prior knowledge about the rela-
tive positions of the peaks associated with one compound. This is
possible thanks to the fact that the expected positions of many
adduct and isotope peaks can be calculated based on the ioniza-
tion process and the chemical formula of the compound, respect-
ively. (iii) The covariate effects in the isotope peaks are argued to
be highly preserved because the isotope peaks do not arise from
variation in the ionization process. Additionally, the expected
relative heights of these peaks can be calculated if the identity

 

i466

112 [glO'SIBILInO[plOJXO'SODBIIIJOJIIIOIQ/[i(11111 111011 popcorn/hog

910K ‘09 lsnﬁnV no 2:

Stronger findings for metabolomics through Bayesian modeling of multiple peaks

 

of the compound is known. Incorporating these properties into
the model may be even more useful for the inference of covariate
effects than the two aforementioned points.

Funding: Academy of Finland (Finnish Centre of Excellence
in Computational Inference Research COIN, 251170;
Computational Modeling of the Biological Effects of
Chemicals, 140057). Computational resources were provided
by the Aalto University School of Science ‘Science—IT’
project.

Conﬂicts of Interest: none declared.

REFERENCES

Benjamini,Y. and Hochberg,Y. (1995) Controlling the false discovery rate: a prac-
tical and powerful approach to multiple testing. J. R. Stat. Soc B Methodol, 57,
289—300.

Broadhurst,D.I. and Kell,D.B. (2006) Statistical strategies for avoiding false discov-
eries in metabolomics and related experiments. Metabolomics, 2, 171—196.

Dahl,D.B. (2006) Model-based clustering for expression data via a Dirichlet process
mixture model. In: Do,K.A. and Mﬁller,P. (eds) Bayesian Inference for Gene
Expression and Proteomics. Cambridge University Press, Cambridge,
pp. 201—218.

De Iorio,M. et al. (2004) An ANOVA model for dependent random measures.
J. Am. Stat. Assoc, 99, 205—215.

Escobar,M.D. (1994) Estimating normal means with a Dirichlet process prior.
J. Am. Stat. Assoc, 89, 268—277.

Franceschi,P. et al. (2012) A benchmark spike-in data set for biomarker identiﬁca-
tion in metabolomics. J. Chemom., 26, 16—24.

Huopaniemi,I. et al. (2009) Two-way analysis of high-dimensional collinear data.
Data Min. Knowl. Discov., 19, 261—276.

Jansen,J.J. et al. (2012) Individual differences in metabolomics: individualised
responses and between-metabolite relationships. Metabolomics, 8, 94—104.
Katajamaa,M. and Ore§ié,M. (2007) Data processing for mass spectrometry-based

metabolomics. J. Chromatogr. A, 1158, 318—328.

Kau,A.L. et al. (2011) Human nutrition, the gut microbiome and the immune
system. Nature, 474, 327—336.

Kaufman,C.G. and Sain,S.R. (2010) Bayesian functional ANOVA modeling using
Gaussian process prior distributions. Bayesian Anal., 5, 123—149.

Kuhl,C. et al. (2012) CAMERA: an integrated strategy for compound spectra
extraction and annotation of liquid chromatography/mass spectrometry data
sets. Anal. Chem., 84, 283—289.

Mitchell,T.J. and Beauchamp,].J. (1988) Bayesian variable selection in linear regres-
sion. J. Am. Stat. Assoc, 83, 1023—1032.

Ore§ié,M. (2009) Metabolomics, a novel tool for studies of nutrition, metabolism
and lipid dysfunction. Nutr. Metab. Cardiovasc. Dis., 19, 816—824.

Plumb,R. et al. (2004) Ultra-performance liquid chromatography coupled to quad-
rupole-orthogonal time-of-ﬂight mass spectrometry. Rapid Commun. Mass
Spectrom., 18, 2331—2337.

Pluskal,T. et al. (2010) MZmine 2: modular framework for processing, visualizing,
and analyzing mass spectrometry-based molecular proﬁle data.
BMC Bioinformatics, 11, 395.

Rogers,S. et al. (2009) Probabilistic assignment of formulas to mass peaks in meta-
bolomics experiments. Bioinformatics, 25, 512—518.

Saccenti,E. et al. (2014) Reﬂections on univariate and multivariate analysis of
metabolomics data. Metabolomics, 10, 361—374.

Smilde,A.K. et al. (2005) ANOVA-simultaneous component analysis (ASCA): a
new tool for analyzing designed metabolomics data. Bioinformatics, 21,
3043—3048.

Steuer,R. (2006) Review: on the analysis and interpretation of correlations in meta-
bolomic data. Brief. Bioinform., 7, 151—158.

Suvitaival,T. et al. (2014) Stronger ﬁndings from mass spectral data through multi-
peak modeling. BM C Bioinformatics, 15, 208.

Tikunov,Y. et al. (2012) MSClust: a tool for unsupervised mass spectra extraction of
chromatography-mass spectrometry ion-wise aligned data. Metabolomics, 8,
714—718.

 

112 /810's112umo[pJOJXO'sor112u1101urorq//2d11q 111011 popcorn/hog

910K ‘09 isnﬁnV no 2:

