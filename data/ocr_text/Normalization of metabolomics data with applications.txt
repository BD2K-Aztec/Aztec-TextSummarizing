ORIGINAL PAPER

Vol. 30 no. 15 2014, pages 2155-2161
doi: 10. 1 093/bioinformatics/btu1 75

 

Gene expression

Advance Access publication April 7, 2014

Normalization of metabolomics data with applications to

correlation maps

Alexandra Jauhiainen”, Basetti Madhu2, Masako Narita2, Masashi Narita2, John Griffiths2

and Simon Tavaré2

1Department of Medical Epidemiology and Biostatistics, Karolinska lnstitutet, PO Box 281, SE—171 77 Stockholm,
Sweden and 2Cancer Research UK Cambridge Institute, University of Cambridge, Li Ka Shing Centre, Robinson Way,

Cambridge CB2 ORE, UK

Associate Editor: Ziv Bar-Joseph

 

ABSTRACT

Motivation: In metabolomics, the goal is to identify and measure the
concentrations of different metabolites (small molecules) in a cell or a
biological system. The metabolites form an important layer in the com-
plex metabolic network, and the interactions between different metab-
olites are often of interest. It is crucial to perform proper normalization
of metabolomics data, but current methods may not be applicable
when estimating interactions in the form of correlations between me-
tabolites. We propose a normalization approach based on a mixed
model, with simultaneous estimation of a correlation matrix. We also
investigate how the common use of a calibration standard in nuclear
magnetic resonance (NMR) experiments affects the estimation of
correlations.

Results: We show with both real and simulated data that our pro-
posed normalization method is robust and has good performance
when discovering true correlations between metabolites. The stand-
ardization of NMR data is shown in simulation studies to affect our abil-
ity to discover true correlations to a small extent. However, comparing
standardized and non-standardized real data does not result in any
large differences in correlation estimates.

Availability and implementation: Source code is freely available at
https://sourceforge.net/projects/metabnorm/

Contact: alexandra.jauhiainen@ki.se

Supplementary information: Supplementary data are available at
Bioinformatics online.

Received on August 30, 2013; revised on February 26, 2014; accepted
on March 28, 2014

1 INTRODUCTION

In metabolomics, the ultimate goal is to determine quantitatively
the levels of all metabolites (small molecules) in a biological
sample. At present, it is not possible to measure the complete
metabolome, and, depending on the purpose of the experiment,
the number of features measured can range from a handful to a
couple of thousands. Usually, in targeted experiments, a small
number of features are measured, and the metabolites are com-
pletely identiﬁed. In untargeted experiments, many more features
are quantiﬁed, but a majority of them cannot be identiﬁed as a

 

*To whom correspondence should be addressed.

speciﬁc metabolite. Subsets of the metabolome are sometimes
referred to as metabolic proﬁles (Chung et al., 2003).

Several methods are at our disposal for metabolomic analyses,
e.g. nuclear magnetic resonance (NMR) spectroscopy or gas
chromatography coupled to mass spectrometry. In this article,
we focus on metabolomics data from NMR experiments. When
quantifying metabolite levels by using proton NMR, the protons
in a molecule give rise to a signal that appears as one or several
peaks in a spectrum. Because of spin-quantum effects, peaks split
in different ways and may overlap, but it is often possible to
assign and quantify peaks that belong to a single metabolite or
group of metabolites. Usually, the signal from a metabolite is
quantiﬁed by calculating the area of a peak that can be uniquely
assigned to it, although peak heights are also sometimes used.

To quantify the concentrations of the metabolites, it is
common practice to add a known amount of a certain compound
to each sample. When the compound is dissolved in the sample
itself, it is called an internal standard. In contrast, an external
standard would be either a solution of the compound in a capil-
lary or the compound run as a separate sample but with the same
experimental setup. The added calibration compound then gives
rise to a control peak in the spectrum of the sample. Compounds
commonly used as (internal) calibration standards in proton
NMR are trimethylsilyl propionate (TSP) and tetramethylsilane.

The following formula is used to calculate the concentration of
the metabolites using the calibration standard. Let C,- be the
concentration of metabolite i, and C0 the (known) concentration
of the control compound. Set

CiZCO X  X 1:;(1),i=1,2,...,1 
where N0 is the (known) number of protons in the control mol-
ecule, N,- is the (known) number of protons in metabolite i, A,- is
the measured peak area of metabolite i and A0 is the peak area of
the standard. Besides helping with quantiﬁcation, a calibration
standard is useful for chemical shift calibration, which helps in
identifying the metabolites by using the chemical shift values in
the literature.

However, the use of the standard can be troublesome in some
scenarios, as we show in Appendix A in the Supplementary
Information. The fact that the standardization is done as a
ratio will induce apparent correlations between metabolites,
even if none exists in the ﬁrst place.

 

© The Author 2014. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com 2155

112 /310's113umo [p.IOJXO'SOllBIIIJOJUIOIQ/ﬁdllq 11101; pepBOIUAAOG

9IOZ ‘09 lsnﬁnv uo ::

A.Jauhiainen et aI.

 

Metabolites in the cell participate in enzyme-catalyzed reac-
tions that form complex biochemical networks. There are often
interactions between metabolites (affecting their concentrations)
when they appear in the same biochemical sub-network, or path-
way. If, for instance, there is a rise in the cellular concentration of
a metabolite that is the substrate of an enzyme, then the cata-
lyzed reaction will usually proceed more rapidly so that the prod-
uct of the reaction will also tend to increase in concentration.
Thus, the concentrations of substrate and product would tend to
be positively correlated. In the same way, negative correlations
may occur when an increase in concentration of one metabolite
leads to the depletion of the second metabolite. An example
might be an enzyme that is subject to allosteric inhibition: a
rise in the cellular concentration of the inhibitor metabolite
would then tend to reduce the cellular concentration of the en-
zyme’s product. Thus, the inhibitor and the product would be
negatively correlated.

Analysis of the positive and negative correlations between
metabolites can be performed by preparing a large number (typ-
ically 30—50) of apparently identical samples of, for instance,
cultured cells. Although the measured concentrations of cellular
metabolites in the individual samples will be identical within bio-
logical variation, that uniformity is achieved by numerous
homeostatic mechanisms that will give rise to positive and nega-
tive correlations between metabolite concentrations. This type of
analysis is often referred to as metabolite—metabolite correlation
analysis (MMCA) (Fiehn and Weckwerth, 2003; Kose et al.,
2001; Steuer, 2006). The terms MMCA, correlation analysis
and estimation of correlation maps will be used interchangeably
in this article.

Commonly, Pearson correlations are used to estimate the
interactions between metabolites. The use of mutual information
has also been suggested as a dependency measure, as it captures
more than linear relationships between metabolites (Numata
et al., 2008). However, as metabolomics data generally are
quite skewed, even after transformation with a standard as in
Equation 1, the Pearson coefﬁcient may not be a good estimate
of the correlations (see further discussion below). A transform-
ation of the data may therefore be needed before further analysis.
Estimating interactions with mutual information can also beneﬁt
from such transformations (Kraskov et al., 2004).

The need for normalization for metabolomics data is crucial,
just as with other types of omics data. NMR samples are affected
by technical artifacts and may exhibit inﬂated between-sample
variation owing to batch effects. For correlation analysis, these
batch effects, together with effects from standardization, will
result in large positive correlations, as illustrated in Figure l.

A few normalization methods for metabolomics data have
been suggested in the literature. The NOMIS method (Sysi—
Aho et al., 2007) is based on the presence of multiple internal
standards in each sample. The optimal combination of standards
is selected and used to remove systematic error. Also dependent
on multiple internal standards is the CCMN method (Redestig
et al., 2009), which is mainly aimed at mass spectrometry-based
metabolomics data. A recent addition to the ﬁeld is the RUV-2
method, which is shown to be powerful for removal of unwanted
variability while not being dependent on internal standards (De
Livera et al., 2012). However, RUV-2 is not a global normaliza-
tion method in the sense that it does not produce a complete

1.0

0.5

-0.5

-1.0

 

 

 

Fig. 1. Correlation analysis on a real NMR dataset. The metabolite—
metabolite correlations in the left panel are deduced using non-
normalized data, whereas the right panel illustrates the correlation
estimates when using normalized data. The dataset used is the standar-
dized log-transformed HDF set (see Section 2) and the normalization
method is our proposed mixed model (see Section 3). Technical artifacts
like batch effects and the use of a calibration standard lead to large
positive correlations in the non-normalized data

normalized dataset, but rather a compressed set suitable for
detecting differentially abundant metabolites. Hence, RUV-2 is
not recommended in connection to classiﬁcation, clustering
problems or MMCA.

In situations when these metabolomics normalization methods
are not appropriate, normalization methods adapted from the
single-channel microarray literature are commonly used.
However, the nature of some common single-channel methods,
e.g. quantile normalization (Boes and Neuhauser, 2005; Bolstad
et al., 2003), renders them inappropriate to use on the smaller
datasets that are usually produced in metabolomics. In quantile
normalization, the idea is to give each sample the same distribu-
tion over features (e.g. metabolites). This is achieved by sorting
the values in each sample, calculating a mean quantile over the
samples and substituting the value of the data item in the original
dataset with the mean (followed by a re—sort of each sample).
This can be problematic for features in the tails of the distribu-
tion, as it is possible that a feature could receive the same value
across all samples. The result of this is that, as happens with our
dataset described in Section 2, some correlations between metab-
olites cannot be calculated. The median centering normalization
also proves to be relatively non-robust if the number of metab-
olites is small (see discussion below).

In this article, we investigate how the use of a calibration
standard for quantitation affects the reliable estimation of cor-
relation maps. We argue that log transformations are reasonable
for metabolomics data, and we suggest a global normalization
method, suitable for smaller (targeted) metabolomics datasets,
that is robust in connection to MMCA. The purpose of this
normalization is to remove variation due to sources other than
homeostatic changes. The proposed global normalization
method is intended to be a complement to existing methods de-
pendent on multiple internal standards and methods that only
function in differential expression settings.

2 APPROACH

We use two versions of a real NMR dataset for our investiga-
tions and to illustrate our methods. The dataset stems from six
cohorts of IMR90 human diploid ﬁbroblasts (HDFs). For each

 

2156

112 /810's112umo [p.IOJXO'SOIlBIIlJOJUIOIQ/ﬂdllq 11101; pepBOIUAAOG

9IOZ ‘091sn3nv uo ::

Normalization of metabolomics data

 

1}! 000 g 0
QEOGGGGEGO

1I1554 564

Fig. 2. Design for the real NMR dataset. The samples of HDFs originate
from six cohorts (level I), which are divided into 10 batches (level II, A-D.
From each batch, a number of different samples are cultured (level III).
The total number of samples is 52

cohort, a number of batches were extracted, which in turn gave
rise to a number of samples (52 in total). The design is illustrated
in Figure 2. Cells from each sample were harvested (and further
processed), and 10 ,aL of 10mM TSP was added as an internal
standard. Proton NMR spectroscopy data were acquired on a
600MHz Bruker Avance NMR spectrometer by using a water
pre—saturation pulse sequence. Preprocessing of the time-domain
data included exponential multiplication (line broadening
0.3 Hz), Fourier transformation and zero and ﬁrst order phase
correction as well as log2 transformation.

In one version of this dataset, which we refer to as standardized
(std), TSP was used for chemical shift calibration and metabolite
quantitation. In total, 28 metabolites were uniquely character-
ized. In the other version of the dataset, called raw, TSP was not
used for quantitation. In this set, 26 spectral features could be
identiﬁed, of which some features are sums of signals for several
metabolites. The two datasets are not directly comparable, as, in
addition to the issues involving standardization, the same metab-
olite might not correspond to the same peaks in both sets.

We also use simulated datasets to compare the performance of
different normalization techniques. The structure of the variation
modeled for the simulated datasets is similar to that in the real
dataset as we include artifacts like cohort, batch and sample
effects.

3 MATERIALS AND METHODS

3.1 Transformation of data

In Supplementary Figure S1 (Appendix B in the Supplementary
Information), we show the distribution of the samples in the standardized
HDF dataset without any normalization or transformation. The data
exhibit skewness, with many large outliers. In such situations, the
Spearman rank correlation coefﬁcient may give a better estimate of the
interactions than the Pearson coefﬁcient. However, not only MMCA but
also different types of normalization are performed on the data. These
methods are not always suited for highly skewed data, so instead we
argue that the data should be transformed to achieve more balanced
distributions for each sample. One such transformation is the log trans-
formation, which we use throughout this article.

3.2 Raw versus standardized peak areas

When normalizing the type of NMR data we described in the previous
sections, we argue that log-transformed data should be used. Apart from
the choice of using a transformation or not, we can also choose between
normalizing standardized intensities (C,- or log(C,)) or the raw peak areas
(A,- or log(A,-)). As indicated above, a TSP-normalized dataset has better
resolution of individual metabolites, but the additional scaling can cause

artiﬁcial correlations. Normalizing the raw peak areas has a natural
appeal, as we remain close to the original data. If a correlation map is
the end goal, then we can use the peak areas directly, because the scaling
with proton number will cancel out. Let A,/N, be the peak area for
metabolite i scaled by proton number, then we have the following
equation:

D(A.-/N.-)D(Aj/N,~)
COV(Ai/Aj)/ (Ni ' NJ)

: D<A.-)/N.- - Dela/N, 2C0”(A"’Aj)

COI'I'(Ai/Ni, 
(2)

and, as log(A,/N,) = log(A,-) — log(N,), we get
C0rr(10g(Ai/Ni), 10g(A,~/N,')) = C0rr(10g(Al-), 10g(A,~)) (3)

where D( - ) denotes standard deviation.

3.3 ANOVA approach to normalization

Fixed effects models to normalize microarray data have been suggested in
several papers (Kerr and Churchill, 2001a, b). We adapt the microarray
approach as a comparison to correct for effects from the different co-
horts, batches and samples. This ANOVA (Analysis of variance) model
can be adapted for either raw peak areas or standardized areas. We have
i = l, ...,I metabolites, j = l, ..., J cohorts, k =1,...,K
batches and] = l, . . . , L samples. Let Yijk, denote the log-transformed
peak area/concentration for metabolite i in cohort j, batch k and sample I
as follows:

Yzjkz=M + Oli+ ,3, + V]: +31 + 81'ij (4)

where or, is the metabolite effect, ,8]- a cohort effect, yk a batch effect, 6, a
sample effect and 8,17,, ~ N(0, 02) is a random error term. When no
cohorts are deﬁned, the model reduces to having only a metabolite,
batch and sample effect.

3.4 Mixed model approach to normalization

Owing to the structure of the experimental data, the cohorts can be re-
garded as coming from a larger pool of HDF cohorts, a reasoning that
also applies to the batches and samples. A mixed effects model is there-
fore a more appealing alternative to model the variation than a ﬁxed
effects model. Again, either log-transformed raw peak areas or standar-
dized metabolite levels can be used as input. A suitable mixed model can
be formulated as follows:

Yiij = M + 051' + bj+bjk+bjkl+8ijkl (5)

where b]- ~ N(0,of) is a cohort effect, bjk ~ N(0,o§) is a batch within
cohort effect and Z7ij ~ N(0, 0%) represents a sample within batch within
cohort effect.

As we are interested in estimating the correlation matrix for the me-
tabolites, we can estimate this at the same time as the ﬁxed and random
effects by adopting an iterative procedure.

To achieve this, we reformulate the model in Equation 5 into a matrix
form:

Y1=X 1,3+Zzu+81, (6)

where Y, is the signal for sample I, which is a vector of length I (the
number of metabolites). The vector ,8 contains the ﬁxed effects and u is
a vector of the random effects. The matrices X, and Z, are the sample-
speciﬁc regressor matrices. The random error term 8, is a vector with
a N (0, 2) distribution where E is the I X I metabolite covariance
matrix. The random effects a have variance-covariance matrix

 

2157

112 /310's112umo [p.IOJXO'S311BIIIJOJUIOIQ/ﬁdllq 111011 pep1201umoq

910Z ‘091sn3nv uo ::

A.Jauhiainen et aI.

 

 

 

 

 

 

 

 

 

a) |\__ O O I I
‘3 o / I o/0 I
E m : :
'5 d- O/ /o
(D I I
g LQ- I I O o
'4: o I I
<6 ' ' A
E g. I I O/ /
8 O'— A : E A
g d— A a a o a o /
9 N  a a A
(D ._ ” I O I
“u: o I O-~~- 4'” I
:6 / I // O 9 ' / ro‘~‘
I / I A , ~O____.
B 1— ,A I ’/  I ’/ z’
2 o' - /:.<22 - o-—--O 9"” I o-———o/ §§>
0 ::§“ I g / I —Q ’ ——‘
g : / —"9 Wusﬁ : -”‘ --e----Q____
< 3. . :   : ""18?" “"9
I I I I I E I I I I I E I I I I I E I I I I I
1 2 3 4 5 I 1 2 3 4 5 I 1 2 3 4 5 I 1 2 3 4 5

No of metabolites removed

0 Median centering <> ANOVA model
A Sum scaling — Maximum corr
X Mixed model - - - Mean corr

Fig. 3. Robustness of normalization methods with regard to correlations. Changes to correlation estimates when removing one, two, and up to ﬁve of
the metabolites with the highest variance (left panel), the lowest variance (mid-left panel), median closest to the overall dataset median (mid-right panel)
and ﬁnally the metabolites with the highest mean (right panel). The correlation estimates between the retained metabolites are compared when using the
full dataset and the reduced sets. The maximum (solid line, black) and mean (dashed line, grey) of the absolute difference in correlation estimates are

shown. The dataset used is the standardized log-transformed HDF set

G = diag(of,. . . , of, 0%, . . . , 0%, 0%, . . . ,03). The iterative proced-
ure is as follows [cf. Meng and Rubin (1993)]:

0. Initialize E, e.g. with a diagonal unit matrix.

1. Update the ﬁtted values. (Fitted values are obtained by adding
the ﬁtted values from the ﬁxed effects and the estimated contri-
butions of the random effects on the highest level of grouping.)
Calculate the matrix square root of the inverse of E: B = 23—1/2
(by using, e.g. diagonalization). Transform Y,, X ,, Z, so that
Y} 2 BY,, Z} = BZ, and X”, = BX ,. Fit the model in Equation 6
with the transformed matrices for each sample 1. Calculate the
ﬁtted values F V, and residuals RV}. Inverse transform the
residuals and ﬁtted values by F V, = B‘IFVI and RV, = B‘1 RV}.

2. Update 2.
Estimate 2 by using 1 RV,RV[T.

3. Go to l and repeat the procedure until convergence.

When no cohorts are deﬁned, the model will include a ﬁxed metabolite
effect, a random batch effect and a random sample within batch effect.

We ﬁt this model with the open source software R (R Core Team,
2012) using the hglm package (Ronnegard et al., 2010).

3.5 Simulation of data

Samples were simulated from a normal distribution with a metabolite-
speciﬁc mean and under a ﬁxed covariance matrix (of varying size) to
mimic log-transformed real data. Levels for a control metabolite, with a
small interaction to the other metabolites and with half the variance of
the other metabolites, were also generated. Random effects for cohorts,
batches and samples were added to the log-transformed data. To mimic
the real data, scaling with the control metabolite was done on the non-log
scale.

3.6 Comparisons with other methods of normalization

We mainly compare (in addition to the ANOVA approach) our proposed
method with three global single-channel normalization methods that are
not dependent on the presence of internal standards and are implemented

in readily available R packages: ﬁrst, a loess smoother, implemented as
normalize . loess in the affy package (Gautier et al., 2004); second,
a median centering method where the median of each sample is sub-
tracted. This normalization will re-center the values, but this has no
effect when correlation estimates are concerned; and ﬁnally, we use a
sum scaling method, which is based on scaling each sample with the
total signal of that sample.

Quantile normalization (QN) (Bolstad et al., 2003) and variance sta-
bilizing normalization (VSN) (Huber et al., 2002) are not applicable
to the HDF dataset, but are used as a comparison for simulated
datasets of larger dimensions. The implementations used are the
normalizeQuantiles and normalizeVSN methods in the R pack-
age limma (Smyth, 2005). The limma package calls the vsn package to
perform the normalization for VSN. All normalization methods are
applied on log-transformed real data and on simulated data without
transformation.

4 RESULTS

4.1 Robustness of different normalization methods

To compare the robustness of the different normalization meth-
ods when estimating correlations, we used the HDF dataset
(both raw and standardized versions). Ideally, correlations be-
tween a subset of the metabolites should remain the same if we
remove one or several other metabolites from the set and redo
the normalization and estimation. However, if the number of
features is relatively small, the normalization methods will be
highly dependent on the levels of some metabolites.

In Figure 3, results from such an experiment are presented. We
removed from one up to ﬁve of the metabolites with (i) highest
variance (left panel), (ii) the lowest variance (mid-left panel), (iii)
median closest to the overall dataset median (mid-right panel) and
ﬁnally (iv) the metabolites with the highest mean (right panel). The
dataset used is the standardized HDF set. Similar plots for the raw
HDF set (Supplementary Fig. S1) and for both the raw and

 

2158

112 /310's112umo [p.IOJXO'SOIlBIHJOJUIOIQ/ﬁdllq 111011 pep1201umoq

910Z ‘091sn3nv uo ::

Normalization of metabolomics data

 

 

E
0.9
I
E

0.8

 

 

Average AUC
0.7
|
> g m g
Eaﬁg
,<. 2

 

 

 

 

 

 

(c) (d)

ff

 

 

 

 

 

 

 

 

 

0. _
O . .
— Mixed — MIxed
— Sum — Sum
g _ V\ Median A Median
— ANOVA — ANOVA
| | I I | | I I | | | | | | | | | | | | | | | I I I I I I I I
wvoooocovcooooovoooocoq-cooo wVODwCDVCDCOwVCDCOCOV CO wVwCDCOVCOCDwwaCOVCOCD covcooocovcooocovcooocovcooo
V II V II CD II CD II V II V II CD II CD II V II V ll 07 ll 07 II V II V ll 07 II II V II V II CD II CD II V II V II CD II CD II V II V II CD II CD II V II V II CD II CD II
ll .0 || .0 || .0 II .D ll .0 || .0 || .0 II .D || .0 || .0 || .0 || .0 || .0 || .0 || .0 .0 || .0 || .0 ll .0 || .0 || .0 || .0 || .0 || .0 II .D II .D II .D II .D II .D II .D II .D II .D
CCCCCCCECCCCCCCC CCCCCCECCCCCEC C CCCCCCCCCCCCCCCC CCCCCCCCCCCCCCCC
Raw Standardized Raw Standardized Raw Standardized Raw Standardized

Fig. 4. AUC values for discovery of true correlations for different scenarios when varying the number of metabolites, batches and samples. The number
of metabolites is 12 in panel (a), 24 in panel (b), 36 in panel (c) and 48 in panel ((1). The number of samples was alternated between 48 and 96, whereas the
number of batches was either 4 or 8. The AUC values given are the averages over 50 simulated datasets

standardized sets when random metabolites are removed
(Supplementary Figs S2—S4) are given in Appendix C in the
Supplementary Information. For each new dataset, we normalized
using the ANOVA model, our proposed mixed model, sum scaling
and median centering. A loess smoother was also included when
applicable. We then compared how large the differences were in
the estimated correlations for the retained metabolites in each
dataset. We calculated the maximum and mean absolute differ-
ences in correlation estimates.

The median centering performs poorly in most scenarios
(although the effects are not as dramatic when using the raw
HDF set), whereas the sum scaling suffers most when removing
high intensity metabolites. The ANOVA model and mixed model
perform similarly, with a slight edge to the mixed model.

4.2 Reconstruction of correlation maps

A simulation study was performed to assess the different nor-
malization methods concerning discovery of true correlations,
as well as comparing raw and standardized data. A number of
scenarios were simulated as described in Section 3. The number
of metabolites was varied between 12 and 48, whereas the
number of batches and samples was evaluated using two levels
each, with the number of cohorts ﬁxed to two throughout the
simulations. Two different basic correlation matrices in a block-
diagonal form were used to deﬁne the dependencies between
metabolites in the different scenarios (details in Appendix D of
the Supplementary Information).

One set of results is given in Figure 4. Using 50 replicates of
each scenario, we evaluated the correlation estimates by dedu-
cing estimates of the true positive rate (TPR) and false positive
rate (FPR) for a subset of the normalization methods in the
robustness study. The TPR and FPR form the basis (using a
range of cut offs for correlation) for calculating the area under
the receiver-operating characteristic curve (AUC).

Based on both raw and standardized data, the mixed and
ANOVA models outperform the median normalization method
in all scenarios [difference in AUC, paired t—test with all P—values
< 0.001]. The sum scaling performs well on the raw data, but
deteriorates on the standardized dataset. The mixed model and
ANOVA normalization have a comparable performance, al-
though the mixed model outperforms ANOVA on the datasets
with smaller number of metabolites (p< 0.005). The mixed and

ANOVA models perform marginally better on the raw data than
on the standardized counterpart. Results for the second set of
correlation matrices are presented in Supplementary Figure S4
(Appendix D of the Supplementary Information).

Another way to evaluate the normalization methods is to clus-
ter the metabolites using the normalized data. The blocks deﬁned
in the correlation matrix, as described brieﬂy above, form nat-
ural clusters of metabolites. To compare the clustering from each
method with the true groupings of metabolites, we use the ad-
justed Rand index [a measure in the range (0, 1), where 1 indi-
cates perfect match]. As the division into groups is based on
correlations, not differing metabolite levels, a distance measure
for the clustering must be correlation based. By using 1 — ,
where eg- is the correlation between two metabolites i and j, we
see that a clustering is simply a different approach to assess the
correlation matrix estimates. Supplementary Tables S1 and S2 in
Appendix D in the Supplementary Information show the average
Rand index over 50 replicated simulations for the same data as
presented in Figure 4 and Supplementary Figure S5. The mixed
model edges the other approaches in most of the scenarios using
this evaluation technique.

 

 

Cij

4.3 Raw versus standardized data

To further investigate the comparability of raw and standardized
NMR data, we identiﬁed ﬁve metabolites in our HDF dataset
with signals originating from exactly the same peaks in both the
raw and standardized log-transformed versions (i.e. chemical
shift calibration has no effect). Both versions of the data were
normalized (using the complete sets of features; 26 in raw and 28
in standardized) with median centering, sum scaling and our
mixed model. The 10 metabolite—metabolite correlations were
then compared for the different versions of the data (raw or
standardized) for the three normalization methods, including
no normalization at all, as depicted in Figure 5.

For non-normalized data, the correlations are all close to zero
or positive, which most likely is caused by artifacts like batch
effects that induce correlations. It should also be noted that a
subset of the metabolites exhibit strong positive correlations in
the standardized data, with more modest positive correlations in
the raw version, which indicates that the calibration standard
affects the signal. However, for the normalized data the correl-
ation estimates are more comparable (close to the diagonal line),

 

2159

112 /810's112umo [p.IOJXO'SOIlBIHJOJUIOIQ/ﬁdllq 111011 pep1201umoq

910Z ‘091sn8nv uo ::

A.Jauhiainen et aI.

 

 

 

0. _ a 

“g  9536 III-"III.
2 A"

3 Lo. _   .A
.8 O  
"C : 
8 A i , 1 9'6
c 3 
(U  _ . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .22' . . . . . . . . . . . . . . . . .  . . . . . . . . . . . . . . . . ..
175 o A  9K
.E o  Sale
c I.  
E o _ A ,1 0 Mixed model
CD I .  . .
g  ‘ MedIan centerIng
0 A Sum scaling

0. _ _ ale No norm

' "I I i I I

—1.0 —0.5 0.0 0.5 1.0

Correlation in raw data

Fig. 5. Raw NMR data compared with the standardized counterpart.
The inter-metabolite correlations for ﬁve metabolites (alanine, choline,
glutamate, glycine and valine) are compared in raw and standardized
data for three normalization methods and non-normalized data in the
HDF dataset

although the sum scaling produces some outliers. The mixed
model results in the most comparable correlations.

4.4 Low- to high-dimensional data

The simulation studies presented in the previous section indicate
that model-based approaches outperform approaches based on
median centering and sum scaling when normalizing datasets in
the size range 10—50 features. When the number of features in-
creases further, single-channel methods adapted from the micro-
array literature can be used. We compared how our mixed model
performed in comparison with QN and VSN in identifying cor-
relations for increasing numbers of metabolites (20, 40, 80, 160,
320 and 640 features). The number of samples was ﬁxed and the
correlation matrices estimated using a shrinkage approach
(Schafer and Strimmer, 2005). More details are given in
Appendix E in the Supplementary Information.

Table 1 contains the average AUC values for each method
over 50 replicates for each dataset size. The quantile normaliza-
tion clearly has problems for small numbers of features, while the
variance stabilizing normalization, by following the recommen-
dations for usage, is not recommended for the simulations with
the two smallest sizes. VSN eventually catches up to the mixed
model in the normalization, whereas interestingly enough, QN
does not, although the differences in AUC are not big. The fact
that QN has a worse performance than VSN in the setting of
correlation estimation between features can be because of the
properties reported by Lim et al. (2007). Although QN works
well in the differential expression settings, correlation artifacts in
the data are also introduced. When the number of features
exceeds 100—150, these results indicate that variance stabilizing
normalization can be used with similar performance to a model-
based approach, while quantile normalization would be less
preferable to VSN.

Table 1. AUC values for estimating correlations with varying number of
metabolites (20—640)

 

 

Dataset size Mixed QN VSN

m = 20 0.769 (0.04) 0.662 (0.05) NA

m = 40 0.795 (0.03) 0.737 (0.03) NA

m: 80 0.793 (0.02) 0.761 (0.03) 0.788 (0.02)
m: 160 0.795 (0.02) 0.781 (0.01) 0.792 (0.02)
m: 320 0.796 (0.01) 0.790 (0.01) 0.795 (0.01)
m: 640 0.797 (0.01) 0.793 (0.01) 0.797 (0.01)

 

Note: The columns represent the different methods used; mixed model, quantile
normalization (QN) and variance stabilizing normalization (VSN). The average
AUC value of 50 repeats of each scenario is given, with the standard deviation in
parenthesis. A graphical representation of the results is provided in Appendix E
(Supplementary Fig. S6).

5 DISCUSSION

The purpose of this article is two-fold; ﬁrst we propose a global
normalization method intended for use with smaller metabolo-
mics datasets, and second, we investigate how well correlations
can be discovered when we have the option of using NMR data
calibrated using a standard, or not.

When comparing raw and standardized metabolite levels
(peak areas/concentration) for the real HDF dataset, we
observed large positive correlations in the non-normalized
data. Such large correlations are not biologically reasonable, as
we expect both negative and positive correlations to be present,
and we argue that they are caused by batch effects and the cali-
bration standard (Fig. l). The positive correlations were more
pronounced for the standardized data, which is a cause for con-
cern. However, after normalization, both the raw and standar-
dized data exhibited better correspondence, and large differences
in estimated correlations could not be found. Most likely, the
inﬂuence of the calibration standard is (at least partly) removed
by the inclusion of a random sample effect in our normalization
model.

Our simulation study on the discovery of true metabolite-
metabolite correlations included cohort, batch and sample effects
in the simulated data, as well as a simulated calibration com-
pound. Although true NMR data are more complex, and the
calibration standard affects the data in a more intricate way
than by simple scaling, we think the study gives some pointers
concerning performance of different normalization methods, and
how the power is affected when we use either raw or standardized
data. In summary, our simulations show that using raw data
compared with standardized data has a slight edge when it
comes to performance (measured as average AUC). However,
the loss in power using standardized data compared with raw
data is small and the added advantages of better metabolite
quantitation and chemical shift calibration render standardized
data a feasible choice when estimating correlations.

In our correlation-robustness study (based on real data), we
investigate how stable the correlations are when removing one or
several metabolites from the set, and re—normalizing without the
removed metabolites. The study shows that methods developed
for high-dimensional datasets, like the loess smoother, perform
poorly for smaller datasets, if at all applicable. The commonly

 

2160

112 /810's112umo [p.IOJXO'SOIlBIHJOJUIOIQ/ﬁdllq 111011 pep1201umoq

910Z ‘091sn8nv uo ::

Normalization of metabolomics data

 

used median normalization is also problematic when removing
certain sets of metabolites, and the same trend can be seen for the
sum scaling method. The mixed model we propose is a robust
choice.

In this article, we focus on low-dimensional metabolomics
datasets for two main reasons. First, the normalization methods
adopted from the microarray community (e. g. quantile normal-
ization) are usually not applicable to these sets, and as current
methods for metabolomics data have restrictions (either demand-
ing presence of multiple standards or intended for differential
analysis), customized methods are needed. Second, in MMCA,
the focus is usually to unravel metabolite—metabolite correlations
for a smaller set of metabolites, and targeted datasets are mainly
used for this. When evaluating our mixed model for larger data-
sets (varying size between 20—640 features), contrasting it with
quantile and variance stabilizing normalization (VSN), we con-
clude that a model-based approach is to prefer for datasets with
less than ~100 features. For larger sets, the variance stabilizing
approach performs equally well as a mixed model and better
than quantile normalization. As mixed models are hard to
adapt for large-scale sets, VSN is a good alternative.

The real data we use in this article have a complex structure
with cohorts, batches and samples. The normalization method
based on the mixed model can also be applied to simpler designs,
e.g. when the nesting consists of samples within batches, making
it applicable to many scenarios.

The estimation of the ﬁxed and random effects in the mixed
model is coupled to an iterative procedure to estimate the cor-
relation matrix of the metabolites simultaneously. However, it is
also possible to apply the method for just one iteration, and
ignore the estimation of the correlation matrix in the ﬁrst step,
as we do in one of the simulation studies. This is a feasible option
when the purpose is only to normalize the data, in e.g. a p > n
(more metabolites than samples) setting.

6 CONCLUSION

We present a mixed model approach to normalization of low-
dimensional metabolomics datasets. We show that this method
performs well compared with competing methods with respect to
robustness and discovery of true correlations. We also use real
and simulated data to infer how standardization with a calibra-
tion compound affects the estimation of correlations. Although
the performance for non-standardized data is slightly better than
for standardized data, the beneﬁts of chemical shift calibration in
identifying metabolites as well as in quantitation of metabolite
concentrations motivate the use of a calibration standard in
NMR experiments.

ACKNOWLEDGEMENTS

The authors wish to thank Olle Nerman and Terry Speed for
helpful comments on the material in this article. Two anonymous

reviewers also provided valuable input, which greatly improved
the article.

Funding: Cancer Research UK (in part) [Programme Grant
Cl4303/A10825]; the core facilities of the Cancer Research UK
Cambridge Institute; the Erik and Edith Fernstrém foundation.

Conﬂict of Interest: none declared.

REFERENCES

Boes,T. and Neuhéiuser,M. (2005) Normalization for Affymetrix GeneChips.
Methods Inf Med, 44, 414—417.

Bolstad,B.M. et al. (2003) A comparison of normalization methods for high density
oligonucleotide array data based on variance and bias. Bioinformatics, 19,
185—193.

Chung,Y.L. et al. (2003) Metabolic proﬁling in tumors by in vivo and in vitro NMR
spectroscopy. In: Harrigan,G.G. and Goodacre,R. (eds) Metabolic Proﬁling - Its
Role in Biomarker Discovery and Gene Function Analysis. Chapter 5, Kluwer
Academic Publishers, Dordrecht, the Netherlands, pp. 83—94.

De Livera,A.M. et al. (2012) Normalizing and integrating metabolomics data. Anal.
Chem, 84, 10768—10776.

Fiehn,O. and Weckwerth,W. (2003) Deciphering metabolic networks. Eur.
J. Biochem, 270, 579—588.

Gautier,L. et al. (2004) affy—analysis of Affymetrix Genechip data at the probe level.
Bioinformatics, 20, 307—315.

Huber,W. et al. (2002) Variance stabilization applied to microarray data calibration
and to the quantiﬁcation of differential expression. Bioinformatics, 18 (Suppl. 1),
S96—S104.

Kerr,M.K. and Churchill,G.A. (2001a) Experimental design for gene expression
microarrays. Biostatistics, 2, 183—201.

Kerr,M.K. and Churchill,G.A. (2001b) Statistical design and the analysis of gene
expression microarray data. Genet. Res., 77, 123—128.

Kose,F. et al. (2001) Visualizing plant metabolomic correlation networks using
clique-metabolite matrices. Bioinformatics, 17, 1198—1208.

Kraskov,A. et al. (2004) Estimating mutual information. Phys. Rev. E Stat. Nonlin.
Soft Matter Phys., 69 (Pt 2), 066138.

Lim,W.K. et al. (2007) Comparative analysis of microarray normalization pro-
cedures: effects on reverse engineering gene networks. Bioinformatics, 23,
i282—i288.

Meng,X.L. and Rubin,D.B. (1993) Maximum likelihood estimation via the ECM
algorithm: a general framework. Biometrika, 80, 267—278.

Numata,J. et al. (2008) Measuring correlations in metabolomic networks with
mutual information. Genome Inform, 20, 112—122.

R Core Team. (2012) R: A Language and Environment for Statistical Computing.
R Foundation for Statistical Computing, Vienna, Austria. ISBN 3-900051-07-0.
http://www.R-project.org/.

Redestig,H. et al. (2009) Compensation for systematic cross-contribution improves
normalization of mass spectrometry based metabolomics data. Anal. Chem, 81,
7974—7980.

Ronnegard,L. et al. (2010) hglm: a package for ﬁtting hierarchical generalized linear
models. R J., 2, 20—28.

Schafer,J. and Strimmer,K. (2005) A shrinkage approach to large-scale covariance
matrix estimation and implications for functional genomics. Stat. Appl. Genet.
Mol. Biol., 4, Article32.

Smyth,G.K. (2005) Limma: linear models for microarray data. In: Gentleman,R.
et al. (ed.) Bioinformatics and Computational Biology Solutions using R and
Bioconductor. Springer, New York, pp. 397—420.

Steuer,R. (2006) Review: on the analysis and interpretation of correlations in meta-
bolomic data. Brief Bioinform, 7, 151—158.

Sysi—Aho,M. et al. (2007) Normalization method for metabolomics data using
optimal selection of multiple internal standards. BM C Bioinformatics, 8, 93.

 

2161

112 /810's112umo [progxo'sor1em101urorq//:d11q 111011 pep1201umoq

910Z ‘091sn8nv uo ::

