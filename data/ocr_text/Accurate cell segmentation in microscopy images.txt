ORIGINAL PAPER

Vol. 30 no. 18 2014, pages 2644—2651
doi:10. 1093/bioinformatics/btu302

 

Bioimage informatics

Advance Access publication May 21, 2014

Accurate cell segmentation in microscopy images using

membrane patterns

Sotiris Dimopoulos1’2’*

, Christian E. Mayer1 ’2, Fabian Rudolf” and Joerg Stelling

1,2,*,i

1Department of Biosystems Science and Engineering, ETH Zurich, 4058 Basel, Switzerland, 2Swiss Institute of

Bioinformatics, ETH Zurich, 4058 Basel, Switzerland
Associate Editor: Jonathan Wren

 

ABSTRACT

Motivation: Identifying cells in an image (cell segmentation) is essen-
tial for quantitative single-cell biology via optical microscopy. Although
a plethora of segmentation methods exists, accurate segmentation is
challenging and usually requires problem-specific tailoring of algo-
rithms. In addition, most current segmentation algorithms rely on a
few basic approaches that use the gradient field of the image to
detect cell boundaries. However, many microscopy protocols can
generate images with characteristic intensity profiles at the cell mem-
brane. This has not yet been algorithmically exploited to establish
more general segmentation methods.

Results: We present an automatic cell segmentation method that
decodes the information across the cell membrane and guarantees
optimal detection of the cell boundaries on a per-cell basis. Graph
cuts account for the information of the cell boundaries through direc-
tional cross-correlations, and they automatically incorporate spatial
constraints. The method accurately segments images of various cell
types grown in dense cultures that are acquired with different micros-
copy techniques. In quantitative benchmarks and comparisons with
established methods on synthetic and real images, we demonstrate
significantly improved segmentation performance despite cell-shape
irregularity, cell-to-cell variability and image noise. As a proof of
concept, we monitor the internalization of green fluorescent protein-
tagged plasma membrane transporters in single yeast cells.
Availability and implementation: Matlab code and examples are
available at http://www.csb.ethz.ch/tools/cellSengackage.zip.
Contact: sotiris.dimopoulos@gmail.com or joerg.stelling@bsse.
ethz.ch

Supplementary information: Supplementary data are available at
Bioinformatics online.

Received on November 25, 2013; revised on April 17, 2014; accepted
on April 24, 2014

1 INTRODUCTION

Nowadays, optical microscopy is widely used to quantify single-
cell features, such as cell size or intracellular densities of ﬁuores-
cent markers. Accurate quantiﬁcation of such features critically
depends on the spatial detection of the cells in the image, that is,
on cell segmentation (Li et al., 2013). Although there is a rapid
development of imaging hardware and image analysis software

 

*To whom correspondence should be addressed.
TThe authors wish it to be known that, in their opinion, the last two
authors should be regarded as Joint Last Authors.

platforms (Eliceiri et al., 2012), the development of cell segmen-
tation algorithms is lagging behind. For good segmentation re-
sults, current approaches are typically applicable to narrowly
deﬁned image acquisition protocols (Gordon et al., 2007) or
cell types ON'ahlby et al., 2012). As summarized succintly by E.
von Meijering: ‘Rather than converging to a robust, uniﬁed
solution, it thus seems that the ﬁeld is diverging, and by now
almost as many cell segmentation methods have been developed
as there exist cell analysis problems. . .’ (Meijering, 2012).

Cell segmentation is challenging (Peng, 2008) for many rea-
sons. First, segmenting cellular images requires the identiﬁcation
of multiple objects in the image. The objects have heterogeneous
shapes that are typically subject to dynamic changes; mathemat-
ical shape models are therefore nearly impossible to deﬁne.
Second, cell compartmentalization as well as intra- and inter-
cell variability induces non-homogeneous marker distributions
within and across cells, leading to undesirable image features
such as intensity gradients. Third, growing cell populations usu-
ally result in dense cell regions; this makes it hard to assign image
features to the correct cell, especially among sets of spatially close
cells. Finally, different experimental conﬁgurations such as cell
types or imaging protocols generate images with greatly varying
morphological or intensity characteristics.

Most current methods use a few basic algorithms for cell
segmentation: intensity thresholding, ﬁltering, morphological op-
erations, region accumulation or deformable models (Meijering,
2012). In particular, region accumulation approaches such as
Voronoi—based methods (Jones et al., 2005) or the watershed
transform (Meyer, 1994) can result in inaccurate cell boundaries
by misspeciﬁcations of the cell region to be divided or by
oversegmentation (Fig. 1A and B). Similarly, popular deform-
able model approaches such as geodesic active contours (Caselles
et al., 1997), which detect cell boundaries by minimizing a pre-
deﬁned energy functional, can result in poor boundary detection
because they use local optimization algorithms that only guar-
antee to ﬁnd a local minimum or use the gradient vector ﬁeld of
the image to decode the boundary information (Fig. 1C).
However, optical microscopy can generate distinctive intensity
information across the cell membrane, which, so far, has been
algorithmically used to only a small extent. For example, cell
segmentation via ring ﬁlters (Eom et al., 2010) accounts crudely
for the intensity proﬁle across the cell membrane and imposes
strict cell-shape requirements. Furthermore, certain combinator-
ial optimization algorithms can guarantee to ﬁnd the global op-
timum of a deﬁned energy functional, such as the combinatorial
graph-cut algorithms. To segment microscopy images, previous

 

2644 © The Author 2014. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com

112 /310's113umo [p.IOJXO'SOleIIHOJUTOTQ/ﬁdllq uIOJj prBOIIIAAOG

9IOZ ‘09 lsnﬁnv uo ::

Cell segmentation

 

 

Fig. 1. Limitations of existing segmentation approaches. Initial cell
images (top), identiﬁed boundaries (middle; red) and ﬁnal segmentations
(bottom). (A) Fluorescence image of S.cerevisiae cells. Boundaries were
automatically detected by automatic Otsu’s thresholding (Otsu, 1975)
followed by a Voronoi-based algorithm (Jones et al., 2005). Regions
inside the blue rectangles were used as seeds. (B) Phase-contrast of
S.p0mbe cells. Boundaries were automatically detected by the watershed
algorithm (Meyer, 1994), applied to a smoothed gradient vector ﬁeld of
the initial image. Regions inside the blue rectangles were used as minima
during the ﬂooding operation. (C) Bright-ﬁeld image of alflA S.cerevisiae
cells. Boundaries were automatically detected by active contour-based
segmentation [active contour evolution with level sets (Whitaker, 1998);
geodesic active contour as the energy model (Caselles et al., 1997)]. Blue
rectangles represent the initial state of the active contour

applications of graph cuts in conjunction with the gradient vector
ﬁeld of the image (Xu et al., 2007; Leské et al., 2010) were limited
to identify the image background (Al-Kofahi et al., 2010) or to
separate cell nuclei (Danék et al., 2009). Graph cuts with auto-
matic spatial constraints applied to the cellular segmentation of
RNA interference (RNAi) screening images need an additional
image (Chen et al., 2008). Other graph-cut—based object detection
approaches that do not use the gradient vector ﬁeld of the image
typically only work well when the intensity distributions of the
cellular regions and the background are rather dissimilar (Zeng
et al., 2006).

Here, we present a method for cell segmentation that uses a
single image, allows for image acquisition with different experi-
mental techniques and copes with various cell shapes and densely
populated areas. The method is based on the detection of
membrane patterns, and we therefore term it membrane pat-
tern-based cell segmentation (MPCS). The membrane pattern
information is cast into a spatially constrained graph-cut frame-
work, which allows us to address the typical challenges in the
segmentation of microscopy images discussed above. We dem-
onstrate the applicability and performance of MPCS for diverse
synthetic and real biological examples, with signiﬁcantly

improved performance compared with established segmentation
methods. Because accurate boundary detection is especially
important in quantitative signaling studies, we quantify the
internalization of plasma membrane transporters in yeast as a
proof of concept.

2 METHODS

Detection of cell boundaries

Overview. MPCS works with microscopy images of cells with a mem-
brane pattern, that is, a characteristic intensity proﬁle across their mem-
brane. Based on the input image, we ﬁrst specify few biologically intuitive
parameters. Then, we detect potential points inside the cells (called seeds).
Each seed is processed individually, and an optimal connected boundary
for each cell is detected by combining directional cross-correlation oper-
ations with graph cuts. Cross-correlation is a signal processing technique
that measures similarities between two signals and is used here to decode
the membrane pattern information. This pattern information is cast to a
graph, and together with automatically deﬁned spatial constraints, we use
graph cuts to optimally separate each cell from the background. All in-
dividual segmentation results are processed to obtain the ﬁnal segmenta-
tion of the image.

Input. The biologically intuitive parameters of MPCS can be set inter-
actively through the graphical user interface of CellX (Mayer et al., 2013),
set manually, or automatically derived via supervised machine learning
approaches from a small training set of segmented cells. For the example
image of budding yeast cells with aberrant morphology (Fig. 2A), we ﬁrst
estimate the maximal radii of circles in the smallest and largest cells in the
image (rmm, rmax values; blue). Then, we determine the length of the major
axis of the largest cell (lm value; green line). We estimate the cells’ mem-
brane pattern (vector of intensity values M, shown in the red plot) by
averaging the intensities of a set of example membrane proﬁle rays
(drawn from the inside of the cell to the outside, as shown by the
red arrows). We also deﬁne the position of the cell’s boundary on the
membrane pattern (index m0 : M(m0) e M; shown with the white ﬁlled
circle).

Seeding. In this step, we identify potential points inside the cells (seeds).
In most cases, a combination of traditional image processing operations
can easily provide us with seeds (see Supplementary Note; Supplementary
Fig. S1). Here, we exemplify the process by use of a gradient-based
Hough algorithm (Ballard, 1981) on the input image composed of a set
of pixels L= WX H, W={1,...,w}, H={1,...,h}, where w and h are
the image’s width and height (measured in number of pixels), respectively.
We compute the gradient vector ﬁeld of the image (blue arrows in
Fig. 2B) and perform a counting operation for image pixels along each
gradient vector. Every time a pixel lies in the direction of a gradient vector
(at a distance between rm,” and rmax), we collect a value proportional to
the gradient’s magnitude. The counts for all image pixels are stored in the
so-called accumulation array (color-coded region in Fig. 2B). Typically,
lines in the direction of the gradients originating from convex features
of the input image intersect the same pixels, thereby generating local
maxima in the accumulation array. We detect the image regions with
local maxima and use their centers as seeds (green crosses in Fig. 2B;
see Supplementary Note and Supplementary Fig. S2). For every seed
located at pixel s=(xs, 32,), where x, e W and y, e H, we also compute
the radial distance re 6 [rm-n, rmax] that maximizes the gradient informa-
tion along the perimeter of the circle with center S and radius rc.

Construction of cross-correlation images. Next, we process each seed in-
dividually and center it in a square window of the image [image crop I
with width 21m + 1; new seed location at 5: (lm, lm)]. We ﬁrst use

 

2645

112 /810's112um0 [pJOJXO'SOIIBIIIJOJUIOIQ/ﬂC1111] uIOJj prBOIIIAAOG

9IOZ ‘091sn3nv uo ::

S.Dimopoulos et al.

 

 

B

lFmin rmax #1:" 1
min/max
radius __‘. -  _- 'l '13

7px 18px }.x_-;a;,3-.;'.'x.'-I'¢It-
maxce“ |__ :_.:Iiiﬂ,~'.'5; xiii-j}; .r 11.5
length m— 65px 13 ‘ "if 1;“; :1.” I“

I

 
 
 
 

 

membr.
intensity
profile

 

 

 

 

Fig. 2. Fundamental steps of MPCS and segmentation results. (A) Initial
bright-ﬁeld image (left) and parameters (right). (B) Gradient-based
Hough algorithm. Based on the gradient vector ﬁeld of the image (blue
arrows; see inset), we acquire an accumulation array (color coded), and
its maxima (red) serve as seed locations (green crosses). (C) Cross-corre-
lation images for the six seeds shown in the initial image (panel A; white
numbers). The magnitude of the cross-correlation values is color coded.
(D) Spatial graph-cut constraints. The orange and green regions are
assigned a priori to the cell and to the background, respectively. The
white contour represents a feasible cut. The ﬁnal optimally segmented
regions are shown in red (cell) and blue (background) of MPCS.
Segmentation results. (E) For the initial image. (F) For the rest of the
images shown in Figure 1

Bresenham’s algorithm (Bresenham, 1965) to ﬁnd which image pixels lie
in every line segment that starts at the seed and ends in each of the border
pixels of I. We then compute the intensity proﬁles along these directed
line segments (rays) and use cross-correlation (Orfanidis, 1996) to quan-
tify their similarity with the reference membrane pattern, M. Cross-cor-
relation values are high in regions consistent with the membrane pattern
and low in regions that do not follow the pattern. The cross-correlation
values along all rays allow us to construct a cross-correlation image
(Fig. 2C; see Supplementary Note) that is used for the formulation of
the cell boundary-tracing problem on a graph. We further refer to CC(p)
as the cross-correlation result assigned to pixel p = (xp, yp) in the pixel set
P=X>< X, X={1, ...,2lm+1} ofI.

Graph cuts and energy minimization. For every image crop I, we use graph
cuts to separate the image region comprising the cell from the region

outside the cell (background and neighboring cells). This amounts to
assigning a binary (cell or background) label Ap to each pixel p e P.
We combine these assignments in a vector A of dimension 1 x |P|
(where |P| % 104 for microscopy images of cells with lm=50 pixels).
We ﬁrst deﬁne a directed weighted graph G=(V, E, w) with vertex set
V = P. We deﬁne the neighborhood of radius r of a pixel p e P by the
function N(p, r) = {q 6 Pl ||p — q||2 5 r} to specify the edge set as

Z 7561
E UPEP UZeMpMz‘)

tal and diagonal neighbors in I. The edges carry a weight according to the
edge weight function w: E —> IR, which leads to the deﬁnition of an
energy function

(p, q). This connects each pixel to its vertical, horizon-

EN(A): Z w(<p.q»-id(Ap 4A.),

(IMAGE

where w(p, q) measures the cost of assigning two neighboring pixels to
different partitions (boundary information), and the function id(-) is 1 if
the condition inside the parenthesis is true, and 0 otherwise. We ﬁnd the
optimal vector A that minimizes EN(A) by ﬁnding the min-cut on the
previously deﬁned image graph. The min-cut/max-ﬂow algorithm
(Boykov and Kolmogorov, 2004) yields the optimal solution in polyno-
mial time. According to (Boykov and Kolmogorov, 2003), if we deﬁne
the weights of the edges as

32 - |e,,,,|2 -A¢ - det(D(p))
2 . [6gq - D(p) - emf/2

then the min-cut corresponds to the globally optimal geodesic for the
processed cell. 6 denotes the side length of the square pixels (equals to
1 in our case); 617,], the vector connecting the graph vertices p and q; Ad),
the angular orientation difference of the grids characteristic vectors
(equals to 71/4 for our 8-neighborhood system); det(-), the determinant
operation; and D(p) is the metric tensor in pixel p deﬁned as

0(1)) =g(p) - "+(1 — g(p)) - MOD) - u(p)T,

where H is the identity matrix, u(p) is a unit vector in the direction of image
gradient at pixel p and g(p) is the scalar function that maps the magnitude
of the boundary information on the weights of the graph. As in (Boykov
and Kolmogorov, 2003), we use the exponential function and include the

 

3

W((p, 61)) =

cross-correlation values as g(p) = exp(—10CC('”)).

Spatial constraints. To avoid trivial solutions and constrain the number of
meaningful cell boundaries, we pose automatic spatial constraints to
our graph cut deﬁnition by transforming the problem to a multisource/
multisink max-ﬂow problem (Fig. 2D). Speciﬁcally, we deﬁne a circular
region around the seed S of radius rc / 2, C = N(s, rc / 2) C P, that has to be
part of the cell (orange region) as well as the pixel set in the cropped
image border B: {p e P ||N(p, J2)| < 8} C P (green region) as back-
ground. By using inﬁnite edge weights to connect the pixels in C and B
to dedicated source and sink vertices, respectively, we constrain graph
cuts to the region between C and B (e.g. white contour). The assignment
of A with minimal energy EN(A) given by the min-cut results in an op-
timal binary segmentation of the cropped image (blue and red regions).

Final segmentation. The single-seed segmentation results are further pro-
cessed to obtain the ﬁnal segmentation of the image. First, we eliminate
single-seed segmentations that represent statistical outliers with respect to
their morphology and cross-correlation values across the predicted mem-
brane pixels. Then, we merge those seeds that claim almost identical re-
gions in the image. Finally, we resolve small overlaps of cell
segmentations by assigning the pixels to the closest competing cell.
These steps (for more details, see Supplementary Note) ensure that ﬁnally
every image pixel is uniquely assigned to either the background or to one
of the cells. The segmentation result for the input image can be seen in

 

2646

112 /810's112um0 [plOJXO'SOIJBIIIJQHIIOIQ/ﬂdllq uIOJj pop1201umoq

9IOZ ‘091sn3nv uo ::

Cell segmentation

 

Figure 2E (and for the other examples of Fig. 1 in Fig. 2F). Additional
full image segmentations are shown in Supplementary Figures S3—S10.

3 RESULTS
ALGORITHMIC FEATURES

Diverse types of microscopy images. To evaluate the applicability
of our method to different image acquisition techniques, we con-
sidered different transmission light and ﬂuorescence microscopy
methods. Saccharomyces cerevisiae and Saccharomyces pombe
cells were imaged using out-of-focus bright-ﬁeld and phase-
contrast imaging, respectively, whereas ﬂuorescence microscopy
of endogenously tagged Mupl-GFP (green ﬂuorescent protein)
S.cerevisiae cells was used to generate a nearly uniform intensity
pattern around the cell (Fig. 3A left). An important feature of
MPCS is that, despite differences in the characteristic membrane
patterns of the imaging methods, similar correlation images are
generated (Fig. 3A middle). As a result, the cell boundaries can
be accurately inferred (Fig. 3A right) for such image acquisition
techniques.

Flexible boundary deﬁnition. Many segmentation algorithms as-
sociate the high intensity gradient information of the image with
the cells’ boundaries. This is reasonable, for instance, when the
background intensity distribution is different from the cells’ in-
tensity distribution. However, depending on the image acquisi-
tion protocol, high intensity gradients could be present inside
a cell (e.g. out-of-focus bright-ﬁeld image in Fig. 1C).
Furthermore, the intensity distribution of the background may
be different in regions around the cells (locally) than in the rest of
the image (e.g. local ﬂuorescence effects in Fig. 1A). In such
cases, it is difﬁcult to accurately detect the cells’ boundaries
based on the gradient information or on the identiﬁcation of
the image background. MPCS circumvents these problems by
assigning the highest cross-correlation values to the pixels of
the cell membrane corresponding to the position m, (white dot
in Fig. 3B) of the membrane pattern M (red line). Thereby, we
can conveniently deﬁne the cell boundaries independent of
the local gradient information across the membrane proﬁle
(Fig. 3B).

Dense cultures. Our method leads to a successful segmentation in
crowded image regions, as illustrated for dense S.p0mbe culture
images acquired in bright ﬁeld (Fig. 3C left) because of the dir-
ectionality in the cross-correlation step. As every intensity ray
traverses from a seed to the border, we analyze an intensity seg-
ment that includes the cell’s membrane pattern followed by the
adjacent cell’s mirrored version of the pattern. Along this seg-
ment, the cross-correlation is high at the cell’s membrane region
(red area in Fig. 3C; middle) and low immediately afterwards
(blue area in Fig. 3C); the same effect appears for all basic forms
of membrane patterns (Supplementary Fig. Sll). This suppres-
sion of the neighboring cell’s information restricts the graph cut
to optimally isolate the currently processed cell from the rest of
the image; graph cuts in low-valued cross-correlation regions
have an increased cost. As a result, MPCS successfully segments
crowded cell regions (Fig. 3C right; see Supplementary Fig. S6
for the full image segmentation).

 

a] If»
E If“

‘3 T '  -:’r’$~l~{ _;= ' ..
kjfi‘. $31.1: if 13: k‘ﬁ“!

 

 

 

 

 

 

 

 

  

 

 

 

 

 

Fig. 3. Exploitation of membrane patterns, dense cultures, non-convex
shapes and cell types. (A) Left: membrane patterns generated with bright
ﬁeld (top), bright ﬁeld (middle) and ﬂuorescence microscopy (bottom).
The inset shows the cell’s membrane pattern across the red line segment;
automatically detected seeds are denoted with ‘S1’ and ‘S2’. Middle:
cross-correlation images for the detected seeds. Right: segmentation
results. (B) Detected cell boundary depending on the relative position
of the outer membrane (white dot) on the membrane pattern (red line).
(C) Crowded region of S.p0mbe culture recorded in bright ﬁeld. Seeds of
two neighboring cells (left: red and orange frames; seeds denoted by ‘S’)
generate different cross-correlation landscapes (middle). The ﬁnal bound-
ary detection is shown on the right image. (D) Synthetic image of a non-
convex shape with seeds. (E—F) Cross-correlation image (left) and graph-
cut result (right) for (E), seed ‘S1’, and (F), seed ‘S2’. (G) Identiﬁcation of
low cross-correlation region (black line) after analysis of ‘S2’. Extra seed
placement (‘eS2’; black dot). (H) Updated cross-correlation image for
seed ‘S2’ and graph-cut result. (I) Final segmentation result. (J—K)
Initial bright-ﬁeld image (left) and ﬁnal segmentation result (right) for
(J), Escherichia coli cells, and (K), mouse embryonic stem cells (mESCs).
Blue boxes indicate incorrectly identiﬁed parts of a cell’s boundary

Non-convex shapes and cell types. Cells may have non-convex and
diverse shapes, which makes segmentation difﬁcult. MPCS deals
with non-convex shapes in two different ways. First, if the seed is
placed inside the non-convex object such that all rays cross the
membrane region in the correct direction (seed ‘S1’ in Fig. 3D),
the cross-correlation image captures the membrane information
accurately, leading to accurate segmentation (Fig. 3E). However,

 

2647

112 /310's112umo [p.IOJXO'SOIlBIIIJOJUIOIQ/ﬁdllq uIOJj pop1201umoq

9IOZ ‘091sn3nv uo ::

S.Dimopoulos et al.

 

if the seed is not placed in such a region (seed ‘S2’ in Fig. 3D), the
rays may cross a part of the membrane region in the wrong
direction, leading to partially inaccurate boundary detection
(Fig. 3F). Therefore, we place extra seeds at low-valued pixels
of each initial membrane result (Fig. 3G), and we update the
cross-correlation image (Fig. 3H) to also segment non-convex
shapes (Fig. 31). As a result, our segmentation method provides
a tool for the analysis of images of different cell types (Fig. 3J
and K; see Supplementary Figs S8—S10 for full image segmenta-
tions). Note, however, that MPCS may fail to capture highly
irregular parts of the cell boundary (Fig. 3K), as the use of the
geodesic model leads typically to smooth segmentations.

SEGMENTATION PERFORMANCE ON SYNTHETIC
IMAGES

We next aimed at a quantitative characterization of the segmen-
tation algorithm’s performance. For this purpose, we generated
realistic synthetic microscopy images that represent different
cell phenotypes as well as ﬂuorescence, bright-ﬁeld and phase-
contrast imaging (Fig. 4; see Supplementary Note for details).
We deﬁned two measures for the cell detection quality (sensitiv-
ity, that is, the proportion of true-positive ﬁndings, and positive
predictive value, the proportion of detected cells that are true),
one measure for the spatial accuracy of the segmentation (pixel
accuracy of the cell area) and one measure to quantify the error
in the detected cell contour (see Supplementary Note for details).

Cell-shape irregularity. To evaluate the inﬂuence of cell shapes
on the segmentation performance, we generated synthetic
microscopy images with increasing cell-shape irregularities
(Fig. 4A). The shape irregularity coefﬁcient is a multiplier of a
random term that displaces the pixels of an initial ellipse. For
regular shapes, the mean segmentation sensitivity is close to l
and the contour error below half a pixel; sensitivity only drops
below 0.9 at an irregularity value of 0.5 (Fig. 4A). Hence, the
algorithm captures accurately a large fraction of the cells even for
non-convex cell shapes. Importantly, the positive predictive value
and the pixel accuracy are barely affected by the shape: their
respective mean values are always >0.9 (Fig. 4A).

Cell-to-cell variability. Because of uneven illumination
of bright-ﬁeld images or through stochastic noise in ﬂuorescent
protein expression, intensities within the cell population can
vary, which poses additional challenges for segmentation (see
Supplementary Fig. S4 for S.cerevisiae with ﬂuorescence stain-
ing). To examine the segmentation performance under such con-
ditions, we generated images with variable cell intensity values
(see Supplementary Note for details). Figure 4B shows that
MPCS performance is largely unaffected by this variability,
indicating high-quality segmentation for all levels of intercell
variability investigated.

METHODS COMPARISON

To compare our algorithm with popular methods for cell segmen-
tation, we quantiﬁed segmentation performance with respect to
the error in the cell contour (for deﬁnition, see Supplementary
Note) and morphological cell features such as cell area and
eccentricity. Accurate membrane identiﬁcation is particularly

 

 

Shape Irregularity L

     
 

   

 

8 . 3 EL!
E E
E I: M .__.__._._-——-
{L'I ED
D. D. I12
5 . . . ﬂ . . . . '
D I}.I {L} [ll—J EH I15 M {I ELI Ill 1].} [H- ill-5- {LE
Shape Irregularity Caeﬁ. 1|.i'ariatittn
1 _
E M.-
3 .
E
E.“-
:E .
E a...
g I12-
I} .
900 'I'HIH} 13m- 'IB-EEI
call araa ualuaa
.- -.' - .-
I 'l I I
$5; - g I  ,
53’5—— —'— " I —
E — __  ._
f— — - —
I11jig—l — _ —
ch- — — _ —
El 2 4 I} I! III I11 III-I- I}.B {LII I} [Li I“. III} {LB III |}.2 III-I- I}.E Ill!
WHIEUF Ermr [path Del” area. error EGGH'III'Ic-Hjl arrnr nlaaai'fncatiun arrur

Fig. 4. Segmentation performance of MPCS on synthetic images and
algorithmic comparison. Images were generated with varying levels of
cell-shape irregularity (A) and of cell-to-cell intensity variability (B).
Numbers in the images specify the corresponding coefﬁcient values:
shape irregularity coefﬁcient (A) and variation for independently drawn
random assignments of intensities for each cell (B). Statistics were
obtained for 12 randomly generated synthetic images [(A): ﬂuorescence,
bright ﬁeld and phase contrast; (B): ﬂuorescence only] of 150 cells.
Graphs show median and quartiles for the segmentation sensitivity
(blue), the positive predictive value (green), the pixel accuracy of the
cell area (red) and the contour error (black, in pixels). (C) Example of
a synthetic image with three cell subpopulations (identiﬁed by colored
dots in the cells’ centroids) with low (green), medium (red) and high (blue)
eccentricity and area. (D) Crops of synthetic ﬂuorescence (top), bright-
ﬁeld (middle) and phase-contrast (bottom) noisy images used for com-
parison. Noise levels (numbers) are measured in decibel (see
Supplementary Note). (E) Cell classiﬁcation by quadratic discriminant
analysis based on ‘true’ cell areas and eccentricities. (F —I-D Comparison of
algorithms: ‘MPCS’ (our algorithm), ‘watershed’ (the watershed algo-
rithm), ‘Chan—Vese’ and ‘geodesic active contour’ (active contour evolu-
tion with level sets; Chan—Vese and geodesic active contours as the energy
model, respectively). Mean error values for cell contour (F), cell area and
cell eccentricity (G) and cell type classiﬁcation (H) for the ﬂuorescence
(blue), bright-ﬁeld (green) and phase-contrast (red) image sets

crucial for cell-signaling studies, for example, when densities of
ﬂuorescent markers on the cell membrane need to be quantiﬁed
(Irani et al., 2012). Accurate morphological cell features aid sub-
stantially in the analysis of cellular phenotypes, for example,
to automatically classify subpopulations of cells (Zhong et al.,
2012).

For controlled performance comparison, we used different
types of synthetic images with various levels of imaging noise

 

2648

112 /310's112umo [p.IOJXO'SOIlBIIIJOJUIOIQ/ﬁdllq uIOJj pop1201umoq

9IOZ ‘091sn3nv uo ::

Cell segmentation

 

(Fig. 4C and D; see Supplementary Note). Cells were generated
such that three distinct subpopulations exist with respect to their
area and eccentricity, as veriﬁed by quadratic discriminant ana-
lysis on these cellular features (Fig. 4C—E). We compared
our method with the watershed algorithm (Meyer, 1994) and
with two algorithms that evolve active contours (implemented
with levels sets) by use of the Chan—Vese (Chan and Vese,
2001) and of the geodesic active contour (Caselles et al., 1997)
energy model, respectively (for implementation details, see
Supplementary Note). This selection represents the algorithmic
basis of numerous cell segmentation approaches.

With respect to accurate detection of the cell contour, the
mean error of MPCS never exceeds one pixel, but the other al-
gorithms yield large errors because of the high intensity gradients
inside the cell and the undesired gradients from imaging noise
(Fig. 4F). Similarly, for the extracted morphological cell features,
MPCS’s mean errors are always <0.l, whereas competing algo-
rithms show substantially larger error ranges (Fig. 4G). Finally,
we quantiﬁed the effect of the morphological errors in a classi-
ﬁcation problem. We built a classiﬁer based on the morpho-
logical features of the ground truth cell images and assessed
the effect of segmentation errors on the classiﬁcation accuracy.
Segmentation errors of our algorithm lead to low misclassiﬁca—
tion rates in contrast to wrong assignments of 15—75% of the
cells for the other algorithms (Fig. 4H; see also the distributions
in Supplementary Fig. S12).

QUANTITATIVE ANALYSIS OF BUDDING YEAST
ENDOCYTOSIS

To test the accuracy and usefulness of MPCS in a real-world
proof-of—principle application, we focused on the internalization
of plasma membrane transporters. Speciﬁcally, we used the bud-
ding yeast methionine transporter Mupl tagged with GFP to
monitor the clearance of the protein from the plasma membrane
(Fig. 5A, Supplementary Movie). Mupl is internalized upon the
addition of methionine to the media, and it serves as a model in
studying ubiquitin—dependent endocytosis (Lin et al., 2008).
A time-resolved single-cell quantiﬁcation of this process clearly
requires faithful detection of the cell boundaries and accurate
quantiﬁcation of ﬂuorescence quantities.

As expected, shortly after the onset of the internalization pro-
cess, ﬂuorescence transferred from the cell membrane to the cyto-
plasm. For such dynamic phenomena, accurate boundary
detection of the cells based on the ﬂuorescence image is nearly
impossible because at the end of the experiment, ﬂuorescence
levels in the membrane are close to zero and because low-
expressing cells are hard to detect in all frames. We performed
the segmentation on the bright-ﬁeld images and used the ﬂuor-
escence images to properly deﬁne the relative position of the cell
boundary on the membrane pattern (Fig. 5B). This allowed us to
precisely detect the cell boundaries throughout the experiment
and hence to accurately capture the GFP information in the
membrane and in other cellular compartments (Fig. 5C; see
Supplementary Note). Despite using only one of the available
ﬂuorescence channels, the quantiﬁcation process resulted in a
wealth of information on the single-cell dynamics of the Mupl
transporter (see Fig. 5D for all cells that were tracked over the

  

HUIT‘I‘IBIE at! G FP’

“a I.

.h‘: _ .1 m a:
Time |I"I mm

Fig. 5. Quantitative dynamic analysis of yeast endocytosis. (A) Yeast cells
expressing Mupl-GFP imaged before and after addition of methionine.
The bright-ﬁeld out-of—focus and ﬂuorescence images are overlaid, and
the time after addition is indicated. (B) Image crop of a bright-ﬁeld image
with its segmentation result (left). The blue frame includes an example cell
for which the ﬂuorescence image is shown (right). (C) Detected intensity
spots (left) and membrane area (right). (D) Time courses of total ﬂuor-
escence (normalized by the cell area and the mean ﬂuorescence of the cells
at t = 0 min) in the cell (black), the cytoplasm (blue), the membrane (red)
and spots (green, scaling factor 50). Dots denote the population average,
and error bars show the standard error

entire time course; quantities were normalized by each cell’s area
and mean initial intensity). Such single-cell quantitative data will
allow for future detailed studies of endocytosis beyond existing
studies that used bulk measurements of speciﬁc regulators
involved in vesicle maturation (Zeigerer et al., 2012) or extracted
only endosomal intensity properties via confocal microscopy
(Collinet et al., 2010).

4 DISCUSSION

Accurate detection of cell boundaries is a crucial and challenging
step for high-quality single-cell quantiﬁcation, and, to this date,
no general cell segmentation solution exists. Our method allows
us to analyze microscopy images taken by diverse acquisition
techniques and for a variety of cells types. For the real and syn-
thetic images analyzed here, the segmentation quality is largely
independent of cell shape, density, intercell variability and image
noise. Compared with popular algorithms used for the detection
of the cell boundaries, MPCS shows small errors in the spatial
identiﬁcation of the cells’ membranes and their morphological
features. Clearly, limitations of our method exist, mainly when
cells do not have a single uniform membrane pattern, or when
the cell shape is highly irregular.

The intensity pattern across the cell membrane or the cell
length is intuitive and easily accessible features of the cell popu-
lation. Our segmentation method can be easily parametrized by
annotating example cells through the graphical user interface of
CellX [for a detailed user guide, see (Mayer et al., 2013)].
In contrast, boundary detection of cells based on deformable
models, such as active contours, involves non-intuitive adjust-
ments of the parameters that control the energy terms, which
are typically correlated and problem dependent. These

 

2649

112 /310's112umo [p.IOJXO'SOIlBIIIJOJUIOIQ/ﬁ(1111] uIOJj pop1201umoq

9IOZ ‘091sn3nv uo ::

S.Dimopoulos et al.

 

parameters need to be carefully set to avoid erroneous segmen-
tations (Meijering, 2012).

A key feature of our algorithm is to combine cross-correlation
for detecting membrane patterns with graph cuts for tracing the
cell boundary. The cross-correlation operation decodes the cell
membrane information, and the result is robust to intensity
perturbations or image noise (Supplementary Fig. S13).
Furthermore, the directional application of the cross-correlation
aids in accurately detecting the cell membrane in dense regions
by suppressing the intensity information of touching cells. Graph
cuts are a convenient and efﬁcient method to solve the optimiza-
tion problem posed by image segmentation (Boykov and Funka-
Lea, 2006), and here they are used to ﬁnd an accurate boundary
for each cell without needing prior knowledge on the cell shape.
So far, the use of graph cuts for cell segmentation has not
included a formulation with cell membrane pattern information.
Automatic placement of topological constraints has been primar-
ily used for cell tracking purposes (Maska et al., 2013), and it can
improve the segmentation quality only if each cell is initialized
with one seed. An advantage of our segmentation strategy is that
it is largely unaffected by the seeding scheme. Other deformable
model-based segmentation methods that deﬁne the optimization
problem on the space of continuous functions, such as level-set
methods (Sethian, 1999), typically use optimization algorithms
that guarantee to ﬁnd a local minimum of the deﬁned energy
functional (Boykov and Funka-Lea, 2006). As a result, when the
gradient vector ﬁeld of the image is used to detect the cell bound-
ary, good segmentation performance depends substantially on a
reliable initial boundary estimate, which is hard to obtain auto-
matically. MPCS, in contrast, requires easily accessible spatial
constraints, such as the image border and the region around
a seed.

To illustrate typical applications enabled by our method, we
showed for yeast endocytosis how accurate boundary detection
can be successfully performed when GFP intensities are subject
to spatiotemporal dynamics. We used only the bright-ﬁeld
images to detect cell boundaries and used a single ﬂuorescence
channel to acquire a variety of high-quality single-cell ﬂuores-
cence measurements. Such a quantiﬁcation strategy allows for
the monitoring of spatially dynamic quantities in all available
ﬂuorescence channels, and compared with other approaches
(Carpenter et al., 2006; Chen et al., 2008), it does not need add-
itional 4’,6-diamidino-2-phenylindole markers or constitutively
expressed markers for the segmentation process. We envisage
that the accurate identiﬁcation of cells and cell membranes will
enable the extraction of quantitative datasets that will increase
our understanding in many biological applications.

ACKNOWLEDGEMENTS

We thank Frank Neumann for S.pombe images, Moritz Lang for
Escherichia coli images and Simon Hastreiter, Dirk L6fﬂer and
Stavroula Skylaki for mouse embryonic stem cells and hemato-
poietic stem cells images. We also thank Hans-Michael
Kaltenbach, Robert Gniigge and Marianna Rapsomaniki for
comments and discussions.

Funding: The Swiss Initiative for Systems Biology (SystemsX.ch,
project YeastX), evaluated by the Swiss National Science

Foundation, and the EU FP7 project UniCellSys. European
Commission within the seventh Framework Programme (project
UniCellSys, grant agreement no: 201142).

Conﬂict of Interest: none declared.

REFERENCES

Al—Kofahi,Y. et al. (2010) Improved automatic detection and segmentation of cell
nuclei in histopathology images. IEEE Trans. Biomed. Eng, 57, 841—852.

Ballard,D. (1981) Generalizing the Hough transform to detect arbitrary shapes.
Pattern Recognit., 13, 111—122.

Boykov,Y. and Funka-Lea,G. (2006) Graph cuts and efﬁcient ND image segmen-
tation. Int. J. Comput. Vis., 70, 109—131.

Boykov,Y. and Kolmogorov,V. (2003) Computing geodesics and minimal surfaces
via graph cuts. In: Proceedings of the Ninth IEEE International Conference on
Computer Vision, Nice, France. Vol. 1. IEEE, pp. 26—33.

Boykov,Y. and Kolmogorov,V. (2004) An experimental comparison of min-cut/
max-ﬂow algorithms for energy minimization in vision. IEEE Trans. Pattern
Anal. Mach. Intell., 26, 1124—1137.

Bresenham,J.E. (1965) Algorithm for computer control of a digital plotter. IBM
Syst. J., 4, 25—30.

Carpenter,A. et al. (2006) Cellproﬁler: image analysis software for identifying and
quantifying cell phenotypes. Genome Biol., 7, R100.

Caselles,V. et al. (1997) Geodesic active contours. Int. J. Comput. Vis., 22, 61—79.

Chan,T.F. and Vese,L.A. (2001) Active contours without edges. IEEE Trans. Image
Process, 10, 266—277.

Chen,C. et al. (2008) Constraint factor graph cut—based active contour method for
automated cellular image segmentation in RNAi screening. J. M icrosc., 230,
177—191.

Collinet,C. et al. (2010) Systems survey of endocytosis by multiparametric image
analysis. Nature, 464, 243—249.

Danék,O. et al. (2009) Segmentation of touching cell nuclei using a two-stage graph
cut model. In: Proceedings of 16th Scandinavian Conference, S CIA, 2009, Oslo,
Norway. Springer, pp. 410—419.

Eliceiri,K. et al. (2012) Biological imaging software tools. Nat. Methods, 9, 697—710.

Eom,S. et al. (2010) Detection of hematopoietic stem cells in microscopy images
using a bank of ring ﬁlters. In: Proc. IEEE Int. Symp. Biomed. Imaging,
Rotterdam, The Netherlands. IEEE, pp. 137—140.

Gordon,A. et al. (2007) Single-cell quantiﬁcation of molecules and rates using open-
source microscope-based cytometry. Nat. Methods, 4, 175—181.

Irani,N.G. et al. (2012) Fluorescent castasterone reveals bril signaling from the
plasma membrane. Nat. Chem. Biol., 8, 583—589.

J ones,T. et al. (2005) Voronoi-based segmentation of cells on image manifolds. In:
Proceedings of First International Workshop, C VBIA, 2005, Beijing, China.
Springer, pp. 535—543.

Lesk6,M. et al. (2010) Live cell segmentation in ﬂuorescence microscopy via graph
cut. In: 2010 International Conference on Pattern Recognition, Istanbul, Turkey.
IEEE, pp. 1485—1488.

Li,F. et al. (2013) Bioimage informatics for systems pharmacology. PLoS Comput.
Biol, 9, 1—20.

Lin,C. et al. (2008) Arrestin—related ubiquitin-ligase adaptors regulate endocytosis
and protein turnover at the cell surface. Cell, 135, 714—725.

Ma§ka,M. et al. (2013) Segmentation and shape tracking of whole ﬂuorescent cells
based on the chan—vese model. IEEE Trans. Med. Imaging, 32, 995—1006.

Mayer,C. et al. (2013) Using CellX to quantify intracellular events. Curr. Protoc.
Mol. Biol, 14, 1—21.

Meijering,E. (2012) Cell segmentation: 50 years down the road [life sciences]. IEEE
Signal Process. Mag, 29, 140—145.

Meyer,F. (1994) Topographic distance and watershed lines. Signal Process, 38,
1 13—125.

Orfanidis,S. (198 8) Optimum Signal Processing: An Introduction. 2nd edn. McGraw-
Hill Publishing Company, New York.

Otsu,N. (1975) A threshold selection method from gray-level histograms.
Automatica, 11, 23—27.

Peng,H. (2008) Bioimage informatics: a new area of engineering biology.
Bioinformatics, 24, 1827—1836.

Sethian,J. (1999) Level Set Methods and Fast Marching Methods. Cambridge
University Press, Cambridge, UK, p. 3.

 

2650

112 /310's112umo [p.IOJXO'SOIlBIIlJOJUIOIQ/ﬁdllq uIOJj pop1201umoq

9IOZ ‘091sn3nv uo ::

Cell segmentation

 

Wéihlby,C. et al. (2012) An image analysis toolbox for high-throughput C. elegans
assays. Nat. Methods, 9, 714—716.

Whitaker,R.T. (1998) A level-set approach to 3D reconstruction from range data.
Int. J. Comput. Vis., 29, 203—231.

Xu,N. et al. (2007) Object segmentation using graph cuts based active contours.
Comput. Vis. Image Underst., 107, 210—224.

Zeigerer,A. et al. (2012) Rab5 is necessary for the biogenesis of the endolysosomal
system in vivo. Nature, 485, 465—470.

Zeng,X. et al. (2006) Efﬁciently solving the piecewise constant mumford-shah model
using graph cuts. Technical report. Zhejiang University.

Zhong,Q. et al. (2012) Unsupervised modeling of cell morphology dynamics for
time-lapse microscopy. Nat. Methods, 9, 711—713.

 

2651

112 /810's112umo [p.IOJXO'SOIlBIIlJOJUIOIQ/ﬁdllq uIOJj pop1201umoq

9IOZ ‘091sn8nv uo ::

