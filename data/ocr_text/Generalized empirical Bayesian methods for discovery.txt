Bioinformatics, 32(2), 2016, 195—202

doi: 10.1093/bioinformatics/btv569

Advance Access Publication Date: 1 October 2015
Original Paper

 

Gene expression

Generalized empirical Bayesian methods for
discovery of differential data in high-throughput
biology

Thomas J. Hardcastle

Department of Plant Sciences, University of Cambridge, Cambridge CBZ 3EA, UK

Associate Editor: lnanc Birol

Received on March 24, 2015; revised on September 23, 2015; accepted on September 26, 2015

Abstract

Motivation: High—throughput data are now commonplace in biological research. Rapidly changing
technologies and application mean that novel methods for detecting differential behaviour that
account for a ‘large P, small n’ setting are required at an increasing rate. The development of such
methods is, in general, being done on an ad hoc basis, requiring further development cycles and a
lack of standardization between analyses.

Results: We present here a generalized method for identifying differential behaviour within high—
throughput biological data through empirical Bayesian methods. This approach is based on our
baySeq algorithm for identification of differential expression in RNA—seq data based on a negative
binomial distribution, and in paired data based on a beta—binomial distribution. Here we show how
the same empirical Bayesian approach can be applied to any parametric distribution, removing the
need for lengthy development of novel methods for differently distributed data. Comparisons with
existing methods developed to address specific problems in high—throughput biological data show
that these generic methods can achieve equivalent or better performance. A number of enhance—
ments to the basic algorithm are also presented to increase flexibility and reduce computational
costs.

Availability and implementation: The methods are implemented in the R baySeq (v2) package,
available on Bioconductor http://MANW.bioconductor.org/packages/release/bioc/html/baySeq.html.
Contact: tjh48@cam.ac.uk

Supplementary information: Supplementary data are available at Bioinformatics online.

 

1 Introduction

 

High—throughput data are becoming ubiquitous in biological re—
search and numerous statistical techniques have been developed to
analyze these data, often to identify patterns of difference between
sets of biological replicates. Microarray technology led to a prolifer-
ation of methods (Murie et 61]., 2009) designed to analyze data with
many features (i.e. genes) but few biological replicates [the ‘large P,
small 11’ problem (Johnstone and Titterington, 2009)] under an as—
sumption of (log-)normality.

The subsequent emergence of count data from high—throughput
sequencing (HTS) experiments motivated the development of
analysis methods which generally assume some form of

over—dispersed Poisson distribution (Soneson and Delorenzi, 2013).
The majority of these analytic methods seek not merely to adjust for
the high-dimensionality of the data (Benjamini and Hochberg,
1995), but to exploit it through various forms of information
‘borrowing’ across the P dimension. However, many of the methods
developed achieve this borrowing of information by exploiting
specific features of the data. Consequently, while the methods
developed for analysis of negative binomially distributed HTS data
are conceptually similar to those previously developed for analysis
of (log—)normally distributed data, their implementation is very
different.

©The Author 2015. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com 195

91% ‘09 1sn3nv uo sopﬁuv soq ‘BTUJOJTIBD aIo Amie/xtqu 112 /§.IO'S[BU.IHO[p.IOJXO'SOTlBIHJOJUTOTQ/ﬁ(1111] 11101; popeommoq

196

T.J.Hardcastle

 

Novel technologies for high—throughput generation of biological
data may require different distributional assumptions to current meth—
ods. Complete analyses of single—cell sequencing seem likely to require
novel distributional assumptions (Brennecke et 61]., 2013; Islam et 61].,
2011), as do analyses of high—throughput quantitative proteomic and
metabolomic data (Ewald et 61]., 2009; Nilsson et 61]., 2010). In add—
ition, complex experimental designs are producing diverse types of
data from a single organism (Wang et 61]., 2014; Yu et 61]., 2014)
which require the development of methods for multi—dimensional and
integrative analyses. While some of these challenges are beginning to
be addressed, this is being done on an ad [906 basis, requiring further
development cycles and a lack of standardization between analyses.

We present here a generalized method for identifying differential
behaviour applicable to high—throughput data of any type. This
approach is based on our baySeq algorithm, initially developed for
identification of differential expression in RNA—seq data using a nega—
tive binomial distribution (Hardcastle and Kelly, 2010), and later
adapted to paired data using a beta—binomial distribution (Hardcastle
and Kelly, 2013). These algorithms extended the method of paramet—
ric empirical Bayes point estimation (Morris, 1983) by using multiple
point estimators sampled across the ‘large P’ dimension to approxi-
mate a distribution on the hyper—parameters of the data. Here we
show that this empirical Bayesian approach (baySeq v2) is applicable
to any parametric distribution, removing the need for time-consuming
development of novel methods for each new type of data.

This generalization allows differential behaviour to be identified
in any class (or combination of classes) of biomolecular event detect—
able by the application of high—throughput technologies. Here, we
define ‘biomolecular event’ to describe a biomolecular process pro—
ducing a measurable signal with the potential to vary between
experimental conditions. This may involve measurement of levels of
biomolecules; for example, mRNA—seq or high—throughput prote—
omics (Nilsson et 61]., 2010), modifications to biomolecules; for
example, methyl—seq and chIP—seq, or levels of interaction between
biomolecules; for example, ribo—seq (Ingolia et 61]., 2009).

To assess the utility of this approach, we consider analyses on
microarray data, assumed to be log—normally distributed, and simu—
lated zero—inﬂated negative binomial data, distributions novel to the
empirical Bayesian approach here described. We compare the per—
formance of baySeq v2 to specific methods developed for analyses
of such data in identifying differential expression. Comparisons on
over—dispersed Poisson data are largely superﬂuous since baySeq
was originally designed for such data, and extensive independ—
ent comparisons (Cordero et 61]., 2012; Kvam et 61]., 2012; Rapaport
et 61]., 2013) have already been carried out. Nevertheless, to demon—
strate that the performance of baySeq v2 has not been degraded by
the generalization we include a re—analysis of the Rapaport et al.
(2013) data in Supplementary Figure Sl. We additionally demon—
strate the capability of baySeq v2 to perform various novel ana—
lyses on a complex set of RNA—seq data from matched tissue
sampling in four age groups of rat (Yu et 61]., 2014). Code examples
describing these analyses are included in Supplementary S7.

2 Methods

We consider the first dimension of the data to define a specific biomo—
lecular event, and define the data attached to a particular biomolecu—
lar event 6 as DC. Thus, for the simple case of mRNA—seq, the DC
describes the number of sequenced reads for a gene 6 in each biolo—
gical sample. The second dimension of the data gives an indexing of
the samples; thus, DC,- refers to data from the jth sample for the cth

biomolecular event. Further dimensions of the data may be used to
refer to individual components of a biomolecular event; e.g. time—
points or marker classification. In addition to the sequenced (or other
stochastic) high—throughput data, we may also consider observables.
These are known, fixed observations that inﬂuence the generation of
the data. Typical examples of these observables include library scaling
factors (a measure of the depth of sequencing for each sample), coding
sequence length (in mRNA—seq experiments) and cytosine to uracil
non-conversion rates (in bisulphite sequencing data).

As in Hardcastle and Kelly (2010, 2013), we suppose that there
exists some model M whose posterior likelihood, given the observed
data, is to be estimated. The model is defined by the equivalence
classes {E1, ..., Em} such that samples 1' and j are equivalent for biomo—
lecular event 6 if and only if DC,- and DC,- are drawn from distributions
with identical parameters. For notational simplicity, we define the set
DCEq as the data associated with equivalence class Eq. We similarly de—
fine the replicate sets {F1, ...,FR} such that samples 1' and j are in the
same replicate set P, if and only if they are biological replicates, and
define the set Dcpr as the data associated with replicate set F,

As an example of model construction on these lines, consider an
experiment in which three biological conditions A, B and C
exist, each with two biological replicates A1,A2, B1,B2, C1, C2.
The replicate sets then consist of F1 : {A1,A2},
F2 : {B1,B2},F3 : {C1, C2}. The set Dcp1 is the observed data of
the cth biomolecular event in samples A1 and A2. Models may be
defined encompassing no differential expression, differential expres-
sion between all three conditions, and differential expression of one
of the biological conditions relative to the other two; for example,
the model describing biomolecular events in which condition A is
different to both B and C, while B and C behave equivalently, is
defined by equivalence classes E1 : {A1,A2} and
E2 = {131,132, C1, C2}.

The posterior likelihood of a model M for biomolecular event 6
is then acquired by computation of

P(Dc|M)P(M)
mmmn PmJ (D
The major challenge in estimating the posterior likelihood of M is in
estimating lP(DC|M), the likelihood of the data for a particular bio—
molecular event 6 given the model. If Hq is a random variable defin-
ing the parameters of the distribution of the data for the qth
equivalence class DCEq and we assume that the 0,, are independent

with respect to c], then

MDCIM) = HjnDCE, l9q)lP(9qlM)d9q <2)
‘1

We refer to the joint distribution of 0,, as the hyperdistribution of
the data DEq. If @,I is a set of values sampled from the distribution
of 0,], then the integral in Eq. 2 can be numerically approximated
(Evans and Swartz, 1995) to give

Wmm=Hﬁ—Zemmw 6)
q

‘1' 11,166,,

Since we assume that the observed data are independent, given the
17,], this becomes

HD<DCIM>=H® 2 H Faxing) <4)
‘1

71,] 69‘] Dq'EDcEq

and hence the definition of P(DC,-|17), the density function of the data
observed for a single sample is sufficient for the posterior likelihoods

9mg ‘09 1sn3nv uo sojoﬁuv SO’] ‘BTUJOJTIBD aIo Amie/xtqu 112 /B.IO'S[BU.IHO[p.IOJXO'SOTlBIHJOJUTOTQ/ﬁdllq 11101; popeommoq

Generalized empirical Bayesian methods

197

 

of the models to be calculated using this framework, provided the
sets ®q can be constructed.

We further note that posterior distributions on 0,1, given a model
M and the observed data DCEq, can be estimated by weighting each
172 in ®q by 602(6), where

P(D5Eq 

11,166,,

(017(6) :

(5)

2.1 Construction of (9,, by sampling from data

Given a density function f (D; 17), a model M, and a replicate struc—
ture {F1,F2, - - - ,FR}, the sets {@1, ..., @m} are acquired by sampling
from the data. It is often convenient to assume that certain param—
eters of the distribution of the data are (marginally) identically dis-
tributed under all circumstances. In negative binomial modelling of
high—throughput sequencing data, for example, the dispersion is
commonly assumed to be fixed for any given transcript. This strat—
egy reduces the number of parameters to be estimated from the data
and, especially for low numbers of replicates, will tend to increase
the stability of the estimated values. We thus categorize the 17,]; as
either marginally identically distributed over all q and models M, or
not.

We first estimate the marginally identically distributed 17,]; using
the defined replicate sets. Suppose that we sample the data for some
biomolecular event 19. We first consider the likelihood of the data as
the product of the likelihood of the data within each replicate group

P(Di) = HﬂD/aa; n11.  27:1,.) (6)

and choose the 171:, to maximize this likelihood subject to the con—
straint that 171:, : 17/57, for all r, s if 1717, is assumed to be marginally
identically distributed over all q and models M.

For each equivalence class Eq, we then estimate the non-margin-
ally identically distributed ngl by calculating

P(Dqu) :f(Dqu§nZ1a---a’7:z) (7)

and maximize this likelihood subject to the constraint that 17:, = 171:,
for all I if 1717, is assumed to be marginally identically distributed over
all q and M. This gives a single sampling of values for each 172 E ®q.
We continue sampling (without replacement) to acquire sufficiently
large ®q.

In both maximizations, we use the Nelder and Mead (1965)
algorithm as implemented in R’s optim function. This requires ini-
tial values to be provided. For optimal performance, these initial val-
ues should be as close as possible to the solution to the optimization,
and so baySeq v2 allows these to be specified as a function of the
sampled data D1,. In practice, maximum likelihood solutions will
not always be optimal. In certain circumstances we find increased
performance by constraining the domain of the function to be
optimized. We give an example of this below when considering a
zero-inflated negative binomial model.

If the sampled data D), derive from a biomolecular event belong—
ing to a model M, then parameter estimates from this data for other
models may not reflect the true underlying distribution of param-
eters. For example, data from truly differentially expressed genes
will tend to lead to estimates of high variability if it is assumed that
they are not differentially expressed. The estimated distribution of
parameters for a model can thus be further refined through a weight—
ing of the sampled 17/; by 12%, the likelihood that biomolecular event
la is explained by that model. In this case, Eq. 4 becomes

 

MDCIM) = H 1 ,, 21214 H Fwd-Id) (8)
q :h:VM Ia DcieDcEq

Aquisition of the weights 1% through a bootstrapping strategy is

described in Supplementary Sl. Weighting the sampled 172 allows

comparisons between two models with identical equivalence class

definitions but with different hyperdistributions, as described in

Supplementary S2.

2.2 Model priors

The model priors P(M) may be provided based on prior knowledge,
or (by default) estimated empirically from the calculated P(DC|M)
values. If estimated empirically, the default behaviour of baySeq
v2 is to calculate the P(DC|M) for all models M and all c and use the
Bayesian Information Criterion (BIC) to choose between each model
for each c. The proportion of biomolecular events for which a model
M is selected using the BIC is taken as the prior value P(M). If no
events are selected for a given model, the prior value for that model
is set to 1 / C, where C is the total number of biomolecular events
(the prior that would be used if a single biomolecular event were
selected to conform to that model via the BIC), and all priors are
then scaled to sum to 1. The use of the BIC gives better estimates
(Supplementary Fig. S2) of the number of differentially expressed
biomolecular events than the iterative method described in previous
work (Hardcastle and Kelly, 2010).

Rather than assume a single value for P(M), baySeq v2 now
allows different subsets of the data to take different values for
the model prior. This can substantially improve performance
(Supplementary S3) if there are strong reasons to suppose that differ—
ent subsets of the data will display different proportions of differen-
tial expression. This may be valuable in a variety of cases where
sufficient information is available to distinguish between large cate—
gories of genes, for example, if a transcription factor is known to
bind to a specific set of gene promoters, this subset of genes is much
more likely than its inverse to be differentially expressed if this tran—
scription factor is misregulated. Some care may be needed with this
approach in avoiding confirmation bias in downstream analyses of
the sets of differentially expressed data.

2.3 Computational strategies

Calculating priors using numerical methods and posterior likeli-
hoods via Eq. 3 or Eq. 8 are computationally expensive steps that
scale linearly with both the number of models to be evaluated and
the number of biomolecular events being considered. Several strat—
egies are proposed to mitigate the computational costs involved.

2.3.1 Stratified sampling

A minimum size of the sets ®q is required for accurate estimation of
the posterior likelihoods. The highest accuracy will generally be
obtained by making ®q as large as possible, but this carries compu—
tational costs, making sampling from the data necessary. However,
for the numerical approximation described in Eq. 3 to provide a rea—
sonable approximation to the true value of P(DC|M), the sets ®q
must contain values in the high probability mass regions of
P(DCEq |®q). If the sets ®q are acquired by sampling uniformly from
the data, this can present difficulties for estimating posterior proba—
bilities for DCEq that lie in the tails of the hyperdistribution.
Increasing the sample size will resolve this issue, but at a computa—
tional cost. Instead, we propose a stratified sampling technique in
which the data are stratified by some summary statistic and approxi—
mately equal volumes of data are sampled from within each stratum.

9mg ‘09 1sn3nv uo sojoﬁuv SO’] ‘BTUJOJTIBD aIo Amie/xtqu 112 /B.IO'S[BU.IHO[p.IOJXO'SOTlBIHJOJUTOTQ/ﬁdllq 11101; pop1201umoq

198

T.J.Hardcastle

 

A sampling )7]; is then weighted by sh, where s]7 is proportional to the
size of the stratum from which the value 17/; is sampled divided by
the number of samplings from that stratum, scaled such that
stb = 1. Thus, the smaller the proportion of data sampled from a
stratum, the greater the weighting applied to the parameters derived
from this data. Eq. 8 then becomes

IP<DCIM) = 11%: vbs” H P(Dcian) <9)

q h 1’M5 la D,,-eD,Eq
Supplementary Figure S3 illustrates the application of a stratified
sampling and shows the effect of performance in simulated data.
The primary effect of stratified sampling in these data is to reduce
false discoveries for low numbers of selected differentially expressed
genes.

2.3.2 Consensus priors

For large numbers of models, computational costs can be reduced
substantially if we assume that the parameters are identically distrib—
uted for all models; that is, that ®q : ® for all c]. In this case, Eq. 4
becomes

P<DCIM)=HﬁZ H M13611") <10)
‘1

7166) DCiEDcEq

and Eq. 9 becomes

1
lPDClel—E:bb || ewe-M) (11)
( I) qZI/i/Isbh z[M5 1’7
la

DCiEDcEq

The advantage of this formulation is that the values P(DC,-|17) are
identical for all models. Consequently, these need be calculated only
once to allow the likelihood of the data under any model to be eval—
uated with the appropriate product—sum—product, considerably
reducing the computational cost.

In estimating a set @, those parameters assumed to be marginally
identically distributed over all q and models M are estimated as pre—
viously described in Eq. 6. We then randomly select amongst the
replicate sets a single set F, and maximize the likelihood

1131131912)=f(D/ap,;17i)~-ﬂ7:) <12)

as in Eq. 7, subject to the constraint that 17],: : nfk for all k, if 17],: is
assumed to be marginally identically distributed over all q and M.
This gives a single sampling of values for each 17 E @.

3 Results

3.1 Affymetrix microarray Latin Square Data

Microarray data have conventionally been analyzed under an as—
sumption of (log) normality. We compare the performance of
limma (Smyth, 2004), a well established method for discovery of
differential expression, to that of baySeq v2 using a normal distri—
bution in which

—<D.,-—)))2
e 202‘

 

 

1
 _ am
where 17 : (11,0) with the distribution of the standard deviation 0'
being assumed to be constant across samples.

Comparisons are made using the Affymetrix HGU133A Latin
Square data (Affymetrix, 2002). These data consist of three tech—
nical replicates of 14 hybridizations in a human background, with

42 spiked transcripts at differing concentrations in each hybrid—
ization. We processed the data using the RMA Irizarry et al. (2003)
algorithm using the alternate chip description file supplied with the
data. Non—differentially expressed control spikes showed highly
variable expression across arrays (Supplementary Fig. S4) and were
removed from further analysis.

To assess performance of the methods, we select seven non—
overlapping pairs of hybridizations in which to identify pairwise dif-
ferential expression, and compute the average numbers of true and
false positives across these independent pairs of hybridizations. We
repeat the selection of pairs of hybridizations one hundred times,
and show the distribution of false positives against oligonucleotides
selected (Fig. 1a) and of ROC curves (Fig. 1b). The ROC curves are
almost identical between the two approaches, while the numbers of
false positives in the top N transcripts are slightly lower in the
baySeq v2 analysis, suggesting that a generalized empirical
Bayesian approach can match or exceed the performance of a well—
established method for microarray analysis. False discovery rate
(FDR) prediction is considerably better in baySeq v2, with the
limma Benjamini and Hochberg (1995 ) adjusted p—values predicting
no true positives (Supplementary Fig. S5).

3.2 Zero—inflated RNA—Seq data
Zero inﬂation occurs when two processes are involved in the gener—
ation of data. The first, a binary distributed process defines whether
signal is present or absent, the second generates a distribution on the
size of the signal (which may itself be zero) if a signal is present.
Zero—inflated negative binomial data may arise in a number of ways
in high-throughput sequencing technology. In cross—species analyses
(Brawand et 61]., 2011) in which the expression of gene homologues
is being compared, some genes may have moved out of a given regu—
latory pathway and be non—expressed in some organisms. In meta—
transcriptomic studies, (Fang et 61]., 2014) the observed expression
of a gene may be driven by a single organism which may or may not
be present in the meta—sample. Similarly, in single-cell sequencing,
the expression of genes may be much more of a stochastic on/off
process than observed in a multi—cell profile (McDaVid et 61]., 2013).
Zero-inflation may also occur in genome—wide enrichment data as a
result of low coverage and sequencing bias (Rashid et 61]., 2011).
The ShrinkBayes package (Van De Wiel et 61]., 2013), a
generalized linear model approach, is the only currently existing
method for applying a zero—inﬂated negative binomial (ZINB)
model to high—throughput sequencing data. We compare the results
from this package (as implemented in Supplementary 87.23) to
those from a baySeq v2 analysis using a ZINB model in which

 

 

 

 

 

 

 

 

{5] Fun {b} HUI:
_ I  _
— lImma -
cg
m _
E! 3 _
n. N E;
I: E '
m _
TE "'4! l— c:
1::- aq _
D
"- e
‘5' c; I I I I I I
one 0.04 1303
11 FF‘FI

Fig. 1. Average numbers of false positives in the top N transcripts (a) and
ROC curves (b) for baySeq v2 and limma analyses of samplings of non-over-
lapping pairs of hybridizations in the Affymetrix HGU133A Latin Square data.
Percentiles of false discovery rates across samplings are shown as transpar-
ent areas around curves

9mg ‘09 1sn3nv uo sojoﬁuv SO’] ‘BTUJOJTIBD 310 [(1319111qu 112 /B.IO'S[BU.IT10[p.IOJXO'SOTlBIHJOJUTOTQ/ﬁdllq 11101; pop1201umoq

Generalized empirical Bayesian methods

199

 

MDCI'I’?) = (1 — C)g(Dci)lili) ¢) + Una-=0

where g(DC,-, 711,-, ¢) is the probability mass function of a negative
binomial distribution with mean u],- and dispersion d), where l,- is the
library scaling factor of library 7'. 11367.20 is an indicator function
which is 1 if DC,- : 0 and 0 otherwise. 17 : (u, d), C), with the distribu—
tions of the dispersion d) and proportion of zero inﬂation C being
assumed to be constant across samples. In the event that no zeros
appear in the reported expression for a gene, a maximum likelihood
estimation of the C parameter (Eq. 6) will be zero (up to computa—
tional precision). Similarly, since a highly dispersed negative bino—
mial variable will be rich in zeros, a maximum likelihood estimation
for a zero-inﬂated gene may report high d) and low C values.
Performance is improved (Supplementary Fig. S6) by limiting the do—
main of the likelihood function such that C Zmaxr{1 — 2_1|D‘F’|},
that is, C must be greater or equal to that proportion of zero-infla-
tion which gives a 50% chance of seeing no zeros within the smallest
replicate group. The incorporation of this constraint is shown as a
code example in Supplementary 87.22.

In the absence of a zero—inﬂated data set for which true positives
are known, comparisons are made on simulated data described in
Supplementary S4. These data are simulated from ten sequencing
libraries and contain one thousand ‘genes’ differentially expressed
between the first five samples and the second five samples, as well
as nine thousand non—differentially expressed genes. We compare
the performance of baySeq v2 with a ZINB model and with a
negative—binomial model to ShrinkBayes, implemented with non-
parametric priors using default settings. Results from an implemen-
tation of ShrinkBayes with mixture-model priors is shown in
Supplementary Figure S6. Figure 2 shows average ROC curves cal—
culated from the simulations, with the mean expression scaled by 1,
3 and 5 in order to explore the effects of increased sequencing depth
in a zero-inﬂation scenario. In all cases, baySeq v2 with a zero—
inﬂated negative binomial model outperforms ShrinkBayes, espe—
cially for low sequencing depths. ShrinkBayes generally outperforms
baySeq v2 with a negative binomial model. There is a general
improvement in performance with increased sequencing depth for
the two methods accounting for zero inflation which is reversed for
the method which does not, suggesting that zero inﬂation becomes
increasingly significant with higher sequencing depths, as might be
expected. FDR prediction (Supplementary Fig. S7) is considerably
better for the zero—inflated model of baySeq v2, with strong corres—
pondence between true and predicted FDRs. ShrinkBayes mixture
model priors provide better FDR prediction than do the non—
parametric priors, but both substantially under—estimate the true
false discovery rate. Control of FDR was examined by simulating
sets of data with no truly differentially expressed genes
(Supplementary Fig. SS), with all methods showing reasonable con—
trol over FDR in this case.

 

 

 

 

 

 

 

 

 

scaling factor: 1 Scaling facial: a Bulk-IQ faclnr: 5

E - E E

'1. _ 1'! '5'!

a a a

W! _ lea! 1‘!

E ‘F n: ‘F n: '5'
’— III- E III- E 1'
d _ ci CI

w

3 ' 3 a

‘F. _ q 1:)

Cl- I I I I I I ﬁ I I I I I '5

0.01] 0.134 11.08 one 0.11-1- [LEI-E
FPFl FPFt FPFl

Fig. 2. Average ROC curves for baySeq v2 (ZINB), ShrinkBayes and baySeq
v2 (negative binomial) differential expression analyses in zero-inflated nega-
tive-binomially distributed data. Library scaling factors are increased by fac-
tors of 1, 3 and 5. Percentiles of true positive rates across samplings are
shown as transparent areas around curves

3.3 Matched sample sequencing

The Rat BodyMap (Yu et 61]., 2014) project generated RNA—seq data
from multiple organs from juvenile, adolescent, adult and aged
Fischer 344 male and female rats. For each individual in this study,
mRNA is sequenced from every available organ. The expression of
any gene across multiple tissues in the same individual is likely to be
non-independent since an individual—specific effect may have a global
influence on that gene’s expression. We assume that the individual—
specific effects may be approximated by some fold—change consistently
applied across tissues, and that consequently, the ratio of expression
between tissues will remain approximately constant within biological
replicates. We thus use these data to demonstrate a novel analysis
which allows us to identify changes in relative expression within the
tissue types while accounting for individual—specific effects.

Data from ten tissue types (adrenal gland, brain, heart, kidney,
liver, lung, muscle, spleen, thymus and uterus) in female rats
are compared between four juvenile (2—week old) to four aged (104—
week old) individuals. The data are thus multi—dimensional; for each
gene and each individual, we have ten values giving the expression
in each organ. A baySeq v2 analysis is constructed using a
Dirichlet-multinomial analysis in which 17 : (p1,p2,  The distri-
bution of d), the dispersion parameter, is assumed to be constant
across samples. The values [)1 and [)2 represent the proportion of
expression in the tissues with highest and second highest mean
expression in the gene being modelled, with the proportion of
expression in the eight remaining tissues being modelled as
p, : 171+”, such that

 

k 0% + D 'k)
P0357111) = I C]

HZ 09k) 10 m
HZ 0% + Def/z) k=1 Hui/e)
k

1 ij-k _
dikl :  1f  k1 I arg H1an 
i l 1
1 sz-k _
OCij 2  1f ; k2 = argmaxkaék1<Dcik/Lik>jeH
1 l 2

0% =  otherwise
r d) _ 1 2) prij,

ij is the library scaling factor for the lath tissue of the jth individual
and H the (model—dependent) subset of samples over which the high-
est and second highest mean expression tissues are being defined.
This reduction in parameters from the full Dirichlet-multinomial is
required to control the maximum number of parameters estimated
from the eight individuals. Furthermore, this reduces the dimension—
ality of the distribution being empirically estimated, and hence pre—
vents the empirical distribution from being too sparse an estimate of
the true distribution.

We fit three models to these data. The first model describes genes
with consistent levels of expression across all tissue types and ages.
The second model describes genes with expression consistent be—
tween ages, but variable amongst tissue types. The third model de—
scribes genes for which the ratio of expression between tissues varies
between juvenile and aged individuals. In the first two of these mod—
els, all individuals lie in the same equivalence class.

To distinguish between those genes which have consistent levels of
expression across all tissue types and ages and those which have con—
sistent levels of expression across ages but vary amongst tissue types,
we start by computing priors for a single model of consistent expres—
sion between ages. For the model of consistent levels of expression
across all tissue types and ages, we take the computed dispersion par—
ameters and set pk : 1—10 for all 12, while for the model of consistent

9mg ‘09 1sn3nv uo sojoﬁuv SO’] ‘BTUJOJTIBD 310 [(1319111qu 112 /B.IO'S[BU.ITIO[p.IOJXO'SOTlBIHJOJUTOTQ/ﬁdllq 11101; pop1201umoq

200

T.J.Hardcastle

 

expression across ages with variable expression among tissues, we use
the maximum likelihood estimates of pk. We initially weight the mod—
els by partitioning the values [)1 estimated for a model of consistent
expression between ages (Supplementary Fig. S9) to minimize the
intra—class variance (Supplementary S2) and use Eq. 8 to calculate pos—
terior likelihoods based on these weighted values. For the model of
consistent expression across all tissue types and ages, the initial value
for 12% is 1 if the estimated value for [)1 is less than the partitioning
threshold, 0 otherwise; for the remaining two models the converse is
true. 12% is 1 if the estimated value for [)1 is greater than the partition—
ing threshold, 0 otherwise. We bootstrap these weightings as
described in Supplementary S1 over five iterations.

Figure 3 shows the top ranked genes from each of the three mod—
els. The expected number of genes conforming to each model may
be inferred by summing the posterior likelihoods estimated for each
gene for that model. An estimated 133 genes are expected to be con—
sistently expressed across all tissues and ages. 4603 genes are esti—
mated as showing variability between tissues, but no differential
behaviour between ages, while 15 430 genes are expected to show
variable behaviour in one or more tissues between ages. This unusu—
ally high proportion of genes showing differential behaviour is
observed since differential expression in any one of the ten tissues
will be sufficient to identify differential behaviour.

Analysis of the estimated posterior distributions of 0,] (Eq. 5,
Supplementary Fig. S10) allows a breakdown of the differential be—
haviour. Of the top 231 genes (selected by controlling family-wise
error rate at 10%) that show variability amongst tissues and no dif—
ferential behaviour between ages, the gene is most abundantly
expressed most frequently in brain tissue (36%), and most rarely in
uterus tissue (1.2%). Abundances of genes maximally expressed in
each tissue correlate well with those reported by Yu et al. (2014) as
the result of an ANOVA analysis of gene expression (Supplementary
Fig. S11). Of these 231 genes, 95 show a likelihood greater than
95% of the parameter [)2 exceeding the nominal average proportion
of 1%. These genes thus show an increase in expression in two tissue
types relative to the remaining tissues; the most frequent pairings are
between heart and muscle tissues (27) and kidney and liver (15).

For those genes that show a change in proportion of gene expres—
sion across tissues over time, we are similarly able to breakdown the
discovered differential expression. Controlling family-wise error
rate at 10%, we discover 10 071 genes that show changes over time.
The largest category of change (27%) is a reduction of relative
expression in thymus tissue over time, presumably as a result of thy—
mic involution (Shanley et 61]., 2009). However, in 1073 genes, this
reduction in relative expression in thymus tissue correlates with an
increase in relative expression in spleen tissue, suggesting a partial
compensation mechanism may be in place. The genes showing a
reduction in thymus show a strong enrichment for RNA-binding
function (Supplementary Fig. S12, Supplementary Table S1), poten—
tially linked to age—related processes (Masuda et 61]., 2012). Other
large categories of change involve substantial changes in relative
expression over time that nevertheless leave the gene maximally
expressed in the same tissue (Supplementary Fig. F13).

3.4 Complex modelling and computational time

We next use a subset of the Rat BodyMap (Yu et 61]., 2014) data to
demonstrate the use of various computational strategies to carry out
a complex modelling analysis. We begin by considering the RNA-
seq data for each of the four age groups (2, 6, 21 and 104 weeks) in
the thymus of female rats. The total number of potential models for
R replicate groups is the Bell number B R. This number scales rapidly

ENSHHDGWHDDGEEEZ Cyp11b2 1311351 A1

1'1- '-

ﬂ up‘.‘ --.---v-III III_ “I.

 

 

Clan EHSFINDGHDODDDEBBEE
ﬁ 1' I'! 1' IE .-
"‘ a 3 ﬁl- I g 1 ire-a..." Win-FF
— — h I 1 III!“ 5‘
ENSFIHOGDDﬂ-IIDODIJDBB Guhn Tmtnil

1r. "

:13!“ air-*- "PM

1'1"]

lﬁhﬂlmﬂ
I
1

.-"'-I'.ll =-I Brn Hr: ' '_l<cln_ - Lug Lvr ".-'I.-:.I:

111-1 .I.I_.{.'-I:I=I H In): "1M 11]): LP 10:1 112-r:

 

Fig. 3. Boxplots of log expression levels of the top three identified genes from
female rats for each of three models of expression; consistent expression
across tissue types and ages (left), consistent expression across ages but
variable between tissues (centre) and variable expression between ages
(right). The bar at the bottom of the graphs decodes the colours according to
tissue (Adr=adrenal gland, Brn=brain, Hrt-heart, Kdn=kidney, Lng=|ung,
Liv=liver, Msc=muscle, Spl=spleen, Thm=thymus, Utr=uterus) and age
(002 = 2-week old, 104 =104-week old)

R
with increasing R, being bounded above by (1337131119 (Berend and

 

Tassa, 2010). For four groups, the total number of models is fifteen,
sufficiently low that we are able to evaluate, at some computational
cost, posterior likelihoods for each model using Eq. 8, with the pri-
ors being sampled separately for each model as in Section 2.
However, we can achieve a significant reduction in computational
cost through the use of consensus priors (Eq. 11).

An alternative way to reduce the computational cost of such ana—
lyses is to consider only those models that are biologically interest—
ing, and to employ a ‘catchall’ model to account for data not
conforming to one of these models. The catchall model assumes the
data for each replicate group is distributed independently, and is
thus able to describe any pattern of differential expression reason-
ably accurately. Consequently, any data not well characterized by
any other specified model will thus be best described by the catchall
model. Data for which the catchall model has a high posterior likeli-
hood can then be examined for previously unspecified patterns
which may be of interest.

We will suppose that we are primarily interested in genes which
undergo a single change in expression between two consecutive age
groups where this change is maintained in all later age groups.
Together with the ‘catchall’, model, and a model for non-differentially
expressed genes, this requires the evaluation of five models in total.
We refer to these models as NDE (no differential expression), LDE
(late differential expression), in which change occurs between the third
and fourth age groups, MDE (median differential expression), in
which change occurs between the second and third age groups, EDE
(early differential expression), in which change occurs between the first
and second age groups, and ‘catchall’. We can achieve further reduc—
tions in computational cost by using consensus priors in this analysis.

To compare the performance of these approaches, we assume that
the estimated posterior likelihoods for the complete fit of the fifteen
models without consensus priors are accurate. We can then estimate
the number of true positives (and hence, the number of false positives)
in each of the models in the restricted analysis for the various
approaches as the sum of the posterior likelihoods of the complete fit
for the first N selected genes. Figure 4 shows the results of these

91% ‘09 1sn3nv uo sojoﬁuv SO’] ‘BTUJOJTIBD 310 [(1319111qu 112 /B.IO'S[BU.ITIO[p.IOJXO'SOTlBIHJOJUTOTQ/ﬁdllq 11101; pop1201umoq

Generalized empirical Bayesian methods

 

analyses. There is at most a marginal increase in false discoveries be—
tween the complete fit and the complete fit with consensus priors ap—
parent for the NDE set and the EDE set, but in general, the use of
consensus priors appears to cause only minor changes in performance
for both the complete and reduced model fit. There is a small increase
in false positives for the reduced model fit compared to the complete
model fit; however, the evaluation of false positives is made under the
assumption that the complete model fit is accurate. Consequently, this
relatively small difference appears to suggest that both the reduced
and the complete model fit are viable alternatives for analysis of spe—
cific patterns of expression.

Using the complete model set permits a greater ﬂexibility in identi-
fication of further patterns of differential expression over time.
Supplementary Figure S14 shows the expected number of genes for
each model, together with normalized and summarized expression
values for the top ranked gene in the eight models with highest num-
ber of expected genes. These data suggest that, while the majority of
genes are not differentially expressed across age groups, almost as
many genes show a change between the fourth age group and the
three earlier age groups. The models with highest numbers of expected
genes generally preserve the ordering of age groups, however, there
are exceptional cases for which the second age group is distinct from
all other times ({1,3,4},{2}), and also for which the first and fourth age
groups differ from the second and third age groups ({1,4},{2,3}).

The time required for analysis was evaluated on an octo—core
(2.50 GHz) machine, running in parallel on all cores. Analysis of the
complete model fit took 7.0 h, while use of consensus priors reduced
this to 1.7 h. Analysis of the reduced model took 3.3 h, while use of
consensus priors in the reduced model took 1.4 h. The similarity of
performance between the complete model fit with and without con—
sensus priors suggests that consensus priors will generally be prefer-
able for the majority of analyses. It is also apparent from these data
that the use of consensus priors scales well, with an increase from
5 models in the reduced model set to 15 in the complete set causing
only an 18% increase in computational time.

4 Conclusions

We present here a highly flexible solution (baySeq v2) to the gen—
eral problem of identifying differential behaviour in the ‘large P,
small 11’ sets of data that are becoming ubiquitous in biological
experimentation (and elsewhere). Given that the parameters of the
prior distribution can be inferred from the data, posterior likeli—
hoods for diverse patterns of differential expression can be inferred
through an empirical Bayesian analysis. We describe here methods
to infer the distribution of the parameters of the prior distribution
through maximum likelihood methods, but this is not essential; any
method for inferring these parameters from the data might be
applicable. In most cases, the inference of these distributions will
require some level of biological replication (although this can be
avoided by treating all samples as replicates in parameter estima—
tion). The degree of replication required will depend on many fac—
tors, including the assumed distribution, the noisiness of the
observed data, and the required sensitivity of analyses. A rule of
thumb for reasonable parameter estimation (though without any
guarantee of biologically meaningful results) may be to include as a
minimum Q —l— 1 samples, where Q is the largest number of uniquely
valued parameters in any model of interest.

We also introduce a number of further refinements to the basic
concept. The use of a consensus empirical distribution removes
much of the computational cost of these analyses. We demonstrate

 

 

 

 

 

 

 

201
NDE LDE HDE
e e .-e e r' T
+ — r' 9
a: E a: E II" a: l!-
I: _ 1:: n
u. LI. u. m I
_ at
E _ E .._
J: .1 e
‘— i} 4000 8000 '— 0 4001} 3000 [I ‘10 30 51]
number of selected genes nurnberef selected genes number of selected genes
EDE eatehell _ mums
Allmﬂhk
a El - ' IWIWBLIIHSI'I-CI
N " E ‘
_ _ enema «me:
n: In E: : Hunted rI'I-cdl:
E a T E D - Immsnﬁe‘ﬁ

 

 

 

 

   

 

 

l l I l
0 20:] 500
number ef selecled genes

1 I l l
I} 4 B 1 2
number of selected genes

Fig. 4. Number of false discoveries estimated in the genes selected by four
different strategies for fitting the five models showing conserved change in
expression over time

this in an analysis of complex gene behaviour in a subset of the rat
BodyMap data in which the computational time required for a 15
model analysis of 24 750 genes in 16 samples is reduced by 75%
through the use of consensus priors, with little change in perform-
ance. This analysis identifies replicated changes in patterns of differ—
ential expression across age groups and shows that diverse types of
differential behaviour are present in these data.

Qualitatively distinct data may be distinguished through a
weighting or modification of the empirical values representing the
hyperdistribution of the data. We show that this technique allows
the identification of non—expressed genes in RNA—Seq data and con—
sistent expression over multiple tissues and age groups in matched
samples (Fig. 3). Bootstrapping can improve the weightings assigned
to the sampled values and further improve performance. A natural
extension of this approach would be to use distinct distributions for
the different models, and this approach is currently under develop—
ment. Further extensions to the basic concept are also possible. One
of the most advantageous is likely to be the introduction of distribu—
tions on parameters estimated across all biomolecular events for a
given sample, or within a study. For example, scaling factors
involved in RNA—seq analysis are currently treated as observed and
fixed values for each library. However, these scaling factors are in
fact a random variable whose distribution might be approximated
from the observed data. Estimations of this type might be made
through bootstrapping or EM approaches, and incorporated into
estimates of posterior likelihood.

We demonstrate the effectiveness of the baySeq v2 approach by
comparison with methods designed specifically for particular distribu—
tional assumptions. The limma (Smyth, 2004) method is a well—estab—
lished and widely used method for analysis of microarray data
assuming a log—normal distribution. We show on the Affymetrix
HGU133A Latin Square data a minor improvement in performance
of baySeq v2 over limma, under the same distributional assump—
tions (Fig. 1). In simulated zero—inﬂated data, baySeq v2 showed
gains in performance over the ShrinkBayes method (Van De Wiel et
61]., 2013), an approach specifically designed for zero—inﬂated negative
binomial data. These comparisons do not necessarily imply that the
accuracy of baySeq v2 will always match or exceed that of a method
specifically designed for a particular set of distributional assumptions,
but they do suggest that performance will generally be acceptable.

This approach allows a substantial reduction in development time
for information ‘borrowing’ analyses in a ‘large P, small 11’ setting

91% ‘09 1sn3nv uo sojoﬁuv SO’] ‘BTUJOJTIBD aIo Amie/xtqu 112 /B.IO'S[BU.ITIO[p.IOJXO'SOTlBIHJOJUTOTQ/ﬁdllq 11101; pop1201umoq

202

T.J.Hardcastle

 

upon data with novel distributional assumptions. This reduction in
development time is essential if statistical analysis methods are to
keep pace with the rapid development of new technologies and new
applications of those technologies that generate large volumes of bio—
logical data. For example, the data from single—cell sequencing ap—
pears to include a mixture of Bernoulli and Poisson noise (Brennecke
et al., 2013), and are likely to require specific distributional assump—
tions to account for heterogeneity of expression within an individual
(Islam et al., 2011). The diverse classes of histone modification signa—
tures (Bernstein et al., 2012) suggests that differential behaviour in his-
tone modification between samples might be identified by the
simultaneous analysis of quantitative values for all histone modifica—
tions, perhaps through an assumption of a Dirichlet-multinomial dis-
tribution. We describe the development of such a model here in the
context of analysing multiple matched samples in RNA—seq data from
diverse tissues of rat (Yu et al., 2014) in different age groups. The re-
sults from this analysis broadly correspond to known interactions be—
tween tissues and their changes over time, and allow detailed
comparison of gene behaviour between tissues. The relative ease with
which distributional assumptions can be changed and modified using
these methods also allows the rapid incorporation of significant ob-
servables into the models; for example, GC—content, secondary struc—
tures or mapping uncertainties.

The second major advantage of this approach is that it allows a
standardization of output across diverse data—types, in that outputs
consist of a set of similarly generated posterior likelihoods.
Furthermore, posterior likelihoods are easily manipulated and com—
pared between analyses. For example, if a set of RNA—seq data is ana—
lysed under an assumption of negative binomially distributed data
and a set of ChIP—Seq data under an assumption of a Dirichlet-multi-
nomial distribution, it is straightforward to calculate (under an as—
sumption of independence) joint likelihoods of specific patterns of
differential expression of RNA—Seq and ChIP—Seq, and thus,
for example, to order the set of overlapping gene/histone modifica—
tions by the likelihood that both are differentially expressed. Coupled
with the capability of baySeq v2 to easily evaluate novel datatypes,
this suggests that novel data sets can be readily incorporated with
existing analyses. Consequently, the methods we present here allow a
well—founded statistical framework for the analysis of heterogenous
and diverse sets of high—throughput ’omics’ data, a key requirement
for future biological research (Gomez—Cabrero et al., 2014).

Acknowledgements

Krystyna A. Kelly reviewed the manuscript and the baySeq v2 package and
made several valuable criticisms.

Funding

This work was supported by European Research Council Advanced
Investigator Grant ERC-2013-AdG 340642 — TRIBE.

Conﬂict of Interest: none declared.

References

Affymetrix. (2002) Affymetrix Latin Square Data for Expression Algorithm
Assessment, http://WWW.affymetrix.com/support/technical/sample_data/
datasets.affx.

Benjamini,Y. and Hochberg,Y. (1995) Controlling the false discovery rate: a
practical and powerful approach to multiple testing. ]. R. Stat. Soc. Ser. B
(Methodological), 57, 289—300.

Berend,D. and Tassa,T. (2010) Improved bounds on Bell numbers and on
moments of sums of random variables. Prohah. Math. Stat., 30, 185—205.
Bernstein,B.E. et al. (2012) An integrated encyclopedia of DNA elements in

the human genome. Nature, 489, 5 7—74.

Brawand,D. et al. (2011) The evolution of gene expression levels in mamma-
lian organs. Nature, 478, 343—348.

Brennecke,P. et al. (2013) Accounting for technical noise in single-cell RNA-
seq experiments. Nat. Methods, 10, 1093—1095.

Cordero,F. et al. (2012) Optimizing a massive parallel sequencing workﬂow
for quantitative miRNA expression analysis. PloS One, 7, e31630.

Evans,M. and Swartz,T. (1995) Methods for approximating integrals in statis-
tics With special emphasis on Bayesian integration problems. Stat. Sci., 10,
254—272.

Ewald,].C. et al. (2009) High-throughput quantitative metabolomics: work-
ﬂow for cultivation, quenching, and analysis of yeast in a multiwell format.
Anal. Chem., 81, 3623—3629.

Fang,R. et al. (2014) Application of zero-inﬂated negative binomial mixed
model to human microbiota sequence data, Peer] PrePrints, 2, e215 V1.

Gomez-Cabrero,D. et al. (2014) Data integration in the era of omics: current
and future challenges. BMC Syst. Biol, 8, 11.

Hardcastle,T.]. and Kelly,K.A. (2010) baySeq: empirical Bayesian methods for
identifying differential expression in sequence count data. BMC
Bioinformatics, 11, 422.

Hardcastle,T.]. and Kelly,K.A. (2013) Empirical Bayesian analysis of paired
high-throughput sequencing data with a beta-binomial distribution. BMC
Bioinformatics, 14, 135.

Ingolia,N.T. et al. (2009) Genome-Wide analysis in Vivo of translation with nu-
cleotide resolution using ribosome proﬁling. Science, 324, 218—223.

Irizarry,R.A. et al. (2003) Exploration, normalization, and summaries
of high density oligonucleotide array probe level data. Biostatistics, 4, 249—
264.

Islam,S. et al. (2011) Characterization of the single-cell transcriptional land-
scape by highly multiplex RNA-seq. Genome Res., 21, 1 160—1 167.

Johnstone,I.M. and Titterington,D.M. (2009) Statistical challenges of high-di-
mensional data. Philos. Trans. A, 373, 4237—4253.

Kvam,V.M. et al. (2012) A comparison of statistical methods for detecting dif-
ferentially expressed genes from RNA-seq data. Am. ]. Bot., 99, 248—25 6.
Masuda,K. et al. (2012) General RBP expression in human tissues as a func-

tion of age. Ageing Res. Reu, 11, 423—431.

McDaVid,A. et al. (2013) Data exploration, quality control and testing in
single-cell qPCR-based gene expression experiments. Bioinformatics, 29,
461—467.

Morris,C.N. (1983) Parametric empirical Bayes inference: theory and applica-
tions. ]. Am. Stat. Assoc., 78, 47—55.

Murie,C. et al. (2009) Comparison of small n statistical tests of differential
expression applied to microarrays. BMC B ioinformatics, 10, 45.

Nelder,].A. and Mead,R. (1965 ) A simplex method for function minimization.
Comput.]., 7, 308—313.

Nilsson,T. et al. (2010) Mass spectrometry in high-throughput proteomics:
ready for the big time. Nat. Methods, 7, 681—685.

Rapaport,F. et al. (2013) Comprehensive evaluation of differential gene
expression analysis methods for RNA-seq data. Genome Biol, 14, R95.

Rashid,N.U. et al. (2011) ZINBA integrates local covariates with DNA-seq
data to identify broad and narrow regions of enrichment, even within ampli-
ﬁed genomic regions. Genome Biol, 12, R67.

Shanley,D.P. et al. (2009) An evolutionary perspective on the mechanisms of
immunosenescence. Trends Immunol, 30, 374—381.

Smyth,G.K. (2004) Linear models and empirical Bayes methods for assessing
differential expression in microarray experiments. Stat. Appl Genet. Mol
Biol, 3, 1544—6115.

Soneson,C. and Delorenzi,M. (2013) A comparison of methods for differential
expression analysis of RNA-seq data. BMC Bioinformatics, 14, 91.

Van De Wiel,M. A. et al. (2013) Bayesian analysis of RNA sequencing data by
estimating multiple shrinkage priors. Biostatistics, 14, 1 13—128.

Wang,L. et al. (2014) Integrating multi-omics for uncovering the architecture
of cross-talking pathways in breast cancer. PloS One, 9, e104282.

Yu,Y. et al. (2014) A rat RNA-Seq transcriptomic BodyMap across 11 organs
and 4 developmental stages. Nat. Commun., 5, 3230.

9mg ‘09 1sn3nv uo sojoﬁuv SO’] ‘BTUJOJTIBD 10 Amie/xtqu 112 /B.IO'S[BU.ITIO[p.IOJXO'SOTlBIHJOJUTOTQ/ﬁdllq 11101; pop1201umoq

