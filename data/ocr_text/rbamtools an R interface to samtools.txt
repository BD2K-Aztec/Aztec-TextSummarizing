Bioinformatics, 31 (1 0), 2015, 1663—1664

doi: 10.1093/bioinformatics/btu846

Advance Access Publication Date: 5 January 2015
Applications Note

 

Genome analysis

rbamtools: an R interface to samtools enabling
fast accumulative tabulation of splicing events
over multiple RNA-seq samples

Wolfgang Kaisers1'*"‘, Heiner Schaal1'2” and Holger Schwender1'3

1Center for Bioinformatics and Biostatistics, BMFZ, Heinrich Heine University Diisseldorf, 2Institut fiir Virologie,
and 3Mathematical Institute, Heinrich Heine University Diisseldorf, 40225 Diisseldorf, Germany

*To whom correspondence should be addressed.
TThe authors wish it to be known that, in their opinion, the first two authors should be regarded as Joint First Authors.
Associate Editor: John Hancock

Received on July 31, 2014; revised on December 18, 2014; accepted on December 19, 2014

Abstract

Summary: The open source environment R isf the most widely used software to statistically
explore biological data sets including sequence alignments. BAM is the de facto standard file
format for sequence alignment. With rbamtools, we provide now a full spectrum of accessibility to
BAM for R users such as reading, writing, extraction of subsets and plotting of alignment depth
where the script syntax closely follows the SAM/BAM format. Additionally, rbamtools enables fast

 

accumulative tabulation of splicing events over multiple BAM files.
Availability and implementation: rbamtools is available on CRAN and on R-Forge.

Contact: kaisers@med.uni-duesseldorf.de

Supplementary information: Supplementary data are available at Bioinformatics online.

 

1 Introduction

The samtools format specifies various data slots for sequence align-
ments many of which are difficult to understand when sequencing
experiments are to be analyzed. For analysis of sequencing data, de-
tailed access to contents of BAM files is needed, especially when
technical problems arise. rbamtools allows R users to investigate
alignment results by reading the header section or retrieve and view
alignments from regions of interest using basic R structures.

rbamtools provides functions for creation and modification of
BAM file header or alignment section contents. rbamtools also fa-
cilitates writing of BAM files which is not possible in Bioconductor
(Gentleman et al., 2004; Morgan et al., 2010).

Additionally rbamtools contains a framework for sequential and
fast extraction of alignment gap positions (see Table 1) on RNA-seq
data which are candidate sites for true splicing events. rbamtools is
part of an analysis pipeline for analysis of splicing events in RNA-
seq data which consists of three R packages: rbamtools and
refGenome (Kaisers, 2013a) and spliceSites (Kaisers, 2013b).

The identification of splicing inaccuracies is a non trivial task on
BAM files, since the positions of alignment gaps must be accounted

on billions of reads. With rbamtools, processing data from, e.g. 60
RNA-seq samples (containing 8.37 X 109 alignments) can be done
in 1.75 h on a standard workstation with minimal working memory
demand.

Current versions of the samtools C library contain misalignment
(bus) errors (http://en.wikipedia.org/wiki/Bus_error), which may
cause program crashes on some architectures (e.g. SPARC).
In rbamtools, these misalignment errors are corrected (see
Supplementary Material).

2 Approach

2.1 Implementation
The package consists of three layers: the samtools C library, C based
containers for alignments and alignment gaps as well as an 54 class
library in R providing the user interface.

The samtools C library is a static copy of samtools (v1.4-r985).
In order to meet CRAN policies, numerous changes had to be
introduced into the source code (B.Ripley and K.Hornik, personal
communication).

©The Author 2015. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com 1663

112 [3.10811211an[plOJXO'SODBIILIOJIIlOlQ/ﬂ(11111 wort pepeolumoq

910K ‘09 lsnﬁnV no :2

1664

W.Kaisers et al.

 

Table 1. Example for a gap site

 

 

Exon Intron Exon Position CIGAR
AG CCTTGATG 3 2M6N8M
CAG CCTTGAT 2 3M6N7M
CCAG CCT 1 4M6N3M
CCCAG GTCCAG CCTTGATGTCC (reference)

 

A gap site deﬁned by three alignments which share the same alignment
gap site. The position values are O-based (as described in the SAM ﬁle
format“). The last row represents the (chromosomal) reference
sequence.

 

“http://samtools. github.io/hts-specs/ SAMv1 . pdf

2.2 User interface

The S4 class library closely reflects the internal structures of BAM
files. In order to provide detailed access to BAM file content, the
API provides 14 classes and numerous functions.

Basic accessors

Basic accessors provide access to all parts of raw file content, header
section and alignments for reading and writing. The following ex-
ample opens the BAM file ham and copies alignments on chromo-
some 1 into a second BAM file.

rd <— bamReader (bam, idx = TRUE)

rg <— bamRange (rd, getRefCoords (rd, “chrl”) )
wr <— bamWriter (getHeader (rd, “chrl . bam”)
bamSave(wr, rg, refid=0)

Inspecting ranges can be useful when downstream analysis indi-
cates regions without any alignments or other technical ﬂaws.

Specialized analysis routines

Specialized analysis routines for visualization of phred score distri-
bution as well as for tabulation of nucleotide content and calcula-
tion of GC content and AT/GC ratio are provided.

Alignment depth

This information can be retrieved from a bamRange object. Figure 1
shows an example where alignment depth is plotted for Gene
CHMPZA (ENSG00000130724).

ad < — a1 ignDepth (range)
plotAlignDepth (ad)

Gap sites

Gap sites are kept in containers of class bamGapSite. The data is
gathered from BAM files using the bamGapList function which
directly operates on bamReader objects as shown below.

bgll <— bamGapList (bamReader (baml , idx = TRUE)
bg12 <— bamGapList (bamReader (bam2 , idx = TRUE)
bgl <— merge (bgll, bg12)

Gap site positions and numbers of crossing read alignments can
be obtained from multiple BAM files as data.frame by executing:

gap <— readPooledBamGapr (fileNames)

The algorithm processes 1 196 149: 5 36 alignments per second or
4.3 billion alignments per hour. The data inside bamGapSites ob-
jects can directly extracted into a data. frame. For each gap site,
alignment (read) counts are provided which can be used for

Alignment depth for gene CHMP2A

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

Refname: 19
u l. W
1000 ’ “a
500- f
5 I
Q.
g 100 h
  r J)
E 10
.9 _ "r
E 5 r1
1 n n
%II—l—I—I II E

Chromosome 19 Gene ENSGOOOOO130724 Transcript ENST00000601220

59062000 59063000 59064000 59065000 59066000 59067000
Position

 

Fig. 1. Number of alignments per genomic position for gene CHMP2A

differential expression analysis and for differential splicing analysis.
Gene annotation can be added by using a specialized annotation pro-
cedure for gap sites provided by the CRAN refGenome package.
Further information on gap sites for example identification of non
canonical splice sites, MaxEnt (Yeo and Burge, 2004) and HBond
(Freund et al., 2003) scores as well as information on alternative splic-
ing events can be obtained using the Bioconductor spliceSites
package.

Application of these rbamtools functions to data from an RNA-
seq experiment on 60 human fibroblast samples resulted in 115 968
gap sites which are present in all samples. Thereof, 98.1 % exactly
lie on annotated (Ensembl Release 74) splice sites while 1.98 %
(2210 gap sites) are located on not yet annotated positions.

Acknowledgements

We thank the R Core Team (R Core Team, 2014), and in particular Profs.
Brian Ripley and Kurt Hornik, very much for their fruitful comments and for
their valuable help in improving rbamtools.

Funding

RNA-seq datasets were obtained from RNA deep sequencing projects which
were partly funded by the German Ministry of Research and Education
(Network Gerontosys), DFG [SCI-IA 909/3-1], the Heinz Ansmann
Foundation for AIDS Research, Dusseldorf, Germany (He.S), and the Jurgen
Manchot Stiftung (H.S.). The ﬁnancial support of the Deutsche
Forschungsgemeinschaft [SCHW 1508/3-1 to H.S.] is gratefully
acknowledged.

Conﬂict of Interest: none declared.

References

Freund,M. et al. (2003) A novel approach to describe a 111 snrna binding site.
Nucleic Acids Res., 31, 6963—6975.

Gentleman,R.C. et al. (2004). Bioconductor: Open software development for
computational biology and bioinformatics. Genome Biol., 5, R80.

Kaisers,W. (2013a) refGenome: Gene and Splice Site Annotation Using
Annotation Data From Ensembl and UCSC Genome Browsers. CRAN R
package version 1.3.0.

Kaisers,W. (2013b) spliceSites: A Bioconductor Package for Exploration of
Alignment Gap Positions from RNA-Seq Data. Bioconductor R package
version 1.3.3.

Morgan,M. et al. (2010) Rsamtools: Binary alignment (BAM), variant call
(B CF), or tabix ﬁle import. R package version 1.16.1.

R Core Team (2014) R: A Language and Environment for Statistical
Computing. R Foundation for Statistical Computing, Vienna, Austria.

Yeo,G. and Burge,C. (2004). Maximum entropy modeling of short sequence
motifs with applications to ma splicing signals. ]. Comput. Biol, 11, 377—394.

112 [3.10811211an[plOJXO'SODBIILIOJIIIOIQ/ﬂ(11111 wort pepeolumoq

910K ‘09 lsnﬁnV no :2

