ORIGINAL PAPER

Vol. 27 no. 13 2011, pages 1798-1805
doi: 10. 1093/bioinformatics/btr2 77

 

Structural bioinformatics

Advance Access publication May 10, 2011

HiTRACE: high-throughput robust analysis for capillary

electrophoresis

Sungroh Yoon1’*, Jinkyu Kim‘, Justine Hum2, Hanjoo Kim‘, Seunghyun Park‘,

Wipapat Kladwang2 and Rhiju Dasz’3’*

1School of Electrical Engineering, Korea University, Seoul 136—713, Republic of Korea, 2Department of Biochemistry,
Stanford University, Stanford, CA 94305, USA and 8Department of Physics, Stanford University, Stanford, CA 94305,

USA

Associate Editor: Ivo Hofacker

 

ABSTRACT

Motivation: Capillary electrophoresis (CE) of nucleic acids is a
workhorse technology underlying high-throughput genome analysis
and large-scale chemical mapping for nucleic acid structural
inference. Despite the wide availability of CE-based instruments,
there remain challenges in leveraging their full power for quantitative
analysis of RNA and DNA structure, thermodynamics and kinetics.
In particular, the slow rate and poor automation of available analysis
tools have bottlenecked a new generation of studies involving
hundreds of CE profiles per experiment.

Results: We propose a computational method called
high-throughput robust analysis for capillaly electrophoresis
(HiTRACE) to automate the key tasks in large-scale nucleic acid CE
analysis, including the profile alignment that has heretofore been a
rate-limiting step in the highest throughput experiments. We illustrate
the application of HiTRACE on 13 datasets representing 4 different
RNAs, 3 chemical modification strategies and up to 480 single
mutant variants; the largest datasets each include 87 360 bands.
By applying a series of robust dynamic programming algorithms,
HiTRACE outperforms prior tools in terms of alignment and fitting
quality, as assessed by measures including the correlation between
quantified band intensities between replicate datasets. Furthermore,
while the smallest of these datasets required 7—10h of manual
intervention using prior approaches, HiTRACE quantitation of even
the largest datasets herein was achieved in 3—12 min. The HiTRACE
method, therefore, resolves a critical barrier to the efficient and
accurate analysis of nucleic acid structure in experiments involving
tens of thousands of electrophoretic bands.

Availability: HiTRACE is freely available for download at
http://hitrace.stanford.edu.

Contact: sryoon@korea.ac.kr; rhiju@stanford.edu

Supplementary information: Supplementary data are available at
Bioinformatics online.

Received on December 7, 2010; revised on April 12, 2011; accepted
on April 27, 2011

1 INTRODUCTION

Capillary electrophoresis (CE) is a widely used approach for
biochemical analysis. The rapid electrophoretic separation of

 

*To whom correspondence should be addressed.

ﬂuorescently labeled nucleic acid fragments inside electrolyte—
ﬁlled capillaries signiﬁcantly accelerated genome sequencing (Ruiz—
Martinez et al., 1993; Woolley and Mathies, 1995). A more recent,
powerful application of CE enables the high—throughput structure
analysis of self—assembling nucleic acid—containing systems (Mitra
et al., 2008; Vasa et al., 2008; Das et al., 2010; Kladwang and
Das, 2010; Weeks, 2010) as complex as viruses (Watts et al., 2009;
Wilkinson et al., 2008) and ribosomes (Deigan et al., 2009) at
single—nucleotide resolution.

The CE proﬁles obtained in this recent generation of ‘structure—
mapping’ experiments present tens of thousands of individual
electrophoretic bands; quantifying these data gives detailed portraits
of nucleic acid structure, folding thermodynamics and kinetics but
requires signiﬁcant informatics efforts (Mitra et al., 2008). ‘Base—
calling’ software packages can assign sequences to these bands in
special four—color experiments (see, e.g. Ewing and Green, 1998;
Ewing et al., 1998) but are not applicable to structure mapping
experiments, which require more robust sequence annotation and
quantitative ﬁts of each proﬁle to a sum of peak shapes. Such
quantitative analysis is aided by the design of experiments so that the
desired information appears as differences between corresponding
bands across proﬁles [see, e.g. (Das et al., 2005; Kladwang and
Das, 2010)]; then, sequence annotation of one proﬁle results in
annotation of corresponding bands across the entire data. For these
datasets, tools for alignment of features or ‘rectiﬁcation’ (Das et al.,
2005; Laederach et al., 2008) across different proﬁles resulted in
improvements in quantiﬁcation speed and accuracy, but these tools
remain poorly automated. As the experimental steps of large—scale
CE measurements continue to accelerate, the bioinformatic task of
proﬁle alignment has become a rate—limiting step in carrying out
these information—rich structural studies.

Current approaches to aligning and ﬁtting capillary proﬁles
include capillary automated footprinting analysis (CAFA; Mitra
et al., 2008) and ShapeFinder (Vasa et al., 2008); we have found
these methods difﬁcult to apply to large—scale titration or mutate—
and—map datasets (Kladwang and Das, 2010; Kladwang et al., 2011).
For instance, CAFA is focused more on peak ﬁtting and has limited
alignment capabilities. The ShapeFinder alignment function can
align spectrally separated products within a single capillary but not
proﬁles across multiple capillaries with initially poor alignment. Use
of these tools requires tedious manual intervention and risks bias
or unnecessary errors from such manipulation. Analysis tools for
alignment and peak ﬁtting have also been proposed in other domains

 

1798 © The Author 2011. Published by Oxford University Press. All rights reserved. For Permissions, please email: journals.permissions@oup.com

112 /§.IO'SIBUJHOprOJXO'SOllBIIIJOJUTOTQ/ﬁdllq mm; pepBOIUAAOG

9IOZ ‘091sn8nv uo ::

HiTRA CE

 

such as chromatography (Nielsen et al., 1998; Tomasi et al., 2004),
mass spectrometry (Kazmi et al., 2006; Wong et al., 2005) and slab
gel electrophoresis (Das et al., 2005; Laederach et al., 2008), but,
empirically, these approaches give unsatisfactory performance for
CE data.

To address the limitations of existing methods, we have developed
high-throughput robust analysis for capillary electrophoresis
(HiTRACE) to automate the alignment and quantiﬁcation of
nucleic acid structure mapping proﬁles obtained from hundreds
of capillaries. As depicted in Figure 1, the proposed method
consists of four major steps: preprocessing (step A), correlation—
optimized linear alignment (step B), dynamic programming—based
non—linear adjustments (step C), sequence annotation (step D) and
peak ﬁtting (step E). After describing the core algorithms that
underlie the robust automation of each step, we present quantitative
ammMmmﬂhwmmyMMﬂMmmmemmUMMmmmymd
speed of HiTRACE over previous approaches. With the proposed
methodology, the previously rate—limiting step of quantifying high—
throughput CE data is now faster than experimental data acquisition
times, enabling the investigation of nucleic acid structure at an
unprecedented rate.

2 METHODS

2.1 Experimental setup

An experimental protocol that is optimal for HiTRACE alignment and
quantiﬁcation has been developed; complete descriptions of reaction
components, puriﬁcation procedures and sequencing ladder generation have
been given previously (Das et al., 2010; Kladwang and Das, 2010; Kladwang
et al., 2011). Brieﬂy, RNA samples were chemically modiﬁed under the
desired solution conditions and then reverse transcribed with primers (labeled
at the 5/ ends with the rhodamine green ﬂuorophore) complementary to
the 3’ end of the RNA. Because the reverse transcription stops at modiﬁed
nucleotides, the length distribution of the resulting DNA products encodes
the chemical reactivities of the RNA. Length separation of the DNA was
carried out on Applied Biosystems ABI 3100 and ABI 3730 sequencers; these
instruments permit the single—nucleotide separation of products as long as
500 nt for 16 and 96 samples, respectively. To facilitate HiTRACE alignment,
all samples were coloaded with a reference ladder that ﬂuoresces in a different
color and provides ﬁducial markers that are identical between samples. The
ladder, prepared in a large batch for many experiments, was derived by
reverse transcribing an arbitrary RNA (typically the 202—nt P4—P6 RNA)
with a Texas red—labeled primer.

2.2 Assumptions and deﬁnitions

CE proﬁles each contain hundreds of ‘bands’ (when the data are viewed
in gray scale) or ‘peaks’ (when the intensity is plotted as a function
of electrophoresis time) whose intensities or areas report on individual
residues of a nucleic acid sequence. In CE experiments that use hundreds of
capillaries, proﬁles are typically obtained in multiple batches of experiments,
e. g. with 16 capillaries in an ABI 3100 sequencer, as illustrated in Figure 1.
The ﬁrst proﬁle of each batch is designated the reference to which other
proﬁles of the batch should be aligned. Each proﬁle i represents ﬂuorescence
intensity measured at uniformly spaced time points (here, 0.1 s) denoted by
n: 1,2, ...,N with associated intensity values yi(n). As shown in Figure 1,
the horizontal and vertical axes correspond to the proﬁle index and the
measurement position in time points, respectively. Fluorescence intensity
levels are represented in gray scale, with nucleic acid species of different
lengths appearing as separated, dark bands. The desired ﬁnal output of the
proposed methodology is a set of aligned proﬁles with their quantiﬁed band
areas.

2.3 Preprocessing (step A)

In a typical proﬁle, the starting and ending regions contain no signal. To
accelerate subsequent steps, the user has the option of deﬁning a window
that brackets the electrophoretic signals in all the proﬁles. As another
preprocessing step, we subtract an offset, constant within each proﬁle, so as
to bring the signal to zero at the boundaries of the window; this step corrects
for overall drift in signal baselines that are observed in sequencer detectors.
We have also implemented an option to derive and subtract a smooth (but not
necessarily linear) baseline from each proﬁle by using a procedure similar to
Xi and Rocke (2008). This operation removes smoothly varying backgrounds
in ﬂuorescence signal sporadically seen in experimental CE proﬁles and,
empirically, brings independent replicates into closer agreement.

2.4 Alignment by linear transformation (step B.1)

The ﬁrst alignment step involves a linear scaling and shifting of the time axis
based on maximizing the correlation coefﬁcient between each ﬂuorescence
proﬁle yi(n) and the reference proﬁle y1(n) within each batch:

(AZ-“,of): argmax {corr|:y1(n),yi(£—Ai)]} (1)
(A,,a,-)eD,-xs,- 0i

where D,- and S,- represent the sets of possible values of the shift A,- and scale
factor a), respectively, and D,- x S,- denotes their Cartesian product. Based on
the values found above, we ﬁrst time scale each proﬁle yi(n) by of using
linear interpolation and then shift it by A7. The correlation coefﬁcient was
chosen as the optimization target because it is independent of signal offset
and scaling and has been widely used in other alignment tasks (Bylund
et al., 2002; Nielsen et al., 1998; Pravdova et al., 2002; Tomasi et al., 2004).
We carry out the search over shifts (Ai) efﬁciently through a Fast Fourier
Transform (FFT; Oppenheim and Schafer, 2009). By default, we carry out
the alignment based on the reference ladder pattern that is coloaded with
each sample (see above).

2.5 Alignment between batches (step B.2)

Due to variabilities between batches, performing only the intrabatch
alignment above produces stratiﬁed alignment results, where a number
of up—and—down ‘stairs’ appear. To resolve this problem, we perform an
additional interbatch alignment.This step constructs a representative proﬁle
of each batch by calculating the average of the ﬁrst, middle and last proﬁles
selected from each batch. We align these representative proﬁles to the
ﬁrst representative proﬁle by the procedure above. Assume that, for the
representative proﬁle from batch b, we have determined A; and a; values.
We then realign all the proﬁles in batch b using these A; and a; values
(see Fig. 1B). More details of step B.2 can be found in the Supplementary
Material.

2.6 Non-linear alignment (step C)

With current CE equipment, we found that it was not feasible to get
complete alignment for proﬁles with single—band resolution through just
linear scaling of the time axis. There are two reasons for this problem. First,
the electrophoretic mobilities of the same products in different capillaries,
or for the same capillary used at different times, can vary due to temperature
differences and geometry differences. As a result, long proﬁles, containing
hundreds of bands measured over tens of minutes, can be aligned well
over the initial part of the data (e.g. the ﬁrst 2min) or the ﬁnal part of
the data (e.g. the last 2min), but both parts cannot be simultaneously
aligned with a single linear transformation. Second, we often run capillary
electrophoresis experiments for structure mapping of molecules with slightly
different sequences, e.g. libraries of single—mutation constructs (Kladwang
and Das, 2010; Kladwang et al., 2011). This leads to small perturbations in
the band mobilities at the site of the mutation and requires a locally non—
linear transformation to permit alignment. To correct for both these issues,
we perform another round of reﬁning the alignment.

 

1 799

112 /810'smumofproarxosor1eu110jurorq//zd11q 11101; popeoIUAAoq

9IOZ ‘09 lsnﬁnv uo ::

S. Yoon et aI.

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

green (signal) red (reference ladder)
h I
E II b I 
= : "II. F ' i ' In. " : "
= f' - ' _ . I I
I' _ h _:')- t_1 -u .1 .-.(,_L ' __ _'h I
_ I I a F. t =
f - __l.=-'EI _; “=2”
- J 4* j r -1 :i - -  r?“ T. - -:
_ ul' _- '- _-  1 _ _ -:- FT a: _ : -
l— _ . F- l _ _ . _:
1r“r__ h __-'- _ - a ’
- . automaticlinear ali nment based
baseline subtraction on reference adder

 

 

 

auto-reﬁne
alignment
[dynamic
programming]

ﬂ

interactive

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

band _
deconvolution
k
,

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

Fig. 1. Overview of the proposed HiTRACE methodology. (A) Raw electropherograms for an example dataset. (left) Dimethyl sulfate (DMS) modiﬁcation of
the MedLoop RNA (Kladwang et al., 2011), read out by reverse transcription with rhodamine green—labeled primers followed by DNA separation by capillary
electrophoresis; data shown are DMS proﬁles for 80 (of 120) single nucleotide mutants, 2 replicate controls without chemical modiﬁcation and sequencing
ladders for C, U and G. (right) Electropherograms of the Texas red—labeled DNA ladder that was coloaded with each sample to produce ﬁducial markers for
alignment. (B) Proﬁles after automated preproces sing (baseline subtraction) and correlation—optimized linear alignment. (C) Proﬁles after automated alignment
reﬁnement by dynamic programming—based non—linear adjustments. (D) Interactive sequence annotation guided by features (red circles) at mutation positions
and bands in the sequencing ladder. Blue, cyan, orange and red lines correspond to modiﬁcations at A, C, G and U, respectively. (E) Quantitated band areas
(the ﬁnal output of HiTRACE). Shorter DNA fragments (higher mobility) are at the top of each panel.

 

1 800

112 /810'smumofproarxosor1eu110jurorq//:d11q 11101; popeoIUAAoq

9IOZ ‘09 lsnﬁnv uo ::

HiTRA CE

 

The concept underlying the non—linear alignment is depicted in the
Supplementary Material, and resembles the warping method presented in
Nielsen et al. (1998) for chromatographic data. We break the time axis of
a non—reference proﬁle into m—pixel windows and then shift each window
boundary within a predeﬁned range over the reference proﬁle so as to
maximize the correlation between proﬁles summed over all windows. We
assume that the window ordering is preserved during alignment. The number
of possible arrangements in this setup is large but can be enumerated
efﬁciently by a dynamic programming (DP) approach (Bylund et al., 2002;
Cormen et al., 2009; Nielsen et al., 1998; Robinson et al., 2007) that
recursively solves the problem for the ﬁrst window, then the ﬁrst two
windows, etc. As in steps B.1 and B2, we accelerate the calculation by
computing correlation coefﬁcients through FFT. Example results are shown
in Figure 1C. The Supplementary Material includes a graphical description of
determining the shift amount for each window edge for aligning two example
proﬁles.

2.7 Sequence annotation (step D)

Each band in a ﬂuorescence proﬁle corresponds to a position in the nucleic
acid sequence. Currently, we carry out sequence annotation interactively
and manually, as this encourages visual inspection of the data and makes
use of expert knowledge to ensure accurate annotation. This step is
accelerated compared to prior approaches (Mitra et al., 2008; Vasa et al.,
2008) through visual feedback. Sequence assignments are made based
on Sanger sequencing ladders included in the experiments; as the user
makes assignments, ‘guidemarks’ appear at expected band positions (one
residue longer than the corresponding position of modiﬁcation, due to
dideoxynucleotide incorporation). These guidemark positions can be visually
conﬁrmed or adjusted to overlay on experimental bands (see circles in
Fig. 1D). In addition, these guidemarks can be set to appear on A and C
positions for dimethyl sulfate alkylation experiments (Peattie and Gilbert,
1980; Tijerina et al., 2007), as well as mutated positions in mutate—and—map
experiments (Fig. 1D), which typically give visually distinct perturbations
in chemical modiﬁcation. These features provide cross—checks on the
sequencing ladder that conﬁrm accuracy. Due to the alignment of traces
achieved in previous steps, sequence annotations need to only be provided
once and are applicable to all traces. Automated annotation procedures
are also being developed and will be incorporated in future versions of
HiTRACE.

2.8 Band deconvolution and quantiﬁcation (step E)

In this last step of HiTRACE, we approximate each proﬁle y(n) for n:
1, 2, ...,N by a sumf(n) of K Gaussian curves with the form

K (n — 11402
f(n)= 2 :Akexp [— —, j (2)
2o
[(2] k
such that the deviation deﬁned by

1 N
N 2 Wm) —y(n)]2 (3)

n=1

   

is minimized. Ak, uk and 0k are the parameters that determine the
amplitude, the center location and the width, respectively, of a peak
modeled by a Gaussian. We ﬁnd the optimal values of these parameters
by a standard Levenberg—Marquardt optimization technique for least—square
minimization (Levenberg, 1944; Marquardt, 1963), and report the area of
each peak as the ﬁnal output.

2.9 Implementation and data preparation

We implemented the proposed HiTRACE methodology in the MATLAB
programming environment (The MathWorks, http://www.mathw0rks.com)
and are making it freely available for download at http://hitrace.stanford.edu.

For comparison with HiTRACE, we also prepared the implementations
of the ﬁve different proﬁle analysis algorithms: CAFA (Mitra et al.,
2008), ShapeFinder (Vasa et al., 2008), msalign (Kazmi et al., 2006),
SpecAlign (Wong et al., 2005) and COW (Tomasi et al., 2004). We could
not apply some methods to all situations due to their intrinsic limitations.
For instance, the alignment feature of CAFA and ShapeFinder requires
signiﬁcant manual intervention to handle hundreds of proﬁles; we did not
include ShapeFinder in the alignment result comparison. Similarly, msalign,
SpecAlign and COW can align proﬁles but do not carry out peak ﬁtting. We
thus excluded them in ﬁtting result comparisons.

2.10 Criteria for evaluating alignment results

We applied two widely used mathematical criteria—the mean squared error
(MSE; Kay, 1993) of aligned peak positions with respect to the reference
peaks and the Kullback—Leibler (KL) divergence (Cover and Thomas, 2006)
between reference and non—reference proﬁles.

In MSE computation, we consider the position p of each peak in the
reference proﬁle as the true value being estimated, and use the position 13 of
the aligned peak on a non—reference proﬁle as the estimator of p. The MSE
for the j—th reference peak pj is then

L
MSEj =E [031' —Pj)2] = £2 (I317 —P1j)2 (4)
i=1
where L is the number of proﬁles in the dataset used, and p1 j and 13,-]- represent
the positions of the j—th reference peak and the peak on proﬁle i that is
aligned to pj, respectively. For the peak detection step involved in the MSE
computation, we used the peak algorithm described by Mitra et al. (2008),
which is speciﬁcally designed for ﬁnding peaks in CE proﬁles and shows
satisfactory performance for our purpose.

To evaluate the alignment results from an information—theoretic
perspective, without explicitly considering speciﬁc peaks or band positions,
we utilized the KL divergence. We calculated the KL divergence between
the reference proﬁle y1(n) and a non—reference proﬁle y,-(n) as

37101)
1’11")

 

N
DKL1y1|Iyi)=Zy1(n)log (5)

n=1
where N is the number of pixels in each proﬁle. We repeat this calculation
for every reference and non—reference pair in a dataset. Before computing
KL divergence, intensity values were limited to two SDs above the mean to
prevent KL divergence values from being dominated by strong bands at the
beginning and end of each proﬁle.

3 RESULTS

3.1 High-throughput RNA structure mapping datasets

To test HiTRACE, we collected 13 nucleic acid structure mapping
experiments read out by capillary electrophoresis (Table 1). These
datasets were diverse: probed molecules included artiﬁcial model
systems (the MedLoop RNA and the X20/H20 RNA/DNA system)
as well as natural structured RNAs (a conserved domain from the
signal recognition particle and the P4—P6 domain of the Tetrahymena
group I ribozyme), with lengths between 60 and 202 nt. Three
common chemical modiﬁcation strategies were represented in the
data: dimethyl sulfate alkylation (Tij erina et al., 2007), carbodiimide
modiﬁcation (Walczak et al., 1996) and 2’—OH acylation [the
SHAPE strategy (Merino et al., 2005)]. In addition, the datasets
were challenging in their size. Three experiments each gave 182
bands over 480 electropherograms, for a total of 87 360 bands per
dataset. Finally, to test the precision of quantiﬁcation relative to
other sources of error, ﬁve experiments were conducted twice by

 

1801

112 /810's12u1nofp101x0'sor112u1101urorq//zd11q 111011 pop1201umoq

9IOZ ‘09 lsnﬁnv uo ::

S. Yoon et al.

 

Table 1. High—throughput RNA structure mapping datasets analyzed by
HiTRACE

 

 

Name Proﬁles (n) Bands per proﬁle (n) Total bands (n)
X20/H20 DMS—1a 98 40 3920
X20/H20 DMS—2a 88 40 3520
MedLoop DMS—1b 120 60 7200
MedLoop DMS—2b 136 60 8160
MedLoop CMCT—lb 128 60 7680
MedLoop CMCT—2b 120 60 7200
SRP DMS—1C 88 60 5280
SRP DMS—2C 96 60 5760
SRP CMCT—lC 88 60 5280
SRP CMCT—2C 88 60 5280
P4—P6 DMSC 480 182 87 360
P4—P6 CMCTC 480 182 87 360
P4—P6 SHAPEC 480 182 87 360

 

SRP, signal recognition particle conserved domain; P4-P6, P4-P6 domain of the
Tetrahymena group I ribozyme; DMS, dimethyl sulfate; CMCT, 1-cyclohexyl-3-(2-
morpholinoethyl) carbodiimide metho-p-toluenesulfonate; SHAPE, selective hydroxyl
acylation analyzed by primer extension.

aKladwang and Das, 2010.

bKladwang et al., 2011.

CThis work.

two independent researchers. Additional datasets were collected
to conﬁrm HiTRACE’s ability to quantify data for RNAs over
400 nt in length (the L—21 ScaI Tetrahymena group I ribozyme)
and to compare overlapping SHAPE data derived from reverse
transcription starting at different primers on the same RNA (the
P4—P6 domain). Overall, these datasets provide a diverse and
challenging benchmark of nucleic acid CE experiments at the large
scale permitted by current high—throughput experimental protocols.

3.2 Robust alignment of CE proﬁles

As the most basic test, we ﬁrst compared the alignment results
of HiTRACE with previously available methodologies by visual
inspection (Fig. 2). Prior to alignment, CE experiments gave initially
poor alignments of DMS chemical mapping proﬁles for the 60 band
MedLoop RNA and the 182 band P4—P6 RNA (‘Raw’ in Fig. 2A and
B). Application of automated HiTRACE alignment aligns the strong
bands across all proﬁles (‘HiTRACE’ in Fig. 2A and B; see also
Fig. 1A—C). In the alignment results produced by methods other than
HiTRACE, proﬁles within each group tend to be reasonably aligned,
whereas proﬁle groups are not well—aligned. We did not observe this
‘stratiﬁcation’ problem in the HiTRACE result, mainly due to the
interbatch alignment step (B.2) used by HiTRACE. Additionally,
comparing HiTRACE results with SpecAlign and CAFA results
reveals the effectiveness of the HiTRACE non—linear alignment
step, which adapts alignment to weakly varying electrophoretic rates
along the proﬁle. In the alignment results produced by SpecAlign
and CAFA, some parts of the proﬁles appear reasonably aligned, but
the top (SpecAlign) or bottom (CAFA) portions are not well aligned.
For msalign and COW, this problem is much more noticeable.

For more quantitative evaluation of proﬁle alignments, we
compared the different methodologies in terms of two mathematical
criteria, mean squared error in peak position (MSE) and KL
divergence between proﬁles. Figure 2C and D show the distributions
of the average MSE and KL divergence values over the 13 datasets

COW
Raw HiTRACE msalign SpecAlign (100/10)

-.

CAFA

 

     
   

;'l I. .
r- '
I-r lilllff‘H-

 i

 

 

 

 

   

 

C
.9
:5;
O
n.
0 50.100 0 50100 0 50100 0 50100 0 50100 0 50100
Profile COW
B Raw HiTRACE msalign SpecAlign (100/10) CAFA

 

            

 

 

 

 

 

 

 

 

 

 

C
.9
#0:;
O
a.
O 200 400 0 200 400 0 200 400 0 200 400 0 200 400 0 200 400
Profile
C
600 - + + _
500 - —.— _
_ I
IJJ _ I _
g 400 I — _|_ _
a, 300 - El I E I El -
O)
E
a) 200 - -
>
< E
 g E 1 -
0 _L
Raw HiTRACE msalign SpecAlign COW COW CAFA
D (100/10) (500/50)
002— _ _
a, _
3 0016 — -
“e” ' T T T
g 0.012 — i I -
'0
_I
.  _ , a a -
 T —
5 0.004- —|— -|— _|_ -
<7: I; J.
0

 

 

Raw HiTRACE msalign SpecAlign COW COW CAFA
(100/10) (500/50)

Fig. 2. Comparison of available alignment strategies for nucleic acid
CE proﬁles. (A) Comparison of electrophoretic proﬁles of the 88 proﬁle
MedLoop DMS mutate—and—map dataset (Kladwang et al., 2011) (replicate 2)
before alignment and after alignment by HiTRACE, msalign (Kazmi et al.,
2006), SpecAlign (Wong et al., 2005), COW (Tomasi et al., 2004) and
CAFA (Mitra et al., 2008). (B) Alignment results for the 480 proﬁle P4—P6
DMS dataset. (C) Quantitative comparison of alignment results for all 13
datasets based on MSE (Kay, 1993) of aligned peak positions with respect
to the reference peaks. The line in the middle of a box is median value;
box boundaries represent 75th and 25th percentiles; error bars represent the
most extreme values whose distance from the box is less than 1.5 times
the box length; plus symbols are outliers beyond this range. (D) Quantitative
comparison in terms of the Kullback—Leibler divergence (Cover and Thomas,
2006) between reference and non—reference proﬁles.

 

1 802

112 /3.IO'S[BII.IHO[p.IOJXO'SOI]?IIIJOJUIOIQ//Zd11q 111011 pop1201umoq

9IOZ ‘09 lsnﬁnv uo ::

HiTRA CE

 

used for different algorithms. With respect to HiTRACE, the
alternative methodologies produced poorer results, 1.73—3.09 and
1.51—3.94 times higher median MSE and KL divergence values,
respectively.

3.3 Leveraging accurate alignments into accurate
quantiﬁcation

To assess the accuracy of the entire quantiﬁcation procedure,
including alignment, sequence annotation and band deconvolution,
we compared ﬁnal quantiﬁed results between HiTRACE and
previously available software for RNA structure mapping CE data,
using two MedLoop DMS mutate—and—map datasets (Kladwang
et al., 2011) (see also Supplementary Material for a comparison
with the X20/H20 DMS data). Each set contained at least 120
proﬁles with 60 bands, for a total of 7200 data points per set.
(Further comparisons between software packages were precluded
by the difﬁculty of carrying out the analysis with prior software:
ShapeFinder gave poor alignment even after several hours of manual
intervention, and CAFA analysis required 10 h of manual adjustment
for this data set and would have required days for larger data sets.)

The MedLoop sets gave excellent Pearson’s correlation
coefﬁcients between band intensities quantiﬁed with HiTRACE to
those quantiﬁed with CAFA (r of 0.979 and 0.965; Fig. 3A and B),
conﬁrming the lack of any major systematic errors introduced by
the HiTRACE method. We hypothesized that the small, residual
variance between the methods might stem from user—introduced
variation during alignment (CAFA) or sequence assignment of bands
(in CAFA and HiTRACE). To test this hypothesis, we carried out
replicate quantiﬁcation of the same datasets; the second independent
analysis gave values with correlation coefﬁcient (r) to the ﬁrst
analysis of 0.987 and 0.989 (HiTRACE; Fig. 3C and D) and
0.989 and 0.974 (CAFA; Fig. 3E and F). We conclude that any
differences between HiTRACE and CAFA can be explained by
imprecision (variance of 1.1—1.3% in HiTRACE and 1.1—2.6% in
CAFA) introduced by users; this error is much smaller than variances
arising from experimental error, as is discussed in the next section.

3.4 Consistency in band quantiﬁcation between
experimental replicates

A stringent measure of the accuracy of an experiment and
its analysis is the correlation of quantiﬁed intensities between
independent replicates. The goodness of this correlation is
determined by experimental factors, including small variations in
sample purity, pipetting errors, temperature differences and variable
times of each experimental step, and is also sensitive to any
uncertainties arising from the data analysis procedure. We compared
correlation coefﬁcients between separate independent replicates
of the MedLoop DMS mutate—and—map experiments (Kladwang
et al., 2011), quantiﬁed by both HiTRACE and CAFA (Fig. 4A
and B). In both cases, the cross—replicate correlations (0.89—0.90) are
signiﬁcantly lower than the intrareplicate comparisons (0.97—0.99)
above, verifying that variances in experimental procedures exceed
any variances in the data quantiﬁcation.

The throughput of HiTRACE quantiﬁcation enabled us to carry
out this cross—replicate comparison for the additional replicate sets
(see Supplementary Material) and to explore whether alternative
data processing schemes might improve the precision of the
HiTRACE quantiﬁcation. We tested a computationally expensive

 

 

 
 
   

 

 

 

 

 

 

 

  
  
   
   

A B 850
120 Replicate 1 Replicate 2
(A r = 0.9790 2300 r = 0.9650
IL 100 P< 0.0001 u— P< 0.0001
g 5 250
8 80 8 200
“.3 9
to so (U
1: ‘c 150
.9 .9
’5 40 *5
g g 100
20
O 0 50 .-
0 .
0 1:".‘5; , .
0 2o 40 60 80 100 0 50 100 150 200 250 300
Quantified areas (HiTRACE) Quantiﬁed areas (HiTRACE)
c . . . . . D . . . . .
ﬁ120 with HiTRACE a 300 with HiTRA CE
.9 (replicate 1) l) (replicate 2)
3100 r = 0.9865 2250 r = 0.9888
2 P< 0.0001 8 P< 0.0001
s, 80 8200
(I) U)
(U m
‘2 60 ‘2 150
(D (B
‘O ‘0
g 40 .2 100
"E ;, "E
g 20 ":5 g 50
O 5’ O
0 o .
o 20 40 60 80 100 120 140 o 50 100 150 200 560 300 350
Quantified areas (analysis 1) Quantiﬁed areas (analysis 1)
E F
@120 with CAFA a 300 with CAFA
.2 (replicate 1) .1: (replicate 2)
3100 r = 0.9885 - £250 r = 0.9736
2 P< 0.0001 8 P< 0.0001
3’, so ' ' 3200
U) U)
8 8
a 60 ' 5 150
‘o ‘o t
10:3 4° ' 90:3 100
‘8 ‘8 '
20 -  -  .
a a   -_ “543:? I
o 0 ‘5‘“. 

 

 

 

 

 

 

0 20 40 60 80 100 120 0 50 100 150 200 250 300
Quantified areas (analysis 1) Quantiﬁed areas (analysis 1)

Fig. 3. Quantiﬁcation accuracy and precision for HiTRACE and CAFA.
Correlation of HiTRACE and CAFA results for two MedLoop DMS datasets
(A) and (B) conﬁrms the absence of any systematic deviation between the
two approaches. Precision of HiTRACE (C) and (D) is similar or better than
CAFA (E) and (F), based on independent analyses of the same dataset.

band deconvolution procedure [previously used in SAFA (Das
et al., 2005)] that optimized centers of ﬁtted Gaussians for each
individual proﬁle. We observed indistinguishable cross—replicate
correlation coefﬁcients (Fig. 4C) with this procedure as compared
to the the default HiTRACE method (no reﬁnement of band
centers). This comparison further validated the high quality of
the proﬁle—to—proﬁle alignment in earlier HiTRACE steps, and
motivated our choice to make as the HiTRACE default the 10—
to 100—fold faster band—deconvolution procedure without band
center reﬁnement. We observed similarly invariant or slightly
worse correlation coefﬁcients in experiments without the baseline
subtraction procedure; with additional alignment steps of ‘binarized’
proﬁles; and with other methods to automatically reﬁne band
positions in each proﬁle (see Supplementary Material).

3.5 Reduced time demand of quantiﬁcation

Although HiTRACE relies on multiple steps for accurate analysis,
the time demand of quantiﬁcation by HiTRACE was considerably
smaller (a few minutes) than the time required by prior informatic
approaches as well as the time involved in preparing and obtaining
the CE experiments (a few hours). Figure 5 shows the average
running time of HiTRACE for different datasets, along with the
breakdown of the running time. The largest dataset (P4—P6 CMCT;
480 proﬁles and 87 360 bands) took approximately 12min to

 

1 803

112 /810's12u1nofp101x0'sor112u1101urorq//zd11q 111011 pop1201umoq

9IOZ ‘09 lsnﬁnv uo ::

S. Yoon et al.

 

 

 

A 150 . B 150
a? with HiTRACE RT with CAFA
a, r = 0.9036 0, r'= 0.8895
’5 P < 0.001 111' P < 0.001
g 100 g 1 -
D. D. .
9 2
K I
m N
9 9
3 so 2
e .8
“E “E
(U (U
3 :1
O O
o

 

 

 

 

   

 

 

o 50 100 150 0 50 100 150
Quantified areas (replicate 1) Quantiﬁed areas (replicate 1)

0_709 0.710

Correlation coefficient
0
01

.0 .0
N on

O
Ls

 

.0
o

X20/H20 DMS Medloop DMS Medloop CMCT SRP DMS SRP CMCT
Data

Fig. 4. Correlation of results between experimental replicates for
HiTRACE (A) and CAFA (B) for the MedLoop DMS mutate—and—map
experiments (Kladwang et al., 2011), and (C) for HiTRACE on ﬁve replicate
data sets without (black bars) and with (white bars) optimization of Gaussian
positions during band deconvolution.

quantify, and the smaller sets (88—136 proﬁles, 4000—8000 bands)
required 3 min or less. Overall, HiTRACE averaged 1.58 s per
proﬁle from beginning (raw data load—in) to end (quantiﬁed band
intensities). For the same datasets, the overall computational time
of the tools for alignment only (i.e. msalign, SpecAlign and COW)
were between 10 min to 2 h (without peak ﬁtting) depending on the
data size. As discussed above, CAFA and ShapeFinder, the previous
full suites available for nucleic acid CE quantiﬁcation, required even
more time (hours for the smaller datasets, extrapolated to days or
weeks for the larger sets). As shown in Figure 5, the HiTRACE
time breakdown is similar for all datasets, except for the P4—P6
RNA datasets, in which later stages are lengthened by increasing the
number of bands in each proﬁle (200 residues in the P4—P6 RNA,
compared to under 100 residues for the other RNAs). We further
used HiTRACE on datasets with longer RNAs (up to 400 nt) and
involving reverse transcription with primers complementary to the
middle of a long RNA; the HiTRACE procedure was readily applied
to these datasets (see Supplementary Material), and, encouragingly,
the time demand remained linear with the number of bands.

4 DISCUSSION

HiTRACE employs a series of automated techniques to control the
high level of variability in parameters of CE systems and to resolve a
key alignment bottleneck of modern nucleic acid structure mapping
experiments. Several algorithmic advances are responsible for
HiTRACE’s accuracy and speed, including dynamic programming
strategies that have not been been previously considered in the
ﬁeld. Quantitative comparisons on large experimental datasets

 

 

100000 :
' ~10hrs rlw Total running time (HiTRACE)
~,7hrs I Initialization
I Loading files
[I Automatic linear alignment (intra-batch)
10000 _ I Inter-batch alignment and baseline subtraction
3 El Auto-refine alignment (by dynamic programming)
|:| Interactive band annotation
|:| Band deconvolution
I Alternative method (CAFA)

 

 

 

 

 

1000_ 750.9 ----- --748.2 ------ --746.3---
I l—I—I l—I—I l—I—I

' 207.3 203.1
. 165.0 '—I—I '—'—' 141.2 142.3
'—.—I l—I—I l—I—I

Time (s)

 

100: _ ‘ ‘ — 

 

..l. ..

X20/H20 Medloop Medloop SRP SRP P4P6 P4P6 P450
DMS DMS CMCT DMS CMCT DMS CMCT SHAPE

Data

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

Fig. 5. The average running time of HiTRACE on different datasets. The
time was measured on a personal computer system equipped with a 2.66 GHz
Core i5 processor (4 cores; multithreading enabled) with 4 GB RAM.

demonstrate the utility of a linear time—axis transformation used
in globally aligning proﬁles as well as the importance of a
non—linear alignment procedure for resolving further unavoidable
variations in elution rates along a capillary. In addition, an interactive
band annotation interface increases user convenience and provides
accurate starting positions for the subsequent quantiﬁcation step.
These improvements have brought down the overall analysis time
of datasets with tens of thousands of electrophoretic bands from
days to minutes. The largest time savings of the method are on
experiments in which the same RNA sequence is probed under a
variety of solution conditions, chemical modiﬁers, kinetic timepoints
or mutations [see, e.g. (Das et al., 2010; Kladwang and Das,
2010; Kladwang et al., 2011; Mitra et al., 2008; Weeks, 2010;
Wilkinson et al., 2008)]. Now, the slow step in these and other
experiments is interactive band annotation, which takes minutes
(Fig. 5). As more automated band assignment methods are developed
(R.D., unpublished data; P.Pang, M.Elazar, J .S.Glenn, personal
communication), we plan to incorporate them into this interface.

Although we designed HiTRACE primarily for RNA chemical
structure mapping, the principles and premises that underlie
HiTRACE are general and can easily be modiﬁed for use in other
types of experimental assays. To enhance the adoption of this
tool, we have created a stand—alone version of HiTRACE with a
graphical user interface. We are also making the source code freely
available to encourage further innovation and incorporation of these
algorithms into other laboratories’ CE software suites. Beyond the
datasets discussed herein, HiTRACE is continuously being used for
other studies, totalling over 20 000 proﬁles (greater than 2 million
bands) at the time of submission (W.K., R.D., unpublished data; see
also http://rmdb.stanford.edu). Given its accuracy, robustness and
efﬁciency, we expect that HiTRACE will become a valuable tool
for nucleic acid experimentalists entering a high—throughput era of
structural analysis.

 

1 804

112 /810's19u1nofp101x0'sor112u1101urorq//zd11q 111011 pop1201umoq

9IOZ ‘09 lsnﬁnv uo ::

HiTRA CE

 

ACKNOWLEDGEMENTS

The authors thank Dr Alain Laederach at Wadsworth Center for
providing CAFA sample data and members of the Das lab for
comments on the manuscript and extensive testing.

Funding: National Research Foundation of Korea funded by the
Ministry of Education, Science and Technology (Grant No. 2011—
0009963 and No. 2011—0000158 to S.Y. in part); Burroughs—
Wellcome Foundation Career Award at the Scientiﬁc Interface (to
R.D. for computational work in part).

Conﬂict of Interest: none declared.

REFERENCES

Bylund,D. et al. (2002) Chromatographic alignment by warping and dynamic
programming as a pre-processing tool for PARAFAC modelling of liquid
chromatography-mass spectrometry data. J. Chromatogr. A, 961, 237—244.

Cormen,T. et al. (2009) Introduction to Algorithms, 3rd edn. The MIT press, Cambridge,
MA, USA.

Cover,T. and Thomas,J. (2006) Elements of Information Theory, 2nd edn. John Wiley
and Sons, Hoboken, NJ, USA.

Das,R. et al. (2005) SAFA: semi-automated footprinting analysis software for high-
throughput quantiﬁcation of nucleic acid footprinting experiments. RNA, 11,
344—354.

Das,R. et al. (2010) Atomic accuracy in predicting and designing noncanonical RNA
structure. Nat. Methods, 7, 291—294.

Deigan,K. et al. (2009) Accurate SHAPE-directed RNA structure determination. Proc.
Natl Acad. Sci. USA, 106, 97.

Ewing,B. and Green,P. (1998) Base-calling of automated sequencer traces using Phred.
11. Error probabilities. Genome Res., 8, 186—194.

Ewing,B. et al. (1998) Base-calling of automated sequencer traces Using Phred. 1.
Accuracy assessment. Genome Res., 8, 175—185.

Kay,S. (1993) Fundamentals of Statistical Signal Processing: Estimation Theory.
Prentice Hall, Upper Saddle River, NJ, USA.

Kazmi,S. et al. (2006) Alignment of high resolution mass spectra: development of a
heuristic approach for metabolomics. Metabolomics, 2, 75—83.

Kladwang,W. and Das,R. (2010) A mutate-and-map strategy for inferring base pairs in
structured nucleic acids: proof of concept on a DNA/RNA helix. Biochemistry, 49,
7414—7416.

Kladwang,W. et al. (2011) A mutate-and-map strategy accurately infers the base pairs
of an 35-nucleotide model RNA RNA, 17, 522—534.

Laederach,A. et al. (2008) Semiautomated and rapid quantiﬁcation of nucleic acid
footprinting and structure mapping experiments. Nat. Protocols, 3, 1395—1401.

Levenberg,K. (1944) A method for the solution of certain nonlinear problems in least
squares. Quart. Appl Math, 2, 164—168.

Marquardt,D. ( 1963) An algorithm for least-squares estimation of nonlinear parameters.
J. Soc. Ind. Appl. Math, 11, 431—441.

Merino,E. et al. (2005) Advances in RNA structure analysis by chemical probing. J. Am.
Chem. Soc, 127, 4223—4231.

Mitra,S. et al. (2008) High-throughput single-nucleotide structural mapping by capillary
automated footprinting analysis. Nucleic Acids Res., 36, 663.

Nielsen,N. et al. (1998) Aligning of single and multiple wavelength chromatographic
proﬁles for chemometric data analysis using correlation optimised warping.
J. Chromatogr. A, 805, 17—35.

Oppenheim,A.V. and Schafer,R.W. (2009). Discrete-Time Signal Processing, 3rd edn.
Prentice Hall, Upper Saddle River, NJ, USA.

Peattie,D. and Gilbert,W. (1980) Chemical probes for higher-order structure in RNA
Proc. Natl Acad. Sci. USA, 77, 4679.

Pravdova,V. et al. (2002) A comparison of two algorithms for warping of analytical
signals. Anal. Chim. Acta, 456, 77—92.

Robinson,M. et al. (2007) A dynamic programming approach for the alignment of
signal peaks in multiple gas chromatography-mass spectrometry experiments. BMC
Bioinformatics, 8, 419.

Ruiz-Martinez,M. et al. (1993) DNA sequencing by capillary electrophoresis with
replaceable linear polyacrylarnide and laser-induced ﬂuorescence detection. Anal.
Chem, 65, 2851—2858.

Tijerina,P. et al. (2007) DMS footprinting of structured RNAs and RNA—protein
complexes. Nat. Protocols, 2, 2608—2623.

Tomasi,G. et al. (2004) Correlation optimized warping and dynamic time warping as
preprocessing methods for chromatographic data. J. Chemom., 18, 231—241.

Vasa,S. et al. (2008) ShapeFinder: a software system for high-throughput quantitative
analysis of nucleic acid reactivity information resolved by capillary electrophoresis.
RNA, 14, 1979—1990.

Walczak,R. et al. (1996) A novel RNA structural motif in the selenocysteine insertion
element of eukaryotic selenoprotein mRNAs. Curr. Opin. Struct. Biol, 2, 367—379.

Watts,J.M. et al. (2009) Architecture and secondary structure of an entire hiv-l RNA
genome. Nature, 460, 711—716.

Weeks,K. (2010) Advances in RNA structure analysis by chemical probing. Curr. Opin.
Struct. Biol, 20, 295—304.

Wilkinson,K.A. et al. (2008) High-throughput SHAPE analysis reveals structures in
HIV-1 genomic RNA strongly conserved across distinct biological states. PLoS
Biol, 6, e960883—e960899.

Wong,J. et al. (2005) SpecAlign—processing and alignment of mass spectra datasets.
Bioinformatics, 21, 2088—2090.

Woolley,A. and Mathies,R. (1995) Ultra-high-speed DNA sequencing using capillary
electrophoresis chips. Anal. Chem, 67, 3676—3680.

Xi,Y. and Rocke,D. (2008) Baseline correction for NMR spectroscopic metabolomics
data analysis. BMC Bioinformatics, 9, 324.

 

1 805

112 /810's19u1nofp101x0'sor1eu1101urorq//zd11q 111011 pop1201umoq

9IOZ ‘09 lsnﬁnv uo ::

