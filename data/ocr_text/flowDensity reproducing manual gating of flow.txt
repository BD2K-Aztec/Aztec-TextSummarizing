APPLICA TIONS NOTE V3213Zigzagiﬁliio’ifniiii‘éfﬁgi

 

Systems biology

Advance Access publication October 16, 2014

flowDensity: reproducing manual gating of flow cytometry data by
automated density-based cell population identification
Mehrnoush Malekl’l, Mohammad Jafar Taghiyar1 ’1, Lauren Chon93, Greg Finak2,

Raphael Clottardo2 and Ryan R. Brinkman”

1Terry Fox Laboratory, BC Cancer Agency Research Centre, Vancouver, BC V5Z 1L3, Canada,
2Vaccine and Infectious Disease Division, Fred Hutchinson Cancer Research Center, Seattle, WA 98109—1024, USA and
8Bioinformatics Training Program, University of British Columbia, Vancouver, BC V5Z 4S6, Canada

Associate Editor: Jonathan Wren

 

ABSTRACT

Summary: flowDensity facilitates reproducible, high-throughput ana-
lysis of flow cytometry data by automating a predefined manual gating
approach. The algorithm is based on a sequential bivariate gating
approach that generates a set of predefined cell populations. It
chooses the best cut-off for individual markers using characteristics
of the density distribution. The Supplementary Material is linked to the
online version of the manuscript.

Availability and implementation: R source code freely available
through BioConductor (http://master.bioconductor.org/packages/
devel/bioc/html/flowDensity.html.). Data available from Flow
Repository.org (dataset FR-FCM-ZZBW).

Contact: rbrinkman@bccrc.ca

Supplementary information: Supplementary data are available at
Bioinformatics online.

Received on June 18, 2014; revised on August 29, 2014; accepted on
October 12, 2014

1 INTRODUCTION

Flow cytometry (FCM) is the predominant technique used to
identify and quantify the widest variety of cell types. However,
it is widely recognized that FCM data analysis, primarily in the
identification of clusters of homogenous cells in high dimensional
space, has become a rate-limiting step in application of the tech-
nology. Researchers currently use a manually intensive and sub-
jective process of serial inspection of one or two characteristics
(dimensions) at a time (a process termed ‘ gating’). There is wide-
spread demand for the development of software tools as the
ability to organize, analyze and exchange FCM data is lagging
far behind the ability to run samples, to the detriment of health
research (O’Neill et al., 2013). One reason that end-users are still
relying on manual analysis is the absence of a systematic way to
formulate and transfer their expert knowledge to automated soft-
ware in order to provide satisfactory results on hard to gate cell
populations.

Although unsupervised clustering algorithms have been de-
veloped for FCM data, they often fail to replicate a human ex-
pert’s gating results due to their generalized, global approach and

 

*To whom correspondence should be addressed.
TThe authors wish it to be known that, in their opinion, the ﬁrst two
authors should be regarded as Joint First Authors.

often return as a result of a number of clusters that cannot be
interpreted readily without more sophisticated cluster matching
methods (Aghaeepour et al., 2013).

Supervised approaches have also focused on setting global
parameters that are difﬁcult to appropriately set for all clusters
and requiring tuning of parameters that are not linked to re-
searchers’ biological understanding of the data (Hu et al.,
2013; Zare et al., 2010). To address these issues, we developed
ﬂowDensity, an automated gating approach that emulates an
expert’s sequential 2D gating strategy to identify predefined
cell populations using a sequential bivariate gating algorithm.
The innovation of our approach is to use customized threshold
calculations for different cell subsets, based on expert knowledge
of hierarchical gating order and 1D density estimation. Using
this approach, cell populations can be defined once using a
gating strategy as a guide, which also enables clusters to be
easily compared across samples.

2 APPROACH

flowDensity estimates the region around cell populations using
characteristics of the marker density distribution (e.g. the
number, height and width of peaks and the slope of the distri-
bution curve). Parameters can be adjusted on a population-spe-
cific basis when extra information is given by a user (e.g. desired
percentile cut-off, number of standard deviations from the peak).
To pick the proper threshold for each marker within each
sample, ﬂowDensity first finds all the peaks ([9: l, 2, . ..n) in
the density distribution.

(1) If p = 1, the position of threshold can be determined by
tracking the slope of density for a drastic change.
Percentiles, standard deviation and FMO controls can be
used when given as extra information.

(2) If p = 2, the position of threshold is the minimum inter-
section point between the two peaks on the density curve,
unless forced to use methods above (e.g. percentiles, slope
changes).

(3) If p Z 3, for each peak, it calculates the height of the peak

h and its distance from the next adjacent peak d and cal-

culates the score %. It then finds the peak corresponding to

the maximum of all computed scores and chooses this
peak and its next adjacent and goes to the case p = 2.

 

606 © The Author 2014. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com

112 /310's113u1no [p.IOJXO'SOllBIIHOJUTOTQ/ﬁdllq 11101; prBOIIIAAOG

9IOZ ‘09 lsnﬁnv uo ::

flowDensity

 

      

flowDensi result a ainst manual atin
(a)
lumps-.mer H unﬁt-pg
n- u- ' II
1: . 1 1'1 It _
a: 2.,- - L
2.? if: if
:s 5‘; a: 33 a 3
a .1 ﬂ  a
E - E ’1 E -
is we 1
" ' "'I"'I'T""I "I 'F rrrrrr II- ' """" I'
I h | n In I;

 

.1‘

m |n' u' | II |n'
InIII-an: marl Flmml

Hﬂnﬂllmalcﬂil WMI “Eminent

In- all IIH- III-l ll'

     

-¥'!-1i‘!~d*-¥L'|!t.
FEM-1.15M: hI' :'
. . I .

IP-1t:'I'EIaeJ'--:.'I'.".-Lrti."- .a..-5'-I,_-.a.,.;r_,ra Iva-I; -':'E 1"“ ‘="' rrrr .I . rmr.

flowDensity extra parameters
 Using control Tracking slope

Control I ' Stimulated i 'r -. "- 2""
I - h- I I. _ - .Ll'  '
1 I I  1..“-

u— q“. I  n.  II... .3
. _ g .:

I
I" .‘I

 

E _
.An: Aw- ﬁne.-

I
ﬂ:

Using 95th percentile

I'E‘I I-‘~ II'I " .EI'! P5

 

(c) flowDensity performance compared to manual gating
:i
n
-.- HJrnr-tn

,3 in It ﬂnmﬂerllly __" _
é "  A'ullii m Human: J,-
E 3 I
t‘ .
a --  »
D- - _ - _. IL . I_. _ -
u, _ . . f .
E -: - h. .-
0 Fl
x
2 I'll

.1]

II" D  “TI 'u' 1."!
é a a s' s s g"
'— E‘ ._ 2 J 2 .-_

 flowDensity vs. Clustering algorithms

EDIE I'DIWDEIIE-II'I' . '9me

. . _I .
, 1;. at.-.
Li .I. .I ' . '
I;- - " -
_ CD“!- . 2 IL -'+
U
I

I I .
L'L'i ED-l Call-I L'L'A-I-

Sal-'LSF‘EETWL

Cub
I: Lh
IIIL'PI

 

Fig. 1. (a) Comparison of ﬂowDensity result to manual analysis. 0)) ﬂowDensity parameters for handling speciﬁc cases. (c) Comparison of ﬂowDensity
performance in terms of variability with expert’s manual gating. (d) Comparison of ﬂowDensity to state-of—the-art clustering algorithms

2.1 Gating rare cell populations

To address the challenge of identifying rare cell populations,
ﬂowDensity determines whether the slope of the curve of the
density distribution along sections of the curve drops below a
threshold. In rare cases where the slope varies slowly, a percentile
of the density distribution (default 90th) is used as the threshold.
If the spread of the density distribution is mostly around the
mean (i.e. the standard deviation is small relative to the mean),
then slope tracking tends to returns better results than percentile
(Fig. 1b). If neither of these techniques are able to set a proper
threshold, the peak value plus a multiplier of the standard devi-
ation is chosen as the threshold. However, the user can also
modify this decision by setting parameters speciﬁcally for the
challenging cell populations.

2.2 Utilizing control samples

ﬂowDensity can accept control data for each channel used in
gating (Fig. lb). When a control sample is included, the gating
threshold is calculated based on the control population.

3 RESULTS AND DISCUSSION

ﬂowDensity’s completely automated results match that of expert
users when it was possible to set cell population boundaries in a
data-driven manner (Fig. la). For those cell populations where
additional information is required to set the cell population
boundaries according to those chosen by the user, thresholds
are set based on the information (Fig. lb). When no additional
information is given or the population of interest is really small
(~0.04% for a typical FCM data with 300 000 events),
ﬂowDensity might fail to identify a proper gating due to mis-
leading kernel estimation.

ﬁowDensity performs well in the range of human variation
and is close to the average of humans (Fig. 1c). We also com-
pared the ﬁowDensity result with state-of-the-art supervised and
unsupervised FCM analysis tools. Only ﬂowDensity identiﬁed
the correct populations, even though the number of clusters

was given as input and parameters were extensively adjusted
(Fig. 1d and Supplementary Material). This success lies in the
approach, which does not identify all populations by examining
all dimensions simultaneously like typical clustering algorithms.
Rather it can be seen as a sequential algorithm that automates a
2D traditional gating scheme in a data-driven manner highly
suited to targeted investigations such as clinical trials identifying
predeﬁned cell populations. The catch is customization, does
have to be performed once for each marker panel which is sim-
pliﬁed since ﬂowDensity is integrated into the opencyto frame-
work (Finak et al., 2014).

ACKNOWLEDGEMENTS

Thanks to Kelly Lundsten for helpful discussion on using FMO
controls, Jonathan Bramson for control samples, Herve Luche
for mouse data and comments and Mike Jiang for software
review.

Funding: This work was supported by National Institutes of
Health (R01 EB008400), the Human Immunology Consortium
(U19 A1089986) and National Science and Engineering Research
Council.

Conﬂict of interest: none declared.

REFERENCES

Aghaeepour,N. et al. (2013) Critical assessment of automated ﬂow cytometry data
analysis techniques. Nat. Methods, 10, 228—238.

Finak,G. et al. (2014) PLOS computational biology OpenCyto: an open source
infrastructure for scalable, robust, reproducible, and automated end-to-end
ﬂow cytometry data analysis. PLOS Comput. Biol., 10, 61003806.

Hu,X. et al. (2013) Application of user-guided automated cytometric data analysis
to large-scale immunoproﬁling of invariant natural killer T cells. Proc. Natl
Acad. Sci. USA, 110, 19030—19035.

O’Neill,K. et al. (2013) Flow cytometry bioinformatics. PLOS Comput. Biol., 9,
61003365.

Zare,H. et al. (2010) Data reduction for spectral clustering to analyze high through-
put ﬁow cytometry data. BM C Bioinformatics, 11, 403.

 

607

112 /310's113u1no [p.IOJXO'SOIlBIHJOJUIOIQ/ﬁdllq 11101; pSpBOIIIAAOG

9IOZ ‘09 lsnﬁnv uo ::

