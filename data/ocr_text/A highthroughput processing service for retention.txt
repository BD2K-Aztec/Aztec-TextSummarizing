Vol. 27 no. 8 2011, pages 1176-1178
APP S N O  doi:10. 1093/bioinformatics/btr094

 

Systems biology

Advance Access publication February 23, 2011

A high-throughput processing service for retention time
alignment of complex proteomics and metabolomics LC-MS data

Isthiaq Ahmad1’2’3’l, Frank Suits4’l, Berend Hoekman‘, Morris A. Swert22’3’5,

Heorhiy Byelas1’2’5, Martijn Dijkstra1’2’6, Rob Hooft2, Dmitry Katsuboz,

Bas van Breukelen2’3’7, Rainer Bischoffl’z’3 and Peter Horvatovich1’2’3’*

1Analytical Biochemistry, Department of Pharmacy, University of Groningen, Groningen, 2Bioassist, Netherlands
Bioinformatics Centre, Nijmegen, 8Bioinformatics in Proteomics, Netherlands Proteomics Centre, Utrecht,

The Netherlands, 4Protein Science Group, IBM T.J. Watson Research Centre, Yorktown Heights, New York, USA,

5Genomics Coordination Center, Department of Genetics, University Medical Center Groningen, Groningen, 6Center
for Medical Biomics, University of Groningen Groningen and 7Biomolecular Mass Spectrometry and Proteomics

Group, Utrecht University, Utrecht, The Netherlands

Associate Editor: Alfonso Valencia

 

ABSTRACT

Summary: Warp2D is a novel time alignment approach, which uses
the overlapping peak volume of the reference and sample peak
lists to correct misleading peak shifts. Here, we present an easy-
to-use web interface for high-throughput Warp2D batch processing
time alignment service using the Dutch Life Science Grid, reducing
processing time from days to hours. This service provides the
warping function, the sample chromatogram peak list with adjusted
retention times and normalized quality scores based on the sum
of overlapping peak volume of all peaks. Heat maps before and
after time alignment are created from the arithmetic mean of the
sum of overlapping peak area rearranged with hierarchical clustering,
allowing the quality control of the time alignment procedure. Taverna
workflow and command line tool are provided for remote processing
of local user data.

Availability: online data processing service is available at
http://www.nbpp.nl/warp2d.html. Taverna workflow is available
at myExperiment with title ‘2D Time Alignment—Webservice
and Workflow’ at http://www.myexperiment.org/workf|ows/.html.
Command line tool is available at http://www.nbpp.nl/Warp2D_
commandlinezip.

Contact: p.l.horvatovich@rug.nl

Supplementary information: Supplementary data are available at
Bioinformatics online.

Received on September 18, 2010; revised on January 12, 2011;
accepted on February 14, 2011

1 BACKGROUND

Retention time alignment to correct non—linear retention time shifts
(Podwojski et al., 2009) between different chromatograms is a
crucial step in the processing of label—free liquid chromatography

 

*To whom correspondence should be addressed.
lThe authors wish it to be known that, in their Opinion, the ﬁrst two authors
should be regarded as joint First Authors.

coupled to mass spectrometry (LC—MS) data for proteomics and
metabolomics comparative proﬁling studies. A complex ‘omics’
chromatogram contains signals from thousands of compounds, and
small shifts may lead to improper matching of peaks that are
derived from the same compounds leading to inaccurate statistical
analysis and possibly to erroneous conclusions on the experimental
outcome (Christin et al., 2008, 2010; Suits et al., 2008). We have
recently published a novel time alignment algorithm, Warp2D (Suits
et al., 2008), that is based on correlation optimized warping (COW)
(Christin et al., 2008; Nielsen et al., 1998; Tomasi et al., 2004;
van Nederkassel et al., 2006) to maximize the total peak volume
overlap between the reference and sample chromato grams using LC—
MS peak lists as input data. The peaks in these LC—MS peak lists
are considered as three—dimensional Gaussian peaks in the retention
time, mass to charge ratio and intensity space. Peak widths in the
retention time and mass to charge ratio are related to the mass and
chromatographic resolutions, and analytical formula can be derived
to calculate the individual peak volume and peak volume of the
overlap of multiple peaks. Overlap of multiple peaks is used in the
beneﬁt function of the COW procedure in Warp2D (Suits et al.,
2008) to drive the retention time correction. By considering the
overlap of three dimensional Gaussian peaks, Warp2D takes account
for the separation of peak in mass dimensions beside the separation
of the peaks in the retention time dimension when correcting for non—
linear retention time shifts. The concept of Warp2D is fundamentally
new compared with other time alignment methods either using one—
dimensional mass traces (Eilers, 2004; van Nederkassel et al., 2006)
in their beneﬁt function, peak lists of multiple chromatograms with
local regression techniques (Podwojski et al., 2009), algorithms
using a two—dimensional beneﬁt function such as a Hidden Markov
Model combined with a Continuous Proﬁle Model (Listgarten et al.,
2007) or the recently introduced COW—CODA (Christin et al., 2008),
PTW—CODA and DTW—CODA (Christin et al., 2010) algorithms
combining COW, dynamic time warping (DTW) (Kassidas et al.,
1998) and parametric time warping (PTW) (Eilers, 2004) with a
Component Detection Algorithm (CODA) (Christin et al., 2008). We
previously showed that Warp2D can successfully align peak lists of
chromatograms obtained from complex serum and urine samples,

 

1176 © The Author 2011. Published by Oxford University Press. All rights reserved. For Permissions, please email: journals.permissions@oup.com

112 /§.IO'SIBUJHOprOJXO'SOTlBIHJOJUlOlCI/ﬁdnq U101} popnommoq

9IOZ ‘091sn8nv uo ::

Retention time alignment

 

A

LobE_Mplu:E‘fS_PIo5Io1tTRMI'IF_rIDrm-HI_R1 3: I
Labi_Mpu=E"r'S_Pro:laleTRﬁMF_lu-nbr_ﬁ1 3: I
:l.ohl_hﬂ:lu:CY5_Br:o=lChooo§1_nn-rnal_ﬂ1 3:
Ldﬂ_h’1:|LnC'1"S_Hr:alel'uo:|osl'_1u'n:t_R1 3:
me_h1:lly3¥$_LurgEGFﬂ_no-mal_ﬂ1 3:
Lah2_ﬂnﬂ$_ﬁrmaslchorlnm_nml_ﬁ1 3:
Lah2_mF|5_El-reaslcl'odosl'_lum_ﬂl 3K:

 
 

24x24_Lab1_Lat-2 unwarped

   

til? MARE: DJFUEGFH r1li R1 3::

Lab: MARS ProalalaTRPMF‘ Iu'mh' R1 3:
Ld12_hMH.5_LurngEGF“R_ILrntr R1_3-:
Lab2_hh'uR5_Pro:latETFlNu'lF_normul R1_3:
Lab?_h'g:|urﬁTE_LongEGFR_lu'n:t R1_3:
L:u1_MM$_Ern-o:l¢ho:lnsm_nnmal FILE:
Lao!_MFl$_LungEGFR_nml R1_3:
La:1_huFl.S_Lurn;EGFR_ILrn:r R1_3:
LatILmHﬁ-jreaslcl'omsmm H'ch
LabLMﬁHSJ‘MSIEﬂE-TFMMFJWI “LEG
Lam,IMARSHFroalalaTRnﬁMFPIum-rnﬁ1,3:
1.311_W|uﬂCﬁ_ErEﬂ5lCMﬂDBﬂ_ﬂI:-’Iml_ﬁLR:
L311_WILHCTE_HJMEICMWEP‘IW_R1_3G
Ld:1_hhlm-C‘I"S_b.ngGFR_nnrrml_R1_3:

Lab1_hh|LmC"f'E_LungEGFﬂ_lu'n:t_R 1_3:
Lab1_Mplu:Ej-‘r'S_Pro:latIrTRNﬂP_nmrul_R 1_3:
Lam_I.lpust'r'S_Prool-allaIHPMl-‘_1u'ncr_lil'|_:iac

#IEIHI‘SIEEI‘SIalglﬁlﬁlﬁlglalﬁlﬁlﬁlijlﬁlglﬁlﬁl‘hjl‘ﬁlﬁl
EII'IIEIEIIIIEIElﬁlmlmlmlﬁlﬁclmlmlml-xlulE i: E I'IIIIIIII
iii—mi Tung iaﬁﬁEE—ha'a'ﬁ'aﬁg
Eﬁgﬁggjgigsﬁggaagﬁﬁiiﬁﬁa
EIJZIEIEI IE| IEInllxltlnﬁlElEllxl IEIELIEIEIEIEIEI I
ittttiittﬁtittittfgtﬁgg
gﬁgiﬂgﬁﬁﬁéiﬁggégiﬁegﬁﬁiﬂ
img‘i 24.3.;ng "um'2"“§w"m'§§
gnu thma— 3.?“ EEE moo}. ._
ﬂ p—iﬂ-Im I ligand: guillﬁ main-I
aralgdmigﬁlsai “Igaraalg
Drug? g I g'ﬂgn .F'gﬂg Bruin?
Eizl‘igglﬁgiﬂggg-EE IEZEIE'EEII'EE
a — _n r ._ ‘— IFE ._"—‘
EQEEEEa i 33$ ﬁgﬂﬁflﬁﬁili.

—I|:"I —I _l —I I—ﬂ ‘ 1—
%3 3.1 EE gﬁ

 

24:24_Lal:r1_Lal:2 warped

    

Lab2_M|hu5C-T5_PM313IEITRM1P_nm|_R1_3C:
Lab2_MpLI5E'r'S_ProstaluTFlmF_1u'nn'_H 1_3:
LnbﬂJI'pIu5131‘S_Hr:olll:hooon_nmul_Fl 1_3o
Lm2‘_h’u|LuC‘f‘S-_E|rouulCl'uIJo5lI_1u1llx_Fl1_3:
Lah?_hhlLaCl-I"‘5_L JrngEGFR_nurrnol_Fl1_3:
l:h?_HAR$_BrooslﬁroIo:'1_non-nal_ﬁ1 2|:
Lmi_MFlS_Broa=lGl-.o:l:lsh_1u'nor_Fl1_3:
Lnl12_H.|1.RS_L .IngEGFR_nnn'nal_R 1_3:
|_ah2_MAFlE_F'rosralaTRFMFJMDLFI'I_ .
Lm2_WH5_LurIgEC-FF|_1WU_H1_3¢
LamﬁﬁﬁjmstoleTRN-lﬂnmmalj LEI!
LBEMNuﬁCﬁ_LurrnEG-FR_1LI’I1IT_R LS:
Lab1_MPﬂ3_EreeaLErodom_no-rmal_ﬁ 1_3:
LEI‘_M°.R5_LJWEGFRNHWI_R1,3B
LE£I1_MHR5_LuI'rgEE-Fﬁ_lwnnr_ﬁ 1 _3:
LHJ3_MR5_BFBHHLC1'DEIJEIL_1LI1IIJ'_R1_3l:
Lab1_h1ARS_Pro:laleTRquF_nmal_Fl1_3:
Lab1_WLRS_Pro5talnTR.WF_1u-nnr_Fl1_3:
L:l:|1_hﬁ:|u5CH'5_Ernu5|Cradnm_nuTI-H:II_R1_3:
Laol_hhlLuC‘f$_Brna:lGl1-oﬂ:lsh_1u‘nor_ﬁ1_3:
|.ob1_h'|:lLuI3"r'$_LJngEGFR_non'nal_R1_3:
Lab1_h'blmﬂ‘f$_LLngEGF H_1LI'11|.T_H1_3C

Lab'l _|'I1P'|.-|5C 'FS_Prt:Isr-al19 I HWFJWHBLH Lam
I411:1_Mp|..nu'rajmsrnlnTnmrUmm-j 1_.'-m

 

##5##:##3##Hﬁﬂﬁﬁéiﬁﬁlcl‘HIJ-4l 3-4.

.— F F F F F F F F F F F F F — — F r.—.—-.—.—-.-.—

II
ll._lll|_l|l|

Fl!
F!
F!
R
R
F!
H
Fl.
R
Fl
Ft
Ft
Ft

Fan-Hal Fl.
HP normal Ft _
Fl!_F|orrna| Ft _
mhlumor

Jao'l MRS ProslanaTRﬁMP normal

5 ﬂroatﬂhodooh ron'nal_

E lurnor Ft _
R tumor R
Ft_nor'11:

R lumo

Lab? HARE- Hrcarfﬂhndnoh lumor_R

l ah2_th:|3'I'$-_LLHQE GFFl_lun1o

lam MARﬁ mouthwash nor-11:

Inh‘l Mill-IS FroslamIHAﬂF Mm

QEGF

Lia? MARE ProslaboTRAMF' normo

QEGF
QEGF
Lam “155$ HIRE:de

$_| mgF GF
Emmtllhodnoh lurnor

Lah1 M511

5 Broabﬁhodooh I'Iln'llll Fl.
vs Praguth lum-or R

LabT MARE. LLu1

Lab: MARS Lun

Lab: Mantis. Lu-1

pisll‘f'

Lah1_ﬂpu5|3"r'5

Lao ' _Hpu:l3‘|‘$_LuogEEFFt_lumor

Lahﬂ_ﬂpu:l:.'r'ﬁ_Lu-Ij|3FFl
Lab? I'IMRS Breatﬂhndcoh normal Fl! _
Llh1_llh:u:|:."r'5_Lu1ﬁl3FFl_I-uon'nal

Lao2_MplLaﬂ‘r$_Pro:llloTH.ﬂ.

Lab 1_MplLu'EY$_P1-nslaln FMHJ-‘_mrmal
Lab1_Mpu:CYS_F'ms-13taTl-HHF_MW

Lab2_Mpu=l:‘l"
Lab2_l.11:u:E-‘r'$_ﬂmoatllhodos
LatEJI'Ip-IJIE

Lat-1 M

Fig. 1. Heat map showing the arithmetic mean of the overlapping peak volume calculated before (A) and after (B) time alignment using all possible alignment
pairs between 24 chromatograms (576 time alignments) obtained in an experimental design study of a shotgun proteomics analysis of mouse serum (higher is
better). Rearranging the order of the reference and sample peak lists using hierarchical clustering of the obtained quality scores after time alignment provides
an overview over clusters with peak lists of high similarity, for which time alignment was successful. In this example, chromatograms obtained within the
same laboratory form separate clusters, indicating that time alignment is only successful between ﬁles from the same laboratory using the applied parameters
(mzwidth 0.1; rtwidth 0.2; Window size 50; Slack 20; Max peaks/segment 50; N0. of time points 2000; Cons. time shift 0).

even if compounds in these samples have large concentration
variability with maximum 3—5 min of retention time shifts.

Here, we report development of a high—throughput processing
service to perform time alignment and quality assessment based
on the Warp2D approach. This service is able to perform several
hundreds of time alignments per hour for a large number of users
by using the Dutch Life Science Grid (DLSG) through an easy—
to—use web interface available at the portal of the Netherlands
Bioinformatics for Proteomics Platform.

2 EASY-TO-USE WEB PAGE FEATURES

Warp2D uses space—delimited ASCII peak lists with three columns
containing the mass to charge ratio, retention time and peak quantity
(height, area or volume). We have chosen this simple format because
there is no accepted standard format to store LC—MS peak list.
European Bioinformatics Institute is preparing the szuantML
standard format for preprocessed LC—MS data such as peak lists
and aligned peak matrix (Orchard et al., 2010) and currently the
APML format introduced in Corra (Brusniak et al., 2008) LC—MS
data processing framework is the only available format to store this
type of data. We have, therefore, developed a tool that converts LC—
MS peak lists in APML format to our format and placed the converter
as java command line tool at http://www.nbpp.nl/warp2d.html. As
soon as the new ofﬁcial szuantML format will be available, we
will provide the possibility to use data in this format. The full
parameter list, input/output ﬁle formats with detailed explanations,
tutorial and example dataset used in this application note are
available at the web page of the Warp2D processing service
(http://www.nbpp.nl/warp2d.html).

Warp2D generates three output ﬁles: the warped sample
chromatogram peak lists with .wpks extension, the .tmap ﬁle
containing the segment endpoint pairs in the time unit of the
original peak list before and after time alignment and the quality ﬁle
with .qual extension containing all parameters and quality scores
reﬂecting the similarity of the reference and sample peak lists
before and after time alignment. Since the .tmap ﬁle contains the
retention time transformation of the sample chromatogram segment,
one can use it to calculate any retention time shift by linear
interpolation within the corresponding time segment. Details on the
quality score and the most important parameters are provided in the
Supplementary Material.

3 TAVERNA WORKFLOW AND COMMAND LINE
OPTION

The web user interface provides a convenient easy—to—use access
to the high—throughput Warp2D LC—MS time alignment service.
This application is build on a web service, and to facilitate the
reuse of this web service programmatically by bioinformaticians, we
developed a Taverna (Hull et al., 2006) workﬂow and command line
java tool (supporting material and http://www.nbpp.nl/warp2d.html,
the web page contains a detailed description of these tools). These
tools enable simple remote processing of data located on a user’s
computer, automating the process of sending data to and from the
grid computational resource. These tools allow the incorporation of
the Warp2D LC—MS time alignment service into Taverna pipeline or
in any other program or script while having the beneﬁt of the vast
processing power of the DLSG

 

1177

112 /§.IO'SIBUJHOprOJXO'SOIlBIHJOJUIOICI/ﬁdnq 11101; prBOIUAAOG

9IOZ ‘09 lsnﬁnv uo ::

I.Ahmad et al.

 

4 CASE STUDY AND CONCLUSIONS

Figure 1 presents two heat maps before and after time alignment
showing the arithmetic mean of the sum of overlapping peak volume
for 24 chromatograms obtained in an experimental design study to
measure proteins quantity in serum from different mouse cancer
models, treated with different depletion techniques, measured in
different laboratories with different Quadrupole Time Of Flight
mass spectrometers, from healthy mice or mice with cancer using
a shotgun proteomics approach. The order of ﬁles was rearranged
using hierarchical clustering of the arithmetic mean of the sum of
overlapping peak area in order to identify chromatogram clusters
with high similarity. The quality of the heat maps in Figure 1
indicates that chromatograms acquired within the same laboratory
can be successfully aligned. The quality matrix that served for the
heat maps can be used to select the best reference chromatograms
for the ﬁnal time alignment (e.g. the peak list having the highest
quality score after time alignment) for the two peak list clusters.
The user—friendly web interface destined for users with little
bioinformatics experience allows the use of the Warp2D approach
for alignment of large numbers of complex LC—MS chromatograms
and provides an overview on the ﬁle clusters which can be
successfully aligned within a given dataset. Execution time with
regular settings of one alignment using peak lists of 5 MB containing
200 000 non deisotoped and non—decharged peaks takes 8—12 min on
a regular PC (Intel® CoreTM Quad CPU Q9300 @ 2.5 GHz processor
and 8 GB of RAM), while 576 time alignments of 24 peak lists took
40—70 min using our web portal depending on the availability of the
DLSG computational resources. The same number of alignments on
a PC with single or four processing nodes would take 4 days or 1
day, respectively. The processing service includes free access to 10
GB of disk space to store the initial peak lists and processing results.

Funding: Bioassist program of the Netherlands Bioinformatics
Center (reference NBIC/KvH/ff/2007.049); NWO (Rubicon

Grant 825.09.008); Netherlands Proteomics Center 11 (reference
NPC II E4.2) for ﬁnancing this research and SARA for providing
access to DLSG

Conﬂict of Interest: none declared.

REFERENCES

Brusniak,M.Y. et al. (2008) Corra: computational framework and tools for LC-MS
discovery and targeted mass spectrometry-based proteomics. BMC Bioinformatics,
9, 542.

Christin,C. et al. (2008) Optimized time alignment algorithm for LC-MS data:
correlation optimized warping using component detection algorithm-selected mass
chromatograms. Anal. Chem, 80, 7012—7021.

Christin,C. et al. (2010) Time alignment algorithms based on selected mass traces for
complex LC-MS data. J. Proteome. Res., 9, 1483—1495.

Eilers,P.H. (2004) Parametric time warping. Anal. Chem, 76, 404—411.

Hull,D. et al. (2006) Taverna: a tool for building and running workﬂows of services.
Nucleic Acids Res., 34, 729—732.

Kassidas,A. et al. (1998) Synchronization of batch trajectories using dynamic time
warping. AIChE J., 44, 864—875.

Listgarten,J. et al. (2007) Difference detection in LC-MS data for protein biomarker
discovery. Bioinformatics, 23, e198—e204.

Nielsen,N.P.V. et al. (1998) Aligning of single and multiple wavelength
chromatographic proﬁles for chemometric data analysis using correlation optimised
warping. J. Chromatogr. A, 805, 17—35.

Orchard,S. et al. (2010) Tackling quantitation: a report on the annual Spring Workshop
of the HUPO-PSI 28-30 March 2010, Seoul, South Korea. Proteomics, 10,
3062—3066.

Podwojski,K. et al. (2009) Retention time alignment algorithms for LC/MS data must
consider non-linear shifts. Bioinformatics, 25, 758—764.

Suits,F. et al. (2008) Two-dimensional method for time aligning liquid chromatography-
mass spectrometry data. Anal. Chem, 80, 3095—3104.

Tomasi,G. et al. (2004) Correlation optimized warping and dynamic time warping
as preprocessing methods for chromatograpic data. J. Chemometrics, 18,
231—241.

van N ederkassel,A.M. et al. (2006) Acomparison of three algorithms for chromatograms
alignment. J. Chromatogr. A, 1118, 199—210.

 

1178

112 /§.IO'SIBUJHOIPJOJXO'SOIlBIIIJOJUIOIQ/ﬁdnq 11101; popeoIII/vxoq

9IOZ ‘09 lsnﬁnv uo ::

