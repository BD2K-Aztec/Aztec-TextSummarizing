ORIGINAL PAPER

Vol. 28 no. 24 2012, pages 3225—3231
doi: 10. 1093/bioinformatics/bts613

 

Sequence analysis

Advance Access publication October 16, 2012

Reference-independent comparative metagenomics using

cross-assembly: crAss

Bas E. Dutilh1’2’3’*, Robert Schmieder2’4, Jim Nulton5, Ben Felts5, Peter Salamon5,

Robert A. Edward82’6 and John L. Mokili3

1Centre for Molecular and Biomolecular Informatics, Nijmegen Centre for Molecular Life Sciences, Radboud University
Medical Centre, 6525 GA Nijmegen, The Netherlands, 2Department of Computer Science, 3Department of Biology,
4Computational Science Research Center and 5Department of Mathematics, San Diego State University, San Diego, CA
92182, USA and 6Division of Mathematics and Computer Science, Argonne National Laboratory, IL 60439, USA

Associate Editor: Michael Brudno

 

ABSTRACT

Motivation: Metagenomes are often characterized by high levels of
unknown sequences. Reads derived from known microorganisms
can easily be identiﬁed and analyzed using fast homology search
algorithms and a suitable reference database, but the unknown
sequences are often ignored in further analyses, biasing conclusions.
Nevertheless, it is possible to use more data in a comparative meta-
genomic analysis by creating a cross-assembly of all reads, i.e. a
single assembly of reads from different samples. Comparative meta-
genomics studies the interrelationships between metagenomes from
different samples. Using an assembly algorithm is a fast and intuitive
way to link (partially) homologous reads without requiring a database
of reference sequences.

Results: Here, we introduce crAss, a novel bioinformatic tool that
enables fast simple analysis of cross-assembly files, yielding distances
between all metagenomic sample pairs and an insightful image dis-
playing the similarities.

Availability and implementation: crAss is available as a web server
at http://edwards.sdsu.edu/crassl, and the Perl source code can be
downloaded to run as a stand-alone command line tool.

Contact: dutilh@cmbi.ru.nl

Supplementary information: Supplementary data are available at
Bioinformatics online.

Received on February 20, 2012; revised on September 24, 2012;
accepted on October 11, 2012

1 INTRODUCTION

The sequencing of environmental samples has disclosed a uni-
verse of novel microbial organisms. Microbiologists and Virolo-
gists are sequencing DNA and RNA from environments ranging
from coral reefs to the human gut and are discovering previously
unknown microorganisms in all these samples (Mokili et al.,
2012). The fraction of unknown sequences can be particularly
high in Viral metagenomes because (i) Viruses exhibit relatively
high mutation rates resulting in distant unrecognizable
homology (Bonhoeffer and Sniegowski, 2002), and (ii) this

 

*To whom correspondence should be addressed.

superkingdom has remained poorly explored, with relatively
few sequences present in the databases. These properties hinder
the comparison of metagenomic samples with high percentages
(up to 60—99%) of unknowns (Mokili et al., 2012) by traditional
methods that map sequencing reads to known annotated refer-
ences (Meyer et al., 2008).

In addition, the abundance and diversity of Viruses in natural
systems impede comparisons between metagenomic datasets,
especially when comparing relatively short reads generated by
some second-generation sequencing platforms. A promising
solution is to initially combine the different metagenomes and
perform a de novo assembly of all sequence reads. If applied
conservatively to avoid chimerization, metagenome assembly
can reliably link reads that are completely unknown to reads
that have similarity to annotated sequences.

The tool PHAge Communities from Contig Spectra
(PHACCS) assesses the biodiversity of uncultured Viral commu-
nities by mathematically modeling the community structure
using the contig spectrum of metagenome assemblies (Angly
et al., 2005). PHAge Communities from Contig Spectra was ex-
tended to assess cross-assemblies in a tool called Maxigo (Angly
et al., 2006). Because they do not rely on a database with refer-
ence sequences, these tools provide an approach for comparing
complete metagenomes, even if they contain a high fraction of
unknown sequences.

Here, we present crAss, a novel more direct approach based on
the same concept, i.e. using cross-assembly of reads from differ-
ent metagenomes to assess the degree of similarity between the
sampled communities. Thus, cross-metagenome assembly
enables a sensitive comparison of entities that are shared between
samples, including Viruses with no homology to known
sequences. Unlike previous methods, crAss calculates a pairwise
distance score between metagenomes and creates an insightful
image to display these distances graphically. Moreover, a cross-
assembly combines short sequencing reads into longer contigs
that may be more suitable for annotation. For example, down-
stream analyses could include sensitive homology searches
(Soding, 2005), RNA structure detection (Hofacker and
Stadler, 2006) and prediction of alternative genetic codes
(Dutilh et al., 2011).

 

© The Author(s) 2012. Published by Oxford University Press.

This is an Open Access article distributed under the terms of the Creative Commons Attribution License (http://creativecommons.org/licenses/by/3.0), which permits
unrestricted use, distribution, and reproduction in any medium, provided the original work is properly cited.

112 ﬁhO'smumo[pJOJXO'sopemJogurorq/ﬁd11q IIIOJJ pepeolumoq

910K ‘09 lsnﬁnV no :2

B.E.Dutilh et al.

 

2 METHODS
2.1 General approach

First, the user will combine the reads from all metagenomic datasets to be
compared into a cross-assembly, i.e. a single assembly from two or more
metagenomes. Note that it is important that all reads have unique iden-
tiﬁers across all the datasets combined. Cross-assembly can be done with
a de novo assembly tool of choice such as gsAssembler (Margulies et al.,
2005), MIRA (Chevreux et al., 2004) or Velvet (Zerbino and Birney,
2008). We note that it is beyond the scope of this article to evaluate the
performance of the different assembly tools and all the possible parameter
settings (Lin et al., 2011), although it seems that assembler settings opti-
mized for sequence fragments, such as expressed sequence tags (ESTs),
may perform better than assembler settings optimized for complete gen-
omes (see Supplementary File 2). The basic idea is that an assembly
program will link metagenomic reads derived from the same biological
source to one another in a well deﬁned way. The resulting contigs may be
interpreted as ‘metagenomic entities’ or traits that are shared between the
sampled environments. The results shown later to illustrate crAss were
generated using gsAssembler (Margulies at al., 2005) with default param-
eters, but the user can achieve similar results with alternative assembly
tools.

The crAss program takes as input the individual read ﬁles (one per
metagenome) in Fasta or Fastq format, as well as the ACE ﬁle that
contains the information about the assembled contigs. We note that the
user can strip the potentially privacy-sensitive sequence information from
these ﬁles before uploading, as is explained on the crAss help page.
Examples of input ﬁles for crAss analysis, including a simpliﬁed toy ex-
ample, are available through the crAss web site (http://edwards.sdsu.edu/
crass). For every contig, crAss counts the number of reads derived from
each metagenome and determines whether the contig is shared between
two or more samples (cross-contig). The degree of relatedness between
two metagenomes is calculated from this information according to four
distance formulas (see later).

The output of crAss consists of (i) a list of all contigs showing how
many reads from each metagenome it is composed of (for reference, this
list includes the identiﬁers of the unassembled singleton reads, which are
not used in the distance calculations), (ii) a symmetrical distance matrix
for each distance formula that contains the distances between all pairs of
metagenomes, and (iii) an image that summarizes the similarities between
the metagenomes (see Section 3). If the user combined two or three
metagenomes, the image will be an XY-plot or an XYZ-plot, respectively,
visualized using Gnuplot. 3D analyses are also presented as a triangle
plot. Note that a user can use the data in the contig list to create other
visualizations. If the user combined more than three metagenomes, there
will be one image for every distance formula, showing a cladogram cre-
ated on the basis of the respective distance matrix using BioNJ (Gascuel,
1997), and visualized using Drawtree version 3.68 from the Phylip pack-
age (Felsenstein, 1989).

2.2 Distance formulas

Comparison tools like Maxigo (Angly et al., 2006) parametrize the deform-
ation necessary to morph one metagenome into another. crAss uses a
single dimension, a distance, for the comparisons. There are always many
ways to deﬁne distances between given sets of numbers. In crAss, the
distance between all pairs of metagenomes is calculated using four pos-
sible distance formulas. The ﬁrst is Equation (1), a formula that has been
used to correct for genome size when calculating phylogenetic distances
between species (Dutilh et al., 2004; Dutilh et al., 2007; Korbel et al.,
2002). It is used here to correct for metagenome size when calculating
distances between samples.

Equation 1. Distance formula ‘SHOT’ (Korbel et al., 2002) used for
calculating the distance dij between metagenomes i and j based on the
number of contigs c, and cj that contain reads from these metagenomes,

respectively, and the number of cross-contigs cm- with reads from both
metagenomes.

C,"
1_ 5.]

(ﬁ-ci-cj)/< clz+cjz

 

do =

The idea of this formula is to normalize the similarity signal ciJ- for
metagenome size by dividing by an appropriate mean value of c, and C], in
this case the square of the geometric mean divided by the root mean
square. As we will see, this mean is never far from the minimum of c,-
and C], min{c,~,cj}. Therefore, when 6, and cj are far apart in value, the
signal ciJ- is not attenuated by dividing by a larger number than necessary.
It is instructive to rewrite the second term in Equation (1) as follows
[compare with Equation (4)]:

CL]

(J26,- -cj)/<1/c,2 +612)

Here, the similarity measure is seen as the root mean square of the
separately normalized quantities cij/c, and cij/cj. In this form, it is easy to
see that we have the following inequality:

2 2
1 Chi ciJ CLJ'
2 c,- cj mm{c,-, Cj}

 

 

        
 

   

CL]

x/E ' min{c,-, Cj} —

A

This points to the second distance metric, where we normalize the
similarity signal cl-J- for metagenome size by dividing by the smaller of
the two metagenomes.

Equation 2. Distance formula ‘minimum’ used for calculating the dis-
tance dij between metagenomes i and j based on the number of contigs c,
and cj that contain reads from these metagenomes, respectively, and the
number of cross-contigs cij with reads from both metagenomes.

dw- = 1 — 
mm{c,-, Cj}

Both Equations (1) and (2) are presence/absence-based formulas. They
assume that the presence of a contig or metagenomic trait in a sample (i.e.
the contig contains at least one read from that sample) is more inform-
ative than its abundance. In our experience, such a qualitative compari-
son can give insightful information for comparing metagenomes because
the number of reads assembled into a contig may not always reﬂect a
truly random sample from the community metagenome, owing to biases
that may result at the sampling, sequencing or assembly level. However,
we also include two more qualitative distance measures, where the
number of reads is assumed to reﬂect the abundance of the contig in
the environment. In the ﬁrst, we index the complete set of observed
contigs by k=1,...,n, and let rk, denote the number of reads in contig
k from metagenome i. We assume that the fraction of reads from meta-
genome i that are incorporated into contig k.

_ _ rki
pk; — 2721 mi
is a measure of the relative importance of contig k to metagenome i, and
that the probability vector (or distribution)

Pi = (1911', H-apni)

characterizes the metagenome i. Wootters has proposed a natural statis-
tical measure of distance between probability distributions (W ootters,
1981) that is closely related to distance measures associated with the
names of Fisher and Amari (Amari, 1982). It is based generally on the
minimum number of jumps that is required to get from one distribution
to another, where a jump is a statistical ﬂuctuation typical of a ﬁnite
sample from the distribution. The distance is normalized in such a way
that it is independent of the sample size used to establish a statistical

 

3226

112 ﬁhO'smumo[pJOJXO'sopemJogurorq/ﬁd11q wort pepeolumoq

910K ‘09 lsnﬁnV no :2

Comparative metagenomics using cross-assembly: crAss

 

ﬂuctuation. This Wootters metric can be adapted to reﬂect the distance
between metagenomes as follows.

Equation 3. Distance formula ‘Wootters’ (Wootters, 1981) used for
calculating the distance dij between metagenomes i and j based on the
fraction of reads pk, and pk]- from these metagenomes, respectively, that
are incorporated into contig k.

2 n
dw- = Ecos—1 (Z W)
k=1

As it may be expected that longer contigs attract more reads from
unrelated metagenomes by chance, we include a fourth distance formula
that mirrors Equation (1), but is based not on the fraction of
cross-contigs but on the fraction of reads assembled into cross-contigs.
Like Equation (3), this is a quantitative comparison that accounts for
skewed read distributions in contigs and corrects for biases, e.g. owing to
differences in contig length.

Equation 4. Distance formula ‘reads’ used for calculating the distance
dij between metagenomes i and j based on the number of reads r, and r]-
from these metagenomes, respectively, that are incorporated into contigs,
and the number of reads rm and rjj from these metagenomes, respectively,
that are incorporated into shared cross-contigs.

 

Each of the four distance formulas that crAss offers is mathematically
natural for the structure of the data. Our expectation is that each will
prove useful for revealing interrelationships of particular sorts. Just which
metric will be most suitable for which type of comparison will teach us
about the structure of these relationships. We invite users to share their
experience on the SEQanswers user forum (Li et al., 2012), available
through the crAss web site, and let future users know which distance
formula they found useful or useless for their particular application.

2.3 Real data

To illustrate the use of crAss for reference-independent comparative
metagenomics, we selected three sets of viral metagenomes sequenced
using the GS FLX system (Lopez-Bueno et al., 2009; Nakamura et al.,
2009; Rosario et al., 2009). We used viral metagenomes because they are
more challenging than microbial metagenomes because of the high di-
versity and large fraction of unknown sequences. Table 1 shows the 15
samples from these publications that we used as test data for crAss. All
reads were preprocessed using a pipeline including cross_match (http://
www.phrap.org/) to remove possible vector contamination, TagCleaner
(Schmieder et al., 2010) to remove sequencing tags, PRINSEQ
(Schmieder and Edwards, 2011b) to ﬁlter low quality, short and dupli-
cate sequences and DeconSeq (Schmieder and Edwards, 2011a) to
remove human-like sequence contamination. The details of the prepro-
cessing pipeline are available at http://edwards.sdsu.edu/mymgdb/. We
then combined the 15 datasets into a single cross-assembly using
gsAssembler 2.6 (Margulies et al., 2005) with default parameters.
Finally, we uploaded the individual raw reads ﬁles, as well as the
ACE ﬁle resulting from the assembly, to the crAss web server to pro-
duce the presented results.

2.4 Simulated data

We tested the performance of the different distance formulas in crAss
using simulated metagenomic samples created from completely sequenced
bacterial genomes. Genomes between 2 and 6 Mb in length representing
the phyla Actinobacieria (n = 77), Firmicutes (n = 154) and Proieobacieria
(:2 =280) were selected from RefSeq (Pruitt et al., 2012), choosing one
genome per species to avoid redundancy (Supplementary File 1). We then

Table 1. Viral metagenomic datasets used to illustrate the use of crAss for
reference-independent comparative metagenomics

 

Dataset Reference

 

Antarctic spring lake viral metagenome (Lopez-Bueno

Antarctic summer lake viral metagenome et al., 2009)
Human fecal sample N1 viral metagenome (Nakamura
Human fecal sample N2 viral metagenome et al., 2009)

Human fecal sample N3 viral metagenome

Human fecal sample N4 viral metagenome

Human fecal sample N5 viral metagenome

Human nasal sample F1 viral metagenome

Human nasal sample F2 viral metagenome

Human nasal sample F3 viral metagenome

Reclaimed efﬂuent freshwater DNA viral metagenome (Rosario
Reclaimed efﬂuent freshwater RNA viral metagenome et al., 2009)
Reclaimed Nursery freshwater DNA viral metagenome

Reclaimed nursery freshwater RNA viral metagenome

Potable freshwater DNA viral metagenome

 

created several sets of simulated metagenomes using Grinder 0.4.5 (Angly
et al., 2012) with realistic pyrosequencing parameters: read
length=450:l:100nt, and 2% sequencing errors, of which 85% were
substitutions and 15% were indels; homopolymeric errors were included
according to the Balzer model (Balzer et al., 2011).

Three experiments were carried out (Supplementary File 1). First, we
investigated the effect of decreasing species overlap by creating 32 simu-
lated metagenomes of 30 species each. Samples ov00 and ov01 contained
the same thirty F irmicutes, and in every subsequent sample (ov02—ov31),
we randomly replaced one of the Firmicutes by a Proteobacterium. Each
sample was cross-assembled with ov00 to determine how the similarity
score depends on the species overlap.

Second, we investigated the effect of varying species abundance. We
created ten simulated metagenomes containing the same 10 Firmicutes
genomes, but with different logarithmic species distributions (in ﬁve
pairs, see Supplementary File 1). These 10 samples were cross-assembled
together.

Third, we investigated the sensitivity for detecting similar (but not the
same) species (either Aciinobacieria or Firmicuies) against a background
of noise from a third phylum (Proteobacteria). We created 11 sets of
samples, each consisting of nine metagenomes. Three of those contained
25 or 26 randomly selected (but different) Actinobacteria, and six
contained 25 or 26 Firmicutes. Within these metagenomes, the
Aciinobacieria or Firmicutes ‘signal’ was contaminated with an increasing
percentage of Proteobacteria ‘noise’, sampled uniformly from the 280
genomes. The species distributions in all these samples are described in
Supplementary File 1, and the results from these experiments are pre-
sented in Supplementary File 2.

2.5 Short k-mer proﬁles

Short k-mer proﬁles have previously been used as an alternative approach
for reference-independent comparative metagenomics, where a length of
k: 2 was shown to yield the best separation (Willner at al., 2009).
Distances dij between metagenomes i and j were calculated from k-mer
proﬁles as:

1 . * .
did 2 T6 Elﬁn/(l) — Ion/(1)1,
XY

 

3227

112 [glO'SIBILInO[p.IOJXO'SODBIIIJOJIIIOIQ/ﬂ(11111 111011 pep1201umoq

910K ‘09 lsnﬁnV no 2:

B.E.Dutilh et al.

 

where X Y are the dinucleotides, and the dinucleotide odds ratio )0?” is
calculated from the corrected frequencies fg‘” (forward and reverse aver-
aged) as follows (Karlin and Mrazek, 1997; Willner et al., 2009):

,2: :&
XY 

2.6 Reference mapping

We compared the performance of crAss with a reference mapping ana-
lysis. All reads were queried by blastn 2.2.25+ (Camacho et al., 2009)
(default parameters, E—value 50.001) to the Genbank non-redundant nu-
cleotide database (nt, October 19th, 2011) and assigned to the taxonomic
clade of their closest hit. Read counts were divided in case of draws and
iteratively summed for all parent clades as explained previously
(Trindade-Silva et al., 2012). Distances between datasets were calculated
as one minus the correlation coefﬁcient of the resulting taxonomic
distributions.

3 RESULTS

It is expected that metagenomes from a similar environment
share a larger fraction of microbial or viral species than meta-
genomes from different origins. These shared ‘metagenomic enti-
ties’ can be reconstructed by cross-assembly of the metagenomes
and analyzed and visualized using crAss. The contigs that link
two samples (cross-contigs) directly represent the similarity be-
tween those samples. If most contigs are composed of a mix of
reads from different samples, then it may be concluded that there
are many shared entities among those samples. Conversely, if
contigs are predominantly composed of reads from either one
of the samples, but there are few cross-contigs, these samples are
highly dissimilar in composition.

3.1 Simulation experiments

To evaluate the performance of each of the distance formulas
and compare cross-assembly with existing approached for com-
parative metagenomics, we created several simulated metagen-
omes by sampling reads from completely sequenced bacterial
genomes (Supplementary File 1).

First, we investigated a sequence of samples with decreasing
species overlap by creating 31 simulated datasets of 30 species
each (ov01—ov31); the ﬁrst contained 30 Firmicutes, and one of
those was replaced by a Proteobacterium in each subsequent
dataset. Each of these was cross-assembled with another dataset
of 30 Firmicutes (ov00, which was sampled from the same species
as ov01, see Supplementary File 1). As shown in Figure l, the
distance to sample ov00 decreases with increasing species overlap
for all distance formulas. As a result of the assembly parameters
in Newbler, which are optimized for complete genome assembly,
the curves show a non-linear response of the distance score to the
degree of species overlap. For comparison, the second tab in
Supplementary File 2 shows MIRA (Chevreux et al., 2004)
assemblies optimized for either complete genomes (tries to
build long contigs) or ESTs (allows shorter fragments), which
shows a more linear response. Indeed, the EST parameters
might be more appropriate for metagenome assembly as well.

Second, we investigated the effect of varying species abun-
dance by creating ﬁve pairs of simulated metagenomic samples
with different logarithmically distributed species abundances

 

  
 
 
   
  

— SHOT
0'9 _ — Minimum
0.8 - Reads

<= Wootters
........ : Dinucleotides

Distance to simulated sample ovOO
O
01
I

 

 

 

I I I I
0 0.2 0.4 0.6 0.8 1
Species overlap with simulated sample ovOO

Fig. 1. Distance between 31 simulated metagenomic samples with
increasing species overlap, and simulated sample ov00 (see
Supplementary File 1 for species distributions). Distances were calculated
using the four crAss distance formulas; the ﬁfth line shows the distance
based on dinucleotide odds ratios Willner et al., 2009). See Section 2 for
details

(see Supplementary File 1 for species distributions). As shown
in Supplementary Figure S1, all distance formulas cluster the
correct sample pairs together. Interestingly, the quantitative dis-
tance formula ‘Wootters’ [Equation (3)], as well as the dinucleo-
tide odds ratios Willner et al., 2009), captures the connection
between the clusters (ab03, ab04) and (ab05, ab06), which both
have the highest fraction of Bacillus weihenstephanensis KBAB4
reads (70%, see Supplementary File 1), and subsequently cluster
(ab07, ab08), with 21% B.weihenstephanensis KBAB4 reads. In
contrast, the qualitative distance formulas ‘SHOT’ [Equation (1)]
and ‘minimum’ [Equation (2)] do not capture these connections,
nor does the ‘reads’ formula [Equation (4)].

Third, we evaluated the sensitivity of crAss for detecting dif-
ferent species from the same phylum in the face of increasing
levels of noise. Simulated metagenomic samples were created
from the complete genomes of 511 species (see Supplementary
File 1 for species distributions). Three metagenomes contained
25 or 26 different Actinobacteria each, and six metagenomes con-
tained 25 or 26 different Firmicutes each. These nine datasets
were contaminated with 0—100% noise in the form of simulated
reads from Proteobacteria genomes. The results of this analysis
show that crAss can separate the Actinobacteria from the
Firmicutes metagenomes, with up to 80% Proteobacteria con-
tamination (70% for the distance formula ‘minimum’, see Fig.
2). As expected, the approach based on dinucleotide odds ratios
also separates Firmicutes (also known as low G+C
gram-positive bacteria) from Actinobacteria (or high G+C
gram-positive bacteria), even when contaminated with up to a
90% Proteobacteria reads.

To summarize, crAss clusters metagenomes containing differ-
ent species from the same phylum in the face of high levels of
noise derived from identical contaminating species sets.
Moreover, the length of the branch that separates these groups
decreases with the decrease in signal for all distance formulas
(Fig. 2), showing that crAss can sensitively identify the degree
of similarity between samples.

 

3228

112 ﬁhO'slcumo[pJOJXO'sor112u1101urorq//2d11q 111011 pep1201umoq

910K ‘09 lsnﬁnV no 2:

Comparative metagenomics using cross-assembly: crAss

 

 

0'45 2'5 l SHOT (0 - 0.45 axis)
04 - l Minimum (0 - 0.45 axis)
Reads (0 - 0.45 axis)
ElWootters (0 - 0.45 axis)
:‘JDinucleotides (0 - 2.5 axis)

0.35— 2' I I
0-3- 55 E5 ,—-

1.5_ II II :'
0.25- :: :: :5 r:
0.2- :5 :5 :5 i: 1'5
1' i i i 'i E: r:
0.15- ' ' I ' -- -
0.1—  i E E i E '

Branch length Firmicutes-Actinobacteria

 

 

 

 

 

0.05—   g   illli..nii_ii is

0—
0 10 20 30 40 50 60 70 80 90 100
% Noise (Proteobacteria)

 

 

Fig. 2. In cladograms of nine simulated metagenomes, those containing
Aciinobacieria (n = 3) mostly form a separate cluster from those contain-
ing Firmicutes (n = 6; Supplementary Fig. S2). The length of the separat-
ing internal branch is plotted with increasing Proteobacteria
contamination, until the Actinobacteria and Firmicutes metagenomes no
longer form separate clusters, and there is no internal branch. See text for
details. The clado grams created by crAss are available in Supplementary
Figure S2

3.2 Comparing publically available viral metagenomes

crAss visualizes the similarity between metagenomes in different
ways depending on the number of metagenomes combined in the
cross-assembly. Two or three samples will be displayed as an
XY-plot or an XYZ—plot, respectively, showing the number of
reads combined into each of the contigs. 3D analyses are also
presented as a triangle plot. Figure 3 displays an illustrative ex-
ample of a cross-assembly between three metagenomes, showing
shared and non-shared contigs. Contigs composed solely of reads
from a single metagenome will be plotted along the axes, as only
one metagenome will have a non-zero value. In the example
shown in Figure 3, there are 76 contigs that contain only reads
from the fecal N1 sample, 338 contigs with only fecal N2 reads
and 152 contigs with only nasal F 1 reads. Furthermore, this plot
shows that 176 of the 230 cross-contigs lie in the bottom plane,
indicating that they contain reads from both the fecal samples
but not from the nasal sample. Only 24 contigs contain reads
from all three metagenomes. These details are available in the
crAss output ﬁle output.contigs2reads.txt, which can be down-
loaded, e. g. for alternative visualization in a program of choice.
The results illustrate, as expected, that the fecal samples are more
similar to one another than either of them are to the nasal
sample.

More than three metagenomes cannot be easily visualized in
such a plot, so when more than three datasets are used, crAss
outputs a cladogram that shows the similarities between samples.
The cladogram is calculated from the distance matrix using
BioNJ (Gascuel, 1997), and crAss outputs a different one for
each of the four distance formulas. Moreover, we present two
versions of each cladogram, a version with branch lengths that
represent the distances between the samples and one where the
branch lengths are ignored. This may be useful if the differences
between metagenomes are much more pronounced than the simi-
larities, leading to short internal branch lengths.

The latter cross-assembly uses 53.1 :l: 26.6% of the reads from
the 15 metagenomes for the comparison. A comparative

  
   
 

  
  

m 2 .
E100 '<> ‘H 0' '
E E i. 8
g 3 <> <>
2 3
C10.—
(U I
E I
3 -
I _

1<

 

 

Fig. 3. Cross-assembled metagenomic reads from one human nasal
sample and two human fecal samples. Each gray diamond represents a
contig. The X, Y and Z coordinates indicate the number of incorporated
reads from the metagenomes mentioned along the axes. Note that zero
values are set to 0.9 so they can be displayed on the logarithmic plot.
Small black dots are the projections of the diamonds onto the planes, but
superimposed for visibility. A triangle plot of the same data is also avail-
able. These graphs can be retrieved at http://edwards.sdsu.edu/crass/
under Job ID 1329506771

metagenomic analysis based on blastn mapping of the reads to
the Genbank reference database uses 45.9 :l: 43.1% of the reads,
slightly less and with a much wider spread because of the differ-
ence in the eight human versus seven water samples (84.3 :l: 9.5%
and 1.9 :l: 1.7% reads mapped, respectively, see Supplementary
Fig. S3A). Human-associated microbes have traditionally been
abundant in the databases, whereas microbes from other biomes
remain underrepresented. Although a cladogram based on the
correlation coefﬁcient of the taxonomic distributions of these hits
(see Section 2) shows some clustering of biomes (Supplementary
Fig. S3B), it is not as accurate as the crAss analysis in Figure 4.
Water samples occur in separate clusters, and the human nasal
samples are separated from human fecal samples. We suspect
that this is a long-branch attraction artifact, caused by the
water samples, which are unlike any of the other samples,
being pushed to the center of the cladogram.

4 DISCUSSION

Determining the interrelationships between metagenomes from
different biomes or different time points is important to under-
stand the microbial world around us. Mapping metagenomic
sequences to a reference database of known genes is a feasible
approach to transfer taxonomical and functional annotations to
sequence reads. However, it can limit the amount of data that
can be analyzed because the majority of the sequencing reads in
difﬁcult-to-annotate datasets, such as viral metagenomes from
biomes other than the human microbiome, lack known homo-
logs (Mokili et al., 2012). A promising alternative is reference-
independent comparative metagenomics.

We present crAss, an intuitive approach for comparative
metagenomics that calculates a similarity signal using shared
entities, which are identiﬁed by cross-assembly. The tool does

 

3229

112 ﬂJO's112umofpleXO'sor112u1101urorq//2d11q 111011 pep1201umoq

910K ‘09 lsnﬁnV no 2:

B.E.Dutilh et al.

 

.03
(U
E
U)
¢’%o 9 < g-
9» 6. "‘ 2 Q
as / '0 K
0 3 a) CC ,9
7’ 6’0 E “ ‘3 «
63¢ 42 '5 5 s (5&0
4’72 ‘7 06’ a 3 éb 5‘
<9, ’52,, ‘1’ 5': :1: 59°
0’; $2: I “J a *9
% a r
4 9
so (86‘ Q
0% 6‘ 99$
9 k
$1 . -
ec aimed freshwater
Antarctic lake summer Effluent DNA

    
    

Human fecal N3 Human nasal F3

   

o
\“6 a: 0’90
a
’16 c 0,9
“$03 a 09/
“ g E % c;
S a ’13» a“
e o a “é
0 G.) ’h /
9g "- 1.0 e“
c C ° \°
(2,. (U 9}
5° § ¢
~2~ I ’P

Fig. 4. Cladogram representing the distance between metagenomes based
on the fraction of cross-assembled contigs between all sample pairs. crAss
creates this cladogram from a distance matrix using BioNJ (Gascuel,
1997) and visualizes it using Drawtree (Felsenstein, 1989). This cladogram
was based on Equation (1). The complete output for this dataset, includ-
ing distance matrices and cladograms based on the other distance for-
mulas, can be retrieved at http://edwards.sdsu.edu/crass/ under Job ID
1329505996

not depend on homology of the sequenced reads to any known
sequence in a reference database, or even on full-length hom-
ology of the reads to one another. Assembly algorithms, such
as those used to create the ACE ﬁles required for crAss analysis,
identify shared subsequences (long or signature k-mers) between
reads to assemble them (Li et al., 2011). Because it relies on a
different similarity signal, this long k—mer approach is comple-
mentary to the use of short k—mer proﬁles (Ghosh et al., 2011;
Willner et al., 2009).

We expect that Equations (1) and (2) can be applied for quali-
tative comparisons between environments because they only take
the degree of shared entities (cross-contigs) into account.
Conversely, Equations (3) and (4) will be more suited for quan-
titative comparisons because they consider the read counts as a
measure of abundance. Although limited in scope, our current
results based on analyses of simulated metagenomic samples sug-
gest that the distance formula ‘Wootters’ [Equation (3)] may
outperform the other formulas for detecting both qualitative
and quantitative signals, with similar performance as the com-
parisons based on dinucleotide odds ratios Willner et al., 2009).
Nevertheless, it is difﬁcult to predict which of the distance for-
mulas presented in this article will be the most suitable for which
biological application. That is why we have created a user forum
at SEQanswers (Li et al., 2012), available through the crAss web
site, where we hope that users will share their experiences and
any publications that use crAss.

An additional advantage of using cross-assembly is that the
sequences of biological entities, which are shared between speciﬁc
samples, are simultaneously assembled. Based on the results

obtained using simulated data (Supplementary File 2), we
expect that fragment assemblers developed for ESTs, such as
MIRA, or specialized metagenome assemblers will be more suit-
able for cross-metagenome assembly than assemblers like
Newbler, which are optimized for single-genome assembly.

If the parameters of the assembly program are set to strict
values to avoid chimerization, tentative taxonomic annotations
may be transferred between reads that are linked within one
contig. We recommend using parameter settings that the user
is comfortable with for metagenomic assembly, but it should
be noted that the resulting crAss cladogram is based on a simi-
larity score between entire metagenomes, which limits the effect
of possibly rare chimerical sequences. Moreover, chimerization
may be problematic between closely related species, but less
severe for more distant organisms. Thus, although they will
add some noise to the similarity signal, chimeras are more
likely to link reads from biomes that are already similar, alleviat-
ing errors in the ﬁnal cladogram. To address the issue of poten-
tial chimerization, we recommend creating separate
cross-assemblies and crAss cladograms with stringent and per-
missive assembly parameters, which will lead to fewer and more
chimerical contigs, respectively. The resulting cladograms can
then be compared to evaluate the effect of chimerization on
the cross-assembly analysis. In general, we have seen that the
cladogram rarely changes with altered assembly parameters, indi-
cating that crAss is a robust approach for comparative
metagenomics.

Funding: NSF Division of Biological Infrastructure grant
0850356 and Division of Environmental Biology grant 1046413
(to R.A.E.). Dutch Science foundation (NWO) Veni grant
016.111.075 (to B.E.D.).

Conﬂict of Interest: none declared.

REFERENCES

Amari,S.-I. (1982) Differential geometry of curved exponential families-curvatures
and information loss. Ann. Stat, 10, 357—385.

Angly,F. et al. (2005) PHACCS, an online tool for estimating the structure and
diversity of uncultured viral communities using metagenomic information.
BM C Bioinformatics, 6, 41.

Angly,F.E. et al. (2006) The marine viromes of four oceanic regions. PLoS Biol., 4,
e368.

Angly,F.E. et al. (2012) Grinder: a versatile amplicon and shotgun sequence simu-
lator. Nucleic Acids Res., 40, e94.

Balzer,S. et al. (2011) Systematic exploration of error sources in pyrosequencing
ﬂowgram data. Bioinformatics, 27, i304—i309.

Bonhoeffer,S. and Sniegowski,P. (2002) Virus evolution: the importance of being
erroneous. Nature, 420, 367, 369.

Camacho,C. et al. (2009) BLAST+: architecture and applications. BM C
Bioinformatics, 10, 421.

Chevreux,B. et al. (2004) Using the miraEST assembler for reliable and automated
mRNA transcript assembly and SNP detection in sequenced ESTs. Genome
Res., 14, 1147—1159.

Dutilh,B.E. et al. (2004) The consistent phylogenetic signal in genome trees revealed
by reducing the impact of noise. J. Mol. Evol., 58, 527—539.

Dutilh,B.E. et al. (2011) FACIL: Fast and Accurate Genetic Code Inference and
Logo. Bioinformatics, 27, 1929—1933.

Dutilh,B.E. et al. (2007) Assessment of phylogenomic and orthology approaches for
phylogenetic inference. Bioinformatics, 23, 815—824.

Felsenstein,J. (1989) PHYLIP—Phylogeny Inference Package (Version 3.2).
Cladistics, 5, 164—166.

 

3230

112 /810's112umofpleXO'sot112u1101utotq//2d11q 111011 papeolumoq

910K ‘09 lsnﬁnV no 2:

Comparative metagenomics using cross-assembly: crAss

 

Gascuel,0. (1997) BIONJ: an improved version of the NJ algorithm based on a
simple model of sequence data. Mol. Biol. Evol., 14, 685—695.

Ghosh,T.S. et al. (2011) HabiSign: a novel approach for comparison of metagen-
omes and rapid identiﬁcation of habitat-speciﬁc sequences. BMC Bioinfor-
matics, 12 (Suppl. 13), S9.

Hofacker,I.L. and Stadler,P.F. (2006) Memory efﬁcient folding algorithms for cir-
cular RNA secondary structures. Bioinformatics, 22, 1172—1176.

Karlin,S. and Mrazek,J. (1997) Compositional differences within and between eu-
karyotic genomes. Proc. Natl Acad. Sci. USA, 94, 10227—10232.

Korbel,J.O. et al. (2002) SHOT: a web server for the construction of genome
phylogenies. Trends Genet., 18, 158—162.

Li,J.W. et al. (2012) SEQanswers: an open access community for collaboratively
decoding genomes. Bioinformatics, 28, 1272—1273.

Li,Z. et al. (2011) Comparison of the two major classes of assembly algorithms:
overlap-layout—consensus and de-bruijn-graph. Brief. Funct. Genomics, 11,
25—37.

Lin,Y. et al. (2011) Comparative studies of de novo assembly tools for
next-generation sequencing technologies. Bioinformatics, 27, 2031—2037.

Lopez-Bueno,A. et al. (2009) High diversity of the viral community from an
Antarctic lake. Science, 326, 858—861.

Margulies,M. et al. (2005) Genome sequencing in microfabricated high-density
picolitre reactors. Nature, 437, 376—380.

Meyer,F. et al. (2008) The metagenomics RAST server - a public resource for the
automatic phylogenetic and functional analysis of metagenomes. BM C
Bioinformatics, 9, 386.

Mokili,J.L. et al. (2012) Metagenomics and future perspectives in virus discovery.
Curr. Opin. Viral, 2, 1—15.

Nakamura,S. et al. (2009) Direct metagenomic detection of viral pathogens in nasal
and fecal specimens using an unbiased high-throughput sequencing approach.
PLoS One, 4, e4219.

Pruitt,K.D. et al. (2012) NCBI Reference Sequences (RefSeq): current status, new
features and genome annotation policy. Nucleic Acids Res., 40, D130—D135.
Rosario,K. et al. (2009) Metagenomic analysis of viruses in reclaimed water.

Environ. Microbiol, 11, 2806—2820.

Schmieder,R. and Edwards,R. (2011a) Fast identiﬁcation and removal of sequence
contamination from genomic and metagenomic datasets. PLaS One, 6, e17288.

Schmieder,R. and Edwards,R. (2011b) Quality control and preprocessing of meta-
genomic datasets. Bioinformatics, 27, 863—864.

Schmieder,R. et al. (2010) TagCleaner: identiﬁcation and removal of tag sequences
from genomic and metagenomic datasets. BM C Bioinformatics, 11, 341.

Soding,J. (2005) Protein homology detection by HMM-HMM comparison.
Bioinformatics, 21, 951—960.

Trindade-Silva,A.E. et al. (2012) Taxonomic and functional microbial signatures of
the endemic marine sponge Arenosclera brasiliensis. PLoS One, 7, e39905.
Willner,D. et al. (2009) Metagenomic signatures of 86 microbial and viral metagen-

omes. Environ. Microbiol, 11, 1752—1766.

Wootters,W.K. (1981) Statistical distance and Hilbert space. Phys. Rev. D, 23,
357—362.

Zerbino,D.R. and Bimey,E. (2008) Velvet: algorithms for de novo short read as-
sembly using de Bruijn graphs. Genome Res, 18, 821—829.

 

3231

112 /810's112umofpleXO'sot112u1101utotq//2d11q 111011 papeolumoq

910K ‘09 lsnﬁnV no 2:

