APPLICA TIONS NOTE V3333;3%géiii’éiifr3i‘iiciﬁﬁg

 

Genome analysis

Advance Access publication January 7, 2013

BroadPeak: a novel algorithm for identifying broad peaks

in diffuse ChlP-seq datasets

Jianrong Wang‘, Victoria V. Lunyak2 and I. King Jordan

1,3,*

1School of Biology, Georgia Institute of Technology, Atlanta, GA 30332, USA, 2Buck Institute for Age Research, Novato,
CA 94945, USA and 3PanAmerican Bioinformatics Institute, Santa Marta, Magdalena, Colombia

Associate Editor: Michael Brudno

 

ABSTRACT

Summary: Although some histone modification chromatin immunopre—
cipitation followed by high-throughput sequencing (ChlP-seq) signals
show abrupt peaks across narrow and speciﬁc genomic locations,
others have diffuse distributions along chromosomes, and their large
contiguous enrichment landscapes are better modeled as broad peaks.
Here, we present Broad Peak, an algorithm for the identification of such
broad peaks from diffuse ChlP-seq datasets. We show that BroadPeak
is a linear time algorithm that requires only two parameters, and we
validate its performance on real and simulated histone modification
ChlP-seq datasets. BroadPeak calls peaks that are highly coincident
with both the underlying ChlP-seq tag count distributions and relevant
biological features, such as the gene bodies of actively transcribed
genes, and it shows superior overall recall and precision of known
broad peaks from simulated datasets.

Availability: The source code and documentations are available at
http://Jordan.biology.gatech.edu/page/software/broadpeak/.

Contact: king.jordan@biology.gatech.edu

Supplementary information: Supplementary data are available at
Bioinformatics online.

Received on June 22, 2012; revised on November 30, 2012; accepted
on December 21, 2012

1 INTRODUCTION

Chromatin immunoprecipitation followed by high-throughput
sequencing (ChIP—seq) technology has been used to produce
genome-wide maps for a variety of histone modiﬁcations in a
number of different cell types (Barski et al., 2007; Ernst et al.,
2011; Wang et al., 2008). One of the most critical ChIP—seq data
processing steps is peak calling, i.e. the identiﬁcation of contigu-
ous genomic regions that are signiﬁcantly enriched with
ChIP—seq tags when compared with the genomic background
tag count distribution (Park, 2009). Although numerous compu-
tational methods that can reliably identify narrow histone modi-
ﬁcation peaks have been developed (Laajala et al., 2009; Park,
2009), there are fewer methods for calling broad peaks (Song and
Smith, 2011; Zang et al., 2009). Here, we describe BroadPeak, a
distinct approach for calling broad peaks in diffuse ChIP—seq
datasets, and apply the algorithm to both real and simulated
datasets to evaluate its performance.

 

*To whom correspondence should be addressed.

2 METHODS

Algorithm overview: The basic idea of BroadPeak is to assign appropriate
positive scores to high-tag sites and negative scores to low-tag sites (i.e. gaps)
and then to model the broad peaks as segments with maximal cumulative
scores (maximal scoring segments) along chromosomes (Supplementary
Figs S1 and S2). This is an adoption of the maximal-segment algorithm,
which has most often been applied for sequence comparison (Karlin and
Altschul, 199 3). In additionto providing an optimal solution for peakcalling,
the use of the maximal-segment algorithm has the advantages of requiring
fewer parameters and only linear-time complexity for computation
(Supplementary Methods and Supplementary Fig. S2).

Problem formulation: The genome under consideration is divided into
small non-overlapping bins of a user-deﬁned size (6. g. 200 bp), and each bin
is assigned with a ChlP-seq tag count. The bins are ﬁrst classiﬁed into
high-tag and low-tag bins based on a tag count threshold derived from
the standard tag count Poisson distribution (which is parameterized by
the genomic average bin tag count A). Each high-tag bin is then assigned
with a positive score s1, and each low-tag bin is assigned with a negative
score S; The cumulative score from bin i to bin j is the sum of the scores of
individual bins between i and j. Maximal scoring segments are segments
with maximal cumulative scores, i.e. the cumulative scores will decrease if
the segments extend to longer segments or shrink to shorter segments. Thus,
identiﬁcations of maximal scoring segments are equivalent to setting the
boundaries of broad peaks with the locally highest spatial densities of
high-tag bins (Supplementary Fig. S2).

Scoring and parameters: The positive and negative scores described
earlier in the text (.9; and s2) need to be carefully designed to obtain
reasonable peaks. Based on the theorems proved by Karlin and
Altschul (Karlin and Altschul, 1990), the optimal scoring scheme consists
of the log likelihood ratios: s1=ln(p/q) and s2=ln[(1 —p)/(I—q)],
where p is the estimated spatial density of high-tag bins in real broad
peaks and q is the genomic background spatial density. Thus, 1) and q are
the only parameters needed for BroadPeak. One important feature of this
scoring scheme is that, when the segment lengths are large, the spatial
densities within the resulted maximal scoring segments will approximate
the real target density p (Karlin and Altschul, 1990). This feature theor-
etically supports the validity of the ﬁnal identiﬁed broad peaks, as their
compositions of high-tag bins will resemble real peaks, and it also sug-
gests that the gaps will be adaptively allowed based on the data, namely
the target and background densities.

To accurately estimate the target density p, BroadPeak provides
two options: supervised and unsupervised estimations (Supplementary
Fig. S1). For supervised estimation, the user needs to provide a list of
regions that are enriched with broad peaks based on a priori knowledge
(e.g. highly transcribed gene bodies for H3K36me3 parameter estima-
tion). For unsupervised estimation, BroadPeak ﬁrst uses a sliding
window approach to obtain an initial set of regions showing spatial
density changes and model the occurrence of high-tag bins as
non-homogeneous Poisson processes with change points (Raftery and
Akman, 1986). Conjugate gamma prior distributions are built, and a

 

492 © The Author 2013. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com

112 ﬁrespaumo[progx0'sorrnmrogurorw/2dnq urorr pepnolumoq

910K ‘09 lsnﬁnV uo ::

BroadPeak

 

Gibbs sampling algorithm (Robert and Casella, 2004) is applied to esti-
mate p and q (Supplementary Methods).

Peak identiﬁcation: BroadPeak applies the linear time Ruzzo—Tompa
algorithm (Ruzzo and Tompa, 1999) to search for all maximal scoring
segments (Supplementary Figs S1 and S2). For each maximal scoring
segment, the observed spatial density of high-tag bins is compared with
the background using a z—test, and only the segments with signiﬁcantly
higher densities (P<0.05) are added to the ﬁnal broad peak list.

3 PERFORMANCE EVALUATION

To evaluate the performance of BroadPeak, we ﬁrst applied the
algorithm to the analysis of ChIP—seq datasets of histone modiﬁca-
tions from human CD4+ T cells (Barski et al., 2007). Visual inspec-
tion of the called broad peaks shows that they are much consistent
with the underlying diffuse ChIP—seq tag count distributions
(Fig. 1A and B, Supplementary Fig. S3). For H3K36me3 and
H3K79me2, the called broad peaks are also highly coincident
with the locations of gene bodies (Fig. 1A), consistent with their
known roles as marks of transcriptional elongation (Barski et al.,
2007). Closer inspection reveals that the locations of the called peaks
for these two marks relative to gene bodies are distinct; H3K79me2
peaks are enriched at and downstream of transcriptional start sites,
whereas H3K36me3 peaks are enriched upstream and at transcrip-
tional termination sites (Fig. 1C). These results are also consistent
with the known biological roles of these modiﬁcations.
Additional biologically relevant results can be seen for the
called H3K27me3 peaks (Fig. 1B). H3K27me3 is thought to
mark repressive chromatin domains, and the edges of the
broad peaks called for this mark are enriched for binding sites
of the CTCF protein (Fig. 1B and D, Supplementary Fig. S4),

A chr1 :865691 67-87359085

H3K79me2
broad peaks ‘

“AMIMWINMUMMJHLM mM-mmuilmmlmlimmmmiﬂhﬁmi
W m w ' ea

Refseq W

B chr3:37270958-39212846

H3K27mes ;_Lh.MMWWMIIﬂWWLMWMW

broad peaks —

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 i Hi l l Illl
‘I il l  i. ..i. 1 mi. till” I | i iIJ I II 1 I | u | iiil ill

Refseq -llI-Illlllh-tl-0HHlllH—H-l—lll-|l-H I—HlllllllH-IIt-Hl-IIHIIII-iHI-II-IIIHIIIF lllHIi-l HHll-l-l Ill-ll

c D m

3 8 —H3K79me2 .. (\i'—H3K27me3

cu -- H3K36me3 g —CTCF

CD 0 o

Q. E --

‘tl— - c N

0 3 .2

c -- E we

g o- a) 1— .

E §. 3 0--
—2'o T'ss TT's +éo — oo edge edge +200
kb kb kb kb

Fig. 1. Performance evaluation of BroadPeak. (A) Examples of broad
peaks of H3K79me2 and H3K36me3 identiﬁed by BroadPeak compared
with the underlying ChIP-seq tag counts. (B) Examples of broad peaks of
H3K27me3 identiﬁed by BroadPeak and CTCF binding proﬁles. (C)
Relative distributions of broad peaks of H3K79me2 and H3K36me3
around gene bodies. (D) Enrichments of CTCF bindings around the
edges of large H3K27me3 broad peaks (>200 kb)

which is known to be related to the activity of chromatin insu-
lators and barriers (Cuddapah et al., 2009). Weaker enrichments
are also observed for called broad peaks of the H3K9me3
(Supplementary Fig. S5). Similar performances are shown
when the algorithm is run in supervised and unsupervised
modes for H3K36me3 (Supplementary Methods and Supple-
mentary Fig. S6).

We further evaluate the performance of BroadPeak using three
separate simulated ChIP—seq tag datasets, which correspond to a
set of predeﬁned (i.e. known) broad peaks (Supplementary
Methods). This approach was used to allow for a controlled
comparison of results obtained from BroadPeak versus results
from the existing methods MACS, SICER and RSEG (Song and
Smith, 2011; Zang et al., 2009; Zhang et al., 2008). For each
method tested, the ability to identify known broad peaks from
simulated tag datasets was quantiﬁed using precision and recall.
For all three simulated datasets, BroadPeak achieves substantial
improvements on recall (Supplementary Table S1) while main-
taining good precision (albeit slightly lower than seen for MACS
and SICER). Overall, BroadPeak shows the highest value for the
harmonic mean of recall and precision (F score). Finally,
BroadPeak appears particularly well suited for calling large
peaks as can be seen from the more contiguous characterization
of known large peaks from the simulated datasets
(Supplementary Fig. S7) and the relatively broader distribution
of called peak sizes (Supplementary Fig. S8).

Funding: Alfred P. Sloan Research Fellowship in Computational
and Evolutionary Molecular Biology [BR-4839 to J .W. and
I.K.J.]; Buck Institute Trust Fund (to V.V.L.).

Conﬂict of Interest: none declared.

REFERENCES

Barski,A. et al. (2007) High-resolution proﬁling of histone methylations in the
human genome. Cell, 129, 823—837.

Cuddapah,S. et al. (2009) Global analysis of the insulator binding protein CTCF in
chromatin barrier regions reveals demarcation of active and repressive domains.
Genome Res, 19, 24—32.

Ernst,J. et al. (2011) Mapping and analysis of chromatin state dynamics in nine
human cell types. Nature, 473, 43—49.

Karlin,S. and Altschul,S.F. (1990) Methods for assessing the statistical signiﬁcance
of molecular sequence features by using general scoring schemes. Proc. Natl
Acad. Sci. USA, 87, 2264—2268.

Karlin,S. and Altschul,S.F. (1993) Applications and statistics for multiple high-scoring
segments in molecular sequences. Proc. Natl Acad. Sci. USA, 90, 5873—5877.
Laajala,T.D. et al. (2009) A practical comparison of methods for detecting tran-

scription factor binding sites in ChIP-seq experiments. BM C Genomics, 10, 618.

Park,P.J. (2009) ChIP-seq: advantages and challenges of a maturing technology.
Nat. Rev. Genet., 10, 669—680.

Raftery,A.E. and Akrnan,V.E. (1986) Bayesian analysis of a Poisson process with a
change-point. Biometrika, 73, 85—89.

Robert,C.P. and Casella,G. (2004) Monte Carlo statistical methods. In Springer
Texts in Statistics. Springer, New York, pp. 454—455.

Ruzzo,W.L. and Tompa,M. (1999) A linear time algorithm for ﬁnding all maximal
scoring subsequences. Proc. 7th Int. Conf. Intell. Syst. Mol. Biol, 234—241.
Song,Q. and Srnith,A.D. (2011) Identifying dispersed epigenornic domains from

ChIP-Seq data. Bioinformatics, 27, 870—871.

Wang,Z. et al. (2008) Combinatorial patterns of histone acetylations and methyla-
tions in the human xgenome. Nat. Genet., 40, 897—903.

Zang,C. et al. (2009) A clustering approach for identiﬁcation of enriched domains
from histone modiﬁcation ChIP-Seq data. Bioinformatics, 25, 1952—1958.

Zhang,Y. et al. (2008) Model-based analysis of ChIP-Seq (MACS). Genome Biol, 9,
R137.

 

493

1c ﬂJO'sleumo[progx0'sorremrogurorw/2dnq urorr pepeolumoq

910K ‘09 lsnﬁnV uo ::

