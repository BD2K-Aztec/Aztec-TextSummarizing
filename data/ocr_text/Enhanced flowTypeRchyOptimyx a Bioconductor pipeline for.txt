APPLICATIONS NOTE

Vol. 30 no. 9 2014, pages 1329—1330
doi:10. 1093/bioinformatics/btt7 70

 

Systems biology

Advance Access publication January 8, 2014

Enhanced flowType/RchyOptimyx: a Bioconductor pipeline for
discovery in high-dimensional cytometry data
Kieran O’Neilll’Z’l, Adrin Jalali1’2’3’l, Nima Aghaeepour1’2’l, Holger Hoos4 and

Ryan B. Brinkman1’5’*

1Terry Fox Laboratory, British Columbia Cancer Agency, Vancouver, BC V5Z 1L3, Canada, 2Bioinformatics Graduate
Program, University of British Columbia, Vancouver, BC V6T 1Z3, Canada, 8Max—Planck—lnstitut fur lnformatik, Saarland
University, 66123, Saarbrucken, Germany, 4 Departments of Computer Science and 5Departments of Medical Genetics,
University of British Columbia, Vancouver, BC V6T 1Z3, Canada

Associate Editor: Martin Bishop

 

ABSTRACT

Summary: We present a significantly improved version of the flowType
and RchyOptimyx BioConductor-based pipeline that is both 14 times
faster and can accommodate multiple levels of biomarker expression
for up to 96 markers. With these improvements, the pipeline is pos-
itioned to be an integral part of data analysis for high-throughput ex-
periments on high-dimensional single-cell assay platforms, including
flow cytometry, mass cytometry and single-cell RT—qPCR.
Availability: FlowType and RchyOptimyx are distributed under the
Artistic 2.0 license through Bioconductor.

Contact: rbrinkman@bccrc.ca

Received on October 7, 2013; revised on November 25, 2013;
accepted on December 11, 2013

1 INTRODUCTION

Flow cytometry has undergone a ‘chromatic explosion’ over the
past decade and can now measure 17 markers at once for each of
hundreds of thousands of individual cells (Chattopadhyay et al.,
2008). Since then, mass cytometry has enabled measurement of
30—45 markers /cell (Bendall et al., 2012), whereas single-cell multi-
plexed RT-qPCR can measure 50—96 messenger RNAs/cell
White et al., 2011). The growth in high-throughput single-cell
data continues to outpace development of corresponding bio-
informatics techniques (Chattopadhyay et al., 2008). To answer
this challenge, we previously developed flowType (Aghaeepour
et al., 2012a) and RchyOptimyx (Aghaeepour et al., 2012b).
FlowType uses partitioning of cells, either manually or by cluster-
ing, into positive or negative for each marker to enumerate all cell
types in a sample, e.g. Aghaeepour et a]. (2013). RchyOptimyx
measures the importance of these cell types by correlating their
abundance to external outcomes, such as disease state or patient
survival, and distills the identiﬁed phenotypes to their simplest
possible form. These packages have been used to identify several
novel cell populations correlated with HIV outcome (Aghaeepour
et al., 2012a). More recently, this pipeline has been used to evalu-
ate standardized immunological panels (Villanova et al., 2013), to

 

*To whom correspondence should be addressed.
TThe authors wish it to be known that, in their opinion, the first three
authors should be regarded as joint First Authors.

optimize lymphoma diagnosis (Craig et al., 2013) and to analyze a
range of other clinical data (unpublished data).

However, the higher dimensionality of data produced by mass
cytometry generates up to 345 m 1021 possible cell types, with an
even greater number (up to 396 m 1045) for single-cell qPCR;
these magnitudes are beyond the capabilities of flowType and
RchyOptimyx. Furthermore, flowType and RchyOptimyx have
thus far only treated cells as being either positive or negative for
a marker. In practice, many biomarkers can have a range of
expression levels such as ‘dim’ and ‘bright’. In this application
note, we detail architectural improvements to flowType and
RchyOptimyx to overcome these limitations.

2 APPROACH

Our primary challenge was to enable flowType to generate a
number of cell types tractable on most common workstations
(e. g. those with 4—12 GB of RAM). We hereafter denote the ori-
ginal flowType implementation as ﬂowType-BF (brute force) and
the new version as ﬂowType-DP (dynamic programming).
Whereas flowType-BF completely enumerates all cell types over
all [1, ..., m] markers, we opted in ﬂowType-DP to use a breadth-
first strategy of enumerating all cell types defined over a subset of
k g m markers. We provide a memory use estimation function to
assist users in ﬁnding a k that fits within the limits of their hard-
ware. To improve computation time in flowType-DP, we imple-
mented a dynamic programming approach, which exploits the
fact that cell types can be arranged into a hierarchy, and member-
ship of any given cell type over n markers is equal to the intersec-
tion of one of its parent types (over n—l markers) with a single-
marker cell type. FlowType-DP first enumerates all cell types
involving only one marker by simple partitioning and then iterates
over 2, ..., k markers, computing all cell types for each level n by set
intersections between corresponding cell types in levels n—1 and 1.

For example, membership of the cell type CD45++CD117Jr
CD34‘ is computed as follows:

{CD45++CD117+CD34_}
= {CD45++CD117+} 0 {CD34‘}
2 {CD45++} 0 {CD1 17+} 0 {CD34‘}

To allow partitioning into levels other than positive and nega-
tive, we used a string representation for cell types. The string has

 

© The Author 2014. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com 1329

112 /310's113u1no [p.IOJXO'SOllBIIIJOJUTOTQ/ﬁdllq 11101; prBOIIIAAOG

9IOZ ‘091sn3nv uo ::

K.O’Neill et aI.

 

 

 

 

 

 

 

 

 

 

 

(a) C t. t. b b f H  Comparative run time by
ompara we run Ime y num ero ce 5 total number of markers
l .
I l
o I I
g _ I 8 I,
v"—’ — - flowType-BF { E ' — — flowType-BF ,
— flowType-DP , — flowType-DP ll
3 II A ,’
a» .. : s I
3 o I In 8 i
8 ' , v c - I
w — l m e ,I
E I E l
1:: I z I
r: I' c I
3 I 3 [I
n: 8 _ i 0: g _ l
g [I 8 //
/
I
l
l
'3 ' o _ y
I I I I I I I I l l I
1 2 3 4 5 2 4 6 8 10
log10(number of cells) Number of markers
(c) Theoretical memory use  Maximum number of markers which can be used
for 34 markers, 100,000 cells in combination for 15 marker data

 

 

Memory in GB
101
I

 

 

 

 

 

 

Largest possible marker combination size

. . . . . . . .
u 5 1o 15 20 25 an 35 o 2 4 6 8 10

Maximum marker combination size Number of cells (x 100,000)

 

RchyOptimyx analysis of
CD34+ prevalence in an AML sample

CD45+CD117+ SSC+

(e) CD45/SSC gating strategy 

 

CD45, CD45 _+ CD45f++
CD45— (cmsd'm) CD45“) (comm)

ssc+_+
(sscl'g')

 

SSC+
(sscmﬁ

SSC-
(ssc'W)
o _ CD45+ SSC+

0 1 2 3 4
CD45-ECD

 

 

 

 

 

 

 

SSC+ CD117+ CD45+ SSC+CD117+

CD117+ SSC+ CD45+

SSC+CD1 17+CD45+

Proportion of phenotype which is CD34+

Fig. 1. (a and b) Run time comparison of ﬂowType-DP to ﬂowType-BF in terms of number of cells (a) and number of markers (b). (c and d) Possible
thresholds for marker combinations using ﬂowType-DP for typical mass cytometry data (c) and polychromatic ﬂow cytometry data ((1). (e and 1) Three/
four partition ﬂowType-generated RchyOptimyx-visualized cell type hierarchy on a bone marrow sample from a patient with AML. Cell population
identiﬁcation strategy used for SSC and CD45, with the CD34-enriched subset highlighted (e). RchyOptimyx analysis showing CD34 enrichment (f)

one integer character for every marker, denoting the partition, or
zero if the marker is not used. Values 1, ...,n denote partitions
l to n. For example, if the set of markers were {CD3, CD45,
CD13, CD117, CD34}, the cell type CD45++CD117+CD34_
would be represented by 03 021. RchyOptimyx uses a dynamic
programing algorithm for efficiently constructing k-shortest
paths (Eppstein, 1998). We modified RchyOptimyx’ graph con-
struction component to be able to handle more than one parti-
tion per marker.

3 RESULTS AND DISCUSSION

We evaluated ﬂowType-DP against flowType-BF on a 10-
marker dataset available from Flow Repository (ID FR-FCM-
ZZZK) (Aghaeepour et al., 2012a). FlowType-DP showed a sub-
stantial speedup over flowType-BF, which increases exponen-
tially with the number of cells and markers. For example, at
106 cells and 10 markers, ﬂowType-DP is 14 times faster (see
Fig. la and b). Comparison on larger datasets was not possible
due to the limitations of flowType-BF.

We also computed the limits for k on a hypothetical machine
with 12 GB of RAM for samples representative of mass cytome-
try (Fig. lc) and polychromatic flow cytometry (Fig. 1d), both of
which would be intractable for ﬂowType-BF. FlowType and
RchyOptimyx are now able, within the memory of a common
workstation (12 GB), to analyze 34-marker data.

Finally, to demonstrate the importance of several partitions
per marker, we applied flowType and RchyOptimyx to an acute
myeloid leukemia (AML) sample from Flow Repository (ID FR-
FCM-ZZYA) (Fig. 1e and f). CD34 is a stem cell marker typic-
ally expressed on AML blast cells. These blasts are also known to
have dimly positive CD45 expression and low side scatter (SSC)
(Vial and Lacombe, 2001). By partitioning CD45 and SSC into

four and three partitions and naively running flowType and
RchyOptimyx to search for CD34-enriched cell types, we were
able to find that the SSCIOWCD45dim cell type had a high propor-
tion of CD344r cells, as expected. This would not have been
possible with only two partitions for each of CD45 and SSC.

Funding: ISAC scholar program, CIHR/MSFHR scholarship for
strategic training in bioinformatics, UBC 4YF scholarship, NIH/
NIBIB (EB008400), Canadian Cancer Society (700374), the
Terry Fox Research Institute and the Terry Fox Foundation.

Conﬂict of Interest: none declared.

REFERENCES

Aghaeepour,N. et al. (2012a) Early immunologic correlates of HIV protection can
be identiﬁed from computational analysis of complex multivariate T-cell ﬂow
cytometry assays. Bioinformatics, 28, 1009—1016.

Aghaeepour,N. et al. (2012b) RchyOptimyx: cellular hierarchy optimization for
ﬂow cytometry. Cytometry A, 81, 1022—1030.

Aghaeepour,N. et al. (2013) Critical assessment of automated ﬂow cytometry data
analysis techniques. Nat. Methods, 10, 228—238.

Bendall,S.C. et al. (2012) A deep proﬁler’s guide to cytometry. T rends Immunol, 33,
323—332.

Chattopadhyay,P.K. et al. (2008) A chromatic explosion: the development and
future of multiparameter ﬂow cytometry. Immunology, 125, 441.

Craig,F. et al. (2013) Computational analysis optimizes the ﬂow cytometric evalu-
ation for lymphoma. Cytometry B Clin. Cytom., [Epub ahead of print, doi:
10.1002/cytob.21115].

Eppstein,D. (1998) Finding the k shortest paths. SIAM J. Comput, 28, 652—673.

Vial,J.P. and Lacombe,F. (2001) Immunophenotyping of acute leukemia: utility of
CD45 for blast cell identiﬁcation. Methods Cell Biol, 64, 343—358.

Villanova,F. et al. (2013) Integration of lyoplate based ﬂow cytometry and compu-
tational analysis for standardized immunological biomarker discovery. PLoS
One, 8.

White,A.K. et al. (2011) High-throughput microﬂuidic single-cell RT-qPCR. Proc.
Natl Acad. Sci. USA, 108.

 

:: 1e /§.IO'S{BU.IHO[p.IOJXO'SOIlBIILIOJUIOIQ/ﬁdllq 11101; popeoIIr/noq

910z ‘09 lsnﬁnv uo

