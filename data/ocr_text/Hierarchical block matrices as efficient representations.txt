Bioinformatics, 32(8), 2016, 1121—1129

doi: 10.1093/bioinformatics/btv736

Advance Access Publication Date: 17 December 2015
Original Paper

 

 

Genome analysis

Hierarchical block matrices as efficient
representations of chromosome topologies and
their application for 3C data integration

Yoli Shavit1'*, Barnabas James Walkerz'3 and Pietro Lio’1'*

1Computer Laboratory, University of Cambridge, Cambridge C33 OFD, UK, 2University of Cambridge, Cambridge C33
0FD, UK and 3Department of Life Sciences, Imperial College London, London SW7 2AZ, UK

*To whom correspondence should be addressed.
Associate Editor: John Hancock

Received on 6 February 2015; revised on 21 November 2015; accepted on 12 December 2015

Abstract

Motivation: Recent advancements in molecular methods have made it possible to capture physical
contacts between multiple chromatin fragments. The resulting association matrices provide a
noisy estimate for average spatial proximity that can be used to gain insights into the genome or—
ganization inside the nucleus. However, extracting topological information from these data is chal—
lenging and their integration across resolutions is still poorly addressed. Recent findings suggest
that a hierarchical approach could be advantageous for addressing these challenges.

Results: We present an algorithmic framework, which is based on hierarchical block matrices
(HBMs), for topological analysis and integration of chromosome conformation capture (3C) data.
We first describe chromoHBM, an algorithm that compresses high—throughput 3C (HiT—3C) data
into topological features that are efficiently summarized with an HBM representation. We suggest
that instead of directly combining HiT—3C datasets across resolutions, which is a difficult task, we
can integrate their HBM representations, and describe chromoHBM—3C, an algorithm which
merges HBMs. Since three—dimensional (3D) reconstruction can also benefit from topological infor—
mation, we further present chromoHBM—3D, an algorithm which exploits the HBM representation
in order to gradually introduce topological constraints to the reconstruction process. We evaluate
our approach in light of previous image microscopy findings and epigenetic data, and show that it
can relate multiple spatial scales and provide a more complete View of the 3D genome
architecture.

Availability and implementation: The presented algorithms are available from: https://github.com/
yolish/hbm.

Contact: ys388@cam.ac.uk or p1219@cam.ac.uk

Supplementary information: Supplementary data are available at Bioinformatics online.

91% ‘09 1sn3nv uo sopﬁuv soq ‘BIUJOJIIBD aIo Amie/xtqu 112 /§.IO'S[BU.IHO[p.IOJXO'SOUBIHJOJUIOIQ/ﬁ(1111] 11101; prBOIUAAOG

 

1 Introduction

HiT—3C techniques provide a means for studying the genome archi—
tecture at a range of resolutions. As oppose to light microscopy, 3C
gives a population—based measure that relies on spatial proximity
but does not directly convey a spatial context (Belmont, 2014). All
3C derivatives consist of cross—linking nuclei, followed by chromatin

digestion and re—ligation. Quantifying the number of ligation events
between two chromatin fragments gives their ‘contact frequency’ in
the examined population of nuclei, providing a pairwise estimator
for their distance. HiT—3C methods (most notably, the Hi—C
method) detect contacts between groups of loci, per chromosome or
genome—wide, which are typically summarized in a non—negative ma—
trix called a ‘contact map’.

©The Author 2015. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com 1121

1122

Y.Shavit et al.

 

Analyzing contact maps can reveal different scales of topological
organization. At a 1 Megabase (Mb) resolution, chromatin compart—
ments and sub—compartments were identified with principal compo-
nent analysis (PCA) (Lieberman—Aiden et al., 2009) and clustering
(Rao et al., 2014). (Dixon et al. 2012) further suggested that at
shorter length scales (40—100 kilobases (kb)), a genomic bin can be
assigned with a state which represents its preference to interact with
other bins along the sequence (directionality index): upstream,
downstream or none. Using hidden Markov models (HMM) the re—
searchers have shown that the genome can be segmented into re—
gions of bins with the same state, leading to the definition of
Topologically Associated Domains (TADS, ‘upstream’ or ‘down—
stream’ regions) and their boundaries (‘none’ regions). Dynamic pro-
gramming (Levy—Leduc et al., 2014) and change point detection
(Shavit and Lio’, 2014) were also employed for identifying transi-
tions in contact frequency enrichment which induce a topological
genome segmentation. Owing to the definition of TADs, their pos-
ition and boundaries can change considerably depending on the
sequencing depth and the bin size used (Filippova et al., 2014). For
example, studying HiT—3C contact maps at different resolutions re—
vealed that previously identified large TADS can be divided into sub—
TADs (Filippova et al., 2014; Phillips-Cremins et al., 2013). This
hierarchical organization suggests the need for methods that could
go beyond the TAD—based segmentation and capture topologies at
different length scales. Hierarchical topologies derived from contact
maps can further provide a spatial context for studying point—wise
and relational properties (e.g., histone modifications and gene co—
expression, respectively). This can in turn uncover associations
between spatial organization (structure) and genomic features (func—
tion) that could not have been discovered when considering only the
proximity of the sequence. Such evidence synthesis requires an ap—
proach which can relate datasets at different resolutions and link
genetic and epigenetic features to the spatial scale at which they
work.

Physics and statistical mechanics have provided valuable lessons
about the genome organization. By modelling the chromatin fibre as a
polymeric chain of beads, researchers have applied polymer physics to
study the expected genome topology and dynamics. In particular, the
distance and probability of contact of between beads (loci), given their
distance on the sequence, were a subject for much research (Mirny,
201 1). Measurements obtained with ﬂuorescence in—situ hybridization
(FISH) and HiT-3C experiments were used to motivate and validate
hypotheses concerning these properties, respectively, and, together
with general characteristics of polymer chain behaviour were used to
propose different models of chromatin organization (Barbieri et al.,
2012; Bohn et al., 2007; Lieberman—Aiden et al., 2009; Mateos—
Langerak et al., 2009; Munkel et al., 1999; Sachs et al., 1995). The
increasing volume of HiT—3C data calls for the development of algo—
rithms and data structures that can summarize, compress and inte—
grate datasets while considering issues of time and space complexity.
Such a computational approach can complement physics simulations
and provide the necessary framework for large scale studies of the 3D
genome architecture and its function.

In this paper, we present a HBM—based algorithmic framework
for topological analysis and integration of HiT—3C data. We
first introduce the HBM representation for contact maps and give
the necessary definitions (Section 2.1). Next, we describe
chromoHBM, an algorithm which compresses a contact map into a
HBM by iteratively detecting dense modules (communities) of inter—
acting chromatin segments (Section 2.2). We then focus on the appli—
cation of HBMs for 3C data integration. We explain the difficulties

Table 1. Evaluation results and their availability.

 

 

Evaluation Algorithm Availability

Consistency with FISH chromoHBM Section 3

Consistency with FISH chromoHBM—3C Section 3

Consistency with epigenetic data chromoHBM—3C Section 3

Consistency with FISH chromoHBM—3D Suppl.

Consistency with topological chromoHBM Suppl.
domains

Robustness (community chromoHBM Suppl.
detection method)

Robustness (ﬁltering) chromoHBM Suppl.

Runtime analysis chromoHBM Suppl.

chromoHBM—3 C Suppl.
chromoHBM—3D Suppl.

Runtime analysis
Runtime analysis

Consistency of contact maps Pre—processing AOR
with FISH
Reproducibility between Pre—processing AOR

replicates

 

AOR, available on request; Suppl., supplementary information.

involved in directly combining HiT—3C datasets and propose to
merge their HBM representations instead, using the chromoHBM—
3C algorithm (Section 2.3). We also note that spatial inference can
benefit from incorporating topological knowledge and describe
chromoHBM-3D, an algorithm which takes a 3D reconstruction
method and iteratively guides it by means of HBM traversal (Section
2.4). In order to evaluate our approach, we study Hi—C datasets and
show that HBMs highlight key topologies and that the merged
HBM representation can capture multiple scales of spatial organiza—
tion that could not have been detected by separately analyzing each
dataset. For the sake of space, robustness and running time evalu—
ation is given in the supplementary (suppl.) information (Table 1).
Additional results of related or exploratory analysis are also avail—
able on request.

2 Methods

2.1 From contact maps to HBMs: an introduction for
bioinformaticians

3C experiments measure the frequency of ligation events between
chromatin fragments in a population of nuclei. For a given pair of
genomic bins, each spanning one or more chromatin fragments, we
define their contact frequency as follows:

DEFINITION 1 (contact frequency): Let a genomic bin be a vector of
consecutive chromatin fragments. Let a = (611,612, ...,ak) be a gen—
omic bin with [3 fragments and b : (b1,b2,...,b1) a genomic bin
with 1 fragments. The contact frequency between a and b is then:
favb : 2:1 Ell-:1 eaijbl. where eaijbl. is the number of ligation events
between fragments 61,- and b], for 1 g i g k, 1 g j g I.

We can further summarize these data with a matrix whose
entries give the pairwise contact frequencies between two vectors of
genomic bins. This leads to the following definition:

DEFINITION 2 (contact map): Let p : (1)1, [92, ..., pm) be a vector of
m consecutive genomic bins and q = (611,612, ...,qn) a vector of 11
consecutive genomic bins. The contact map of p and q is a m x 11
matrix A, with AL,- : fpijqi, where fpiqu. is the contact frequency be—
tween bins p, and q], for 1 g i g m, 1 g j g 11.

9mg ‘09 1sn3nv uo sopﬁuv s01 ‘BTUJOJTIBQ aIo A11SJQATUH 112 /§.IO'SIBU.IHO[p.IOJXO'SOTlBIIIJOJUTOTQ/ﬁdllq 11101; prBOIUAAOG

Hierarchical block matrices

1123

 

When all the genomic bins in p and q are from the same chromo—
some, we call A a cis contact map. Otherwise, A is a trans contact
map. From Definition 1 we also get that A is a non—negative matrix
and that if p and q are identical then it is also symmetric.

In practice, contact frequencies are biased measures of ligation
events (Yaffe and Tanay, 2011). Consequently, contact maps need
to be corrected before any subsequent analysis. In addition, even in
the bias—free case, their exact spatial interpretation is not straightfor-
ward. For example, we have recently found that contact frequencies
and distances measured with FISH are correlated only for short
range distances (Shavit et al., 2014). Thus, de—noised contact maps
should also be filtered in order to discard artefacts and data that are
not spatially meaningful. Here, we concentrate on the topological
analysis and data integration of cis chromosomal contact maps and
assume that they are de—noised and filtered (an evaluation of the ef—
fect of filtering is described in the suppl. information).

Since we are interested in recovering the topology of chromosomes
from their contact maps, the concept of networks immediately comes
to mind. In fact, cis contact maps were previously modelled as adja—
cency matrices of weighted undirected graphs (Boulos et al., 2013).
This leads to the definition of a contact network:

DEFINITION 3 (contact network): Let p : (1)1, [92, ..., pm) be a vector
of m genomic bins, from the same chromosome. The contact net—
work Of p is a weighted undirected graph N (V, E, w) where:

° V : {p1,p2, ...,pm} is a set of nodes,

° E : {{pi,pi}|fpi7pi > 0} is a set edges, where fpijpl. is the contact
frequency between the nodes (bins) p,- and p], for 1 g i, j g m,
and

° w : E —> RT is a weight function which assigns each edge with
the contact frequency between its elements: w({p,—,p,—}) : fpijpl.
and RT is the set of strictly positive real numbers.

It follows that A, the contact map of p (a symmetric cis contact
map), is the m X m adjacency matrix of N:

w i, - I. . > 0,
7/ .
0 Otherw15e

Based on Definition 3 and Equation 1 we can derive a contact map
from a contact network and vice versa. The network representation
of a contact map (i.e., its contact network) provides an intuitive
starting point for analyzing its topology.

Recently, several studies have demonstrated that both the fine
structure and long range scaling behaviour of Hi—C data is consistent
with a fractal globule model of genome folding (Grosberg et al.,
1988; Lieberman—Aiden et al., 2009; Mirny, 2011; Nazarov et al.,
2015). From a modelling point of view, the packing of the crumpled
globule is formed by iteratively folding the polymer (chromosome)
chain such that folds at one scale are grouped together in the next
scale, ultimately forming a ‘fold of folds’ (Grosberg et al., 1988).
The resulting structure can be described with a hierarchical block
Parisi matrix that is consistent with characteristics Observed in Hi—C
data (Nazarov et al., 2015). Parisi matrices consist of a growing
block, placed along the diagonal, which is itself a Parisi matrix of a
smaller size. This class of matrices is a sub—class of hierarchical
matrices which can be used to represent large—scale and dense
matrices with logarithmic—linear complexity (Hackbusch, 1999).
Similarly to Parisi matrices, HBMs can capture self-similar hierarch-
ical structures but in these data structures an entry in the matrix
takes the lowest level in the hierarchy. More formally, we define an
HBM as follows:

DEFINITION 4 (hierarchical block matrix (HBM)): Let N be an undir—
ected graph N(V, E, w), with V a set of m nodes, E a set of edges be—
tween them and w a function which assigns each edge with a
weight. If w is defined as w : E —> {1} then we say that N is un—
weighted, Otherwise N is a weighted graph. Let C be the set of clus—
ters in N, C : {(31}le where C; Q V and k 2 1. We denote B(1) to
be a m X m matrix, with:

1 i,j€c, CEC, cQV,

B(1)),- 2

0 Otherwise

Let N1(V1,E1, W1) be an undirected graph whose nodes are the
clusters in N and C1 : {clalﬁzll is the set of the clusters in N1, with
6171 Q V and 131 Z 1. Note that each cluster in C1 is a union of sets
(clusters in C) that contain nodes in V. Using a recursive definition,
we denote NS to be an undirected graph whose nodes are the clusters
in NS_1 and B(s) to be a m x m matrix, with:

1 i,j€c, CECS_1, cQV,

B(S)i,j :

0 Otherwise

where CS_1 : {cs_171};‘:11 is the set of clusters in NS_1 with 6547; Q V

and ks_1 Z 1, for s 2 2. Note that if B(s)i7i : 1 than for all
s’ > s, B(s’),-7i : 1 as well.
The hierarchical block matrix (HBM) of N is a non—negative sym—

metric m x m matrix, H, with: Hi7,- : mins{s|B(s),-7i : 1}, for s 2 1.

If the underlying topology of a chromosome is hierarchical then
we expect its contact network to consist of communities (clusters)
that will form mega—communities and so forth. This is in keeping
with the general definition of communities as dense sub—graphs of a
sparser graph (Radicchi et al., 2004). The resulting hierarchy can
then be described with an HBM; given a contact map A and its
contact network N, we can compute H from N using Definition 4

      

{a} Chmrnusumt [b]. Chmmnsnmc
High
u U
E E
3 - R
U D
E E
i . 5 3
E
I
La“. Level
The Frequency huh-wen II'IE 'I'hc (:ch a: which I antlj wcrr: Iiricl
bins i and j assigned 1c: the 5mm: community

In} a
I II II IIIIII

i  chcl

 

Fig. 1. Building HBMs from chromosomal contact maps. (a) A contact map.
(b, c) The HBM of the contact map in (a) and its dendogram representation. At
the first level (dark blue), the bins iand jare detected as part of two different
communities in the contact network of the contact map in (a). They appear as
leaves in the dendogram and belong to two separate clusters. At level 2 (or-
ange), iand jare first assigned to the same community and the clusters in the
dendogram are merged into one. The i, jth entry of the HBM (pointed to by a
black arrow) is set accordingly to 2. At the third and last level (green) all the
bins are merged into one single cluster. The HBM in (b) can be derived from
the dendogram in (c) (and vice versa) using a traversal from the lowest to the
highest level

91% ‘09 1sn3nv uo sopﬁuv s01 ‘BTUJOJTIBD aIO Amie/nun 112 /§.IO'S[BU.ITIO[p.IOJXO'SOTlBIIIJOJUTOTQ/ﬁdllq 11101; popeommoq

1124

Y.Shavit et al.

 

by iteratively detecting and merging communities in N until all com-
munities are merged into one or cannot be merged any further.
Figure 1 illustrates this idea. H can be further summarized with a
hierarchical tree (or a dendogram), which describes the merges of
communities at each level in a succinct way (Figure 1c). Taking a
data—driven perspective, H also allows us to first incorporate local
information and gradually include more global constraints, which is
desirable when considering contact frequencies (Shavit et al., 2014).

In the next sections we describe three HBM—based algorithms:
chromoHBM, chromoHBM-3C and chromoHBM-3D. The imple-
mentation of these algorithms is available at: http://www.cl.cam.ac.
uk/ys388/hbm/. Details of data preparation (datasets used and sub—
sequent pre—processing) and performance evaluation are given in the
suppl. information (see also Table 1).

2.2 chromoHBM: compressing contact maps into
topological features

The chromoHBM algorithm (Algorithm 1) derives the HBM
representation of a (de—noised and filtered) cis contact map. It takes
a m X m symmetric cis—contact map A and returns its HBM
H. chromoHBM starts by initializing H to be a m x m matrix
(Algorithm 1, line 3) and then removes self—interactions from A (by
setting its diagonal to zero) and creates Adj, a copy of A (Algorithm
1, lines 4—5). Next, H is iteratively populated. At each iteration, s,
chromoHBM calls detectCommunities which returns the commun—
ities in N, the network whose adjacency matrix is defined by Adj. It
then updates Adj to be a mS >< mS matrix, with mS the number of
identified communities. Adjiji is set to be a normalized sum of the
contact frequencies between the bins in A that are elements in the i”’
and jib communities in N, respectively:

2 2 Am

kEC,‘ [66,"

Adi?) = (2)

MM
where c, is the rib community in N and |cr| is its size, for 1 g r 3 ms
and i g j. Finally, chromoHBM updates H to record the commun—
ities detected at the current iteration (level) 5 by setting Hkal to s if
the bins k and l in A are assigned to the same community for the first
time, for 1 g 12,] g m (Algorithm 1, lines 26—30). The iterative pro—
cess halts when a single community has been identified (all commun-
ities were merged) or when it is not possible to merge any of the
communities detected at the previous level (Algorithm 1, while-loop
condition, line 10). At this point, 5 is max(H) —l— 1 and H may in-
clude entries that have not been set (if some communities could not
have been merged). chromoHBM updates such entries to take the
value of s in order to represent the global community formed by all
the communities in the network (Algorithm 1, lines 33—37).

The time complexity of the st), iteration in chromoHBM is given by:

T(s,ms) : T(detectCommunjties,Adjs) —I— Z Z |c,-||c,-| (3)

i=1 j=i+1,i<m5

where T(g, m) is the time complexity of g with an input of size m.
The first term in Equation 3 gives the time complexity of
detectCommunities which depends on the size of Adj at iteration s,
Adjs. This method is intentionally left unspecified since we expect
that the underlying hierarchy will consistently emerge regardless of
the implementation used (an evaluation of the robustness of HBMs
generated with chromoHBM, when using different detection
methods, is described in the suppl. information). The second term
describes the number of Operations required to update Adj and H,

 

Algorithm 1. chromoHBM

 

1 procedure chromoHBM(A)

2 m <— Nrow(A)

3 H <— matrix(m, m)

4. diag(A) <— 0 D remove self—interactions

5: Adj <— A D the adjacency matrix of a network N

6 m0 <— m

7 mS <— m0

8 s <— 1

9.

10: while mS > 1 and (ms < MO or s = 1) do

11: c <— detectCommunities(Adj)

12: m0 <— mS

13: ms <— lengt/o(c) D number of communities in N

14: Adj <— matrix(ms, ms)

15:

16: for z' <— 1 to mS do

17: for j <— z' to 1415 do

18: if j #j then

19: f <— 0

20: for all k E 6,- do

21: for all I E 6,- do

22: f <— f—(— Aka]

23: Adj-,- 9 

24: Adj-,- 9 Adj),-

25:

26: for all k E 6,- do

27: for all I E 6,- do

28: if Hkal is NULL then D ﬁrst time we
ﬁnd [a and I together

29: Hkal <— s

30: Hlak <— ijj

31: s <— s —I— 1

32:

33: fori<—1tom—1do

34: forj<—z'+1tomdo

35: if H1,- is NULL then D ﬁrst update

36: H17,- <— s

37: Hi),- <— Hi),-

38: return H

 

which depends on 141,, the number of communities detected at
iteration s and on |c,|, the size of community 6,, for 1 g r 3 ms.
Since the final update of H takes another O(m2) Operations
(Algorithm 1, lines 33—37), the total time complexity of the
algorithm is given by:

T(c/oromoHBM) = 0(m2) -I- Z T(S,ms) (4)

The space complexity of chromoHBM is O(m2) since we store Adj
and H in memory. This requirement could be relaxed by implement—
ing H as a hierarchical tree.

2.3 chromoHBM—3C: merging HBMs with different

bin sizes

High-throughput 3C techniques generate contact maps at various
resolutions and bin sizes. To date, however, there are no methods
for putting together contact maps that differ in their binning,

9mg ‘09 1sn3nv uo sopﬁuv s01 ‘121u10111123 aIO Amie/nun 112 /§.IO'S[BU.IHO[p.IOJXO'SOIlBIIIJOJUTOIQ/ﬁ(1111] 1110.1} pop1201umoq

Hierarchical block matrices

1125

 

resolution or protocol. We focus on the integration of cis symmetric
contact maps and define the problem of HiT—3C data integration as
follows:

DEFINITION 5 (3C data integration): Let x : [xb, xe] be a genomic
range starting at position x1, and ending at position xe on a given gen—

W genomic bins

omic sequence. A y—binning of x divides it into
of length y, where y is a natural number. Let u : (141,142, ..., um) and
z/ = (121,122, ..., 12k) be two vectors of genomic bins, generated by a r
and a 7/11 binning of x, respectively. For simplicity, we will assume
that n and W
ber (by the definition of binning), we get that k : nm. Let A and B

be the contact maps of u and 12, respectively; the problem of integrat—

are natural numbers. Since % is also a natural num—

ing A and B is to create a new k X k contact map which faithfully
represents the information in A and in B.

Several factors make the 3C data integration problem particu—
larly challenging. First, differences in resolution and in the molecular
protocol can lead to a considerable variation in the contact fre—
quency range, which in turn makes it difficult to combine (and com—
pare) contact maps. Other variations in the experimental setting can
also contribute to this effect. In addition, merging contact maps
with different bin sizes require data processing, such as expansion or
normalization of contact frequencies, which is not straightforward
to perform and may lead to data distortion. Since we are ultimately
interested in putting together the underlying topologies that are cap—
tured by contact maps, the HBM representation offers an attractive
surrogate. Thus, instead of directly combining two contact maps,
which is a difficult task, we can merge their HBMs and generate a
unified representation of their topologies.

We follow the definition of the 3C data integration problem
(Definition 5) and denote HA to be the m x m HBM of A and HB
to be the k X k HBM of B. Since [a : nm, we can expand HA to be a
k x 12 matrix, HA, with:

A  
[12:14:61, pzfzI, q=IgI (5)
for1 gj,j§kand1 £p,q§m.
We define a ‘merging matrix’, M, given by:

_HA+HB

M
2

(6)
where M17,- takes the ‘average level’ between the levels at which i
and j were first assigned to the same community. Given M, we can
compute the ‘merged HBM’, HAII3 which integrates A and B by
merging the topologies of HA and HB. Let s : {5,}11-1‘241 be the set of
levels (unique values) in M, sorted in an increasing order, where [M
is the total number of levels in M. Hill-’3 is given by:
A B

Hz)” = g(Mi,i) (7)
where g is a function which takes the value of a level in M and re—
turns its index in s:

5151) :1} 51' E S (8)

The computation of HM3 mimics a bottom—up traversal of M, where
new levels are added in order to accommodate for the, possibly dif—
ferent, topologies of HA and HB (note that when HA : H B then also
HA7]3 : HB). Figure 2 illustrates the steps involved in merging two
HBMs, using a toy example.

The chromoHBM-3C algorithm (Algorithm 2) takes a m x m
HBM HA and a k x k HBM HB where k : nm and n is a natural

llllrllli 111.11.: Step1:1:prttntlHlandurcu1cHW
H‘I

H
=

 

 

_.

 

 

 

 

 

 

 

 

— — IJIIJ

..
._
"I
|
|

——I...|...

2 .
I
I

1414—
rum——

 

 

 

 

In... 11. 

 

 

 

 

 

 

 

__-_...d..

 

 

'.-I '.-I —I 'l—I 1'? hi — i —
I-l'l '..- ..- '..-I — — I.I ' M
I... a...- — — I... .... '_. : I...
— - .-I '..-l '.-I ..-l '..-I '..-I
— — '..J '_.1 I1...- -.... Ii_. I..I

 

IL-I 'a-u- 'u '...I M I..I —-I—=

 

 

 

 

 

 

. . .. .
— — — — u I;- IA 14
—I' — — — In I: I..I IJ
—- — — .— u I.- I4 I;
. . .. .. ....-.. . .... 
—: — — — r4 I..I la la

 

 

 

Hula-Hanan-

 

Iu!r.rI.IIJ————

 

 

Ld'...r'..l'..1——IJIJ

Nil'd'liI-l—l—l—

 

Step 1: M ={H71+ H1112 Step 3: HI_1= gIMiﬂ letput: II
H

 

| : Hula-HEM I

 

 

1115 Iﬁrﬁirj

[T'ﬁ

 

i.
)2

.'

5113.5

 

 

5 l | l.ﬁj:.ﬁ_

 

 

 

3" the merge of H1 and H2

 

 

 

-I- 1— 4— 4'— H u -— -—
4- .I- 4- +— —- —- l-.- I.
LII I.“ — — J— .|_ L L
-- u- - — 4- 4- r— :—
_. _ _... -.. a. .1... .1- I.

 

 

 

 

 

 

 

 

 

- u
.I- .1.- .l.- .|.. — — 1.- N
. u . .
— — ...- w .I. .1. .L.. .I.

'-1
:4
'-1
:4

 

 

levels= (1.1.5.112. gm: I.g1|.51= 2. g:11=3.g{3.51=4

Fig. 2. Merging HBMs with different bin sizes. Two HBMs, H1 and H2 are gen-
erated from contact maps with a different binning, where a bin in H1 corres-
ponds to two bins in H2. In Step 1, we expand H1 so that the binning of the
two HBMs will match (Equation 5). The average between the expanded HBM,
H1, and H2 gives the merging matrix M (Step 2, Equation 6). Finally, at Step 3,
we compute the merged HBM, H, using M. Each entry in Htakes the index of
the level value in the matching entry in M, which can be computed with the
function 9 (Equations 7—8)

number. It follows the steps described above and returns HAIB, the
merged HBM of HA and HB. First, it generates HA, the expanded
version of HA, according to Equation 5 (Algorithm 2, lines 6—11).
Second, it creates the merging matrix, M, by taking the ‘average’ of
HA and HB. Lastly, chromoHBM—3C traverses the levels of M, from
the lowest to the highest, and updates HAII3 according to Equation 7
(Algorithm 2, lines 16—21). For each level 5; in M, chromoHBM-3C
iterates through the entries of M and updates the entry Hill-’3 to be I
if M17,- equals 5;. At the end of the traversal H contains the number of
levels required to merge the topologies in HA and HB. The expansion
and merge steps take 0022) operations each and the bottom—up tra—
versal requires another OHM/22) operations (where [M is the number
of levels in M). We also create and update matrices of size 122.
Hence, the total time and space complexities of the algorithm are
OHM/22) and C(19), respectively.

2.4 chromoHBM—3D: guiding 3D positioning with HBMs
Current methods for 3D positioning typically use available con—
straints (contact frequencies) all together. If chromosomes are hier-
archically organized, then reconstructing their configuration could
benefit from a bottom—up approach, which starts by positioning the
smaller, more local domains, and gradually proceeds by placing
them relative to each other (instead of inferring all the positions at
once). Since HBMs capture and relate multiple levels of topological
features, they provide a natural means for implementing such an
approach.

The chromoHBM-3D algorithm (Algorithm 3) takes five argu—
ments as input:

° A, a m x m contact map,

' H, the HBM of A,

° f, a 3D reconstruction method which takes a contact map and re—
turns its 3D positioning,

° t, a function which converts distances into contact frequencies
(for example, using the inverse function), and

° mg, a list of any additional arguments for 

9mg ‘09 1sn3nv uo sojoﬁuv s01 ‘12;qu111123 aIo Amie/nun 112 /§.IO'SIBU.ITIO[p.IOJXO'SOIlBIIIJOJUIOIQ/ﬁ(11111 1110.1} pop1201umoq

1126

Y.Shavit et al.

 

 

Algorithm 2. chromoHBM—3C

 

Algorithm 3. chromoHBM—3D

 

1: procedure chromoHBM-3C(HA , HB)
2: m <— Nrow(HA)

3: k <— Nrow(HB)
4: n <— 5 D we assume that n is a natural number
5: HA <— matrier, k) D expand HA
6: forz'<—1tokdo
7: p <— 
8: forj<—z'tokdo
9: q <— 
10: L]- <— H5176]

11:  e 

12; M e W

13: HA]3 <— matrix(0, k, k)
14: s <— getLez/els(M)
15: [M <— length(s)

16: for l <— 1 to lM do
17: forz'<—1tokdo

D level values in increasing order
D number of levels

18: forj<—z'tokdo
19: if Mi),- : s; then
20: HM?” <—l

21:  e 

22: return H AIB

 

Given this input, chromoHBM—3D performs a bottom—up tra—
versal of H and returns the 3D positioning of A. It first creates a
m x m distance matrix, D, that will be updated during the traver—
sal. For each level I, for each community ck E c (for c, the set of
communities detected at level I), chromoHBM—3D calls f with the
contact map of ck, Ack, given by Ali]; : AL,- for all i,j E ck. Note
that small communities are skipped since they do not provide
enough spatial constraints (Algorithm 3, line 9, where |ck| is the
size of ck). Given Y, the 3D configuration reconstructed with f,
chromoHBM—3D updates Div,- to take the Euclidean distance be—
tween i and j in Y, for i,j E ck. This update is carried only for
entries that have not been updated at previous iterations (based on
‘more local’ constraints). At the end of the iterative procedure,
chromoHBM-3D transforms D into a ‘contact map’ A’, using t,
and calls f with A’. The resulting 3D configuration is a ‘refined’ 3D
positioning of A based on the information in H.

The running time of chromoHBM—3D depends on the number
of levels and communities in H and on the time complexity of 
Let [H be the number of levels in H, m,, the number of
communities at level I, and T(f, n), the time complexity of f with
an input of size n. The time complexity of chromoHBM-3D is

given by:
lb "11
T(chromoHBM — 3D) 2 0(m2 + T(f, m) + Z Z T(f, (Ckl) + (Cklz) (9)
1:1 k:1

The first and second terms in Equation 9 give the number of oper—
ations required to derive A’ from D and the time complexity of re-
constructing Y from A’, respectively (Algorithm 3, lines 18—22). The
time complexity of the bottom—up traversal is given by the third
term (nested sums). For each level I, we call f with the contact map
of the community ck which takes T(f, |ck|) operations. Updating D
requires additional |ck|2 operations.

 

1 procedure chromoHBM-3D(A, H, f, t, mg)
2 m <— Nrow(A)
3. D <— matrix(m, m)
4: [H <— Nlez/els(H) D number of levels in H
5 forl<—1tolHdo

6 c <— communitiesAtLez/el(l) D communities

detected at level I

7 for all ck E 6 do

8: ml <— IC/el

9 if m; > 4 then

10: A“: <— matrix(ml,m1)

11: for all j,jEck do

12; Aff; 9 AL,-

13: Y <— f (AC/gargs) D the 3D positioning
of Ack

14: for all j,j E ck do

15 : if D17,- is NULL then D ﬁrst update

16: Di,j ‘— 2221 (Ym — Yj,a)2

17: A’ <— matrix(m,m)
18: fori<—1tom—1 do

19: forj<—z'+1tomdo

20: Ajjl- <— t(D,-7,-) D convert distances into ‘contact
frequencies’

21: 141;), 9 Ag},

22: Y <— f(A’,args)
23: return Y

 

The space complexity of chromoHBM—3D depends on the mem—
ory requirements of f but has a lower—bound of O(m2) (the size of
the distance matrix D).

3 Results

Let A and B be two contact maps, HA and HB their HBMs, respectively,
and H AIB the merged HBM of HA and HB, we would like to test:

° Is HA:B ‘consistent’? If HA:B is consistent then its topology should
be in agreement with the separate topologies of HA and HB as
well as with previous ﬁndings.

° Is HA7]3 ‘powerful’? If HA]3 is powerful then it should add new in—
formation, which is not available when independently analyzing
HA and HB. Also, there should be a clear motivation for not dir—
ectly comparing A and B (for example, large variation in contact
frequency distribution and range).

Further evaluation of the robustness, consistency and performance
(running time) of chromoHBM, chromoHBM-3C and chromoHBM-
3D is described in the suppl. information (see Table 1).

In order to evaluate how ‘consistent’ and ‘powerful’ separate and
merged HBMs are, we study two contact maps and their HBMs,
which considerably differ in their binning: a 500 and a 25 kb contact
maps generated from human fibroblasts nuclei for chromosome 1
(Rao et al., 2014). We first compare the corrected (de—noised) contact
maps. We find that the 25 kb contact map is sparser and that the dis—
tributions of the two contact maps are significantly different (one-
sided t—test (significant differences are observed also when considering
non—parametric tests such as the Kolmogorov—Smirnov test), P—value

9mg ‘09 1sn3nv uo sojoﬁuv s01 ‘12;qu111123 aIo Amie/nun 112 /§.IO'SIBU.ITIO[p.IOJXO'SOIlBIIIJOJUIOIQ/ﬁ(11111 1110.1} pop1201umoq

Hierarchical block matrices

1127

 

< 2.2 X 10‘”). The 500 kb contact frequencies range between 0 and
101 500 with a mean of 427.10 and a median of 31.57, while the dis—
tribution of the 25 kb contact frequencies is more (rightly) skewed;
the 25 kb contact frequencies range between 0 and 6221 and have a
mean of 1.074 and a zero median. In order to allow for a more direct
comparison, we standardize the two contact maps and compute the
expanded version of the 500 kb contact map, using Equation 5.
Testing for agreement between the two standardized contact maps
(which now match in their dimensions) yields a low Pearson correl—
ation value (r = 0.15). Put together, the notable variations between
the 500 and 25 kb contact maps, make it difficult to integrate them
and motivate the use of their HBM representation for this purpose.

We next apply chromoHBM in order to generate the HBM for
each of the contact maps, using the Infomap algorithm (Rosvall and
Bergstrom, 2008) for detecting communities. This algorithm, which
is recognized as a leading approach for community detection in un—
directed weighted graphs (Lancichinetti and Fortunato, 2009), aims
at finding an optimal compression of the information ﬂow in a
graph, using random walks as a proxy for the amount of informa-
tion transferred between nodes. Its key idea, inspired by Information
Theory, is that finding a compression that can closely recover the in—
formation flow in a graph is equivalent to detecting its topological
modules or communities (which dictate the dynamics of the system).
In the suppl. information we further show that chromoHBM re—
covers similar HBMs, independently of the detection method used
(robustness evaluation, see Table 1).

Given their HBMs, we apply chromoHBM—3C to compute the
merged HBM representation of the two contact maps. For descrip—
tion purposes, we use H 500, H25 and Hmerged to denote the 500 kb,
25 kb and the merged HBMs, respectively. Figure 3 shows H500
(enlarged for visual clarity), H25 and Hmerged. We notice that some
topological patterns that appear in H 500 are missing from H25 and
vice versa. Small communities that are detected at the first level of
H25, are missing or merged in H 500. At the second level, the two
HBMs detect mega communities that roughly correspond or over—
lap. These communities are further combined into two large clusters
(in blue) at the third level of H 500. This level of hierarchical organ-
ization is completely absent from H25. At the last level (level 5 and
level 4 for H 500 and H25, respectively), bins which correspond to re—
gions with a poor mappability (and thus poorly covered) are merged
with the others to form the global community.

From a signal processing point of view (according to the
Heisenberg uncertainty principle), the observed trade—off, between
H 500 and H25, is expected. Smaller bins can better detect small scale
topologies but miss large scale features (good knowledge of fre—
quency but poor knowledge of position). In contrast, larger bins
capture large scale organization on the expense of finer details (good
knowledge of position but poor knowledge of frequency). Hmerged
(Figure 3c) accommodates for the distinct scales that are captured

 

(a) 51:11} H.135 1h) 25 H.135 (c)

 

I arm-untuqu

;I
| momma.qu

 

 

 

 

 

 

 

 

lE'1m:-mtisun'li: 1

Lev-1:1" 2 3 Let-cl" 1 3 ﬂ 1:. m

Chromosome 1

Lev-:1" 1 ﬂ 1

Fig. 3. HBMs of chromosome 1: before and after merge. (a) 500 kb HBM of
chromosome 1 (enlarged for visual clarity). (b) 25 kb HBM of chromosome 1. (c)
The merged HBM of the HBMs in (a) and (b), generated with chromoHBM-3C

by H25 and H 500, and provides a multi—scale view of the organiza—
tion of chromosome 1. Its first level matches the first level of H25 (a
small scale topology) while its fifth level roughly corresponds to the
third level of H 500 (a large scale topology). At intermediate levels,
overlapping features detected by both HBMs are combined together,
forming a unified view of the separate hierarchies.

In order to further evaluate the consistency of Hmerged, we study
active and repressed domains in chromosome 1. These domains be—
long to a group of regions which appear throughout the genome,
termed ‘ridges’ and ‘anti—ridges’, which show distinct functional and
structural characteristics. Ridge domains are rich with genes and ac—
tive regulatory elements, and are highly transcribed and expressed
(‘active’) (Gilbert et al., 2004; Versteeg et al., 2003). They possess an
‘open’ chromatin topology which further correlates with their high ex-
pression level. In contrast, anti—ridge domains are gene poor, lowly
transcribed and expressed and present a ‘close’ and packed topology
(‘repressed’). Figure 4 shows the HBMs of chromosome 1, at positions
1.50 X 108 to 1.54 X 108 (green frame, upper panel) and 1.73 X 108
to 1.76 X 108 (red frame, lower panel), which correspond to a ridge
and an anti—ridge domain, respectively. For these specific regions, dif—
ferences in density were also confirmed with FISH (distances within
the ridge domain shown to be larger than distances within the anti—
ridge domain) (Mateos—Langerak et al., 2009).

In line with the trend observed when analyzing the entire chromo—
some, H2 5 captures finer topological details compared to H500. At the
first level, the ridge domain of H25 consists of four communities,
which roughly correspond to two communities in H 500. In a similar
way, the two communities detected in the anti-ridge domain in H25
form a single community in H 500. When considering Hmerged, we find
that the anti—ridge domain presents a ﬂatter hierarchy compared to
the ridge domain (two levels versus three levels, respectively) with a
smaller number of larger communities. This is in agreement with the
characteristics of anti—ridge domains, which are more dense than ridge

(a1 (bl 1C1

1131(2 '1‘ A1:
pmfi | e

   

501] Kbs 25 K1115 Merged

IIEIIIE

{d1 {31 111

Fig. 4. HBMs of chromosome 1 at ridge and anti-ridge domains. The upper
panel (green frame) shows the 500 kb (a), 25 kb (b) and merged (c) HBMs of
chromosome 1 at positions 1.50 x 108 to 1.54 x 108, which correspond to a
ridge ('active’) domain. The respective HBMs at the lower panel correspond
to an anti-ridge (‘repressed’) domain at positions 1.73 x 108 to 1.76 x 108. The
vertical track next to the merged HBM of the ridge domain (0) shows the picks
of the H3K27Ac histone modification mark at the corresponding positions in
the genome (chromosome 1: 1.50 x 108 to 1.54 x 108). This track was
retrieved from the UCSC Genome Browser website (Kent at al., 2002)

 

9mg ‘09 1sn3nv uo sojoﬁuv s01 ‘12;qu111123 aIo Amie/nun 112 /§.IO'SIBU.ITIO[p.IOJXO'SOIlBIIIJOJUIOIQ/ﬁ(11111 1110.1} pop1201umoq

1128

Y.Shavit et al.

 

domains. For the ridge domain, the first and third level of Hmwged
closely correspond to the first and second level of H25, respectively.
The second level of Hmerged, reveals, however, an additional scale that
is missing from H25 and H 500; the last and first two communities
(along the diagonal), which are detected at the first level, form one
mega community while the other two communities are merged into a
second mega community. This topology recapitulates the picks of a
regulatory mark (shown as a vertical track next to Hmwged in Figure
4c), which is associated with a high transcription activity (the
H3K27Ac histone mark). The first mega community corresponds to
H3K27Ac picks while the second matches a flat profile. This parti-
tion, which is missing from the separate HBMs, further illustrates the
advantage of a merged view of multiple scales.

4 Outlook

Since the introduction of the 3C technique in 2002 (Dekker et al.,
2002), various high—throughput derivatives have been developed.
Given the latest enhancements in resolution (kb and sub—kb) (Hsieh
et al., 2015; Rao et al., 2014; Sexton et al., 2012) and signal—to—
noise ratio (Kalhor et al., 2012a,b), as well as the on—going reduc—
tion in sequencing costs, HiT—3C techniques are expected to become
even more widely used for studying the 3D genome organization.
Recent single—cell protocols (Nagano et al., 2013, 2015) also hold
the promise to extend the conventional population—based analysis to
the single cell level. Integrating these noisy, big and high-dimen-
sional data across resolutions, sub—populations and with other
Omics, pose challenges that are not yet addressed.

The HBM representation summarizes the topological features of
chromosomal contact maps. This summary is useful not only for gain-
ing biological insights into genome topology, but importantly as a
data structure that can facilitate data integration. Putting together
HiT-3C HBMs can be performed across resolutions (as demonstrated
above) but also across sub—populations. If we consider n contact maps
of n sub—populations, their HBMs give a means to compare the topol—
ogies which characterize each sub—population and allow to create an
ensemble which captures the variance in the global population. This
can be achieved using a simple voting algorithm, where each HBM
‘votes’ for the communities which comprise it. In this way, one can
identify the communities which dominate the population. In addition,
simple HBM statistics (e.g., mean and variance) can give insights
about the importance of the relative positioning of genes and do—
mains. Beyond the challenge of integrating different 3C datasets, a
key problem is how to relate Omics and 3C information (i.e., at what
resolutionP). Merged HBMs allow to identify the spatial scales and
topologies which are relevant for a given Omic of interest and to bet—
ter link structure and function (see Section 3).

The algorithmic framework presented in this paper can be used
as a foundation for analyzing multi—omic data, while considering
both their sequence and 3D contexts. Since analysis can be carried
independently for each scale, HBMs also lend themselves to parallel
computations which is advantageous for big data. Finally, HBMs
could complement genome Google—like browsers, which are now
starting to emerge (He et al., 2013), since they link information at
different resolutions.

Acknowledgements

We thank FP7-Health-F5-2012, under grant agreement 105 no 305280
(MIMOmics).

Conﬂict of Interest: none declared.

References

Barbieri,M. et al. (2012) Complexity of chromatin folding is captured by the
strings and binders switch model. Proc. Natl. Acad. Sci. USA, 109, 16173—
16178.

Belmont,A.S. (2014) Large-scale chromatin organization: the good, the sur-
prising, and the still perplexing. Curr. Opin. Cell Biol., 26, 69—78.

Bohn,M. et al. (2007) Random loop model for long polymers. Phys. Rev. E
Stat. Nonlinear Soft Matter Phys., 76, 051 805.

Boulos,R.E. et al. (2013) Revealing long-range interconnected hubs in human
chromatin interaction data using graph theory. Phys. Rev. Lett., 111,
1 1 8 102.

Dekker,]. et al. (2002) Capturing chromosome conformation. Science, 295,
1 306—13 1 1.

Dixon,].R. et al. (2012) Topological domains in mammalian genomes identi-
ﬁed by analysis of chromatin interactions. Nature, 485, 376—380.

Filippova,D. et al. (2014) Identiﬁcation of alternative topological domains in
chromatin. Algorithms Mol. Biol., 9, 14

Gilbert,N. et al. (2004) Chromatin architecture of the human genome: gene-
rich domains are enriched in open chromatin ﬁbers. Cell, 118, 5 55—5 66 .

Grosberg,A.Y. et al. (1988) The role of topological constraints in the kinetics
of collapse of macromolecules. ]. Phys., 49, 2095—2100.

Hackbusch,W. (1999) A sparse matrix arithmetic based on H-matrices. Part I:
Introduction to H-matrices. Computing, 62, 89—108.

He,C. et al. (2013). GMol: A Tool for 3D Genome Structure Visualization. In:
The Great Lake Bioinformatics Conference, Pittsburgh, PA.

Hsieh,T.H. et al. (2015) Mapping nucleosome resolution chromosome folding
in yeast by micro-C. Cell, 162, 108—1 19.

Kalhor,R. et al. (2012a) Genome architectures revealed by tethered chromo-
some conformation capture and population-based modeling. Nat.
Biotechnol., 30, 90—98.

Kalhor,R. et al. (2012b) Solid-phase chromosome conformation capture for
structural characterization of genome architectures. Nat. Biotechnol., 30,
90—98.

Kent,W.]. et al. (2002) The human genome browser at UCSC. Genome Res.,
12, 996—1006.

Lancichinetti,A. and Fortunato,S. (2009) Community detection algorithms: a
comparative analysis. Phys. Rev. E Stat. Nonlinear Soft Matter Phys., 80,
0561 1 7

Levy-Leduc,C. et al. (2014) Two-dimensional segmentation for analyzing
Hi-C data. Bioinformatics, 30, i3 86—i392.

Lieberman-Aiden,E. et al. (2009) Comprehensive mapping of long-range
interactions reveals folding principles of the human genome. Science, 326,
289—293.

Mateos-Langerak,]. et al. (2009) Spatially conﬁned folding of chromatin in
the interphase nucleus. Proc. Natl. Acad. Sci. USA, 106, 3812—3817.

Mirny,L.A. (201 1) The fractal globule as a model of chromatin architecture in
the cell. Chromosome Res., 19, 37—5 1.

Munkel,C. et al. (1999) Compartmentalization of interphase chromosomes
observed in simulation and experiment. ]. Mol. Biol., 285, 1053—1065.

Nagano,T. et al. (2013) Single-cell Hi-C reveals cell-to-cell variability in
chromosome structure. Nature, 502, 5 9—64.

Nagano,T. et al. (2015) Comparison of Hi-C results using in-solution versus
in-nucleus ligation. Genome Biol., 16, 175.

Nazarov,L.I. et al. (2015) A statistical model of intra-chromosome contact
maps. Soft Matter, 11, 1019—1025.

Phillips-Cremins,].E. et al. (2013) Architectural protein subclasses shape 3D
organization of genomes during lineage commitment. Cell, 153,
1281—1295.

Radicchi,F. et al. (2004) Deﬁning and identifying communities in networks.
Proc. Natl. Acad. Sci. USA, 101, 2658—2663.

Rao,S.S. et al. (2014) A 3D map of the human genome at kilobase resolution
reveals principles of chromatin looping. Cell, 159, 1665—1680.

Rosvall,M. and Bergstrom,C.T. (2008) Maps of random walks on complex
networks reveal community structure. Proc. Natl. Acad. Sci. USA, 105,
1 1 1 8—1 1 23.

Sachs,R.K. et al. (1995) A random-walk/giant-loop model for interphase
chromosomes. Proc. Natl. Acad. Sci. USA, 92, 2710—2714.

91% ‘09 1sn3nv uo sojoﬁuv s01 ‘12;qu111123 10 Amie/nun 112 /§.IO'SIBU.IHO[p.IOJXO'SOllBIIHOJUTOIQ/ﬁdllq U101} pop1201umoq

Hierarchical block matrices

1129

 

Sexton,T. et al. (2012) Three-dimensional folding and functional organization
principles of the Drosophila genome. Cell, 148, 45 8—472.

ShaVit,Y. and Lio’,P. (2014) Combining a wavelet change point and the Bayes
factor for analysing chromosomal interaction data. Mol. Biosyst., 10,
1 5 76—15 85.

ShaVit,Y. et al. (2014) FisHiCal: an R package for iterative FISH-based cali-
bration of Hi-C data. Bioinformatics, 30, 3120—3122.

Versteeg,R. et al. (2003) The human transcriptome map reveals extremes
in gene density, intron length, GC content, and repeat pattern for
domains of highly and weakly expressed genes. Genome Res., 13,
1998—2004.

Yaffe,E. and Tanay,A. (2011) Probabilistic modeling of Hi-C contact maps
eliminates systematic biases to characterize global chromosomal architec-
ture. Nat. Genet., 43, 1059—1065.

91% ‘09 1sn3nv uo sojoﬁuv s01 ‘12;qu111123 10 Amie/nun 112 /§.IO'SIBU.IHO[p.IOJXO'SOllBIIHOJUTOIQ/ﬁdllq U101} pop1201umoq

