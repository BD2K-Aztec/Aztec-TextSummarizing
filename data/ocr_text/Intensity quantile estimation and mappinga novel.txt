ORIGINAL PAPER

Vol. 28 no. 20 2012, pages 2632-2639
doi: 10. 1093/bioinformatics/bts491

 

Systems biology

Advance Access publication August 22, 2012

Intensity quantile estimation and mapping—a novel algorithm for
the correction of image non-uniformity bias in HCS data

Ernest L012”: Emmanuelle Soleilhac3’4’5, Anne Martinez3’5’6, Laurence Lafanechere

Robert Nadon2’7’*

3,5,6 and

1Department of Epidemiology, Biostatistics and Occupational Health, McGill University, Montreal, Quebec, Canada H3A
1A2 and 2McGill University and Genome Quebec Innovation Centre, Montreal, Quebec, Canada H3A 1A4, 8Institut de
Recherches en Technologies et Sciences du Vivant, CEA, DSV, IRTSV, LBGE, CMBA and 4INSERM U1038, F—38054,
Grenoble France, 5UJF—Grenoble 1, F—38041, France, 6Departement Differenciation et Transformation Cellulaire, Institut
Albert Bonniot, CPI INSEPM/UJF U823, Team 3 ‘Polarity, Development and Cancer’, Pond—point de la Chantourne,
F—38706 La Tronche, France and 7Department of Human Genetics, McGill University, Montreal, Quebec, Canada H3A 1 B1

Associate Editor: Jonathan Wren

 

ABSTRACT

Motivation: Image non-uniformity (NU) refers to systematic, slowly
varying spatial gradients in images that result in a bias that can
affect all downstream image processing, quantification and statistical
analysis steps. Image NU is poorly modeled in the field of high-content
screening (HCS), however, such that current conventional correction
algorithms may be either inappropriate for HCS or fail to take advan-
tage of the information available in HCS image data.

Results: A novel image NU bias correction algorithm, termed intensity
quantile estimation and mapping (IQEM), is described. The algorithm
estimates the full non-linear form of the image NU bias by mapping
pixel intensities to a reference intensity quantile function. IQEM ac-
counts for the variation in NU bias over broad cell intensity ranges
and data acquisition times, both of which are characteristic of HCS
image datasets. Validation of the method, using simulated and HCS
microtubule polymerization screen images, is presented. Two require-
ments of IQEM are that the dataset consists of large numbers of
images acquired under identical conditions and that cells are distrib-
uted with no within-image spatial preference.

Availability and implementation: MATLAB function files are available
at http://nadon-mugqic.mcgill.ca/.

Contact: robert.nadon@mcgill.ca

Supplementary Information: Supplementary data are available at
Bioinformatics online.

Received on October 24, 2011; revised on July 5, 2012; accepted on
July 13, 2012

1 INTRODUCTION

The effectiveness of high-content screening (HCS) depends
critically on data processing and analysis techniques that are
appropriate to its unique technologies and data formats
(Carpenter, 2007; Kozak et al., 2009; Miron and Nadon, 2006;

 

*To whom correspondence should be addressed.

TPresent address: Etudes et analyses de l’état de santé de la population,
Institut national de santé publique du Quebec, Montreal, Quebec H2P
1E2, Canada

Niederlein et al., 2009; Soleilhac et al., 2010; Wolhnan and
Stuurman, 2007). In particular, image preprocessing, which rep-
resents a conditioning or preparation of the image data, is an
often overlooked but essential step (Hill et al., 2008; Zhou and
Wong, 2008). Image non-uniformity (NU) is a spatially varying
bias that is intrinsic to all image-based biological datasets (Jones
et al., 2008; Lindblad and Bengtsson, 2001; Model and
Burkhardt, 2001; Russ, 2002; Tomazevic et al., 2002). The
quality of image NU bias correction, which occurs during the
preprocessing stage, can affect the validity of all subsequent data
analysis steps which include image quantiﬁcation and statistical
inference. In particular, the methods implemented in these steps
usually presuppose that the incoming image data are free of bias.

Image NU produces a bias in the pixel intensities across
images, which causes objects of interest and their surrounding
background to appear spuriously brighter or darker depending
on their spatial location (e. g. Figure la; Lindblad and Bengtsson,
2001, Figure 10; Russ, 2002, Figures 45 and 51). This can create
difﬁculties in the identiﬁcation of consistent thresholds that dis-
tinguish objects of interest from background and, as a result,
reduce the accuracy of their segmentation. Bias and variability
are also induced in measured cell metrics which depend on both
the pixel intensities and the segmentation step. Reduced quality
in cell metric data reduces the sensitivity and speciﬁcity of hit
identiﬁcation which typically relies on treatment-control com-
parisons of cell-metric-derived statistics (Fenistein et al., 2008).
Cell classiﬁcation accuracy (e.g. Loo et al., 2007) will also be di-
minished if the classiﬁcation criteria depend on pixel intensity in
any way. The within-image spatial variation in cell inten-
sity caused by image NU bias also introduces spurious hetero-
geneity between cells which can obscure the existence of real,
biologically based cell subpopulations, a topic that has gained
recent interest and pertinence (Loo et al., 2009; Slack et al., 2008;
Snijder et al., 2009). In a particular, striking example of the
impact of NU bias, Jones et a]. (2008) show how the separation
of the G1- and M-phase peaks in a cell-cycle classiﬁcation ana-
lysis is obscured by the uncorrected image NU bias. Further
discussion of the impact of image NU on image analysis and
inference can be found in Lindblad and Bengtsson (2001),
Model and Burkhardt (2001), Russ (2002), Tomazevic et a].

 

2632 © The Author 2012. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com

112 /810's113umo [p.IOJXO'SOllBIIIJOJUIOIQ/ﬁdllq 11101; pepBOIUAAOG

9IOZ ‘091sn3nv uo ::

Novel algorithm for the correction of image non-uniformity bias

 

 

Fig. 1. Representative (1028 X 1300 pixel) images of the same ﬁeld taken from the multiparametric assay on microtubule polymerization status; the Cy3
channel (Exc535—Em620nm) is shown. Cells have been treated with colchicine and exhibit an extremely low-intensity (relative to control), depolymerized
phenotype (of also Figure 2b and Supplementary Material Appendix A). All images have been clipped between the 10th and 75th intensity percentiles
which greatly brightens the cell intensities, but permits the NU bias effect at low intensities to become visually apparent. (a) An uncorrected image in
which the slowly varying, parabolic, low-intensity background NU is evident in the spaces between the cells; a NU bias at higher intensities that affects
the cells also exists but is less easily discerned. (b) The result of a multiplicative-only (intensity-independent) correction is shown. This correction works
well for brighter cells, but results in a highly inaccurate removal that augments the low-intensity NU bias. (c) The corrected image after application of the

IQEM algorithm, which removes the NU bias at all intensity quantiles

(2002) and Waters (2009); discussions speciﬁc to an HCS context
can be found in Carpenter et a]. (2006) and Jones et a]. (2008).

In the ﬁeld of HCS, however, the nature of this bias, its impact
on subsequent analyses and appropriate correction methods are
often poorly understood or overlooked, which leads to the choice
of suboptimal correction methods. For example, a large number
of HCS studies make use of background subtraction type algo-
rithms (such as the ‘rolling ball’) which, despite providing visu-
ally appealing results, does not correct the higher cell foreground
intensities whose quantiﬁcation is of paramount interest in HCS
data analysis. Multiplicative correction and calibration-based
methods also have limitations, since HCS assays typically com-
prise extreme ranges of cellular intensities (e. g. Figure 2) and are
also susceptible to instrumental drift effects. In general, various
pre—existing NU bias correction methods and models developed
for low-throughput microscopy, which may be either inappro-
priate for HCS or fail to take advantage of the additional infor-
mation available in high-throughput contexts, have been the
methods of choice for HCS studies.

We present the intensity quantile estimation and mapping
(IQEM) algorithm, a novel image NU correction method that
makes use of the ‘asymptotic spatial homogeneity’ property
found in large throughput (HCS) datasets (of Section 3.1.1
and Supplementary Material Appendix B). (The method is not
applicable to the correction of individual images acquired in a
low throughput setting). The method accounts for characteristics
and analysis objectives of HCS which include (1) large image
datasets that comprise extremely diverse ranges of a priori un-
known cell phenotypes and thus intensity levels; (2) image acqui-
sition times that can extend over days and which lead to
instrumental biases or drifts that can vary with experimental
‘batch’ and (3) the need for multiple inter-image and inter-plate
statistical comparisons over large numbers of images, and the
critical importance of controlling the error rates in the resultant
hit detection. Concepts of image NU bias and limitations of
existing correction methods used in HCS are ﬁrst described, fol-
lowed by a theoretical description and practical implementation
of the IQEM method. Finally, validation tests using simulated

 

Fig. 2. Uncorrected samples of HeLa cells (Cy3 channel) from the
high-content multiparametric assay of microtubule polymerization
status are shown. A sample of typical cells from a DMSO control well
is depicted in (a); cells treated with the depolymerizing agent colchicine,
representing a low intensity ‘hit’ well, are shown in (b) on an intensity
scale that is expanded by 10X

image datasets as well as empirical HCS assay images acquired
from a multiparametric assay on microtubule polymerization
status (of Supplementary Material Appendix A and Vassal
et al., 2006) are shown.

2 THEORY

2.1 Mathematical formulation of image NU bias

The general mathematical formulation for the effect of image
NU is

Imeas(xay)y=fx,y(10bj(xay)y>a 

where ImeaS(x, y),j denotes the measured image intensity corres-
ponding to spatial coordinates x, y for the 1'“ image and 1'“ plate
or experimental batch. [obj-(x, y),j denotes the ‘actual’, unbiased
intensity of the object (e. g. ﬂuorescent cells) under measurement.
ijy is a function that transforms the object intensities and rep-
resents the distortion bias effect of the image NU; the subscript

 

2633

112 /810's112umo [p.IOJXO'SOIJ‘BIHJOJLIIOIQ/ﬂdllq 11101; prBOIIIAAOG

9IOZ ‘091sn3nv uo ::

E.Lo et al.

 

x, y indicates the spatial dependence of the transformation func-
tion. Equation 1 shows that the NU distortion bias represents a
mapping of object intensities to measured intensities, speciﬁc to
each spatial (pixel) location. The objective of NU correction al-
gorithms is to estimate the inverse of the image NU function 
so that the object intensity can be recovered from the measured
intensity:

Iobj(xay)ij :fgz1y(1meas(xa 

It can be shown that a non-linear transformation function of
intensity can also be expressed as an intensity-dependent multi-
plicative factor (of Supplementary Material Appendix C). This
leads to a conceptually useful alternative expression to Equation
(1) for the effect of image NU:

Imeas(xay)ij: ﬂ(xay910bj)jXIobj(xa)/)ija 

where ﬂ is the spatially dependent multiplicative factor that
represents the NU bias effect unique to each intensity.

2.2 Description of existing NU correction methods used in
HCS

Background subtraction, multiplicative correction and calibra-
tion methods are the three most frequently used NU correction
methods in HCS. In these (as well as most other) NU correction
methods, a linear approximation to Equation 1 is used:

Imeas(xay)ij~ M(x9y)jXIObj(x9y)y+A(-xay)'9 

where M (x, y)j and A(x, y)j are multiplicative and additive fac-
tors that describe the effect of the NU bias. A primary advantage
of this simpliﬁed model is that the estimation of the two
intensity-independent factors M and A is much more tractable
than the estimation of the general non-linear function fx,y(10bs)j.

2.2.1 Background subtraction methods In this class of meth-
ods, the image NU is modelled as a purely additive or back-
ground component. (The ‘rolling ball’ algorithm described in
Sternberg (1983) and implemented in the ImageJ software
(Rasband, l997—2011) provides an example.) Its correction
thus consists of the estimation of A(x, y)j and its subsequent
subtraction from the measured image intensities. Using
Equation 4, it can be seen that the corrected image intensities
(ICON) will have the following form:

Icorr(xay)ij = Imeas(xay)ij _ A(xay)j

(5)
= M(x,y)j><10bj(x,y)U-.

It is evident from Equation 5 that despite the removal of the
spatially non-uniform additive component, the cell image inten-
sities remain spatially distorted due to the multiplicative factor
M (x, y), which in general is non-negligible. As a consequence, a
spatial bias in intensity will continue to exist in the corrected
images. Many HCS studies nevertheless make use of only a back-
ground subtraction type method for the removal of image NU. It
is possible that the visual appeal of removing background noise
from images and the relative straightforwardness of the algo-
rithms contribute to the use of this approach. Supplementary
Material Appendix D provides simulation studies and further
detailed discussion on the relative performance of background

subtraction methods as compared to a full non-linear correction
of the NU bias using IQEM.

2.2.2 Multiplicative correction methods In multiplicative
correction methods (often termed ‘shading’ or ‘illumination’ cor-
rection), the image NU is assumed to be dominated by the multi-
plicative factor. The CellProﬁler software (Carpenter et al., 2006)
for example, provides a multiplicative correction option that uses
the ‘image-averaging’ algorithm. This simpliﬁcation is justiﬁable
when the foreground or object image intensities are much
brighter than the background intensities. That is, [obj-(x, y) >>
A(x, y), and therefore ImeaS(x, y) % M(x, y) x Iobj(x, y). NU cor-
rection proceeds by estimating M(x, y) and then dividing the
measured image intensities to estimate the actual image:
I x,
Icorr(xay) : w m Iobj(xay)- 
For most ﬂuorescent microscopy images, the assumption
described by Equation 6 is not unreasonable since the intensity
level of ﬁuorescing cells is generally much brighter than that of
background. HCS assays, however, consist of large-scale image
datasets where libraries of tens of thousands of compounds can
be screened. Within such screens, a small number of wells with
exceedingly low cell intensities may represent critically important
cell populations that exhibit a pronounced response (e.g. apop-
tosis or depolymerization) to treatment (of Figure 2b). For these
cases, [obj-(x, y) % A(x, y) and application of a multiplicative cor-
rection will not accurately remove the image NU spatial bias and
can in fact lead to an augmentation of the bias at low intensities;
an example is shown in Figure lb.

2.2.3 Calibration methods Calibration methods measure a
series of reference (i.e. ﬂat ﬁeld standard) wells prior to imaging
experiments in order to estimate both the additive and multi-
plicative NU components characteristic of the imaging system.
The method is described in a low-throughput microscopy context
by Wolf et al. (2007), Model and Burkhardt (2001) and Souchier
et al. (2003). It is also provided as an option by several commer-
cial HCS image analysis packages including Metamorph®
(Molecular Devices Corp.) and Volocity® (Perkin Elmer, Inc.).
Measurements made on reference wells at a particular point in
time, however, may not be applicable to all of the images mea-
sured over the time course of an HCS assay which can occur over
a period of days or more. Temporal ‘drift’ in the performance of
an imaging system and its components is a well-known phenom-
enon (Jonker et al., 1997; Model and Burkhardt, 2001; Waters,
2009; Wilkinson, 1994) and is caused by factors such as electrical,
thermal and mechanical variations (Dailey et al., 2010). Since
image NU is an artefact produced by imaging instrumentation,
it is highly likely that each experimental batch in an HCS assay
would have its own unique NU bias (\Naters, 2009). As a con-
sequence, images generated in later batches would not be accur-
ately corrected via an estimation made at the beginning of the
experiment. Multiple reference measurements interspersed be-
tween or within experimental batches could potentially address
this problem, but would be time-consuming and likely impracti-
cal to implement within the workﬁow of HCS assays.

In general, image NU consists of both additive and multiplica-
tive components and thus NU correction should not be restricted

 

2634

112 /810's113umo [p.IOJXO'SOllBIIIJOJUIOIQ/ﬁdllq 11101; pepeoIII/noq

9IOZ ‘091snﬁnv uo ::

Novel algorithm for the correction of image non-uniformity bias

 

to the estimation and correction of just one or the other. Within
HCS image datasets, substantial spatial NU bias will likely per-
sist in cells that manifest high-/low-intensity phenotypes when
only background subtraction/multiplicative methods are used.
Non-calibration-based correction of both additive and multi-
plicative NU components, however, requires the implementation
of two separate and very different algorithms that each must be
tested, parameterized and validated (e. g. CellProﬁler; Carpenter
et al. (2006)); a method that could estimate and correct both
components simultaneously would be preferable.

Moreover, the partitioning of image NU into additive and
multiplicative components is itself an approximation to the gen-
eral, non-linear transformation function. For example, the model
of additive background NU subtracts a single threshold intensity
value at each pixel location, A(x, y)-, as an approximation to the
low-intensity background NU, which is in fact a spectrum of
intensities. Any dependence in the NU bias function itself
(fx,y(.)) with intensity within this range is thus neglected. In the
model for the multiplicative component of NU, estimation of the
correction factor, M (x, y) -, is done via a single intensity reference
or mean value (e. g. via calibration or image-averaging methods)
at each pixel location, which presupposes that this factor applies
to the entire range of intensities in the assay. This is an approxi-
mation whose accuracy likely decreases with intensities increas-
ingly different from the reference or mean.

As an alternative, we present the IQEM algorithm that esti-
mates the full non-linear NU function, applies a bias correction
that is appropriate over the full range of intensities present in an
assay and can be implemented in a batch-speciﬁc level to account
for possible experimental drift effects.

3 ALGORITHM
3.1 Theoretical description of the IQEM algorithm

3.1.] Image intensities at each pixel location are statistical
realizations of an intensity quantile function (IQF). Under the
‘asymptotic spatial homogeneity’ condition, the object IQF is
spatially invariant; the measured IQF can be estimated
empirically Consider the distribution of the image intensities
(1(x, y),-) for a speciﬁc pixel location over all images of a particu-
lar experimental batch. This distribution, which comprises all of
the inter-image variations in cell brightness and placement due to
treatment compounds, phenotypes and random variability, can
be described by the IQF Q(x, y, P)j (where P denotes the per-
centiles of the quantile function, which range from 0% to 100%)
(cf. Supplementary Material Appendix E). In well-calibrated
and optimized high-throughput image assays, there should be
no within-image spatial preference for cell brightness or place-
ment that persists systematically over all images. As a result, for
the (unbiased) object intensities, the distribution of possible
inter-image intensities is the same at each pixel location, and
therefore

Q0bj<xaya Pobj)j% Q0bj<P0bj)J-- 

Furthermore, in the (asymptotic) limit as the number of
images (nj) becomes sufﬁciently large, the IQF for the measured

image intensities can be estimated empirically from the observed
intensity values over all images in the batch:

n1g<Qmeas(Plxa)/)>j = QmeaS(P|x9y)j'

The above results comprise the ‘asymptotic spatial homo-
geneity’ condition, which is also assumed in multiplicative NU
correction methods that use the image-averaging approach.
(Further details are provided in Supplementary Material
Appendix B.)

3.1.2 The eﬂect of N U bias can be expressed as a mapping of the
intensity quantiles 0f the object IQF t0 the measured IQF Both
the measured and object intensities can be associated with the
corresponding percentiles of their IQFs; thus Equation 1 can be
written as ImeaS(Pmeas, x, y),j=fx,y(10bj(P0bJ-, x, y),-j). Assuming that
ijy is monotonic in P and does not scramble the order of the
object intensity quantiles, then Pmeas = Pobj = P, and therefore
ImeaS(P, x, y),j=fx,y(10bj(P, x, y),-j). Thus, it can be seen that the
effect of the image NU is to map object intensities to measured
intensities while preserving the associated percentile. Note that
the IQFs can be thought of as sets of intensity—percentile pairs.
When f,” is applied to the IQFs, the effect is to map the object
IQF to a measured IQF. Thus,

Qmeas(P9 x9 y)j=fx,y(Q0bj(P)j)- 

Therefore, if both the object intensity and measured IQFs
could be measured, then the NU bias function ijy and its in-
verse, fgly, could be estimated.

3.1.3 Removal of the eﬂect of N U bias can be achieved by map-
ping the measured intensities at each spatial location to an arbi-
trary reference IQF The object IQF is intrinsically unknowable
since object intensities cannot be measured without NU bias.
Consider, however, an arbitrary reference IQF, Qref(P)J-. Let
ngy be the function that monotonically maps the measured
IQF at each pixel location to Qre/(P)j. Then Qre/(P)j=
gx,y(Qmeas(P, x, y)) and also IreﬁP, x, y),j= gx,y(1meas(P, x, y),-).
Since both Qmeas(P, x, y),j and Qref(P)j are known, the function
g,” can be estimated. Application of the mapping transform-
ation g,” to all the pixels in an image removes the spatial dis-
tortion effect of NU bias since the IQFs of the resulting
transformed image will be spatially invariant and equal to
Qref(P)j. Furthermore, as Ire/(P, x, y),-j= gx,y(fx,y(10bj(P, x, y),))
and gx, y(fx, y(.)) is also a monotonic transformation, the ordering
of the intensity quantiles in the mapped image is unchanged from
those of the unbiased image, Qobj(P)j. If Qref(P)j is then chosen
from the IQF at the centre of the measured images, its distribu-
tional form should be quite close to that of Q,,bj-(P)j (since the
region with least NU distortion is typically close to the image
centre). As a result, mapping of the measured intensities to
Qref(P)j will remove the spatially varying NU while preserving
the intensity-based information in Q,,bj-(P)j (i.e. image processing
and statistical operations will be either unchanged or minimally
perturbed).

3.2 Implementation of the IQEM algorithm

The IQEM correction is implemented in two stages, as shown in
Figure 3. In the estimation stage (Stage 1), the measured and

 

2635

112 /810's113umo [p.IOJXO'SOIlBIHJOJUIOIQ/ﬁdllq 11101; pepeoIII/noq

9IOZ ‘091snﬁnv uo ::

E.Lo et al.

 

 

{lmeas(X,y)ij}

I I I I I

 

 

 

 

 

 

I
I

I I I
I I I I I I I I I

 

0(X1,y1,P)

(d)

Intensity

 

 

(Xslys)

 

 

 

E
l
O(X2,y2, P)

I

Q

0(X3,y3, P)

I
L 95913

 

 

 

   
 
 

0 Reference IQF
0 Measured IQF

600

400
a 95913

Pref: 80‘7
Iref z 325‘ """""""""""""""" "I

Imeas z 250 ................ __

 
 
   
  

200

 

,._..,—_—.-:-: Pmeasiz 80%
0% 25% 50% 75% 99%
Percentile

‘:;"

 

 

 

Fig. 3. The sequence of steps in the IQEM algorithm is depicted. In Stage
1, the measured and reference IQFs are estimated; in Stage 2, the NU bias

is corrected v

ia a mapping of pixel intensities

reference IQFs for the image batch of interest are estimated; in
the correction stage (Stage 2), the inverse mapping function ngy
is applied to correct each of the measured images. Details of the
algorithm are provided below.

Stage 1,

Stage 1,

Step 1: A spatial grid is chosen for the initial esti-
mation of the intensity-dependent NU variation
across images. In the present study, a grid of 25 x
20 = 500 elements is used for all quantiles and allows
for an adequate ﬁt to the NU variation which in
general varies relatively slowly across the image.
For images that are 1300 x 1028 pixels in size, this
results in approximately 52 X 50:2600 pixels per
grid element. Note that if the spatial grid is chosen
too ﬁnely, the number of pixels per grid element will
be reduced, which may diminish the precision of the
estimated IQFs (of Section F3, Supplementary
Material Appendix F). This step is depicted in
Figure 3a.

Step 2: The pixel intensities within each spatial grid
element and over all images in an experimental batch

are aggregated, and the corresponding IQF is deter-
mined from the quantiles of the resulting distribu-
tion. In the present study, with each experimental
batch consisting of 768 images (corresponding to a
96-well plate with eight image ﬁelds per well), each
IQF was formed from the aggregation of
2600 X 768 = 1996800 pixels. The measured IQFs
were stored as vectors of intensity values estimated
for a grid of pre—speciﬁed percentiles. This step is
depicted in Figure 3b (of also Section F4,
Supplementary Material Appendix F). Examples of
IQFs are shown in Figure 3d.

Stage 1, Step 3: The spatial variation (over grid elements) of
the intensities corresponding to each quantile
represents the empirical estimate of the image NU
distortion bias at that intensity quantile. Proﬁles of
the spatial NU for several quantiles from
the assay of the current study are shown in
Figure 4d-i. Note the slowly varying, parabolic vari-
ation across the image that is characteristic of image
NU. 2D quadratic functions (of the form,
y = b0 —I— blx2 —I— by2 —I— b3x —I— b4y —I— b5xy) are ﬁtted
using multiple linear regression to the spatial inten-
sity variation for each quantile (Figure 30; cf. also
Supplementary Material Appendix G); log trans-
formation of the intensity quantiles was done
before ﬁtting, to stabilize the variance. A vector of
6 coefﬁcients is thus computed for each intensity
quantile, and these permit the ﬁne-scale computation
of the IQFs at each pixel location during the correc-
tion process. Figure 5 shows representative plots of
the b1 (quadratic) coefﬁcient versus percentile, for
the Cy3 channel, for three different replicate plates.
Note the variation in the coefﬁcients (and hence vari-
ation in the shape of the NU bias) with percentile,
illustrating the pertinence of the full non-linear NU
model. Note also that the estimated coefﬁcients vary
smoothly, indicating that the image population sizes
chosen provide adequate precision.

Stage 2, Step 1: For each pixel location in a measured image,
the IQF, Qmeas(P, x, y)-, is computed over pre-
speciﬁed percentiles, using the 2D quadratic func-
tions. Using the estimated IQF, the percentile asso-
ciated with the measured intensity value at each pixel
is determined. This is depicted in Figure 3d.

Stage 2, Step 2: The intensity value in the reference IQF,
Qref(P)-, that coincides with the identiﬁed percentile
is determined. The pixel intensities in the corrected
image are set (i.e. mapped) to these intensity values,
as depicted in Figure 3d.

Further technical details, sensitivity studies and guidelines
related to the selection of the IQEM algorithm spatial grid
(Stage 1, Step 1), percentile grid (Stage 1, Step 2), the effect of
image number, quadratic ﬁtting (Stage 1, Step 3) and algorithm
run-time are provided in Supplementary Material Appendices F
(Sections F3, F4 and F5), G and H.

 

2636

112 /§.IO'SIBUJHOIPJOJXO'SOIlBIHJOJUIOICI/ﬁdllq 11101; pepeoIII/noq

9IOZ ‘091Sm3nv uo ::

Novel algorithm for the correction of image non-uniformity bias

 

4 VALIDATION
4.1 Validation tests

The objective of the validation tests is to demonstrate two as-
pects: (1) that the algorithm does not alter the pixel intensity of
images when there is no NU present and (2) that the algorithm
can correctly detect and remove a known, imposed image NU
(e.g. Tomazevic et al., 2002). Validation tests of the IQEM
algorithm were ﬁrst performed on simulated image datasets,
which are described in Sections 4.1.1—4.l.3; further details of
the simulated datasets are provided in Supplementary Material
Appendix I. Next, a ‘self-consistency’ test using real HCS images
is described in Section 4.1.4. Each validation dataset consists of
768 images; each individual image measures 1300 X 1028 pixels in
dimension.

The results of each validation consist of proﬁles of
Qmeas(P, x, y)j that are estimated and then ﬁtted by the IQEM
algorithm. Proﬁles are shown at four representative percentiles,
P = 25%, 50%,75%,90%, and plotted along the central long
axis of the images. The estimated intensity quantile proﬁles
were determined via aggregation across images while ﬁtted in-
tensity quantile proﬁles correspond to the ﬁtted 2D quadratic
function, as described in Section 3.2.

4.1.1 Simulated images contain no NU and consist of random
noise For the simulated images in this validation dataset, each
pixel is assigned an intensity value that is generated from a
positive-constrained normal distribution. This validation test
thus represents the simplest ‘null’ test as there is no spatial uni-
formity in the images nor are there ‘objects’ of any kind. As
shown in Figure 4a, the IQEM algorithm does not detect any
discernible image NU in any of the intensity quantiles.

4.1.2 Simulated images contain no NU and consist of both cells
and noise Next, an image dataset with both noise and simu-
lated cells is tested. Simulated cells consisted of truncated bivari-
ate Gaussian intensity functions, with peak intensity, x— y
correlation, spatial placement and number of cells determined
randomly over ranges of values chosen to mimic real cell

(a) (b) (C)

(cl-i) (d-ii)

populations (of Supplementary Material Appendix Ib). Both
multiplicative and additive noise were also added. Despite
the much greater spatial heterogeneity produced by the
simulated cells, the IQEM algorithm correctly detects no image
NU, as shown by the ﬂat measured and ﬁtted intensity proﬁles
(Figure 4b).

4.1.3 Simulated images consist of both cells and noise, with a
non-linear NU imposed A parabolic NU is applied only to
pixel intensities that are higher than the 85th intensity percentile
of the simulated image dataset from Figure 4b. The IQEM al-
gorithm correctly detects and ﬁts this highly non-linear NU bias,
as shown by the ﬂat ﬁtted proﬁles corresponding to the 25th,
50th and 75th percentiles and the parabolic NU that is detected
for the 90th quantile (Figure 4c). The imposed NU was centred
at 900 units (of Supplementary Material Appendix Ic), which is
also accurately detected.

4.1.4 NU correction of C y3 channel images ofHeLa cells from a
microtubule polymerization assay The IQEM algorithm is
applied to actual images from the multiparametric assay of
microtubule polymerization status (of Supplementary Material
Appendix A, Lafanechere, 2008; Vassal et al., 2006). The tested
image batch was acquired on Day 2 of the assay and consists of
lysed cells acquired on the Cy3 channel (which corresponds to
Tyr-tubulin cell content). The algorithm detects a pronounced
image NU present in all intensity quantiles as shown in
Figure 4d-i. Figure 4d-ii shows proﬁles of the ratio between
the ﬁtted intensity and that measured at the image centre, for
each quantile. In the ratio proﬁles, the intensity dependence in
both the shape and curvature of the image NU can be more
clearly seen—while the image NU is approximately symmetric
at lower intensity quantiles, it becomes markedly off-centre at
higher intensity levels.

Absolute validation of NU correction algorithms on real
images is not possible since the actual NU distortion bias is in-
trinsically unknown. However, a self-consistency test is possible
in that a correction algorithm should not detect further NU bias
on images that have already been corrected once. Figure 4d-iii

(d-iii)

 

W

 

 

 

 

 

 

 

 

H.
an. a. n. A"! "" "'

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

l 650 1300 l 650 1300 l 650 1300 1

Distance lPixeis} Distance lPiaels} Distance lPixelsi

650 1300 l 650 1300' l 650 1300

Distance IPIxels} Distance lPixels} Distance IF‘iitels]I

Fig. 4. The results of the validation tests. Plots (a), 0)), (c), (d-i) and (d-iii) show proﬁles of measured and ﬁtted intensity quantiles, for four representative
percentiles (P = 25 %, 50%, 75%, 90%), plotted on a log(intensity) scale. The units of intensity vary between image sets and are not shown. (d-ii) Plots of
the intensity ratio at each position along the proﬁle relative to intensity value at the centre of the image, for the image set of (d-i)

 

2637

112 /810's113umo [p.IOJXO'SOIlBIHJOJUIOIQ/ﬁdllq 11101; pepeoIII/noq

9IOZ ‘091Sm3nv uo ::

E.Lo et al.

 

shows the results of such a test, where a second-pass run of the
IQEM algorithm is performed on the images pertaining to
Figure 4d-i. The resulting measured and ﬁtted proﬁles across
all intensity quantiles are ﬂat, demonstrating that the IQEM al-
gorithm detects no NU bias once the images have been corrected.

Finally, Figures 1a and 10 represent a qualitative, visual val-
idation of the IQEM algorithm performance; the NU bias at
very low intensities that is visually evident in the background
between cells of an uncorrected image (Figure 1a) is no longer
apparent in the corrected image shown in Figure 10.

4.2 Variability of NU bias according to experimental
batch

As described in Section 2.1, various experimental factors could
cause NU bias to vary over the course of an HCS assay. For the
microtubule depolymerization assay, a single setting was used for
the imaging system throughout the assay. However, while wells
within plates were imaged consecutively and close together in
time (<2s between images), the time interval between plates
was variable and ranged from 10min to more than an hour for
plates acquired on the same day, and more than 16h for con-
secutive plates acquired between different days. For this reason,
the IQEM correction method was applied on a plate-speciﬁc
basis. Correction results were then examined for possible
plate-speciﬁc variation in the NU bias. Figure 5 shows plots of
a representative ﬁtted quadratic coefﬁcient (b1) to the NU spatial
bias function versus percentile, for the Cy3 channel. Each curve
corresponds to a replicate plate that was measured on one of
three different days. It can be seen that the ﬁtted coefﬁcients
for plate 1 show a systematic deviation from that of the other
two days, demonstrating the phenomenon of batch-speciﬁc
image NU bias.

5 DISCUSSION

The IQEM algorithm represents an improvement over existing
methods of image NU correction used in HCS, which are based
on varying degrees of simpliﬁcation to a linear model approxi-
mation of NU bias. By estimating the full non-linear form of the
NU bias, the IQEM method essentially applies a correction
factor that is appropriate to each intensity quantile in the mea-
sured image. The method is particularly pertinent for the

 

l.
'o

|
[D
O

       

   

O Plate1
A Plate5
I:I Plate9

|
p)
O

 

 

Quadratic Coefficient (x10'7)

 

5 25 50 75 95
Intensity Percentile (%)

Fig. 5. The ﬁtted quadratic coefﬁcient for the NU bias is shown plotted
versus intensity percentile for three different replicate plates

quantiﬁcation of extremely low-intensity cell phenotypes, where
multiplicative correction provides an inaccurate ﬁt to the
low-intensity image NU, and where background subtraction
does not adequately model the range of dim intensity levels.
An additional positive feature of the IQEM algorithm is that it
can be applied on a batch-speciﬁc basis such that a unique image
NU correction is estimated for each batch.

The IQEM method does require that cell placement and in-
tensity are spatially homogeneous within images (i.e. that the
asymptotic spatial homogeneity condition holds). Assays that
have been properly calibrated, and for which there are no sys-
tematic within-image gradients caused by poor optical focus,
non-uniform ﬁuorophore or reagent concentrations or cell dens-
ity gradients (of Supplementary Materials Section B.5), for
example, should satisfy this condition. The measurement of mul-
tiple ﬁelds within wells, a standard practice in HCS, further
ensures that on average, the spatial homogeneity condition will
hold. Although the IQEM algorithm may be more complex than
other conventional methods of NU bias correction, it is readily
automated, and its complexity will not be apparent from the
user’s perspective once integrated into an image-processing
pipeline.

The IQEM algorithm arose during the analysis of the multi-
parametric assay of microtubule status, in which a method of
batch-speciﬁc NU bias correction effective for very low-intensity,
depolymerized phenotypes was needed (Lo, 2009). The develop-
ment of IQEM provides an illustration that methods adopted
from low-throughput science may not necessarily be optimal in
a high-throughput context, which involves the analysis of
large-scale image datasets, the testing of compound libraries
that produce extremely diverse ranges of a priori unknown cell
phenotypes/intensities and requires statistical comparisons of
metrics taken across the dataset. It should further be noted
that while high-throughput, high-content datasets provide chal-
lenges to analysis methods (Lang et al., 2006; Soleilhac et al.,
2010; Vizeacoumar et al., 2009; Wollman and Stuurman, 2007),
they also provide opportunities. In the present case for example,
the enormous size of HCS image datasets, which consist of
images that are effectively statistical replicates within each experi-
mental batch, makes possible the existence and estimation of the
inter-image IQF; estimation of this entity in turn makes possible
the inversion of the non-linear NU bias function via a mapping
of intensity quantiles.

In general, HCS systems comprise and integrate many com-
plex state-of-the-art subsystems, ranging over biological experi-
mentation (cell cultures and immunoﬁuorescence staining for
example), automated image acquisition, imaging instrumentation
and image processing, each of which acts to produce or condition
the high-content data, and also to contribute bias and variability
that determine the resultant statistical characteristics of the data
(Soleilhac et al., 2010). By more fully understanding the technical
and technological issues of each subsystem within an HCS work-
ﬁow, it becomes possible to better model the statistical distribu-
tion of the data, and thus to improve the sensitivity and
speciﬁcity of statistical inference methods used to draw scientiﬁc
conclusions from HCS experiments. The current work represents
a step in this direction, in the context of the image NU bias
produced by HCS imaging instrumentation.

 

2638

112 /810's113umo [p.IOJXO'SOIlBIHJOJUIOIQ/ﬁdllq 11101; pepeoIII/noq

9IOZ ‘091Sm3nv uo ::

Novel algorithm for the correction of image non-uniformity bias

 

Funding: This work was supported by Le Fonds Quebecois de la
Recherche sur la Nature et les Technologies (FQRNT) grant
119258 (Statistical Methods for High-Throughput Screening),
by grants from the French National Genopole and from the
French GIS IBiSA, by the Centre National pour la Recherche
Scientiﬁque (CNRS) and the Commissariat a l’Energie
Atomique (CEA), and by National Sciences and Engineering
Research Council [Alexander Graham Bell Canada Graduate
Scholarship] and Fonds de la Recherche en Santé [Bourse de
Formation de Maitrise] scholarships to BL.

Conflict of Interest: none declared.

REFERENCES

Carpenter,A.E. (2007) Image-based chemical screening. Nat. Chem. Biol, 3,
461—465.

Carpenter,A.E. et al. (2006) CellProﬁler: image analysis software for identifying and
quantifying cell phenotypes. Genome Biol, 7, http://genomebiology.com/
2006/7/10/R100/.

Dailey,M. et al. (2010) Maintaining live cells on the microscope stage. Microscopy U,
Nikon.

Fenistein,D. et al. (2008) A fast, fully automated cell segmentation algorithm for
high-throughput and high-content screening. Cytometry Part A, 73 A, 958—964.

Hill,A.A. et al. (2008) Analysis of multiparametric HCS Data. Haney,S. (ed.) High
Content Screening Science, Techniques, and Applications. John Wiley & Sons,
Hoboken, NJ, pp. 329—354.

J ones,T.R. et al. (2008) Methods for high-content, high-throughput image-based
cell screening. Rittcher,J., Machiraju,R. and Wong,S.T.C. (eds) Microscopic
Image Analysis for Life Science Applications. Artech House Publishers,
Norwood, MA, pp. 209—221.

J onker,A. et al. (1997) Basic strategies for valid cytometry using image analysis.
Histochem. J., 29, 347—364.

Kozak,K. et al. (2009) Data mining techniques in high content screening: a survey.
J. Comput. Sci. Syst. Biol, 2, 219—239.

Lafanechere,L. (2008) Chemogenomics and cancer chemotherapy: cell-based assays
to screen for small molecules that impair microtubule dynamics. Comb. Chem.
High Throughput Screen, 11, 617—623.

Lang,P. et al. (2006) Cellular imaging in drug discovery. Nat. Rev. Drug Discov., 5,
343—356.

Lindblad,J. and Bengtsson,E. (2001) A comparison of methods for estimation of
intensity nonuniformities in 2D and 3D microscope images of ﬂuorescence
stained cells. Proceedings of the 12th Scandinavian Conference of Image
Analysis. Bergen, Norway, pp. 264—271.

L0,E. (2009) Statistical Analysis of a High-Content Screening Assay of Microtubule
Polymerization Status. M.Sc. Thesis. Department of Epidemiology. Biostatistics
and Occupational Health. McGill University, Montreal, Quebec. p. 123.

Loo,L.-H. et al. (2009) An approach for extensibly proﬁling the molecular states of
cellular subpopulations. Nat. Methods, 6, U759—U718.

Loo,L.-H. et al. (2007) Image-based multivariate proﬁling of drug responses from
single cells. Nat. Methods, 4, 445—453.

Miron,M. and Nadon,R. (2006) Inferential literacy for experimental high-
throughput biology. Trends Genet, 22, 84—89.

Model,M.A. and Burkhardt,J.K. (2001) A standard for calibration and shading
correction of a ﬂuorescence microscope. Cytometry, 44, 309—316.

Niederlein,A. et al. (2009) Image analysis in high content screening. Comb. Chem.
High Throughput Screen, 12, 899—907.

Rasband,W.S. (1997—2011) ImageJ. US. National Institutes of Health, Bethesda,
MD.

Russ,J. (2002) The Image Processing Handbook. 4th edn. CRC Press, Boca Raton,
FL, USA.

Slack,M.D. et al. (2008) Characterizing heterogeneous cellular responses to perturb-
ations. Proc. Natl. Acad. Sci. USA., 105, 19306—19311.

Snijder,B. et al. (2009) Population context determines cell-to-cell variability in endo-
cytosis and virus infection. Nature, 461, 520—523.

Soleilhac,E. et al. (2010) High-content screening for the discovery of pharmaco-
logical compounds: advantages, challenges and potential beneﬁts of recent
technological developments. Expert Opin. Drug Discov., 5, 135—144.

Souchier,C. et al. (2003) Data reproducibility in ﬂuorescence image analysis.
Methods Cell Sci, 25, 195—200.

Sternberg,S.R. (1983) Biomedical image-processing. Computer, 16, 22—34.

Tomazevic,D. et al. (2002) Comparative evaluation of retrospective shading correc-
tion methods. J. M icrosc., 208, 212—223.

Vassal,E. et al. (2006) Miniaturization and validation of a sensitive multiparametric
cell-based assay for the concomitant detection of microtubule-destabilizing and
microtubule-stabilizing agents. J. Biomol. Screen, 11, 377—389.

Vizeacoumar,F.J. et al. (2009) A picture is worth a thousand words: Genomics
to phenomics in the yeast Saccharomyces cerevisiae. FEBS Lett., 583,
1656—1661.

Waters,J.C. (2009) Accuracy and precision in quantitative ﬂuorescence microscopy.
J. Cell Biol, 185, 1135—1148.

Wilkinson,M.H.F. (1994) Shading correction and calibration in bacterial ﬂuores-
cence measurement by image-processing system. Comput. Methods Prog.
Biomed, 44, 61—67.

Wolf,D. et al. (2007) Quantitative analysis of digital microscope images. Sluder,G.
and Wolf,D. (eds) Digital Microscopy. Elsevier Inc., pp. 365—396.

Wollman,R. and Stuurman,N. (2007) High throughput microscopy: from raw
images to discoveries. J. Cell. Sci, 120, 3715—3722.

Zhou,X. and Wong,S.T.C. (2008) A Primer on image informatics of high content
screening. Haney,S. (ed.) High Content Screening Science, Techniques, and
Applications. John Wiley & Sons, Hoboken, NJ, pp. 43—84.

 

2639

112 /810's113umo [pJOJXO'SOIlBIIIJOJUIOIQ/ﬁdllq 11101; prBOIIIAAOG

9IOZ ‘091Sm3nv uo ::

