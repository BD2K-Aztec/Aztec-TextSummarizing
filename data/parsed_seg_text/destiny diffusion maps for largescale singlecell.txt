Diffusion maps are a spectral method for non-linear dimension reduction and have recently been adapted for the visualization of single cell expression data. Here we present destiny, an efficient R implementation of the diffusion map algorithm. Our package includes a single cell specific noise model allowing for missing and censored values. In contrast to previous implementations , we further present an efficient nearest neighbour approximation that allows for the processing of hundreds of thousands of cells and a functionality for projecting new data on existing diffusion maps. We exemplar ily apply destiny to a recent time resolved mass cytometry dataset of cellular reprogramming. Availability and implementation: destiny is an open source r bioconductor package  bioconductor org packages destiny  also available at www helmholtz muenchen de icb destiny. A detailed vignette describing functions and workflows is provided with the package.

introduction recent technological advances allow for the profiling of individual cells, using methods such as single cell rnase q single cell RT qPCR or cyt of (). These techniques have been used successfully to study stem cell differentiation with time resolved single cell experiments, where individual cells are collected at different absolute times within the differentiation process and profiled. While differentiation is a smooth but nonlinear process () involving continuous changes of the overall transcriptional state, standard methods for visualizing such data are either based on linear methods such as Principal Component Analysis (see Supplementary) and Independent Components Analysis or they use clustering techniques not accounting for the smooth nature of the data. In contrast, diffusion maps initially designed by for dimensionality reduction in image processing recover a distance measure between each pair of data points (cells) in a low dimensional space that is based on the transition probability from one cell to the other through several paths of a random walk. Diffusion maps are especially suited for analysing single cell gene expression data from differentiation experiments (such as time course experiments) for three reasons. First, they preserve the global relations between data points. This feature makes it possible to reconstruct developmental traces by re-ordering the asynchronously differentiating cells according to their internal differentiation state. Second, the notion of diffusion distance is robust to noise, which is ubiquitous in single cell data. Third, by normalizing for sampling density, diffusion maps become insensitive to the distribution of the data points ie. sampling density), which aids the detection of rare cell populations. Here, we present a user friendly R implementation of diffusion maps including previously proposed adaptations to single cell data () as well as novel functionality. The latter includes approximations allowing for the visualization of large data sets and the projection of new data on existing maps.

application we applied destiny to four single cell datasets of different size (hundreds to hundreds of thousands of cells) and characteristics qrt pcr rnase q and mass cytometry, see Supplementary). We first estimate the optimal r that matches the intrinsic dimensionality of the data (and Supplementary Figs S3A and S4A). Using a scree plot (and Supplementary Figs S3B, S4B and S5A), the relevant diffusion components can be identified. However, for big datasets as the mass cytometry data from with 256 000 cells and 36 markers, corresponding Eigenvalues decrease smoothly. Although only a part of the intrinsic dimensionality can be represented in a 3D plot, the diffusion map reveals interesting properties of the reprogramming dynamics (and Supplementary). We compared destiny's performance to other implementations, including our own in MATLAB (based on maggio ni code (http://www.math.duke.edu/mauro/code.html), published with) and the diffusion map R package (). destiny performs similarly well for small datasets, while outperforming other implementations for large datasets (Supplementary).
