Motivation: The analysis of differential abundance for features (e.g. species or genes) can provide us with a better understanding of microbial communities, thus increasing our comprehension and understanding of the behaviors of microbial communities. However, it could also mislead us about the characteristics of microbial communities if the abundances or counts of features on different scales are not properly normalized within and between communities, prior to the analysis of differential abundance. Normalization methods used in the differential analysis typically try to adjust counts on different scales to a common scale using the total sum, mean or median of representative features across all samples. These methods often yield undesirable results when the difference in total counts of differentially abundant features (DAFs) across different conditions is large. Results: We develop a novel method, Ratio Approach for Identifying Differential Abundance raid a which utilizes the ratio between features in a modified zero inflated lognormal model. raid a removes possible problems associated with counts on different scales within and between conditions. As a result, its performance is not affected by the amount of difference in total abundances of DAFs across different conditions. Through comprehensive simulation studies, the performance of our method is consistently powerful, and under some situations, raid a greatly surpasses other existing methods. We also apply raid a on real datasets of type II diabetes and find interesting results consistent with previous reports. Availability and implementation: An R package for raid a can be accessed from

introduction meta genomics is the study of microbes by analyzing the entire genomic sequences directly obtained from environment samples, bypassing the need for prior cloning and culturing of individual microbes (). This has been a tumultuous obstacle to overcome for the purposes of studying the structural entirety of a microbial community, primarily because more than 99% of microbes can not be isolated and independently cultured in laboratories (). The field of meta genomics has attracted researchers of diverse backgrounds, including microbial ecology, biosciences and health and medical sciences, due to the increasing availability of high throughput sequencing technologies (). An important application of meta genomics is the identification of differentially abundant features (DAFs), which can be either taxonomic units (e.g. species) or functional units (e.g. genes) across different environmental (including host associated conditions (). Detection of differentially abundant microbes across healthy and diseased populations, for instance, can enable us to identify potential pathogens or probiotics in the differential analysis, normalization is an essential step as demonstrated in many previous studies on RNA sequencing rnase q and meta genomic sequencing data. Several normalization approaches have been proposed, including total count (TC), upper quartile, trimmed mean of M values (TMM), cumulative sum scaling, etc. (). Although these methods differ in the choices of representative features used to account for samples on different scales, they all, implicitly or explicitly, adjust counts (i.e. the number of sequence reads assigned to each feature) measured on different scales to a common scale using the total sum, mean or median of the counts of the representative features. For instance, TC uses all features in a sample as representative features and normalizes counts with the total sum. TMM () uses trimmed features, which are the remaining features after removing some upper and lower percentage of the data based on the gene-wise log fold changes and absolute expression levels, as representative features to adjust library sizes and normalizes counts with the mean of the adjusted sizes. These approaches of rescaling counts are appropriate for either estimating proportions of features for the samples under the same biological environmental condition or comparing overall patterns of compositions of features for the samples under different conditions. However, they are not conducive for identifying individual DAFs across different conditions. As an illustration, consider two different regions, each containing 100 chickens, 100 pigs and 100 cows, respectively. After an Avian Influenza outbreak, half of the chicken population in region one was eradicated. The proportions of these animals in each region or the overall difference in the composition of these animals in the two regions can be well estimated by the approaches of rescaling counts. Now, we wanted to identify which animals are different in their abundances across the two regions. The approaches involving rescaling counts would find that all the animals are different (e.g. 20:40:40 versus 33:33:33 percent in abundances for chickens, pigs and cows in this order). However, we would reject this result because clearly the change in abundance occurred only in the chicken. A similar conclusion should be made in the comparison of microbes even though we can not directly observe their changes in abundance. This by no means disparages the aforementioned methods. In fact, these methods perform well when the differences in total abundances of DAFs across different conditions are small, that is, the change in proportions of non dafs across different conditions is small, which we denote by the balanced conditions. However, the reliability of their results can not be assessed unless we have such prior information. Throughout this article, we use the terms balanced conditions and unbalanced conditions, where the latter is used to describe a situation whereby the difference in total abundances of DAFs across different conditions is large, thus affecting proportions of non dafs. An example is provided in for illustrative purposes. In this example, the proportion of the total abundance of non dafs is 300/500  60% for both conditions under the balanced case, while it is changed from 300/350  86% to 300/500  60% between two conditions under the unbalanced case. To identify DAFs consistently without being confounded by the amount of difference in total abundances of DAFs across different conditions, we propose a new approach, called Ratio Approach for Identifying Differential Abundance raid a with the assumption that majority of features are not differentially abundant. This is the same assumption used for genomic studies in de seq () and edgeR (). In fact, this assumption is stronger than necessary in most cases (See the proof of Proposition in Supplementary File). raid a utilizes the ratios between the counts of features in each sample, eliminating possible problems associated with counts on different scales within and between conditions. meta genomic sequencing data are sparse, i.e. containing a lot of zeros. To account for ratios with zeros, we use a modified zero inflated lognormal (ZIL) model with the assumption that most of the zeros come from under sampling () of the microbial community or insufficient sequencing depth. We evaluated raid a through comprehensive simulated studies and compared the results with those of meta stats () and meta genome seq (), which were developed for a meta genomic and a microbial marker gene analysis, respectively. In the comparison, we also included a representative method for rnase q analysis, edgeR, which uses TMM as a default normalization method. Compared with the other methods, raid a gives equivalent performance in the balanced conditions and improved performance in the unbalanced conditions. Above all, raid a performs consistently for both the balanced and unbalanced conditions. The consistency of the performance should be highly valued, since most of time there is no sufficient prior information about samples available. In other words, it is unlikely to know ahead that conditions to be compared are balanced or unbalanced. We also applied raid a on a subset of real data selected from the original datasets in the meta genomic study of diabetes (). raid a identified two differentially abundant bacteria, Clostridium botulinum and Clostridium cellu lov or an s across fecal DNA samples of the type II diabetics and non-diabetic controls at the false discovery rate (FDR)  0.05. These bacteria appear in the KEGG pathways for type II and type I diabetes mellitus, respectively. The raid a method is developed for the analysis of differential abundance between two conditions of samples such as healthy versus diseased. However, it can be extended to detect DAFs in meta genomic samples under more than two conditions. community (false zeros). All zeros remain unchanged after transforming the count data into ratio data using a common divisor. It can be a vector of the counts of a feature consisting of non-zeros in all samples or a vector of the sums of a group of features consisting of non-zeros in all samples. To fit ratios with zeros, we use a modified ZIL. Note a lognormal distribution has been used as a fundamental distribution for non-zero ratios in the compositional data analysis (). Let c ij denote the observed count for feature i and sample j, and r ij denote the ratio of c ij to c kj , where k represents a feature (or a set of features) used as a divisor and c kj  0 for all j. Here, i  1; 2;. .. ; n and j  1; 2;. .. ; m. Throughout this article, we denote under sampling of the microbial community or insufficient sequencing depth by the false zero state. Assuming a ZIL model for the ratio R ij , we have this model does not account for zero counts from the true zeros since the support for a lognormal distribution is 0; 1; that is, r ij is assumed to be in the false zero state if c ij  0, whether or not the zero count comes from the false zero state. To accommodate for this insufficiency, a small number is added to c ij for all i and j before computing the ratios. We denote the ratio computed this way as R ij and we have in this study, we use  min r ij jr ij  0 for all i and j. The parameters h i  g i ; l i ; r i  are estimated by the following expectation maximization (EM) algorithm.
