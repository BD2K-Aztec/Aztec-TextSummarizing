Motivation: Cell fate decisions have a strong stochastic component. The identification of the underlying mechanisms therefore requires a rigorous statistical analysis of large ensembles of single cells that were tracked and phenotype d over time. Results: We introduce a probabilistic framework for testing elementary hypotheses on dynamic cell behavior using time-lapse cell imaging data. Factor graphs, probabilistic graphical models, are used to properly account for cell lineage and cell phenotype information. Our model is applied to time-lapse movies of murine granulocyte macrophage progenitor (GMP) cells. It decides between competing hypotheses on the mechanisms of their differentiation. Our results theoretically substantiate previous experimental observations that lineage instruction, not selection is the cause for the differentiation of GMP cells into mature monocytes or neutrophil granulocytes. Availability and implementation: The Matlab source code is available at

introduction cell fate decisions appear as robust phenomena on the tissue level. However, the underlying mechanisms are hidden behind a large variability on the level of individual cells. The deterministic and the stochastic components of these decision processes can only be identified through the statistical analysis of a large number of cells. High content live cell time-lapse imaging has become a major technique for the investigation of cell behavior (). The amount of data produced by this method requires automation at all stages, starting from cell identification and tracking of cells, the extraction of relevant morphological features from single cell images, up to the biological interpretation of the results. Excellent bioinformatics tools have been developed for the purpose of cell identification, cell tracking and feature extraction (). So far, biological analysis of time-lapse movies focused on the detection of abnormal cell phenotypes after introducing perturbations like RNA interference ().This led to the development of hidden Markov models that, either in a supervised or in an unsupervised fashion, classify cells according to their morphology and their environmental context (). In this work, we develop a factor graph model, which provides a probabilistic framework for testing the compatibility of biological hypotheses with time-lapse imaging data. Such data allow the tracking of individual cells, comprising all of their progeny over extended time periods. For each cell image, features like morphology, cell cycle time, or motility can be extracted. All these different pieces of information on cellular development, divisional history and differentiation can be summarized into a pedigree like structure, termed cellular genealogy, in which the founder cell represents the root, and the progeny are arranged in the branches (). To our knowledge, only two attempts have been made to analyze such tree structured data in a rigorous, probabilistic way (). Using genealogies as input data, we develop a factor graph model (), which describes the genealogy by a random biological process with meaningful and interpretable parameters. Factor graph models have been tremendously successful in coding theory () because they give rise to highly efficient algorithms for maximum likelihood estimation (MLE) and the calculation of marginal probabilities (). The time complexity of these algorithms is linear in the number of nodes, given that the number of neighbors of a node is bounded (by three in our case). This allows us to run a Markov Chain Monte Carlo (MCMC) algorithm for parameter learning. Our factor graph model for genealogies requires only seven parameters. Simulations show that these parameters can be identified accurately. To further assess the robustness of our model, we analyze genealogies generated by a mathematically different and considerably more complex model of stem cell differentiation (). We are able to recover its relevant kinetic characteristics. In our application, the factor graph model decides between alternative hypotheses concerning the mechanisms of hematopoietic progenitor cell (HPC) differentiation. It is under debate () whether cytokines instruct the differentiation of progenitor cells into specific cell types, or whether they select lineage committed cells types by allowing their proliferation or survival. Looking merely at the relative cell abundances at the end of the differentiation process, all scenarios lead to image processing. Left: Cell entities are identified on a series of consecutive pictures of the same area on a cell culture plate. They are linked to their respective predecessor on the previous image. Right: The topological information on cell fates is represented as a genealogy, a forest of rooted binary trees. Nodes represent cells at a certain time point, and edges indicate the parent offspring relation from top to bottom. The vertex color informally indicates phenotypic information assigned to each cell, such as the presence or absence of fluorescent cell type markers. (B) Construction of the factor graph. Each node of the genealogy is represented by a hidden variable node (empty circle), and the probability of an event linking cells between consecutive time points is represented by a hidden factor node (empty square). The cell image data are represented by observable variable nodes (shaded circles). An observable factor node (black square) links each observable variable node to its corresponding hidden variable node, and it encodes the probability of observing the image data, given the hidden cell state. The factor graph encodes the model's likelihood function, the product of all factor nodes. (C) Specification of the local probability functions assigned to the factor nodes. We assume that each cell can be in one of three states blue progenitor cell state, red/ green: differentiated states). Left: Each edge in the graph represents one of four events that can occur: persistence of the cell, cell division, differentiation, and apoptosis. The edges are labeled with the (unknown) probabilities for the respective event, which determine the probability functions of the hidden factor nodes. Right: The functions related to the observable factor nodes are conditional probability distributions of the single cell image data, given the cell's state indistinguishable outcomes, namely the dominance of one cell type. We construct a reversible jump MCMC algorithm, which is able to identify the most realistic scenario as well as the corresponding lineage specific differentiation, proliferation and cell death rates. Our analysis of a HPC time-lapse imaging experiment () identifies unequal proliferation as the driving force for the asymmetric differentiation of murine granulocyte macrophage progenitors (GMPs) cells into either mature monocytes or neutrophil granulocytes.

conclusion high throughput time-lapse imaging poses new challenges to computational biology. The analysis of cellular genealogies requires the development of statistical methods that are able to test hypotheses on data with a branched dependency structure. The most advanced method so far that deal with this kind of data is Markov tree models (). They can be cast as factor graph models, in which the fate of the children is assumed independent of each other, given the (state of the) parent cell. This assumption has the advantage that Markov trees allow the straightforward generalization of the baum welch algorithm for parameter learning. However in cases when diverging daughter cell fates are coupled, this model is not appropriate. We have developed a simplistic, but efficient factor graph model, which can test the compatibility of basic biological hypotheses with this kind of data. The factor graph model has an intuitive parametrization of its factor nodes, which reflects key properties of the cellular system (differentiation, proliferation, apoptosis). Biological hypotheses can be formulated in terms of parameter restrictions. The local factor nodes and their parametrization can be exchanged very easily in this framework. Thus, our model can be easily adapted to model high dimensional readouts from each cell image, or to model other cell states (aneuploidy, cancer o sity quiescence). We perform hypothesis discrimination and parameter estimation using a reversible jump MCMC algorithm. More efficient algorithms for parameter estimation such as an em algorithm would be convenient; they are currently under development. Due to its flexibility, we expect the factor graph framework to have a wide range of applications, in particular because advances in microscopy allow the investigation of cell to cell (state) variability at the subcellular level. The factor graph model can be extended to account for the micro-environment of a cell, given by cell contacts, cell wall turgor, local concentration of signaling molecules, or concentration gradients. Such variables might be included into the observations vector o v for each cell image v. A promising application will be the modeling of multicellular organism development. For example, plant embryos can be tracked, and at the same time chemo physical properties of each cell can be measured (), which can reveal to which extent lineage, mechanical forces or location within a tissue determine cell fate.
