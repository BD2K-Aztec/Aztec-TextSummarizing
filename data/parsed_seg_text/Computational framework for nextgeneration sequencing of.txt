Motivation: next generation sequencing (NGS) allows for analyzing a large number of viral sequences from infected patients, providing an opportunity to implement large scale molecular surveillance of viral diseases. However, despite improvements in technology, traditional protocols for NGS of large numbers of samples are still highly cost and labor intensive. One of the possible cost effective alternatives is combinatorial pooling. Although a number of pooling strategies for consensus sequencing of DNA samples and detection of SNPs have been proposed, these strategies can not be applied to sequencing of highly heterogeneous viral populations. Results: We developed a cost effective and reliable protocol for sequencing of viral samples, that combines NGS using barcoding and combinatorial pooling and a computational framework including algorithms for optimal virus specific pools design and deconvolution of individual samples from sequenced pools. Evaluation of the framework on experimental and simulated data for hepatitis C virus showed that it substantially reduces the sequencing costs and allows deconvolution of viral populations with a high accuracy. Availability and implementation: The source code and experimental data sets are available at

introduction next generation sequencing (NGS) generates a large number of viral sequences carried in samples of infected individuals, offering novel prospects for studying microbial populations and understanding pathogen evolution and epidemiology. NGS provides an opportunity to implement a large scale molecular surveillance of infectious diseases for monitoring of disease dynamics and providing for informed guidance for planning public health interventions. Although NGS offers a significant increase in throughput, sequencing of viral populations from a large number of specimens is prohibitively expensive and time consuming. Therefore development of a strategy for rapid and cost effective massive viral sequencing is a key to effective molecular surveillance. Owing to a high mutation rate, RNA viruses exist in infected hosts as highly heterogeneous populations of genetic variants, which are commonly referred to as quasispecies. Genetic viral variants can be detected using highly variable subgenomic regions that can be easily amplified and sequenced. Although genetic information presented in short subgenomic regions does not allow for identification of all variants, it is sufficient for transmission networks inference (), study of drug resistant ce () and intra host viral evolution (). To reduce the cost of sequencing of multiple viral samples, multiplexing through barcoding is usually used. Although this is a straightforward approach to a simultaneous sequencing of many viral strains, it requires individual handling of each sample starting from nucleic acid extraction to PCR and library preparation, which increases the costs of sequencing per specimen (). Decoding of samples sequenced using large libraries of barcodes may be highly affected by NGS errors (). Additionally, besides introduction of bias in amplification of different viral variants using PCR primers with different barcodes (that may affect distribution of reads) (), maintaining a large library of barcodes is daunting (). An alternative strategy is combinatorial pooling. Commonly, it was used for tests producing binary results (). Recently, several pooling strategies were proposed for more complex assays based on DNA sequencing, SNP calling and a rare alleles detection (). The pooling problem for viral quasi pe cies sequencing is fundamentally different from all existing pooling protocols. Previously developed methods assume that a single (consensus) sequence must be reconstructed for each sample. In contrast, for viral quasispecies sequencing it is imperative to reconstruct the whole population structure of each sample that includes multiple sequence variants and their frequencies. This problem formulation and the nature of heterogeneous viral populations require a completely novel approach for pool design and deconvolution. We propose a protocol for a cost effective NGS of complex viral populations, which combines barcoding and pooling and includes the following steps (): (i) mixing samples in a specially designed set of pools so that the identity of each sample is encoded in the composition of pools; (ii) sequencing pools using barcoding; (iii) pools deconvolution (PD); i.e. assignment of viral variants from the pools to individual samples. This approach significantly minimizes the number of PCR and NGS runs, reducing the cost of testing and hands on time. Additionally, pooling provides opportunity for PCR amplification of viral variants from each sample in different mixtures of samples generated in each pool, thus introducing variation in amplification biases and contributing to sequencing of a more representative set of viral variants from each sample. pooling based sequencing of highly mutable viruses such as human immunodeficiency virus and hepatitis C virus (HCV) is particularly difficult because of the complexity of intra host viral populations, the assessment of which can be distorted by PCR or sampling biases. It is essential to detect both major and minor viral subpopulations, since the latter often have important clinical implications (). Mixing of a large number of specimens or specimens with significant differences in viral titers may contribute to underrepresentation of viral variants from some samples in pools, suggesting that size and composition of pools should be carefully designed. Stochastic sampling from genetically diverse intra host viral populations usually produces variability in compositions of sets of variants in different pools obtained from the same sample. Additionally, mixing specimens may differentially bias PCR amplification, contributing to mismatching between viral variants sampled from the same host in two pools with different specimen compositions. Thus, straightforward approaches can not be used for samples deconvolution, indicating that a more complex approach based on clustering techniques is needed. To increase the effectiveness of cluster based deconvolution and minimize possible clustering errors, it is important to minimize mixing of genetically close samples as can be expected in epidemiologically related samples and samples collected from a small geographic region. In this article, we present the first computational framework for combinatorial pool based sequencing of highly heterogeneous viral samples. The framework includes pools design and PD stages. We formulate the pool design problem as an optimization problem and propose a heuristic algorithm to solve it. We propose a method for inference of samples from sequenced pools based on a novel maximum likelihood clustering algorithm for heterogeneous viral samples. We report the results of the framework evaluation using simulated and experimental HCV data.
