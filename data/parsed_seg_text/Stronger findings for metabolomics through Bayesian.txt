Motivation: Data analysis for metabolomics suffers from uncertainty because of the noisy measurement technology and the small sample size of experiments. Noise and the small sample size lead to a high probability of false findings. Further, individual compounds have natural variation between samples, which in many cases renders them unreliable as biomarkers. However, the levels of similar compounds are typically highly correlated, which is a phenomenon that we model in this work. Results: We propose a hierarchical Bayesian model for inferring differences between groups of samples more accurately in meta bolo mic studies, where the observed compounds are collinear. We discover that the method decreases the error of weak and non-existent covari-ate effects, and thereby reduces false positive findings. To achieve this, the method makes use of the mass spectral peak data by clustering similar peaks into latent compounds, and by further clustering latent compounds into groups that respond in a coherent way to the experimental covariates. We demonstrate the method with three simulated studies and validate it with a meta bolo mic benchmark dataset. Availability and implementation: An implementation in R is available at http://research.ics.aalto.fi/mi/software/peakANOVA/. Contact: samuel kaski aalto fi
introduction changes in metabolite concentrations provide insights into disturbances in biological processes that take place in organisms. Changes in the metabo lome are informative, especially about nutrition and metabolism or e sic sic 2009), and about the immune system (). chromatography coupled mass spectrometry () is the standard measurement technology for the untargeted quantification of metabolites and other small molecules. The spectral data from the measurement device are known to be noisy with various sources of uncertainty kata jama a and or e sic sic 2007), starting from sample preparation and compound ionization, and ending at peak identification, annotation and summarization. However, the spectra also have structure () that is useful for the inference of differences between groups of samples. Because of the high level of noise, excessive false discovery has been highlighted among the main risks in the analysis of meta bolo mic data (). On the other hand, weak changes are likely to go undetected from observations of individual compounds (). Singular value decomposition svd based dimensionality reduction techniques, such as analysis of variance anova simultaneous component analysis (ASCA;), have been proposed to identifying interpretable associations between experimental covariates and multivariate changes in the metabo lome. However, as the decomposition in ASCA operates on the covariate effects of the standard ANOVA model, the method does not improve the quantification of the covariate effects compared with the standard model. Further, SVD has been applied to interpreting changes in the variance of the samples in association to the covariates (), again, building on the standard ANOVA model. Outside metabolomics, structured anova type models have been proposed to improve the inference of covariate effects: a Gaussian process based ANOVA model for spatial data () enables the inference of smooth covariate effects for nearby data points, and a dependent Dirichlet process mixture of ANOVA models () can identify substructure in a designed experiment with low dimensional observations of the outcome. For metabolomics, a Bayesian clustering model () has recently been proposed for improving the inference of covariate effects through the integration of multiple same source spectral peaks. Individual spectral peaks have been argued to be unreliable for the statistical analysis because of their high level of noise. Although the mass spectrometer produces multiple peaks that arise from one compound, there so far are only few methods to integrate these additional observations used multiple peaks to enhance peak annotation, addressing a major source of error in the analysis of meta bolo mic data. The recently proposed multi peak model for the inference of covariate effects () is, to our knowledge, the first systematic approach for using additional peaks in the statistical analysis of intensity data. In this work, we aim at reducing the risk of false associations between experimental covariates and the observed metabo lome. We propose a structured anova type model that benefits both from the multiple spectral peaks produced by the mass spectrometer and from the collinear structure () of meta bolo mic data. Because of the collinearity that arises from the compounds' concurrent involvement in biological processes, it is reasonable to model individual compounds as members of coherent groups of compounds. *To whom correspondence should be addressed.  The Author 2014. Published by Oxford University Press. This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (http://creativecommons.org/licenses/by-nc/4.0/), which permits non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited. For commercial re-use, please contact journals permission soup com we achieve this by introducing another level of hierarchy to the peak clustering model (). We show that by not only clustering spectral peaks into latent compounds but in addition by clustering these compounds into coherently responding latent groups, we can detect weak covariate effects in the data more accurately.

conclusion additional spectral peaks produced by the mass spectrometer as a result of the ionization process have been shown to be useful for the inference of covariate effects when multiple peaks can be confidently associated with one compound. However, even with multiple peaks supporting the inference, small covariate effects may be hidden under the between sample variation. We addressed this problem by introducing stronger structure to the model of the covariate effects, thereby regular ising the covariate effects and making them less dependent on the variation of individual compounds. We achieved an improvement in the accuracy of the inferred covariate effects by assuming a structure of coherently responding compounds in the data. We proposed a structured model for inferring covariate effects for groups of compounds through two layers of probabilistic clustering. meta bolo mic data are known to have collinear structure for similar compounds. This phenomenon is argued to arise from the biological processes that the compounds are involved in. However, the method proposed in this work does not restrict the groups of compounds by their chemical or biological similarity but infers the groups only based on their responses to the covariates. In the experiments, we showed that the two level model proposed in this work decreases the error of inferred covariate effects in a typical setting, where the true effects are small or diminishing. Through three simulated experiments, testing the approaches with multiple zero effect clusters, varying effect size and varying number of similarly responding compounds, we demonstrated that the two level model is more accurate at inferring weak covariate effects from noisy multi peak data when compared with the two comparison approaches. The outcome was repeated on a meta bolo mic benchmark dataset with known changes in the compound concentrations. Following the reduction in the error for the weak covariate effects, the two level model is argued to reduce false findings. To further improve the consistency of the inferred covariate effects, we suggest the following avenues of research: (i) prior knowledge about the similarity of the compounds can be incorporated into the prior of the higher level clustering, either in terms of the biological processes in which the compounds are involved or in terms of the chemical similarity of the compounds. (ii) The lower level clustering can be improved to detect even the weakest peaks by incorporating prior knowledge about the relative positions of the peaks associated with one compound. This is possible thanks to the fact that the expected positions of many adduct and isotope peaks can be calculated based on the ionization process and the chemical formula of the compound, respectively. (iii) The covariate effects in the isotope peaks are argued to be highly preserved because the isotope peaks do not arise from variation in the ionization process. Additionally, the expected relative heights of these peaks can be calculated if the identity number of compounds per cluster RMSE. The error in the covariate effect inferred by the compound clustering model 2 level decreased when more coherently responding compounds were observed. The accuracy of the peak clustering model and the data based single peak approach 1 level and 'Single peak', respectively) remained constant. Root mean squared error (RMSE) is shown as a function of the number of compounds (i.e. lower level clusters) per higher level cluster. Result from the third simulated experiment (Section 3.1.3), where a weak covariate effect of 0.2 was generated and the number of compounds was gradually increased from 1 to 19 note The two level and one level models, and the single peak approach 2 level 1 level and 'Single', respectively), are compared by their MSE between the inferred and the true covariate effect. The smallest MSE for each true effect is highlighted in bold. The significance of the difference between the two level model and the two comparison approaches is tested with the two sided paired t test with the benjamin i hochberg correction () for the p values. A near zero value below the machine accuracy is denoted by '"'. */** Significant difference at confidence level 9599 conflicts of Interest: none declared.
