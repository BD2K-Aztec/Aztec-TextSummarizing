Motivation: Rapid advances in genotyping and genome wide association studies have enabled the discovery of many new genotype phenotype associations at the resolution of individual markers. However, these associations explain only a small proportion of theoretically estimated heritability of most diseases. In this work, we propose an integrative mixture model called j base joint Bayesian analysis of sub phenotypes and epistasis. j base explores two major reasons of missing heritability: interactions between genetic variants, a phenomenon known as epistasis and pheno-typic heterogeneity, addressed via sub phenotyping. Results: Our extensive simulations in a wide range of scenarios repeatedly demonstrate that j base can identify true underlying sub phenotypes including their associated variants and their interactions, with high precision. In the presence of phenotypic heterogeneity, j base has higher Power and lower Type 1 Error than five state of the art approaches. We applied our method to a sample of individuals from Mexico with Type 2 diabetes and discovered two novel epistatic modules , including two loci each, that define two sub phenotypes characterized by differences in body mass index and waist to hip ratio. We successfully replicated these sub phenotypes and epistatic modules in an independent dataset from Mexico genotyped with a different platform. Availability and implementation: j base is implemented in Cþþ, supported on Linux and is available at

introduction genome wide association studies g was have been successful in identifying thousands of novel disease markers. However, the discovered associations explain only a small proportion of theoretically estimated heritability of most diseases (). This is referred to as the missing heritability problem. Among the main hypotheses attempting to explain the missing heritability (), four of them can be addressed with more detailed genetic data and more advanced methods: (i) rare variants and structural variants (SVs), which are not covered by the common single nucleotide polymorphism (SNP) arrays used in g was (ii) spurious associations caused by population stratification; (iii) interactions between variants, i.e. epistasis and (iv) phenotypic heterogeneity. Solutions to each problem have been sought with varying degrees of success. For example, full assessment of the impact of rare variants and SVs on phenotypic variation requires larger cohorts, which is becoming feasible with affordable sequencing technologies and meta studies. It is now possible to detect and remove spurious associations using efficient linear mixed models (). In this article, we focus on epistasis and phenotype heterogeneity two major computational problems potentially contributing to missing heritability. Recent large scale genomic studies on model organisms (), as well as theoretical findings () revealed that epistasis may hinder identification of genetic associations. It is possible to categorize epistasis detection algorithms into three types: (i) preg was algorithms that were mostly developed for small scale datasets, e.g. multi-factor dimensionality reduction (); (ii) exhaustive search algorithms, such as TEAM (), six pac () and gw is (), which scale to g was datasets but only detect pairwise and often limited types of interactions and (iii) stochastic search methods such as BEAM (), a generative latent variable framework that models marginal (independently acting) and epistatic effects allowing for any number of interactions. Its successors include BEAM2 () and BEAM3 (). Most of these methods rely on Markov chain Monte Carlo for inference. Many complex human diseases, such as autism, diabetes and cancer, are very heterogeneous. For example, it has been observed that risk variants associated with Type 2 diabetes (T2D) differ in patients with high and low body mass indices (BMIs) (). Similarly, in medulloblastoma, analysis of 1000 genomes revealed extensive subgroup specific variants that give rise to subgroup specific phenotypes, i.e. sub phenotypes (). There is now increasing evidence from breast cancer, hearing loss, cholesterol related disorders, mental illnesses and T2D studies that many complex diseases may be better characterized as a collection of distinct and less common sub diseases (). Disease heterogeneity, if not taken into account, can have profound consequences on the success of association studies. It reduces statistical power to detect causal variants () and confounds replication studies such that true associations fail to replicate and become classified as false positives (and also a detailed discussion in Supplementary Material Section S1). sub phenotyping attempts to solve these problems by (automatically) stratifying the global population to identify homogeneous patient subgroups. Several approaches have recently been developed to address disease heterogeneity in the context of the missing heritability problem. These approaches can be grouped into two categories: (i) those with prior knowledge of sub phenotypes () and (ii) those that simultaneously infer both sub phenotypes and associated markers (). In the first case, the grouping information might come from prior medical knowledge, e.g. in T2D, the cases were stratified according to patients' BMI using canonical BMI categories of obese versus non-obese. However, relying only on prior knowledge limits the space of accessible discoveries. Moreover, it is also undesirable as sub phenotypes often give rise to overlapping multivariate phenotype distributions, which can not be studied with hard threshold based approaches. Simultaneous identification of subgroups and group specific markers removes the bias of potentially arbitrary thresholds while enabling the study of overlapping sub phenotypes. The snp mix approach () addresses this problem by modeling the population as a mixture of sub phenotypes with individual to subgroup assignment being unknown and trying to simultaneously identify marginally affecting markers and subgroup assignments. This is a promising first step but it focuses solely on marginal associations. Joint models for partitioning genotype and phenotype simultaneously have been proposed in the expression quantitative trait loci e qtl framework. Methods described in Kim and Xing (2009) and identify modules of genes and corresponding variants. The partitioning in these models is in the gene space rather than in the patient space, thus these models are not directly applicable to our problem. A notable exception is, which proposes a Bayesian partitioning method in the e qtl context that not only models marginal and epistatic effects of variants (explaining gene expression modules) but also encodes potential partitioning of the cohort. Unfortunately, there are several key properties of this model that make it inapplicable to sub phenotyping. For example, the variable corresponding to the partitioning of individuals is integrated out, i.e. it is not actually inferred. Additionally, the groupings of individuals are independent between e qtl modules. Thus, as is shown in the real case scenario in, each module has its own subgroup of individuals without any way to reconcile them. To summarize, Zhang et al. (2010a) does not infer sub phenotypes with respect to the disease but uses the idea of subgroups of individuals to identify more meaningful e qtl modules. The only way to coerce model to our in the case population is hidden or is not accounted for; can recover only shared causal markers (SNP3) (B) sub phenotyping approach to the same data recovers both shared (SNP3) and sub phenotype causal specific markers (SNP2, SNP4 and SNP5) setting would be to set the number of modules to 1. However, this would mean that there would have to be only one genotypic module that has to explain the full heterogeneity of the data, an assumption that is not supported by the current line of evidence on the genetics of sub phenotypes (). Motivated by the fact that epistasis and phenotype heterogeneity represent two of the main challenges for the missing heritability problem and the fact that none of the existing methods address both issues simultaneously, we introduce the j base model, which accounts for epistasis and sub phenotyping while providing an easily interpretable probabilistic framework where n mar kmj is the number of individuals in subpopulation k that has jth genotype for marker m. Markers in the epistatic component are assumed to be generated by a single multinomial distribution. As each marker can have three states, this multinomial distribution can have e k  3 jG k 2 j states, i.e. interactions, whose frequencies are governed by the parameter / k  / k1 ;. .. ; / e k . Thus, we get where n epi kj denotes the number of individuals in subpopulation k with the genotype combination j over the epistatic markers. Note that, e k , and hence the dimensionality of / k vary depending on the state of S k (see Supplementary Material Section S2.2 for details). The last genotype component to model is the null component. The parameters of the null component are shared across all components, i.e. a marker that is not related to the phenotype should have the same allelic distribution as other subpopulations in which it is assigned to the null component. Let w m  w m1 ; w m2 ; w m3  be the genotype frequencies of a marker m in the general population. Then, we have where n null mj is the number of the occurrence of state j for marker m across all individuals where it is classified as a null marker. The final component of the likelihood is the phenotype. In this work, we have focused on categorical phenotypes only. We model the phenotype likelihood as a multinomial distribution parameterized with x k  x k1 ;. .. ; x kT , where T is the number of all possible combinations of values of the different phenotypic variables, which is fixed based on cardinality of the multinomial distribution, and n phe kt is the number of individuals in subpopulation k with a phenotype value t. Putting these together, we get the following form for likelihood pd jw h; /; x; C; s where we used G 0 to denote the collection of null components across all sub phenotypes Using conjugate Dirichlet priors for w, h, / and x, as well as for the mixing coefficient parameter vectors p and a, allows us to integrate out all of the model parameters Q  fw; h; /; x; p; ag except latent variables C and S (see Supplementary Material Section S2.1 for details). The final form of the posterior is presented in Equation (6). As such, the posterior distribution depends only on the hyperparameters H  fq; b; k; c; s; dg, which are given as input, and the latent variables C and S, which are inferred. We perform inference via sampling from the posterior using the metropolis hastings algorithm (see Supplementary Material Sections S2.2 and S2.3 for details). It is also worth mentioning that j base can control for linkage disequilibrium (LD), which can introduce false positive epi statis and for population stratification. For LD, j base accepts an optional input file that lists the markers known to be in LD with associated lists of linked markers. j base via its proposal distribution on S km , ensures that linked marker pairs are never assigned to marginal and or epistatic components simultaneously. In addition, one can also specify an optional genomic distance threshold such that markers closer than the given distance are not allowed to be simultaneously assigned to the marginal and or epistatic component of a subpopulation. As for population stratification, j base leverages the information obtained from the principal component analysis pc a of individuals by ensuring that the subpopulation means of the most important pc a dimension(s) do not significantly differ between subpopulations (see Supplementary Material Section S2.2). This is achieved by rejecting proposals on variable C i if it causes the means between sub phenotypes to diverge beyond a threshold. Other biological constraints can easily be integrated into the proposal distribution of the metropolis hastings algorithm by eliminating the undesirable assignments from the state space of the posterior distribution.
