Motivation: chips eq is the standard method to identify genome wide dna binding sites for transcription factors (TFs) and histone modifications. There is a growing need to analyze experiments with biological replicates, especially for epi genomic experiments where variation among biological samples can be substantial. However, tools that can perform group comparisons are currently lacking. Results: We present a peak calling prioritization pipeline pep r for identifying consistent or differential binding sites in chips eq experiments with biological replicates. pep r models read counts across the genome among biological samples with a negative binomial distribution and uses a local variance estimation method, ranking consistent or differential binding sites more favorably than sites with greater variability. We compared pep r with commonly used and recently proposed approaches on eight TF datasets and show that pep r uniquely identifies consistent regions with enriched read counts, high motif occurrence rate and known characteristics of TF binding based on visual inspection. For histone modification data with broadly enriched regions, pep r identified differential regions that are consistent within groups and outperformed other methods in scaling False Discovery Rate (FDR) analysis. Availability and implementation:

introduction chromatin immunoprecipitation followed by massively parallel sequencing chips eq is the standard technique to identify the genome wide occurrences of transcription factor (TF) binding sites and histone modifications in vivo. Over the past few years, there has been tremendous development of analysis methods for chips eq data, with tens of 'peak finders' published (). Over this course, several characteristics of chips eq datasets, such as enrichment profile features (peak width, signal to noise ratio and location relative to genomic features) of different types of TFs and histone modifications, sources of artifacts and the commonly observed statistical distributions of read counts, have been gradually revealed (). As sequencing cost decreases, use of biological replicates is emerging and may eventually become the standard practice for chips eq studies. Most of the Encyclopedia of DNA Elements (ENCODE) consortium data were performed in duplicate (). Furthermore, as researchers shift from performing chips eq experiments that address mechanistic questions to those that hypothesize differential and or context specific binding in a disease, treatment or epidemiologic setting, the use of replicates to account for individual variability becomes crucial. We expect that this will lead to more analyses comparing a group of ChIP samples with a group of controls, or two groups of ChIP samples, with or without controls, run under different experimental conditions. chips eq peak finders that perform direct group comparisons within the peak calling pipeline are currently lacking. When biological replicates are available, researchers may choose to combine the replicates (CR) in each group and run one chip versus one control analysis to identify all possible peaks. Alternatively, they can pair ChIP and control samples, conduct a separate analysis (SA) for each pair and then stipulate rules to combine the peak finding results, such as requiring the peaks to be found in all pairwise comparisons. The CR approach is often used in TF chips eq studies to identify all possible binding sites. However, if the goal is to find consistent binding among replicates, many false positives may occur where binding is present in only one or a subset of the samples. The SA approach is more sophisticated in the sense that it does not lose all information regarding sample to sample variability and is more applicable to experiments that have a natural pairing of samples. However, because it evaluates peaks for each replicate separately, the effects of false negatives across replicates may become compounded. Thus, the SA approach is more likely to miss moderate, yet consistent, differences in binding. When there is no inherent pairing between test and control samples, as often occurs with differential binding analyses, the SA approach may call a peak because in each one versus one analysis, one sample has greater enrichment than its paired sample. Yet, if *To whom correspondence should be addressed. y The authors wish it to be known that, in their opinion, the first two authors should be regarded as Joint First Authors. the pairs were constructed differently, some 'peaks' may no longer exist. An alternative approach is the ir reproducible discovery rate (IDR) () approach recommended by ENCODE. IDR can be considered a sophisticated CR approach, which assesses the consistency of peak rankings in replicates to find an optimum significance cut off for determining the final peak list. Correctly modeling the variation among samples in gene expression studies when testing for differential expression has been shown to be of great importance (). For rnase q analysis, several methods [for example, edgeR () and de seq ()] use a negative binomial distribution instead of a Poisson distribution to capture the extra variance among replicates. These approaches can be used with chips eq data; however, they do not perform the first several steps of the chips eq analysis pipeline nor do they take advantage of local chromosomal information. An exact negative binomial test diff reps was recently introduced for chips eq data and compared with edgeR and de seq using two histone modification datasets (). Other approaches to identify differential binding with replicates include the R packages diff bind () and db chip (); although these programs take into account sample variation, they rely on other peak callers to generate peak sets for each individual sample first and conduct analysis on the candidate regions that fall within the peak sets. Here, we introduce a chips eq peak finding and prioritization pep r pipeline that can analyze either a group of chips eq samples together with controls or compare two groups of chips eq samples, with or without controls. pep r uses a sliding window approach and models read counts across replicates and between groups with a local negative binomial model. Genomic regions with less variable read counts across replicates are ranked more favorably than regions with greater variability, thus prioritizing consistently enriched regions. We tested pep r on chips eq data for activating transcription factor 4 (ATF4) (), seven ENCODE TF datasets and one histone modification dataset (H3K27 tri methylation and compared the performance of pep r to several chips eq methods representing different statistical models and using different sources of information: MACS (), MACS2 and SPP () with IDR (), z in ba (), sic er (), diff reps (), diff bind () and edgeR (). We show that pep r performs favorably compared with the other tested approaches, prioritizing peaks that reflect stronger enrichment fold and higher consistency among samples.

discussion currently there is a lack of chips eq analysis programs that account for biological variability within the peak finding process. We have developed a method and tool, pep r which uses a local negative binomial model to identify consistent or differential binding sites among chips eq data, and that additionally estimates the optimal moving window size and offers postprocessing steps to reduce false positives and refine peak resolution. Variation among samples in chips eq data can sometimes be large, such that some binding sites, even for TFs, are not reproducible (). Inconsistent TF peaks among biological samples can exist for many reasons, including differences in accessibility of chromatin regions (e.g. because of the histone tail modifications or DNA methylation), common sequence variants, competitive or cooperative binding differences with another TF () or technical artifacts that only occurred in one of the replicates. However, all but the last of these reasons are not significant concerns for most peak finder programs, the goal of which is to identify all potential binding sites rather than consistent or differential binding sites. In addition, as public datasets from large consortiums such as ENCODE () more comprehensively cover known TF binding in commonly used cell and tissue types, there will be less incentive for individual laboratories to identify all of the potential binding sites for a protein, as many will be available. A more refined hypothesis may be 'where does this TF (or histone modification) bind consistently in this specific context (a specific disease, developmental stage, exposure or treatment)?' Accurately modeling the variation is highly important in population epi genomics studies where substantial variation exists among samples, not only among individuals but also between tissue types (), developmental time points () and during disease progression (). We compared pep r with five commonly used single sample peak finders that use different underlying statistical models (MACS, MACS2, SPP, z in ba and sic er as well as three programs that were designed for replicates diff reps diff bind and edgeR), and found that pep r performed favorably in terms of consistently enriched read counts, motif occurrence rate and known characteristics of TF binding based on visual inspection. For comparison with MACS, z in ba or sic er we either performed separate paired analyses and then called peaks in the overlapping regions (SA) or combined the reads for the replicates and called peaks from the concatenated lists (CR). IDR was incorporated with MACS2 and SPP to determine the peak list cut off as recommended by the ENCODE consortium. Visual inspection of the peak shape and summarizing the read counts in peaks were extremely valuable in characterizing the unique tendencies of each approach. In particular, MACS was sensitive to detecting regions that had low background and tended to miss peaks that had a relatively high background [(iii)]; visual inspection of the z in ba and diff reps unique peaks revealed that many had similar peak shape in both ChIP and control samples; SPP had severe false negatives for the nrs f data, which is possibly because of the removal of true binding sites that SPP mistakenly assumed to be artifacts because of having unexpectedly small shift size [i.e. in the 'phantom peak' as defined in (. When we compared pep r with spp idr and MACS2-IDR, we observed pep r unique peaks (that are missed by the other two) had high read counts and motif rate. Although motif occurrence rate is a useful marker for DNA binding, its value as a marker for consistent or differential DNA binding is not as clear. For identification of all DNA binding sites, motif analysis is expected to be specific (if the motif is found within a peak, it is assumed that binding occurs) but not necessarily highly sensitive (indirect binding cooperatively with other protein(s) may not result in a motif occurrence). Because the percent of binding sites without a motif is only expected to vary by DNA binding protein, and not by peak caller, this is often ignored when comparing peak callers. However, for consistent or differential binding experiments we can no longer assume specificity; a peak finder that identifies fewer overall peaks with a motif than an alternative may be correct in not calling the additional peaks as consistently bound or differentially bound. Given these caveats, we nonetheless found motif occurrence rate informative for interpreting our results when used in conjunction with visual inspection of peaks. The large improvement in motif occurrence rates for pep r unique peaks compared with peaks identified by the SA approaches and edger basic suggests that peaks with higher read intensities and the expected smooth peak shape are more likely to contain a motif (). The CR approaches, on the other hand, were comparable in motif occurrence rate with pep r but many of these were only bound in one replicate on visual inspection, and thus are likely false positives for identification of consistent binding sites in the biological system under study. Although pep r and edgeR use a similar underlying negative binomial model, edgeR lacks initial steps required for chips eq peak finding (shifting opposite strand reads, defining and summarizing reads per window, etc), does not incorporate information from neighboring windows, which especially benefits histone modification analyses, and does not offer post-processing steps to improve peak resolution or reduce false positives. In five of the eight TF datasets, pep r performed better in motif rate than edgeR if the same pep r processing steps are performed for edgeR; with the histone data, pep r was more sensitive than edgeR owing to estimation of the dispersion parameters locally. pep rs post-processing steps improved edgeR's performance when there is a high proportion of pcr duplicate peaks (6% in nrs f 1.6% in ATF4 and 505 in other datasets). diff bind was previously shown to work well with differential binding in TF data (); however, in H3K27me3 data with broad and highly variable peaks, diff binds edgeR module had low detection power, whereas its de seq module identified 918 peaks, many of which were inconsistent among samples. diff reps resulted in unpredictable numbers of peaks across the datasets we tested, for example, it identified substantially fewer peaks than all other programs for ATF4 and SMC3 (Supplementary) but many more for H3K27me3. Owing to the lack of benchmarks in histone modification datasets, in this manuscript we mainly relied on TF datasets to compare methods. However, pep r is adaptable to datasets with either sharp or broad peaks because of its empirical estimation of the optimal sliding window size, and thus is equally relevant for analysis of histone modification chips eq datasets as illustrated with our H3K27me3 data. H3K27me3 tends to occur in broad regions several kilobases in length, making consistent peak calling more difficult. Based on our visual inspection of peaks and scaling FDR analysis for the approaches compared, we showed that pep r identified binding regions consistent between groups without being sensitive to changes in read coverage. One limitation of pep r is that it currently does not perform paired analysis, similar to the limitation of multiple rnase q differential analysis programs (); thus, for example, the paired nature of tumor and patient matched normal samples could not be taken into account. For experiments requiring covariates, we currently recommend edgeR. pep r also makes the assumption that the quality of data for each chips eq experiment is approximately equal, similar to most methods for other types of high throughput analysis. When this assumption is violated, the result may be a high false negative rate owing to missing peak regions in the lower quality sample(s); this may especially be true for experiments with small sample size. In this case, users may obtain better performance using a different peak finder on individual samples, and a secondary method to explore options to combine results. Future versions of peak finders for replicated chips eq data could take into account quality, for example, by assigning a weight to each sample.
