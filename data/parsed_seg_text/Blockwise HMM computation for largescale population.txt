Motivation: A promising class of methods for large scale population genomic inference use the conditional sampling distribution (CSD), which approximates the probability of sampling an individual with a particular DNA sequence, given that a collection of sequences from the population has already been observed. The CSD has a wide range of applications, including imputing missing sequence data, estimating recombination rates, inferring human colonization history and identifying tracts of distinct ancestry in admixed populations. Most well used CSDs are based on hidden Markov models (HMMs). Although computationally efficient in principle, methods resulting from the common implementation of the relevant HMM techniques remain intractable for large genomic datasets. Results: To address this issue, a set of algorithmic improvements for performing the exact HMM computation is introduced here, by exploiting the particular structure of the CSD and typical characteristics of genomic data. It is empirically demonstrated that these improvements result in a speed up of several orders of magnitude for large datasets and that the speed up continues to increase with the number of sequences. The optimized algorithms can be adopted in methods for various applications, including the ones mentioned above and make previously impracticable analyses possible. Availability: Software available upon request.

introduction with the cost of genomic sequencing rapidly decreasing, there is a growing need for statistical methodologies that can efficiently accommodate genomic scale data for many individuals while accounting for complex patterns of variation (e.g. linkage disequilibrium) caused by evolutionary processes such as mutation and recombination. The applicable underlying statistical model is the coalescent with recombination, which describes the distribution of genealogical histories for a collection of individuals. Known methods for inference under this model are generally intractable at the genomic scale, so practicable methods must realize a balance * To whom correspondence should be addressed. between computational efficiency and approximating key properties of the coalescent with recombination. A promising class of such methods use the conditional sampling distribution (CSD). A CSD approximates the probability (under the coalescent with recombination) of sampling an individual with a particular DNA sequence, given that a collection of sequences from the population has already been observed. Intuitively, recombination partitions the newly sampled sequence into segments, each of which is a copy of the corresponding segment in a previously sampled sequence, with imperfections introduced by mutation. For computational efficiency, this construction is often cast as a hidden Markov model (HMM). The hidden state at a site indicates the previously sampled sequence being copied and the associated observed state the allele of the new sample. Even within this framework there are alternatives, as it is possible to trade-off fidelity to the underlying coalescent process for computational efficiency. The CSD of, for example, is the most accurate but is a constant factor slower than CSDs proposed by and by, with the latter being the fastest, but least accurate. CSDs for more complex models, incorporating gene conversion (), diploid y (), demography () and admixture (), have also been proposed. Methods incorporating the CSD generally fall into one of several categories. Likelihoods can be approximated using csd based importance sampling (De) coupled with composite methods () or directly as a product of CSDs (). In conjunction with expectation maximization or Markov chain Monte Carlo, these methods have been used for estimation of fine-scale recombination rates (), gene conversion parameters (), population demography () and population structure (). It is also possible to infer and use the hidden states in the HMM CSD computation. This has been used for admixture inference (), in which genomic segments corresponding to ancestral populations are identified and also within a pseudo gibbs sampling framework to phase genotype sequence data into haplotype sequence data and to impute missing data ().

discussion we have presented a number of optimized algorithms for computing the csp csp CSP SMC (|n). Our optimizations are based on two intuitive observations: first, the number of unique haplotypes in a genomic sample is dramatically reduced within relatively short regions and second, the large number of non polymorphic loci in a genomic sample, though informative, do not distinguish between haplotypes. These observations are formalized and leveraged to refine the recursive equations for computing computing computing SMC (|n), yielding optimized, yet exact, algorithms. We have described our optimization algorithms in the context of the HMM associated with the csd csd CSD SMC proposed by. It is natural to question whether similar optimizations are applicable to related CSDs, such as those proposed by fearn head and Donnelly (2001) and by. In Section 2, we described two sufficient conditions: Property 1, which stipulates that, upon recombination, a new hidden haplotype is chosen independently and uniformly at random and Property 2, which stipulates that the emission distribution depends only on the allele at the current locus of the hidden haplotype. The aforementioned CSDs do satisfy both of these properties; in particular, stronger forms of Property 1 hold for both CSDs, enabling additional optimizations. We have not empirically analysed the resulting optimized algorithms, but by considering the resulting asymptotic time complexities, analogous to those in, we anticipate that the speedups obtained will be qualitatively comparable to those observed for for for SMC , though the corresponding magnitudes are difficult to estimate. It is also interesting to consider CSDs for more complex demographic scenarios. A theoretically straightforward extension of of of SMC to variable population size, for example, will continue to satisfy both Properties 1 and 2 and will therefore be amenable to very similar optimizations. On the other hand, extension to structured populations, populations that are divided into several demes between which there is limited migration, will not satisfy Property 1 as the new hidden haplotype chosen upon recombination depends on
