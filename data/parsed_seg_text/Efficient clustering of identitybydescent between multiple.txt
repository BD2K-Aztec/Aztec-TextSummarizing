Motivation: Most existing identity by descent (IBD) detection methods only consider haplotype pairs; less attention has been paid to considering multiple haplotypes simultaneously, even though IBD is an equivalence relation on haplotypes that partitions a set of haplo-types into IBD clusters. multiple haplotype IBD clusters may have advantages over pairwise IBD in some applications, such as IBD mapping. Existing methods for detecting multiple haplotype IBD clusters are often computationally expensive and unable to handle large samples with thousands of haplotypes. Results: We present a clustering method, efficient multiple ibd which uses pairwise IBD segments to infer multiple haplotype IBD clusters. It expands clusters from seed haplotypes by adding qualified neighbors and extends clusters across sliding windows in the genome. Our method is an order of magnitude faster than existing methods and has comparable performance with respect to the quality of clusters it uncovers. We further investigate the potential application of multiple haplotype IBD clusters in association studies by testing for association between multiple haplotype IBD clusters and low density lipoprotein cholesterol in the Northern Finland Birth Cohort. Using our multiple haplotype IBD cluster approach, we found an association with a gen-omic interval covering the PCSK9 gene in these data that is missed by standard single marker association tests. Previously published studies confirm association of PCSK9 with low density lipoprotein. Availability and implementation: Source code is available under the GNU Public License

introduction in a finite population, haplotypes are identity by descent (IBD) if they are identical and inherited from a common ancestor. Tracts of IBD are broken up by recombination during meiosis. To be detectable, a pairwise IBD segment must be sufficiently long and contain a sufficient number of genotyped markers (). Detected IBD segments have several important applications, for example, detecting signals of natural selection (), inference of population structure () and IBD mapping in association studies (). The current resolution of IBD detection in single nucleotide polymorphism (SNP) array data is $12 cM, corresponding to a common ancestor within the past 2550 generations; therefore, many short segments will be missed in pairwise IBD detection (). The missing information can be partly retrieved by multiple haplotype analysis that identifies clusters of haplotypes that are all identical by descent, which we refer to as multiple ibd clusters later in the text. Because IBD is an equivalence relation on haplotypes, if haplotypes A and B are IBD and haplotypes A and C are IBD, then haplotypes B and C are also IBD by definition, even though their shared segment may be too short to be detected in pairwise IBD detection. Within a certain region, if we only observe pairwise IBD segments of (A, B) and (A, C), but not (B, C), we say that there is inconsistency in the pairwise IBD segments. Such inconsistency can be resolved by grouping A, B and C into a multiple ibd cluster, where each member in the cluster is IBD to all the other members. There have been several previous attempts to detect multiple ibd. MCMC IBD finder () is a Markov Chain Monte Carlo approach that considers multiple individuals simultaneously; however, it is not computationally tractable for genome wide analysis with large sample sizes. The DASH method () builds on pairwise IBD segments and applies an iterative minimum cut algorithm to identify densely connected haplotypes as IBD clusters. The method scans the genome through sliding windows and output subgraphs of desired density. The performance of the DASH method in terms of speed and accuracy has not been investigated previously. ibd group on () is a recently developed method that also detects group-wise IBD tracts based on pairwise IBD segments. Unlike DASH, which takes the length of windows and density threshold of subgraphs as input parameters, ibd group on is almost parameter free and it uses a hidden Markov model (HMM) to determine the cliques and the length of group-wise IBD tracts automatically. The performance of ibd group on was evaluated on simulation data of chromosome 22 with 6159 SNPs, based on a real pedigree in HapMap, and it shows high power in detecting short IBD tracts (). In comparison with DASH, ibd group on has a similar execution time with higher accuracy for a sample size of 90 related individuals; however, the relative performance of DASH and ibd group on was not evaluated using population data, larger samples sizes or multiple parameter settings. *To whom correspondence should be addressed in this study, we evaluate DASH using population samples with thousands of individuals in a range of different parameters settings. We do not evaluate ibd group on v1.1 because it required too much memory (412 Gb) when analyzing the simulated datasets in this study. In this work, we present the efficient multiple ibd (EMI) algorithm to search for multiple ibd clusters along sliding windows in the genome. In contrast to DASH, which builds clusters from a largest connected component and iteratively divides it into smaller clusters by a minimum cut algorithm, EMI takes an agglomerative approach. It builds each cluster from initial seed haplotypes and recursively adds qualifying haplotypes to expand the cluster. High computational efficiency is ensured by the use of priority queues. We evaluate our results based on coalescence simulations. Coalescence simulations allow the investigation of realistic scenarios while enabling determination of the true multiple ibd status. We compare the performance of EMI and DASH with thousands of samples. Although DASH, ibd group on and EMI all use graph based clustering methods, there is an important difference in how clusters are identified. ibd group on uses an HMM to find the most likely maximal cliques within each chunk of genome so as to resolve inconsistencies. Such a procedure only involves pruning edges (an edge is a pairwise IBD segment), even though sometimes adding a few edges can not only resolve inconsistencies but also recover missing pairwise IBD segments in the input. Both EMI and DASH build clusters that are highly connected and therefore can prune incorrect edges as well as add missing edges. Missing edges should not be ignored, especially for short segments, as the state of the art pairwise IBD detection methods only achieve high power (e.g. 0.8) for IBD tracts longer than 2 cM in SNP data (). Detected IBD segments have many applications, one of which is IBD mapping in association studies (). One can code the multiple ibd clusters as genetic markers and use them for association testing in genome wide association studies g was. g was have identified many common variants associated with diseases, yet they have explained relatively little of the heritability of complex diseases. Rare genetic variants, often defined as variants with minor allele frequency (MAF) 51% $ 5%, can play important roles in complex diseases and traits (). It has been suggested that rare variants may contribute to disease and thus partly explain the missing heritability (). IBD mapping falls into the category of focusing mainly on signals from rare variants because IBD detection methods detect long shared segments that correspond to a relatively short time to the common ancestor. Variants arising shortly before the most recent common ancestor of a group of IBD haplotypes will be correlated with the IBD group membership; these variants, being recent, are rare. Studies have shown that IBD mapping may have higher power than association analysis of SNP data when multiple rare causal variants are clustered within a gene (). A multiple ibd cluster based association test is essentially a rare variant association test. The frequency of each cluster is determined by the number of haplotypes in that cluster, which is often small because large IBD groups are rare, especially for outbred populations. Standard methods used in g was evaluate each variant individually with univariate statistics, such as the cochran armitage test for trend, and are underpowered for rare variants unless sample sizes or effect sizes are large (). Over the past few years, many group-wise association tests have emerged as to overcome this limitation, including burden tests () and variance component tests (). Burden tests are typically based on collapsing or summarizing the rare variants within a region by a single value, which is then tested for association with the trait. However, a limitation for such methods is that they implicitly assume that all rare variants influence the phenotype in the same direction, which might not be true in real applications. Alternatively, we can cast the problem in the framework of linear mixed models with random effects and apply a global score test for the null hypothesis that all the variance components are 0. This can be conveniently tested with a variance component score test in the corresponding mixed model, which is known to be a locally powerful test (). Because most of our IBD clusters to be tested are rare, we chose to use mixed models and test for random effects of all the variants in a region. We chose to use the sequence kernel association test (SKAT) () for our analysis, as it provides a supervised flexible regression model to test for association between genetic variants (common and rare) in a region. SKAT allows for adjustment for covariates and has been shown to be powerful for most underlying hypotheses concerning the relationship of variants and complex traits ().

discussion ibd haplotype sharing is useful for many applications, such as imputation, improved accuracy in haplotype phasing, IBD mapping and population genetic inference. Most existing methods for IBD detection only consider pairwise IBD, yet the implementation and applications of multiple ibd have not been fully explored. In this study, we developed EMI to detect IBD segments that are shared by multiple individuals. Unlike the existing method DASH, which searches for a highly connected graph by dividing the big graph iteratively with a minimum cut algorithm, EMI is implemented in an agglomerative manner and uses a heuristic approach to greedily build clusters. Using efficient data structures, EMI runs faster than DASH in application to genome wide data, with comparable performance. The theoretical time complexity is hard to obtain because both DASH and EMI use methods to reduce computational effort when moving across sliding windows along the genome. However, our simulations show that the difference in running time between EMI and DASH becomes larger in a region with increased pairwise IBD sharing, such as data from isolated populations. The accuracy of inferred multiple ibd clusters has not previously been evaluated. We used coalescent simulations to evaluate the accuracy of resulting multiple ibd clusters and found the optimal parameters for subsequent analysis. Although multiple ibd clusters are supposed to be highly connected, a density cut off as low as 0.5 has a fairly good performance. The best density cut off may depend on the pairwise IBD detection program, which has to make a trade-off between power and type 1 error. For example, we used Beagle Refined IBD for pairwise IBD detection, which has a low type 1 error rate but also low power for short IBD segments. Therefore, with Beagle Refined IBD, we use a low density cut off so that we favor adding missing edges over cutting existing edges from the pairwise IBD input. If we use GERMLINE, which has weaker control of type 1 error to detect pairwise IBD segments, a higher density cut off may work better. The speed up EMI achieves might seem to be insignificant in the context of g was where a lot more time is spent on the upstream analysis. We have shown in our study that the simple heuristic performs fairly well, but the results are not optimal and can be further improved. For example, one can combine the information of clusters of all windows into a global probabilistic framework, similar to the idea behind ibd group on. When it requires many iterations to train an HMM, computational speed matters. Therefore, our method is suitable for use in more complicated models. The concept of IBD mapping is not new, yet the approach used here is different from the approaches used previously. previous note Window start and window end are the boundaries of sliding windows. SKAT P is the p value reported by SKAT, showing the significance of random effects in the mixed model. Empirical P is obtained based on minimal P values from 1000 permutations, as detailed in the text, to adjust for multiple testing across the autosomes. IBD analyses have either used pairwise IBD and looked for differences in IBD frequency between pairs of cases and pairs of controls () or have tested each multiple ibd cluster individually (). Here we use a variance components approach to jointly test the multiple ibd clusters in a region. The multiple ibd cluster approach is expected to be more powerful when multiple low frequency causal variants contribute to a trait.
