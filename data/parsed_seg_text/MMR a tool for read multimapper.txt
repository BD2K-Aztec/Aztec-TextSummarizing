Motivation: Mapping high throughput sequencing data to a reference genome is an essential step for most analysis pipelines aiming at the computational analysis of genome and transcriptome sequencing data. Breaking ties between equally well mapping locations poses a severe problem not only during the alignment phase but also has significant impact on the results of downstream analyses. We present the multimap per resolution (MMR) tool that infers optimal mapping locations from the coverage density of other mapped reads. Results: Filtering alignments with MMR can significantly improve the performance of downstream analyses like transcript quantitation and differential testing. We illustrate that the accuracy (Spearman correlation) of transcript quantification increases by 15% when using reads of length 51. In addition, MMR decreases the alignment file sizes by more than 50%, and this leads to a reduced running time of the quantification tool. Our efficient implementation of the MMR algorithm is easily applicable as a post-processing step to existing alignment files in BAM format. Its complexity scales linearly with the number of alignments and requires no further inputs. Availability and implementation: Open source code and documentation are available for down-load at http://github.com/ratschlab/mmr. Comprehensive testing results and further information can be found at

introduction addressing the increasing need for fast and accurate mapping of high throughput sequencing data to a reference sequence, many different software tools have been developed over the past years, many of which are frequently updated and improved (). While numerous challenges have been addressed by the developers, e.g. the consideration of gaps and mismatches or the spliced alignment of rna sequencing data, the problem of ambiguous read mapping still remains unresolved for many of the most popular alignment tools. Depending on factors like read length, alignment sensitivity and repetitiveness of the target genome, a large fraction of reads aligns uniquely to the target and exactly one mapping location is reported. However, for the remaining, still significantly large, fraction of reads (%1020%, depending on alignment sensitivity), several possible mapping locations exist. Currently, different strategies are employed to deal with these reads in downstream analyses, most of which have unfavorable side effects: Discarding reads with ambiguous alignments from the alignment result leads to a systematic underestimation of abundance in genomic regions with multimap per ambiguities, whereas picking a random alignment or distributing weight across all alignments uniformly does not have a proper biological justification. We provide a brief review of related approaches () in Supplementary Section A.5. Here, we present a simple, yet powerful tool, called the multimap per resolution (MMR) tool, that assigns each read to a unique mapping location in a way that the overall read coverage across the genome is as uniform as possible. MMR makes use of the critical

application as a proof of principle, we tiled the a thaliana genome with overlapping 50-mers and aligned these 50 nt reads back to the genome. This resulted in a non-uniform coverage, in particular near repetitive regions (see Supplementary). Using MMR, we could fully resolve mapping ambiguities, resulting in the expected uniform coverage of 50 almost everywhere. Although MMR has been successfully used in several studies (), we wanted to rigorously test our approach on a set of 7 million artificial rnase q reads that were generated with flux simulator () based on a subset of 5000 genes randomly drawn from the human gen code annotation (v19). We simulated read sets of length 32 nt, 51 nt, 76 nt and 101 nt, resulting in average coverages between 9 and 28. The reads were then mutated using an empirical error model that led to a native error rate of 0.9%. Three levels of random noise (1%, 2%, 3%) were applied in addition. We aligned the reads with to phat2 (v2.0.2;) and pal mapper (v0.6;), allowing for up to 6 edit operations, with no annotation provided. Further information is provided in Supplementary Section B.2. To investigate the effect of MMR on downstream analyses, we performed transcript quantification using Cufflinks () (v2.1.1) and r quant (unfiltered best mmr. MMR results on simulated read data: quantification results on 7 million simulated 51 nt reads aligned with to phat2 using r quant and Cufflinks. Accuracy was measured as Spearman correlation to ground truth. Unfiltered read sets are shown in dark, best hit read sets in medium and mmr filtered in light gray. Native error rate is 0.9%, noise levels 13% MMR: a tool for read multimap per resolution mmr filtered alignments, the best alignments only (the alignment ranked highest by the aligner) and on completely unfiltered alignments. For to phat2 and pal mapper the quantifications based on the mmr filtered alignments showed a consistently better correlation to the ground truth than both the best hit and unfiltered alignments sets. The shorter reads of length 51 nt () showed larger improvements compared to unfiltered (Cufflinks: 2.7%, r quant 15.0%) and best hit set (Cufflinks: 5.6%, r quant 4.0%) than the longer reads of length !76 nt, that showed consistent but smaller improvements (Supplementary Figs S5S7).

conclusion we presented MMR, a post-processor for BAM files, resolving ambiguous alignment locations. We showed its easy applicability to the output of different alignment methods and illustrated that MMR can greatly improve accuracy of downstream quantification methods. Although the improvements seem moderate on a global scale, the effect on single genes can be much larger. Given its lean implementation and the short running time, MMR is very well suited for large scale genome-, exo me and rna sequencing efforts. Its good performance on short reads also suggests an application to ribosome footprinting data (). MMR may also be useful for post-processing alignments in meta genome projects for improved selection of tax a
