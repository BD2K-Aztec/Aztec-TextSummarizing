Motivation: Horizontal gene transfer (HGT) plays a crucial role in the evolution of prokaryotic species. Typically, no more than a few genes are horizontally transferred between any two species. However, several studies identified pairs of species (or lin ages between which many different genes were horizontally transferred. Such a pair is said to be linked by a highway of gene sharing. Inferring such highways is crucial to understanding the evolution of prokaryotes and for inferring past symbiotic and ecological associations among different species. Results: We present a new improved method for systematically detecting highways of gene sharing. As we demonstrate using a variety of simulated datasets, our method is highly accurate and efficient, and robust to noise and high rates of HGT. We further validate our method by applying it to a published dataset of 422 000 gene trees from 144 prokaryotic species. Our method makes it practical, for the first time, to perform accurate highway analysis quickly and easily even on large datasets with high rates of HGT. Availability and implementation: An implementation of the method can be freely downloaded from: http://acgt.cs.tau.ac.il/hide.

introduction horizontal gene transfer (HGT, also called lateral gene transfer) is an evolutionary process in which genes are transferred between two organisms that do not have an ancestor descendant relationship. HGT is known to be rampant among prokaryotes, and plays an important role in their evolution and survival. An important problem in understanding microbial evolution is to infer the HGT events (i.e. the donor and recipient species of each HGT) that occurred during the evolution of a set of species. This problem is generally solved in a comparative genomics framework by using a parsimony criterion, based on the observation that the evolutionary history of horizontally transferred genes does not agree with the evolutionary history of the corresponding set of species. (This is illustrated in Supplementary). More formally, given a gene tree and a species tree, the hgt inference problem is to find the minimum number of HGT events that can explain the incongruence of the gene tree with the species tree. The hgt inference problem is known to be np hard under most formulations () and, along with some of its variants, has been extensively studied (). In general, one expects only a few genes to have been horizontally transferred between any given pair of species. However, it has been observed that some pairs of species are connected by a multitude of HGT events. This can happen, for example, when a pair of species co inhabit the same ecological niche over a long period of time (), due to syn trophic or other close symbiotic relationships between partners (), or because only the acquisition of a complete pathway can provide a selective advantage to the recipient (). Such pairs of species are said to be connected by a highway of gene sharing (point out that used the term highways in a slightly different way than we do: For be iko et al., highways could exist not only between two species but also between two clades of the species tree, i.e. their highways are formed by a collection of many individual HGTs spanning two clades.). These highways point towards major events in evolutionary history; well corroborated examples are the uptake of endosymbionts into the eukaryotic host, and the many genes transferred from the symbiont to the host's nuclear genome (). Recent proposals for evolutionary events that may be reflected in highways are the role of Chlamydiae in establishing the primary plastid in the archae plastid a (red and green algae, plants and glaucocystophytes) (), the evolution of double membrane bacteria through an endo symbiosis between clostridia and actinobacteria () and the high rate of transfer between marine Synechococcus and Prochlorococcus (). In this work, we introduce a fast and accurate method for highway inference. Given a rooted species tree, any two species (nodes) in it that are not related by an ancestor descendant relationship define a horizontal edge connecting those two nodes any HGT event must take place along a horizontal edge in one of its two directions. A horizontal edge along which an unusually large number of HGT events have taken place will be called a highway of gene sharing or simply a highway. Although it is hard to give a precise threshold that would designate an edge as a highway, any horizontal edge that contains a markedly higher number of HGTs than would be expected by chance for that dataset can be viewed as a highway. In our simulation studies, we defined highways to be those horizontal edges that affect at least 5% of the genes with a history of hgt were the first to study the problem of highway inference (but see also). They used a straightforward approach: Given a set of gene trees and a trusted species tree, they computed the history of HGT events for each gene tree separately and then combined the results across all gene trees. The horizontal edges that are inferred in the HGT scenarios for a significant fraction of the gene trees are the postulated highways. Thus, their solution relies on inferring the individual HGT events by solving the hgt inference problem. This is problematic for several reasons: First, the hgt inference problem itself is np hard under most formulations, and thus, difficult to solve exactly. Second, there are often multiple (and sometimes exponentially many) optimal solutions to the hgt inference problem (). And third, when the gene tree has only a subset of the tax a present in the species tree, the placement of the inferred HGTs on the species trees becomes ambiguous. Furthermore, when the rate of HGT is relatively high, the number of HGT events need not be parsimonious; i.e. the hgt inference problem, even if solved exactly and yielding only one optimal solution, may not infer the actual HGT events. HGT events can also be inferred using a more sophisticated reconciliation framework that explicitly accounts for gene duplication and loss events in addition to HGT events (). Since such a framework is able to explicitly consider duplication and loss events, it can handle gene trees that have multiple gene copies per species; in the approach of, as well as in our approach, gene trees are restricted to contain at most one copy of a gene per species. However, the same drawbacks (discussed above) that affect the hgt inference problem apply to the more sophisticated framework as well (). Recently, we introduced a novel polynomial time algorithm to detecting highways that bypasses the need to infer individual HGT events (). The method is based on the observation that highways, by definition, affect the topologies of many gene trees. Thus, the idea is to combine the phylogenetic signals for HGT events from all the gene trees and use the combined signal to infer the highways. This is achieved by using quartet decomposition: The method decomposes each gene tree into its constituent set of quartet trees and combines the quartet trees from all the gene trees to obtain a single weighted set of quartet trees. The combined set of quartet trees is then analysed against the given species tree to infer the highways. The intuition is that quartet trees that disagree with the species tree may indicate HGT events and thus the collective evidence from all quartet trees could pinpoint possible highways. In this work, we propose an alternative method based on quartet decomposition to detect highways, which greatly improves upon the accuracy, noise tolerance and applicability of the method of. Our method differs from the approach of in many important ways: (i) we analyse the quartet decomposition of each gene tree separately before combining the results across all gene trees, (ii) we propose a new way to assign scores to horizontal edges, which is sensitive to the direction of transfer of individual HGT events and (iii) we show how to reduce the amount of noise in the computed scores in order to pinpoint highways even more accurately. As we demonstrate using extensive simulations, compared with the approach of, our new method is significantly more accurate, much more robust to high rates of HGT and noise and is able to seamlessly handle gene trees with many missing tax a. For example, in simulated 50-taxon datasets with 1000 genes, a highway of 100 genes and 2000 random HGTs ('noise'), the new method identifies the correct highway in 98% of the cases, compared with 530 for the old method. It is worth mentioning that quartets have been previously used for phylogenetic analyses in other contexts; for example for phylogeny construction (), super trees () or analysis of HGTs (). Two methods, eee p () and Prunier (), exist for inferring HGT events on unrooted gene trees. These methods were not designed for inferring highways but can be used indirectly for doing so (as in). Our quartet based approach offers important advantages over approaches based on inferring HGT events: (i) We do not face the problem of dealing with multiple optimal solutions for the hgt inference problem, (ii) we can seamlessly incorporate gene trees with only a subset of tax a which is difficult to do effectively with hgt inference methods and (iii) our method is significantly more scalable and time efficient than both eee p and Prunier. In general, inferring highways based on hgt inference methods can be slow and technically complex. Our method simplifies the process of detecting and inferring highways. As our simulation study shows, our method is also accurate. We also applied the method to a dataset of 144 tax a and 22 430 gene trees from. Our results are largely consistent with previous analyses of this dataset, and the entire computational analysis of this large dataset took 52 days (using a single CPU). Our new method thus makes it possible to easily, quickly and accurately infer highways even for large datasets as well as on datasets with high rates of HGT. We have implemented our method into a freely available software package called HiDe (short for Highway Detection). HiDe is, to the best of our knowledge, the only available software package designed specifically to address the problem of inferring highways.

discussion in this work, we presented a new and improved method for systematically detecting highways of gene sharing. As shown in the simulation study, our method is highly accurate, and robust to noise and high rates of HGT. Our analysis of the 144 tax a 22 430 gene tree dataset of demonstrates the utility of our method in identifying potential highways, even in large datasets. Our simulation parameters correspond well to real data. In the dataset of, only $5000 HGTs, including several highways of size 100500, are reported on the entire dataset of $20 000 gene trees. Our experiments show (see Section S.2 in the supplement) that by distributing the same number of HGTs across more gene trees, the performance of the method is unaffected and may even slightly improve. Our simulation scenarios have a comparable or smaller highway size (50150 HGTs), a comparable or higher noise level (10006000 random HGTs) and less gene trees (1000). As the number of tax a that we use is smaller (50 versus 144), the random HGTs are less spread in our case, which again makes our scenario harder as we observed in Section 4.1.1. Hence, the simulations present a scenario that is as difficult or harder than the real data in each of the parameters. The numbers of genes in our highways correspond well to other highways characterized in the literature, e.g. in thermotoga les () and in aqui fica les (). Highways represent major shifts from the pattern of vertical inheritance, and their detection is crucial for correctly representing the evolutionary history of prokaryotes. Indeed, a logical first step towards building a comprehensive phylogenetic network for the prokaryotes () is to start with the ribosomal tree as backbone and augment it with highways. By making it easy to quickly and accurately detect such highways, our method represents an important step towards building the prokaryotic net of life. As with the method of, our new method is based on quartet decomposition. However, we use quartet decomposition in a different way and, as a result of this and other methodological improvements, our method achieves far better results and greatly improves upon its accuracy, noise tolerance and applicability. Still, our method has several limitations. It makes use of the parsimony principle, and if a dataset contains two highways that are closely related to one another then the method may only detect one of them (as many of the inconsistent quartet trees from one highway may also support the other highway). Formulating the highway detection problem in a probabilistic framework could help improve the accuracy of highway detection. Also, a statistical analysis of highway and HGT score distributions could help provide more quantifiable significance of the computed highways, which we currently lack. Our method is unable to detect HGTs between two sister species (i.e. two species that have the same parent), a limitation shared by all existing phylogenetic methods for studying HGT (but see). Our analysis of the dataset of be iko et al. suggests that, as with all previous methods, our method is vulnerable to errors in the species tree, and that such errors can manifest themselves as highways in the analysis. Extending the method to deal cleanly with uncertainty in the species tree topology would help to pinpoint highways more accurately. It would also be interesting to study how convergent gene losses in unrelated tax a (e.g., species that have independently converged to parasitic lifestyles) affect our method. Finally, it may help to distinguish between directed and undirected highways of gene sharing (see Section S.3 in the supplement).
