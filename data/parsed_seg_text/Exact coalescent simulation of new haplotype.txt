Motivation: We introduce a coalescent based method re coal for the simulation of new haplotype data from a reference population of haplotypes. A coalescent genealogy for the reference haplotype data is sampled from the appropriate posterior probability distribution, then a coalescent genealogy is simulated which extends the sampled genealogy to include new haplotype data. The new haplotype data will, therefore, contain both some of the existing polymorphic sites and new polymorphisms added based on the structure of the simulated coalescent genealogy. This allows exact coalescent simulation of new haplotype data, compared with other methods which are more approximate in nature.

introduction we live in an era in which the genome wide association study g was is one of the standard tools by which we interrogate the genome for polymorphisms that relate to phenotype. There is also a growing use of next generation sequence (NGS) data. A large number of new methodological approaches are being developed and published in both areas. There is much discussion about the degree to which the g was approach has been successful, for example, see;, but in humans many new associations between genotype and disease status have been discovered. An important part of the process of methods development in the g was era is the testing of those methods on both real and simulated test data. Frequently investigators have a single, smaller set of data from a given population, the features of which they wish to mimic when producing multiple, larger datasets for testing purposes. A common example is the HapMap data () or 1000 Genome Project (1000GP) data (1000). In this article, we present an * To whom correspondence should be addressed. exact coalescent method for simulating test sets of new haplotype (or genotype) data, based upon such an existing, smaller, initial sample. The goal is to sample new datasets, D , consisting of n (say) haplotypes, conditional upon some observed, existing data, D, which contains n o  n haplotypes. Under the assumption that the popular coalescent model is a reasonable approximation to the evolution of the data, the goal here is to produce new data, D , conditional on the unobserved genealogy, G, of the existing data, D (since it is through G that the dependence of D on D is expressed). Note that in the presence of recombination G will be a graph, the so called ancestral recombination graph (ARG), rather than a tree. The problem of sampling G conditional on D is computationally challenging, and for that reason several approximate methods have been proposed, the most relevant here being hap gen () and hap sample (), which are based upon the pac likelihood method of (). The algorithm of Li and Stephens is an appealing way to reduce the computational burden involved in calculating probabilities under a full coalescent model. Instead, it uses an approximation scheme, based upon a model in which haplotypes are explained as mosaics of other existing haplotypes. This scheme is shown to (i) reduce computational burden significantly, and (ii) provide a good approximation to probabilities that would be obtained under the full coalescent model. However, it remains the case that one would prefer to sample from the exact coalescent model when such a thing is tractable. In this article, we present software that makes this practical for regions of length up to 500 kb, using as many as about n o = 100 reference haplotypes.

discussion in this article, we introduce an exact coalescent method for the simulation of new haplotype data from an existing set of reference haplotypes. Our method, re coal simulates data from the distribution P(D | D,,) using the full coalescent model rather than using an approximation to that model. In addition to the replication of SNPs present in the reference haplotypes, re coal also simulates new SNPs using a coalescent prior. It preserves LD structure well, and we demonstrate that new polymorphism is added at an appropriate level. Because of its exact nature, re coal is less computationally tractable than the approximation underpinning hap gen but it is produces data under the full coalescent model rather than the approximation to the coalescent model exploited by hap gen. As such, we argue that it is appropriate to use re coal when computational considerations permit. Nonetheless, we believe hap gen remains an excellent alternative approach. It should be noted that Step 1 of our approach is based on an MCMC method. As such the user must allow the MCMC chain to converge to the stationary distribution of P(G | D,,). The time taken to reach convergence increases with both overall recombination rate and number of reference haplotypes. Thus, the combination of recombination rate and the number of reference haplotypes determine the limits of computational tractability of re coal. As an example, the simulation used in this article, which includes 40 reference haplotypes over a 100 kb region with human population parameters, takes 4 h to simulate 1000 new haplotypes on a typical desktop machine. As such, re coal is intractable for simulation of regions larger than 500 kb. However, in the context of followup of a g was for example, in which the area being investigated may be quite short, our software allows for the exact coalescent simulation of new haplotypes conditional on the existing data, under the coalescent model, rather than using a more approximate method. When larger regions are desired, or much larger reference samples exist, we recommend the approximate method hap gen still be used. Of course, our method is model based and, as such, is exact in the sense that it samples from exactly the correct distributions conditional on that model. This, then, is a good time to remind the reader of a quote attributed to George Box: 'All models are wrong; some are useful'. The coalescent has proven itself to be widely useful, but it is still, of course, 'wrong'. One example of its 'wrong-ness' in the present context is that we use a neutral model of molecular evolution, ignoring natural selection. There is a literature about the coalescent with selection included (), and some programs () can simulate data with the presence of the selective mutation. But those models are not tractable when one wishes to condition upon the existing data, so, like most other coalescent simulators, re coal simulates data under neutrality. Another area in which our model is wrong is that it is based upon an unstructured coalescent. In other words, we assume random mating. While this has proven to be a robust approximation to the behavior of single populations, it has proven necessary to introduce extensions to the coalescent when population structure is present. As such we would recommend caution when applying our method to datasets in which multiple populations are present, or selection is expected to have occurred. In the former context, for example, it might be more appropriate to produce new haplotypes for each subpopulation separately, by dividing the data into its subpopulations and applying re coal to each subpopulation in turn. The existing version of re coal allows for fine-scale variation of recombination rates and for exponential growth of population size. Extensions to other more complex demographic scenarios such as bottlenecks and population admixture are also possible, and are currently under development. Finally, we also presented an extension of our method to ascertained data in which the probability of ascertainment is a function of allele frequency. Admixture is an extremely challenging problem in coalescent methods and we note in passing that our correction illustrates how sampling of an underlying coalescent genealogy, condition upon observed polymorphism data, can be adapted to respect such an ascertainment scheme. Funding: National Institutes of Health (MH084678) and National Science Foundation (HG005927), as well as improvements due to comments received from the reviewers.
