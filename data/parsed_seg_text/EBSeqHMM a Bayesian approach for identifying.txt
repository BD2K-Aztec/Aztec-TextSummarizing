Motivation: With improvements in next generation sequencing technologies and reductions in price, ordered rnase q experiments are becoming common. Of primary interest in these experiments is identifying genes that are changing over time or space, for example, and then characterizing the specific expression changes. A number of robust statistical methods are available to identify genes showing differential expression among multiple conditions, but most assume conditions are exchangeable and thereby sacrifice power and precision when applied to ordered data. Results: We propose an empirical Bayes mixture modeling approach called eb seq hmm. In eb seq hmm an auto-regressive hidden Markov model is implemented to accommodate dependence in gene expression across ordered conditions. As demonstrated in simulation and case studies, the output proves useful in identifying differentially expressed genes and in specifying gene specific expression paths. eb seq hmm may also be used for inference regarding isoform expression. Availability and implementation: An R package containing examples and sample datasets is available at Bioconductor.

introduction with improvements in next generation sequencing technologies and reductions in price, ordered rnase q experiments are becoming common. Of primary interest in these experiments is characterizing how genes are changing over some factor with ordered levels (for example, ordered in time, in space, along a gradient, etc). For simplicity, we refer to any ordered rnase q experiment as a time course experiment, noting that other similar designs may be analyzed within this framework; and we restrict attention to time course data collected within a single biological condition. In a time course rnase q experiment, an investigator may be interested in genes that are monotonically increasing or decreasing, that increase initially then decrease, that increase initially then remain unchanged and so on. We refer to these types of changes in expression hereinafter as expression paths, and we consider three broad types: (i) constant paths: expression remains unchanged, or equally expressed (EE), over all time points; (ii) sporadic paths: expression shows some change between at least one pair of time points, but remains unchanged between at least one other pair and (iii) dynamic paths: expression changes continuously. With respect to the examples listed earlier, the first few (expression is monotonically increasing, monotonically decreasing, increasing then decreasing) are instances of dynamic paths. The last (increase initially then remain unchanged) is an example of a sporadic path. A number of robust statistical methods are available for identifying differentially expressed (DE) genes eb seq (), DESeq2 (), edgeR (), voom (), bay seq (), Cuffdiff2 ()] as well as isoforms eb seq r seq diff (), Cuffdiff2, bit seq (in a static rnase q experiment; and most of these methods accommodate time course experiments by considering time as a factor with multiple, unordered, levels (Supplementary Section S7 provides details). The statistical tests employed are designed to identify a gene as DE if it shows a change at least one time point; and, consequently, non-constant genes are detected collectively. Multiple steps of subsequent analyses are required if an investigator wants to distinguish sporadic paths from dynamic ones, to classify genes into distinct paths and to assess the associated classification uncertainty for example, perform model fitting multiple times with different design matrices and then adjust for multiple testing. In addition, as these approaches were not designed specifically for time course experiments, they do not accommodate dependence over time and consequently sacrifice power if applied in this setting. These same issues were addressed in the context of microarray time course experiments, and a number of methods are available for analyzing () and clustering () time course microarray data. These methods are not directly applicable to rnase q studies since they do not accommodate count data, the unequal variabilities in measurements or the dependence of isoforms within genes. To address this, the approach developed by, ma sig pro originally developed for microarray time course analysis, was recently extended to accommodate ordered rnase q count data (). Like DESeq2 and edgeR, ma sig pro glm is based on a negative binomial (NB) generalized linear model (GLM); but unlike previous approaches, ma sig pro glm defines gene specific expected expression by a time dependent polynomial to accommodate dependence over time. Once significant genes are selected, a second regression is conducted for each gene to identify the time points at which it shows expression differences. Clustering algorithms are then applied to the resulting regression coefficients and or expression values to identify groups of genes with similar expression profiles. Although useful the two step procedure makes it challenging to determine appropriate thresholds for false discovery rate (FDR) control, and suggested thresholds are conservative in many settings (). In addition, identified gene groups are subject to limitations inherent in clustering algorithms; namely, the number of groups as well as group membership are determined by user defined cutoffs, there is no probabilistic information associated with a given gene's membership within a group, and it is not clear how to classify gene groups into expression paths to address these considerations, we have developed an empirical Bayes auto-regressive hidden Markov model (HMM) based approach called eb seq hmm. The model extends our previous work, eb seq for identifying DE genes and isoforms across two or more biological conditions (). As detailed in Methods, an auto-regressive process describes changes in expression over time, and a hidden Markov component is used to accommodate dependence. eb seq hmm allows users to identify genes with non-constant expression over multiple ordered conditions, and simultaneously classify them into expression paths. Results from a simulation study, detailed in Section 3.1, suggest that eb seq hmm has increased power over competing approaches for identifying genes following non-constant paths, especially for those genes showing subtle yet consistent changes over time. eb seq hmm also provides improved accuracy in classifying genes into expression paths. Similar results are demonstrated in a case study of the adult mouse limb presented in Section 3.2.

discussion we have developed an approach called eb seq hmm for analysis of ordered rnase q experiments. eb seq hmm may be used to identify genes that are DE across a set of ordered conditions and to classify genes into their most likely expression paths. There are a number of methods available for identifying DE genes that may be used when data from multiple conditions is available. eb seq hmm has two main advantages over these approaches. First, it accommodates dependence across ordered conditions and consequently has increased power to identify genes showing subtle, yet consistent, changes. Second, for every gene, eb seq hmm calculates the gene specific PP associated with each possible expression path and in doing so allows for genes to be classified into distinct expression paths with a pre-specified FDR. Put another way, eb seq hmm not only identifies genes that change across conditions, but can be used to specify how they change. Simulations demonstrated the power of eb seq hmm over other approaches to identify DE genes. In particular, results showed that DESeq2, edgeR and voom perform well in detecting trends and or changes are relatively strong, but that eb seq hmm has increased power to identify genes showing weaker changes. eb seq hmm also worked well for identifying genes showing sporadic changes (where there is no dependence across ordered conditions as for some genes in Sim II). Applying ma sig pro glm with its default cut off for calling DE genes gave significantly reduced power than other approaches. Relaxing the cut off improved its power, but it was still inferior to the others. In addition to DE gene identification, eb seq hmm performed well for classifying genes into expression paths. We defined a gene as being in a particular path if the gene was classified as DE at FDR 5% (PP of EE was less than 0.05) and the PP of being in that path exceeded 0.5. Given the two step process, observed mis-classification rates were conservatively controlled. Note that in some cases, a DE gene may not be classified to any particular path. For example, if the last time point of a four condition experiment is known to be noisy, a gene that is initially increasing may have equal PP, say one third of being up up up up up ee and up updown. This gene would be called DE with 5% FDR since p pee eeee  0.05, but it would not be assigned into a particular expression path if threshold 0.5 was used. In some cases, a user may want to modify these thresholds. If a false negative classification was considered more serious than a false positive, this threshold could be adjusted. Motivation for doing so under varying loss functions is discussed in ().
