Motivation: The identification of short insertions and deletions (indels) and single nucleotide polymorphisms (SNPs) from Ion Torrent and 454 reads is a challenging problem, essentially because these techniques are prone to sequence erroneously at homopolymers and can, therefore , raise indels in reads. Most of the existing mapping programs do not model homopolymer errors when aligning reads against the reference. The resulting alignments will then contain various kinds of mismatches and indels that confound the accurate determination of variant loci and alleles. Results: To address these challenges, we realign reads against the reference using our previously proposed hidden Markov model that models homopolymer errors and then merges these pairwise alignments into a weighted alignment graph. Based on our weighted alignment graph and hidden Markov model, we develop a method called pyro hmm var which can simultaneously detect short indels and SNPs, as demonstrated in human resequencing data. Specifically, by applying our methods to simulated diploid datasets, we demonstrate that pyro hmm var produces more accurate results than state of the art methods, such as sam tools and g atk and is less sensitive to mapping parameter settings than the other methods. We also apply pyro hmm var to analyze one human whole genome resequencing dataset, and the results confirm that pyro hmm var predicts SNPs and indels accurately. Availability and implementation: Source code freely available at the following

introduction the most prevalent variants on the human genome are single nucleotide polymorphisms (SNPs) (). The second most prevalent variants are insertions and deletions (indels) that occur every 7.2 k bp (). Among them, 484% are short indels (55 bp) (). At present, the next generation sequencing technology facilitates the direct detection of SNPs and short indels by resequencing a personal genome (). After sequencing, reads are mapped against the reference genome by read mapping programs (), and variants are called by hypothesis testing methods on the piled up reads (). However, accurate variant detection depends on the ability to discriminate true variants from sequencing errors. Particularly, for Ion Torrent and 454 data, indels are the most common sequencing errors causing incorrect alignments and thus posing a major roadblock to the accurate detection of variants. Ion Torrent and 454 can uniquely sequence homopolymers by quantifying the number of released by-products in the process of DNA synthesis (). At the same time, however, these techniques are prone to homopolymer sequencing errors, either over calling or under calling the number of homopolymer bases (). Moreover, the carry forward and incomplete extension effects, which happen as a few template copies may grow in desynchronization with the population, also raise insertions in reads. However, existing mapping methods do not include models to tackle homopolymer errors; therefore, alignments around homopolymers can be incorrect, resulting in calling false variants (). Therefore, a comprehensive method is necessary to improve the accuracy of variant calling for Ion Torrent and 454 data. Most of the existing methods detect SNPs and indels independently. The general strategy is to establish an accurate error model for the specific sequencing platform. For example, atlas snp2 () developed a logistical regression model relying on sequence context to discriminate true SNPs from sequencing errors. Realignment has been proven as an efficient method to improve accuracy by adjusting raw mappings. In response, sam tools (), for example, deploys a concept termed base alignment quality (), which is calculated by realigning a read against a reference to decrease false SNPs caused by nearby indels. Meanwhile, g atk () adjusts the alignments of reads spanning over indels by performing local multiple sequence alignment. However, as noted above, most of these methods are not designed to engage the problem of homopolymer errors and incorrect alignments around homopolymers. We previously proposed a method termed pyro hmm snp () for Ion Torrent and 454. This method implements a hidden Markov model (HMM) to formulate homopolymer errors and trains the HMM by an expectation maximization (EM) algorithm using resequencing data. Then, the trained HMM is used to realign reads against the reference sequence around homopolymers to improve the performance of SNP calling. *To whom correspondence should be addressed. Identification of indels in the reference is a more challenging problem in short read sequencing. One of the major obstacles is to identify potential genome positions where indels are located. Strategies for identifying indels are different. Specifically, long insertions can only be found through sequence assembly, either local assembly () or global assembly (), whereas deletions can be found through either sequence assembly or sequence alignments (). Strategies for identifying short and long indels are also quite different. In principle, short indels, sometimes even long deletions, can be found by aligning one read against the reference, as long as a reliable read mapping program is used. However, because the read length is short, such mapping generally produces many false alignments with various kinds of indels and mismatches. To confirm the existence of an in del we would have to examine multiple pieces of evidence, such as multiple aligned reads, read coverage and constraints of paired end reads. To the best of our knowledge, robust in del detection remains unsettled. In this article, we propose a method termed pyro hmm var to call SNPs and short indels for both Ion Torrent and 454 resequencing data. Two distinct features are highlighted in pyro hmm var. First, we introduce an HMM to formulate homopolymer errors. The HMM can accurately distinguish real signals from sequencing errors and thus improve the alignment of reads against the reference. The parameters of HMM are trained directly from raw mapping results through an iterative EM algorithm. Second, we propose a graph data structure that merges multiple aligned reads at a given locus into a weighted alignment graph from which we reconstruct the consensus sequence(s). The use of the weighted alignment graph provides the following advantages. First, it enables the straightforward construction of the haplotype(s), which may contain both SNPs and indels. In comparison, din del () infers indels separately from SNPs. Second, we propose an efficient traversal algorithm over the weighted alignment graph to avoid the exhaustive and computationally complex enumeration of candidate haplotypes. We simulate SNPs and short indels in the diploid genome and use them to test the performance of pyro hmm var. Compared with two state of the art methods, sam tools () and g atk (), pyro hmm var gives more accurate results. We also test the effect of the raw alignments produced by mapping programs to in del snp calling accuracy by varying the scoring function of b was w () to produce different mappings. The test results show that pyro hmm var is less sensitive to the variation of the scoring function than the other programs. Finally, we apply pyro hmm var to analyze one human whole genome resequencing dataset, and the results confirm that pyro hmm var predicts SNPs and indels accurately.
