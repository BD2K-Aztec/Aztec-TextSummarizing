Motivation: RNAs fold into complex structures that are integral to the diverse mechanisms underlying RNA regulation of gene expression. Recent development of transcriptome wide RNA structure profiling through the application of structure probing enzymes or chemicals combined with high throughput sequencing has opened a new field that greatly expands the amount of in vitro and in vivo RNA structural information available. The resultant datasets provide the opportunity to investigate RNA structural information on a global scale. However, the analysis of high throughput RNA structure profiling data requires considerable computational effort and expertise. Results: We present a new platform, structure fold that provides an integrated computational solution designed specifically for large scale RNA structure mapping and reconstruction across any transcriptome. structure fold automates the processing and analysis of raw high throughput RNA structure profiling data, allowing the seamless incorporation of wet bench structural information from chemical probes and or ribonucleases to restrain RNA secondary structure prediction via the rna structure and vienna rna package algorithms. structure fold performs reads mapping and alignment, normalization and reactivity derivation, and RNA structure prediction in a single user friendly web interface or via local installation. The variation in transcript abundance and length that prevails in living cells and consequently causes variation in the counts of structure probing events between transcripts is accounted for. Accordingly, structure fold is applicable to RNA structural profiling data obtained in vivo as well as to in vitro or in silico datasets. structure fold is deployed via the Galaxy platform.

introduction rna plays vital roles in myriad cellular functions, including regulation of transcription, RNA processing and stability, and translation (). The secondary and tertiary structures of RNAs are integral to their biological functions; e.g. as ligand binding sensors ribo switches enzymes (ribozymes) or temperature sensors (RNA thermometers). Therefore, knowledge of RNA structure, especially in vivo, is essential for a mechanistic understanding of RNA function. Understanding of RNA structure has been greatly advanced through the development of computational approaches for RNA secondary and tertiary structure prediction (). Resultant software packages () include rna structure (), vienna rna package (), mc fold mc sym () and seq fold (). Each method has its advantages (cf.), including pseudoknot predictions, local folding, g quadruplex folding and prediction of 3D structure. Nonetheless, any purely computational RNA structure prediction method has severe limitations due to incomplete knowledge of free energy parameters, RNA interaction with other molecules ranging from ligands to proteins, and kinetically controlled RNA folding. To overcome these limitations, rna modifying agents can be used to provide experimental restraints regarding the single and double stranded regions of the RNA. For example, critical RNA structural information can be provided using nucleases () such as RNase V1, which cleaves double stranded RNA sites, and RNase S1, which cleaves single stranded RNA sites. However, a limitation of such nuclease based structure probing is that it can only be applied in vitro. RNA structures in vivo can be very different due to protein binding, rna rna interactions, ionic and pH conditions, and other aspects of the cellular milieu such as molecular crowding and the influence of metabolites that are impossible to either completely model in silico or reconstitute in vitro (). As an alternative to nucleases, several RNA modifying chemicals, including dimethyl sulfate (DMS;) and Selective 2 0 hydroxyl Acylation analyzed by Primer Extension (SHAPE) reagents () can be employed to report the presence of single stranded nucleotides in RNA and thus provide experimental information on RNA structure. DMS methyl ates the watson crick N1 position of adenine and N3 position of cytosine when these positions are not engaged in watson crick base pairing or other interactions. SHAPE reagents acy late the 2 0 hydroxyl group on the sugar of flexible nucleotides of all four nucleotide types. An advantage of chemical probing methods is that many can be applied in vivo as well as in vitro (). nuclease based cleavage truncates the RNA template available for reverse transcriptase (RT), while the above chemical modifications of the RNA halt the reverse transcriptase one nucleotide before the modification (). Both of these effects can be read out as 'stops' in reverse transcription using conventional methods based on gel (PAGE) or capillary electrophoresis (). Such electrophoresis based methods, however, only read out this structural information for relatively short segments of individual RNAs and so are low throughput and incapable of providing transcriptome wide data. Recently, genome wide methods employing high throughput sequencing techniques to identify the RT stops resulting from cleavages or chemical modifications have been developed (e.g.. These methods make it possible to obtain structural information on thousands of RNAs in a single experiment. To date, such studies have been conducted in vitro in yeast (), mouse (), Drosophila, C. elegans (), Arabidopsis () and human (), and in vivo in Arabidopsis (), yeast () and human cells (). Another method, shape map that relies on mutagenesis rather than RT stops, has been applied in vitro to the HIV-1 RNA genome (). We recently reviewed many of these approaches (). While the combination of RNA structure probing with high throughput sequencing is a major advance in the RNA field, it); vienna rna package (); mc fold mc sym (); seq fold (. electrophoresis based versus ngs based RNA structure probing. The left side diagrams the standard electrophoresis based method, while the right side diagrams the next generation sequencing ngs based approach, as exemplified by structure seq. Chemical probe treatment can be in vivo or in vitro; nuclease treatment is in vitro. Chemical probe treatments usually result in a covalent modification of the RNA that terminates reverse transcription (RT). Nuclease treatment results in cleavage of the RNA (not explicitly illustrated). Green lines indicate several copies of a transcript. Gold indicates 32 P radiolabel. Black, red, and purple lines indicate cDNA. Red lines indicate RT products resulting from imperfect RT processivity; such RT drop off products will on average be accounted for by comparison to control data produced without nuclease or chemical probe treatment. In the ngs based readout, purple lines indicate 5 0 runoff RT products; although they do not provide information on RT structure stops, inclusion of these reads (as well as red and black reads) in the structure seq method is critical as it allows proper normalization for transcript abundance requires intensive computational efforts to derive the explicit predicted re activities and secondary structures transcriptome wide from high throughput RNA structure profiling data. Some efforts have been made to develop algorithms and implement software tools and web servers to facilitate the data analysis process for high throughput RNA structure profiling (), which includes reads mapping, normalization, reactivity derivation and RNA structure prediction (). Here we provide a brief overview of these methods and then indicate the advances provided by structure fold. Spats () is a method to derive re activities from shape seq raw data () based on maximum likelihood, primarily to solve the problem arising from the signal decay that occurs at the 3 0 end of each cDNA read when using a single fixed primer that initiates reverse transcription at the 3 0 end of the RNA. mod seeker () is a method that identifies significantly enriched sites of DMS modification by cochran mantel haenszel tests on each transcript and defines structural reactivity as the fold enrichment of RT stops on each nucleotide in the DMS treated library relative to a control library with no DMS treatment. While Spats and mod seeker provide methods to derive structural re activities from high throughput RNA structure profiling data, Spats focus on reactivity information for individual RNAs, while the structural re activities provided by mod seeker are not directly comparable between different RNAs in a transcriptome. In addition, while these programs calculate re activities they do not include the essential step of actual prediction of RNA structures. SAVoR takes RNA sequences and mapped high throughput RNA structure profiling data as inputs, and outputs individual RNA structures from the rna fold program in the vienna rna package (), either including experimental restraints as derived from mapped high throughput RNA structure profiling data or without any restraints. The online SAVoR platform is easy to use but it can not be downloaded and installed locally, and it does not provide an option to output transcriptome wide RNA structural re activities or structures, which is crucial for deriving global principles of RNA folding and function. shape mapper and the sm folding pipeline software developed in the shape map approach () rely on mutagenesis rather than stops during RT. The programs output structural re activities as well as predicted RNA structures here we describe our development of structure fold a series of software packages that integrates reads mapping, RT stop count calculation, reactivity derivation, and structure prediction in a web based interface. The two inputs to structure fold are transcriptome sequence and (optional) high throughput RNA structure profiling data; the outputs are structural re activities on each nucleotide transcriptome wide and the corresponding RNA structures predicted with or without the experimental restraints. By taking into account the differential abundances and lengths of RNAs in a transcriptome, structure fold provides values of in vivo structural re activities of nucleotides on different RNAs that are directly comparable. structure fold is provided as a component of the Galaxy platform (http://www.galaxyproject.org) and takes advantage of the computational tools available in Galaxy (), such as Bowtie () and sam tools (). structure fold consists of a series of intuitive modules that are easy to use, either online or after local installations pats (); mod seeker (); SaVoR (); shape mappers m folding pipeline (); structure fold (this study processes and ovals represent outputs. Outputs of modules that are also inputs for the next module are left as ovals remove a user specified number of nucleotides at the 5 0 and or 3 0 end of each read. This process is useful for removing adapter sequence from the read. Users can also use the v option to set the flag for the number of mismatches allowed while mapping. If a read can not be mapped, it may be because of internal mismatches between the read and the reference library sequence, or because adapter sequence is included in the read. Accordingly, if a read can not be mapped, it is trimmed by a user specified number of nucleotides at the 3 0 or 5 0 end, and mapping to the reference library is again attempted. The process is iterated until the read either properly maps or is less than the minimum length requirement specified by the user, which typically corresponds to the minimum length required for unique mapping of a read to the reference library. Each successfully mapped read with its mapping location is collected and the information is stored as a .bam file. 2. The second module in structure fold is the Get RT Stop Counts module. This module calculates the number of RT stops that map to each nucleotide of each transcript. The inputs are a mapped dataset (in .bam format), typically from the preceding Iterative Mapping module, and the reference library that was used to map the reads, and the output is an RT Stop Counts rts c text file, which contains RT stop counts mapped to each of the four nucleotides (A, C, G, U) in each transcript to obtain the number (count) of RT stops for each nucleotide, the mapping location of each RT stop is first considered. For chemical modification, mapping allows identification of the nucleotide immediately 5 0 to the RT stop on the RNA, which is the nucleotide that was modified and so receives the stop count. When nucleases are used for structure mapping, the nucleotide that will receive the count according to this procedure is the nucleotide on the 5 0 side of the cleavage site on the RNA. The counts of the RT stops of all the nucleotides of each of the RNAs in the experimentally queried transcriptome are combined into a RT termination (stop) count .txt file for each type of library: control and reagent treated. The control library is used to account for background RT stops arising from reverse transcriptase drop off at non exogenously modified or non nuclease cleaved sites, which can result from a number of factors including imperfect processivity of the reverse transcriptase, the presence of endogenous RNA modifications, or degradation of the RNA template 3. The third module of structure fold is the Reactivity Calculation module. This module calculates reactivity based on the rts c file generated from the preceding Get RT Stop Counts module the Reactivity Calculation module begins with a two step normalization of the RT stop counts step 1: The RT stop counts on each nucleotide of each mapped transcript in the plus and minus reagent conditions are incremented by 1 and the natural log (ln) is taken of the resultant value. This provides the numerator in Equations (1) and (2). These raw data are typically skewed, and taking the ln results in a distribution much closer to Gaussian (. Incrementing by 1 avoids an undefined value of the natural logarithm if there are zero RT stop counts step 2: The ln of RT stop counts on each nucleotide of each mapped transcript in the plus and minus reagent conditions are normalized by the transcript's abundance and length. For a transcript, suppose P r (i) and M r (i) are the raw 'r' numbers of RT stops mapped to nucleotide i (all four nucleotides are included) on the transcript in the plus (P) and minus (M) reagent libraries, respectively, and l is the length of the transcript. P r (0) and M r (0) are the raw numbers of 5 0 runoff RT reads purple coded reads in on the transcript in the plus and minus reagent libraries, respectively. The denominators in Equations 1 and 2 thus represent the abundance normalized by transcript length equation 1 provides the normalized RT stop count for nucleotide i in the plus reagent library equation (2) provides the normalized RT stop count for nucleotide i in the minus reagent library final structural re activities f srs are then calculated from the normalized RT stop counts in equations 1 and 2 in three steps. First, values of a term denoted 'raw structural reactivity' (RSR) are defined. Raw structural re activities rs rs are calculated by subtracting the normalized RT stop count on each nucleotide in the minus reagent library from the normalized RT stop count on each corresponding nucleotide in the plus reagent library. If the value is negative, it is set to zero. Second, 28% normalization is applied to the rs rs. In 28% normalization, the top 2% of the data are initially removed and the average value of the remaining top 8% of the data is then calculated (). Then all the data (here, all the rs rs are divided by this average value to obtain the 'normalized structural re activities n srs. The purpose of this normalization is to convert rs rs into a range that can be used as restraints for RNA structure prediction in rna structure and vienna rna package. As with SHAPE data (), this normalization places most re activities between 0 and 1, with the few re activities larger than 1 representing highly reactive nucleotides. Third, the n srs are capped by a user specified threshold. Capping avoids extremely high structural re activities which could introduce bias when investigating meta properties of RNA structural patterns (). The resultant values are the 'final structural re activities f srs for each nucleotide in the transcriptome. The output from this module (.txt file), which is indicative of the tendency of a nucleotide to be single stranded can be used as input for the next module or can be used directly (i.e. without the next module) to carry out meta analyses. For instance, we used f srs to evaluate periodicity in mRNA reactivity and relationships between structure fold RNA structure mapping and reconstruction platform f srs and alternative polyadenylation or alternative splicing (quence data alone, or with inclusion of restraints from structural re activities as provided by the first three modules. Lastly, the user has the option of creating bar plots to illustrate the distribution of the f srs of the nucleotides in any transcript specified by the user (.The RNA Structure Prediction module requires one or more transcript IDs from the reference library as input; these are provided as a .txt file with each ID on one line. structure fold will find the RNA sequence in the reference library corresponding to the ID provided. If the FSR on each nucleotide of the RNA is provided, the module can output bar plots that illustrate the distribution of the f srs (generated from the third module) of the nucleotides in any transcript specified by the user (. When the f srs are provided, the module outputs the predicted structures of the RNA with these restraints (. Otherwise the module outputs the predicted structures without restraints, i.e. an in silico prediction that does not incorporate any experimental data (. Explicit inputs and outputs for all four modules in structure fold can be found in the Supplementary Note.

discussion structure fold is the first computational platform designed specifically for transcriptome wide RNA structure mapping and reconstruction. In addition to enabling transcriptome wide prediction of RNA secondary structures in silico (unrestrained), structure fold can output f srs that can then be used for transcriptome wide prediction of experimentally restrained RNA structures. In the future, we anticipate structure fold outputs being used to assess and compare the restrained predictions resulting from RNA structure profiling data generated by numerous experimental methods, including nuclease, SHAPE, DMS, and other chemical probing agents (). structure fold has several advantages over other software platforms for analysis of RNA structure (). Compared to SAVoR (), structure fold outputs transcriptome wide structural re activities on each nucleotide, allowing investigation of global structural patterns. Compared to Spats () and mod seeker (), structure fold predicts RNA structures in addition to deriving structural re activities. In contrast to mod seeker structure fold takes the abundance of transcripts into consideration and thus can be used for comparative analyses of in vivo as well as in vitro high throughput RNA structure data within and between transcriptome s. Compared to shape mapper structure fold provides a user friendly online platform where high throughput data probing RNA structures can be analyzed directly. structure fold is straightforward to use online or to install for local use on UNIX systems. Through incorporation into the Galaxy platform, structure fold takes advantage of the computational infrastructure and tools, as well as the ongoing curation provided by Galaxy (). For example, outputs from read mapping algorithms in Galaxy such as Bowtie () and BWA () directly provide the input to the Get RT Stop Counts module of structure fold. In the future, structure fold could be extended in several ways i Methods for reads trimming structure fold employs iterative mapping to remove adapter sequences; this method uses the exact biological sequence to identify the presence of adapter sequence but requires more computational time. The cut adapt program () is commonly used to remove adapter sequence but has difficulty to identify the adapter sequence if only a small portion of the adapter is present. Iterative mapping and cut adapt could possibly be integrated ii More options to derive re activities from RT stop count files Currently, three experimental approaches have been applied for in vivo transcriptome wide profiling of RNA structure: structure seq (), mod seq () and dms seq (). Each approach has its advantages and limitations. For example, structure fold takes the transcript abundance into account and avoids skewness of the raw number of RT stops by ln transformation but it is still susceptible to experimental noise to some extent, especially on low abundance RNAs. RNAs with low abundance have fewer RT stops mapped in total, and so are proportionately more affected by stops resulting from drop off of the RT primer. One way to compensate for this is simply to obtain more reads. mod seeker () is more resistant to experimental noise than structure fold because it identifies significantly enriched sites of DMS modification before deriving the final DMS reactivity. mod seeker and structure fold have very similar performance on deriving structural re activities of individual rRNAs as shown in; however, DMS re activities derived by mod seeker on different transcripts are not directly comparable because each nucleotide in a library is normalized by the same value, which does not take into account differences in transcript abundance. dms seq () normalizes RT stops mapped to each position proportionally to the most highly reactive base within a given structured window (50200 nucleotides in length). The method avoids local bias of the RT stops on each RNA, but the length of the window is fairly arbitrary (). Moreover, local region normalization assumes independence of the different regions of the transcript, which is not always a valid assumption (). In the future, structure fold could be expanded to provide options for users to choose among methods of reactivity calculation.
