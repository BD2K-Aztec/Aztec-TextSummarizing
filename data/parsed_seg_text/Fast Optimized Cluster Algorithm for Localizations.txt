Motivation: single molecule localization microscopy s mlm microscopy provides images of cellular structure at a resolution an order of magnitude below what can be achieved by conventional diffraction limited techniques. The concomitantly larger data sets generated by s mlm require increasingly efficient image analysis software. Density based clustering algorithms, with the most ubiquitous being dbs can are commonly used to quantitatively assess sub-cellular assemblies. dbs can however, is slow, scaling with the number of localizations like O(n log (n)) at best, and its performance is highly dependent upon a subjectively selected choice of parameters. Results: We have developed a grid based clustering algorithm FOCAL, which explicitly accounts for several dominant artifacts arising in s mlm image reconstructions. FOCAL is fast and efficient, scaling like O(n), and only has one set parameter. We assess dbs can and FOCAL on experimental d storm data of clusters of eukaryotic RNAP II and PALM data of the bacterial protein H-NS, then provide a detailed comparison via simulation. FOCAL performs comparable and often superior to dbs can while yielding a significantly faster analysis. Additionally, FOCAL provides a novel method for filtering out of focus clusters from complex s mlm images. Availability and implementation: The data and code are available at:

introduction with the advent of super resolved microscopy, images of cellular structure and organization can be acquired with visible light at a spatial resolution well surpassing the diffraction limit. A popular family of techniques, referred to as single molecule localization microscopy s mlm can achieve a lateral resolution down to a few tens of nanometers, with only slightly worse axial resolution. s mlm works by driving a dense population of fluorescent molecules through multiple cycles of photo activation photo switching or blinking and bleaching. Under appropriate conditions, it's possible to temporally isolate the fluorescence of a single molecule during each cycle, from adjacent molecules within a diffraction limited volume. The precise location of each isolated molecule is determined, limited primarily by the number of emitted photons, and the process is repeated tens of thousands of times to generate a reconstructed image from the assembled localizations. Examples of s mlm techniques are stochastic optical reconstruction microscopy (STORM) (), direct STORM d storm (), photo activated localization microscopy (PALM) (), bleaching blinking assisted localization microscopy (BaLM) (), and so on. s mlm is increasingly being employed in cells to image and quantitatively analyze various protein complexes forming tens of nm to hundreds of nm assemblies, from membrane receptors to nucleosome bundles (). However, because of the techniques inherent single molecule sensitivity, s mlm is prone to a host of artifacts that have little effect on conventional diffraction limited modalities. For membrane proteins or other targets close to the cell surface, illumination via Total Internal Reflection Fluorescence (TIRF) can considerably improve the image quality. Unfortunately, it can be much more difficult to employ s mlm to image intranuclear structures, for example, which may reside deep within the cell. For abundant proteins or extended structures that fill large portions of the cellular volume, alternatives to wide-field illumination, such as HILO (or dirty tirf () can provide course optical sectioning. Of course, for even more crowded regions, it may be necessary to resort to complicated light sheet illumination schemes (). Consider the imaging artifacts that arise when using immunofluorescence labeling to target specific molecules within a fixed cell (). Nonspecific interactions of the tagged antibodies with either the growth substrate or cell generate false localizations that add noise to the reconstructed image (). A static fluorescence background can reduce the precision with which individual target fluorophores can be localized. And blurred, out of focus, blinking flour op hores not only increase the local background, but if located close to the focal plane, can be imprecisely localized. There are a number of approaches to characterizing the spatial organization and nanoscale morphology of protein assemblies imaged with s mlm. On the one hand, there are ensemble methods that provide spatial statistics, such as pair correlation analysis () or Ripley's l function (). On the other are methods that directly group localizations into discrete clusters. For s mlm density based spatial clustering of applications with noise dbs can is the most commonly employed method of this type (). Significant analysis can follow cluster identification, such as determining the cluster size radius or the number of proteins within each cluster (). The ability of dbs can to identify and reject 'noise' is advantageous, which to a large extent accounts for its popularity. However, in addition to the complications of background noise, artifacts appear in s mlm images because the localization density is a function of both the number of tagged proteins in an assembly and the photophysics of the fluorescent labels. Since most fluorophores blink multiple times, and there is some error involved in the localization of each blink, a single fluorescent label will result in a cluster of localizations. Likewise, because the duration of each blink is stochastic, blinks that last for multiple frames will also generate a cluster. Therefore, a single density threshold, as in dbs can may not be sufficient to differentiate between clusters of localizations due to protein assemblies and artifactual pseudo clusters arising, for instance, from a fluorescently labeled, solitary protein. This is a concern for all s mlm methods, since even with fluorophores referred to as irreversibly photo activatable photo blinking is commonly observed (). Unfortunately, some clusters may also appear as 'noise' due to limitations in the image reconstruction. For instance, because of the inherently low photo activation efficiency of the fluorophores, multiple clustered proteins will occasionally produce only a single blink during the acquisition period. Moreover, in the presence of significant noise and off target localizations (i.e. localizations not arising from in focus (target) clusters), the performance of dbs can critically depends on a pair of set parameters that specify a density threshold () (i.e. the number of points, min pts within a search radius e). A significant drawback to dbs can is that the appropriate choice for these parameters is often ambiguous. In practice, clustering results for various sets of dbs can parameters are typically generated and the optimum choice is iteratively chosen from an inspection of the results. Beyond the obvious subjectivity of a visual inspection, this procedure may not be practical for localization microscopy when dealing with large data sets of hundreds of thousand to millions of localizations. To identify neighboring points, dbs can calculates all pairwise distances within an image, so the runtime scales with the number of points n as O(n 2 ). For a large s mlm data set, this analysis can take several hours. Region queries such as grid based spatial indexing and tree data structures have been implemented to restrict the search for neighboring localizations to obtain an average time complexity of O(n log n (). Despite this improvement, in order to find the algorithm's optimum parameters, dbs can should be executed multiple times. In fact, the parameters might vary from image to image due to unavoidable variations in sample preparation such as labeling specificity and heterogeneity of cells. An optimal clustering analysis with dbs can therefore, can be extremely time consuming. Here we present a rapid clustering algorithm customized for s mlm Fast Optimized Cluster Algorithm for Localizations (FOCAL). FOCAL is similar in many respects to a gridded version of dbs can and like grid based versions of dbs can at worst scales like O(n) (). But while dbs can is an extremely general clustering algorithm, FOCAL incorporates knowledge of artifacts within s mlm images to optimize the analysis. Moreover, we present a well defined method for quickly selecting focal s optimum parameters, which minimizes clustering errors from s mlm image artifacts. In both simulations and experiments on immunofluorescent ly labeled clusters of rnap ii via d storm and fluorescent protein tagged clusters of the histone like nucleosomal protein (H-NS) by PALM, we compared the performance of FOCAL and dbs can in detecting spatial clusters and in dealing with and filtering out image noise and off target localizations. Our results suggest that FOCAL performs comparable and often superior to dbs can while providing a significantly faster analysis of complex s mlm images. In addition, FOCAL provides a novel method for filtering out of focus clusters from complex s mlm images.

conclusion various clustering methods are used to characterize the organization of nanoscale assemblies in localization microscopy images. Unlike statistical approaches, such as Ripley's l function and pair correlation analysis that estimate ensemble parameters (), dbs can and other derivative density based clustering algorithms are able to identify and quantify individual clusters. However, dbs can is slow, scaling with the number of particles like O(n log (n)) at best; is acutely sensitive to the algorithm's parameters, which are typically selected by visual inspection of the output; and is prone to detecting a large number of false clusters in the presence of a significant background of localizations. To address these problems we developed FOCAL, a rapid O(n), density based clustering method that is tailored for localization microscopy. FOCAL is a rapid and efficient tool for density based clustering in super resolution microscopy data. In contrast to dbs can FOCAL sets a threshold for a minimum cluster size, based upon the image localization uncertainty, to remove pseudo clusters arising from multiple localizations of single fluorophores. Moreover, FOCAL can be rapidly optimized to minimize false clustering and remove diffuse, out of focus clusters while maintaining cluster integrity. Alternatively, FOCAL could serve as a method for quickly determining the optimum density threshold for a dbs can based clustering analysis. As s mlm becomes more commonplace, increasingly efficient algorithms will need to be developed to deal with the large amounts of data generated when imaging at such fine resolution. FOCAL can rapidly analyze large s mlm data sets, performing at least on par with, if not better than, dbs can in most situations. Its efficiency in analyzing large image data sets should make FOCAL a suitable replacement to the much slower dbs can derived algorithms, and a solid foundation for further clustering analysis.
