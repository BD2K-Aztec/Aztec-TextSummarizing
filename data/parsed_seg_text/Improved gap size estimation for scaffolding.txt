Motivation: One of the important steps of genome assembly is scaffolding , in which contigs are linked using information from read pairs. Scaffolding provides estimates about the order, relative orientation and distance between contigs. We have found that contig distance estimates are generally strongly biased and based on false assumptions. Since erroneous distance estimates can mislead in subsequent analysis, it is important to provide unbiased estimation of contig distance. Results: In this article, we show that state of the art programs for scaffolding are using an incorrect model of gap size estimation. We discuss why current maximum likelihood estimators are biased and describe what different cases of bias we are facing. Furthermore, we provide a model for the distribution of reads that span a gap and derive the maximum likelihood equation for the gap length. We motivate why this estimate is sound and show empirically that it outper-forms gap estimators in popular scaffolding programs. Our results have consequences both for scaffolding software, structural variation detection and for library insert size estimation as is commonly performed by read aligners. Availability: A reference implementation is provided at https://github. com sci life lab gap est Supplementary information: Supplementary data are availible at

introduction the decreasing cost of sequencing has made whole genome sequencing commonplace (). When sequencing a genome, one obtains a large set of short fragments of DNA (usually referred to as reads). Assembling these reads (and optimally reconstruct the genome or chromosomes that were sequenced into one piece) remains a complex task (). Due to the presence of repeats, allelic differences and sequencing errors, the result of an assembly is rarely a complete reconstruction of the genome. Instead, the result is often subsets of reads assembled into longer fragments of genomic sequences referred to as contigs. Since the goal is to recreate the genome, ordering and placing these contigs as they appear on the genome (given that the contigs are correctly assembled) is an important assembly step after contig construction in a process called scaffolding (). In scaffolding, the problem is to link together contigs in their correct order and orientation using paired reads. These paired reads have some known distance (up to a distribution) between them on the genome. If the two separate reads from a pair map to two different contigs, a relation between the two contigs can be inferred. Contigs that can be linked together represent a longer fragment of the genome where sub-parts of the fragment remain unknown (i.e. the gaps between contigs) and such a fragment consisting of more than one contig is called a scaffold. Modern scaffold er programs involve two steps (either separate or intermixed finding optimal order and orientation of the contigs with respect to some objective function. Checking for paired read inconsistencies. This involves removing reads that have been mapped with too small/ large an insert size (with respect to some generously set thresholds) and reads that have been mapped in the wrong relative orientation (often removed in the optimization step). After this is done, the distance between contigs is often estimated separately using a maximum likelihood (ML) estimation from the reads that are linking the contigs (). The issue of gap length estimation should not be undervalued: high quality scaffolding provides an understanding of what is necessary for finishing a genome (), with the contig distances effectively quantifying the unassembled parts of the genome. Bad estimates of contig distances, in particular under-estimates, can mislead finishing. Bad distance estimates can also interfere in genome annotation, e.g. with an underestimated gap suggesting that there is not room for an expected feature, or e.g., suggesting that a potential intron is too large in the case of over-estimation. Furthermore, with contig distances being an essential indicator in the scaffolding process, a systematic bias can impair correct scaffolding. From currently implemented techniques of gap size estimation, we noticed surprisingly poor estimates even in ideal cases without mapping errors or duplicated reads. Both over and underestimation of hundreds of base pairs could occur. This prompted our group to model gap size. Our aim is to provide * To whom correspondence should be addressed. an accurate gap size estimation to be applied after ordering and orientation of contigs and filtering of paired read inconsistencies. It is commonly assumed that the distribution of insert sizes for reads that span over a certain gap (or even over a single position in the genome) is the same as the distribution of the paired end library (often approximated as a normal distribution). This is an erroneous assumption. There is an observation bias from the assumption that reads that span the gap are coming from the whole insert size distribution of the library gives examples of two types of biases that can occur and which reads would actually be observed in these cases. A 'negative bias' occurs when the gap size is underestimated due to only observing reads from the upper part of the distribution. Similarly, a 'positive bias' occurs when overestimating the gap by only observing reads from the lower parts of the library insert size distribution. Another example of positive bias is when aligning reads to a short contig, a case occurring frequently when working with fragmented assemblies. Then, only pairs with shorter insert size will have both reads mapped. This is highly relevant for read aligners such as Bowtie () and Burrows Wheeler Aligner (BWA) (Li, H. and Durbin) that are routinely estimating the insert sizes for paired read libraries. Since they are designed mainly for high quality reference genomes, they are implicitly using an 'infinite contig length' assumption, and hence underestimate the insert size on fragmented assemblies. A heuristic way to deal with this bias is by choosing only large contigs (compared to the insert size of the library) and consider only paired reads that place sufficiently far from contig ends (). In Sections 2.12.3, we explain a model for estimating gap lengths. Section 2.4 derives an estimate from the model in a special case and gives some intuition behind the estimate. In Section 2.5, the model is used to derive a closed form ML expression and we discuss this expression and its practical implications. Section 3 shows results of gap estimations from our formula compared to estimations from popular scaffolding programs. The results are discussed in Section 4.

discussion the scaffold ers we tested perform poorly and suffer from severe bias even in ideal conditions. OPERA and SOPRA show very similar gap estimations. Although OPERA estimates several gap sizes simultaneously, this has no advantage in our tests since paired reads do not span over more than one gap. Under these circumstances, OPERA's gap estimator works with one gap at a time, and effectively becomes the one used by SOPRA. Using simulated datasets, gap est outperforms the scaffold ers tested when estimating gap lengths (Figs 4 and 5). Given the assumptions (in agreement with scaffolding literature) of reads being sequenced uniformly throughout the genome and that the library insert size is somewhat normal, gap est appears to be unbiased in all cases. gap est also produces accurate results with the biological data, as shown in Sections 3.3 and 3.4. This type of gap estimation could open up new ways to tackle the scaffolding problem. For example, using the gap information in the ordering step of the scaffolding algorithm could improve relative placings of the contigs. As indicated in Section 1, our model for gap size estimation can be used in more general contexts. For example, read aligners commonly estimate insert size by observing reads pairs that map to the same contig. This is a slightly different problem. On one hand, paired reads with large insert size are more likely to span any position on the genome (as seen in Section 2.4), giving rise to negative bias. On the other hand, one will observe less paired reads with large insert size on a given contig, since long reads are more likely to have one of the reads placed outside the contig. This gives rise to positive bias and the problem is exacerbated if contigs are short relative to insert size distribution. Another problem that requires sensitive estimates of insert size distributions on a given contig is structural variation detection with paired read information. Here we are facing the same observation bias as in the read alignment problem. Our model provides the framework for deriving the exact distribution in each individual case and using this, the sensitivity in detection of structural variants can be improved.

conclusion we have, in this article, discussed the mathematical theory behind gap estimation. This theory has resulted in a model that explains the most likely length of the gap between two contigs given the observed read pairs that span the gap. Moreover, we have implemented the formula of the ML equation and compared the estimates to state of the art scaffolding software. Empirical results suggest that our model gives a significant improvement in estimating gap length. We encourage developers of existing scaffold er programs to use this formula for gap size estimation where possible py j jc 1 j; jc 2 j f y  ddy ; 3 noting that the integration bounds in the normalizing constant follow from the definition of po jd jc 1 j; jc 2 j (it is zero outside this interval). From this, the log likelihood can be written as we want to differentiate this expression with respect to d to obtain the maximum likelihood equation for d. By linearity of the differential operator, differentiation of (4) can be performed separately for each term. The first term is constant in d and cancels out. The second term becomes now if we let gd  R jc1jjc2j1 2r1 py j jc 1 j; jc 2 j fy  ddy, we can write the third term as we therefore have letting this equation be equal to zero to find the ML estimate, we get (after some algebraic manipulations here I(y) is the stepwise function obtained from differentiating py jd and it is defined by where c min  min fjc 1 j; jc 2 jg and c max  max fjc 1 j; jc 2 jg. Furthermore, evaluating the integral in (5) gives 1 jgj which can be written as finally we note that jGj will cancel when dividing g0d with g(d). This is the result we wanted to prove.
