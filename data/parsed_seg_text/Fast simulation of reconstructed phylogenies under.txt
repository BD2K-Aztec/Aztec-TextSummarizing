Motivation: Diversification rates and patterns may be inferred from reconstructed phylogenies. Both the time dependent and the diversity dependent birth death process can produce the same observed patterns of diversity over time. To develop and test new models describing the macro evolutionary process of diversification, generic and fast algorithms to simulate under these models are necessary. Simulations are not only important for testing and developing models but play an influential role in the assessment of model fit. Results: In the present article, I consider as the model a global time dependent birth death process where each species has the same rates but rates may vary over time. For this model, I derive the likelihood of the speciation times from a reconstructed phylogenetic tree and show that each speciation event is independent and identically distributed. This fact can be used to simulate efficiently reconstructed phylogenetic trees when conditioning on the number of species, the time of the process or both. I show the usability of the simulation by approximating the posterior predictive distribution of a birth death process with decreasing diversification rates applied on a published bird phylogeny (family cett iida e. Availability: The methods described in this manuscript are implemented in the R package TESS, available from the repository CRAN

introduction the birth death process is arguably the most commonly used process to model species diversity ().introduced the birth death process to estimate diversification rates from reconstructed phylogenetic trees. It was then used to estimate speciation and extinction rates that are constant over time and equal for all species (). In recent years, the constant equal rate birth death process has been extended to time dependent speciation and extinction rates (); trait dependent speciation and extinction rates (); and diversity dependent speciation rates (). The models used for parameter inference have become increasingly complex and different models such as the time dependent speciation and the diversity dependent speciation models can produce almost in distinguish ably close fits to observed phylogenetic trees. Thus, studies investigating the different patterns generated by the different models need to be compared. An evident approach is to use simulations under one model and inference under any of the available models. Furthermore, simulations play an important role in investigations of which parameters can be estimated (). However, simulating trees has gained less attention and remains a challenge in several situations (). One might be interested in simulating trees under three different conditions when the process starts with a single species at time t 0  0: Simulating a tree for a given time t. Simulating a tree for a given number of species n simulating a tree for a given number of species n that have evolved over time t. Additionally, the conditions can be modified if the process starts with the most recent common ancestor (MRCA), and thus, there are two species at time t 0  0 (). I consider the time dependent speciation and extinction rates birth death process as the model of choice for simulations in this article. This process contains the constant rate birth death process as a special case. Simulations under the first condition, a given time t of the process, are straightforward from a theoretical point of view. One only needs to simulate the exponentially distributed waiting times until the next event, either a speciation event or an extinction event, and pick a random species. Nevertheless, implementing this forward simulation might be challenging and inefficient in situation when the rates are not constant and both rates are high. Additionally, there is no available software for simulating reconstructed trees for a given time t when the rates vary continuously. An overview of available software packages for simulating trees under a time dependent birth death process is given in Stadler (2011). Simulating phylogenies under models with a non-zero extinction rate is challenging when one is interested in simulating a tree with a fixed number n of extant species (). The general sampling approach (GSA) introduced by in the program trees im is the currently only available approach to simulate trees under the first and second condition. However, trees im only implements changes of speciation and extinction rates at specific predefined times. Furthermore, when one chooses a model with high species turnover (the extinction rate being close to the speciation rate), then the GSA takes a long time to terminate because many speciation and extinction events are simulated and the process converges only slowly to the terminating species number. In this article, I will derive the joint probability density of the reconstructed phylogeny using a new approach that shows that each speciation time in the reconstructed tree is independent and identically distributed (iid). I will then develop an algorithm that uses the cumulative distribution function for fast simulation of the reconstructed tree under any continuous or discrete time dependent speciation and extinction rate function. I apply this new simulation technique to sample from the posterior predictive distribution of an empirical dataset, the bird family cet tid ae
discussion in the present article, I only considered simulations of reconstructed phylogenies. Most estimated phylogenies are reconstructed phylogenies because no information about extinct species is available, such as ancient molecular sequences, and only the extant species are included. Nevertheless, phylogenetic trees including some extinct species might provide more information in estimating the time dependent diversification rates. In these cases, either the GSA or simulating the missing speciation and extinction events following the idea of Bokma (2008) are useful. Another drawback of the GSA is that events eg. mass extinction events can not be specified to happen at a given time before the present when one conditions on the number of species being sampled. In this manuscript, I did not consider these circumstances, although the simulation procedure can be modified to accommodate events at specific times before the present without major difficulties. In this case, the distribution of the time of the origin (or the MRCA) needs to be considered backward in time instead of forward. Finally, once the time of the process is obtained, the simulation of the single speciation events remains unchanged. The simulation algorithm presented here in this article relies on the factorization of the probability density function. Previously, only for the constant rate birth death process has such a factorization been known (). I derived the factorization for the time dependent birth death process. Unfortunately, other types of birth death process, e.g. the diversity dependent birth death process () or the protracted speciation process (), do not have a know factorization. Nevertheless, the time dependent birth death process might be used to approximate other birth death processes, such as the diversity dependent birth death process (). It is possible to simulate tree using an MCMC algorithm, once the likelihood equations are known. However, if no direct simulation technique from the desired distribution is known, then the MCMC algorithm must start from some arbitrary starting values. Furthermore, samples are random draws from the specified distribution only after the chain has reached its stationary distribution. When the chain has reached its stationarity distribution and how long it takes to do so is a challenge in itself (). Thus, direct sampling, as I propose here, is safer, faster and can even be used for starting values of MCMC runs. Several of the more complicated birth death processes, e.g. containing different rates for different species () or heritable extinction rates (), do not have a known likelihood function. Instead, approximate Bayesian computation (ABC) can be applied to estimate the parameters of interest () although ABC has been criticized and should be used cautiously (). The birth death simulations implemented in TESS rely on the likelihood function, and therefore, neither ABC is necessary nor are these simulations needed for parameter estimation. Nonetheless, the simulation techniques can be used to test the summary statistics used in ABC. Currently, only the number of species at the present time, the time of the origin and the statistic have been used as summary statistics for ABC under a birth death model (). Using TESS, it might be possible to test the performance of these summary statistics and develop new ones.
