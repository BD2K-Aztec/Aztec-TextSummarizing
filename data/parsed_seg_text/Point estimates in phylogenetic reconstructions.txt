Motivation: The construction of statistics for summarizing posterior samples returned by a Bayesian phylogenetic study has so far been hindered by the poor geometric insights available into the space of phylogenetic trees, and ad hoc methods such as the derivation of a consensus tree make up for the ill definition of the usual concepts of posterior mean, while bootstrap methods mitigate the absence of a sound concept of variance. Yielding satisfactory results with sufficiently concentrated posterior distributions, such methods fall short of providing a faithful summary of posterior distributions if the data do not offer compelling evidence for a single topology. Results: Building upon previous work of bill era et al., summary statistics such as sample mean, median and variance are defined as the geometric median, Fr e chet mean and variance, respectively. Their computation is enabled by recently published works, and embeds an algorithm for computing shortest paths in the space of trees. Studying the phylogeny of a set of plants, where several tree topolo-gies occur in the posterior sample, the posterior mean balances correctly the contributions from the different topologies, where a consensus tree would be biased. Comparisons of the posterior mean, median and consensus trees with the ground truth using simulated data also reveals the benefits of a sound averaging method when reconstructing phylogenetic trees. Availability and implementation: We provide two independent implementations of the algorithm for computing Fr e chet means, geometric medians and variances in the space of phylogenetic trees.

introduction phylogenetic trees are central to the study of evolution, so much that the sketch of a tree of species by Sir Charles Darwin has become the icon of this theory. Nowadays, trees relating units of selection (be it functional domains, genes or species) are structures of primary interest for system at ists but also instrumental to a wealth of other studies where evolutionary correlations need to be accounted for. Various statistical models pertaining to diverse types of observables can be found in the literature, as well as methods, for estimating their parameters and reconstructing a phylogenetic tree (). Some estimation methods proceed by maximizing a posterior distribution or a likelihood function, and are amenable to an exact reconstruction of the optimal tree, but Bayesian phylogenetic analyses generally produce posterior distributions that are best explored by generating posterior samples. While a large enough posterior sample offers a faithful representation of the posterior knowledge, it is of little scientific interest unless summarized by some statistics (). A summary can balance contributions from the different tree topologies occurring in the sample, resulting in a legit phylogenetic tree, or combine them within a phylogenetic network. Here we focus on the former, showing how to build a phylogenetic tree that faithfully represents the sample in its entirety, despite competing topologies occur. Provided a unique topology with n edges occurs in the sample, each tree including its edge lengths can be identified by a point in the positive orthant of the Euclidean space R n. Performing an average of the sample in this linear representation is a straightforward operation, which produces a legit posterior mean tree. If more than one tree topology occurs, the trees are no longer mapped all to the same linear space, and the posterior mean is ill defined. Selecting the a posteriori most probable tree topology may seem a sound alternative, however, with the unpleasant consequence of neglecting all the sampled trees of different topology, and therefore would not provide a satisfactory representation of the posterior. The construction of a consensus tree, using an absolute majority rule () to decide which one among competing edges should be retained, has been widely adopted by the interested community as the method of choice to summarize posterior samples of phylogenetic trees. On the theoretical side, decision theoretic justifications of this construction have been proposed (). However, they are built upon loss functions that neglect edge lengths, focusing only on the tree topology. Besides, from the authors' point of view, it is also a rather conservative approach, as the absence of an absolute majority among edges results in the inclusion of none of them, thereby producing unresolved branching points. The extended majority rule consensus method (also known as greedy consensus method) has been introduced to remedy this drawback by adding edges with 550% support (). Despite this improvement, the consensus methods neglect much of the available information in a sample by ignoring the context in which an edge occurs (i.e. the remaining topology of the tree as well as all other edge lengths). Reporting a posterior mean that balances the contributions from each topology including edge lengths rather than isolated edges would therefore be of utmost interest. Building upon the work published by, who deciphered the geometric structure of the space of phy genetic trees and first proposed a construction of the tree space (sometimes also called BHV tree space, where BHV is an acronym of bill era Holmes and vogt mann the purpose of this article is to show how the computation of the posterior mean of a sample of phylogenetic trees can be achieved by simply reaching out for the appropriate geometry. The BHV space is obtained by gluing together the positive or than ts of the linear space associated to *To whom correspondence should be addressed  The Author 2014. Published by Oxford University Press. This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (http://creativecommons.org/licenses/by-nc/3.0/), which permits non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited. For commercial re-use, please contact journals permission soup com each topology, so that a point in this space identifies both a tree topology and the lengths of the corresponding edges. The adjacency structure between any two or than ts reflects the edges shared by the two corresponding topologies and permits the definition of paths visiting several or than ts. Any two trees are connected by at least one path, and the one with minimal length is called a geodesic. Therefore, the length of a geodesic qualifies as a distance function between phylogenetic trees, and offers a theoretically and practically appealing alternative to existing distances (e.g. NNI or the robinson foulds distance). Furthermore, using implicit characterizations of the posterior mean and median as minimizers of appropriate loss functions, algorithms developed by Bacak Bacak (2013, 2014);; Sturm (2003) compute an approximation of these statistics by walking along geodesics. Here, the determination of the geodesics is done in polynomial time, thanks to an algorithm owing to Owen and Provan (2011). This article gathers and combines technical results scattered across multiple mathematics papers, into a general statistical framework for analyzing posterior distributions over phylogenetic trees easily accessible to the target readership, namely practitioners in Bayesian phylogenetics. Certainly, many other applications exist where computing an average phylogenetic tree is of great importance. The methods presented here are not restricted to Bayesian statistics, yet in this context, they allow to recover basic statistical concepts such as the posterior mean and median, as well as a notion of variance to measure the posterior uncertainty. After a gentle introduction to the geometry of the tree space in Section 2.1, the geometric median and Fr e chet mean over this space are constructed in Section 2.2. The algorithms computing those quantities are outlined in Section 2.3, while Section 3 shows the method in action, and illustrates how it compares with the majority rule consensus method.

discussion by recognizing the global geometric nature of the space of phylogenetic trees, this article shows that the fundamental statistical notions defined over linear spaces, such as sample mean, median and variance, can be generalized to more complex spaces such as the tree space. Besides the sheer recovery of well defined fundamental statistical quantities in the particular setting of phylogenetic studies, this study also demonstrates critical differences in the behavior of the posterior mean and the consensus tree. The reconstruction of a consensus tree retains splits that occur in at least half of the samples. This absolute majority rule prevents the introduction of splits favored by sheer fluctuations, but also aims to maximize the information extracted from the sample. The length of the retained edges is indeed often simply set to the average length of their occurrences in the sample, so that the lengths of the discarded edges never enter the determination of the consensus tree. As illustrated on a real dataset by, the neglect ion of a fraction of the sample results in biased estimates, where edge lengths are systematically overestimated from the perspective of the geometry of the tree space. The extent of the bias born by the consensus tree is however tightly related to the concentration of the posterior distribution, which decreases the amount of information dropped in the reconstruction process, and the simulation based study shown above confirms that the consensus tree and the posterior average disagree mostly when there exists no compelling evidence for a single topology. Illustrated on small datasets, the consensus tree appears dramatically further of the generating tree than the posterior mean, as a result of its neglect ion of a fraction of the information brought by the sample. The proper definition of a variance for a sample of phylogenetic trees has consequences that should not be overlooked, and is believed by the authors to bear even more potential for applications. Not only is the reporting of the credibility of the Bayesian estimate made simple by this quantity, but it also opens the way to the generalization of variance based studies of samples of phylogenetic trees, including principal components analysis, a task already tackled by Nye (2011). Measuring the spread of a set of trees is a useful tool not only to quantify the posterior uncertainty. For instance, in a recent study developed an information theoretic measure to quantify the incongruence of gene trees note Both statistics were evaluated separately on datasets of length m = 50, 100, 250 and 500.
