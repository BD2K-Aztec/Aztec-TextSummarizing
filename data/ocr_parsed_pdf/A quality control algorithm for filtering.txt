ORIGINAL PAPER

Vol. 26 no. 14 2010, pages 1731-1737
doi: 1 0. 1 093/bioinformatics/btq2 72

 

Genetics and population analysis

Advance Access publication May 25, 2010

A quality control algorithm for filtering SNPs in genome-wide

association studies

Monnat Pongpanichl, Patrick F. Sullivan2 and Jung—Ying Tzenglasai‘

1Bioinformatics Research Center, North Carolina State University, Campus Box 7566, Raleigh, NC 27695—7566,
2Department of Genetics, University of North Carolina at Chapel Hill, Campus Box 7264, Chapel Hill, NC 27599 and
3Department of Statistics, North Carolina State University, Campus Box 7566, Raleigh,

NC 27695—7566, USA
Associate Editor: Martin Bishop

 

ABSTRACT

Motivation: The quality control (QC) filtering of single nucleotide
polymorphisms (SNPs) is an important step in genome-wide
association studies to minimize potential false findings. SNP QC
commonly uses expert-guided filters based on QC variables [eg
Hardy—Weinberg equilibrium, missing proportion (MSP) and minor
allele frequency (MAF)] to remove SNPs with insufficient genotyping
quality. The rationale of the expert filters is sensible and concrete, but
its implementation requires arbitrary thresholds and does not jointly
consider all QC features.

Results: We propose an algorithm that is based on principal
component analysis and clustering analysis to identify low-quality
SNPs. The method minimizes the use of arbitrary cutoff values,
allows a collective consideration of the QC features and provides
conditional thresholds contingent on other QC variables (e.g. different
MSP thresholds for different MAFs). We apply our method to the
seven studies from the Wellcome Trust Case Control Consortium and
the major depressive disorder study from the Genetic Association
Information Network. We measured the performance of our method
compared to the expert filters based on the following criteria:
(i) percentage of SNPs excluded due to low quality; (ii) inflation factor
of the test statistics (A); (iii) number of false associations found in
the filtered dataset; and (iv) number of true associations missed in
the filtered dataset. The results suggest that with the same or fewer
SNPs excluded, the proposed algorithm tends to give a similar or
lower value of A, a reduced number of false associations, and retains
all true associations.

Availability: The algorithm is available at http://www4.stat.ncsu
.edu/~jytzeng/software.php

Contact: jytzeng@stat.ncsu.edu

Supplementary information: Supplementary data are available at
Bioinformatics online.

Received on February 27, 2010; revised on April 26, 2010; accepted
on May 20,2010

1 INTRODUCTION

Genome-wide association studies (GWAS) have been shown to be
a powerful and successful strategy in identifying genetic variants

 

*To whom correspondence should be addressed.

that inﬂuence common and complex diseases. Prior to the advent of
GWAS in 2005, there were only a few robust, replicated associations
identiﬁed, such as NODZ for Crohn’s disease (CD; Hugot et al.,
2001), and PPARG, KCNJll and CAPN10 for Type 2 diabetes
(T2D) mellitus (McCarthy, 2004). With GWAS, there are now
more than 30 loci identiﬁed for CD and almost 20 loci for T2D
(Barrett et al., 2008; Zeggini et al., 2008). To date (April 2010),
there are over 545 published studies reporting genetic variants
responsible for more than 340 common diseases (Hindorff et al.,
2009; http://www.genome.gov/gwastudies).

GWAS interrogate millions of single nucleotide polymorphisms
(SNPs), and the large-scale genotype calling (which translates probe
hybridization intensities into actual genotypes) must fully resort
to automated Clustering procedures (Plagnol et al., 2007; Teo,
2008). Ideally, SNP genotyping yields three Clusters of signals,
and a subject’s genotype can be assigned according to Cluster
membership (Ziegler et (11., 2008). In reality, the Clustering methods
are unavoidably prone to error, as imperfect Clusters of signal Clouds
can arise due to experimental variation, DNA quality and non-
speciﬁc hybridization issues (Anney et al., 2008; Clayton et al.,
2005). Common error patterns include missing calls for SNPs with
overlapping genotype Clusters (Anney et al., 2008), homozygote—
heterozygote miscalls (Teo et (11., 2007), false homozygote calls
in heterozygous individuals due to allelic dropout (Pompanon
et al., 2005), and erroneous assessment of monomorphic SNPs as
polymorphic (Pettersson et al., 2008).

SNP quality control (QC) is commonly safeguarded by
‘supervised’ (i.e. expert-guided) ﬁlters to exclude low-quality SNPs.
The ‘supervised’ expert ﬁlters aim to remove SNPs that fall into the
extremes of QC variables including Hardy—Weinberg equilibrium
(HWE), missing proportion (MSP) and minor allele frequency
(MAF). The rationale is Clear: extreme deviation from HWE is
typically used to identify gross genotyping error (Teo et al., 2007);
a high MSP indicates poor genotype probe performance and low
genotyping accuracy (Neale and Purcell, 2008; WTCCC, 2007);
SNPs with low MAF are more prone to error, as fewer samples
would be within a genotype Cluster and most Clustering-based
calling algorithms do not perform well with rare alleles (Neale and
Purcell, 2008; Teo, 2008). However, the implementation of expert
ﬁlters tends to require arbitrary determination of cutoff values for
the QC variables, and does not jointly consider all QC features.
For example, in GAIN studies, the minimum SNP genotyping
quality standards are HWE P-value >0.00033, average MSP < 3%,

 

© The Author 2010. Published by Oxford University Press. All rights reserved. For Permissions, please email: journals.permissions@oxfordjournals.org 1731

112 ﬁlo's[Bruno[pJOJXO'sorwurJOJurorqﬂ:duq moi; popeolumoq

9103 ‘{g anﬁnv 110::

M.Pongpanich et al.

 

MSP maximum <10% and quality score and MAF greater than a
pre-determined minimum level, which varies from study to study
(GAIN Collaborative Research Group, 2007). For GWAS conducted
by the Wellcome Trust Case Control Consortium (WTCCC), the
criteria for retaining a SNP are: HWE P-value 3 5.7 X 10‘7,
MSPg 5% ifMAF 3 5%, MSP g 1% ifMAF<5% and MAF > 0.01
(WTCCC, 2007). Sladek et al. (2007) included SNPs when the HWE
P-value >0.001, MSP f 5% and MAF > 0.01. Unoki et al. (2008)
included SNPs when the HWE P-value 3 10_6 and MSP f 10%.

Statistical methods have also been developed to identify, assess
or incorporate genotyping errors in association studies (Gordon
et al., 2001; Gordon and Ott, 2001; Hao and Wang, 2004; Rice and
Holmans, 2003). Recently, Plagnol et al. (2007) introduced a calling
algorithm to minimize the biases that occur when case and control
DNA samples are from different sources and processed in different
laboratories. Miyagawa et al. (2008) investigated appropriate cutoff
values for each of the QC variables (MSP, MAF, HWE and
conﬁdence score of genotype calls) by dividing and reshufﬂing
healthy samples. Teo et al. (2008) assessed the stability of the
assigned genotypes by introducing white noise to the ﬂuorescent
intensities of each subject and evaluating the agreement between
the calls made with the noise-perturbed and original intensities.
Finally, for family-based studies, Fardo et al. (2009) developed
a transmission test to measure the genotyping error rate of each
proband.

In this work, we take the rationale of the expert ﬁlters and
propose an ‘unsupervised’ (i.e. algorithm-determined) ﬁlter to detect
low-quality SNPs. Like ‘supervised’ expert ﬁlters, our ﬁlter also
aims to identify QC outliers. Furthermore, our ﬁlter automates the
QC threshold determination based on all QC features, and gives
conditional cutoffs contingent on the values of other QC variables
(e.g. different MSP thresholds for different MAFs). The algorithm
is based on the premise that the majority of SNPs have sufﬁcient
genotyping quality with QC variable values in certain directions
(e.g. low MSP and non-low MAF). SNPs with QC values deviating
from the majority are considered outliers and are then labeled as
problematic SNPs. The algorithm ﬁrst performs principal component
analysis (PCA) on the QC variables with an aim to separate good
SNPs from problematic SNPs on a two-dimensional plane. It then
uses Density Based Spatial Clustering of Applications with Noise
(DBSCAN; Ester et al., 1996) to identify the boundaries of good
SNPs and deﬁne QC thresholds. We evaluate the performance of
the proposed algorithm and demonstrate its utility using the seven
WTCCC datasets (WTCCC, 2007) and the major depressive disorder
(MDD) dataset from Genetic Association Information Network
(GAIN) studies (Sullivan et al., 2009).

2 METHODS
2.1 The proposed QC algorithm

We begin with a SNP dataset that has been cleaned using the criteria of quality
score and HWE. That is, if an SNP does not reach the desired level of quality
score, the genotyping result is speciﬁed as ‘missing’. In addition, SNPs that
show severe HWE Violations in the control group (i.e. the P-Value of the
HWE test is smaller than a threshold appropriate for multiple testing) are
excluded from the dataset. Quality score and HWE are used to pre-clean the
dataset because they have clear deﬁnitions for good SNPs. While deviation
from HWE has relatively low sensitivity in testing for genotyping error (Cox

and Kraft, 2006), it has been shown that severe genotyping errors often do
cause extreme HWE deviations (Teo at al., 2007).

With this pro-cleaned dataset, our algorithm aims to identify good-quality
SNPs based on two basic QC features, MSP and MAF. Speciﬁcally, we
consider six QC variables including MSP in case samples (denoted by
MSPcs), MSP in control samples (MSPcn), MSP in the combined case-
control samples (MSPall), logMAF in the combined samples (logMAFall),
the ratio of MSPcs to MAch and the ratio of MSPcn to MAFcn. MAF is
considered on the log scale to ensure a more careful QC examination with
a low MAF than a high MAF. The interaction term between MSP and MAF
is designed to allow for an adaptive MSP threshold with different MAF
values, and is deﬁned as MSP >< (1/MAF). The adaptive thresholds ensure
that SNPs with smaller MAF have a more stringent MSP threshold, as missing
genotypes have a larger impact on frequency when occurring in low MAF
than in high MAF. We use the ratio rather than the product of MSP and MAF,
so that different low-quality features (e.g. high MSP and low MAF) will be
retained rather than being cancelled out in the interaction terms. A higher
interaction value indicates lower quality.

There are two main steps involved in the proposed QC algorithm: (i) using
PCA to separate the good SNPs from the bad SNPs based on the QC
features on a two-dimensional plane; and (ii) using DBSCAN (Ester at al.,
1996) to identify the boundaries of good SNPs on the plane. The PCA
is performed on the six QC variables to separate good SNPs from bad
ones on the plane of the ﬁrst two principal components (PCl versus PC2),
which usually account for about >80% of the variation in the original QC
variables. The use of PCA facilitates the task of modeling all of these QC
variables that can be highly correlated. It also projects good SNPs into a
concentrated corner on the plane and spreads out bad SNPs in opposite
directions along the axes of the original QC variables (e.g. see the biplots
shown in Figs 1a and 2a, and the expert SNP classiﬁcation in Figs 1b
and 2b). Different studies may result in different patterns of PC biplots,
but the key common feature is that good SNPs are pushed toward a certain
corner that represents desirable QC values: low MSP, high MAF and low
MSP to MAF ratio.

Given the PCA plots, we use DBSCAN (Ester at al., 1996) to
deﬁne the boundaries of the good SNPs. DBSCAN is a density-based
clustering algorithm, it performs efﬁciently on large-scale datasets, and most
importantly, it can ﬁnd clusters of arbitrary shape. Given a data space, it
deﬁnes regions of high-density points as clusters and classiﬁes regions of
low-density points as noises (i.e. a noise is a point that does not belong to
any clusters). DBSCAN requires that for each point in a cluster, there are
at least a minimum number, K , of points in the neighborhood of a given
radius r of the target point. Ester at al. recommended setting K to four, and
to determine r from the data Via the following steps. First, calculate the
distance of each target point to its K -th nearest point. Next, plot the sorted
K -th nearest neighbor (NN) distance (which is referred to as the sorted K -th
NN graph). Finally, set r to the Y-axis value where a sharp jump occurs.
We follow the suggestion of using K :4. Instead of eyeballing the value
for r as suggested by the original work, we solve for r by ﬁtting a change
point model as described in the Appendix A1. The r value determined by
the change-point method should be Viewed as an initial value, and should
be further ﬁne tuned until certain criteria are fulﬁlled. For example, tune r
until the resulting ‘good’ SNPs yield a desirable A value (i.e. the inﬂation
factor of the test statistics; Devlin and Roeder, 1999), until maximum MSP
is smaller than a desirable level, or until a certain percentage of SNPs are
removed. With the suitable r value, we then use the largest cluster identiﬁed
by DBSCAN to deﬁne the boundaries for good SNPs (e.g. see the borders
of the blue area in Figs 1c and 2c). The boundaries represent meaningful
thresholds with respect to the original QC variables. In the ﬁnal output of
the algorithm, an SNP is labeled as ‘good’ if (i) it is in the largest cluster, or
(ii) it passes the identiﬁed thresholds of all QC features even if it is not in the
largest cluster. Criterion (ii) ensures the monotonicity of the thresholding.
That is, any SNPs located in the ‘good SNP corner’ (i.e. high logMAF, low
MSP and low MSP/MAF) will be included even if they are not dense enough
to be included in a cluster.

 

1 732

112 ﬁlo's[Bruno[pJOJXO'sorwurJOJurorqﬂ:duq uteri papeolumoq

9103 ‘{g anﬁnv 110::

A QC algorithm for filtering SNPs in GWAS

 

(a) Biplot of CAD

 

(b) Expert ﬁlter

  

 

    
 
 
 
 

‘3" 3 '
0 Good SNPs
0" “' 0 Bad SNPs
8« *‘ 0 Identiﬁed signals
 MSPcs
5., Iogtv'lAFall °--
I ('1 1o 20 an t '5 1'0 15 20 25
N (c) The proposed filter (d) Overlay of both ﬁlters (zoom-in)
O ,0 _
CL m:
a Good SNPs : 3312 323d
3 , I Expert good
I ' Bad SNPS Proposed bad
3- :1. I Identiﬁed signals v- . Efé’ggsggiood
-. Identiﬁed signals

 

2'0

 

PC1

Fig. 1. Projections of SNPs on the two-dimensional PC plane for the WTCCC CAD study. (a) PCA biplot, where the red arrows represent directions of
the original variables. (b) SNP classiﬁcation results from the expert ﬁlter. (c) SNP classiﬁcation results from the proposed ﬁlter. (d) Overlay of good SNP
boundaries deﬁned by both ﬁlters. In (b), (c) and (d), the identiﬁed signals (green dots) are those SNPs with association test P-Values <5 X 10‘7.

2.2 Performance evaluations using real datasets

The performance of the proposed QC algorithm was evaluated using the
seven GWAS studies conducted by WTCCC, including bipolar disorder
(BD), coronary artery disease (CAD), CD, hypertension (HT), rheumatoid
arthritis (RA), Type 1 diabetes (TlD), and T2D (WTCCC, 2007). In
addition, we also assess the algorithm using the MDD dataset from
GAIN studies (Sullivan et al., 2009). In each WTCCC GWAS, there were
490032 SNPs genotyped on chromosomes 1 to 22 from 2000 cases and
3000 common controls, which included 1500 from the 1958 British Birth
Cohort (58C) and another 1500 from blood donors recruited by UK Blood
Services. We excluded unreliable individuals as deﬁned in the original
studies: poor sample call rate (<97%), extreme overall heterozygosity
(>30% or <23%) and high genome-wide IBD values (>086), and obtained
on average 1887 cases and 2974 controls. We then removed those SNPs
with HWE P-Value <5.7><10_7 (WTCCC, 2007) and were left with
474 657 SNPs for the QC evaluations. The MDD study contained 556 131
SNPs genotyped on chromosomes 1 to 22 from 1738 MDD cases and 1802
controls. In this dataset, all unreliable samples (e.g. poor sample call rate,
extreme heterozygosity, high relatedness and ancestral outliers) have been
excluded using the steps described in Sullivan et al. (2009). We removed
SNPs with HWE P-Value <5.7 X 10‘7 and performed the QC analysis on
the remaining 526 740 SNPs.

The results of the proposed QC algorithm are compared with the
expert ﬁlter deﬁned in WTCCC (WTCCC, 2007), which removed SNPs
with MSP> 5% if MAFZ5%, MSP> 1% if MAF<5% or SNPs with
MAF: 1%. The performances are assessed based on the following four
criteria: (i) percentage of SNPs excluded due to low quality; (ii) inﬂation

factor of the substructure-adjusted test statistics A; (iii) number of false
associations found in the ﬁltered dataset [referred to as false positives (FP)];
and (iv) number of true associations missed in the ﬁltered dataset [referred
to as true positives (TP)]. For (ii), the inﬂation factor A is calculated as the
median of the observed test statistics of association divided by the median
of x?” distribution (i.e. 0.456) (Devlin and Roeder, 1999). For the WTCCC
datasets, the association statistics were calculated using a stratiﬁed Cochrane
ManteleHaenszel test in PLINK (Purcell at al., 2007) to adjust for population
substructure. For the MDD dataset, the trend test statistics were used because
the samples are ancestrally homogeneous (Sullivan et al. 2009). For (iii),
an FF is deﬁned as a signiﬁcant signal found in the data analyses but not
conﬁrmed in the literature (i.e. neither in PubMed database nor the published
GWAS catalog at www.genome.gov/gwastudies). For (iv), a TP is deﬁned
as a signiﬁcant signal found in the data analyses and also conﬁrmed in the
literature (either in PubMed or the published GWAS catalog). A P-Value
threshold of 5 X 10‘7 (following the WTCCC paper) is used to deﬁne
signiﬁcance. However, because there were no literature-conﬁrmed signals
that survived the 5 X 10‘7 threshold for BD, HT and MDD, we used a less
stringent threshold of 10‘5 for the P-Value in our analysis for these three
diseases. A threshold of 10‘5 is considered to be a moderate association in
the WTCCC studies (WTCCC, 2007).

2.3 Implementation

We have implemented a command-line-based software package to perform
the proposed QC algorithm. The software runs PCA using the ‘prcomp’
function in R and runs DBSCAN using C++ code written by us for speed

 

1 733

112 ﬁlo's[sumo[pJOJXO'sorwuiJOJurorqﬂ:duq 11101} popeorumoq

9103 ‘{g isnﬁnv 110::

M.Pongpanich et al.

 

(a) Biplot of MDD

 

(0) Expert filter

 

 

 

 

 

  
 
 
 
 
  

 

 

‘C_’_
l :73" _
1?
Ln La _ x J
J
o— If
a- r,
"3- -.
 0 Good SNPs
" m 0 Bad SNPs _ .
g logMAFall ' " O Identiﬁed signals
I -20 -15 -1'0 —5 0 s —20 -1'5 -1'0 -'5 0
N (c) The proposed ﬁlter (d) Overlay of both ﬁlters (zoom-in)
U
0. d o Bothgood
:,j" ' s. o Bothbad .
 0 Expert good
m. 1; Proposed bad
I_.- 0 Expert Bad _
 N ' Proposed good
15. o Identiﬁed signals
a  Ch ' '
0 Good SNPs
m_ 0 Bad SNPs  -. ‘1‘"
' O Identiﬁed signals
T2'0 —1 5 —1'0 —5 0— a 35 4'1 —'3 32 —'1 0 1 _
PC1

Fig. 2. Projections of SNPs on the two-dimensional PC plane for the GAIN MDD study. (a) PCA biplot, where the red arrows represent directions of
the original variables. (b) SNP classiﬁcation results from the expert ﬁlter. (c) SNP classiﬁcation results from the proposed ﬁlter. (d) Overlay of good SNP
boundaries deﬁned by both ﬁlters. Note in (d) there are no red dots because the good SNP region by the proposed method is a superset of the expert good
region. In (b), (c) and (d), the identiﬁed signals (green dots) are those SNPs with association test P-Values < 10‘5.

improvement. The software and instructions are available for download from
the corresponding author’s website.

3 RESULTS

Figure 3 shows the results of our method and the WTCCC expert
ﬁlter based on the four criteria. The speciﬁc numerical results are
given in the Supplementary Tables 1 and 2. To illustrate, we report
the results using the r value obtained by the change-point model
for all eight diseases regardless of whether a ﬁirther ﬁne-tuning
of r was carried out. Overall, the algorithm with change-point r
removed from 2.8% to 14.6% fewer SNPs than the expert ﬁlters,
and yet had either smaller or comparable A values, contained fewer
or comparable FPs, and retained the same TPs (which were all the
TPs in the genotyped SNPs). The maximum MSP retained in the
datasets ranged from 4.44% to 5.55% for the WTCCC datasets and
was 37.63% for MDD.

Carefully examining Supplementary Tables 1 and 2, we saw that
there were three diseases where the performance with the initial
change-point r value was not as good as expert ﬁlters in some of
the criteria: BD (having a larger A = 1.123 than the 1.122 of the
expert ﬁlter), RA (having a larger A: 1.083 than 1.052 of expert
and including four more FPs) and MDD (having two more FPs

than expert). Using BD as an example, with the change-point r value,
our ﬁlter removed 13.2% of the SNPs (versus 18.6% of expert), and
the resulting ‘good’ SNPs had a maximum MSP of 4.91%, a not-
small A value of 1.123 (versus 1.122 of expert), 19 FPs (versus 27
of expert, out of 912 unﬁltered FPs) and retained all 6 TPs (same as
expert). In practice, the algorithm should be continued by adjusting
r until a desirable A is reached. However, for comparison purposes,
we instead ﬁne-tuned r to a smaller value so that the two ﬁlters
removed about the same proportion of SNPs. With a similar removal
rate (18.2% versus 18.6% of expert), our algorithm gave a slightly
smaller A (1.114 versus 1.122) and kept fewer FPs (18 versus 27).
The results of the TPs remained unchanged.

In RA, we removed 9.8% of SNPs (versus 18.7% of expert), which
resulted in a maximum MSP of5.55%, a A of 1.083 (versus 1.052 of
expert), 211 FPs (versus 207 of expert, out of 817 unﬁltered FPs),
and the same number of TPs as the expert ﬁlter (6 out of 6 unﬁltered
TPs). When we removed about the same proportion of SNPs as the
expert ﬁlter (18.5% versus 18.7%), the remaining good SNPs yielded
a slightly smaller A (1.048 versus 1.052), contained 16 fewer FPs
(191 versus 207) and the same number of TPs (6). In MDD, with
the change-point r,the algorithm removed much fewer SNPs (5.26%
versus 19.89%), yielded comparable A (1.043 versus 1.044), but kept
two more FPs (6 versus 4 out of 6 unﬁltered FPs) compared to the

 

1 734

112 ﬁlo's11211100[pJOJXO'sorwuiJOJHrorqﬂ:duq uroiJ pop1201umoq

9103 ‘1gisnﬁnv 110::

A QC algorithm for filtering SNPs in GWAS

 

 

a
E (I
o_ a Q I a o I Q o o ' T 7
EN + 'I' + + + +
£°° J“
zv +
(no
as .‘. .1.‘ .‘ .‘ .2 .‘ .‘ .‘.3.
so 302 CAD co HT RA RA T10 T20 MDD MDD M002
('3)
N V V
'— V V
V v v V
.a_ 0 up
.—' Q
I! ‘F + o
' 9 3 3 3

1.0

 

BD‘ BDZ CAD‘ 00‘ HT‘ RA‘ RA: T10‘ T20‘ MDD‘MDD’MDDZ

 

(C)
rs e
A
a: g ‘
._ A
'U Q E I. a
III. E '0
LI. x a ..   .. .. .. ..  .. .. .. ..  A ..   .. .. .. 
31’. u; 1
BD‘ 302 CAD‘ 00‘ HT‘ RA‘ m2 T1 0‘ TZD‘ M00‘ M003 MDD2
912 912 778 229 1232 B17 B17 1291 353 5 5 E
(d)
16-. on
L v Unﬁltered results
E 3 "° 0 Expert filler
U 2 v + The proposed ﬁlter
IE Cl- 1 The difference between
ﬁ N expert and our filters

30‘ 302 CAD‘ CD‘ HT‘ RA' RA? T1D‘ T2D‘ MDD‘MDDSMDDz
s s 5 13 4 s s 16 a 2 2 2

Diseases

Fig. 3. Performance comparisons of different ﬁlters based on the four criteria
deﬁned in the text. (3) Percentage of SNPs removed. (b) A from substructure-
adjusted test statistics. (c) Difference (expert-proposed) in the numbers of
FPS retained by different ﬁlters. The numbers below each disease code on
the X—axis show the counts of FPS in the unﬁltered results. ((1) Difference
(expert-proposed) in the numbers of TPs retained in the dataset by different
ﬁlters. The numbers below each disease code on the X -axis show the counts
of TPs in the unﬁltered results. On the X -axis of each ﬁgure, ‘1’ indicates
the results based on the r value determined by the change-point model, ‘2’
indicates the results based on the r value that makes the proportion of SNPs
removed by the proposed ﬁlter comparable to the expert ﬁlter and ‘3’ indicates
the results based on the r value that makes the maximum MSP in the ﬁltered
dataset <10%.

expert ﬁlter. Because the resulting maximum MSP was too large (i.e.
37.6%) when we used the change-point r, we tuned r by decreasing
its value till the maximum MSP was <10% (i.e. 9.7%). The A and
FPs became 1.044 and 4, respectively, which were the same as the
expert ﬁlters. The A and FPs stayed unchanged when we continued
tuning r until we had removed the same proportion of SNPs as the
expert ﬁlter.

We also categorized the SNPs into four groups according to
whether they were included (i.e. labeled as ‘good SNP’) or excluded
(i.e. labeled as ‘bad SNP’) by our ﬁlter and the expert ﬁlter (Table 1).
For all of the diseases, our algorithm and the expert ﬁlter have around
80% agreement in inclusion and around 12% agreement in exclusion
on average. The majority of the disagreement between the two ﬁlters
can be attributed to the use of adaptive thresholds in our ﬁlter. To
illustrate, we show the boundary of good SNPs from our ﬁlter, the
expert ﬁlter, and the overlay of the two on a two-dimensional PC
plane using CAD (Fig. 1d) and MDD (Fig. 2d) (see Supplementary

Table 1. Agreement and disagreement in SNP classiﬁcations (good SNPs
versus bad SNPs) by the proposed ﬁlter and the WTCCC expert ﬁlter

 

 

 

Diseases r Agreed Disagreed
Both Both Good versus Bad versus
gooda (%) badb (%) bad° (%) goodd (%)
BD 0.01546 80.33 12.10 6.47 1.10
0.0110f 78.38 15.10 3.47 3.06
CAD 0.01256 79.32 13.92 4.78 1.99
CD 0.01346 79.58 12.57 5.72 2.13
HT 0.01326 79.69 13.37 5.20 1.74
RA 0.01796 80.76 9.27 9.45 0.53
0.0101f 77.05 14.23 4.48 4.24
T1D 0.01336 79.62 12.77 5.80 1.81
T2D 0.01366 79.93 13.24 5.34 1.50
MDD 0.02596 80.11 5.26 14.63 0.00
0.0072g 78.95 17.26 2.63 1.16
0.0063f 78.53 18.24 1.65 1.58

 

aThe % of SNPs classiﬁed as ‘good’ by both ﬁlters.

bThe % of SNPs classiﬁed as ‘bad’ by both ﬁlters.

CThe % of SNPs classiﬁed as ‘good’ by the proposed ﬁlter but ‘bad’ by the expert ﬁlter.
dThe % of SNPs classiﬁed as ‘bad’ by the proposed ﬁlter but ‘good’ by the expert
ﬁlter.

6The r value is determined by the change-point model.

fIn these analyses, the values of r are chosen to make the proportion of SNPs removed
by the proposed ﬁlter comparable to that of the WTCCC expert ﬁlters.

gThe r value is chosen to make the maximum MSP in the resulting good SNPs <10%.

Fig. 1 for other diseases). Instead of the step-like boundary of good
SNPs in the expert ﬁlter, our ﬁlter gives a smoother boundary of
good SNPs. Figure 4 ﬁirther illustrates the disagreements on the
axes of MSP versus MAF (instead of PC1 versus PC2) for CAD
(see Supplementary Fig. 2 for other diseases). The yellow dots
represent SNPs that are labeled as ‘good’ by our algorithm but ‘bad’
by expert ﬁlters. One group of yellow dots occurred in the extremely
low MAF and low MSP range, indicating that our algorithm would
keep SNPs of MAF < 0.01 when their MSPs were extremely low.
In contrast, the red dots represent the SNPs that are labeled as ‘bad’
by our algorithm but ‘good’ by expert ﬁlters. The big red area on
the right side indicates that our algorithm gives a more stringent
MSP criterion for good SNPs than the expert ﬁlter (i.e. MSP < 5%):
our criteria ranged from MSP < 2% to MSP < 4%, depending on the
MAF. Lastly, the two red and yellow triangles in the upper middle
area show the impact of the ‘smoother’ threshold of our algorithm:
it has a more stringent MSP threshold when MAF is 0.01—0.025,
and a less stringent threshold when MAF is 0025—005.

4 DISCUSSION

Ensuring the quality of genotype data is essential for drawing
accurate and replicable conclusions (Donnelly, 2008). In this work,
we have introduced a QC algorithm to identify SNPs with low
QC features using criteria determined through PCA and DBSCAN.
The proposed ﬁlter is in essence an ‘unsupervised’ (i.e. algorithm-
determined) version of the ‘supervised’ expert ﬁlter to classify SNPs,
and it aims to account for multiple QC variables, provides adaptive
cutoff values and automates thresholding decisions. Speciﬁcally,
we use PCA to jointly model the potentially highly correlated QC

 

1 735

112 ﬁlo's11211100[pJOJXO'sorwuiJOJHrorqﬂ:duq uroiJ pop1201umoq

9103 ‘1gisnﬁnv 110::

M.Pongpanich et al.

 

MAFaII

0.50 0.45 0.40 0.35 0.30 0.25 0.20 0.15 0.10 0.05 0.00

 

MSPaII

Fig. 4. Characteristics of SNPS with disagreeing classiﬁcation results
between the proposed ﬁlter and WTCCC expert ﬁlter in CAD. In the graph,
each dot represents an SNP; the yellow dotS indicate SNPS labeled as ‘good’
in the proposed ﬁlter but ‘bad’ in the expert ﬁlter, and the red dotS indicate
the opposite scenario. The green ‘X ’S indicate FPS. There are no TPS in the
disagreement regions because both ﬁlterS claSSiﬁed all TPS aS ‘good’ SNPS.

variables, and use DBSCAN to identify the borders of good-SNP
clusters that have arbitrary shapes. The boundary of the good-SNP
cluster can be translated directly to meaningful thresholds for the
original QC variables. The proposed algorithm retains the rationale
of the expert ﬁlter to identify QC outliers, avoids arbitrary decisions
on cutoff values and gives contingent MSP thresholds for different
MAF values. The data applications show that with the same or
fewer SNPs discarded due to bad quality, the proposed algorithm
has comparable or better performance than the expert ﬁlter for all
diseases.

The underlying rationale of our algorithm is that the majority of
genotyped markers have sufﬁcient genotyping quality, and hence
low-quality SNPs can be treated as outliers and be identiﬁed
by looking for SNPs with distinct QC features. To facilitate
the implementation of the idea, we use PCA on the original
QC variables. PCA consolidates the information from the many
correlated QC variables, and projects SNPs onto a two-dimensional
PC plane where good SNPs clump together into a comer of desirable
QC values, whereas bad SNPs fan out in all directions. It is expected
that the PC biplot may differ from one study to another: in our
exploration, we have seen different patterns in the biplots for
WTCCC datasets and for the MDD dataset. Yet all biplots have good
SNPs lumped into a comer that corresponds to good QC features.

We wish to point out that when using the proposed algorithm, it
is important to monitor the features of the retained good SNPs and
tune the neighborhood radius r to safeguard the basic QC criteria.
This is because the thresholds for outliers are determined relative to
the majority of the data. The tuning becomes particularly crucial if a
big proportion of data points are of low quality. For example, in the
MDD dataset, there were about 11.4% of SNPs with MSP > 10%,
and our algorithm with the initial change-point r kept SNPs with
MSP up to almost 38%. Tuning of r was thus continued until the

maximum MSP dropped to < 10%. In practice, the smaller r is, the
more stringent the QC criteria for ‘good’ SNPs will be, as a smaller
r makes it harder to form a cluster in DB SCAN. We suggest starting
with a value of r determined by ﬁtting a change-point model to the
sorted fourth nearest distances, and then ﬁirther to adjust r until the
speciﬁc goal is reached, so as to assure the A value, the maximum
MSP, or the percentage of SNPs removed within reasonable ranges.
In our explorations, we found that the change-point r often suggests
a reasonable value (e.g. in CAD, CD, HT, T1D and T2D) or is at
least a good upper bound (e.g. in BD, RA and MDD, judging by
the resulting A values or the retained maximum MSP). Given the
change-point r, one can reduce its value if a more stringent ﬁlter is
needed, and increase its value if one wishes to remove only extreme
outlier SNPs.

When selecting which QC variables to include in the algorithm,
we intend to avoid using MAch and MAFcn because they may
obﬁiscate the true associations. For the rest of the QC variables,
it is possible to make other choices for inclusion/exclusion, e.g.
to exclude MSPall from the proposed QC variable set (i.e. to use
ﬁve variables), or to include MSPall/MAFall to the proposed QC
variable set (i.e. to use seven variables). While we expected that
the performance would not change much, we carried out sensitivity
analyses to evaluate the impact of using different QC variables in
the proposed algorithm. The results are given in Supplementary
Tables 1, 2 and 3. For comparability, we tuned the r values so that
each analysis removed a similar proportion of SNPs to the original
6-variable analysis. As expected, the 7- and 5-variable analyses
performed very similarly to the proposed 6-variable analyses,
indicating the robustness of the proposed ﬁlter to the different
choices of QC variables.

ACKNOWLEDGEMENTS

This study makes use of data generated by the WTCCC and the
GAIN major depression disorder study (GAIN-MDD). For WTCCC,
a ﬁill list of the investigators who contributed to the generation of
the data is available from http://www.wtccc.org.uk. Funding for the
WTCCC project was provided by the Wellcome Trust under award
076113. For GAIN-MDD, the genotyping of samples was provided
through the Genetic Association Information Network (GAIN),
Foundation for NIH. The dataset used for the analyses described
in this manuscript were obtained from the database of Genotypes
and Phenotypes (dbGaP) found at http://www.ncbi.nlm.nih.gov/gap
through dbGaP accession number phs000020.v2.p1. Samples and
associated phenotype data for the GAIN-MDD were provided by
Drs Patrick Sullivan, Dorret Boomsma, Brenda Penninx, Eco de
Geus, Gonneke Willemsen and Witte Hoogendijk. The authors thank
Drs Steffen Heber, John Pierre Mertz and Chris Smith for their very
helpful discussions on the work.

Funding: National Institutes of Health (R01 MH084022).

Conﬂict of Interest: none declared.

REFERENCES

Anney,R. et al. (2008) Non-random error in genotype calling procedures: implications
for family-based and case-control genome-wide association studies. Am. J. Med.
Genet, 147B, 137971386.

 

1 736

112 ﬁlo'S11211100[pJOJXO'SorwuiJOJHrorqﬂ:duq uroiJ pop1201umoq

9103 ‘1gisnﬁnv 110::

A QC algorithm for filtering SNPs in GWAS

 

Barrett,J.C. et al. (2008) Genome-wide association deﬁnes more than 30 distinct
susceptibility loci for Crohn’s disease. Nat Genet, 40, 9557962.

C1ayton,D.G. et al. (2005) Population structure, differential bias and genomic control
in a large-scale, case-control association study. Nat Genet, 37, 124371246.

Cox,D.G and Kraft,P. (2006) Quantiﬁcation of the power of Hardy-Weinberg
equilibrium testing to detect genotyping error. Hum. Hered., 61, 10714.

Devlin,B. and Roeder,K. (1999) Genomic control for association studies. Biometrics,
55, 99771004.

Donnelly,P. (2008) Progress and challenges in genome-wide association studies in
humans. Nature, 456, 7287731.

Ester,M. et al. (1996) A density-based algorithm for discovering clusters in large
spatial databases with noise. In Proceedings of the 2nd International Conference on
Knowledge Discovery and Data Mining, AAAI Press, Portland, OR, pp. 22G231.

Fardo,D.W. et al. (2009) On quality control measures in genome-wide association
studies: a test to assess the genotyping quality of individual probands in family-
based association studies and an application to the HapMap data. PLoS Genet, 5,
e1000572.

GAIN Collaborative Research Group (2007) New models of collaboration in genome-
wide association studies: the Genetic Association Information Network. Nat Genet,
39, 104571051.

Gordon,D. et al. (2001) A transmission/disequilibrium test that allows for genotyping
errors in the analysis of single-nucleotide polymorphism data. Am. J. Hum. Genet,
69, 3717380.

Gordon,D. and Ott,J. (2001) Assessment and management of single nucleotide
polymorphism genotype errors in genetic association analysis. Pac. Symp.
Biocomput, 6, 18729.

Hao,K. and Wang,X. (2004) Incorporating individual error rate into association test of
unmatched case-control design. Hum. Hered., 58, 1547163.

Hindorff,L.A. et al. (2009) Potential etiologic and functional implications of genome-
wide association loci for human diseases and traits. Proc. Natl Acad. Sci. USA, 106,
93629367.

Hugot,J.P. et al. (2001) Association of NOD2 leucine-rich repeat variants with
susceptibility to Crohn’s disease. Nature, 411, 599$03.

McCarthy,M.I. (2004) Progress in deﬁning the molecular basis of type 2 diabetes
mellitus through susceptibility-gene identiﬁcation. Hum. Mol. Genet, 13, R337R41.

Miyagawa,T. et al. (2008) Appropriate data cleaning methods for genome-wide
association study. J. Hum. Genet, 53, 8867893.

Neale,B.M. and Purcell,S. (2008) The positives, protocols, and perils of genome-wide
association. Am. J. Med. Genet, 147B, 128871294.

Pettersson,F. et al. (2008) Goldsurfer2 (Gs2): a comprehensive tool for the analysis and
visualization of genome wide association studies. BM C Bioinformatics, 9, 1711.

Plagnol,V. et al. (2007) Amethod to address differential bias in genotyping in large-scale
association studies. PLoS Genet, 3, 075970767.

Pompanon,F. et al. (2005) Genotyping errors: causes, consequences and solutions.
Nat Rev. Genet, 6, 8477859.

Purcell,S. et al. (2007) PLINK: a toolset for whole-genome association and population-
based linkage analysis. Am. J. Hum. Genet, 81, 5597875.

Rice,K.M. and Holmans,P. (2003) Allowing for genotyping error in analysis of
unmatched case-control studies. Ann. Hum. Genet, 67, 1657174.

Sladek,R. et al. (2007) A genome-wide association study identiﬁes novel risk loci for
type 2 diabetes. Nature, 445, 8817885.

Sullivan,P.F. et al. (2009) Genomewide association for major depressive disorder: a
possible role for the presynaptic protein piccolo. Mol. Psychiatry, 14, 3597375.
Teo,Y.Y. et al. (2007) On the usage of HWE for identifying genotyping errors.

Ann. Hum. Genet, 71, 7017703.

Teo,Y.Y. (2008) Common statistical issues in genome-wide association studies: a
review on power, data quality control, genotype calling and population structure.
Curr Opin. Lipidol., 19, 1337143.

Teo,Y.Y. et al. (2008) Perturbation analysis: a simple method for ﬁltering SNPs with
erroneous genotyping in genome-wide association studies. Ann. Hum. Genet, 72,
3687374.

Unoki,H. et al. (2008) SNPs in KCNQl are associated with susceptibility to
type 2 diabetes in East Asian and European populations. Nat Genet, 40,
109871102.

Wellcome Trust Case Control Consortium (2007) Genome-wide association study of
14,000 cases of seven common diseases and 3,000 shared controls. Nature, 447,
6617678.

Zeggini,E. et al. (2008) Meta-analysis of genome-wide association data and large-scale
replication identiﬁes additional susceptibility loci for type 2 diabetes. Nat Genet,
40, 6387645.

Ziegler,A. et al. (2008) Biostatistical aspects of genome-wide association studies.
Biom. J., 50, 8728.

APPENDIX A
A.1 THE CHANGE-POINT MODEL FOR
ESTIMATING r

A typical sorted K-th NN graph is shown in Figure Ala. Given
the wide range of the distance, it would be more stable to ﬁt the
change-point model to the log transformation of the distance, as
shown in Figure Alb. After the log transformation, there are two
change points, and our focus is on the right one. The change point
model that we consider uses two linear lines to approximate the
data points around the change point (Fig. Alc). Let y be the log of
the fourth NN distance, x be the (distance-sorted) SNP ID, and x*
be the change point on the X -axis. The two linear models are yl- =
a0 +ﬂoxl- +el- for x,- <x* and yi=a1+ﬁ31xi+ el- forxl- > x*, where
el- ~ N(0, 02) and a0 + 50x* = a1 + 51 x* (or equivalently a1 =0i0 +
(ﬂo—ﬂl)x*). A normal likelihood is then speciﬁed and optimized
to obtain the maximum likelihood estimates 00,80, 81,8 and 2*.
Then the change-point r value is the distance value on the Y -axis
corresponding to 3*.

(a) The distance on original scale
a “3 '

1:: m- .

z -

2 sh .

E 7 .

*T‘

q.

l—l—l—lﬁ—l—f—f—l—l—

 

 

      

0 150000 350000
(b) The distance on log scale
E c:
U -
2 .
2 If -
E c:
i "'-
5’ :22
0 150000 350000
(c) The distance on log scale
3 a E :
'U i
2 . . . . r
2 V =
E o 
i T- 
8“ :2 
'- ‘ l—l—l—l—l—l—l—l—l—l—
0 150000 350000
Points

Fig. A1. The sorted fourth NN distance for CAD. (a) The distance on the
original scale. (b) The distance on the log scale. (c) The distance on the log
scale (dashed line) superimposed with the ﬁt from the change-point model
(solid line) as described in the Appendix A1. The change-point r is indicated
by the dotted horizontal line.

 

1 737

112 ﬁlo'S[sumoprOJXO'SorwuiJOJHrorq”:duq mot} popeo1umoq

9103 ‘1gisnﬁnv uo ::

