ORIGINAL PAPER

Vol. 26 no. 15 2010, pages 1864-1870
doi: 1 0. 1093/bioinformatics/btq314

 

Gene expression

Advance Access publication June 15, 2010

JAMIE: joint analysis of multiple ChlP-chip experiments

Hao Wu and Hongkai Ji*

Department of Biostatistics, Bloomberg School of Public Health, Johns Hopkins University, 615 North Wolfe Street,

Baltimore, MD 21205, USA
Associate Editor: Olga Troyanskaya

 

ABSTRACT

Motivation: Chromatin immunoprecipitation followed by genome
tiling array hybridization (ChlP-chip) is a powerful approach to
identify transcription factor binding sites (TFBSs) in target genomes.
When multiple related ChlP-chip datasets are available, analyzing
them jointly allows one to borrow information across datasets to
improve peak detection. This is particularly useful for analyzing noisy
datasets.

Results: We propose a hierarchical mixture model and develop an R
package JAMIE to perform the joint analysis. The genome is assumed
to consist of background and potential binding regions (PBRs). PBRs
have context-dependent probabilities to become bona fide binding
sites in individual datasets. This model captures the correlation
among datasets, which provides basis for sharing information across
experiments. Real data tests illustrate the advantage of JAMIE over
a strategy that analyzes individual datasets separately.

Availability: JAMIE is freely available from
http://www.biostat.jhsph.edu/~hji/jamie

Contact: hji@jhsph.edu

Supplementary information: Supplementary data are available at
Bioinformatics online.

Received on January 18,2010; revised on May 5,2010; accepted on
June 8, 2010

1 INTRODUCTION

ChIP-chip is a powerful approach to study protein—DNA interactions
(Ren et al., 2000). By coupling chromatin immunoprecipitation with
genome tiling arrays, this technology allows one to create genome-
wide maps of transcription factor binding sites (TFBSs; Boyer et al.,
2005; Carroll et al., 2005; Cawley et al., 2004). With rapid growth
of ChIP-chip data in public repositories such as Gene Expression
Omnibus (Barrett et al., 2009), it becomes more and more common
that multiple datasets related to the same TF, pathway or biological
system are collected. When multiple such datasets are available, it is
often desirable to analyze them jointly. Looking at all data together
not only enables one to study commonality and context-dependency
of protein—DNA association, but also creates opportunities to borrow
information across datasets to improve statistical inference. This
is particularly useful if the data of primary interest are noisy and
information from other datasets is required to distinguish signals
from noise.

 

*To whom correspondence should be addressed.

Figure la provides an example that illustrates the potential
advantage of joint data analysis. The ﬁgure shows four related
ChIP-chip experiments (GEO GSE11062, Vokes et al., 2008;
GSE17682, Lee et al., 2010) performed by two different labs using
Affymetrix Mouse Promoter 1.0R arrays. The purpose of these
experiments is to locate binding sites of two TFs, Glil and Gli3,
in different cellular contexts. Both Glil and Gli3 are members
of Gli family of TFs, which recognize the same DNA motif. The
ﬁgure shows log; fold enrichment between the normalized ChIP
and control probe intensities. The ﬁrst experiment (‘Glil_Limb’)
measures Glil binding in developing limbs of mouse embryos. This
experiment has low signal-to-noise ratio due to an unoptimized ChIP
protocol and use of a mixed cell population (Glil is active only in the
posterior fraction of the limb, but ChIP-chip was performed using
the whole limb. As a result, cells from the anterior limb may dilute
signals in the posterior limb). In spite of the weak signals, one still
wants to ﬁnd true Glil binding sites in this dataset, since Glil is
a key transcriptional regulator for controlling proper development
of limb. A careful examination of the data shows that ‘peaks’ in
these four datasets are correlated. In other words, they tend to
occur at the same locations in the genome. This correlation can
be potentially used to improve statistical inference. For example,
the weak peak highlighted by the solid box in ‘Glil_Limb’ cannot
be easily distinguished from background noise if one looks at this
dataset alone. However, if all datasets are analyzed together, the
observation that all other datasets have strong peaks at the same
location suggests that the weak peak in ‘Glil_Limb’ is a real
binding site. In contrast, the peak highlighted by the dashed box
has approximately the same magnitude in the ‘Gli l_Limb’ data, but
no binding signal has been observed in the other datasets, suggesting
that it is less likely to be a real binding signal.

When multiple datasets are analyzed jointly, it is important to
keep in mind that some TFBSs are context-speciﬁc. For example,
the location shown in Figure lb is bound by Gli in ‘Gli3_Limb’
but not in ‘Glil_Limb’ and ‘Glil_GNP’ (GNP stands for granule
neuron precursor cells). In this case, even without referring to the
other datasets, the enrichment in ‘Gli3_Limb’ is sufﬁciently strong
and should be called as a peak. On the other hand, one should avoid
claiming that ‘Glil_Limb’ and ‘Gli l_GNP’ have peaks in this region
only because there is a strong peak in ‘Gli3_Limb’. Ideally, there
should be a mechanism that automatically integrates and weighs
different pieces of information, and rank peaks according to the
combined evidence. This cannot be achieved by simply analyzing
each dataset separately and then taking intersections of the results.

In the past few years, a number of algorithms and software
tools have been developed for analyzing ChIP-chip data.

 

1864 © The Author 2010. Published by Oxford University Press. All rights reserved. For Permissions, please email: journals.permissions@oxfordjournals.org

112 /3.Io's[BumoIpJOJXO'sotwuiJOJutotq”:duq 11101} papeolumoq

9103 ‘{g anﬁnv 110::

Joint analysis of multiple ChIP-chip data

 

 
   
 

(a) G|i1_Limb (b) Glil—Limb
1|... 11,....".n.... ,..lr;,nn._illl-.E,....;.|.1,..,,1.|,,..1| II ,,,.1,..l..|.u.,".. 1,1 I 1.,AiiJ1-il-ilwuq rnttrlrunr 11-11
E (éliLLimb Gli3_Limb
3 1.1.,.|.l,..,i|...." .|.,ii,||.|,lil.1.i.llrli.||i.|..l..,.llull I. .II..I,.1...||....|I. 3 hr I JIINLWIJWJ‘IM} Jullillh‘ulm
E: . . E l
3 I dii1_Med 3’ Gli1_Med
|I|.,l Wildly,“ I.,.I,€|.I.l.1|..ill1l|i|I11|1.Il,111|11|.1llulllllllilI .I lull...|l1|.l1|||.|“ lilln I Fl Jljlv‘jlllllllwl,_lIl ‘lnlldlLL '1. FJL
: GliLGNP G|i1_GNP
|.I.|1..,....|,..LI.1, .,,,1.1L...,|..1,.J|;1|i|...,|,|.1,|.,.,||ill , .. .1...,.,.||,l,|...,|, 11.1 1 ...,|Il.1,|tlll,il.d,ll.lll 11,1111” a'1.
1—1—1—1—1
71471000 71473000 71475000 130876000 130878000
chr6 chr2

 

(C) window i
Pf“  I I I

indies or (5,): 0.01

l qd:
0.1

Activeblndlng 0-9 I I
Indicator(A..,): 0-6 I I
0.5

I
 .111... l /'\ /\ / \ / \

1 ....JIII_II,.,,. 1 wanna“, 1 prA‘u-‘Aﬂp 1 Humm—

..,,I ,li, unlit. .11

a u N -n
.—
:p :65 meg

2 .1..JI_L1,..1.1,\, 2 "5.11in 2 Jew-Jiiw 2 Ward";

it"  Jilin"l £11333:-
9 ' 3 uM»,-m 3 q'h'lyilm 3 .urﬂI-lww- 3 "Wm-1a»
4 .. Ilia..." 4 ENE.” 4 VIM—0,1,. 4 4,014...”
i. k l PBR PBR PBR
... 1| .
I 1 I  I 1 Sgﬁisgnal For probe i on data set :1, background
' (g '; 1;?“ Iollows 1w, peak Iollows 1“,

130880000 130882000

=0, I :1 . — indicates peak location.

 

Fig. 1. Motivation and model structure of JAMIE. (a) Four Gli ChIP-chip datasets show co-occurrence of binding sites at the same genomic locus. This
correlation may help to distinguish real and false TFBSs. Each bar in the plot corresponds to a probe. Height of the bar is the log; ratio between ChIP and
control intensities. Med, medulloblastoma; GNP, granule neuron precursor cells. (b) An example that shows context dependency of TF-DNA binding. (c) An

illustration of the JAMIE model.

Examples include Tiling Analysis Software (TAS) from Affymetrix
(Kapranov et (11., 2002), MAT (Johnson et (11 ., 2006), TileMap (Ji and
Wong, 2005), HGMM (Keles, 2007), Mpeak (Zheng et (11., 2007),
Tilescope (Zhang et (11., 2007), Ringo (Toedling et (11., 2007), BAC
(Gottardo et (11., 2008) and DSAT (Johnson et (11., 2009). However,
they are all designed for analyzing one dataset at a time, and the full
advantage of data is not exploited when multiple related datasets
are available. A recent hierarchical hidden Markov model (HHMM)
approach developed by Choi et (11. (2009) allows joint analysis of
one ChIP-chip data and one ChIP-seq data. This represents a new
progress towards using information more efﬁciently via correlating
two types of high-throughput ChIP experiments. Nevertheless,
this method does not target analyzing two related ChIP-chip
experiments. More importantly, its current form does not support the
analysis of more than two datasets, and it is not easy to generalize the
method to handle multiple datasets since its number of parameters
grows exponentially when the number of datasets increases. In
summary, although jointly analyzing multiple ChIP-chip datasets
is conceptually appealing, currently there is no convenient tool to
perform such analysis. Here we develop JAMIE, an R package
for Joint Analysis of Multiple ChIP-chip Experiments, to support
convenient and efﬁcient mapping of TFBSs by jointly analyzing two
or more related ChIP-chip experiments.

JAMIE uses a hierarchical mixture model to capture correlations
among datasets. The model provides the basis for sharing
information across datasets. Its number of parameters grow linearly
with the number of datasets. A computationally efﬁcient algorithm
is developed to estimate the model parameters. Given the estimated
parameters, the model is applied to scan the genome and ﬁnd TFBSs.
Our tests on real data show that by pooling information, JAMIE
improves peak detection over the traditional approach that analyzes
individual datasets separately.

2 METHODS

2.1 Data model

Suppose there are D datasets (Fig. lc). Consider an L base pair (bp) window
starting at an arbitrary probe. It is assumed that a priori, the window can
either become apotential binding region (PBR) with probability 7r, or become

background with probability l—JT. Let B,»=l indicate that the window
starting at probe 1' is a PBR, and B,=O otherwise. If a window is a PBR,
it can either become an active binding region in dataset d (d:l,...,D)
with probability (1,), or it can remain silent in dataset d with probability
1 —qd. Let Aid (:1 or 0) indicate whether the PBR is active in dataset d or
not. Conditional on Bi: 1, Aids are assumed to be independent. If B,»=O,
then Aid :0 for all (1. Under these assumptions, the prior probability that a
randomly chosen genomic window represents an active binding region in
dataset d is Jqu. The joint prior probability that a window is active in all
datasets is 71(qud). In general, this probability is not equal to 112.01%),
the joint probability one would expect if locations of binding sites occur
independently in different datasets. This explains why the hierarchical model,
while assuming conditional independence of Aids given B, = 1, can be used
to describe correlations among datasets.

Now consider a PBR. Suppose it starts at probe 1' and is active in dataseta1
(i.e. B, = l and Aid :1). It is assumed that a PBR active in dataset (1 should
contain an active binding site (i.e. ‘peak’) in that dataset. The peak starts at
a randomly chosen probe within the PBR and has length Wmv (5 L) (Fig. lc).
Wmv is randomly chosen from a set of allowable lengths W. The peak start
and peak length are chosen subject to the constraint that the peak should be
fully contained within the PBR. For a particular PBR and a particular dataset
in which the PBR is active, all possible peak conﬁgurations that meet this
constraint are sampled with equal prior probability. Within the same PBR,
peaks in different datasets can have different starts and different lengths, i.e.
peaks within a PBR are not required to overlap exactly. This provides some
ﬂexibility to model binding sites of different TFs that co-occupy the same
promoters or enhancers but do not bind to the same DNA motif. Both the
length of PBRs (L) and the allowable peak lengths (W) are conﬁgurable. By
default, we use L: 1000 bp and W: {500,600,..., 1000} bp, which match
peak lengths observed in typical ChIP-chip data.

For probe 1', let Hid = 1 denote that it is located within a peak in dataset
d, and HM :0 otherwise. Hid :0 can correspond to one of the following
scenarios: (i) probe 1' is in a background window; (ii) probe 1' is covered by
a PBR, but the PBR is silent in dataset (1; (iii) probe 1' is covered by a PBR,
which is active in dataset d, but the probe is not covered by the active binding
site (i.e. the peak) in that dataset.

Given Hid, probe intensities are modeled as follows. Suppose dataset d
has K,“ replicated ChIP (IP) samples and Kdo replicated control samples. Let
Xidjk denote the normalized and log; transformed probe intensity of probe 1'
in the k-th replicate under condition j 0:1: IP; j :0: control) of dataset (1.
Deﬁne the observed mean IPicontrol difference Ymv = X'mv 1, —X'mv0,, where
JIM) = ZkavJ-k/de. It is assumed that

Yidmwzvmiiain (1)

 

1865

112 /3.Io's[BumoIpJOJXO'sotwuiJOJutotq”:duq 11101} papeolumoq

9103 ‘{g anﬁnv 110::

H. Wu and H.Ji

 

and the probability density functions of um are given by

f(ll«ileid =0>=(1+0011;0.r,%>+e¢(mi;mi.r3>

(2)
f(#id 1H1 =1): swim; 0. r§>+u — e>¢(u,.1;mi.r§>

Here, ¢(x;m,r2) represents probability density at a point x of a normal
distribution with mean in and variance 1'2, mixing proportion e is a small
positive number, and 111,) > 0. This model implies that for most background
probes, the true IPicontrol difference um follows a normal distribution
N(0,r§), and for most probes in peaks, um follows N(md,r§). However,
there is a small probability 6 to have outliers, i.e. um of a background probe
can show a real IPwontrol difference that follows N (111,) , 1'3), and a probe in a
peak may not respond to TF-binding and has Mid ~N(0, r5). Assuming equal
variance (1'3) of the two normal distributions guarantees that the likelihood
rati0f(ﬂid lHid = 1)/f(#mi lHid = 0) iS monotone in Mid-

Integrating out um gives the probability density of Ymv conditional on Hid.
Deﬁning ﬁnd Ef(Yid |Hmv 2h), we have

font =(1—e)¢(Yi.1:0.a5,+r3>+e¢(Yid;mi.a§,+r§) (3)
fud=e¢(Yi.1;0.a,€,+r5)+(1 —e>¢(Yid;mi.a§,+r5>

where 111,), (71.2”, and 1'3 are parameters that can be estimated from data
(see below). Once they are estimated, they will be treated as ﬁxed and
known parameters. The role of e is to bound the likelihood ratio f] M / fomv
that a single probe can contribute to making a peak call (the bound is
[e/(l — e),(l — e)/e]). For considerations of computational efﬁciency, we ﬁx
6 to be 0.001. Empirically, this produces reasonable results.

Together, these assumptions provide a probabilistic model that describes
how the observed data Y in a genomic window are generated (Fig. lc). Let
U =(L, W) be the conﬁgurable window size parameters. Deﬁne T, to be the
set of probe indices in the L bp genomic window starting at probe 1'. Ymv 2
{YM :1 6 Ti} is the collection of all enrichment measurements in window 1' and
dataseta’. Yi=(Yi1,...,YiD). Deﬁne m=(m1,...,mD), E be the collection of
all (rigs, \II the collection ofall rjs and q=(q1 , . . . ,qD). Let A 2(2, m, \II, 71, q)
be the collection of all parameters that need to be estimated from the data,
and let A, =(Ai1 , . . . ,AiD). The basic idea of JAMIE is to ﬁrst estimate A, and
then scan the genome using a sliding window and the estimated parameters to
ﬁnd active binding regions in each dataset based on the posterior probability
P(A,d =1|Y,,A,U).

2.2 Likelihood and posterior probabilities

If the pr window starting from probe 1' is inactive in dataset d, the
probability to produce Ymv is

[70121 EP(YmilAmi =01A1U)= Hfom (4)
[67",-

If the window is active in dataset (1, let umv denote the probe that starts the
active peak within the window, Tiwid’“

peak starting at um and T}\T'iwid’“id be the remaining probe indices. Let |Z|
counts the number of elements in a set Z and T,»(Wmv) be the set of probe
indices that can be used to start a peak of length Wmv that is fully covered by
the window. The probability of Yid, after integrating out peak start um and

peak length Wmv is

M be probe indices covered by a Wmv bp

1
p1,, EP(Y,,|A»,1 =1,A,U)= —
’ ’ ’ Ewewimwmi

Z 2 H flld H ﬁnd (5)

WideWuideTi(W,-d) [ET‘Widvl‘id [ETAT‘Widvl‘id
1 1

Thejoint probability of (Yi,Ai,Bi) is given by

1—8,
P(Yi.Aini|A~U)= [(1-N)H{(1-Am)pom}:|

d

B.
x [Hi—[[0 — (111)170idll—Aid [11112111114] (6)

d
The posterior probability of Bi given Y, and (A,U) is
P(Bi|Yi,A,U)o<P(Yi,Bi|A,U)

1—8, B,-
= |:(1—JT)1—[170mi:| [211—110—0001 Ham] (7)
d

11'
Let fr, =P(Bi = llYi, A,U). The posterior probability of Aid 2 l is
P(Aid=1|Yi,A,U)=fri><P(Amv=1|Bi=1,Yi,A,U)

qdpim _-

=ﬁ*><—= 'd
l (1_9d)p0id+9dplid qt

(8)

The computation of P(Amv = 1|Bi= l,Y,, A,U) only involves information
from the dataset (1, while fr, is determined using information from all datasets.
The formula above makes it clear that information from dataseta1 is weighed
by information from other datasets in order to determine whether the window
in question is an active binding region in dataset d.

2.3 Parameter estimation

We originally sought to divide the genome into non-overlapping windows
and develop iterative algorithms such as Expectation Maximization (EM) or
Markov Chain Monte Carlo to estimate the parameters using all windows.
This approach turned out to be computationally too intensive to be practically
useful. As a result, we decided to use an alternative approach, which
is computationally much more efﬁcient but only provides approximate
estimates of parameters that may not be optimal. Our tests show that this
ad hoc approach performed well in real data.

First consider 22071.24.) Let Sid be the standard error of Ymv, computed
using the replicate samples in dataset d. We estimate (71.2”, by an empirical
Bayes approach described in J i and Wong (2005). Brieﬂy, 61.2”, = (l — Bd)Si2d +
BdSii. Here, Bd is a shrinkage factor that takes a value between zero and

one. The value is automatically determined by the data. The term S32, is the
mean of all Sizds in dataset d. If there is no degree of freedom to estimate (71.2”,
within a dataset (e.g. only one IP and one control sample are available), we
use probe intensities from all datasets to estimate (71.2”, via a robust procedure
(see Supplementary Material A.l).

Next consider m and \II. For the purpose of estimating m and \II, we
analyze each dataset separately and assume that Yids within a dataset are
independently drawn from either N (0, (71.2”, + 1'3) or N (111,) , (71.2”, + 1'5). Under this
mixture model assumption, and conditional on the estimated 2, parameters
m and \II can be estimated using an EM algorithm (Dempster at (11., 1977)
(see Supplementary Material A.2).

Lastly, we estimate 1'! and q. Instead of using all genomic windows, we ﬁrst
select windows that are likely to contain peaks. This is done by performing an
initial peak detection for each dataset separately, using a fast moving average
method described previously (J i and Wong, 2005). The initial peak detection
uses a loose false discovery rate (FDR) cutoff (default=30%) so that loci
with weak peak signals and many background windows are also included.
The union of the initial peaks detected from different datasets are obtained.
Each peak is extended or truncated to form an L bp window. Resulting
windows that are not overlapping are retained. The retained windows often
comprise a small fraction of the raw data (<5%). By assuming that PBRs
occur only in these retained windows, we developed a fast EM algorithm to
estimate 1'! and q (see Supplementary Material A.3). Since the assumption
that only the retained windows contain PBRs are generally not true (it only
represents a crude approximation of the reality), this assumption is used only

 

1866

112 /3.Io's[BumoIpJOJXO'sotwuiJOJutotq”:duq 11101} papeolumoq

9103 ‘{g isnﬁnv 110::

Joint analysis of multiple ChIP-chip data

 

for the purpose of estimating JT and q. The estimated 1'! and q will then be
used in conjunction with a sliding window to scan the whole genome to ﬁnd
active binding regions.

2.4 Peak detection

Given the estimated parameters, an L bp sliding window is used to scan
the genome. For each dataset, we ﬁrst ﬁnd locations with (3,1 [Equation (8)]
bigger than a user speciﬁed threshold. Then for each of these locations, we
look for probes within its neighborhood to ﬁnd the one with the local maxima
(i.e. the maximal (11,1). That probe is used as the start of a PBR, and subsequent
probes within L bp from the start are included within the PBR. We report
the most likely peak from all possible peaks in the PBR, after comparing all
(Wm, um) pairs. (1,11 was used as the score to rank the reported peaks. Since
the posterior probabilities 1 —&id can also be Viewed as the estimated local
FDRs, the global FDR of a list of peaks can be obtained by averaging their
1 — limi-

3 IMPLEMENTATION

JAMIE has been implemented in an R package. The engine functions
were written in C for computational efﬁciency. The input required
by JAMIE is CEL and BPMAP ﬁles (for Affymetrix arrays) or text
ﬁles with raw intensities (all other platforms), and a text ﬁle for
parameter conﬁgurations. With two lines of R codes, JAMIE will
report ranked peaks for all datasets and the estimated parameters. In a
test involving four datasets, each with 3 IP, 3 control and 3.8 million
probes, the whole process took around 15 min on a PC running Linux
with 2.2 GHz CPU and 4 G RAM.

4 RESULTS

4.1 Simulations

We ﬁrst tested JAMIE using simulations. Data were created
by adding computationally simulated peaks to real data of
input control samples. Four publicly available datasets generated
using Affymetrix Mouse Promoter 1.0R arrays were collected
(Supplementary Table S1). Each dataset had three input control
samples. For each dataset, we selected one input control sample,
planted in a number of simulated peaks, and generated a new CEL
ﬁle. The newly created CEL ﬁle was used as the simulated ChIP
sample. The other two input control samples chosen from the same
dataset served as the corresponding controls. This produced four
simulated datasets, each with one IP and two control samples. To
simulate the peaks, we ﬁrst generated 3000 PBRs, each 1000-bp

long, at randomly chosen genomic loci covered by the array design.
For each dataset, a random half of the PBRs were then chosen to be
active. Peaks were generated within the active PBRs. Lengths of the
peaks were uniformly distributed between 300 and 800 bp. Relative
locations of the peaks within PBRs were uniformly distributed. For
probes within peaks, we simulated true IP—control differences Mid
from N(md,1'd2) where md=1 and 15:009. These values were
chosen to match observed values in real data. Mids were then added
to the log; probe intensities of the input samples used to plant peaks.

After quantile normalization (Bolstad et (11., 2003), JAMIE was
applied to analyze the simulated data in two different modes.
In the ﬁrst mode, referred to as ‘JAMIE pooling’, all datasets
were analyzed together as described in Section 2. In the second
mode, referred to as ‘JAMIE single’, four datasets were analyzed
separately. This was done by forcing (1d = 1 and ﬁtting a different 7':
for each dataset. These two modes of data analysis were compared
in order to investigate whether the joint analysis was able to improve
performance of peak detection. In addition to JAMIE, we also
performed peak detection using two other peak callers MAT and
TileMap, which showed favorable performance compared to other
tools in the recent analyses of ENCODE spike-in data (Ji et (11.,
2008; Johnson et (11., 2008). Comparison results for the ﬁrst dataset
are shown in Figure 2, and results for the other datasets are presented
in Supplementary Figures S1—S3.

Each method reported a ranked list of peaks for each dataset.
Figure 2a and Supplementary Figure S1 compare the peak detection
accuracies by showing percentages of top-ranked peaks that are
true positives. These ﬁgures show that JAMIE pooling had the
best ranking performance. The observed differences among JAMIE,
MAT and TileMap could be attributed to a number of factors, such
as use of different data normalization procedures and different peak
detection algorithms. For this reason, the comparisons among them
did not provide direct evidence to show the advantage of joint data
analysis. In contrast, the comparison between JAMIE pooling and
JAMIE single was carefully controlled. The only difference between
these two methods was data pooling. The observation that JAMIE
pooling consistently performed better than JAMIE single illustrates
that jointly analyzing multiple related datasets can indeed improve
peak ranking compared to analyzing each dataset separately.

From Figure 2a one can also see that the gain of joint analysis
was more substantial when the signal was weak. The improvement in
accuracy was bigger for peaks that were ranked lower. For example,
for the top 300 peaks, 99.6% called by JAMIE pooling and 96.7%
called by JAMIE single were true positives. The improvement

 

 

 

 

 

 

 

 

 

 

(a) Accuracy (b) Sensitivity (c) FDR
8 — ‘1‘ o _1—1 . ,3
v— »1, 1‘1 “8— 1,1—1 3 _—1— Pooling 3.
E '. \ ‘1\ 2'- ’1a1‘ .3’ -2- Single 43.-
2 o a. 3> 1 go 1,1 3 o --3 TileMap .3'
‘g 0" 02% 1 68' 1’ _3 mg--4- MAT 39
- 'v ‘0 \ '° .3' _ —2 D 3"
g 3‘.2\ 1\ $0 ' 2—2‘2 2 u' -'
13 s— to 1 88' ,3 5’2 4 E ‘ a _2-2
a:  1:. ,§- 4. 4 E 3 ,2—2
t . .— 2 m0 ' ,2
a rig. °§- -' 4-’ g;— .-'2-2—2 . =4
“a 2—  a a' .-’ ° 32’ 1-1—1—‘7‘I““
o o _ ,
a\ {‘3‘ Eg_ ‘4' 4 2;1,1 ‘4
o  z ,-' a 4.-4--4
c— a 4- o 4.-..4
I I I I I I I I I I I I I I I I o I I I I I I
150 450 750 1050 1350 0.00 0.02 0.04 0.06 0.06 0.10 0.00 0.02 0.04 0.06 0.08 0.10

top it of detected bumps

nominal FDR

nominal FDR

Fig. 2. Comparisons of peak detection results of different methods (JAMIE pooling, JAMIE single, TileMap and MAT) in simulated data. (3) Peak detection
accuracy. X -axis is number of top-ranked peaks. Y-axis is the percentage of peaks being true positives. (b) Sensitivity at various nominal FDR cutoffs. X -axis
is the nominal FDR. Y-axis is the number of peaks reported under the corresponding nominal FDR. (c) Observed true FDR versus nominal FDR.

 

1867

112 /3.Io's[Bumo[pJOJXO'sotwuiJOJutotqﬂ:duq 111011 p9p1201umoq

9103 ‘1g1sn8nv 110::

H. Wu and H.Ji

 

in accuracy was only 3%. However, for the top 1500 peaks, the
true positive rates were 79.4% and 59.7%, respectively, and the
improvement was 33%. This is consistent with the intuition that
peaks ranked on top usually have strong signals. For these peaks,
data from a single experiment contain adequate information, and
borrowing information from other datasets has little effects on
changing their ranks.

Figure 2b and Supplementary Figure S2 show the number of
peaks reported by each algorithm under the same nominal (i.e.
estimated) FDR cutoff. In Figure 2c and Supplementary Figure S3,
the nominal FDRs are compared with the observed true FDRs.
These results show that JAMIE pooling consistently reported more
peaks than JAMIE single at the same nominal FDR cutoff (Fig. 2b).
This happened even when the FDR estimated by JAMIE pooling
was more conservative than the FDR estimated by JAMIE single
(Fig. 2c), indicating higher sensitivity of JAMIE pooling. Similar
results were observed when JAMIE pooling was compared to
TileMap and MAT.

Figure 2c and Supplementary Figure S3 also show that all methods
tested here can provide accurate FDR estimates in some datasets but
not the others, and no method was able to consistently provide the
best FDR estimates. In general, the accuracy of FDR estimation
depends on how well the data ﬁt the model assumptions and how
accurate the model parameters can be estimated. If these do not
match the data well, one may obtain biased FDR estimates. For this
reason, in practice we recommend users to use JAMIE mainly as
a tool to rank peaks, and use qPCR to obtain a more reliable FDR
estimates whenever possible.

JAMIE is based on a number of model assumptions, such as the
normality of observed and true log ratios Y id and Mid, equal variance
Id2 of the signal and noise components of Mid, independence of probe
signals conditional on the peak status Hid, etc. We examined these
assumptions using real data, and performed additional simulations
to test JAMIE’s performance when these assumptions did not hold
true. The results are presented in detail in Supplementary Material
B, Supplementary Figures S4—S7 and Supplementary Tables S2—S5.
These analyses indicate that JAMIE is fairly robust to deviations
from the model assumptions.

4.2 Real data tests

We next tested JAMIE on real data (Supplementary Table S6). The
ﬁrst test involved three ChIP-chip datasets for detecting TFBSs of
OCT4, SOX2 and NANOG in human embryonic stem (ES) cells
(Boyer et (11., 2005). The second test contained four datasets for
locating binding sites of transcription factors Glil and Gli3 in
different developmental and pathological contexts. The third test
involved four datasets used to identify DNA binding of p130, E2F4,
LIN9 and LIN54 in G0 phase of the cell cycle (Litovchick et (11.,
2007). These four proteins are components of a p130 complex
termed DREAM. Data in the three tests were generated using Agilent
promoter arrays, Affymetrix mouse promoter 1.0R and Affymetrix
human promoter 1.0R arrays, respectively. They are referred to as
‘Agilent’, ‘Gli’ and ‘DREAM’ data hereafter. In all three tests, one
expects both common and TF- or context-speciﬁc binding sites.
Each dataset in the Agilent data contained two replicates, and each
dataset in the Gli and DREAM data contained three replicates.
The Agilent data had a low probe density, and the average probe
spacing was 250 bp. In the Gli and DREAM data, the average probe

spacing was 35 bp. A detailed description of the data collection and
preprocessing can be found in Supplementary Material C.

Since comprehensive lists of true binding sites for these real
datasets were unknown, we were unable to evaluate the FDR
estimates of different algorithms. For this reason, we focused on
comparing the peak rankings. For each test, we ﬁrst applied JAMIE
single, TileMap and MAT (if applicable) to each individual dataset.
For each dataset, a gold stande peak list was constructed by
collecting common peaks reported by all three algorithms at the
30% FDR cutoff. We then excluded one replicate from each dataset,
applied these algorithms to the reduced data and applied JAMIE-
pooling to jointly analyze all reduced datasets together. Figure 3
compares the accuracies of the peak detection results. Accuracy was
deﬁned as the percentage of top peaks overlapping with the gold
standard. For a dataset with N replicates, the test was performed
N times by excluding a different replicate from the analysis each
time. The ﬁgure compares the median performance. MAT cannot be
applied to Agilent arrays and was not included in the Agilent test.

Figure 3 shows that JAMIE pooling performed better than or
comparable to JAMIE single in almost all datasets, even though
the gold standard was constructed in a way that was in favor of
analyzing datasets separately. ‘LIN54_G0’ had the lowest signal-
to-noise ratio in the DREAM data (Litovchick et (11., 2007), and
substantial improvement was observed for this dataset. Similarly,
‘Gli1_Limb’ had the lowest signal-to-noise ratio in the Gli data
(Vokes et (11., 2008), and improvement in this dataset was bigger
than improvement observed in the other Gli datasets. Agilent arrays
had low probe density. Clear improvement was observed for all three
datasets in the Agilent data. Together, these reinforce the idea that
joint analysis can greatly improve peak detection when the noise
level is high or when the amount of information for peak detection
is limited. Figure 3 also shows that JAMIE pooling performed better
than TileMap and MAT.

Since the gold standard constructed by a particular algorithm
may bias the results in favor of that algorithm, in a second test,
each of the four algorithms was applied to the reduced data and
compared to the gold standard constructed by itself using the ﬁill
data. JAMIE pooling again provided the best performance in terms
of self-consistency (Supplementary Fig. S8).

The TFs involved in the tests have known DNA binding motifs.
We further compared different methods by enrichment of motifs in
their reported peaks. To avoid bias caused by peak lengths, all peaks
were truncated or extended to have the same length. This was done
by taking the highest point of each peak and extending it to both
ends by 500 bp. For each ranked peak list, the percentage of peaks
that contained at least one motif site was computed. Motif sites
were mapped using CisGenome (Ji et (11., 2008). The TRANSFAC
(Matys et (11., 2006) Oct4 and Gli motifs were used for analyzing the
Agilent data and Gli data, respectively. For the DREAM data, four
motifs E2F4, NRF2, CREB and n-MYC were previously shown to
be relevant (Litovchick et (11., 2007). All of them were used in the
analysis. Figure 4 shows the results for the Oct4 dataset from the
Agilent data, Gli1_Limb dataset from the Gli data and E2F4 motif
in LIN54_G0 dataset from the DREAM data. The comprehensive
results can be found in Supplementary Material D and Figures S9—
S14. The results show that peaks reported by JAMIE-pooling
generally had higher or comparable motif enrichment than peaks
reported by the other methods. For example, in the LIN54_G0
dataset, 39% out of the top 1000 peaks reported by JAMIE pooling

 

1 868

112 /3.Io's[Bumo[pJOJXO'sotwuiJOJutotqﬂ:duq 111011 p9p1201umoq

9103 ‘1g1sn8nv 110::

Joint analysis of multiple ChIP-chip data

 

Oct4

A
it)
v

30x2

 

100
I

8'0
m
z

\
1
‘1

1\

as

3.,“ . \
Igé‘1:§:§

% of correct detection
4'0 6'0

20

00
I

1

80

% of correct detection
60
ON
I
/

40
|
I
(n:
71
08*

100
I
I
i

80
I
I.

N”
/

 

40

-1- Pooling
-2- Single
_"3‘ TileMap

% of correct detection
60
|

 

20

 

5I0 I1E'I10 I 260 I 350 I 450I
top # of detected bumps
Gli1_Limb

A
5'
v

5I0 I 150 I 2in I 3.50 I 450 I
top # of detected bumps
Gli3_Limb

5an I 150 I 280 I 350 I 450 I
top # of detected bumps

Gli1_Med Gli1_GNP

 

100
MA

8'0
I.»
lya

% of correct detection
40 6'0
4‘9

100
I

20

80

% of correct detection
40 60

QLQLI-I-apa,arari.a

1
b
r
as
I'
on
r
at.
r
or.
I
an
100

3:1:

.‘k
V . \
I4- §5§Z§>§-
1;,
—1— Pooling
—2- Single
“3 TileMap
_14- MAT
N

80
80

Jim-I»
D
I

 

I
40
I

% of correct detectIon
40 6'0
% of correct detection
60
I

 

0
0

 

50 I 150 I 260 I 350 I 450 I
top # of detected bumps

100 I 300 I 500 I 700 I 900 I
top # of detected bumps
p130_GD

100 I 300 I 500 I 700 I 900 I
top # of detected bumps
LIN54_GO

100 I 300 I 500 I 700 I 900 I
top # of detected bumps
LIN9_GO

 

80

% of correct detection
40 6'0

 

20
I

 

 

20
I

80

% of correct detection
40 60

100
I.
I
u
1
m
'11
ID;
nae-4
7‘

I
5‘”.
’,
I.
/

 

00
I

1 00
I

1

n-a-a—avgrgrg,

3s
3*§?§

ﬁx —1— Pooling
\ —2- Single
“3 TileMap
3 \ ‘ 1 ‘4' MAT

80

 

80
I
.4s-1

 

I
40
I
an
aim»
.,.

% of correct detectlon
40 6'0
% of correct detection
60
I

 

 

 

 

 

1
4. 1

. 4-

3>g_
I

20
I
20

 

| I I I I | I I | I
100 300 500 700 900
top # of detected bumps

Fig. 3. Comparisons of peak detection accuracies of JAMIE pooling, JAMIE single, TileMap and MAT in real ChIP-chip data. X-axis is the number of

| I | I I | I I I I
100 300 500 700 900
top # of detected bumps

I I | I | I I
100 300 500 700 900
top # of detected bumps

I I | I I I I | I I
100 300 500 700 900
top # of detected bumps

top-ranked peaks. Y-axis is the average percentage of correct detections. The ﬁrst row shows the results for Agilent data, the second row is for Gli data and

the third row is for DREAM data.

 

 

 

 

 

 

 

 

 

 

(a) 01:14 (h) Gli1_Limb (c) LIN54_GO
o_ o_ o_
“=III =III 1 1 =III 1\\
.. .. \ I ..-
0'0- om— 1 cm. \ #1
Ev Ev a“ \1\ Est 4‘) 1 \1
§$-1\1 £84.51. _' 1 ﬁS-aa ~73 \1
g \1 ; '\g~-_--. “__2 g  ,s\
403-2.. 2 ing- 's '4 ‘~ 103' ' \-\
x 3 ‘~.2\ x \ 3-.,_~2 x 3. \.
mo_ ‘\ 1\ (“o_ 4'~.‘ '3 No_ -. .~
gm 72_-_1 gm 4-~.~ gm —1— Pooling- o,‘
w, -. ,..a., 2 m 4 W, -2— Single '3. ~32
\ - 3‘ \ - \ - - ‘- '~‘
°“‘ 3-....3 0‘“ °N--3 TIIeMap 43_ -=3
0_ °_ o_-4- MAT ‘-~.3
N | | | | | N | | | | | N | | | | |
100 200 300 400 500 so 120 180 240 300 200 400 600 800 1000
top # of peaks top # of peaks top # of peaks

Fig. 4. Comparisons of motif enrichment in top peaks detected by different algorithms. (3) Oct4 motif in Oct4 data, (b) Gli motif in Gill_Limb data and
(c) E2F4 motif in LIN54_GO data. X -axis is the number of top-ranked peaks. Y-axis is the percentage of peaks with at least one motif site.

contained the E2F4 motif. The percentage was 23% for JAMIE
single, 23% for MAT and 20% for TileMap.

5 DSCUSSON

In summary, we have introduced a novel hierarchical mixture model
for jointly analyzing multiple ChIP-chip datasets. The model was
implemented using an efﬁcient algorithm JAMIE. Our simulation
and real data analyses showed that by sharing information across
data, JAMIE can improve the analysis of multiple correlated ChIP-
chip datasets. The well-controlled comparison between JAMIE
pooling and JAMIE single showed that the improvement can
be consistently observed in different test data, and it can be
substantial in datasets with low signal-to-noise ratio. In our tests,

JAMIE was also compared with two other popular ChIP-chip peak
detection methods. Unlike the comparison between JAMIE pooling
and JAMIE single, these additional comparisons were less well-
controlled in the sense that the observed differences among these
algorithms could be attributed to a number of factors. Knowing how
much each factor contributes to the difference generally is difﬁcult.
As a result, these comparisons do not allow one to conclude that joint
data analysis is better than separate analysis. From this perspective,
the comparison between JAMIE pooling and JAMIE single is more
informative, as it is able to illustrate a generalizable design principle
that can be used to improve ﬁiture algorithm design.

In the past few years, a number of important design principles
have been developed for building good ChIP-chip data analysis
algorithms. For example, by using a probe-sequence-dependent

 

1869

112 /3.Io's[Bumo[pJOJXO'sotquJOJutotqﬂ:duq 111011 pop1201umoq

9103 ‘1g1sn8nv 110::

H. Wu and H.Ji

 

background correction model, MAT can remove systematic biases
in the background (Johnson et (11., 2006); using hundreds of publicly
available samples in GEO database, TileProbe (Judy and Ji, 2009)
allows one to ﬁirther remove residual probe effects that cannot be
explained by MAT; TileMap uses the variance shrinkage technique
to improve peak detection when only a limited number of replicates
are available (Ji and Wong, 2005); Mpeak shows that incorporating
peak shape can improve peak detection (Zheng et (11 ., 2007); various
hierarchical, mixture and/or latent stochastic models have been
shown to be useﬁil to model varying peak lengths, non-constant
probe spacing, probe outliers and correlation structures among
probes (Gottardo et (11., 2008; Johnson et (11., 2009; Keles, 2007).
The contribution of the current work is the addition of another design
principle as well as a model framework for implementing it to our
toolbox. Principles in our current toolbox provide basic building
blocks for assembling new algorithms for ﬁiture applications. By
carefully assembling them together, one could expect more powerful
algorithms to become available in future.

The hierarchical mixture model used by JAMIE is easily scalable
to a large number of datasets. Although our current description
of the model assumes that all datasets in the analysis are based
on the same tiling array platform, the model can be tailored to
accommodate data from different array platforms. Currently, JAMIE
is implemented for analyzing multiple ChIP-chip experiments.
With the rapid development of the next-generation sequencing
technologies, ChIP-seq (Johnson et (11., 2007) emerged as another
powerful approach for mapping TFBSs. Conceptually, by tailoring
the data generating distributions flid and fol-d to the tag count data,
the hierarchical mixture model used by JAMIE can be applied to
process ChIP-seq data as well. With the ability to analyze multiple
ChIP datasets jointly, the huge amount of genome-wide ChIP data
deposited in public databases could be reused to improve analysis
of new ChIP-chip and ChIP-seq experiments.

JAMIE is developed based on a number of model assumptions.
Successful application of this algorithm depends on how much
beneﬁt from using the model is compromised by violations of
the model assumptions. Our simulations and real data analyses
show that JAMIE is reasonably robust. Indeed, it provided better
peak ranking compared to the other algorithms even when the
assumptions were not perfectly satisﬁed. To avoid misleading results
caused by dramatic violations of the assumptions, in practice one can
analyze data using JAMIE and a few other peak detection algorithms
and compare their performance using methods similar to Figures 3
and 4.

The current implementation of JAMIE assumes that within a
PBR, whether a dataset contains an active binding site is a priori
independent of the other datasets, and the corresponding probability
ad is constant across all PBRs. In real data, some datasets are more
similar than others (e.g. Glil and Gli3 binding in limb tend to co-
occur more often than Glil binding in brain tissues GNP and Med).
This induces correlation between active binding events within a
PBR. How to model this more complex correlation structure is
an interesting topic for future research. In JAMIE, it is implicitly
assumed that the shape of peaks is rectangular. In reality, however,
peaks tend to have a triangle or bell shape, which has not been
incorporated into our model. Using this additional information can
potentially increase the detection power ﬁirther. How to incorporate
this information will be another topic for ﬁiture investigation.

ACKNOWLEDGEMENTS

The authors thank Dr Eunice Lee, Dr Matthew Scott and Dr
Wing H. Wong for providing the Gli data, Dr Rafael Irizarry for
providing ﬁnancial support, and Dr. Thomas A. Louis for insightful
discussions.

Funding: National Institute of Health [R01GM083084 to H]. (PI:
Irizarry), T32GM074906 to H.W.].

Conﬂict of Interest: none declared.

REFERENCES

Barrett,T. et al. (2009) NCBI GEO: archive for high-throughput functional genomic
data. Nucleic Acids Res. , 37, D57D15.

Bolstad,B.M. et al. (2003) A comparison of normalization methods for high density
oligonucleotide array data based on variance and bias. Bioinformatics, 19, 1857193.

Boyer,L.A. et al. (2005) Core transcriptional regulatory circuitry in human embryonic
stem cells. Cell, 122, 9477956.

Carroll,J.S. et al. (2005) Chromosome-wide mapping of estrogen receptor binding
reveals long-range regulation requiring the forkhead protein FoxAl. Cell, 122,
3343.

Cawley,S. et al. (2004) Unbiased mapping of transcription factor binding sites along
human chromosomes 21 and 22 points to widespread regulation of noncoding
RNAs. Cell, 116, 4997509.

Choi,H. et al. (2009) Hierarchical hidden Markov model with application to joint
analysis of ChIP-chip and ChIP-seq data, Bioinformatics, 25, 171571721.

Dempster,A.P. et al. (1977) Maximum likelihood from incomplete data via the EM
algorithm. J. R. Stat. Soc. B, 39, 1738.

Gottardo,R. et al. (2008) Aﬂexible and powerful Bayesian hierarchical model for ChIP-
chip experiments. Biometrics, 64, 468478.

Ji,H. and Wong,W.H. (2005) TileMap: create chromosomal map of tiling array
hybridizations. Bioinformatics, 21, 362973636.

Ji,H. et al. (2008) An integrated software system for analyzing ChIP-chip and ChIP-seq
data. Nat. Biotechnol, 26, 129371300.

Johnson,D.S. et al. (2007) Genome-wide mapping of in vivo protein-DNA interactions.
Science, 316, 149771502.

Johnson,D.S. et al. (2008) Systematic evaluation of variability in ChIP-chip experiments
using predeﬁned DNA targets, Genome Res., 18, 393403.

Johnson,W.E. et al. (2006) Model-based analysis of tiling-arrays for ChIP-chip.
Proc. Natl Acad. Sci. USA, 103, 12547712462.

Johnson,W.E. et al. (2009) Doubly stochastic continuous-time hidden Markov approach
for analyzing genome tiling arrays. Ann. Appl. Stat., 3, 118371203.

Judy,J.T. and Ji,H. (2009) TileProbe: modeling tiling array probe effects using publicly
available data. Bioinformatics, 25, 236972375.

Kapranov,P. et al. (2002) Large-Scale transcriptional activity in chromosomes 21 and
22. Science, 296, 9167919.

Keles,S. (2007) Mixture modeling for genome-wide localization of transcription factors.
Biometrics, 63, 1&21.

Lee,E.Y. et al. (2010) Hedgehog pathway-regulated gene networks in cerebellum
development and tumorigenesis. Proc. NatlAcad. Sci. USA, 107, 97369741.
Litovchick,L. et al. (2007) Evolutionarin conserved multisubunit RBL2/p130 and
E2F4 protein complex represses human cell cycle-dependent genes in quiescence.

Mol. Cell, 26, 5397551.

Matys,V. etal. (2006) TRANSFAC and its module TRANSCompel: transcriptional gene
regulation in eukaryotes. Nucleic Acids Res., 34, D1087D110.

Ren,B. et al. (2000) Genome-wide location and function of DNA binding proteins.
Science, 290, 230672309.

Toedling,J. et al. (2007) Ringo 7 an R/Bioconductor package for analyzing ChIP-chip
readouts. BM C Bioinformatics, 8, 221.

Vokes,S.A. et al. (2008) A genome-scale analysis of the cis-regulatory circuitry
underlying sonic hedgehog-mediated patterning of the mammalian limb. Genes
Dev., 19, 265172663.

Zhang,Z.D. et al. (2007) Tilescope: online analysis pipeline for high-density tiling
microarray data. Genome Biol., 8, R81.

Zheng,M. et al. (2007) ChIP-chip: data, model, and analysis, Biometrics, 63, 7877796.

 

1870

112 /310's112111n0fp101x0's01112111101u1010”:duq 111011 pop1201um0q

9103 ‘1g1sn8nv 110::

