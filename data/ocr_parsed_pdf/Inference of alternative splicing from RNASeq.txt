BIOINFORMA TICS

0'so;112u110}u101q//2duq

SIBumoprOJX

£10"

55,2\Ewowsmoddmmowoio~&o:~=£¢o~m\

L.H.LeGauIt and C.N.Dewey

 

application of PSGs to short RNA—Seq data, parameter estima—
tion for their models was trivial due to the use of only longer
ESTs that mapped uniquely to full—length isoforms. Chang et al.
(2005) also described the concept of a PSG, but did not use it in
their EST—based methods. Xing et al. (2006) used splice graphs
for EST analysis, but treated them simply as data structures with
which to enumerate all possible full—length isoforms of a gene
rather than as probabilistic models of isoform frequencies.

Non—probabilistic splice graphs have been used in the context
of RNA—Seq as well. For example, Montgomery et al. (2010)
summarized RNA—Seq data in terms of read coverage (‘ﬂux’)
of each edge in a splice graph and estimated abundances of
known full—length transcripts using a non—statistical Ll—mini—
mization formulation. Singh et al. (2011) also computed
observed read coverages for edges of a splice graph but instead
used these values to detect DP between samples using non—
parametric statistical tests. In contrast, our methods are based
on generative probabilistic models of both RNA—Seq data and
isoform frequencies with splice graph edges weighted by param—
eters representing RNA processing conditional probabilities.
These models enable us to use more powerful parametric statis—
tical techniques for both estimating isoform and processing event
frequencies and detecting DP genes between samples.

For the task of gene annotation, Rogers et al. (2012)
developed SpliceGrapher, which constructs splice graphs from
RNA—Seq and EST data. Our methods assume that the splice
graph structure is known and thus could work in tandem with
SpliceGrapher to infer both the structure and parameters of
PSGs.

The model of RNA—Seq read generation that we use is similar
to the models assumed by many other methods for transcript
quantiﬁcation (Bohnert et al., 2009; Jiang and Wong, 2009;
Katz et al., 2010; Li et al., 2010a; Nicolae et al., 2010; Richard
et al., 2010; Trapnell et al., 2010). The goal of these methods is
generally to estimate full—length isoform frequencies directly, and
thus they suffer in the face of the challenges we have described.
Others have focused on quantifying the frequencies of subcom—
ponents of isoforms, such as individual exons (Kakaradov et al.,
2012; Katz et al., 2010). In contrast to these methods, our
approach allows for frequency estimates at all levels simultan—
eously, from individual processing events to the exon and full—
length isoform levels.

1.2 Probabilistic splice graphs

PSGs are statistical extensions of splice graphs, data structures
that can compactly represent all isoforms of a gene and show the
structural relationships among them. The splice graph of a gene
was originally deﬁned by Heber et al. (2002) as a directed acyclic
graph, G = (V,E), with a vertex for each exonic genomic pos—
ition of the gene and an edge from vertex v to vertex u if the
corresponding genomic position of v immediately precedes that
of u in some isoform of the gene. Typically, one merges vertices v
and u if (v, u) e E and 0utdegree(v) = indegree(u) = 1. Thus, in
general, the vertices of a splice graph represent exonic segments
of a gene. The key property of a gene’s splice graph is that every
isoform of the gene corresponds to a path through the graph.
In this article, we use a splice graph definition similar to that of
Heber et al. (2002), but that differs in two respects. First, we

allow a single genomic position to correspond to multiple ver—
tices. For example, two vertices might represent the same exon
with slightly different donor or acceptor sites. Second, we require
that a splice graph has two additional vertices, representing the
start and end of an isoform. The start vertex has edges to each
possible transcription start site of a gene and the end vertex has
incoming edges from each possible polyadenylation site. The
start and end vertices are both associated with empty sequences
(i.e. they do not represent exonic segments). Because of the in—
clusion of these special vertices, edges of a splice graph represent
all classes of AP events.

Following the work of Chang et al. (2005) and Jenkins et al.
(2006), we deﬁne a PSG as a weighted splice graph in which each
edge is assigned a weight in [0, 1] and the weights of all edges out
of a vertex sum to one. The edge weights in a PSG represent
conditional probabilities of different AP events. The probability
of an isoform is defined as the product of the weights of the edges
along the path through the graph representing the isoform. Thus,
a PSG represents the relative abundances of the possible iso—
forms of a gene. The principal assumption of a PSG is that an
AP event at a given point along a path from the start vertex to
the end vertex is independent of AP events that occurred before
that point. PSGs are thus Markovian and model AP events as
occurring in a 5/73/ order, which is biologically motivated by the
fact that splicing can occur co—transcriptionally (Dye et al.,
2006). The independence statements assumed by a PSG allow
it to compactly specify the probabilities of all possible isoforms.

Many PSG structures can be used to model the set of isoforms
for a gene. For example, Figure 2 gives four PSGs that all rep—
resent the mouse gene Gfra4, which has seven possible isoforms
according to the UCSC Genes annotation (Hsu et al., 2006).
These different PSGs are closely related to the various forms
of splice graphs that have been used in splice graph databases
(Bollina et al., 2006). Like the splice graphs in these databases,
PSGs can vary in the number of isoforms they allow. In addition,
PSGs can vary in the family of probability distributions they
deﬁne over the set of isoforms.

The PSGs of Figure 2B and C are examples of PSGs for the
same gene that model different numbers of isoforms. Figure 2B is
a speciﬁc type of PSG that we will refer to as a line graph, fol—
lowing Bollina et al. (2006). This type of PSG is equivalent to the
‘pairwise model’ considered by Jenkins et al. (2006). A line graph
assumes independence between all compatible AP events.

The PSG of Figure 2C also belongs to a particular class of
PSGs that we will refer to as exon graphs. In a first order exon
graph, each exon is represented by a single vertex. In Bollina
et al. (2006), such a graph is simply referred to as a ‘splicing
graph’. Exon PSGs allow for dependencies between the AP
events at the ends of each exon. Figure 2C and D are examples
of PSGs that allow for the same set of isoform structures, but
that differ in the families of distributions they define over the
isoforms. Figure 2D is an example of a higher order exon graph,
which generally has multiple vertices representing a single exon,
and is analogous to a higher order Markov chain. In the most
extreme case, a PSG can represent each possible isoform as a
disjoint path through the graph (e.g. Fig. 2E). We refer to such
PSGs as unfactorized graphs. Unfactorized graphs have struc—
tures equivalent to what are commonly displayed in genome

 

2302

ﬁm'spzumofpmﬂo'sopeuuopuorq/ﬁdnq

:39\Ewowsmoaﬁmowoxmoagoﬁsambwﬁ

L.H.LeGauIt and C.N.Dewey

 

the full transcript path from which read n was derived; S”, the subpath of
T” from which read n is derived; and B”, the position in the sequence of
S,,.1 at which read n begins. Of these random variables, only R” is
observed. In addition, the latent PSG edge weights or 2 {off}? are also
treated as random variables. The joint probability distribution over the
random variables is

N
P(r, z, s, b, a) = 1‘1 Pails", mm", b" mm" la)P(a)

":1
Assuming no sequencing error, we have that

1 if (b,,,s,,) —> r,,

P(r"ls"’b") = { 0 otherwise

where (b,,,s,,) —> r,, denotes that r,, is the length L sequence starting at
position b” in the concatenation of sequences a“, l , . . . , mm. If sm m = M,
then the concatenated sequence also includes an inﬁnitely long sequence
of As, representing the poly(A) tail at the end of a typical eukaryotic
protein-coding transcript. We will often use the notation 71(r) to refer
to the set {(b,s) : (b, s) —> r}. In addition, we say that r is derived from
s if there exists some I; such that (b, s) —> r.

We assume that the position b”, at which a read begins, is uniformly
distributed across the length of the transcript from which it is derived.
Thus,

P(Smb"|t") =  s,, e t,,,b,, e [1,Exnll]
0 otherwise

We assume that the probability of generating a read from a speciﬁc
transcript, t,,, is proportional to the product of the relative frequency of
the transcript, w(t,,), and the length of the transcript:

Pom) = D(a)’1w(t,,)6(t,,)

where D(oi) = Z, w(t)l§(t), which is the expected length of a transcript
given the PSG. Finally, for each vertex i, we place a Dirichlet prior with
parameters )3,» = {ﬁg-L- on the weights of its out-edges. Speciﬁcally,

r(z_(ﬁi+1)) ﬂ

_ 1— i/

I’M—H Hun-+1) 11"”
j

l

2.3 Identifiability of the PSG RNA-Seq model

A PSG RNA-Seq model is more likely to be identiﬁable than a model
over all full-length isoforms implied by the PSG. In the Supplementary
Material, we state some general conditions under which a PSG is guar-
anteed to be identiﬁable. These conditions are generalizations of those for
the identiﬁability of full-length isoform models (Hiller et al., 2009;
Lacroix et al., 2008). Here we provide a simple set of speciﬁc conditions
that are sufﬁcient, but not necessary, for the identiﬁability of a PSG.

PROPOSITION 1. If for each edge (v, u) in a PSG at least one of the following
conditions is true, then the model is identifiable.

(1) There is a read that is uniquely derived from (v, u).
(2) There is a read that is uniquely derived from u and indegree(u) = l.

A proof of this proposition is provided in the Supplementary Material. It
provides an easy check for whether a PSG is identiﬁable: simply deter-
mine if each edge or its target vertex can produce a unique read. These
criteria are generally easier to satisfy than those required for the identiﬁa-
bility of full-length isoform models. For example, the PSG in Figure IE is
identiﬁable, even though a model of the full-length isoform frequencies is
not.

2.4 Edge weight estimation using EM

Given a set of aligned RNA-Seq data, we compute MAP estimates of the
PSG edge weights. When ﬁg- : 0,Vi, j, this is equivalent to computing
maximum likelihood (ML) estimates for the or values (treated as param-
eters). We use the EM algorithm to compute these estimates, as the prob-
ability P(oi|r) is difﬁcult to optimize directly. Brieﬂy, the E-step of the EM
algorithm involves computing the expected number of times each edge of
the PSG is used in a transcript from which a read is derived. The M-step
then sets or to maximize the joint probability given these expected counts.
The full details of the application of the EM algorithm to our model are
provided in the supplement. One detail of our algorithm that is critical to
its efﬁciency is our extensive use of the ﬂi, j), dp(i) and dq(i) values, which
are computed via dynamic programming. With these values precomputed
during each iteration of the E and M steps, these steps run in
0(|V|2 + |A||E|) and 0(|V| + |E|) time, respectively, where A is the set
of alignments of all reads. Similarly, the memory required by the
algorithm is 0(| V|2 + |A|). Without dynamic programming, the EM
algorithm would require time and memory proportional to the number
of possible full-length isoforms, which may be exponential in |V|.

2.5 Testing for DP

To test for DP of a gene between two samples we use a simple likelihood
ratio test. Given two read sets, R1 and R2, we compute the ML param-
eters, 6i] and (92, for the two sets separately, as well as the ML parameters,
(912, for the two sets combined. We test the null hypothesis that the par-
ameters for the two samples are the same by computing the ratio

P(R1 |&1)P(R2|&2)
P(R1 U Rip”)

and assigning a P-value using a x2 distribution with k degrees of freedom,
where k is the number of free parameters in the PSG. When predicting
DP genes across an entire genome, a P-value signiﬁcance threshold is
selected according to the BenjaminiiHochberg procedure for controlling
the false discovery rate.

We can additionally test for DP of an individual splice site or the
transcription start site using a similar technique. We select a single
vertex, v, and test the null hypothesis that the parameters for the out-
edges of that vertex are identical between the two samples with all other
edge weights possibly different. The alternative hypothesis is the same as
in the gene-level test. After estimating ML parameters for these two
hypotheses, we perform a likelihood ratio test with outdegree(v)—l
degrees of freedom.

2.6 Software

Our methods are implemented in a freely available software package
called PSGInfer. The software currently takes as input FASTA-formatted
genomic sequences, GTF-formatted transcript annotations and FASTQ-
formatted RNA-Seq data. PSGs may be provided directly in lieu of a
reference genome and annotation when, for example, a de no v0 transcrip-
tome assembly is used. For single samples, the software outputs estimates
of the frequencies of processing events and annotated full-length
isoforms. For pairs of samples, it outputs the results of the DP test on
each gene.

PSGInfer comprises three major scripts, psg_prepare_refer—
ence, psg_infer_frequencies and psg_infer_diff_proces—
sing. A typical workﬂow for using these scripts is depicted in
Supplementary Figure S1. The psg_prepare_reference script is re-
sponsible for constructing splice graphs from a set of known transcript
annotations. It can be conﬁgured to produce line, exon or higher-order
PSGs, such as depicted in Figure 2. The psg_infer_frequencies
script aligns a single RNA-Seq sample against a prepared set of splice
graphs using Bowtie (Langmead et al., 2009) and computes frequency

 

2304

ﬁm'spzumofpmjxo'sopeuuopnorq/ﬁdnq

Probabilistic splice graph models for RNA-Seq

 

estimates. Lastly, the psg_infer_dif f_processing script takes the
output of psg_infer_frequencies from two samples and reports
DP predictions.

3 RESULTS

We performed a variety of experiments on both simulated and
real RNA—Seq data to analyze the accuracy and performance of
our PSG methods. On simulated data, we first quantify the
theoretical advantage of our method over a more simplistic
JRibased method for estimating processing event frequencies.
On real Drosophila data, we compare the estimates from the
PSG and JR method and measure the improvement in the con—
vergence rates of our methods estimates with bootstrapping
experiments. We then evaluate the accuracy of our DP tests
through experiments on sets of real and simulated RNA—Seq
samples that include biological and technical replicates. Lastly,
with real data from the Drosophila gene Dscam, we demonstrate
the superior time complexity of using a factorized splice graph—
based method.

3.1 Comparison with a JR approach

The EM—based method we have described for estimating the
parameters of a PSG draws power from every alignable read in
an RNA—Seq dataset. That is, in our EM method, every read is
potentially informative about the frequencies of all AP events.
However, there are other more simplistic methods that may be
used to estimate the parameters of a PSG. In general, these
methods ignore some subset of the data and are thus less power—
ful than the EM method when the model assumptions hold.
One such approach is to consider only those reads that align
across edges (junctions) in the splice graph and to compute MAP
estimates of the edge parameters using the number of reads that
map to each edge. We will refer to this more simplistic strategy as
the JR approach. Although this method is simplistic and ignores
much of the data, it is statistically consistent under our RNA—Seq
model, with JR estimates converging to true parameter values as
the sample size becomes large. In addition, it is relatively robust
to violations of the assumptions made in our RNA—Seq model,
such as the assumption that the probability of a read being
generated by a transcript is proportional to that transcript’s
length. And while it is sensitive to non—uniformities around
individual junctions, it is not affected by biases in the read dis—
tributions elsewhere in the transcripts and the estimates at one
junction do not affect those at other more distant junctions.
An article published during the revisions of this manuscript
demonstrated that a JR approach can provide more accurate
estimates than more sophisticated methods that use reads map—
ping to exon bodies (Kakaradov et al., 2012). For example, Katz
et al. (2010) describe a method (\i’SJ) that uses reads mapping to
exon bodies immediately ﬂanking a junction, in addition to reads
mapping to the junction itself. As this method is only appropriate
for certain types of alternative splicing events (e. g. cassette exon
inclusion), we do not consider it here. In addition, we expect that
the $5] method would provide comparable estimates to that of
our EM method for AP events such as cassette exons, as the two
methods make similar use of the data in these situations.
Therefore, we focus on comparisons with the JR method,

which can provide estimates for all AP events, with the exception
of alternative transcription start site events, which do not involve
a junction.

3.1.1 Comparisons on simulated data We first sought to quan—
tify the theoretical advantage of our EM method over that of the
JR approach using data simulated according to our model, as
was similarly done in Katz et al. (2010). Of course, these experi—
ments represent the best—case scenario for the EM method, as the
data perfectly fit the model that the EM method uses to gain
power. Nevertheless, these experiments allow us to quantify the
size of the improvement in the accuracy of the EM estimates over
those of JR when the model assumptions hold.

For our simulations, we used protein—coding Drosophila genes
from the FlyBase v5.12 (Smith et al., 2007) annotation, each
containing a single cassette exon. To capture a range of
scenarios, we ordered all such genes by the lengths of their cas—
sette exons and selected the three genes at the quartiles of this
distribution. We simulated single—end reads of length 100 from
the genes, each of which can be represented generically by the
gene model shown in Supplementary Figure S2A. JR and EM
were used to estimate the one parameter of the line PSG for this
gene on simulated read sets varying in size from 10 to 10000
reads, with 500 simulations per read set size. For both methods,
we used a pseudocount of one (ﬂ = 1 for EM) for the splice
junctions, which helps to control the variance of the estimates
on small datasets. As expected, owing to the fact that EM ex—
tracts more information from the data than JR, the EM esti—
mates converge more quickly to the truth and exhibit less
variance than those of JR (Supplementary Fig. S2B). The advan—
tage of EM over JR is most pronounced for read set sizes < 1000
and for the gene with the longest cassette exon (s—eup), as EM
gains information from reads that map to the body of that exon.
Simulations with paired—end reads gave similar results, with
both methods beneﬁtting from paired—end data (Supplementary
Fig. S3).

3.1.2 Comparisons on real data We next compared the
estimates of the EM and JR methods on a real set of
Drosophila RNA—Seq data to assess the impact of the model
assumptions used by EM. Here we assumed that the more
robust JR estimates are accurate when a large number of reads
are available. We used RNA—Seq data from the Drosophila cell
line CME—W1—Cl.8+ (SRA accession SRS002587) (Cherbas
et al., 2011), which consists of B 14 million pairs of reads, each
37 bases long. Gene annotations were obtained by selecting all
protein—coding genes of FlyBase v5.12 and preprocessing using
Cufflink’s cuffcompare program. We used Bowtie (Langmead
et al., 2009) to align the reads against the sequences of the line
PSGs constructed from these annotations and selected all 88
genes that (i) included at least one AP event and (ii) had more
than 5000 read pairs mapped to it.

The line PSG parameters for each of these genes were esti—
mated using JR and EM. For each vertex with outdegree 32,
we computed the distance between the probabilities of its out—
edges by taking the maximum of the absolute difference between
the estimates on each edge (inﬁnity norm). Figure 3 gives the
distributions of these distances between EM and JR estimates for
both single and paired—end reads (Supplementary Fig. S4 gives

 

2305

ﬁm'spzumofpmjxo'sopeuHOJmorq/ﬁdnq

L.H.LeGauIt and C.N.Dewey

 

Number of vertices
0 20 4O 60 80

 

| Single EMvJR I Paired EMvJR
||||||||||||

0.0 0.2 0.4 0.6 0.8 1.00.0 0.2 0.4 0.6 0.8 1.0
Maximum difference between edge probabilities

Fig. 3. Distributions of the differences between the parameter estimates
of EM and JR from single and paired-end data

the plots for comparisons between estimates from the same
method on single and paired—end reads). We also examined
how often the estimates at each vertex agreed in terms of
which AP event following that vertex was most likely. EM and
JR agreed with respect to this measure on 84 and 81% of the
vertices for single and paired—end estimates, respectively. The
single—end and paired—end estimates agreed with each other on
95 and 93% of vertices for EM and JR, respectively. These
results indicate that the EM estimates are highly accurate on
average, assuming that the JR estimates are close to the truth.
This suggests that the model assumptions used by EM are
reasonable, at least on this dataset. The differences observed be—
tween the estimates of the same method on single and paired—end
data show that many of the discrepancies between the methods
arise simply because they draw information from different sub—
sets of the data. The remaining discrepancies may be the result of
highly biased read distributions or incorrectly annotated gene
structures.

We further explored the validity of the independence assump—
tions made by the line PSGs in these experiments by additionally
computing estimates of the AP event frequencies with ﬁrst—order
exon and unfactorized PSGs for these genes. As is shown in
Supplementary Figure S5, the estimates from the line, first—
order exon and unfactorized PSGs are all similar in terms of
their distances from the reference JR estimates. Thus, the inde—
pendence assumptions made by the line PSGs do not appear to
affect the accuracy of the AP frequency estimates for this dataset.
This experiment also shows that AP frequency estimates from
factorized PSGs are comparable with those estimated from full—
length isoform models, as the unfactorized PSGs are equivalent
to such models.

We additionally assessed the convergence rates of JR and EM
through bootstrapping experiments on these data. For each of
the selected 88 genes, we generated a series of bootstrapped read
samples from its full read set. We generated read samples of sizes
ranging from 10 to 5000, with 100 samples per read set size. On
each read sample we estimated the line PSG parameters with
both JR and EM and calculated the distance between each meth—
ods estimates and its estimates on the full read set. Mean dis—
tances were computed for each read set size and a further mean
was taken over all vertices (Fig. 4). As expected, the distances
approach zero as the read set size increases, EM estimates con—
verge faster than those of JR and estimates from paired—end data
converge the fastest. EM with single—end data converges about as

 

 

 

v
o'— -0- Single EM
3 —A— SingleJR
i -i— Paired EM
: -x— PairedJR
8 <0._
5 o
m
_l
"O
m
m
a:
_' N
<7: 0'—
E
E
“5
O
C
S "._
1’ O
o
C
m
a:
E
o
d_

 

 

 

| | | | | |
10 50 100 500 1k 5k

Size of Read Set

Fig. 4. The mean distances of parameter estimates on bootstrap samples
from those on the full read set as a function of the bootstrapped read
sample size. All differences between pairs of methods at each read set size
are significant (P< 0.05, sign test) except for that between Single EM and
Paired JR for read set size = 10

quickly as JR with paired—end data, suggesting that for this
dataset, EM is extracting about twice as much information
from the data as JR.

3.2 Evaluation of DP calls

We evaluated the performance of our PSG—based DP test by
applying it genome—wide on four sets of RNA—Seq samples:
three real and one simulated. The four sets were five
modENCODE Drosophila samples (Cherbas et al., 2011), four
human samples from HapMap individuals (Montgomery et al.,
2010), four human cell line samples from the ENCODE project
(The ENCODE Project Consortium, 2011) and four samples
simulated using parameters learned from the ENCODE
human samples. The real sets were selected because they were
publicly available, contained paired—end data, which beneﬁt DP
analyses and contained either biological or technical replicates.
Beyond these criteria, the sets we have presented were chosen
arbitrarily and a priori. Details of these sets are provided in the
supplement.

Using first—order exon PSGs, we applied our DP test to all
pairs of samples within each set to assess its FP and TP rates.
We expected that an accurate DP test should call few genes as
DP between replicates and a modest number of genes as DP
between non—replicate samples. For comparison, we also applied
FDM (Singh et al., 2011) and Cuffdiff2 (Trapnell et al., 2013) to
these datasets. The parameters and annotations used to run the
PSG, FDM and Cuffdiff DP tests are described in the supple—
ment. The target false discovery rate, as determined by the
BenjaminiiHochberg procedure, was set to 0.05 for all methods.
We tallied the number of genes called as DP between each pair of
samples for each method individually as well as the number of

 

2306

/810'sleum0prOJxo'sopBLuJOJuioiqﬂ:duq

Probabilistic splice graph models for RNA-Seq

 

Table 1. The number of DP genes called by the PSG test, FDM, Cuffdiff and combinations of the methods on pairs of samples from three sets:

(A) HapMap, (B) Drosophila modENCODE and (C) ENCODE

 

 

 

 

Sample 1 Sample 2 PSG FDM Cuffdiff PSG ﬂ FDM PSG ﬂ Cuffdiff FDM ﬂ Cuffdiff All
(A)
CEU Rep 1 CEU Rep 2 0 0 1187 0 0 0 0
CEU Rep 1 Yoruban Rep 1 39 24 269 2 8 3 1
CEU Rep 1 Yoruban Rep 2 46 24 282 3 5 3 1
CEU Rep 2 Yoruban Rep 1 45 22 253 4 5 1 1
CEU Rep 2 Yoruban Rep 2 38 29 260 2 4 4 1
Yoruban Rep 1 Yoruban Rep 2 0 0 1253 0 0 0 0
(B)
CME_W1_CI.8+ Rep 1 CME_W1_CI.8+ Rep 2 16 32 204 1 0 2 0
CME_W1_C1.8+ Rep 1 Kc167 365 207 7 75 2 0 0
CME_W1_C1.8+ Rep 1 ML-DmBG3-c2 232 164 6 46 1 1 0
CME_W1_C1.8+ Rep 1 S2-DRSC 406 228 12 86 6 1 1
CME_W1_C1.8+ Rep 2 Kc167 319 211 16 72 4 3 1
CME_W1_C1.8+ Rep 2 ML-DmBG3-c2 260 126 16 37 2 1 1
CME_W1_C1.8+ Rep 2 S2-DRSC 353 220 17 71 5 1 1
Kc167 ML-DmBG3-c2 384 321 12 93 2 1 1
Kc167 S2-DRSC 419 209 12 88 6 2 1
ML-DmBG3-c2 S2-DRSC 431 287 4 110 3 1 1
(C)
HUVEC Rep 1 HUVEC Rep 2 35 43 440 6 2 4 1
HUVEC Rep 1 K562 Rep 1 376 344 8 113 2 0 0
HUVEC Rep 1 K562 Rep 2 379 302 12 81 6 2 2
HUVEC Rep 2 K562 Rep 1 442 382 8 144 4 3 3
HUVEC Rep 2 K562 Rep 2 355 285 10 80 3 2 2
K562 Rep 1 K562 Rep 2 224 308 168 39 8 8 1

 

Note: Pairs of samples that are technical or biological replicates are indicated in bold.

genes called as DP by multiple methods. Lists of the genes called
as DP are provided on our software’s Web site.

Table 1 summarizes the results for the DP analyses on the
three real datasets. Remarkably, the PSG test calls few genes
as DP between the biological and technical replicates in the ﬂy
and HapMap datasets, indicating a low FP rate on these sets. At
the same time, the test calls a modest number of genes as DP
between non—replicate samples in these sets, suggesting that its
low positive rate does not come at the expense of predicting TPs.
On the ENCODE set, the number of DP calls between the
replicate samples is also lower than that between the non—repli—
cates. However, the FP rate is much higher for this set, particu—
larly for the K562 replicates. This suggests that the ENCODE
samples are more heterogeneous, perhaps owing to higher biolo—
gical or sample preparation variability. One difference between
the ENCODE samples and the others is that the read length is
more than twice as long in the ENCODE samples. However,
through an experiment in which we reran the DP tests with the
ENCODE reads trimmed to match the read lengths in the other
sets, we did not find this to be the cause of the larger numbers of
PSG DP calls for these samples (Supplementary Table S1).

The FDM method performed similarly to our PSG DP
method, generally reporting fewer DP genes between replicates
than between non—replicates. However, for all sample sets in
Table 1, the PSG method reports more DP genes between

non—replicate samples than FDM, while at the same time report—
ing smaller numbers of DP genes between replicate samples than
FDM (except for in the HapMap set where both methods report
zero DP genes between replicates). This result suggests that the
PSG test has a higher TP rate and a lower FP rate than FDM.
Surprisingly, of the genes called DP by either PSG or FDM, only
a small fraction are called by both methods. The fraction shared
is smallest for the replicate pairs of samples, which is expected
given that all of the DP calls on these pairs are FPs. We hypothe—
size that the small overlap of the DP calls on the non—replicate
pairs is owing to the fact that the two methods are different: our
PSG DP method is a parametric test based on a generative model
of the read data, whereas FDM is a non—parametric test that acts
on read coverage levels. Also of note are the numbers of FDM
DP genes for the trimmed ENCODE set (Supplementary
Table S1), which are much smaller than those for the untrimmed
set. We believe this occurs because the trimming of reads reduces
read coverage levels, which are used by FDM.

Cuffdiff, on the other hand, had odd behavior in these experi—
ments, as it called large numbers of genes as DP between repli—
cates and a small number as DP between non—replicates. After
discussing these results with the authors of Cuffdiff, we believe
that they are explained by the combination of Cuffdiff accurately
estimating low global processing variability between the replicate
samples but then having highly noisy estimates of isoform

 

2307

ﬁm'spzumol‘pmjxo'sopeuuopnorq/ﬁdnq

L.H.LeGauIt and C.N.Dewey

 

frequencies for a subset of genes, particularly those that have
multiple highly similar isoforms. When Cuffdiff is given a pair
of non—replicate samples, it estimates higher levels of global vari—
ability and thus the effect of noisy isoform frequency estimates is
diminished. This explanation ﬁts with the general trend observed
in the results in which the lower the variability between the sam—
ples, the larger the number of genes predicted as DP by Cuffdiff.
Although Cuffdiff was originally used in an experiment without
replicates (Trapnell et al., 2010), during the revisions of this art—
icle, the authors of Cuffdiff began advising its users through its
Web site to not use its DP tests with fewer than three replicates
per condition, likely owing to issues such as the one we have
observed here.

The performance of the three methods on the simulated
dataset was similar to that on the real datasets (Supplementary
Table S2). In this dataset, four samples were simulated with two
biological replicates for each of two conditions (A and B). Each
sample was simulated with separate parameter settings estimated
from one of the four real human ENCODE samples (e.g. the
simulation parameters for A Rep 1 were estimated from HUVEC
Rep 1). Within replicates of the same condition, the relative
isoform frequencies were set to be identical. We note that the
gene—level abundances were different across all samples, even if
the relative isoform frequencies were the same. Between condi—
tions, 10% of multi—isoform genes expressed in both conditions
were set to be DP, with isoform frequencies randomly shufﬂed
between the two conditions for these genes.

Because we knew the true set of DP genes between the two
conditions, we were able to measure the recall and precision of
the methods on pairs of samples from different conditions, in
addition to the number of FPs measured on pairs of samples
from the same condition. The PSG DP method exhibited good
FDR control with a precision of 0.934195 and had the highest
recalls (0.5H.60) of the three methods. Although Cuffdiff dis—
played the same high FP behavior between pairs of replicate
samples, it had reasonable precision (0.884198) between non—
replicate samples but with lower recall (01170.13). FDM had
moderate recall (0.24039) but poor precision (0430.51).
Precision—recall curves constructed by varying the P—value thresh—
old required for calling a gene as DP further demonstrated that
the PSG method’s performance dominated that of FDM and
Cuffdiff on this simulated dataset (Supplementary Fig. S6).

Because Cuffdiff and FDM are able to take into account mul—
tiple biological replicates per condition, we additionally per—
formed an A versus B DP test in which all replicates were
provided to the methods at the same time. Cuffdiff s recall im—
proved noticeably with this test, although with a slight decrease
in precision (Supplementary Table S3). FDM, on the other hand,
did not predict any DP genes with this test, which was the result
of the highly conservative permutation test it uses when multiple
replicates are provided. However, in terms of its precision—recall
curve performance, FDM improved slightly at the high precision
end of the curve, as compared with its performance with no
replication (Supplementary Fig. S7). Despite only taking into
account pairs of samples, the average accuracy of the PSG
method between non—replicate pairs was superior to the accuracy
of both Cuffdiff and FDM when these methods were provided
with multiple biological replicates (Supplementary Table S3 and
Supplementary Fig. S7).

One implementation detail that sets our PSG methods apart
from Cuffdiff and FDM is that our PSG methods align RNA—
Seq reads to transcript subsequences, whereas Cuffdiff and FDM
accept genomic alignments. Although we used standard align—
ment options for our genomic alignments using TopHat
(Trapnell et al., 2009), we observed that the TopHat alignments
generally had fewer aligned reads than the transcript alignments
used by our PSG methods. To test if this factored into the per—
formance differences on the simulated data, we additionally con—
structed a set of genomic alignments by aligning ﬁrst to the
annotated transcript sequences and then transforming to gen—
omic coordinates. Running Cuffdiff and FDM with these align—
ments somewhat decreased FPs on the replicate pair tests, but
did not markedly change recall and precision on the non—repli—
cate pair tests with a target FDR of 0.05 (Supplementary
Table S2 and Supplementary Fig. S6). Even with more compar—
able alignment inputs, the PSG method outperformed FDM and
Cuffdiff on these data.

3.3 Efﬁciency of computation with an exon graph PSG

One advantage of the PSG approach is that inference can be
more efﬁcient, particularly for genes with many isoforms. Even
if a gene has an exponential number (in terms of the number of
exonic segments) of isoforms, a compact PSG model of the gene
can enable polynomial—time inference of the model parameters.
Although factorized PSGs only indirectly model the abundances
of individual isoforms, they enable an efficient alternative for
quantiﬁcation.

To demonstrate these theoretical efﬁciency gains, we at—
tempted to perform inference with the Drosophila gene Dscam,
which is capable of producing tens of thousands of isoforms
(Schmucker et al., 2000). For this experiment, we used all read
pairs (184) that mapped to Dseam from the CME_W1_Cl.8+
Rep 1 sample analyzed in the previous section. Estimation of
the 74 free parameters of the ﬁrst—order exon graph PSG from
this dataset required less than 3 s of computation. We then con—
structed a reference annotation set of all 23 976 possible isoforms
(equivalent to the unfactorized version of the exon graph PSG)
of Dseam for use with the quantiﬁcation—only mode of Cufﬂinks
(Trapnell et al., 2010). A run of Cufﬂinks on this dataset required
>90 GB of RAM and did not complete within 6h. This experi—
ment indicates that as the number of annotated splice variants
for each gene grows, quantiﬁcation methods that explicitly
model the abundance of each isoform will not be computation—
ally feasible. We note that with current gene annotation sets,
which are not complete in terms of representing all possible iso—
forms for each gene, Cuﬂlinks and our PSG method require a
comparable amount of time. For example, with the simulated
human dataset and comparable alignments from the previous
section, both the PSG and Cufﬂinks methods required 840
min per pair of samples (the PSG method additionally required
830 min of preprocessing time per individual sample) on a 12—
core, 800 Mhz Linux server.

4 DISCUSSION

In this article, we have demonstrated the utility of PSG RNA—
Seq models for analyzing AP of gene transcripts. Whereas splice

 

2308

ﬁm'spzumol‘pmjxo'sopeuuopnorq/ﬁdnq

Probabilistic splice graph models for RNA-Seq

 

graphs provide efﬁcient structural representations of the possible
isoforms of a gene, PSGs allow for compact statistical models of
the relative frequencies of these isoforms. Because of their fac—
torized nature, PSG models are more likely to be identiﬁable
than full—length isoform models and we have provided some
simple criteria wherein this is the case. In addition to being
more identifiable, PSG models allow for efficient inference of
event frequencies, even for genes with an exponential number
of potential isoforms. Through our computational experiments
with simulated and real data, we have conﬁrmed that the event
frequency estimates of the PSG model are accurate and converge
more quickly than those of simpler JR approaches, as is theor—
etically expected. Lastly, we have shown that our DP tests
achieve remarkably low FP rates on several real datasets and
superior accuracy on simulated data.

Although the results of our DP experiments are promising for
PSG—based tests, the lack of overlap between the predictions of
the three compared methods is somewhat alarming. For
example, on the ﬂy non—replicate sample pairs, on average,
only 21% of PSG DP predictions are shared with FDM. Our
DP simulation experiment suggests that much of this lack of
overlap is because of poor precision and recall by the other
methods. However, large methodological differences may also
be a factor here.

A limitation of our PSG—based DP test is that it is only
designed to detect differences in the AP event frequencies be—
tween two samples and is unable to determine whether any
such differences are biologically signiﬁcant. This fact may ex—
plain our test’s poor performance on the K562 samples, which
are likely to be highly variable. To determine if DP—called genes
are biologically signiﬁcant, one needs to use multiple biological
replicates per condition (Hansen et al., 2011). Currently, unlike
FDM and Cuffdiff, our method cannot use replicates to assess
biological variability. In addition, our methods do not currently
model biases in RNA—Seq data, and therefore they are not suit—
able for comparing datasets generated by different protocols.
Nevertheless, our methods strong performance in distinguishing
between replicate and non—replicate samples in the ﬂy and
HapMap datasets suggests that it is a good base method to be
extended with models of biological variation and protocol bias.
In addition, our simulations suggest that our PSG method can
produce more accurate DP predictions than those from Cuffdiff
and FDM, even when these methods are provided with multiple
replicates per condition.

A major task that we have not addressed in this work is that of
determining the best PSG structure for a gene. This task has two
components: (i) identifying the exonic sequences, splice junctions,
transcription start sites and polyadenylation sites of a gene, and
(ii) determining the statistical dependencies between AP events.
The ﬁrst task is currently an active area of RNA—Seq research
involving splice junction detection methods [e.g. Trapnell et al.
(2009)], and reference—based (Guttman et al., 2010; Rogers et al.,
2012; Trapnell et al., 2010) and de novo transcriptome assembly
(Grabherr et al., 2011; Robertson et al., 2010). The latter task
can be thought of as a model selection problem, for which the
statistical machinery we have presented should be invaluable.

In addition to the learning of PSG structures, our future work
includes several extensions to our current model. First, we plan
to modify the model to include sequencing biases, which have

been demonstrated to signiﬁcantly impact quantification from
RNA—Seq data (Hansen et al., 2010; Li et al., 2010b; Roberts
et al., 2011). Second, we plan to implement a hierarchical
Bayesian version of our model to properly handle the detection
of DP with multiple biological replicates.

ACKNOWLEDGEMENTS

We thank Bo Li for discussions regarding the EM algorithm,
Steve Mount for the suggestion of analyzing the gene Dscam,
Cole Trapnell and Lior Pachter for a discussion of Cuffdiff, and
three anonymous reviewers for their constructive comments.

Funding: National Institutes of Health (HG005232 to L.H.L. and
C.N.D.).

Conﬂict of Interest: none declared.

REFERENCES

B0hnert,R. et a]. (2009) Transcript quantiﬁcation with RNA—Seq data. BMC
Bioiip’ormatics, 10 (Suppl. 13), P5.

Bollina,D. et a]. (2006) ASGS: an alternative splicing graph web service. Nucleic
Acids Res., 34, W44¢W447.

Chang,H. et a]. (2005) The application of alternative splicing graphs in quantitative
analysis of alternative splicing form from EST database. Int. J. Comput. App].
Technol., 22, 1422.

Cherbas,L. et a]. (2011) The transcriptional diversity of 25 Drosophila cell lines.
Genome Res., 21, 3017314.

Dye,M.J. et a]. (2006) Exon tethering in transcription by RNA polymerase II.
Mol. Cell, 21, 8494559.

Emerick,M.C. et a]. (2006) Proﬁling the array of Ca(v)3.1 variants from the human
T—type calcium channel gene CACNAlG: alternative structures, developmental
expression, and biophysical variations. Proteins, 64, 32(k342.

Fededa,J.P. et a]. (2005) A polar mechanism coordinates different regions of alter—
native splicing within a single gene. Mol. Cell, 19, 3937404.

Grabherr,M.G. et a]. (2011) Full—length transcriptome assembly from RNA—Seq
data without a reference genome. Nat. Biotechnol., 29, 644$52.

Graveley,B.R. et a]. (2011) The developmental transcriptome of Drosophila mela—
nogaster. Nature, 471, 4737479.

Guttman,M. et a]. (2010) Ab initio reconstruction of cell type—speciﬁc transcrip—
tomes in mouse reveals the conserved multi—exonic structure of lincRNAs.
Nat. Biotechnol., 28, 5037510.

Hansen,K.D. et a]. (2010) Biases in Illumina transcriptome sequencing caused by
random hexamer priming. Nucleic Acids Res., 38, e131.

Hansen,K.D. et a]. (2011) Sequencing technology does not eliminate biological
variability. Nat. Biotechnol., 29, 5727573.

Heber,S. et a]. (2002) Splicing graphs and EST assembly problem. Bioinformutics, 18
(Suppl. 1), 518175188.

Hiller,D. et a]. (2009) Identiﬁability of isoform deconvolution from junction arrays
and RNA—Seq. Bioinformatics, 25, 305G305).

Hsu,F. et a]. (2006) The UCSC known genes. Bioinformutics, 22, 103671046.

Jenkins,P. et a]. (2006) How many transcripts does it take to reconstruct the Splice
Graph? Algorithms Bioinform., 4175, 1037114.

Jiang,H. and Wong,W.H. (2009) Statistical inferences for isoform expression in
RNA—Seq. Bioinformatics, 25, 102671032.

Kakaradov,B. et a]. (2012) Challenges in estimating percent inclusion of alternatively
spliced junctions from RNA—seq data. BMC Bioim’ormatics, 13 (Suppl. 6), $11.

Katz,Y. et a]. (2010) Analysis and design of RNA sequencing experiments for iden—
tifying isoform regulation. Nat. Methods, 7, 100971015.

Lacroix,V. et a]. (2008) Exact transcriptome reconstruction from short sequence
reads. Algorithms Bioinform., 5251, 50—63.

Langmead,B. et a]. (2009) Ultrafast and memory—efﬁcient alignment of short DNA
sequences to the human genome. Genome Biol, 10, R25.

Li,B. et al. (2010a) RNA—Seq gene expression estimation with read mapping uncer—
tainty. Bioinformatics, 26, 4937500.

Li,J. et al. (2010b) Modeling non—uniformity in short—read rates in RNA—Seq data.
Genome Biol., 11, R50.

 

2309

ﬁre'spzumol‘pmjxo'sopeuuopnorq/ﬁdnq

L.H.LeGauIt and C.N.Dewey

 

Li,J.J. et al. (2011a) Sparse linear modeling of next—generation mRNA sequencing
(RNA—Seq) data for isoform discovery and abundance estimation. Proc. Natl
Acad. Sci. USA, 108, 19867719872.

Li,W. et al. (2011b) Isolxrsso: a LASSO regression approach to RNA—Seq based
transcriptome assembly. In: Research in Computational Molecular Biology.
Springer, Berlin Heidelberg, pp. 1687188.

Matlin,A.J. et al. (2005) Understanding alternative splicing: towards a cellular code.
Nat. Rev. Mol. Cell Biol., 6, 3867398.

Montgomery,S.B. et al. (2010) Transcriptome genetics using second generation
sequencing in a caucasian population. Nature, 464, 7737777.

Neves,G. et al. (2004) Stochastic yet biased expression of multiple Dscam splice
variants by individual cells. Nat. Genet., 36, 2407246.

Nicolae,M. et al. (2010) Estimation of alternative splicing isoform frequencies from
RNA—Seq data. In: Moulton,V. and Singh,M. (eds) Algorithms in
Bioinformatics, Lecture Notes in Computer Science. Vol. 6293, Springer Berlin,
Heidelberg, pp. 2027214.

Richard,H. et al. (2010) Prediction of alternative isoforms from exon expression
levels in RNA—Seq experiments. Nucleic Acids Res., 38, e112.

Roberts,A. et al. (2011) Improving RNA—Seq expression estimates by correcting for
fragment bias. Genome Biol., 12, R22.

Robertson,G. et al. (2010) De novo assembly and analysis of RNA—seq data. Nat.
Methods, 7, 9097912.

Rogers,M.F. et al. (2012) SpliceGrapher: detecting patterns of alternative splicing
from RNA—seq data in the context of gene models and EST data. Genome Biol.,
13, R4.

Schmucker,D. et al. (2000) Drosophila Dscam is an axon guidance receptor exhibit—
ing extraordinary molecular diversity. Cell, 101, 6717684.

Singh,D. et al. (2011) FDM: a graph—based statistical method to
detect differential transcription using RNA—seq data. Bioinformatics, 27,
263372640.

Smith,C.D. et al. (2007) The Release 5.1 annotation of Drosophila melanogaster
heterochromatin. Science, 316, 158G159].

The ENCODE Project Consortium. (2011) A user’s guide to the encyclopedia of
DNA elements (ENCODE). PLoS Biol., 9, e1001046.

Trapnell,C. et al. (2009) TopHat: discovering splice junctions with RNA—Seq.
Bioinformatics, 25, 110571111.

Trapnell,C. et al. (2010) Transcript assembly and quantiﬁcation by RNA—Seq re—
veals unannotated transcripts and isoform switching during cell differentiation.
Nat. Biotechnol., 28, 5117515.

Trapnell,C. et al. (2013) Differential analysis of gene regulation at transcript reso—
lution with RNA—seq. Nat. Biotechnol., 31, 4&53.

Wang,E.T. et al. (2008) Alternative isoform regulation in human tissue transcrip—
tomes. Nature, 456, 4704176.

Wang,Z. et al. (2009) RNA—Seq: a revolutionary tool for transcriptomics. Nat. Rev.
Genet., 10, 57$3.

Xia,Z. et al. (2011) NSMAP: a method for spliced isoforms identiﬁcation and quan—
tiﬁcation from RNA—Seq. BMC Bioinform, 12, 162.

Xing,Y. et al. (2006) An expecmtion—maximization algorithm for probabilistic re—
constructions of full—length isoforms from splice graphs. Nucleic Acids Res., 34,
315073160.

 

2310

ﬁre'spzumol‘pmjxo'sopeuuqurorq/pdnq

