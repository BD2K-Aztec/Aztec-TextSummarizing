ORIGINAL PAPER

Vol. 29 no. 10 2013, pages 1275-1282
doi:1 0. 1093/bioinfonnatics/btt143

 

Gene expression

Advance Access publication April 14, 2013

Shrinkage estimation of dispersion in Negative Binomial models
for RNA-seq experiments with small sample size

Danni Yu1'2, Wolfgang Huber1 and Olga Vite

k2,3,*

1Genome Biology Unit, European Molecular Biology Laboratory, MayerhofstraBe 1, Heidelberg 69117, Germany
2Department of Statistics and 3Department of Computer Science, Purdue University, West Lafayette, IN 47907, USA

Associate Editor: lnanc Birol

 

ABSTRACT

Motivation: RNA-seq experiments produce digital counts of reads
that are affected by both biological and technical variation. To distin-
guish the systematic changes in expression between conditions from
noise, the counts are frequently modeled by the Negative Binomial
distribution. However, in experiments with small sample size, the
per-gene estimates of the dispersion parameter are unreliable.
Method: We propose a simple and effective approach for estimating
the dispersions. First, we obtain the initial estimates for each gene
using the method of moments. Second, the estimates are regularized,
i.e. shrunk towards a common value that minimizes the average
squared difference between the initial estimates and the shrinkage
estimates. The approach does not require extra modeling assump-
tions, is easy to compute and is compatible with the exact test of
differential expression.

Results: We evaluated the proposed approach using 10 simulated
and experimental datasets and compared its performance with that
of currently popular packages edgeR, DESeq, baySeq, BBSeq and
SAMseq. For these datasets, sSeq performed favorably for experi-
ments with small sample size in sensitivity, specificity and computa-
tional time.

Availability: http://www.stat.purdue.edu/~ovitek/Software.html and
Bioconductor.

Contact: ovitek@purdue.edu

Supplementary information: Supplementary data are available at
Bioinformatics online.

Received on September 25, 2012; revised on February 24, 2013;
accepted on March 25, 2013

1 INTRODUCTION

Whole transcriptome shotgun sequencing (RNA-seq) technology
(Mardis, 2008; Metzker, 2009; Wang et al., 2009) quantifies gene
expression in biological samples in counts of transcript reads
mapped to the genes. Accurate and comprehensive, it has
made a major impact on genomic research (Garber et al.,
2011; Oshlack et al., 2010; Pepke et al., 2009). One common
goal of RNA-seq experiments is to detect differentially expressed
genes, i.e. genes for which the counts of reads change between
conditions more systematically than as expected by random
chance (Oshlack et al., 2010). Statistical methods for detecting
differentially expressed genes must reﬂect the experimental de-
sign and appropriately account for the stochastic variation.

 

*To whom correspondence should be addressed.

Moreover, many RNA-seq experiments serve as high-throughput
screens of a small number of samples with the goal of subsequent
experimental validation. Therefore, the analysis must handle a
relatively small number of biological replicates.

A variety of statistical methods and software has recently been
proposed for detecting differentially expressed genes. These in-
clude DESeq (Anders and Huber, 2010), edgeR (Robinson and
Smyth, 2007; Robinson et al., 2010), baySeq (Hardcastle and
Kelly, 2010), SAMseq (Li and Tibshirani, 2011), BBSeq(Zhou
et al., 2011). We brieﬂy overview these methods. We further
propose a direct and effective approach for characterizing the
variation in the counts of reads, which improves the sensitivity
and speciﬁcity of detecting differentially expressed genes for ex-
periments with small sample size. We support this approach with
an open-source R-based software package sSeq.

2 BACKGROUND
2.1 The Negative Binomial distribution

The input to the statistical analysis is a set of discrete counts of
reads in each experimental run. Although the counts can be
modeled with the one-parameter Poisson or Geometric distribu-
tions (Auer and Doerge, 2011; Li et al., 2011; Marioni et al.,
2008), it is often advantageous to use the two-parameter
Negative Binomial distribution (Anders and Huber, 2010;
Hardcastle and Kelly, 2010; Robinson and Smyth, 2007;
Robinson et al., 2010). This distribution is more general and
ﬂexible and can be Viewed as a generalization of both Poisson
and Geometric distributions (Supplementary Materials). We
focus on the Negative Binomial distribution in what follows.
Denote X M as the random variable that expresses the counts
of reads mapped to gene g (g = 1, . . . , G) in sample (or, equiva-
lently, library) j (j = 1, ...,n,-) in condition i and denote xgij as
the observed values. For simplicity, we consider two conditions
(i = A,B); however, the discussion holds for pairwise compari-
sons of conditions in experiments with more complex designs.
We are particularly interested in situations where 11A and 113 are
small, e. g. 14. We consider the following parametrization:
Xgl'j ~ NB(/Lg,-,¢g), where Mg,- 3 0, (pg 3 0, such that 1
13%} = Mgr: Vanni} = u...- + reg-qr. ( We“ Vgi) ( )

The dispersion parameter (pg determines the extent to which
the variance Vg, exceeds the expected value Mg,- (Cameron and
Trivedi, 1998; McCullagh and Nelder, 1989).

 

© The Author 2013. Published by Oxford University Press.

This is an Open Access article distributed under the terms of the Creative Commons Attribution Non—Commercial License (http://creativecommons.org/licenses/
by—nc/3.0/), which permits non—commercial re—use, distribution, and reproduction in any medium, provided the original work is properly cited. For commercial

re—use, please contact journals.permissions@oup.com

112 /310's112u1n0fp10}x0"soiJBuiJOJuioiq/ﬁduq 11101} pepaolumoq

91oz ‘Og isnﬁnV uo ::

D. Yu et al.

 

2.2 Motivation for the proposed approach

The estimation of Var{Xg,-j} is the main focus of this work and is
based on the following considerations.

(1) A naive approach is to estimate Var{Xg,-j} using the
method of moments (i.e. the per-gene sample variance).
However, it is highly variable in experiments with a
small sample size (Croarkin and Tobias, 2006).

(2) RNA-seq experiments simultaneously quantify the expres-
sion of many genes. The genes share aspects of biological
and technical variation, and therefore a combination of
the gene-specific estimates and of consensus estimates
can yield better estimates of variation. Such approaches
are increasingly popular with RNA-seq experiments
(Anders and Huber, 2010; Robinson and Smyth, 2007).

(3) The variance of the Negative Binomial distribution is a
known function of the expected value Mg,- and of the dis-
persion (pg. Therefore, an accurate estimation of the dis-
persion (e. g. by combining the gene-speciﬁc and consensus
estimates, without explicitly modeling its relationship to
am) can lead to an accurate estimation of the variance
while preserving the meanivariance relationship.

(4) Finally, constraints of throughput sample availability or
cost may restrict the number of biological replicates.
Although experiments with little or no biological replica-
tion have poor reproducibility and are undesirable, such
under-replicated screens are the only practical option in
some situations (Malo et al., 2006; Markowetz, 2010).
They can only detect large changes in expression and re-
quire an extensive downstream validation with complemen-
tary low-throughput experiments and large sample size. To
detect differentially expressed genes, we assume that the
majority of the genes are not differentially expressed, and
that for these genes, the samples from all conditions can be
Viewed as biological replicates (Robinson and Oshlack,
2010; Robinson et al., 2010). Under this assumption, a con-
sensus estimate of dispersion helps to improve the accuracy
of gene-speciﬁc estimates of variation.

Our main concern is in how to (i) accurately deﬁne the consensus
estimate of dispersion and (ii) accurately combine the gene-spe-
ciﬁc estimates of dispersion with the consensus estimate.

2.3 Existing approaches for RNA-seq experiments

Among the existing methods, edgeR (Robinson and Smyth,
2007; Robinson et al., 2010), DESeq (Anders and Huber, 2010)
and baySeq (Hardcastle and Kelly, 2010) assume the Negative
Binomial distribution, and SAMseq (Li and Tibshirani, 2011)
and BBSeq (Zhou et al., 2011) use other ﬂexible models. The
approaches have been extensively evaluated (Soneson and
Delorenzi, 2013) and are broadly used. Hardcastle and Kelly
(2010) found that the performance of DESeq, edgeR and
baySeq is superior to that of DEGseq (Wang et al., 2010), Li
and Tibshirani (2011) found that SAMseq improves on
PoissonSeq (Li et al., 2011). We brieﬂy overview these
approaches in the historical order. Table 1 summarizes the
discussion.

Probability model. edgeR models the count of reads with the
Negative Binomial distribution. It includes normalization,
which accounts for the changes in read counts owing to technical
artifacts such as different sequencing depth. The normalization
factor can be the total library size (i.e. the number of reads in the
library). A more accurate normalization factor is the ‘effective’
library size ml], which multiplies the size of the library ij by a
robust estimate of the log-fold change of the total count in con-
dition i as compared with a reference run (Robinson and
Oshlack, 2010). The parameter pg,- in row (b) of Table 1 is the
probability that a single read maps to gene g for a sample in
condition i. The model assumes that the dispersion parameter is
gene specific but constant across conditions. For experiments
without replication versions up to 2.4.6 assumed a common dis-
persion in all the genes. The subsequent versions discourage
unreplicated experiments. Finally, generalized linear models for
the Negative Binomial response are available.

DESeq also models the count of reads with the Negative
Binomial distribution. It normalizes the read counts by a size
factor sil- (Anders and Huber, 2010).

A . x ~-
sij = mediang "A "K g” “my!” (2)
n ngk n ngk)
k=l k=l
The size factor can be thought of as the ‘representative’ ratio of
counts in the library to the geometric mean of the counts in all
the libraries, and differs from the ‘effective’ library size in edgeR.
The parameter Hg,- in row (c) of Table 1 is the expected normal-
ized expression of gene g in condition i. DESeq allows speciﬁca-
tion of separate variances for genes and conditions and models
the variances as functions of the expected values. This relation-
ship can be a ﬂexible smooth function (local polynomial) or a
parabolic function 18g,- 2 Sl'j - 12g,- + 3,2]- - M;- - (a0 + a1 ﬁlm), where
a0, a1 >0 are constants. Alternatives based on generalized linear
models for the Negative Binomial response are also available.

The baySeq specifies the same probability model as edgeR;
however, it proposes a different Empirical Bayes characterization
of the between-library variation. The baySeq assumes that sub-
sets of the libraries share the parameters of Negative Binomial
distribution and derives an empirical prior distribution for the
corresponding parameter sets. After integrating over the empir-
ical priors, the dispersion in the integrated likelihood is constant
across conditions and different between the genes. The default
normalization parameter is the library size.

BBSeq specifies a Beta-Binomial generalized linear model.
Using the logit link, it connects the expected probability of a
read for gene g in condition i and sample j to the linear combin-
ations of predictors, such as indicators of conditions and other
covariates. The dispersion parameter can be independent from the
mean (free model) or dependent on the mean (constrained model).
SAMseq uses a fully non-parametric approach.

Estimation of dispersion. edgeR maximizes a weighted combin-
ation of the conditional log-likelihoods with per-gene dispersion
and of the conditional log-likelihood with common dispersion.
Conditional likelihoods generalize the restricted maximum like-
lihood estimation for a discrete response by conditioning on the
sum of the read counts per class and improve the statistical
properties of dispersion estimates. The estimation requires

 

1276

112 /310's112u1n0fp10}x0"soiJBuiJOJuioiq/ﬁduq 11101} pepaolumoq

91oz ‘Og isnﬁnV uo ::

Estimation of dispersion in Negative Binomial models

 

Table 1. Existing and proposed approaches for differential analysis of RNA-seq experiments with two conditions

 

 

Probability model Estimation of dispersion Testing n = 1 Time
(a) sSeq (proposed) X gil- ~ NB(s,-jp.g,-, (pg/sq) (132594 2 8g + (1 — 8:13:41", where S is a H0 : My, 2 Mg], Yes min
(this manuscript) common dispersion and 8 is a weight Exact test
(b) edgeR (Robinson X gil- ~ NB(m,-jpg,-, (pg) (5:43“? maximize linear combination of H0 : pgA = pr Yes* min

and Smyth, 2008)

per-gene and common-dispersion

Exact or GLM-based test

conditional likelihoods

(c) DESeq (Anders
and Huber, 2010)

Xgij ~ NEW/ts!" ‘1’?) A

DESeq _ ‘ A 1 1 A2
d’g,‘ — (Vgi _ “gin—1.2%) Mgr

H0 : MM 2 pg]; Yes min

Exact or GLM-based test
1

Vgi is estimated as function of the mean

((1) baySeq (Hardcastle X gil- ~ NB (Nil-pg, (ﬁg)
and Kelly, 2010) Empirical priors on sets
of parameters

(e) BBSeq
(Zhou et al., 2011)

Xgij ~ Binom(pg,-, NU)
pg,- ~ Beta, logitE{pg,-} 2 ZS,
V(I7gi) = E(I7gi) (1 _ E(pgi))¢g

(f) SAMseq (Li and
Tibshirani, 2011)

Non-parametric

owl’s“! maximize per-gene integrated
quasi-likelihood

(1)555“! maximize per-gene marginal
likelihood; is a free parameter or
a function of the mean

H0 ngA =pr Yes ll
Posterior probability cutoff

H0 : ,8 = 0 Wald test Yes h

H0: same distributions A and B No min
Wilcoxon test & resampling

 

(a) 5,-1- is the size factor for sample j in condition i as deﬁned in (Anders and Huber, 2010). pg,- is the expected normalized expression of gene g for a sample in condition i. <13§4M is

the per—gene dispersion estimate using the method of moments in Equation (6).

(b) mi]- is the ‘effective’ library size. pg,- is the probability that a read in i maps to gene g. *Up to v2.4.6.
(c) ¢g,- is gene— and condition—speciﬁc dispersion. 12g,- and Vgi can be estimated by the method of moments or by the Cox—Reid corrected Maximum Likelihood.

((1) Ni]- is the size of the library ifrom condition j. pg,- is as in (b).

(e) pg,- is as in (b). ND- is as in (d). )3 is the coefﬁcient of the linear predictor associated with an indicator Z of conditions. Column ‘Time’ is the run time for the experimental

datasets in Section 4 on a laptop computer.

calculating pseudocounts of reads that would have been obtained
with libraries of equal size and an iterative computational opti-
mization. For experiments with few replicates, the estimates tend
to be discrete values (Lloyd-Smith, 2007; Piegorsch, 1990; Toft
et al., 2006). For experiments with many replicates, edgeR spe-
ciﬁes a generalized linear model. As conditional likelihoods
cannot be easily extended to this case, these are further approxi-
mated by adjusted proﬁle likelihoods (McCarthy et al., 2012).

DESeq starts by estimating per-gene means and variances of
the normalized counts in each gene and condition by the meth-
ods of moments. Next, it re-estimates them by ﬁtting the postu-
lated relationship between the expected values and the variances.
The estimates of dispersion can be back-calculated from the es-
timates of variance as shown in row (c) of Table 1. For experi-
ments without replication, DESeq assumes that the majority of
the genes are not differentially expressed, and combines the sam-
ples across conditions to estimate the variance. The same strategy
is used with the generalized linear models.

The baySeq relies on an iterative estimation of the relative gene
expression and of the dispersion. Given an initial partition of the
libraries into subsets and an initial estimate of the relative gene
expression, it estimates the dispersion using the quasi-likelihood
approach. Given the estimates of dispersion, it re-estimates the
relative gene expression by maximizing the integrated likelihood.
This is repeated for different partitions of the libraries.

BBSeq estimates the dispersion using maximum likelihood for
the free model. For the constrained model, it uses the estimates
from the free model for all the genes, ﬁts the postulated

relationship to the mean and re-estimates the dispersions.
SAMseq sidesteps the need to estimate the dispersion by using
a fully non-parametric approach.
Testing. For the Negative Binomial model, edgeR tests the null
hypothesis H0 : pgA =pr, and DESeq H0 : [Lg/1 = ngB separ-
ately for each gene. Both edgeR and DESeq use the exact test,
which is free from asymptotic arguments and is therefore pre-
ferred. The test statistic for a gene is the total (normalized) count
of reads in all the replicates of a condition. The P-Value is the
probability of the normalized read counts per group such that
under H0 their probability is same or lower than the probability
of the observed counts, conditional on the total counts equal to
the observed. With the generalized linear models, edgeR and
DESeq use the asymptotic likelihood ratio or Wald tests.
baySeq ranks the genes by their posterior probabilities of dif-
ferential expression. BBSeq tests the coefﬁcient of the linear pre-
dictor (i.e. condition) in the generalized linear model with the
asymptotic Wald test. SAMseq uses a resampling strategy to es-
timate the distribution of the test statistic and the P—Values.

3 METHODS

The proposed approach combines aspects of the existing approaches, but
is simpler, requires fewer assumptions and streamlines the computation.
It is summarized in Table 1a. More details regarding the method and its
implementation in sSeq are in Supplementary Materials.
Probability model. The model for the counts X gil- of gene g = 1, ..., G,
replicatej = 1, . . . ,n,— and condition i: A,B is

X gij ~ NBmgi sij, (pg/s9), such that (3)

 

1 277

112 /310'S[BIIJHO[pJOJXO'SOlJ’BLUJOJIIlOlq”Idllq 11101} pepBOIH/noq

91oz ‘Og isnﬁnV uo ::

D. Yu et al.

 

E{Xg,-j} = Mg,- s,-,-, and Var{Xg,-j} = Mg,- s,-,- + Mgr», s,- (4)

We follow edgeR, DESeq and baySeq by specifying a Negative Binomial
distribution. As in experiments with a small sample size, it may be difﬁ-
cult to distinguish the true dependency of dispersions on expected values
from artifacts of random variation, the model speciﬁes free gene-speciﬁc
dispersion parameters (pg. As the initial versions of edgeR, we specify a
common dispersion across conditions, i.e. 1%,, 2 (ﬁg; degedqbg. As a con-
sequence, the counts of differentially expressed genes have different vari-
ances in each condition.

We follow DESeq in normalizing the counts by the size factor sij.
However, in the proposed normalization, the size factor affects not
only the expected value but also the dispersion. Equation (4) shows
that under this assumption the size factor linearly scales both E{Xg,-j}
and Var{Xg,-j}. Such linear scaling is consistent with the technical variation
in RNA-seq experiments, which can be characterized by the Poisson dis-
tribution (Marioni et al., 2008). As typical size factors are close to 1, the
proposed model has little practical difference from the model in DESeq.
However, as shown in Supplementary Section 2, it allows us to directly
conduct the exact test and contributes to the accuracy of the results.
Estimation of dispersion. Similarly to DESeq, we start by estimating the
dispersion parameters by the methods of moments. A conservative esti-
mate of the per-gene variance in experiments with a small sample size is
obtained by pooling the samples across conditions, i.e.

Z Z (xgij/§U — ﬁg)2 Z Z xgij/‘eij
I? = ’1— 'th ‘ 2 ¥ S
g Zni _ 1 1 W1 Mg Zni ()
and g = 1, . . . , G. The estimate of dispersion 113:," M is then calculated from
Equation (1), and negative values are truncated at zero
2’” Vs _ “E Z. 
¢g1M = max 0, M (6)

#:2237-
I 1

Unfortunately, in experiments with small sample size, dig“ are unsatis-
factory owing to high variance (Bowman, 1984; Clark and Perry, 1989;
Willson et al., 1984). Next, we improve the statistical properties of these
estimates by introducing shrinkage.

Stein (1956) showed that when we estimate the expected values of three
or more independent Normal random variables with known constant
variance, shrinking the per-dimension estimates toward a target value S
produces biased estimates, but reduces the mean squared error (MSE) for
all choices of S. The shrinkage estimator by James and Stein (1961)
(Lehmann and Casella, 1998; Richards, 1999) implements this strategy.
More recently, Hansen extended the approach of James and Stein with a
generalized shrinkage estimator, (Hansen, 2008). Hansen’s shrinkage can
be used with any per-dimension estimator with an arbitrary sampling
distribution (not necessarily Normal), for which the Central Limit
Theorem holds. Speciﬁcally, it requires that the true parameter lies in a
neighborhood of the restricted parameter space, and that the estimator is
asymptotically Normal with a consistent variance. Estimators by the
method of moments satisfy these criteria. Applied to the estimation of
(pg, and assuming that the per-gene estimates are independent, the gen-
eralized shrinkage estimator is

t?" = (1 — of?“ +815=s+0 — W3?“ — 5) (7)

(2)2594 is a linear combination of the pre-deﬁned target S and of the per-
gene methods of moment estimates. The weight 8 is deﬁned as

AMM_—,,MM 2 _
Z ¢, ¢ /(G 1)
g—

8 = A
Z(¢£‘M — S)2/(G — 2)
g

.and 33”“ = £23in (8)
3

As § (15:41" — éMMY 5 §($£4M — S)2, the weight 8 6 (0,1). Larger
values of 8 shrink the estimates closer to the pre-deﬁned target S.

We use the Hansen’s generalized shrinkage estimator (2)2594 in conjunc-
tion with the Negative Binomial distribution to test genes for differential
expression. Although the assumption of 113:," M being independent variables
is simplistic, it is a suitable approximation for experiments with a small
sample size. A similar assumption is made, e. g. by DESeq when modeling
the variance as function of the mean. Although the asymptotic argument
cannot be justiﬁed in this context, we show empirically in Section 5 that
(1325” performs well in practice.

Hansen showed that the estimator in Equations (7) and (8) reduces the
asymptotic MSE for all choices of targets S. However, a good practice is
to select a value for S that maximizes this reduction. To this end, we

G A
approximate the MSE = E{Z ((1)2594 — (1)92} using the average squared
g:l

difference (ASD) between (2)2594 and of“
1 G A A
ASD = 5 213w?” — #3“? (9)
g:

Equation (9) substitutes mpg with 113:," M and divides MSE by the constant G
for numeric stability. It is shown that

ASD(S) = GCOHA (10)

Z ($51M — s12
g:l

Figure 1a visualizes the functional form of ASD(S) for a simulation in
Section 4 and shows that the tail of the curve ﬂattens for large S.
Therefore, we can also minimize the bias by minimizing S while enforcing
the constraint that ASD(S) is comparably small. In practice, sSeq esti-
mates S by calculating the slope of ASD(S) and setting

é = argmin${—e < slope(ASD(S)) < 0} (11)

for a small constant e such as e = 0.05. The selected value is shown by the
vertical line in Figure 1a.

Figure 1b illustrates the fact that the proposed shrinkage estimator is a
linear transformation of 1131"“ . The slope of the transformation is
(1 — 8) e (0, 1), and the ﬁxed point is the shrinkage target S. The shrink-
age increases the per-gene estimates of dispersion that are smaller than S
and decreases the values that are larger than S. From our experience with
multiple datasets, S is often around the 95.5th quantile of xi)?“ . In other
words, it biases the majority of the estimates towards conservative values.

The proposed estimate of dispersion has analogies in methods de-
veloped for other high-throughput technologies. For example, it is similar
in spirit to the moderated variance estimator in the package Limma
(Smyth, 2004, 2005), which is also a linear combination of per-gene
and consensus estimates.

Testing. We follow edgeR and DESeq by testing H0 : My, 2 pg]; per gene
with the exact test. The test statistic is X g,., i.e. the sum of the read counts
in each condition. Under H0, the P-values are calculated with respect to

the reference distribution Xgi. 110N13<Zsij > pg, ¢g/ Zsij) and are ad-
} 1'

justed to control the false discovery rate (FDR) (Benjamini and
Hochberg, 1995). See Supplementary Materials for more details.

Extensions to experiments with complex designs. The proposed approach
can be extended to pairwise comparisons of conditions in experiments with
more complex designs without recurring to a generalized linear model and
without additional assumptions. See Supplementary Materials for details.

4 DATAS ETS

We evaluated the proposed approach using 10 simulated and
experimental datasets. The first ﬁve datasets had an external

 

1 278

112 /310'S[BIIJHO[pJOJXO'SOlJ’BLUJOJIIlOlq”K1111] 111011 pepBOIH/noq

91oz ‘Og isnﬁnV uo ::

Estimation of dispersion in Negative Binomial models

 

(a) Simulation1,n,~=2 (c) Simulation1,n,~=2: Proposed

 

 

 

      

 

 

 

 

 

 

.’\
$0.354
_ i .1031 .—_
_ I E
o : .gv
a—JN Li') a
ALF?" I “ '
a: I a _ ‘
_ LI"
q: I “Em
- — — — — — — — — — — — ——0.009 ‘4'
a . E d
C?" I a-
D | I I I | I IT‘-
0.0 0.2 0,4 0.6 0.3 0 S 41 6
i; og(mean)

(b) Simulation1,n,~=2 (CI) Simulation1,n,~=2: Proposed

 

 

 

 

 

 

 

 

 

_ — y:ﬂ.l1+0.69x  it 
CL 3 '
o— N gm.
0 _ It!“
9 L :-
,_ “am- I
2
U
'- O-
0
0'0 ' 1.0 210 ' 0 S 41 6
WM Oglmeanl
I?

(e) Simulation1,n,~=2: edgeR (g) Simulation1,n,~=2: DESeq

 

 

   

“E — “E
.9 .9
LOVITH LOVITd'
a ' a '
3°?— E?—
U} U!
9 — 9 —
q- q-

 

 

 

 

 

 

 

iogm‘iea n? iogm‘iea n?

(f) Simulation1,n,~=2:edgeR (h) Simulation1,n,~=2:DESeq

 

 

 

 

 

 

 

 

Be Be
‘8’ ' ‘8’ '
CG— CG.
E'— E'—
L _ L _
to to
:- :- .~
an- an- x
2 2
_ _I‘_
:1- :1-

logUiiean) log(riiean)é

Fig. 1. Dispersion and variance estimation in Simulation1. Similar plots for other datasets are shown in Supplementary Materials. (a) ASD versus

shrinkage target S. ASD is maximized at S = (EMM (solid horizontal line). The dashed lines are the selected target S and its ASD. (b) The proposed
shrinkage estimator is a linear transformation of (ﬁg/1M, with the slope (1 — 8) = 0.69 and the ﬁxed point S = 0.354. All d3?“ 5 0 are transformed to
8S 2 0.11. (c, e and g) Dispersion estimates by sSeq, edgeR and DESeq versus the per-gene mean read counts across conditions. Gray smooth scatter are

113:," M (same on all the plots). Black dots are (ﬁg estimated by each method. Gray lines indicate the true dispersion parameters. ((1, f and h) Same as above,

but for the variances of the read counts

‘gold standard’ of differential expression, and the last two had
experimental designs more complex than a two-group compari-
son. See Supplementary Materials for more details.

Simulation1, Simulation2 and Simulation3 each generated
G = 20 000 genes in conditions A and B, M 2 n3 2 2. Thirty
percent of the genes were simulated as differentially expressed.
Size factors were sampled from the Uniform distribution
Sij~ Uniform(0.5, 1.7).

Simulation1 assumed a constant dispersion parameter across
all genes and is favorable to sSeq. Simulation2 assumed that (pg is
a non-linear function of Mg, i.e. (pg 2 1/(100 + Mg) and as such is
favorable to DESeq. Simulation3 is most realistic. From the
dataset by Bottomly et al. (2011) (Frazee et al., 2011), the largest
experimental dataset in this manuscript, we selected a subset of
non-differentially expressed genes (as determined by a consensus
of sSeq, edgeR and DESeq) and sampled pairs (125M , (13%” ) from
this subset as the true parameters for simulating read counts.

MAQC (Shi et al., 2006) is the dataset from the MicroArray
Quality Control (MAQC) consortium, comparing three libraries
from Ambion human brain reference RNA against two libraries
from Stratagene human universal reference RNA. The libraries
were sequenced with the Illumina platform, resulting in 19 580
genes. A subset of the genes from four of the libraries was assayed
by real-time reverse-transcription PCR (Shi et al., 2006; Zhining
et al., 2010). We used the 323 differential genes and 85 non-differ-
entially expressed genes determined by real-time reverse-transcrip-
tion PCR as the ‘gold standard’. Although the dataset only has
technical replicates, it has been used extensively as the benchmark
in the past (Arikawa et al., 2008; Bullard et al., 2010; Patterson
et al., 2006).

Griffith et al. (2010) compared ﬂuorouracil (5-FU)-resistant
human colorectal cancer cell lines MIP101 against their non-
resistant counterpart MIP/5-FU24. One library from each con-
dition was quantified with the paired-end Illumina platform,
resulting in 27145 genes. In all, 197 of these genes from the
same samples were assayed by quantitative PCR. We used 12
truly differential genes and 19 truly non-differentially expressed
genes as determined by quantitative PCR as the ‘gold standard’
for method comparison.

Brooks et al. (2011) compared untreated cells of Drosophila
melanogaster against cells cultured in presence of Pasilla, the
homologue of the mammalian Nova-1 and Nova-2 protein.
Two biological samples per condition were sequenced with the
paired-end Illumina platform, resulting in 14470 genes.

Sultan et al. (2008) (Frazee et al., 2011) compared two biolo-
gical replicates of human cell lines Ramos B and HEK293T with
the Illumina platform, yielding 6 573 643 uniquely aligned reads.

Bottomly et al. (2011) (Frazee et al., 2011) compared brain
tissues of two inbred mouse strains, C57BL/6J (B6) and DBA/
2] (D2), using the Illumina platform. The analysis of 10 and 11
biological samples per condition resulted in 13 932 genes.

Hammer et al. (2010) (Frazee et al., 2011) compared gene ex-
pression in rat strains Sprague Dawley and L5 SNL Sprague
Dawley 2, at two times (2 weeks and 2 months) in a factorial
design. Two distinct biological libraries per condition and per
time slot were quantiﬁed using the Illumina platform, resulting
in 18635 genes.

Tuch et al. (2010) compared the expression of genes in normal
human tissues and in tissues with oral squamous cell carcinoma.
The experiment compared pairs of normal and tumor samples

 

1 279

112 /310'S[BHJHOIPJOJXO'SOIJ’BLUJOJIIIOICI”K1111] 111011 pepBOIH/noq

91oz ‘Og isnﬁnV uo ::

D. Yu et al.

 

from three patients. The six libraries were sequenced using the
SOLiD platform, resulting in 10453 genes.

5 RESULTS

In addition to sSeq, the following versions of the existing packages
were used: edgeR V3.0.8 (January 2013), DESeq V1.10.1 (October
2012), baySeq V1 . 12.0 (October 2012), BBSeq V1.0 (March 2011),
SAMSeq as part of the R package samr V2.0 (June 2011).

For sSeq, all the datasets were analyzed with the exact test,
and analyses of the Hammer and the Tuch datasets accounted
for their experimental designs. For edgeR and DESeq, the data-
sets with two-group comparisons were analyzed with the exact
test, and Hammer and Tuch datasets were analyzed with the
glm-based approaches. For edgeR, the estimateCommonDisp
function in an older version of edgeR package (V2.4.6) was
used to analyze unreplicated datasets. For DESeq, the option
ﬁtType=‘local’ was used to estimate the per-group variance.
The default parameters were used otherwise. See Supplementary
Materials for details and representative R scripts.

5.1 sSeq accurately estimates the variation

As the proposed approach shares most similarities with edgeR
and DESeq, we compared their estimates of dispersions and vari-
ances in more details. Figure 1c, e and g use the simplest case of
Simulation1 to illustrate the estimates by the method of moments
and by the three approaches. As expected, (13,341” have a high
variance, which increases with the mean. Also as expected, esti-
mates by qigseq are biased towards larger values but have smaller
deViations from the true values as compared to (15%”. Estimates
by the other two methods ﬁt the pattern of ﬁll”.

Figure 1d, f and h show that despite the differences in disper-
sion estimation, the estimates of variance by the three methods
are less different. This is due to the fact that the values of the
dispersions are small as compared with the means, and that the
variances in Equation (1) are highly inﬂuenced by the expected
values. As a result, the bias in the estimation of the dispersion
has a low impact on the overall estimation of variation.
Supplementary Materials provide plots for the other datasets.

The first two columns of Table 2 show that the bias also has
little impact on the performance of detecting differentially ex-
pressed genes, as the performance of sSeq, edgeR and DESeq

are relatively similar. sSeq has a slightly higher area under the
ROC curves.

Figure 1d, f and h also provide an insight into why shrinking
the method of moments estimates of dispersion is more beneﬁcial
than shrinking the method of moments estimates of variance. On
the log scale the relationship between the mean and the variance
in the Negative Binomial distribution is roughly linear for large
mean counts. Mathematically, from Equation (1)

10g( Vgi) = 10g(Hgi + Mink) = IOgULgi) + 10g(Hgi¢g + 1) )
lar e -
logWgo  2 - logo...) + loge.)

A shrinkage of the variance estimates would multiply them by
(1 — 8) 5 1 and would distort the slope of the meanivariance
relationship in Equation (1) away from Equation (2). The shrink-
age of the dispersion parameter, on the other hand, preserves this
nominal meanivariance relationship. Our results (shown in
Supplementary Materials) confirmed that shrinking the variance
leads to inferior performance.

To further investigate the usefulness of multiple shrinkage tar-
gets, we partitioned the genes into 10 groups according to the
ranges of 12;“! and applied the shrinkage separately to each
group. Our results (not shown here) indicated that there is no
advantage in specifying multiple shrinkage targets.

5.2 sSeq accurately detects differential expression

Five datasets with an external ‘gold standard’ were used to evalu-
ate the sensitiVity and the speciﬁcity of detecting differentially
expressed genes. For each method, the genes were ranked by
FDR-adjusted P—Value of posterior probability and termed ‘sig—
niﬁcant’ for varying cutoffs. The sensitiVity and the speciﬁcity of
differential expression was compared with the ‘gold standard’
and summarized with ROC curves. Table 2 shows that the pro-
posed approach consistently had a similar or a higher accuracy
as compared with the existing methods.

Five datasets without an external ‘gold standard’ were used to
evaluate the sensitiVity and the specificity less formally, as dis-
cussed in (Anders and Huber, 2010). First, comparisons of two
conditions (‘AvsB’) had some truly differentially expressed genes.
Therefore, methods with higher sensitiVity should have higher
areas under the empirical cumulative distribution functions

A G
(ECDF) of the P—Values defined as F(p)=éZI{p,va1uegfp}.
g=l

Table 2. Areas under the ROC curves of detecting differentially expressed genes for the datasets with an external ‘gold standard’ while varying the FDR-

adjusted P-Value or posterior probability cutoff

 

 

 

 

Methods Simulation1 Simulation2 Simulation3 MAQC Project Grifﬁth et al.
n,=1 n,=2 n,=1 n,=2 n,=1 n,=2 n,=1 nA=3,nB=2 n,=1
Proposed sSeq 0.947 0.962 0.951 0.967 0.856 0.888 0.585 0.911 0.689
Existing edgeR 0.918 0.948 0.938 0.951 0.840 0.833 0.558 0.850 0.557
DESeq 0.932 0.940 0.937 0.949 0.842 0.816 0.577 0.867 0.596
baySeq 0.568 0.711 0.548 0.714 0.558 0.628 0.551 0.852 0.702
BBSeq 0.675 0.672 0.669 0.674 0.578 0.619 0.560 0.617 0.544
SAMseq 0.964 0.968 0.882 0.563

 

Sub—columns are subsets of the data with one randomly selected replicate per condition and the full datasets. Values closer to 1 indicate higher sensitivity and speciﬁcity.

 

1 280

112 /310'S[BHJHO[pJOJXO'SOIJ’BLUJOJIIIOICI”K1111] 111011 pepBOIH/noq

91oz ‘Og isnﬁnV uo ::

Estimation of dispersion in Negative Binomial models

 

(3) DESeq

(4) baySeq

(5) BBSeq

 

(a) Brooks
—nA1=nA2=’I
~ ~ ~ nA=nB=1

- - - nA=nB=2

ECDF

 

 

 

 

(b) Sultan
—nA1=nA2=’I
~ ~ ~ nA=nB=1

- - - nA=nB=2

ECDF

 

 

 

 

(c) Bottomly
—nA1=nA2=’I

~ ~ ~ nA=nB=1

- - - nA=10,nB=11

ECDF

 

 

 

 

(CI) Hammer
—nA1=nA2=’I
~ ~ ~ nA=nB=1

—- — Full dataset

ECDF

 

 

 

 

(e) Tuch
—nA1=nA2=’I

. . . nA=nB=1

—- — Full dataset

ECDF

OOIIL"

 

 

 

 

 

 

 

 

./
...n-"'

 

 

 

 

 

 

0:0. . '. . .
OIOI 1 I l I

 

0' . . . . . .
0.0 0.4 0.8
p-value

do'oh'oe'
p-value

 

d0'd4'oe'
p-value

do'd4'da'
1-post. prob.

6' . . . . . .
0.0 0.4 0.8
p-value

Fig. 2. The ECDF curves of detecting differential expression for the datasets with no external ‘gold standard’. Y-axis: ECDF, function of the gene rank.
x-axis: P-Value or 1 minus posterior probability. Solid line: two randomly selected replicates from a same condition (A vsA). Dotted line: one randomly
selected replicate from each condition (unreplicated AvsB). Dashed line: AvsB on the full dataset for two-group designs. Dashed-dotted line: AvsB on the
full dataset for more complex designs. Gray line: 45 degree. SAMseq is not applicable to unreplicated experiments and is excluded. The desired patterns
are high areas under the AvsB curves, and AvsA curves that are at or below the 45 degree line

Second, comparisons of replicates of a same condition (‘AvsA’)
had no differentially expressed genes. Therefore, methods with
higher speciﬁcity should have ECDF curves at or below the 45
degree line. For baySeq, we expect similar patterns of the ECDF
curves based on the posterior probability cutoff. Figure 2 sum-
marizes the curves for the five datasets. It shows that sSeq pro-
duced most consistently the expected pattern and had a similar
or a higher accuracy as compared with the existing methods.

The effect of sample size and of size factors on the accuracy
was investigated using the three simulated datasets. Supplemen-
tary Section 4.4 and 4.5 indicate that sSeq is particularly advan-
tageous for experiments when n 5 4.

6 DISCUSSION

In this manuscript, we advocated a model that speciﬁes free per-
gene dispersion parameters in the Negative Binomial model for

counts of RNA-seq reads. We also advocated a biased estimation
of these parameters, which can reduce the variance of the esti-
mates and minimize the overall MSE. Biased estimation is dif-
ferent from specifying a probability model (such as in DESeq)
that assumes a true systematic relationship of the true variance
and the true mean. It is particularly useful for experiments with a
small sample size, where the systematic relationship may be dif-
ﬁcult to evaluate. The shrinkage estimates are easy to compute,
avoid iterative estimation, minimize the potential for overﬁtting
and do not require extra computation time. They are compatible
with the exact test of differential expression. For the datasets in
this manuscript, sSeq consistently had a similar or a higher sen-
sitiVity and specificity of detecting differential expression than
the existing methods. The approach can be generalized to express
the dependence of the dispersions on the expected value or on
other covariates such as guanine-cytosine (GC) content or Gene
Ontology annotations.

 

1 281

112 /310'S[BIIJHOIPJOJXO'SOIJ’BLUJOJIIIOICI”Zduq 11101} pepBOIH/noq

91oz ‘Og isnﬁnV uo ::

D. Yu et al.

 

sSeq can produce meaningful results in under-replicated RNA-
seq screens. However, we stress that RNA-seq screens do not
eliminate the biological variation in gene expression Equation
(12). As eVidenced by Table 2 and Figure 2, the under-replicated
screens have lower reproducibility as compared with the repli-
cated studies. Multiple biological replicates are necessary to ad-
equately assess the full extent of the variation in the biological
system. Therefore, the under-replicated screens can only be con-
ducted when followed by a rigorous experimental validation with
complementary technologies and adequate sample size.

ACKNOWLEDGEMENTS

The authors thank S. Anders, M. E. Bock and the Huber group
for helpful discussions.

Funding: NSF CAREER award DBI-1054826 to O.V. (in part).

Conﬂict of Interest: none declared.

REFERENCES

Anders,S. and Huber,W. (2010) Differential expression analysis for sequence count
data. Genome Biol., 11, R106.

Arikawa,E. et al. (2008) Cross—platform comparison of SYBR Green real—time PCR
with TaqMan PCR, microarrays and other gene expression measurement tech—
nologies evaluated in the MicroArray Quality Control (MAQC) study. BMC
Genomics, 9, 328.

Auer,P. and Doerge,R. (2011) A two—stage Poisson model for testing RNA—seq
data. Stat. Appl. Genet. Mol. Biol., 10, 1726.

Benjamini,Y. and Hochberg,Y. (1995) Controlling the false discovery rate: a prac—
tical and powerful approach to multiple testing. J. R Stat. Soc. B, 57, 2897300.

Bottomly,D. et al. (2011) Evaluating Gene Expression in C57BL/6J and DBA/2J
mouse striatum using RNA—seq and microarrays. PloS One, 6, el7820.

Bowman,K. (1984) Extended moment series and the parameters of the negative
binomial distribution. Biometrics, 40, 2497252.

Brooks,A. et al. (2011) Conservation of an RNA regulatory map between
Drosophila and mammals. Genome Res., 21, 1937202.

Bullard,J. et al. (2010) Evaluation of statistical methods for normalization and dif—
ferential expression in mRNA—seq experiments. BMC Bioinformatics, ll, 94.

Cameron,A. and Trivedi,P. (1998) Regression Analysis of Count Data, Econometric
Society Monograph (No.30). Cambridge University Press, Cambridge, UK.

Clark,S. and Perry,J. (1989) Estimation of the negative binomial parameter K by
maximum quasi—likelihood. Biometrics, 45, 3097316.

Croarkin,C. and Tobias,P. (2006) NIST/SEMATECH e—Handbook of Statistical
Methods. National Institute of Standards and Technology. http://www.itl.nist.
gov/diV898/handbook/ (15 April 2013, date last accessed).

Frazee,A. et al. (2011) ReCount: a multi—experiment resource of analysis—ready
RNA—seq gene count datasets. BMC Bioinformatics, 12, 449.

Garber,M. et al. (2011) Computational methods for transcriptome annotation and
quantiﬁcation using RNA—seq. Nat. Methods, 8, 469477.

Grifﬁth,M. et al. (2010) Alternative expression analysis by RNA sequencing. Nature
Methods, 7, 8437847.

Hammer,P. et al. (2010) mRNA—seq with agnostic splice site discovery for nervous
system transcriptomics tested in chronic pain. Genome Res., 20, 8477860.

Hansen,B. (2008) Generalized Shrinkage Estimators. University of Wisconsin.

Hardcastle,T. and Kelly,K. (2010) BaySeq: Empirical Bayesian methods for identify—
ing differential expression in sequence count data. BM C Bioinformatics, 11, 422.

James,W. and Stein,C. (1961) Estimation with quadratic loss. In: Proceedings of the
fourth Berkeley Symposium on Mathematical Statistics and Probability Held at
the Statistical Laboratory, University of California, June 20—July 30, 1960.
University of California Press, p. 361.

Lehmann,E. and Casella,G. (1998) Theory of Point Estimation. Springer, New York.

Li,J. et al. (2011) Normalization, testing, and false discovery rate estimation for
RNA—sequencing data. Biostatistics, 13, 5237538.

Li,J. and Tibshirani,R. (2011) Finding consistent patterns: a nonparametric ap—
proach for identifying differential expression in RNA—seq data. Stat. Methods

Med. Res., [Epub ahead of print, doi: 10.1177/0962280211428386, November
28, 2011].

Lloyd—Smith,J. (2007) Maximum likelihood estimation of the negative binomial
dispersion parameter for highly overdispersed data, with applications to infec—
tious diseases. PLoS One, 2, e180.

Malo,N. et al. (2006) Statistical practice in high—throughput screening data analysis.
Nat. Biotechnol., 24, 1677175.

Mardis,E. (2008) Next—generation DNA sequencing methods. Annu. Rev. Genomics
Hum. Genet, 9, 387402.

Marioni,J. et al. (2008) RNA—seq: an assessment of technical reproducibility and
comparison with gene expression arrays. Genome Res., 18, 150971517.

Markowetz,F. (2010) How to understand the cell by breaking it: network analysis of
gene perturbation screens. PLoS Comput. Biol., 6, e1000655.

McCarthy,D. et al. (2012) Differential expression analysis of multifactor RNA—seq
experiments with respect to biological Variation. Nucleic Acids Res., 40,
42884297.

McCullagh,P. and Nelder,]. (1989) Generalized Linear Models. Monographs on
Statistics and Applied Probability (No. 37), Chapman & Hall/CRC, New York.

Metzker,M. (2009) Sequencing technologies: The next generation. Nat. Rev.
Genetics, 11, 3146.

Oshlack,A. et al. (2010) From RNA—seq reads to differential expression results.
Genome Biol., 11, 220.

Patterson,T. et al. (2006) Performance comparison of one—color and two—color plat—
forms within the MicroArray Quality Control (MAQC) project. Nat. Biotechnol.,
24, 114071150.

Pepke,S. et al. (2009) Computation for ChIP—seq and RNA—seq studies. Nat.
Methods, 6, S227S32.

Piegorsch,W. (1990) Maximum likelihood estimation for the negative binomial dis—
persion parameter. Biometrics, 46, 8637867.

Richards,J. (1999) An Introduction to James—Stein estimation, M.I.T. EECS Area
Exam Report, 1999. http://www.yaroslaVVb.com/papers/richards—introduction.ps
(15 April 2013, date last accessed).

Robinson,M. et al. (2010) EdgeR: a Bioconductor package for differential expres—
sion analysis of digital gene expression data. Bioinformatics, 26, 1397140.

Robinson,M. and Oshlack,A. (2010) A scaling normalization method for differen—
tial expression analysis of RNA—seq data. Genome Biol., 11, R25.

Robinson,M. and Smyth,G. (2007) Moderated statistical tests for assessing differ—
ences in tag abundance. Bioinformatics, 23, 288172887.

Shi,L. et al. (2006) The MicroArray Quality Control (MAQC) project shows inter—
and intraplatform reproducibility of gene expression measurements. Nat.
Biotechnol., 24, 115171161.

Smyth,G. (2004) Linear models and empirical Bayes methods for assessing
differential expression in microarray experiments. Stat. Appl. Genet. Mol.
Biol., 3, 3.

Smyth,G. (2005) Limma: Linear models for microarray data. In: Bioinformatics
Computational Biology Solutions Using R and Bioconductor. Springer, New
York, pp. 397420.

Soneson,C. and Delorenzi,M. (2013) A comparison of methods for differential
expression analysis of RNA—seq data. BMC Bioinformatics, 14, 91.

Stein,C. (1956) Inadmissibility of the usual estimator for the mean of a multivariate
Normal distribution. In: Proceedings of the Third Berkeley symposium on math—
ematical statistics and probability. Vol. 1, University of California Press,
Berkeley, pp. 1977206.

Sultan,M. et al. (2008) A global View of gene activity and alternative splicing by
deep sequencing of the human transcriptome. Science, 321, 95G960.

Toft,N. et al. (2006) The Gamma—Poisson model as a statistical method to deter—
mine if micro—organisms are randomly distributed in a food matrix. Food
Microbiol., 23, 9&94.

Tuch,B. et al. (2010) Tumor transcriptome sequencing reveals allelic expression
imbalances associated with copy number alterations. PloS One, 5, e93l7.

Wang,L. et al. (2010) DEGseq: an R package for identifying differentially expressed
genes from RNA—seq data. Bioinformatics, 26, 13(rl38.

Wang,Z. et al. (2009) RNA—seq: a revolutionary tool for transcriptomics. Nat. Rev.
Genet, 10, 5743.

Willson,L. et al. (1984) Multistage estimation compared with ﬁxed—sample—size es—
timation of the negative binomial parameter k. Biometrics, 40, 1097117.

Zhining,W. et al. (2010) Evaluation of gene expression data generated from expired
Affyrnetrix GeneChip microarrays using MAQC reference RNA samples. BMC
Bioinformatics, ll (SuppL 6), S10.

Zhou,Y. et al. (2011) A powerful and ﬂexible approach to the analysis of RNA
sequence count data. Bioinformatics, 27, 267272678.

 

1 282

112 /310'S[BHJHO[pJOJXO'SOIJ’BLUJOJIIIOICI”Idllq 11101} papeolumoq

91oz ‘Og isnﬁnV uo ::

