ORIGINAL PAPER

Vol. 27 no. 7 2011, pages 987-993
doi:10. 1 093/bioinformatics/btr051

 

Data and text mining

Advance Access publication February 3, 2011

SIMA: Simultaneous Multiple Alignment of LC/MS Peak Lists

Bj rn Vossl, Michael Hanselmannl, Bernhard Y. Renardi, Martin S. Lindner,
Ullrich K the, Marc Kirchner§ and Fred A. Hamprecht*

Interdisciplinary Center for Scientific Computing, University of Heidelberg, Germany

Associate Editor: Jonathan Wren

 

ABSTRACT

Motivation: Alignment of multiple liquid chromatography/mass
spectrometry (LC/MS) experiments is a necessity today, which arises
from the need for biological and technical repeats. Due to limits
in sampling frequency and poor reproducibility of retention times,
current LC systems suffer from missing observations and non-linear
distortions of the retention times across runs. Existing approaches
for peak correspondence estimation focus almost exclusively on
solving the pain/vise alignment problem, yielding straightforward but
suboptimal results for multiple alignment problems.

Results: We propose SIMA, a novel automated procedure for
alignment of peak lists from multiple LC/MS runs. SIMA combines
hierarchical pairwise correspondence estimation with simultaneous
alignment and global retention time correction. It employs a
tailored multidimensional kernel function and a procedure based on
maximum likelihood estimation to find the retention time distortion
function that best fits the observed data. SIMA does not require a
dedicated reference spectrum, is robust with regard to outliers, needs
only two intuitive parameters and naturally incorporates incomplete
correspondence information. In a comparison with seven alternative
methods on four different datasets, we show that SIMA yields
competitive and superior performance on real-world data.
Availability: A C++ implementation of the SIMA algorithm is available
from http://hci.iwr.uni-heidelberg.de/MlP/Software.

Contact: fred.hamprecht@iwr.uni-heidelberg.de

Supplementary information: Supplementary data are available at
Bioinformatics online.

Received on October 8, 2010; revised on December 10, 2010;
accepted on January 24, 2011

1 INTRODUCTION

Recent developments in liquid Chromatography/mass spectrometry
(LC/MS) have afforded insight into the dynamics of biological
systems at unprecedented levels of detail. High-resolution MS-
based protein identiﬁcation and quantitative MS are now established
methodologies in ﬁelds as diverse as proteomics (Aebersold and
Mann, 2003), glycomics (Zaia, 2010), lipidomics (Shevchenko and
Simons, 2010) and metabolomics (Dettmer et al., 2007).

 

*To whom correspondence should be addressed.

lThe authors wish it to be known that, in their opinion, the ﬁrst two authors
should be regarded as joint First Authors.

lPresent address: Department of Computational Medicine. The Institute for
Translational Oncology and Immunology, Mainz, Germany.

§Present address: Proteomics Center, Departments of Pathology, Children’s
Hospital Boston and Harvard Medical School, Boston, MA, USA.

Robust alignment of LC/MS experiments: current LC/MS
experiments often investigate complex biological systems over
a set of different environmental conditions and/or time-courses.
The associated data are routinely split into multiple fractions and
acquired in technical and biological replicates, yielding tens to
hundreds of LC/MS runs. Each of these runs delivers a snapshot of
the system of interest and to enable their joint analysis, the common
components in different measurements need to be related to each
other. In practical LC/MS applications, two major factors complicate
the determination of component correspondences across multiple
runs: (i) the limited reproducibility attained on LC systems, which
gives rise to non-linear distortions of the retention time domain; and
(ii) the limited sampling frequency inherent to data-driven MS/MS
acquisition as a notorious cause for missing observations. To obtain
quantitative estimates or to increase peptide identiﬁcation rates over
a series of experiments, LC/MS data analysis frameworks (Khan
et al., 2009; Mueller et al., 2007) rely on accurate mass and retention
time alignment to propagate correspondence information between
runs, experiments and samples. Accounting for LC distortions is a
necessary prerequisite for such cross-experiment inference (America
and Cordewener, 2008; Podwojski et al., 2009).

Although numerous pairwise alignment methods have been
proposed, the question of simultaneous alignment of multiple
datasets is still a particularly challenging task: as the number
of potential correspondences grows exponentially, false initial
multiple correspondence estimates are more likely, and estimation
procedures for the associated warping functions need to be robust
to potential outliers. Even more, in the light of practical application,
multiple alignment methods should naturally cope with incomplete
correspondences where peaks are only observed in a subset of runs
and no obvious missing value imputation strategy is available.

Types of LC/MS alignment algorithms: published alignment
algorithms work on different representations—either peaks
extracted from raw measurements or the raw measurements
themselves (Clifford et al., 2009; Prakash et al., 2006;
Vandenbogaert et al., 2008). This contribution focuses on the
alignment of sparse sets of samples, i.e. peaks 1),- = [(m/z),-, (rt),-,z,-],
which lie in a 3D feature space (ion mass-to-charge ratio, ion elution
time and ion charge) as proposed in Cox and Mann (2008); Khan
et al. (2009); Lange et al. (2008). Existing approaches can be divided
into three categories:

(1) Alignment based on a static reference, where all observed
measurements are aligned to a single reference peak list
(Bellew et al., 2006; Lange et al., 2007, 2008; Sturm et al.,
2008; Zhang et al., 2005). Because these approaches single
out one measured reference run, they perform well if there

 

© The Author 2011. Published by Oxford University Press. All rights reserved. For Permissions, please email: journals.permissions@oup.com 987

112 /3.to's[BrunoprOJxosorwurJOJurorq”:duq wort papeolumoq

9103 ‘Og anﬁnv uo ::

B. Voss et al.

 

is at least one run of exceptional quality. Peaks that are not
present in the reference cannot be used for alignment. This
can be a substantial drawback, especially in low signal-to-
noise ratio (SNR) situations or if suboptimal reproducibility
is an issue.

(2) Complete pairwise correspondence-based alignment, where
the pairwise distances between all observed measurements in
all runs yield pairwise alignments (Li et al., 2005). Based
on these correspondence pairs, global correspondence groups
are computed by iteratively linking similar peaks. Although
this approach overcomes the single reference problem, it is
computationally expensive since it requires the calculation of
all similarity measurements between all extracted peaks and
performs a retention time correction in each iteration.

(3) Hierarchical progressive alignment, where a similarity
measure based on peak distances determines the merging
sequence between different peak lists (Mueller et al., 2007;
Prakash et al., 2006). The algorithm starts with an arbitrary
(e. g. the most complete) list and subsequently merges the most
similar lists until all correspondences are computed. Like in
pairwise alignment, the retention times are corrected in each
step that is suboptimal (Smith et al., 2006). Few methods exist
that work without a similarity measure (Pluskal et al., 2010).

In all categories, existing multiple alignment methods are straight-
forward extensions of pairwise alignments (Khan et al., 2009; Lange
et al., 2007, 2008; Mueller et al., 2007). While some of them use
heuristics to deal with peaks that are not present in all available
peak lists, i.e. missing correspondences, others completely discard
incomplete correspondence information. However, the probability
that a peak is visible in all peak lists decreases with increasing
numbers of runs that have to be aligned. Simultaneous correction of
all peak lists is superior but rarely considered (Smith et al., 2006).

Simultaneous multiple LC/MS alignment: we propose SIMA,
a novel approach that performs a single global retention time
correction based on the multiple correspondence information
obtained from all peak lists and naturally deals with missing
correspondences. SIMA: (i) uses a pairwise greedy hierarchical
strategy to determine all (potentially incomplete) correspondences
across D peak lists (without performing a retention time correction
in each step; Section 2.1); and then (ii) uses a kernel density
estimation type non-parametric approach to simultaneously work on
all correspondence groups and derive a D-dimensional retention time
ridge. Its highest path is found by maximum likelihood estimation
and approximates the global retention time distortion function
that describes retention time shifts across all runs (Section 2.2).
Finally, (iii) it uses this ﬁinction to correct the individual peak
lists for retention time shifts and optionally performs a second
hierarchical correspondence estimation (Section 2.3). Step (ii) relies
on a customized kernel that is inspired by signal maps (Prakash et al.,
2006) and that has speciﬁcally been tailored to make direct use of
complete and incomplete correspondence information.

The remainder of this contribution is organized as follows: Section
2 introduces the proposed workﬂow (see Fig. 1) and its mathematical
framework. Section 3 describes the experimental setup and error
statistics that is used to judge SIMA performance and Section 4
reports and discusses the outcomes. We end with conclusions in
Section 5.

 

 

Input Peak Lists
3' Initial Correspondence '
_ 5:) Estimation {2.1)
Correspondence
Maps

 

Maximum-Likelihood
Path Estimation [2.2)

I
Retention TII'I'IB
Distortion Function (RTD F)

 

 

 

 

Retentlgn Time
Correction
optimal: Correspondence
Estimation (2.3)

 

 

 

 

Mulliple Corrected Peak
Correspondenoes Lists

Fig. 1. SIMA workﬂow: starting from a set of D LC/MS peak lists,
SIMA conducts an initial correspondence estimation that yields groups
of corresponding peaks (Section 2.1). Based on these groups, the method
calculates the retention time distortion function that is most likely to explain
the observed retention time differences across the D peak lists (Section 2.2).
Given this function, all retention time deviations are corrected, and peak
correspondences are reestimated (optional) (Section 2.3).

2 METHODS

2.1 Correspondence estimation

The correspondence estimation is based on: (i) a measure for estimating
the distance of peaks from two different peak lists, (ii) an algorithm for
establishing peak correspondence pairs based on this measure, (iii) a distance
measure for quantifying the dissimilarity of two peak lists based on their peak
correspondences and (iv) a hierarchical iteration scheme that successively
combines the sparse individual peak lists into a more complete master peak
list, while storing all established peak correspondences.

Notation: let ’P={Pd},a'=1,...,D, be the set of the D LC/MS peak
lists to be aligned. The d-th peak list Pd comprises |Pd| peaks, Pd:
{11.14, ...,pd7|Pd|}, and each peakpd’i = [(m/z)d,i,(rt)d,,,zd,i] is described by
its mass over charge position (m/z), retention time (rt) and charge state z.
To simplify notation, we discard the index indicating the membership of a
peak to a peak list throughout the remainder of the derivations. Scalars are
printed in standard font and vectors in bold.

Distance measure for peak correspondence estimation: the deﬁnition
of an adequate peak distance measure is fundamental for identifying
peak correspondences between different LC/MS runs. We quantify the
distance between two peaks [1,- and [If by the diagonal thresholded squared
Mahalanobis distance ¢ given by

$071315):\I’((Pi—I’j)*W*(pi_pf)/) (1)

where we deﬁne \Il(1lr)=1lr for 05$: 1, \Il(1lr)=oo for ¢> 1, and the
weight matrix W as W=diag_l(T3n/Z),T(2m,T3). TON/Z) and Tm) are user-
deﬁned threshold parameters for the upper bounds on (m /z) and (rt) shift
tolerance. In practice, their choice depends on the measurement precision
and is determined by the experimental instrument setup. Choosing very small
values for T2 disallows correspondences between peaks with different charge
states (default). If reliable charge state information is not available, deviations
in charge state may be allowed by using larger values for T2. Furthermore,
W may easily be adapted to also take other features like intensity differences
into account (cf. Supplementary Material A). In the 2D [(m/z), (rt)] domain,
Equation (1) yields elliptical equidistance lines within the feasible area in
which peaks may correspond to each other (cf. Supplementary Material B).

 

988

112 /3.to's[BrunoprOJxosoneurJOJurorqp:duq urorj papeolumoq

9103 ‘Og anﬁnv uo ::

Simultaneous Multiple Alignment of LC/MS Data

 

Establishing correspondence groups: given ¢(-, -), the problem of ﬁnding
correspondences between peaks from two peak lists Pd and P9 can efﬁciently
be solved by an algorithm that is best known for solving the ‘stable marriage”
problem (Gale and Shapley, 1962). Initially designed for graph-matching
problems, this method computes an optimal matching between elements from
two disjunct sets, such that peak pairs with small distances are preferred. The
resulting set fave contains all peak correspondences of Pd and P9, that is each
peak pair (i , j)e fave contains exactly one peak from both Pd and P9. Note
that the two peaks forming a pair may differ in (m /z), (rt), and z. Some peaks
might not ﬁnd a partner.

Distance measure for peak list dissimilarity: given fave, the dissimilarity
<I>(Pd,Pg) of two peak lists is obtained from averaging the ﬁnite truncated
squared Mahalanobis distances of the assigned peak pairs. Denoting the
peaks in pair (i,j) as p,- and pf, we obtain

1
anthem 2 win). (2)

0067:1112

Hierarchical correspondence estimation: rather than relying on one
predetermined reference peak list for the alignment, we follow the idea
of Mueller et al. (2007) and apply a greedy pairwise hierarchical iterative
approach: This strategy eliminates the bias toward a single LC/MS run, which
occurs when using a reference peak list in the correspondence estimation.
Nonetheless, SIMA can also use a single reference peak list to compute
multiple peak correspondences. This may be beneﬁcial if one of the peak
lists is a priori known to be correct.

We successively combine the peak lists until all individual peak lists
have been absorbed in one master peak list. In parallel, we construct
correspondence groups, i.e. sets of peaks from the individual peak lists that
match (see Supplementary Material C for details). Let ’P(t) be the set of peak
lists that still have to be combined in iteration t. We initialize 73(0): ’P, that
is with all original peak lists. During the course of the iterations, ’P(t) may
contain both members of the set of original peak lists and/or representatives
for previously combined lists. In each iteration, the two most similar peak
lists according to Equation (2) are combined. Assume that in iteration step
t these are Pd 6 ’P(t) and Pg 6 ’P(t). First, an empty peak list Pave is created,
and all peaks that are unique to either Pd or P9 are added to it. Then, all
peak correspondences (i , j) e fave between Pd and P9 are considered, and one
representative peak is added for each correspondence pair. Its (rt) and (m / z)
values are set to the mean over the respective values of all peaks that in
previous iterations have contributed to the two merging peaks. Finally, Pd
and P9 are removed from ’P(t) and replaced by the combined peak list Pave
yielding ’P(t + 1). The correspondence groups are updated accordingly. After
D—1 steps, all peak lists have been combined, i.e. |’P(D— 1)| = 1.

We note that the greedy nature of the correspondence estimation allows
for an efﬁcient implementation. However, once merged, peaks cannot be split
at later iterations, which may suggest that the respective peaks should rather
be kept separate. This typically does not pose a practical problem, since
by setting the thresholds in W the experimentalist can control the merging
behavior of peaks.

Let N be the number of resulting correspondence groups. After iteration
D— 1, the retention times associated with the peaks in the N groups are
stored in a retention time correspondence map C 6 RN XD. More precisely,
element cngd of C holds the retention time of the peak in Pd that is a member in
correspondence group n. If no such peak exists, the respective entry is ﬂagged
to indicate a missing correspondence. Each row vector on 6 RD , n: 1, . . . ,N,
in C can be interpreted as a correspondence point in the D-dimensional
retention time space (see Figs 4 and 6).

2.2 Maximum likelihood path estimation

Retention time distortion function: deﬁne a master time scale (MTS) in the
retention time space by equidistant sampling of the line of unit slope (that is
the angle bisection line for D = 2). Further, deﬁne the retention time distortion
function (RTDF) as the function that describes the retention time shifts for all
peak lists. Its trajectory in retention time space thus explains the observed

correspondence points cn,n=1,...,N. For a set of perfectly reproducible
LC/MS measurements, all on lie on the line of unit slope such that the RTDF
is equivalent to the latter. In practice, however, retention time measurements
are subject to correlated noise and non-linearly deviate from the ideal case.
Given an estimate for the RTDF, the distortion of a peak can be identiﬁed
by back-projecting its retention time onto the MTS (cf. Fig. 5).

The behavior of the estimate should be in agreement with the fundamental
physical properties of LC/MS. We argue that a suitable estimation procedure
should: (i) yield a RTDF that features a certain degree of smoothness since
we do not expect abrupt changes in the elution process, (ii) ensure that the
RTDF is monotonous such that the elution order is preserved across runs
(Kirchner et al., 2007), (iii) be robust with respect to measurement errors
and naturally deal with outliers that may originate from incorrect matches
in the initial correspondence estimation and (iv) be independent of the input
order of peak lists. We cast the problem of estimating the RTDF into a
maximum likelihood (MFL) estimation framework, i.e. we ﬁnd the RTDF
as the function that best explains the correspondence points and at the same
time fulﬁlls the above constraints. To this end, we deﬁne a customized kernel
that incorporates all prior assumptions. Its convolution with the (partially
incomplete) observed peak correspondences yields a retention time ridge.
The path along the highest points of this ‘height proﬁle”, i.e. the maximum
likelihood path, is the RTDF that describes the non-linear retention time
distortions across the set of peak lists.

Constructing a retention time ridge using a sigmoid kernel: whereas
smoothness is guaranteed by employing a smooth kernel, the monotonicity
of the ridge in retention times is more difﬁcult to achieve. Figurativer
speaking, the kernel (cf. Fig. 2) should induce two preferred areas (lower
left, upper right) and two ‘forbidden regions”: when convolving it with all
correspondence points in C, the response at a pointx e R2 merely depends on
the contribution of correspondence points whose retention times are not both
lower or both higher than the ones of x. This encourages the monotonicity
of the ridge. Whereas, theoretically speaking, sets of correspondence points
can be constructed that lead to paths that violate the monotonicity constraint,
all point sets that can be considered a reasonable outcome of a set of
LC/MS measurements yield a monotonous result. To make our approach
more robust against measurement errors, an adaptive kernel parameter is
used that controls the slope and hence the smoothness of the kernel and
decreases the inﬂuence of outliers. Finally, our method is independent of the
input order of the peak lists, since we use an equal kernel proﬁle along all
dimensions. By construction, all discussed properties carry over to the higher
dimensions.

More formally, let the kernel K :xe RD —>(0, 1) be an outer product of
sigmoid functions k(x,ot) = 1/(1 +e‘“) where

D D
K(x) = H k(xd.a>+ Hkr—xw). (3)

d2] d2]

Here, xd e R denotes the d-th component of x, and a e R+ is a parameter
that controls the inﬂuence of the estimated correspondences in the retention
time space (see Fig. 4c). A higher value for 01 yields a steeper slope of the
sigmoid function k(-, -) and thus increases the local inﬂuence of the kernel
(see below). For an arbitrary point x 6 RD, we obtain the cumulative kernel
response H with regard to all correspondence points on with the convolution

1 N
H(x) = 5 Emma—en) = (4)
n:l
1 N D D
5 Zara.) [11km —ci,i.a>+ Hkr—xi +Cn,d~€¥):| (5)
n:l d2] d2]

where w(cn) is a weighting factor and Q = 221:] w(cn). To deal with missing
correspondences, we replace k(-, -) with the adapted version k(-, -), given by
k(xd — cmauot) = k(xd —c,,,d,ot) if cmd 75 0 and 1 otherwise. In both cases, an
analytical solution for the derivative H ’ (x) exists (cf. Supplementary Material
DiF). The intuition behind the adaption is as follows: in case of missing

 

989

112 /3.to's[BumoprOJXO'soneuiJOJHrorqp:duq uroii popeo1umoq

9103 ‘0g15n8nv uo ::

B. Voss et al.

 

 

Fig. 2. Plot of the sigmoid kernel deﬁned in Equation (3) for (a) D22 and
(b) D=3. In both cases, the kernel has two preferred areas along the angle
bisection line (light areas) and (2D — 2) ‘forbidden regions” (dark areas).

0.8
0.5
0.:

0.2 ._

    

\” . '.'.__..-. .
\-”--_ - -” retention t'rmetpeakl

rat 11

Fig. 3. 3D plot of a retention time ridge formed by convolution of the
correspondence points from two peak lists (dots) with the sigmoid kernel
(cf. Fig. 2a). Also see movie 3 (Supplementary Material).

correspondences, the correspondence points degenerate to correspondence
hyperplanes (cf. Fig. 6). Although incomplete, these correspondences still
constrain the RTDF in the orthogonal subspace within the retention time
domain. We hence adapt the kernel to be uniform along the missing
dimensions. This way, dimensions for which no correspondence information
is available are simply ignored, whereas all other information is used
whenever available. Here, we use equal weights for all correspondence
points, that is w(cn) = 1 Vn: 1, . . . ,N. However, different weighting schemes
are possible (cf. Supplementary Material G). An exemplary retention time
ridge is shown in Figures 3 and 4.

ML-estimation of the retention time distortion function: using the
sigmoidal kernel from above, the RTDF can be estimated by ﬁnding the
points on the highest path through the retention time ridge that correspond
to the time points of the MTS. We start with sampling a set of L equidistant
points y; 6 RD ,1: 1, . . . ,L from the line of unit slope that constitute the MTS,
and perform L gradient ascents toward the retention time ridge, starting
from each of the y;. Each gradient ascent is performed on a subspace of
RD (cf. Fig. 4). These subspaces 7-11 are hyperplanes perpendicular to the
line of unit slope and contain the y;, that is, they are described by the
normal vector [1,..., 1] and support vectors y;. The gradient ascents yield L
points x; 6 RD whose piecewise linear interpolation approximates the RTDF.
Mathematically, this procedure is similar to a maximum likelihood (ML)
estimation where K (x) e (0, 1) acts as a prior and we determine the x; by

L
argmax ZH(X1) subject to x; 6 7-11. (6)

(X1.....XL)[:1

Formulas for the normalized gradient directions along which we search for
the maxima and for the update of the current estimate of x; in iteration t are

 

2..
m
v
1500
7'"
5.,
1500

l

retention time [peak list 2]
retention time [peak list 21

 

..\

   

 

'\
'H..i|

retention time [peak list 1: 15': o

 

 

‘P‘\

o
J
8% retention time [peak list 1! 15°"

(C)
.atfm——_____:

-20 40 0 to 20

 

 

 

0.3
0 T5

 

 

 

 

Fig. 4. (a) Contour plot of the retention time ridge (cf. Fig. 3). (b)
Correspondence points (dots) and selected hyperplanes 7-11. (c) The
intersections of the retention time ridge with these hyperplanes yield height
proﬁles on which the gradient ascents are performed. The proﬁles of 7-1 120 and
7-1240 show distinct bumps. There, the correspondence point density is high,
leading to a larger kernel parameter a, i.e. a steeper kernel that emphasizes
the inﬂuence of local points. The opposite holds, e.g. for 7-150.

derived in Supplementary Material D. We propose to use an adaptive step
size for the gradient ascents based on the Powe117Wolfe conditions (Powell,
1976) for increased robustness (Supplementary Material F). Note that when
performing the gradient ascents, our method never computes the retention
time ridge in its entirety but only evaluates H (x) at a few points.

Adaptive kernel bandwidth: naturally, the density of the correspondence
points varies throughout retention time space. In such scenarios, the
performance of non-parametric kernel methods can be improved by
introducing an adaptive kernel bandwidth (Brockmann et al., 1993). Thus, we
locally adapt the kernel parameter a as follows: in low-density areas, a is set
to low values to achieve a higher robustness and avoid artifacts in the RTDF
caused by single observations. In areas of high density, the smoothness of the
RTDF is reduced by using larger values for 01 (cf. Supplementary Material
H). This trades off bias and variance and reduces the overall error compared
with a non-adaptive scheme.

2.3 Retention time correction

After performing the L gradient ascents and subsequent linear interpolation,
we obtain the piecewise linear RTDF which we use for correcting the
retention times of the peaks observed in the D peak lists. Assume we want
to correct the retention time for peak 11,-: [(m/z),,(rt),»,z,»] in peak list Pd.
We ﬁrst ﬁnd ml, the intersection of the RTDF with the hyperplane given
by support vector u with ad=(rt), and 0 elsewhere and normal vector
a/ Hall. We then identify that point on the line of unit slope that is closest
to this intersection point (m2). The distance of those two points in the d-th
dimension constitutes the amount by which the retention time ofpl- needs to
be corrected. The procedure is repeated for all peaks and all peak lists (see
Fig. 5).

Second correspondence estimation: correction of the retention times
after the ﬁrst iteration may give more correspondences. Hence, a second
correspondence estimation (cf. Section 2.1) may yield a slightly more
complete correspondence map C. However, practical impact is limited due
to the overall robust nature of SIMA.

 

990

112 /3.to's[BumoprOJXO'soneuiiomrorqp:duq uroii popeo1umoq

9103 ‘0g isnﬁnv uo ::

Simultaneous Multiple Alignment of LC/MS Data

 

\.

retention time {peak list 2]

 

 

retention time [peak list 1]

Fig. 5. Retention time correction for D=2 where we correct the retention
time for peak pi=[(m/z)i,(rt)i,zi] in peak list P2. We obtain m1 as the
intersection of y = (rt), with the retention time distortion function (RTDF). By
back-projection onto the MTS, we obtain m2. The difference in the vertical
distance between m1 and m2 constitutes the amount by which the retention
time ofpl- needs to be shifted.

3 EXPERIMENTS

Real-world data: Lange et al. (2008) compared a total of six
alignment algorithms on four publicly available proteomics (P1, P2)
and metabolomics (M 1, M2) datasets, including msInspeCt (May
et al., 2007), MZmine (Katajamaa and Oresic, 2005; Katajarnaa
et al., 2006), OpenMS (Lange et al., 2007; Sturm et al., 2008),
SpecArray (Li et al., 2005), XAlign (Zhang et al., 2005) and XCMS
(Smith et al., 2006). In addition, Pluskal et al. recently proposed
MZmine 2 with RANSAC aligner (Pluskal et al., 2010). We obtained
the proteomics datasets used by Lange et al. (2008) from the
Open Proteomics Database (OPD) (Prince et al., 2004). Dataset
P1 originates from an Escherichia coli sample and contains two
LC/MS runs of six fractions. Dataset P2 represents three LC/MS
runs of ﬁve fractions of different cell states of Mycobacterium
smegmatis. The datasets were analyzed by LC/MS/MS on an ESI ion
trap mass spectrometer (ThermoFinnigan Dexa XP Plus), exported
in centroid mode and preprocessed using TOPP tools (Kohlbacher
et al., 2007) resulting in a peak list of (m/z) and (rt) positions,
which served as input for all alignment procedures. Each run of a
fraction contains between 400 and 5800 peaks. Lange et al. (2008)
optimized parameters for all approaches on the ﬁrst fraction of each
dataset and generated a partial ground truth by linking MS/MS
search results from SEQUEST to the LC/MS spectra. A detailed
description of all steps and the parameterization of the algorithms is
given in Supplementary Material I and (Lange et al., 2008).

For the metabolomics samples, Lange et al. (2008) analyzed
Arabidopsis thaliana leaf tissue using an API QSTAR Pulsar
i (Applied Biosystems/MDS Sciex) for the M 1 dataset and a
MicrOTOF-Q (Bruker Daltonics) for the M2 dataset resulting in
44 and 24 LC/MS spectra, respectively. Peaks were identiﬁed using
XCMS (Smith et al., 2006) resulting in 4000 to 17 600 data points
per LC/MS spectrum. They generated ground truth by identifying
highly conﬁdent peak groups, which were reproducible over at
least four runs and did not only have the same retention time,
but also showed high correlation in their Chromatographic peak
shapes. Parameters were optimized on the complete datasets for all
algorithms since no separate fractions were available. Even though
SIMA can operate without a predetermined alignment order, it was
run in the same starwise manner (i.e. using one predeﬁned reference
against which all remaining runs were aligned) that was used for the
other algorithms and the ground truth generation in order to enable

a fair comparison (Otherwise, SIMA might beneﬁt from not using
a potentially incomplete reference). Again we refer to Lange et al.
(2008) and the Supplementary Materials for a detailed description
and the parameterization of the algorithms.

Performance measures: to measure the performance of an
approach, we compute its precision (PR) and recall (RE). Precision

is the fraction of correctly aligned peaks among all peaks

# correctly aligned peaks
# aligned peaks

recall corresponds to the fraction of correctly aligned peaks by

one approach among all correct peaks according to the ground

truth, RE = # corgectly aligned peaks
correct peaks

_ 2.PR.RE . . . .

the F-measure F _ W, Wthh summar1zes pre01s10n and recall

value by computing their harmonic mean (Gay et al., 2002).

aligned by one approach, PR: , whereas

. To simplify comparison, we use

4 RESULTS AND DISCUSSION

SIMA yields competitive or superior results: in Table 1, the results
of the comparison are detailed. With regard to recall, SIMA and
MZ-mine 2 (RANSAC) tie at the best performance with an average
recall of 0.90. While MZ-mine 2 (RANSAC) and OpenMS feature
better recall values for the P1 and P2 datasets, SIMA shows better
recall performance on the M 1 and M2 data. With regard to precision,
i.e. the likelihood of results being correct, SIMA shows the best
performance in all datasets with an average precision value of 0.81.
This is also reﬂected in the F -measure, which combines recall and
precision. Here, SIMA shows the best overall performance with an
average value of 0.85. SIMA always is among the best two methods
with respect to the F -measure (P1, P2) or even performs best (M 1,
M 2). A complete list of the results on all fractions of all datasets is
given in Supplementary Material J.

It is important to note that the comparison favors the algorithms
that require a reference peak list: the ground truth generated by
Lange et al. (2008) is based on the same reference run as used for
the alignment. For independently generated ground truth, results
for any reference spectrum-based approach are bound to deteriorate
since not all peaks present in the ground truth necessarily need to
be in the reference peak list. The performance measurements of
hierarchical approaches such as SIMA are not affected by this kind
of ground truth generation.

SIMA is especially powerful when aligning numerous spectra:
The strength of the SIMA approach is particularly visible on the
metabolomics (M1 and M 2) datasets. Here, it outperforms the other
methods with regard to precision as well as recall. The metabolomics
datasets contain more LC/MS spectra (44 and 24, respectively)
than the proteomics datasets (2 and 3, respectively) and, thus, also
show signiﬁcantly more missing correspondences. Further, visual
inspection conﬁrms that these datasets are less perturbed by noise
and show a more characteristic structure, which beneﬁts more from
the non-linear ﬁtting of SIMA than the proteomics set, for which
linear methods already show good results.

Exploiting incomplete correspondence information is feasible:
visual examples of SIMA alignment results are given in Figure 6 as
well as in Supplementary Material K and movies 1 and 2. Figure 6
and movie 1 show an (m/z) 500—800 subrange of the ﬁrst three
peak lists in the M 1 dataset, in which 8 correspondence groups are
complete, and incomplete information is available for an additional
14 groups (omitting single entry correspondence groups for visual
Clarity). The exploitation of partial correspondence groups yields

 

991

112 /3.to's[BumoprOJXO'soneuiiomrorqp:duq uroii popeo1umoq

9103 ‘0g isnﬁnv uo ::

B. Voss et al.

 

Table 1. Comparison of the results of seven current alignment approaches with SIMA based on the datasets of the comparative studies by Lange et al. (2008)

and Pluskal et al. (2010)

 

 

Data Measure ms-Inspect MZ-mine Open-MS Spec-Array X-Align XCMS MZ-mine 2 (RANSAC) SIMA
P1 RE 0.66 0.85 0.93 0.70 0.88 0.81 0.94 0.92
PR 0.50 0.89 0.93 0.70 0.88 0.80 0.94 0.94
F 0.57 0.87 0.93 0.70 0.88 0.80 0.94 0.93
P2 RE 0.58 0.77 0.83 0.50 0.73 0.70 0.75 0.76
PR 0.26 0.66 0.72 0.35 0.63 0.59 0.68 0.72
F 0.36 0.71 0.77 0.41 0.67 0.64 0.71 0.74
M1 RE 0.27 0.89 0.87 7 0.88 0.94 0.91 0.92
PR 0.46 0.74 0.69 7 0.70 0.70 0.74 0.75
F 0.34 0.81 0.77 7 0.78 0.80 0.82 0.83
M2 RE 0.23 0.98 0.93 7 0.93 0.98 0.98 0.99
PR 0.47 0.84 0.79 7 0.79 0.78 0.83 0.84
F 0.31 0.90 0.85 7 0.85 0.87 0.90 0.91
All RE 0.43 0. 87 0.89 7 0.85 0.86 0.90 0.90
PR 0.42 0.78 0.78 7 0.75 0.72 0.80 0.81
F 0.39 0.82 0.83 7 0.80 0.78 0.84 0.85

 

Recall (RE), precision (PR) and the F -measure (P) are reported as an average over various runs on two proteomics (P1, P2) and two metabolomics (M1, M2) datasets as well as
an overall average of all datasets (All). Bold print highlights the overall best values for each dataset. MZ—mine 2 (RANSAC) and SIMA show the best overall recall, while SIMA

features the highest values for precision and the F -measure.

mmnrian time '
function [RTDF]
o complete data point:
_ _ _ m-ssmg In peak Hit 1

 

missing in peak list 2

_._ _ missing In peak list :
_-_- -_,______,/_-

 

 

 

r' --_ _._—_._-__

 

 

 

300

3'51] 3‘

 

 

Lg!
mo 4<

a?
3
GI

2E”

____-"-_-_T___._.___

  
  

550
500

II
|
ii
I
'I
I
_II-
|
:l
l
'I
:l
l
'I
:l
l
'I
:l
I
It
i.

 

 

Q

550 a?
.9
Ev

500

 

retention time [peak ﬁrst 3!
want: 550 50D 650 TDD 750 500

a
o

550 600 650 1‘00 1‘50 000

retention timE Ipeak list I?

Fig. 6. Visualization of the alignment approach on the peak lists of the ﬁrst
three spectra of the M 1 dataset for the range of 50(L800 s in retention time:
only 8 peaks (dots) in this range could be matched in all peak lists, whereas
14 peaks were additionally available in two of the three peak lists only. Since
these peaks contain information for two dimensions, but are non-informative
for the third, they are displayed by straight lines parallel to the coordinate axis
of the missing information. The computed retention time distortion function
(red) still beneﬁts from these straight lines as they help pinpointing its optimal
path through this area of few observations.

valuable constraints for guiding the RTDF curve through retention
time space and provides robustness in cases where single complete
retention time observations show extreme values. The latter is
especially prevalent with the obvious outliers present in the mass
range (m /z) 800—1100, as illustrated in Supplementary Material K
and movie 2. SIMA uses all information available from the data
by including missing correspondences and can thus base estimates
on larger effective numbers of observations compared with other
approaches (also cf. Supplementary Material K and L).

Hierarchical correspondence estimation renders distinguished
reference spectra obsolete: SIMA eliminates the problem of
selecting a distinguished reference spectrum or peak list,
respectively. In practical applications, obvious reference candidates
are neither easily obtained nor guaranteed to exist. Consequently,
SIMA-based alignment is not subject to a reference bias and
independent of the peak list processing order.

SIMA is robust with regard to parameter settings: considering
that for the proteomics datasets the ﬁrst fraction was used for
parameter optimization, it is interesting to observe that SIMA is
not performing as well as, e.g. OpenMS on these fractions. Still,
SIMA shows superior performance on the remaining fractions, for
which the parameters identiﬁed on the ﬁrst sections were used
(cf. Supplementary Material J). This indicates that SIMA is not
overly dependent on parameter settings since it not only does beneﬁt
from the overﬁtting on the ﬁrst fractions where parameters were
adjusted to give optimal results, but also shows high-quality results
on datasets where parameter optimization was not performed. This
can at least partially be explained by the fact that (given reliable
charge state information) SIMA only requires two parameters in the
matrix W for correspondence estimation, which in our experiments
have proven robust to changes. Choosing a larger region for the
correspondence estimation results in additional random data points
for the kernel regression. However, as long as those additional points
are unstructured, they do not bias the estimate for the RTDF, since
our approach is robust to outliers. Choosing a smaller region results
in fewer data points and additional missing correspondences, which
can be handled as long as not all data points of a region are removed.

5 CONCLUSION

We introduced SIMA, a novel approach for the simultaneous
alignment of multiple LC/MS peak lists. SIMA is speciﬁcally
tailored to the problems arising from large-scale experiments where

 

992

112 /3.to's[BumoprOJXO'soneuiiomrorqp:duq mot} popco1umoq

9103 ‘0g isnﬁnv uo ::

Simultaneous Multiple Alignment of LC/MS Data

 

only few peaks are consistently present in all runs. Thus, in contrast
to many competing algorithms, SIMA can naturally handle missing
correspondences. In addition, it does not rely on a single, error-free
reference run as basis for an alignment, but weights the inherent
measurement errors of each run against each other.

SIMA requires only very limited user interaction, since it is robust
with respect to its two parameters, the thresholds for the tolerated
retention time and m/z difference between two peaks. Moreover,
these parameters can typically directly be inferred from the expected
measurement error in the experiment.

An experimental comparison on real-world proteomics
and metabolomics data to seven state-of-the-art approaches
demonstrates excellent performance of our method. While
matching the recall of MZ-mine 2 (RANSAC), the best performing
method from previous comparisons (Lange et al., 2008; Pluskal
et al., 2010), it delivers the best precision and overall F-score
values.

Conceptually, SIMA is not limited to the alignment of LC/MS
data: by redeﬁnition of the thresholded squared Mahalanobis
distance function, it can easily be adapted to any time series with
discrete events (cf. Supplementary Material A). SIMA is freely
available from http://hci.iwr.uni-heidelberg.de/MIP/Software.

ACKNOWLEDGEMENTS

We like to thank Bernhard Kausler, Anna Kreshuk, Sebastian
Boppel, and Xinghua Lou (all University of Heidelberg) for fruitful
discussions, as well as both of our reviewers for constructive
criticism and comments.

Funding: We gratefully acknowledge ﬁnancial support by the DFG
under grant no. (HA4364/2-1 to M.H., B.Y.R.); the Robert Bosch
GmbH (to F.A.H.); DFG GRK-1114 (to B.V.).

Conﬂict of Interest: none declared.

REFERENCES

Aebersold,R. and Mann,M. (2003) Mass spectrometry-based proteomics. Nature, 422,
1987207.

America,A.H.P. and Cordewener,].HC. (2008) Comparative LC-MS: a landscape of
peaks and valleys. Proteomics, 8, 7317749.

Bellew,M. et al. (2006) A suite of algorithms for the comprehensive analysis of complex
protein mixtures using high-resolution LC-MS. Bioinformatics, 22, 190271909.
Brockmann,M. et al. (1993) Locally adaptive bandwidth choice for kernel regression

estimators. J. Am. Stat. Assoc, 88, 1302.
C1ifford,D. et al. (2009) Alignment using variable penalty dynamic time warping. Anal.
Chem., 81, 100a1007.

Cox,J. and Mann,M. (2008) MaxQuant enables high peptide identiﬁcation
rates, individualized p.p.b.-range mass accuracies and proteome-wide protein
quantiﬁcation. Nat. Biotechnol, 26, 136771372.

Dettmer,K. et al. (2007) Mass spectrometry-based metabolomics. Mass Spectrom. Rev.,
26, 51778.

Gale,D. and Shapley,L. (1962) College admissions and the stability of marriage. Am.
Math. Mon., 69, 15, 9.

Gay,S. et al. (2002) Peptide mass ﬁngerprinting peak intensity prediction: extracting
knowledge from spectra. Proteomics, 2, 137471391.

Katajamaa,M. and Oresic,M. (2005) Processing methods for differential analysis of
LC/MS proﬁle data. BM C Bioinformatics, 6, 179.

Katajamaa,M. et al. (2006) MZmine: toolbox for processing and visualization of mass
spectrometry based molecular proﬁle data. Bioinformatics, 22, 634436.

Khan,Z. et al. (2009) Protein quantiﬁcation across hundreds of experimental conditions.
Proc. Natl Assoc. Sci USA, 106, 15544715548.

Kirchner,M. et al. (2007) amsrpm: robust point matching for retention time alignment
of LC/MS data with R. 18, 12.

Kohlbacher,O. et al. (2007) TOPP - the OpenMS proteomics pipeline. Bioinformatics,
23, e1914197.

Lange,E. etal. (2007) A geometric approach for the alignment of liquid chromatography
mass spectrometry data. Bioinformatics, 23, 2737281.

Lange,E. et al. (2008) Critical assessment of alignment procedures for LC-MS
proteomics and metabolomics measurements. BMC Bioinformatics, 9, 375.

Li,X. et al. (2005) A software suite for the generation and comparison of peptide arrays
from sets of data collected by liquid chromatography-mass spectrometry. Mol. Cell
Proteomics, 4, 132871340.

May,D. et al. (2007) A platform for accurate mass and time analyses of mass
spectrometry data. J. Prot. Res., 6, 268572694.

Mueller,L.N. et al. (2007) SuperHirn - a novel tool for high resolution LC-MS-based
peptide/protein proﬁling. Proteomics, 7, 347073480.

Pluskal,T. et al. (2010) MZmine 2: modular framework for processing, visualizing, and
analyzing mass spectrometry-based molecular proﬁle data. BMC Bioinformatics,
11, 395.

Podwojski,K. et al. (2009) Retention time alignment algorithms for LC/MS data must
consider non-linear shifts. Bioinformatics, 25, 7587764.

Powell,M.J.D. (1976) Some global convergence properties of a variable metric
algorithm for minimization without exact line searches. In Cottle,R.W. and
Lemke,C.E. (eds) Nonlinear Programming, SIAM-AMS Proceedings Volume IX,
SIAM, Philadelphia, PA.

Prakash,A. et al. (2006) Signal maps for mass spectrometry-based comparative
proteomics. Mol. Cell Proteomics, 5, 423432.

Prince,J.T. et al. (2004) The need for a public proteomics repository. Nat. Biotechnol,
22, 471472.

Shevchenko,A. and Simons,K. (2010) Lipidomics: coming to grips with lipid diversity.
Nat. Rev. Mol. Cell Biol., 11, 5937598.

Smith,C.A. et al. (2006) XCMS: processing mass spectrometry data for metabolite
proﬁling using nonlinear peak alignment, matching, and identiﬁcation. Anal. Chem,
78, 7797787.

Sturm,M. et al. (2008) OpenMS - an open-source software framework for mass
spectrometry. BMC Bioinformatics, 9, 163.

Vandenbogaert,M. et al. (2008) Alignment of LC-MS images, with applications to
biomarker discovery and protein identiﬁcation. Proteomics, 8, 65W672.

Zaia,J. (2010) Mass spectrometry and glycomics. OMICS, 14, 401418.

Zhang,X. et al. (2005) Data pro-processing in liquid chromatography-mass
spectrometry-based proteomics. Bioinformatics, 21, 40544059.

 

993

112 /3.to's[BumoprOJXO'soneuiiomrorqp:duq mot} popco1umoq

9103 ‘0g isnﬁnv uo ::

