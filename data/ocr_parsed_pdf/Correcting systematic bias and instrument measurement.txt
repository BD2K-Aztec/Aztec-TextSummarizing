Bioinformatics, 31 (23), 2015, 3838—3840

doi: 10.1093/bioinformatics/btv437

Advance Access Publication Date: 4 August 2015
Applications Note

 

 

Sequence analysis

Correcting systematic bias and instrument
measurement drift with mzRefinery
Bryson C. Gibbons1, Matthew C. Chambersz, Matthew E. Monroe1,

David L. Tabbz and Samuel H. Payne1'*

1Biological Sciences Division, Pacific Northwest National Laboratory, Richland WA 99354 and 2Department of
Biomedical Informatics, Vanderbilt University School of Medicine, Nashville, TN 37232, USA

*To whom correspondence should be addressed.
Associate Editor: Alfonso Valencia

Received on March 9, 2015; revised on June 8, 2015; accepted on July 21, 2015

Abstract

Motivation: Systematic bias in mass measurement adversely affects data quality and negates the

advantages of high precision instruments.

Results: We introduce the mzRefinery tool for calibration of mass spectrometry data files. Using
confident peptide spectrum matches, three different calibration methods are explored and the opti—
mal transform function is chosen. After calibration, systematic bias is removed and the mass meas—
urement errors are centered at 0 ppm. Because it is part of the ProteoWizard package, mzRefinery

can read and write a wide variety of file formats.

Availability and implementation: The mzRefinery tool is part of msConvert, available with the
ProteoWizard open source package at http://proteowizard.sourceforge.net/

Contact: samuel.payne@pnnl.gov

Supplementary information: Supplementary data are available at Bioinformatics online.

 

1 Introduction

For data analysis algorithms to take advantage of the higher accuracy
of newer mass spectrometers, it is essential to remove systematic bias
in mass measurement. Mass measurement error may originate from a
variety of sources, e.g. power supply voltagejtemperature drift, space
charge effects, temperature/humidity variation in the laboratory, vac—
uum system stability, etc. Real—time calibration adjusts the mass meas—
urement during data acquisition (Charles, 2003; Olsen et (11., 2005;),
typically using a known species as an internal reference. Lock mass
methods may also be used to calibrate after the run has completed
(Zhang et (11., 2011). A separate method for calibration utilizes spec—
trum identifications to estimate measurement error and guide mass
correction (Cox et (11., 2011; Petyuk et (11., 2010).

We present a new calibration tool, mzRefinery, written directly
into the ProteoWizard package (Kessner et (11., 2008). Like existing
tools, mzRefinery models mass measurement error based on peptide
identifications and finds the optimal calibration function. In add—
ition to simply adjusting the precursor ion, mzRefinery corrects the
m/z of every ion in any high—resolution spectrum. With the

©The Author 2015. Published by Oxford University Press.

increasingly common use of high—resolution tandem mass spectra in
PRM and DIA experiments, more data are being created with high—
resolution fragments. Given the inherent complexity of such multi—
plexed fragmentation protocols, calibrating the mass accuracy will
be a great benefit for these experiments.

2 Implementation

mzRefinery has three different methods for calibration. The goal of
each method is to identify the m/z offset that should be applied in
creating a calibrated spectrum file. The software architecture is spe—
cifically designed to allow for new calibration methods to be written
and seamlessly integrated. A detailed description of the mass spec—
trometry data files, software class architecture and operation are
provided in Supplementary Data and Supplementary Figure $1.

2.1 Global shift

Using the sub—class AdjustSimpleGlobal creates a single global shift.
For every confident identification in the szdentML file (default

3838

This is an Open Access article distributed under the terms of the Creative Commons Attribution License (http://creativecommons.org/licenses/by/4.U/), which permits
unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.

112 /310'slcu1n0fp103x0"sotJBuiJOJutotq/ﬁduq 11101} popcolumoq

91oz ‘Og anﬁnv uo ::

Correcting instrument measurement drift with mzReﬁnery

 

q < 0.01), the exact monoisotopic m/z is calculated and compared
with the observed m/z (using xml field experimentalMass
ToCharge). Mass errors >:0.2 m/z are filtered to avoid using data
where the monoisotope was incorrectly reported by the spectrum
file. After converting the error to ppm, the errors are collected into
0.5 ppm bins. After the entire file is processed, the median ppm error
is calculated and used as the global shift. In the output szL file,
the SpectrumList_mzRefiner object applies the global ppm error to
every peak in every high—resolution spectrum.

2.2 LC—dependent shift
Calculating the LC—dependent shift uses sub—class
AdjustByScanTime. In general, the process is very similar to the cal—
culation of a global shift. For every confident identification, both
the ppm error and LC time are calculated. LC time is derived from
the ScanStartTime field in szdentML, or from ScanStartTime in
szL. Errors are ordered by time and sorted into bins containing
all scans within a 75—s period. The median ppm error of the bin is
calculated, and smoothed using the median of neighboring bins
(Supplementary Fig. S2). Bins in addition to the i+ 1 and i — 1 neigh—
bors are included as necessary to achieve a minimum of 100 identifi—
cations in the weighted average. When writing out the calibrated
szL file, the applied mass correction is generated through a linear
interpolation of the median error values based on the scan time. By
binning the data and then preforming a linear fit, the algorithm ap—
proximates a more complex smoothing.

2.3 m/z—dependent shift

Calculating the m/z—dependent shift uses sub—class AdjustByMass.
This function is exactly like the LC—dependent shift except that
measured m/z is tracked as the dependent variable.

3 Results and discussion

The mzRefinery program is designed to calibrate any mass spec—
trometry data file based on a preliminary set of identifications. The
algorithm is implemented within the msconvert program, part of the
ProteoWizard suite, and therefore natively understands multiple in—
put and output formats (Chambers et (11., 2012). As described in the
Supplementary Data, we use mzRefinery to calibrate MS and MS/
MS data from Thermo Orbitrap and Bruker QqTOF instruments.
All files were searched with the appropriate database and param—
eters by both MSGF+ and MyriMatch. This preliminary set of
PSMs was used as input to the msconvert program. The resulting
szL file has updated (calibrated) m/z values. Figure 1 shows the
mass measurement error present in the original szL files. We note
that for the file in Figure 1, the error changed during the LC run,
and is effectively eliminated by mzRefinery. The calibrated file
shows no such dependency.

When viewing the performance of the algorithm across multiple
files, it is remarkably consistent. For the 91 files tested, the original
median error of any given file ranged between —2.8 and +8.4 ppm
(average 1.4, SD 2.3). After calibration the median error ranged be—
tween —0.59 and +0.28 (average 0.02, SD 0.08), with 70 of the 91
files having a median error <i0.05 ppm. Thus, the method accur—
ately removes any systematic bias in mass measurement.

A primary goal of the project is to make the mzRefinery algo—
rithm broadly accessible. As part of the ProteoWizard suite, it is
available as both an executable program and a platform for further
development. The software architecture is intentionally written to
be extensible and new calibration methods are automatically

 

 

 

 

 

3839
0 nd Ruined
so: m
m m
not. mu
"no so
I z
.5. ,3
V): m.
an m
vac :m- -
56 K 30 J -L

 

-50-£'5--ﬂ-35-N x-m-is-v: -: n 5 v: :5 2: :5 H1541”! ’0 -so-1:-In-:s-3o-2s-:o-J:-m -s C sin 1': m :5 n 35 ac as so
ummm uum-wim-

mmwm Sun ﬂmﬂdhd

 

 

 

_ Um 21.4w:

 

 

 

 

 

um ism mm m m 15m am am :am zsm m me me m am am
Sun'meh: mm...“

Fig. 1. Calibration. The top two graphs show a histogram of mass error, calcu-
lated using PSM identifications for dataset sample3-B,BBA,01,926. This par-
ticular file has a bimodal error in the original. After calibration (top right),
the error has been removed. The bottom two graphs plot mass measure-
ment error according to scan number. The original data (bottom left) show
that the error varies dramatically with time. By using the LC-dependent
calibration, the errors are removed (bottom right)

considered. Several reasons might prompt design of a new calibra—
tion method. In the current implementation, only one dependent vari—
able is considered (i.e. LC time or m/z). However, previous study has
shown that additional improvement is possible with more complex
multivariate dependencies (Petyuk et (11., 2010). A second motivation
would be to create a new calibration for a distinct instrument or mass
analyzer. Although the current software has been shown to perform
well on both Orbitrap and TOF instruments, we acknowledge that
keeping up with new instrumentation is an ongoing process.

A suggested workﬂow for using mzRefinery is to first search each
LC—MS/MS dataset for PSMs using fully tryptic search rules, no dy—
namic modifications and a relatively wide parent ion mass window,
e.g. :5 0 ppm. These parameters allow the search engine to quickly
search for confident PSMs, yet allow for identifying PSMs even if the
data were acquired when the instrument was not at its optimal cali—
bration. Next, use mzRefinery to recalibrate each dataset using the
identified PSMs from this initial search. Now re—search for PSMs in
the data, but this time using the calibrated szL files, a partially
tryptic search, dynamic modifications and a narrower parent ion mass
window, e.g. :10 ppm or even :ppm. Use of this narrow mass win—
dow will result in fewer false positives at a given false discovery rate.

Acknowledgement
The authors thank Vlad Petyuk for help discussions.

Funding

Portions of this work were supported by the NIH National Institute of
General Medical Sciences (GM103493), and by the Department of Energy
Office of Biological and Environmental Research Genome Sciences Program
under the Pan-omics program. S.H.P. was supported by the U.S. Department
of Energy, Office of Science, Office of Biological and Environmental
Research, Early Career Research Program. D.L.T. and M.C.C. were sup-
ported through U24 CA15 9988 from the National Cancer Institute.

Conﬂict of Interest: none declared.

112 /310'S[BIIJHO[pJOJXO'SOIJBLUJOJIIIOICI”K1111] 11101} pQPBOIII/lAOG

9103 ‘Og isanV uo ::

3840

B. C. Gibbons et al.

 

References

Chambers,M. C. et al. (2012). A cross-platform toolkit for mass spectrometry
and proteomics. Nat. Biotechnol, 30, 918—920.

Charles,L. (2003). Flow injection of the lock mass standard for accurate mass
measurement in electrospray ionization time—of—ﬂight mass spectrometry
coupled with liquid chromatography. Rapid Commun. Mass Spectrom, 17,
1383—1388.

Cox,J. et al. (2011). Software lock mass by two-dimensional minimization of
peptide mass errors. I. Am. Soc. Mass Spectrom, 22, 1373—1380.

Kessner,D. et al. (2008). ProteoWizard: open source software for rapid prote—
omics tools development. Bioinformatics, 24, 2534—2536.

Olsen,J.V. et al. (2005). Parts per million mass accuracy on an Orbitrap mass
spectrometer via lock mass injection into a C—trap. Mol. Cell. Proteomics, 4,
2010—2021.

Petyuk,V.A. et al. (2010). DtaReﬁnery, a software tool for elimination of sys—
tematic errors from parent ion mass measurements in tandem mass spectra
data sets. Mol. Cell. Proteomics, 9, 486—496.

Zhang,Y. et al. (2011). Improving proteomics mass accuracy by dynamic off-
line lock mass. Anal. Chem, 83, 9344—9351.

112 /310'S[BIIJHO[pJOJXO'SOIJBLUJOJIIIOIq/ﬂduq 11101} pQPBOIII/lAOG

9103 ‘Og isanV uo ::

