ORIGINAL PAPER

Vol. 26 no. 22 2010, pages 2867-2873
doi: 1 0. 1 093/bioinformatics/btq559

 

Genetics and population analysis

Advance Access publication October 5, 2010

Robust relationship inference in genome-wide association studies
Ani Manichaikul1’2, Josyf c. Mychaleckyjl, Stephen s. Richl, Kathy Daly3,

Mich Ie Salem,5 and Wei—Min Chenlagt‘

1Center for Public Health Genomios, 2Department of Public Health Sciences, Division of Biostatistics and
Epidemiology, University of Virginia, Charlottesville, VA, 3Department of Otolaryngology, University of Minnesota,
Minneapolis, MN, 4Department of Medicine and 5Department of Biochemistry and Molecular Genetics, University of

Virginia, Charlottesville, VA, USA
Associate Editor: Jeffrey Barrett

 

ABSTRACT

Motivation: Genome-wide association studies (GWASs) have been
widely used to map loci contributing to variation in complex
traits and risk of diseases in humans. Accurate specification of
familial relationships is crucial for family-based GWAS, as well as
in population-based GWAS with unknown (or unrecognized) family
structure. The family structure in a GWAS should be routinely
investigated using the SNP data prior to the analysis of population
structure or phenotype. Existing algorithms for relationship inference
have a major weakness of estimating allele frequencies at each SNP
from the entire sample, under a strong assumption of homogeneous
population structure. This assumption is often untenable.

Results: Here, we present a rapid algorithm for relationship
inference using high-throughput genotype data typical of GWAS
that allows the presence of unknown population substructure. The
relationship of any pair of individuals can be precisely inferred
by robust estimation of their kinship coefficient, independent of
sample composition or population structure (sample invariance). We
present simulation experiments to demonstrate that the algorithm
has sufficient power to provide reliable inference on millions of
unrelated pairs and thousands of relative pairs (up to 3rd-degree
relationships). Application of our robust algorithm to HapMap
and GWAS datasets demonstrates that it performs properly even
under extreme population stratification, while algorithms assuming
a homogeneous population give systematically biased results. Our
extremely efficient implementation performs relationship inference on
millions of pairs of individuals in a matter of minutes, dozens of times
faster than the most efficient existing algorithm known to us.
Availability: Our robust relationship inference algorithm is
implemented in a freely available software package, KING,
available for download at http://people.virginia.edu/~wc9c/KING.
Contact: wmchen@virginia.edu

Supplementary information: Supplementary data are available at
Bioinformatics online.

Received on June 9,2010; revised on September 24, 2010; accepted
on September 27, 2010

1 INTRODUCTION

Genome-wide association studies (GWASs) have been widely used
to identify common variants that contribute to variation in complex

 

*To whom correspondence should be addressed.

human phenotypes and diseases. Pedigree integrity is crucial to the
performance of family-based GWA, as well as in population-based
data with unknown family structure. High-throughput genotyping
performed in a GWAS presents new opportunities for pedigree
error detection using millions of SNPs to assess the degree of
relationship between a pair of individuals. With these opportunities
come the Challenges of accounting for linkage disequilibrium
among typed markers, while managing computational resources to
analyze the large amount of genotype data. Compared to linkage
studies, association studies also require consideration of population
substructure, misreported race and ethnicity and unreported familial
relationships among samples recruited as unrelated individuals.

One well-developed approach for relationship inference in linkage
studies offers fully parametric methods for sib pairs (Boehnke and
Cox, 1997) and extensions to general pedigrees (MCPeek and Sun,
2000) using hidden Markov models (HMM) to calculate multipoint
marker probabilities, incorporated into a likelihood framework to
assess evidence in support of particular pair-wise relationships.
In considering full multipoint marker probabilities, computational
demands increase with the number of markers genotyped, making
analysis of GWAS SNPs for all pairs of individuals prohibitive.
A simple method, known as GRR (Graphical Representation of
Relationship errors; Abecasis et al., 2001), uses Clustering of readily
available non-parametric estimates for mean and standard deviation
(SD) of identical by state (IBS) statistics at a series of markers
for each pair of relatives. GRR identiﬁes outliers of Clusters as
relationship errors. Performance of the Clustering algorithm used
to Classify relative pairs depends on the panel of genetic markers,
the underlying allele frequencies of genetic markers for different
individuals, and the number of individuals genotyped. If certain pairs
of individuals do not Cluster—either due to limitations in sample
size or due to the different underlying allele frequencies between
different pairs (e.g. in the presence of population structure)—GRR
fails to detect the pedigree errors. One efﬁcient implementation
of relationship inference in GWAS data is available in a widely
used software package, PLINK (Purcell et al., 2007). The identical-
by-descent (IBD) statistics between each pair of individuals are
estimated using the average of IBS and the estimation of sample-
level allele frequencies at each SNP according to Hardy—Weinberg
Equilibrium (HWE) assumptions.

All popular algorithms for relationship inference depend on
reliable estimates of allele frequencies at each SNP, assuming a
homogeneous population without stratiﬁcation (Abecasis et al.,
2001; Boehnke and Cox, 1997; Lynch and Ritland, 1999; MCPeek

 

© The Author 2010. Published by Oxford University Press. All rights reserved. For Permissions, please email: journals.permissions@oxfordjournals.org 2867

112 /3.Io's[Bumo[pJOJXO'sorwurJOJurorqﬂ:duq 11101} pepeolumoq

9103 ‘{g anﬁnv 110::

A.Manichaikul et al.

 

and Sun, 2000; Purcell et (11., 2007). Recent GWAS analytic
advances for association mapping have incorporated the presence of
unknown family and population structure (Choi et (11., 2009; Kang
et (11., 2010; Thornton and MCPeek, 2010; Yang et (11., 2010; Zhang
et (11., 2010); however, algorithms to estimate family relationships
remain based on the assumption of population homogeneity.
In samples with undetected population substructure, this strong
assumption of population homogeneity leads to biased results,
systematically inﬂating the degree of relatedness among individuals
of the same racial group.

Current approaches to relationship and population structure
inference are somewhat Circular. The relationship inference relies
on correct speciﬁcation of a homogeneous subpopulation (Purcell
et (11., 2007), while the detection of population structure relies on
the correct identiﬁcation of unrelated individuals (Zhu et (11., 2008).
In addition to the non-robustness to the population structure, existing
approaches do not apply to small datasets, e.g. for comparison of
a single pair of individuals, or relationship inference on a single
pedigree.

We present a novel framework for relationship inference, Kinship-
based INference for Genome-wide association studies (KING),
together with a rapid algorithm for relationship inference appropriate
for use on samples with thousands of individuals genotyped
at millions of SNPs from autosomes, consistent with a scale
typically achieved in a GWAS. Within this framework we present
two methods: (i) KING-homo, derived under the assumption of
population homogeneity and (ii) KING-robust that provides robust
relationship inference in the presence of population substructure.
The estimated pedigree information provided by KING (such as
kinship coefﬁcients) can be used to verify relationships, reconstruct
pedigrees and conduct genetic association tests without relying on
self-reported pedigree information. Our computationally efﬁcient
and ﬂexible approach allows automated pedigree error detection, and
is amenable to datasets involving a very small number of individuals,
as encountered in forensic DNA analysis.

2 METHODS

Consider two individuals. indexed by 1' and j. Let $0- denote the kinship
coefﬁcient. deﬁned as the probability that two alleles sampled at random from
two individuals are identical by descent. and 710,7. mi]- and 712i]- denote the
probability that the two individuals share zero. one and two alleles identical
by descent. respectively. Table 1 lists values of $0- and 710,]- for relative
pairs. including monozygotic twins. parent-offspring pairs. sibling pairs.
2nd-degree relative pairs (such as half-sibs. avuncular pairs and grandparent-
grandchild pairs). 3rd-degree relative pairs (such as ﬁrst cousins). and
unrelated pairs. Note that the kinship coefﬁcient is a function of IBD-sharing
statistics with relationship 2¢ij = 711 i]- /2 + 712,7. Inference criteria presented in
Table 1 are derived using powers of 2. with the basis that this is the natural
scale of the kinship and zero-IBD sharing statistics. In Section 3. we see that
these inference criteria work well in practice.

2.1 Relationship inference in a homogeneous
population

We ﬁrst summarize existing methods that allow relationship inference under
the assumption of a homogeneous population. Assume p is the frequency
of a reference allele (with label A) at a SNP. and the number of alleles IBS
between individuals 1' andj is IBSij. Since only IBDU- :0 (not IBDU- :1 or 2)
can result in IBSU- = 0 (i.e. the pair of individuals has genotypes AA and aa).
the expected proportion of SNPs with zero IBS can be speciﬁed assuming

Table 1. Relationship inference criteria based on estimating kinship
coefﬁcients (¢) and probability of zero IBD sharing (:10)

 

 

 

 

 

 

 

 

 

 

 

 

 

Relationship ¢ Inference criteria no Inference criteria
Monozygotic twin % > 231/2 0 <0.1
Parenteoffspring % ( 251/2 . 231/2 ) 0 < 0.1

Full sib l (251/2 .2352) i (0.1.0.365)

2nd Degree 1 ( 2.1/2 , 251/2) 1 (0.365.1— 23%)

1 1 1 3 1 1
3rd Degree E (29/2,27/2) z (1—237’1—25/2)
Unrelated 0 < 291/2 1 > 1 — 2517
HWE:

Pr(IBSij = O) = Pr(AA,aa|IBDij = O) - Pr(IBDij = O) = 2p2(1—p)2710ij (1)
This leads to the estimator
I ’71:
g: IBS” 0 NAAM

’ _
Z2 A1211“ _ﬁm)2 — :2ﬁ1211(1_ﬁm)2
Ill

m

(2)

710,7:

where 1135?:0 is an indicator of whether the pair of individuals does not
share any alleles at the m-th SNP. NAAgm, is the total number of SNPs at
which the genotypes of the pair of individuals are different homozygotes.
m indexes SNPs excluding those with missing genotypes in either individual
of the pair. and allele frequency [5", at the m-th SNP is estimated from the
genotype frequencies in the entire sample as

A #AA+#Aa/2

“Fm- (3)

Note #AA. #Aa and #aa are the total number of individuals with genotypeAA,
Aa and cm. respectively. at the m-th SNP. The remaining two IBD statistics
can be estimated based on N11135:] . ngs:2. [5,". and 7'10)!- (Purcell 61611., 2007).
Since the sum of the three IBD statistics is unity. only two IBD statistics are
needed to infer the relationship.

We propose an alternative framework to estimate the kinship coefﬁcient
between a pair of individuals. Suppose the frequency of a reference allele is
p at a SNP for both individuals. The genotype score. deﬁned by the number
of the reference allele for individuals 1'. is X”). We model genetic distance
between a pair of individuals in terms of their kinship coefﬁcient (derived
under the assumption of HWE in the Supplementary Material) as

E(X<i> —X<f>)2 =4p(1 — p)(1 — 2¢ij)- (4)

Let fly/Mi]- be a consistent estimator of Z2p,,,(1 —p,,,)/Mij Where My- is the
Ill
total number of non-missing markers for the pair of individuals. Now. we

can estimate the kinship coefﬁcient as

. . 2
1 :01? a)
¢~=———”' . . (5)
U 2 4H,,-
Note only markers with genotype data for both individuals 1' and j are used
in calculation of $0: When the sample of individuals is homogeneous. pm
can be estimated by the observed allele frequency [5", in (3). The plug-in
estimator
Hij/Mi- = 2215.11 —ﬁ,,,>/M,»,- (6)
Ill
is consistent for Z2p,,,(1—pm)/M,~. and it follows that the estimator $0-

Ill
based on (5) and (6) is consistent for $02 We name the estimating method

in Equations (5) and (6) as KING-homo. Together with the IBD estimator
(2). all relationships presented in Table 1 can be determined uniquely. Note
estimation of In and 712 can be derived easily according to equations 7'?) =
2—27'10—443 and ﬁ2=4¢3+ﬁ0— l.

 

2868

112 /3.Io's[Bumo[pJOJXO'sorwuiJOJurorqﬂ:duq wort pepeolumoq

9103 ‘{g anﬁnv 110::

Robust relationship inference in GWAS

 

2.2 Analytical framework for efﬁcient computation

We propose a general approach for computationally efﬁcient relationship
inference as follows. First. we derive an identity (details in the Supplementary
Material) to represent the genetic distance between a pair of individuals in
terms of their shared genotype counts

(X0) —X<f>>2 =4111... — 211.1. +12, +13

where 12. [Alum and IAAM indicate whether the i-th individual is
heterozygous. whether both individuals are heterozygous. and whether the
two individuals have different homozygotes. respectively. Now. we rewrite
Equation (5) in terms of genotype counts

. NA”, 1,, —2NAA,,,,, 1 N11), +NX2,

$1] = —A + — — —x (7)

2H i]- 2 4H i]-

where NAagAa, N213 and N513 are the total numbers of SNPs at which
both individuals of the pair are heterozygous. and the total number of
heterozygotes for the i-th and j-th individual. respectively. excluding those
SNPs with missing genotypes in either individual of the pair.

When each genotype is stored in two bits. N2. N2. NAM”, and NAAJ,”
can be computed using only bit operations (i.e. AND. OR. XOR and NOT).
eliminating multiplication and division during the process of scanning the
genome. For KING-homo. further computational savings is achieved by
pre-calculating Hi]- at all SNPs prior to the pair-wise kinship coefﬁcient
estimation. and then updating to reﬂect the set of observed genotypes used
in analysis of each pair of individuals.

2.3 Robust relationship inference in the presence of
population substructure

A key assumption underlying KING-homo and other existing methods (e.g.
Equation 2) is that genotypes for all individuals are representative of a
common set of allele frequencies. Deviations from this assumption are
expected in samples with population substructure. A simple approach to
incorporate population stratiﬁcation is a within-family adjustment. in which
reported estimates of the kinship coefﬁcient for each relative pair are adjusted
by an inﬂation factor. representing the ratio of estimated-to-theoretical values
of (1 —2¢) averaged across all relative pairs for every family with three
or more genotyped individuals. The rationale behind this adjustment is that
inﬂation of allele frequencies measured by p(1 —p) (in Equation 4) should be
identical across all individuals within each family. and larger than expected
estimates (e. g. kinship coefﬁcients for parent-offspring pairs greater than 1/4)
can indicate inﬂation of allele frequencies within this family. This approach
results in more precise inference. particularly for larger families whose
underlying allele frequencies differ from the overall values in the sample.
While the family-speciﬁc adjustment performs well for large pedigrees. the
approach may not improve inference in small families. Here. we present a
general approach that is robust to population structure.

Assume P is a random variable representing the allele frequency at a SNP
that is randomly picked from the genotyped SNPS of an individual. P should
follow the same probability distribution among individuals from the same
subpopulation. In the presence of population stratiﬁcation. P may vary across
individuals. Equation (4) becomes

E(X‘i) —X<i>)2 =4E(P(1—P))(1—2¢,»j).

Let 1A,, denote an indicator of whether an individual has genotype Aa at
the randomly picked SNP with allele frequency P. Assuming HWE across
SNPs with the same underlying allele frequency P within an individual.
i.e. Pr(Aa|P) = 2P(1—P).

E(2P(1-P))=E(Pr(AalP))=E(E(IAaIP))= E(IAa) (8)

Thus. genome-wide average heterozygosity E(2P(1—P)) for an individual
can be estimated by NAa/Mij. For a pair of individuals 1' and j. since NZ),

and NXZare not necessarily equal. one empirical estimator for E(2P(1 —P))

is HU/Mi-=(N2 +NX3)/2Mij. and the robust estimator for the kinship
coefﬁcient is

(9)

Here. the genotype counts in the second representation of 1),]- provide efﬁcient
computation. as described in Section 2.2. When the pair of individuals
is sampled from the same population. 1),»!- in Equation (9) is a consistent
estimator of the kinship coefﬁcient $0: When the pair of individuals is
unrelated and from different populations (see details in the Supplementary
Material). 1),»!- is a consistent estimator of a parameter with a negative value

E(P1—P2)2

—— (10)
E(P1(1-P1))+E(P2(1-P2))

Thus. the robust estimator 1),»!- also can be used to determine the extent
of population heterogeneity between the pair of individuals; an extreme
negative value indicates the pair of individuals is drawn from two distinct
populations. More rigorous derivation of an inference criterion for population
heterogeneity using 1),»!- is the subject of future research.

In most datasets. relative pairs are sampled from the same population.
and pairs from different populations are unrelated. In both situations. the
robust estimator given in Equation (9) is a consistent estimator (for either the
kinship coefﬁcient or a measure of population heterogeneity). It is possible
that a pair of individuals is both related and from different populations.
e.g. one or both individuals are mixed. in which case the robust estimator is
no longer a consistent estimator of the kinship coefﬁcient. In this scenario.
the relationship inference within families could be less reliable; however. we
have observed that this impact is rather small for the speciﬁcation of relatives
up to the 3rd-degree.

The only assumption required for our robust estimator of kinship
coefﬁcient (Equation 9) is HWE among SNPs with the same underlying allele
frequencies. In practice. there is small proportion of individuals deviating
from the HWE. due to reasons such as genotyping errors. recent admixture
in a mixed population. or removing Mendelian errors in families. When the
Violation of HWE is in the direction of too little homozygosity (i.e. excessive
heterozygosity). the robust estimator (Equation 9) can over-estimate the
kinship coefﬁcient. In order to guard against potential estimation inﬂation
due to departure from individual-level HWE. we consider the smaller of
the observed heterozygosity rates. min (N2 /Mij. NX; /Mij). as an alternative
to E(2P(1—P)). Without loss of generality. suppose the i-th individual has
lower heterozygosity than the j-th individual. Then. the robust estimator is

» - 2
<2) (1))
z X —X
1 1   _NA,,,A,,—2NAA,,,,, 1

’7: 0 — 0 0
2 4 N’ 2NA’a 2 4 N’

The estimator above is no larger than the estimator in Equation (9). and both
estimators are bounded above by 0.5.

We use estimator (Equation 9) for within-family relationship checking and
estimator (Equation 11) for between-family relationship checking. naming
this combined approach KING-robust. Using KING-robust. individuals of
different ethnicities are less likely to be misspeciﬁed as relative pairs. All
relationships in Table 1. except for the two types of lst-degree relationships.
can be uniquely speciﬁed through the kinship estimates provided by KING-
robust. To further distinguish parentmffspring from full-sib pairs. we
examine the observed IBS making use of the fact that IBS between a parente
offspring pair is always 1 or 2 at any SNP in the absence of genotyping
errors. More advanced inference of pedigree structure can be carried out by
simultaneously using the information from multiple pair-wise relationships.

The HWE assumption as in Equation (8) also allows estimation of the
variance of allele frequencies in each individual as

mm = Ema — (E(P)? =Pr(AA> — 4110300? (12)

 

2869

112 /3.Io's[Bumo[p.101x0'soueu1101urorq”:duq u1011 papeo1umoq

9103 ‘1g15n8nv 110::

A.Manichaikul et al.

 

Together with estimation of the allele frequency mean in each individual
1 1
E(P)=E(§E(X|P))= §E(X) (13)

the population structure in a GWAS dataset can be resolved, even in the
presence of unspeciﬁed family structure. Thus, our approach (Equations 12
and 13) provides a useful tool for population structure analysis in the context
of a family-based GWAS.

3 RESULTS
3.1 Resolution of relationship inference varies with
genotyping density

We performed simulations to demonstrate the resolution of kinship
coefﬁcient estimation using high-throughput genotype data. We
simulated 1000 three-generation pedigrees that contained 1st, 2nd
and 3rd-degree relative pairs. The detailed algorithms of simulating
pedigrees were shown previously (Chen and Deng, 2001 ; Chen et (11.,
2009). SNPs from 22 autosomes with varying densities (50k, 150k
and 500k) were simulated, with minor allele frequencies ranging
(randomly) from 0.1 to 0.5.

We ﬁrst examined the distribution of actual or realized IBD
sharing (versus the estimated distribution) between relative pairs
that is deﬁned as half of the actual proportion of the genome that is
shared IBD between the pair of relatives The actual IBD sharing
between a pair of relatives varies around its expectation except
parent—offspring and monozygotic twin pairs (Visscher e1 (11., 2008).
This estimator is expected to provide an upper bound on precision
for estimators of IBD-sharing statistics based on the same set of
SNP data. Note that the realized IBD sharing of unrelated pairs
is a constant, zero. We examined the distribution of the estimated
kinship coefﬁcients using the robust estimator (Equation 9). The
distributions of realized IBD sharing with 150k SNPs, and estimated
kinship coefﬁcients with 150k SNPs, 5k SNPs and 500k SNPs are
shown in Figure 1.

With 150k independent SNPs, the distribution of the realized IBD
sharing and estimated kinship coefﬁcients of relative pairs is rather

 

ul Klnlhln Emu-1m wlln ISWW W5

A a .1." B

- — 1. ..e1,.:eur-a

— 115119131.» Helmme

- - 2n:.1:1ngmn Rnlzvn
' Full SIUiI‘QS

-— L|--u;:e.:|:\|-"a

— Era—119711“ Ream-11

- - among“ Hui-1m
- FullSDInqs

Density
Density

   

._.-  . -- .1»...-

 

nm 11.115 0111 0115 11211 112'.- nm 1.35 0.110 ons 0111 1115 1120 11.25 11.30 9.35

Kineth Caeﬂiuent [Realized IBD! Estuneted Innsal CDelf-clem
c III Kilahlp mm U ml Kinship mmm I'IIII 5111101111 WE

 

 

   
  

so

-- L---1u::,:w'-"..-

— E.u-De.1-eeﬁealwe

- - PnU—llnqwe Hnlmm
- FulleIng:

F.1-
eu-ee nelsime
2n — 119w: Rama:
- I'ullsihmgs

Density

10 an an In

Densin

_— .~_-'

0

 

1130 M5 oun 0115 11211 1125 11.90 11.35 01110 ens om 1115 1121:. 1125 11.30 035

Estimated Kinship Coefficient Estimated Kinship Cnetlbclem

Fig. 1. Distribution of kinship coefﬁcient estimation. (A) Distribution of
realized IBD-sharing with 150k SNPS; (B) distribution of kinship coefﬁcient
estimates with 150k SNPS; (C) distribution of kinship coefﬁcient estimates
with 5k SNPS; and (D) distribution of kinship coefﬁcient estimates with
500K SNPs.

similar, showing our robust kinship coefﬁcient estimation achieves
optimal power to Classify relative pairs. However, even with the best
possible estimation (e.g. the true value without estimation), pair-wise
relationship misspeciﬁcation can be still observed in GWAS data,
especially for relative pairs of 3rd-degree and more distant. In all
simulations, there is no distribution overlap between unrelated pairs
and 3rd-degree relatives, and there is slight overlap between 3rd- and
2nd-degree relatives. The SDs for the estimated kinship coefﬁcient
of the 1st-, 2nd- and 3rd-degree relative pairs are 0.021, 0.017 and
0.012, respectively, in a GWAS with 150K SNPs. The SD for the
estimated kinship coefﬁcient of unrelated pairs is 0.002 (with 150K
SNPs) or much less with denser SNPs. With a denser SNP panel,
distributions between unrelated and related pairs are more separate,
but its impact on the distribution for Closely related pairs (up to
3rd-degree) is limited. In a linkage dataset with ~5k SNPs, only
Closely related pairs (up to 2nd-degree) and unrelated pairs can be
estimated reliably, and there is noticeable overlap of distributions
between 3rd-degree and unrelated pairs. In linkage datasets, there
could be millions of unrelated pairs and, therefore, it is not feasible
to correctly distinguish 3rd-degree relatives from unrelated pairs.
However, a linkage dataset is still valuable for detection of 1st-
and 2nd-degree relative pairs among millions of unrelated pairs,
frequently ignored in current analysis of linkage data. Dense SNP
data were also simulated for over one million unrelated pairs (data
not shown), and the robust estimate of the kinship coefﬁcient never
exceeded 0.022.

3.2 Robust relationship inference in the presence of
population stratiﬁcation

We illustrate our robust relationship inference through application
to data from the 269 HapMap (International HapMap Consortium,
2005). The HapMap data used in this study consisted of 30 CEU
trios, 30 YRI trios, 45 CHB samples and 4-4 JPT samples. Each
individual is genotyped at ~3 million SNPs in the consensus Phase II
HapMap data with an average genotype missing rate 1.5% (note that
~20% of SNPs are not polymorphic in each population). Potential
pedigree errors can be viewed easily through graphical displays,
in which the inferred kinship coefﬁcients are plotted against the
estimated probability of zero IBD (or proportion of zero IBS).
Algorithms assuming a homogeneous population perform poorly
to estimate the kinship coefﬁcients (Fig. 2C—F), systematically
inﬂating the degree of relatedness among individuals of the same
racial group. The kinship coefﬁcients (KING-homo) of unrelated
CEU pairs within-families are estimated to be >0.044, so they are
all incorrectly inferred to be 3rd-degree relative pairs.

Estimation of between-family pairs is much worse. Many
unrelated pairs between families are misspeciﬁed as 2nd-degree
relatives using both algorithms (Fig. 2D and F), and a large
proportion of unrelated pairs are misspeciﬁed as 1st-degree relatives
in PLINK (Fig. 2F). In contrast, KING-robust gives Clean results
even in the presence of population stratiﬁcation (Fig. 2A and B),
with kinship coefﬁcient estimates consistent with those from the
stratiﬁed data (data not shown). All algorithms identify relatedness
across three pairs of YRI trios; the Closest relationships in these three
pairs of families are 1st-, 2nd- and 3rd-degree relatives, respectively.

We compare the performance of algorithms in KING to identify
the population structure with the PCA algorithm (Price et (11., 2006;
Zhu et (11., 2008). Figure 3 demonstrates three Clear Clusters in the

 

2870

112 /3.Io's[Bumo[p.101x0'soueu1101urorq”:duq u1011 papeo1umoq

9103 ‘1g15n8nv 110::

Robust relationship inference in GWAS

 

 

 

 

 

 

 

 

 

 

A WllIIII'I—Falﬂl)‘ ﬁanllonnnlp lay KING 111111111111} B ﬂelween—Felnly Relationship 1111 11111311111111.1111
d 1.311 n CEU 11.:111
: I: YRI E
g 0.25 . E “5 0
z z
“‘ S
5 1.211 U 1.211
g 11.15 g n 15 0 o
2 2 o
E 11.11 g 11.111 0
E E a
3 11.15 g 0.115 Q3
“ ‘“ W.
11.1111 ‘ﬂ 11.1111 .
I I I I I I I I I I I I
am 001 002 000 004 005 000 001 002 000 004 006
Proportion ol Zeno IBS Proporlion ol Zeno IBS
C Within-Family numiomnip 1111 KING (Home: D Between-Fenian naiaiiamip by KIM: [11mm]
11.21 A CEU 11311
E ‘ i: YFII E
3 025 i 025
2 g
m m
6 11.211 6 1.211
g 11.1 g 11.15
: z
2 2
3 11.11 E 11.11
E E
3 11115 M 3 11115
11.1 m
11.1111 11 1111
01 0305 00410 0023 0012 01 0305 00‘10 0023
Pr[lED-Dl Pr[lED-D]
E willHn-ley nelalionaliip by Fumi. EoMeen-Femlly Relationship 11y PLIIK
11.1111 - b on] 11.1111 -
E E YFII E
at _ 111 _
E 0.25 E 025
a E
a 11.211 - a 11.211
.1 Fl
’5 11.15 - '5 1115 -
2 2
a 11.11 - 3 ii in -
E E
E 11115 ‘ E 11115
11.1 m
11.1111 - 11.1111
D! 113110 00-10 0822! 0.012 111 0.305 0640 0.02.! 0.912
Pruitt-111 Pruen—o]

Fig. 2. Relationship checking in 269 HapMap samples (A), (C) and (E)
are within-family relationship checking using three algorithms, and (B), (D)
and (F) are between-family relationship checking using three algorithms.
Negative kinship coefﬁcient estimates are truncated to 0. Dashed lines
indicate inference criteria as shown in Table 1. Solid lines follow the equation
¢=(1 —rro)/4 that holds true for all relationships shown in Table 1, except
for full sibs.

analyzed HapMap population, separating individuals of European
(CEU), African (YRI) and Asian (CHB, JPT) ancestry. The robust
kinship estimator identiﬁes strong stratiﬁcation across the distinct
population groups, while individuals from the same population tend
to have inferred kinship around 0 (Fig. 3A). The allele frequency
statistics Cluster the three populations (Fig. 3B), as does the principal
component analysis (Fig. 3C). Relatedness between the three pairs
of YRI families (reported above) produces the 3rd and 4th principal
components (Fig. 3D).

We ﬁirther investigated performance of our robust algorithm on a
subset of 713 930 rare-variant SNPs with minor allele frequency
<0.05. Results of the between-family relationship inference and
population structure inference were very similar for this restricted
set of SNPs (Supplementary Fig. S2) compared to the ﬁill HapMap
SNP panel (Fig. 3A). These results demonstrate our algorithm is
robust to the SNP panel used for relationship inference, providing a
tool for both GWAS and studies of rare variants.

3.3 Robust relationship inference in a real GWAS

We further used the KING algorithms to screen pedigree errors in
a GWAS of otitis media (Daly e1 (11., 2004). This dataset includes

IidlviuuiiI—Lw Niels anc! 91110111“

3

Mun—Full"! helm-I'D B

 

CHHiPinrzeu 11.1114 - '- liHH
3 Yr” 3 CEU
(IHHJPI 1; YH “w ' .11 (.1511
: 'fl'lll

o

o
o

Est-M191: Kinsim Comment
1 1 *3 2
mace
E E E E
W“
W ’
1*

 

 

é

 

 

 

 

 

 

 

 

. —1 .
ON 002 0.04 Q06 000 0.10 0.15 DA! 020 021
Prow’linn 1112910 IEIS Mean
c Principal campumu 1 a 2 D Pllilchul Cumpuillnh a e 11
m 5 c1111 . : c1111
1'16
: ceu : CE.1
' YIN " Ylw'
“5 :14
N a
U U
B. H.
1.011 O!
-
ms ' on 1:1 '1 
| 'I I' I | "I" I' | '
4 ID 905 0W 0” Q0 -0! 4? 00
P61 P03

Fig. 3. Population structure in 269 HapMap samples. (A) Robust estimator
of kinship coefﬁcient as a tool for population structure discovery. Colored
dots represent comparison of individuals from distinct populations. Within-
population comparisons are shown in black; (B) mean and variance of allele
frequencies at each individual; and (C) and (D) top four principal components
from PCA.

602 individuals from 143 families in which each is genotyped at
350K SNPs. The majority of individuals are Caucasian, one family
of size four is Asian, one family of size two is Native American,
and a few families have mixed ethnicity. Overall, we detect a higher
degree of relatedness through analysis of genotype data compared
to the relationships formally reported for the study. We detected 14
relationship errors within a family that are due to misspeciﬁcation of
one individual, and two disconnected families that are related (data
not shown).

After ﬁxing these two sets of errors, we display the inferred
relationships in Figure 4A,B. We also applied the KING-homo and
PLINK, both of which assume a homogeneous population (Fig. 4C—
F). For this relatively homogenous dataset, different algorithms give
similar results for the majority of pairs. By all three algorithms, 14
pairs of individuals from three unrelated sibships are estimated to
be 3rd or 4th-degree relatives, and 2 out of 33 formally reported
3rd-degree relatives are misspeciﬁed as 4th-degree relatives (due
to the limited power). Note the two pairs of 4th-degree relatives
are correctly speciﬁed. In addition, PLINK reports six additional
unrelated pairs as related (kinship > 0.022), while both KING
algorithms Clearly separate related pairs from unrelated pairs. KING-
homo overestimates the kinship coefﬁcient of a pair of unrelated
Asian parents (Fig. 4C), which is expected given that Asians have
a lower heterozygosity than other individuals (Note that 2131)]. >

N22 +NX3 implies the kinship estimate in Equation 5 is larger than
the one in Equation 9). The population structure of this data is shown

in an allele frequency plot (Supplementary Fig. 1B) as well as in
principal component plots (Supplementary Fig. 1C and D).

3.4 Computational efﬁciency: minutes rather than days

We compared the analysis time between the KING algorithms
(both the robust algorithm and the one that assumes population
homogeneity) with the algorithm implemented in PLINK, in the

 

2871

112 /310'S[1211an[pJOJXO'SOIJBLUJOJIIIOIqﬂIdllq u1011 papeo1umoq

9103 ‘1g15n8nv 110::

A.Manichaikul et al.

 

A “twill-Family ﬁelalionslllp 1311' KING 113mm: Bellman-Family ﬁemomnip by KIM: (annual)

m

 

E

“‘5 ' " - M7Twln "Q ..

O Parent—Oil'suiing
0 Full Sibling
t 2nd—Degree

i

I
clean
E

11 Bio—Degree

o: — n inn—Degree
' - - 11111111111111
I32 -
oi — \u u
00.1

00— .

E E

Bnmetea Kinship Oeel’ticiem
E1

Estimated Kinship Coefﬁ

'9

 

 

 

111111 11.11? 1111: 11011 11.11911 0011: 11115.1 11.111111 0121313 1111111

ProporL'nn at zero IBS Proportion 11122110153

0
U

WillIII-Flnlily Billionulip by KING {Home} BUM-Finiin ﬁclllionﬂliu by KING (Homo)

 

DS-D 0c

10

u Mi 'Iwin
n Parenlenltspring
M - - Full 51:11”;

- 911:1 neg-Jun.-

- 3111—0101130

11.1 - I 4111—1399.“
{HR-5‘ - Unraiausa

11.2 — “He—EH

DJ - \

11.1 - “"5.

11.1 11.311: 11.111111 11.323 0.912

E
.

3

I

11
o 0

Estimated Kinship Cnetllclent
§
I
o
0

Estimated Kinship Coefﬁcient

 

 

 

9
n°a
o
‘0

 

0.130 11.113 11.311 11.35 1.1111

FrtIBD=Oj Pr[IBD=Dl

Wllhlri—Faililv Relationth by PLINK Between—Family WIOHII‘IIP by PLINK

l'l'l
'I'I

 

I M}! Twin o
I Parent—Olfsuiinu
111-1 — I Full Sibling
- 2nd—Degree
o Sid—Degree

0.! - n 1111—0991511
‘H k - Unrelated
-H"‘-\-1..
a...
111 _ 

11.1 1.355 0.6406 11m 11.912

Eenlnetted Kliehip Goelitcient

Emmet: Klan": Coeliblem
D
u
I

w...

 

 

1130 11.115 11.1111 11.115 1.1111

FrtIBD=EIJ Fr[lﬁD=Di

Fig. 4. Relationship checking in OM GWAS data. (A), (C) and (E) are
within-family relationship checking using three algorithms, and (B), (D)
and (F) are between-family relationship checking using three algorithms.
Negative kinship coefﬁcient estimates are truncated to 0.

Table 2. Computation time of two software implementations to estimate
kinship coefﬁcients in three sets of GWAS SNP data

 

Summary of genome scan data Computing time

 

Index No. of SNPs No. of samples No. of pairs KING PLINK

 

1 3 079 857 269 36 046 2 min 2 h 9 min
2 324 748 602 180 901 1min 1 h 13 min
3 549 338 2 454 3 009 832 25 min 28 h 30 min

 

The computation time refers to the time to estimate kinship coefﬁcients for all pairs of
individuals, excluding overhead costs such as the time to load data into the computer
memory. The two KING implementations (the robust algorithm and the algorithm
assuming homogeneous samples) took a similar amount of computational time. This
computation time can be estimated reliably as the analysis time for the entire data
minus the analysis time for only the within-family data. The unit of computation time
is in minutes hours. All computation was performed on and Intel Xeon with 3.20 GHz
processor.

above two datasets as well as an additional GWAS dataset consisting
of 2450 individuals (Table 2).

In all three datasets that we examined, the computational time of
the KING implementation is in minutes; in contrast, it took hours
to days to analyze the same datasets using PLINK on the same

workstation. The computational saving of our implementation over
PLINK is over 60-fold, and this result can be generalized to larger
datasets. This computational efﬁciency makes our implementation
particularly attractive for the analysis of large GWAS datasets that
exceed 10000 individuals (hours of computation time in KING,
compared to a projected >1 month computation time using other
software), making it feasible to perform the millions of pair-
wise comparisons necessary for a comprehensive between-family
analysis.

Note the reported computation time in Table 2 excludes time to
load the data, which grows linearly as the sample size increases,
in contrast to the exponential increase of analysis time. The time
to load the data in KING was <30s for all three scenarios
when binary format genotypes were used as the input of the
KING implementation, and was comparable to other software
implementations (21 m, 6m and 40 m, respectively) when the
MERLIN (Abecasis e1 (11., 2002) format genotypes were used as
the input.

4 DISCUSSION

We have proposed a robust algorithm to infer relationships using
high-density genotype data from a GWAS. Our approach to
relationship inference incorporates simple estimates for key genetic
parameters, reported with high precision due to the large number
of SNPs typed by current high-throughput panels. The framework
underlying the KING approach to relationship inference centers
on modeling genetic distance between a pair of individuals as a
function of their allele frequencies and kinship coefﬁcient. In studies
with homogeneous populations and relatively large sample sizes,
allele frequencies at all SNPs can be estimated accurately from the
given data, and used to inform the estimate of allelic heterogeneity
needed to calculate the kinship coefﬁcient in KING-homo. Under
population stratiﬁcation, a single set of allele frequencies for the
given SNP panel is not appropriate for examination of the entire
dataset, motivating our use of the robust estimator in KING-robust.

As demonstrated by our power analysis and application to the
otitis media data, our approach based on estimation of the kinship-
coefﬁcient between any pair of individuals is sufﬁcient to classify
relative pairs as monozygotic twins, parent—offspring pairs, ﬁill
sibs, 2nd- or 3rd-degree relatives. Unlike approaches that assume
a homogeneous population, our robust approach classiﬁes relative
pairs correctly even under extreme population stratiﬁcation seen
in the pooled HapMap data. Our relationship inference is not
impacted by the linkage disequilibrium structure among adjacent
SNPs according to the large sample theory, and as demonstrated in
the two GWAS analyses.

The robust algorithm in KING performs pair-wise relationship
inference using only information from the two individuals under
comparison. The inference is invariant to inclusion of any additional
samples and to use of different SNP panels, producing reliable
results using genotypes from GWAS or from studies of rare variants
alone. The sample size of the data can be as small as two, and the
analysis can be performed rapidly for a single pedigree or pair of
individuals, with a wide range of applications, including forensic
DNA analysis and paternity/matemity testing (assuming the current
forensics technology transitions to high-density SNP genotyping).
The ability to perform between-family relationship inference robust
to population structure also allows population structure analysis

 

2872

112 /3.io's11211.1noipJOJXO'souizuiJOJHioiq”:duq uror} papeo1umoq

9103 ‘1gisn8nv 110::

Robust relationship inference in GWAS

 

without the worry of spurious principal components produced by
undetected family structure. Ultimately, the combination of robust
inference and rapid computation can be applied toward automated
pedigree reconstruction and association mapping in the absence
of any pre-speciﬁed pedigree or population structure (Chen and
Abecasis, 2007; Chen et al., 2009; Choi et al., 2009; Kang et al.,
2010; Thornton and McPeek, 2010; Zhang et al., 2010).

The KING algorithms (robust and homo) for relationship
inference have been implemented in a user-friendly software
package. KING is able to process large-scale GWAS data consisting
of thousands of individuals (a few minutes to check all pair-wise
relationships for millions of pairs of individuals). Tools to detect
population structure in the presence of genetic relatedness, including
a modiﬁed PCA algorithm (Zhu et al., 2008) and allele frequency
statistics (Equations 12 and 13) have also been implemented in
KING to facilitate the analysis of GWAS data. Future toolsets
include relationship inference between two groups of individuals
(rather than two individuals), clustering samples in families and
reconstructing pedigrees, automatic pedigree error ﬁxing, robust
PCA structure analysis and genome-wide association analysis in the
presence of unknown genetic relatedness in the sample.

ACKNOWLEDGEMENTS

We thank Goncalo Abecasis for sharing C++ source code for the
KING implementation, Xuanlin Hou for assistance in preparing
the Otitis Media GWAS data, and three anonymous reviewers for
valuable input that improved the article.

Funding: Research grant DC003166 (to K.D., in part).

Conﬂict of Interest: none declared.

REFERENCES

Abecasis,G.R. et al. (2001) GRR: graphical representation of relationship errors.
Bioinformatics, 17, 7427743.

Abecasis,GR. et al. (2002) Merlinirapid analysis of dense genetic maps using sparse
gene ﬂow trees, Nat Genet, 30, 977101.

Boehnke,M. and Cox,N.J. (1997) Accurate inference of relationships in sib-pair linkage
studies. Am. J. Hum. Genet, 61, 423429.

Chen,W.M. and Abecasis,G.R. (2007) Family-based association tests for genomewide
association scans. Am. J. Hum. Genet, 81, 9137926.

Chen,W.M. and Deng,H.W. (2001) A general and accurate approach for computing the
statistical power of the transmission disequilibrium test for complex disease genes.
Genet. Epidemiol., 21, 53$7.

Chen,W.M. et al. (2009) A generalized family-based association test for dichotomous
traits, Am. J. Hum. Genet, 85, 3647376.

Choi,Y. et al. (2009) Case-control association testing in the presence of unknown
relationships. Genet. Epidemiol., 33, 6687678.

Daly,K.A. et al. (2004) Chronic and recurrent otitis media: a genome scan for
susceptibility loci. Am. J. Hum. Genet, 75, 9887997.

International HapMap Consortium (2005) A haplotype map of the human genome.
Nature, 437, 129971320.

Kang,H.M. et al. (2010) Variance component model to account for sample structure in
genome-wide association studies. Nat Genet, 42, 3487354.

Lynch,M. and Ritland,K. (1999) Estimation of pairwise relatedness with molecular
markers. Genetics, 152, 175371766.

McPeek,M.S. and Sun,L. (2000) Statistical tests for detection of misspeciﬁed
relationships by use of genome-screen data. Am. J. Hum. Genet, 66, 107671094.

Price,A.L. et al. (2006) Principal components analysis corrects for stratiﬁcation in
genome-wide association studies. Nat Genet, 38, 9047909.

Purcell,S. et al. (2007) PLINK: a tool set for whole-genome association and population-
based linkage analyses. Am. J. Hum. Genet, 81, 5597575.

Thornton,T. and McPeek,M.S. (2010) ROADTRIPS: case-control association testing
with partially or completely unknown population and pedigree structure. Am. J.
Hum. Genet, 86, 1727184.

Visscher,P.M. et al. (2008) Heritability in the genomics eragconcepts and
misconceptions, Nat Rev. Genet, 9, 2557266.

Yang]. et al. (2010) Common SNPs explain a large proportion of the heritability for
human height. Nat Genet, 42, 5657569.

Zhang,Z. et al. (2010) Mixed linear model approach adapted for genome-wide
association studies. Nat Genet, 42, 3557360.

Zhu,X. et al. (2008) A uniﬁed association analysis approach for family and unrelated
samples correcting for stratiﬁcation. Am. J. Hum. Genet, 82, 3527365.

 

2873

112 /3.Io's[Bumo[pJOJXO'soiJBMJOJuioiq//:duq moi; papeolumoq

9103 ‘{g isnﬁnv 110::

