BIOINFORMA TICS

0'so;112u110}u101q//2duq

SIBumoprOJX

£10"

Error (8)

55,2kgowsmoddmmowoio~&o:~=£¢o~m\

 

 

Presen/ing biological heterogeneity with genomics batch correction

 

Table 1. Number of samples of each HPV status across batches

 

 

Test set HPV- Unique HPV- HPV- Unique HPV-
negative negative positive positive

Frozen Nugen 24 24 10 10

Ovation

FFPE Nugen 13 12 4 4

FFPE

Frozen Nugen 15 14 14 13

FFPE

GSE6791 26 26 16 16

Pyeon et a].

(2007)

 

Notex: Columns labeled with ‘unique’ count the number of samples from distinct
tumors in that batch, excluding replicate samples from the same tumor within each
batch.

HPV status using the PAM algorithm, implemented in the CRAN pack-
age pamr (Tibshirani et al., 2002). Cross-batch validation considered data
from Pyeon et a]. (2007), GSE6791, as an additional batch to each of the
three batches distinguished by sample processing in our dataset. Training
was then performed on three of the four batches and testing on data from
the remaining batch, excluding any replicate samples from tumors also
measured in the training set. The biological groups of the test set are by
deﬁnition unknown in such class prediction problems. Therefore, we only
applied ComBat, SVA and the combination of SVA and ComBat to the
training data. We applied pSVA to batch correct both test and training
data, training the batch correction in the latter algorithm on the same
data used in the classiﬁer. Although such correction of the test set may
bias our results toward pSVA, we note that its exclusion of a priori
knowledge of biological groups makes it the only algorithm for which
we may perform such correction. Estimates of classes in the test set were
obtained at the individual tumor level by voting across replicate samples,
breaking ties with an assignment of the more probable and worse prog-
nosis HPV-negative class.

The effects of varying degrees of confounding were simulated.
Speciﬁcally, training sets were selected by setting a proportion 17 and
selecting 10 p HPV-positive samples from GSE6791 (Pyeon et al., 2007)
and 20(1 — p) HPV-negative samples from our Frozen Nugen Ovation
batch. An additional 10(1 — p) HPV-positive samples were selected from
our Frozen Nugen Ovation batch and 20 p HPV-negative from GSE6791
(Pyeon et al., 2007), for a total of 10 HPV-positive and 20 HPV-negative
samples. Thus, batch and HPV status are perfectly confounded when p is
zero or one, and perfectly balanced when p is 0.5. A total of 100 training
sets were selected from independent samples randomly for values of 17
between 0 and l at intervals of 0.1, for a total of 1100 simulations. Testing
was performed on independent frozen samples in our study processed
with the Nugen FFPE ampliﬁcation kit.

3 RESULTS

3.1 Sample procurement and RNA isolation drive
dominant gene expression signals

Our HNSCC dataset contained a total of 80 samples, with
sample size and distribution of HPV status and sample process—
ing shown in Table l. The counts in rows 1 to 3 include replicate
samples from the same tumor spread along processing techniques
(Supplementary Table S1). Excluding these replicate samples
leaves a total of 39 unique HPV—negative and 22 unique
HPV—positive samples. The distribution of expression values

was more variable in FFPE samples than frozen samples
(Supplementary Fig. S2a). Moreover, RNA expressed at high
levels showed the greatest variability in the FFPE samples, con—
sistent with anticipated RNA degradation.

Although no apparent differences were observed in the distri—
bution of frozen samples, the complexity in such study designs
often introduces signiﬁcant batch effects after apparent normal—
ization. Hierarchical clustering conﬁrmed that the RNA ampli—
ﬁcation kit was the dominant cause of expression differences
between samples instead of any clinical attribute of the tumor
samples (Supplementary Fig. S2b). We observed no signiﬁcant
batch effects between samples processed with Nugen Ovation l
or Ovation 2 or samples processed with Nugen FFPE or
FFPE_beta kits. Therefore, we label both Ovation l and
Ovation 2 amplification kits as Nugen Ovation and labeled
FFPE and FFPE_beta as Nugen FFPE.

3.2 Removing technical artifacts with pSVA preserves
sample heterogeneity

We applied pSVA, ComBat, SVA and a combination of SVA
and ComBat to data from our retrospective genomics study of
HNSCC (Chung et al., 2010, 2011; Gilbert et al., 2012; Slebos
et al., 2006) to remove the apparent artifacts from ampliﬁcation
kit and procurement observed in Supplementary Figure S2. The
applications of SVA and ComBat both model HPV status as the
known biological covariate. Each of these techniques successfully
mixes sample—processing groups in hierarchical clusters
(Supplementary Fig. S3) and makes the distribution of expres—
sion levels more similar between FFPE and frozen samples
(Supplementary Fig. S4a). Despite this correction, each batch
correction algorithm preserves differential expression of the es—
tablished HPV biomarker in HNSCC, p16 (CDKN2A)
(Robinson et al., 2010; Smeets et al., 2007) (Supplementary
Fig. S4b).

We also compared the correlation of gene expression proﬁles
between samples corrected with each batch correction technique
to assess the relative similarity between methods (Supplementary
Fig. S5). Samples corrected with pSVA had most variable cor—
relation coefﬁcients with samples in the uncorrected data relative
to any other batch correction technique. Applying ComBat alone
yielded more similar gene expression proﬁles to pSVA than ex—
pression resulting after SVA correction alone or in combination
with ComBat. Data corrected with pSVA was highly correlated
to data obtained from applying SVA with known batches, sug—
gesting that noise estimates for s in Equation (1) are truly un—
biased. Similarly high correlations were observed for data
corrected with SVA, including both HPV status and batch in
the model, suggesting that pSVA is retaining pertinent hetero—
geneity without any knowledge of biological groups.

To further validate the success of these batch correction algo—
rithms, we compared the correlation of expression proﬁles in
replicate samples (Fig. 2a). Prior to batch correction, there was
substantial variation in expression profiles between replicate
samples. Each batch correction algorithm increased the correl—
ation between replicate samples, with greatest improvement
observed when combining SVA and ComBat. However, only
pSVA preserves the high heterogeneity between non—replicate
samples reﬂective of tumor heterogeneity (Fig. 2b).

 

2759

ﬁm'spzumol‘pmJXO'sopeuHOJmotq/ﬁdnq

sawmtgoimondwmowoxmoamosgﬁmbnﬁ

we Sun >

m 5%
ma» 5%

a

a

a 53:

 

E 2.30
no. < _2

3 4

 

mu.

m5 mmm

awe”. s a. m.
as u was

2%: 1 same

 
 

Ema»:

Preserving biological heterogeneity with genomics batch correction

 

Table 2. Number of samples of each HPV status across batches

 

 

Test set None ComBat SVA SVA & pSVA HPV

(%) (%) (%) ComBat (%) (%)
(%)

Frozen Nugen 88 91 91 94 76 71

Ovation

FFPE Nugen 69 75 75 88 81 75

FFPE

Frozen Nugen 74 63 74 81 70 52

FFPE

GSE6791 86 83 81 88 86 62

 

Notes: Columns labeled with ‘unique' count the number of samples from distinct
tumors in that batch, tumors with replicate samples in other batches.

yielded subtype inference with 50 and 63% discrepancy from
subtypes inferred in the pSVA—corrected data, respectively.

3.4 Batch correcting training data enhanced cross-batch
and cross-study prediction accuracy

We extended our study to test prediction accuracy of the PAM
classiﬁer when including the independent dataset from Pyeon
et a]. (2007), GSE6791, containing additional frozen samples to
assess the prediction accuracy in future samples subject to new
batch effects. Speciﬁcally, we tested the accuracy of HPV status
predicted for each batch from PAM classiﬁers trained on the
remaining three independent batches (Table 2). Even without
batch correction, the prediction accuracy was higher than the
median cross—validation accuracy for the independent dataset,
GSE6791 (86%) and the frozen samples processed with the
Nugen Ovation Ampliﬁcation kit (88%) but degraded for the
samples processed with the Nugen FFPE Ampliﬁcation kit
(69% for FFPE samples and 74% for frozen samples).

We applied pSVA to batch correct the entire dataset and SVA
and/or ComBat only to the training data. Batch correction was
most essential to improving the prediction accuracy of the FFPE
samples above that of a naive classiﬁer that assigns all samples to
be HPV—negative. In all cases, the combination of SVA and
ComBat most accurately predicted HPV status. All other tech—
niques had mixed accuracy depending upon the batch. Notably,
applying pSVA to batch correct the test set improved the accur—
acy most for FFPE samples, which have the most technical arti—
facts (Supplementary Fig. S2) and class imbalance (Table 2).

3.5 pSVA batch correction stabilized prediction accuracy
in classifiers trained on samples with high confounding
between batch and HPV status

In the previous examples, each training and test set contain sam—
ples with widely different proportions of batch and HPV status,
potentially introducing confounding which altered results of pre—
diction accuracy. To control for this effect, we generated training
sets selected from GSE6791 (Pyeon et (11., 2007) and Frozen
Nugen Ovation samples that were representative of the distribu—
tion of HPV—positive and —negative HNSCC in these batches
(Table l) at various levels of confounding between batch and

 

O
’30
E‘—
>0
0
moo
L
8
O
0
(“L0
C
.‘Eo
13v
(D
E

0 20 40 60 80 100
"/0 of HPV+ training samples from 6791 and
HPV— samples from Frozen, Nugen Ovation

none  sva
- - combat --. sva+combat

— psva

Fig. 4. Classiﬁcation accuracy with confounded data. Median accuracy
of classiﬁers of HPV-status trained on subsets of batch-corrected data
simulated at varying levels of confounding, tested on independent frozen
samples processed with the Nugen_FFPE ampliﬁcation kit

biology. We tested the accuracy of the resulting PAM classiﬁers
of HPV status before and after batch correction on the well—
balanced Frozen Nugen FFPE samples.

We observed that prediction accuracy depended signiﬁcantly
on confounding, with PAM yielding median prediction accuracy
below that for the naive classiﬁer that classiﬁes everything as
HPV—negative when 8 of 10 HPV—positive samples were selected
from GSE6791 (Pyeon et (11., 2007) and 16 of 20 HPV—negative
from Frozen Nugen Ovation samples (Fig. 4). However, simply
balancing the HPV status with batch increased the median pre—
diction accuracy to that observed with both SVA and ComBat
when developing the HPV classiﬁer on the entire dataset exclud—
ing Frozen Nugen FFPE samples (Table 2). Both ComBat and
pSVA stabilized the median prediction accuracy (Fig. 4) and
variability in prediction accuracy across levels of confounding
(Supplementary Fig. S6). Although the combination of
ComBat and SVA stabilized median prediction accuracy, the
accuracy was lower and more variable than that observed for
ComBat or pSVA. Notably, pSVA improved median prediction
accuracy above ComBat at high levels of confounding and was
the only well—deﬁned algorithm at 100% confounding, improving
median prediction accuracy to levels observed for the naive clas—
sifier. SVA consistently degraded prediction accuracy below that
observed without batch correction. Moreover, no bias correction
techniques yielded classiﬁers that matched the high median ac—
curacy observed through simply having a balanced study design.

4 DISCUSSION

Batch correction techniques have been well established for class
comparison analysis of genomic data. Nonetheless, we observed
that these algorithms potentially removed true biological hetero—
geneity to facilitate such comparison. Therefore, we developed a

 

2761

ﬁm'spzumofpmpto'sopeuHOJmorq/ﬁdnq

H.S.Parker et al.

 

new batch correction technique, pSVA, which reversed the typ—
ical SVA (Leek et al., 2010) process to infer dominant sources of
signal that is independent of known sources of technical artifacts.
This algorithm simultaneously reduced differences in replicate
samples arising from technical artifacts while maintaining differ—
ences between unique samples not observed with other batch
correction techniques. Moreover, hierarchical clustering of
pSVA—corrected data clearly delineated established HNSCC sub—
types (Chung et al., 2004; Walter et al., 2013) from batch—affected
gene expression data. The pSVA classiﬁcation further divided the
Atypical group into two primary clusters, consistent with the
recent observation of the association of the Atypical group with
HPV—positive samples (Walter et al., 2013) and of subtypes within
HPV—positive HNSCC (Keck et al., 2013). Moreover, encoding
some of the known subgroups delineated by HPV status in our
model did not substantially alter the batch—corrected data with
pSVA. Therefore, we anticipate that future application of pSVA
to genomics data from other human cancers without a priori
knowledge of diseases will similarly retain patient—speciﬁc hetero—
geneity to facilitate class discovery. For example, encoding cancer
types as batch with pSVA, similar to the model employed for
batch correction in the TCGA PAN—CANCER project (Ciriello
et al., 2013), could better identify the molecularly distinct sub—
types across human cancers that are required for personalized
therapeutic selection. Beyond subtype identification, the pSVA
algorithm may also facilitate more subtle patterns in genomic
data using pattern—ﬁnding algorithms (Fertig et al., 2010), par—
ticularly adept for time course data. For example, pSVA may
enable the detection of the complex, interacting dynamic signals
in time course data without the prior knowledge of speciﬁc time
groups required for batch correction in Colantuoni et al. (2011)
and should be explored in future work.

An additional goal for genomics data is the development of
classiﬁers to infer clinical groups in future genomics datasets that
better assess prognosis or improve therapeutic selection.
Implementation of such personalized genomics requires applica—
tion of classiﬁcation rules learned on training data to independ—
ent test data, for which phenotype is by deﬁnition unknown a
priori. Because pSVA does not require knowledge of these
groups, the algorithm can naturally be applied to also batch
correct test data in such class discovery problems, and should
be compared with other emerging techniques including fSVA
(Parker et al., 2013). Consistent with our previous ﬁndings
(Leek et al., 2010; Parker and Leek, 2012), we ﬁnd that a well—
designed and balanced training set yields classiﬁers with the most
accurate prediction results. When training sets were large and
represented subtypes well across batches, batch correcting the
training data alone using SVA and ComBat yielded the most
accurate classiﬁers. However, these algorithms overcorrected
the data for smaller training sets, thereby degrading the accuracy
of genomics classiﬁers. Moreover, pSVA was notably the only
technique able to accurately predict HPV status in the presence
of substantial confounding between technical artifacts and
sample groups. This result suggests that pSVA may facilitate
the development of genomic biomarkers by combining public
datasets provided that at least one such dataset contains a
balanced sample design. Moreover, the ability of pSVA to cor—
rect for batch effects between frozen and FFPE samples may
facilitate the development of classiﬁers for human cancers, in

which the need to prioritize collection of FFPE samples from
tissue availability often introduces an imbalance in samples avail—
able to train genomic classiﬁers. Nonetheless, careful cross—val—
idation similar to that used in Parker and Leek (2012) must be
performed to assess the appropriate batch correction technique
for each dataset prior to building a genomic classiﬁer for use on
independent datasets.

Taken together, our results suggest that the batch correction
algorithm for genomics should be selected on the basis of the
desired analysis goal. Brieﬂy, these results suggest the use of the
combination of SVA and ComBat for differential expression ana—
lysis and class discovery algorithms. However, pSVA gains an
advantage for class discovery when the biological covariates rep—
resented in some of the genomic datasets are highly confounded
with batch. Moreover, pSVA also yields the most consistent clus—
ters, suggesting its use for class discovery problems. We note that
alternative approaches for class comparison, including Cancer
Outlier Proﬁle Analysis (MacDonald and Ghosh, 2006), that ac—
count for biological heterogeneity may likewise beneﬁt from use
of pSVA for batch correction. Because both pSVA and ComBat
require prior knowledge of batch variables, either SVA (Leek and
Storey, 2007) or control probe—based techniques (Gagnon—
Bartsch and Speed, 2012) are optimal for cases in which the
batch information is unknown a priori. The lack of biological
information in control—probes makes algorithms that use them
less likely to remove biological signal, making them possible al—
ternatives to pSVA for class discovery when batch is unknown.

The lack of technical artifacts in genes relevant to HNSCC
biology was essential to the accurate subtype identiﬁcation
observed without batch correction. This may also explain the
accuracy of cross—study and cross—batch prediction of HPV
status from classiﬁers inferred when only the training data was
batch corrected. However, we cannot assume the generality of
these results in other systems (Parker et al., 2013). Alternative
batch correction algorithms based upon control probes similarly
preserve hierarchical clusters and sample heterogeneity (Gagnon—
Bartsch and Speed, 2012) may be more adept at correcting for
technical artifacts when making inference of biological subtypes
directly from batch affected genes. However, the lack of control
genes in RNA—seq or common controls across array technologies
make pSVA a better candidate algorithm for preserving sample
subtypes in cross—platform and RNA—seq analyses. Therefore,
future extensions of pSVA are needed to account for technical
artifacts when a gene or set of genes used for sample classiﬁca—
tion are themselves subject to batch effects.

ACKNOWLEDGEMENTS

We thank Vonn Walter and Neil Hayes for providing the sub—
type classiﬁer and Michael F. Ochs, Ludmila Danilova, Luigi
Marchioni, Robert Scharpf and Rafael Guerro—Preston for
advice.

Funding: This work was funded by NIH NCI (CAl41053), the
Cleveland Foundation, and the NIH NCI SPORE in Head and
Neck Cancer at the Johns Hopkins University to E.J.F. The
project was funded in part by NIH NIDCR R01 (DEOl7982)
to C.H.C and RBRF l3—04—40279—H, Johns Hopkins University

 

2762

ﬁm'spzumofpmjxo'sopeuuqurorq/ﬁdnq

Presen/ing biological heterogeneity with genomics batch correction

 

Framework for the Future, and the Commonwealth Foundation
to A.V.F.

Conﬂict of Interest: none declared.

REFERENCES

Chung,C.H. et al. (2004) Molecular classiﬁcation of head and neck squamous cell
carcinomas using patterns of gene expression. Cancer Cell, 5, 4897500.

Chung,C.H. et al. (2010) Nuclear factor—kappa b pathway and response in a phase ii
trial of bortezomib and docetaxel in patients with recurrent and/0r metastatic
head and neck squamous cell carcinoma. Ann. Oncol., 21, 86¢870.

Chung,C.H. et al. (2011) Insulin—like growth factor—1 receptor inhibitor, amg—479, in
cetuximab—refractory head and neck squamous cell carcinoma. Head Neck, 33,
180471808.

Ciriello,G. et al. (2013) Emerging landscape of oncogenic signatures across human
cancers. Nat. Genet., 45, 112771133.

Cohen,E.E.W. et al. (2009) A feed—forward loop involving protein kinase calpha and
micrornas regulates tumor cell cycle. Cancer Re.\'., 69, 65774.

Colantuoni,C. et al. (2011) Temporal dynamics and genetic control of transcription
in the human prefrontal cortex. Nature, 478, 5197523.

Fertig,E.J. et al. (2010) Cogaps: an r/c++ package to identify patterns and biolo—
gical process activity in transcriptomic data. Bioinformatiax‘, 26, 279272793.
Gagnon—Bartsch,J.A. and Speed,T.P. (2012) Using control genes to correct for un—

wanted variation in microarray data. Bioxtatixticx, 13, 5397552.

Gilbert,J. et al. (2012) Phase 2 trial of oxaliplatin and pemetrexed as an induction
regimen in locally advanced head and neck cancer. Cancer, 118, 100771013.
Johnson,W.E. et al. (2007) Adjusting batch effects in microarray expression data

using empirical Bayes methods. Bioxtatixticx, 8, 1187127.

Keck,M.K. et al. (2013) Genomic proﬁling of kinase genes in head and neck squa—
mous cell carcinomas to identify potentially targetable genetic aberrations in
fgfrl/2, ddr2, epha2, and pik3ca. J. Clin. Oncol., 31, 365s.

Leek,J.T. and Storey,J.D. (2007) Capturing heterogeneity in gene expression studies
by surrogate variable analysis. PLoS Genet., 3, 172471735.

Leek,J.T. et al. (2010) Tackling the widespread and critical impact of batch effects in
high—throughput data. Nat. Rev. Genet., 11, 7337739.

Leek,J.T. et al. (2012) The sva package for removing batch effects and other un—
wanted variation in high—throughput experiments. Bioiiy’ormatiax', 28, 8827883.

Luo,J. et al. (2010) A comparison of batch effect removal methods for enhancement
of prediction performance using MAQC—ii microarray gene expression data.
Pharmaeogenomicx J., 10, 2787291.

MacDonald,J.W. and Ghosh,D. (2006) Copawancer outlier proﬁle analysis.
Bioiiy’ormatiax‘, 22, 295(F2951.

McCall,M.N. et al. (2010) Frozen robust multiarray analysis (fRMA). Bioxtatixticx,
11, 2427253.

Parker,H.S. and Leek,J.T. (2012) The practical effect of batch on genomic predic—
tion. Stat. Appl. Genet. Mol. Biol., 11, Article 10.

Parker,H.S. et al. (2013) Removing batch effects for prediction problems with
frozen surrogate variable analysis. arXiv, 1301.3947.

Pyeon,D. et al. (2007) Fundamental differences in cell cycle deregulation in human
papillomavirus—positive and human papillomavirus—negative head/neck and cer—
vical cancers. Cancer Re.\'., 67, 460574619.

Robinson,M. et al. (2010) Reﬁning the diagnosis of oropharyngeal squamous cell
carcinoma using human papillomavirus testing. Oral Oncol., 46, 4924196.

Slebos,R.J.C. et al. (2006) Gene expression differences associated with human papil—
lomavirus status in head and neck squamous cell carcinoma. Clin. Cancer Rec,
12 (3 Pt 1), 7017709.

Smeets,S.J. et al. (2007) A novel algorithm for reliable detection of human papillo—
mavirus in parafﬁn embedded head and neck cancer specimen. Int. J. Cancer,
121, 246572472.

Sun,Z. et al. (2011) Batch effect correction for genome—wide methylation data with
illumina inﬁnium platform. BMC Med. Genomim', 4, 84.

Tibshirani,R. et al. (2002) Diagnosis of multiple cancer types by shrunken centroids
of gene expression. Proc. Natl Acad. Sci. USA, 99, 6567$572.

Viljoen,K.S. and Blackburn,J.M. (2013) Quality assessment and data handling
methods for affymetrix gene 10 ST arrays with variable RNA integrity. BMC
Genomics, l4, l4.

Walter,V. et al. (2013) Molecular subtypes in head and neck cancer exhibit distinct
patterns of chromosomal gain and loss of canonical cancer genes. PLoS One, 8,
e56823.

 

2763

ﬁm'spzumofpmjxo'sopeuuqurorq/ﬁdnq

