APPLICATIONS NOTE

Vol. 27 no. 8 2011, pages 1157-1158
doi:10. 1 093/bioinformatics/btr0 76

 

Sequence analysis

Advance Access publication February 13, 2011

Improving SNP discovery by base alignment quality

Heng Li

Broad Institute, 7 Cambridge Center, Cambridge, MA 02142, USA

Associate Editor: John Quackenbush

 

ABSTRACT

Summary: I propose a new application of profile Hidden Markov
Models in the area of SNP discovery from resequencing data, to
greatly reduce false SNP calls caused by misalignments around
insertions and deletions (indels). The central concept is per-Base
Alignment Quality, which accurately measures the probability of a
read base being wrongly aligned. The effectiveness of BAQ has been
positively confirmed on large datasets by the 1000 Genomes Project
analysis subgroup.

Availability: http://samtools.sourceforge.net

Contact: hengli@broadinstitute.org

Received on October 14, 2010; revised on January 20, 2011;
accepted on February 6, 2011

1 INTRODUCTION

One of the leading sources of errors in SNP discovery is errors
caused by indels (Li and Homer, 2010). Current solutions include
realignment and ﬁltering SNPs around predicted indels. However,
realignment is computationally intensive; ﬁltering SNPs around
predicted indels is hampered by indel discovery which itself is a
harder problem. This article aims to provide an effective and efﬁcient
solution to sorting out SNPs caused by misalignments.

To begin with, we need to make a distinction between read
mapping and read alignment, which are often taken as synonymous.
I deﬁne the alignment of a read as the set of coordinate pairs of
read and reference bases that are placed together, while deﬁne the
mapping of a read as the coordinate interval between the ﬁrst and the
last reference bases inclusive in the alignment. We say an alignment
is correct if all bases are aligned correctly and say a mapping is
correct if it overlaps the true mapping. Therefore, an alignment can
be wrong even if the underlying mapping is correct.

Wrong alignments are mostly caused by the ambiguity in the
presence of indels when we are unsure whether differences should
be explained by mismatches or by indels. They tend to reoccur in
the same context and deceive SNP callers into calling false SNPs.

To account for the intrinsic alignment ambiguity, I model the read
alignment with a proﬁle HMM and compute a per-Base Alignment
Quality (BAQ) to directly evaluate the probability of misalignment
of each base. I will show that by replacing the original base quality
with the minimum between the base quality and BAQ we can
dramatically improve the SNP accuracy.

2 METHODS
2.1 The proﬁle HMM for computing BAQ

Let the nucleotide reference sequence be x: r1 r2 . ..rL (in practice x is the
reference subsequence around a mapping) and the read sequence be y:
cool mete,“ where co E ‘“ marks the start of the read and 01+] E ‘$’ marks

   

Fig. 1. The topology of the proﬁle HMM for BAQ computation. It consists
of ﬁve types of states: alignment matches (M ). insertions to the reference (I).
deletions (D). alignment start (S) and alignment end (E). The S state points
to every M and I state while every M and I points to E. States S and E are
plotted together to avoid excessive dotted lines in the ﬁgure.

the end. Let 6,». i=1...l. be the substitution probability associated with Ci,
which in practice is set to be the maximum between the scale mutation rate
and the sequencing error probability deduced from the base quality. We can
construct a proﬁle HMM to simulate how to generate the read sequence y
from the reference x without considering introns (Fig. 1).

If we index the ﬁve types M. I. D. S and E by 0. 1. 2. 3 and 4. respectively.
the transition matrix between types of states is:

(1—2“)(1—i/)€¥(1—i/)€¥(1—7)01/
(1-i3)(1-J/)i3(1-i/) 0 01/

(aij)5><5= 1—13 O 13 O O
(1—oz)/L a/L 0 0 0
0 0 0 0 0

where at is the site-independent gap open probability. [3 the gap extension
probability and y: 1/(21) controls the average length of the read which does
not affect the computation of BAQ in practice. although a formal proof is
lacking. By default oz and [3 are set to 0.001 and 0.1. respectively. They
should be adjusted based on the sequencing indel error rate.

As to emissions. the S state only emits the start symbol (‘A ’) and E emits
the end (‘$’). D are silent states that do not emit any symbols. The emission
probability from [k is set to 0.25. and from M is a function of substitution
probabilities {61’}, which is. for i=1,...,l:

l—e, ifrkzci

P(Cile) = eki = { 6/?) otherwise

2.2 The forward and the backward algorithms

The recurrence equations are given as follows where any undeﬁned values
in the forward matrix f or the backward matrix I) are assigned to zeros. The
initialization of the forward algorithm is (k=1,...,L):

f0,S=1»fl,Mk Zek1030»fl,lk =a31/4

 

© The Author 2011. Published by Oxford University Press. All rights reserved. For Permissions, please email: journals.permissions@oup.com 1157

112 /3.Io's[Bumo[pJOJXO'sotquJOJutotqﬂ:duq 11101} popeolumoq

9103 ‘Og anﬁnv uo ::

H.Li

 

Fori=2,...,l and k=1,...,L:

fi,Mk = ekilaOQﬁ—1,Mk_1+amﬁ—1,1k_1+020ﬁ—1,Dk_1]
fiJk = (“Oin—LMk +allfi—1Jk)/4
flyok = 6102]?qu +a22fi,0k_1

and for i=l+1:
ﬁ+1,E = Z (a04fl,Mk +a14fi,1k)

k
The initialization of the backward algorithm is

bi+1,E =1, bl,Mk =ao4, 171,1,c =ai4
For i=l—1,...,1 and k=L,...,1:
bi,M,C = €k+1,i+1a00bi1,Mk+l +6101bi+1,1,C /4+a02bi,ok+1
17,31,C = €k+1,i+1a10bi+i,Mk+1+a11bi+1,1k/4
bank = (1—5i1)[€k+i,i+ia20bi+i,Mk+l +a22bi,ok+1]

and for i = 0:
bus = Z (ekla30b1,Mk +a31b1,1k/4)
k
The probability of the read being generated from the reference equals
ﬁ+1,E=b0,s. In development. evaluating the equality helps to check the
correctness of the implementation.

2.3 Computing BAQ

We deﬁne an alignment A as a set of coordinate pairs {(i1,k1),...,(i],,k],)}
with 15 i1 <--- < i], fl and 1 5k] <  <k], 5L. For convenience. deﬁne

>_ _ k if(i,k)eA
Kl _  _ l 0 otherwise

as the coordinate of the reference base that the read base 0,» is aligned to. The
BAQ is computed as

Q(i|A) = —1010g10[1—Pr{i-th read base aligned to K,»|A}]
fi,MK,. 'bi.MK,. ]

ﬁ+1,E

—1010g10|:1—

As Q(i|A) is mostly above 40. the logarithm scale is appropriate. In SNP
calling. we update the i-th base quality to min{q,»,Q(i|A)} where q, is the
original base quality. The SNP calling algorithm may not need to be changed.

2.4 Numerical stability and banded acceleration

Given long sequences. the forward/backward algorithm given above may
suffer from ﬂoating point underﬂow. For numerical stability. we compute

fly; 171;}?

i l l +1
1‘1}:on szi S]

instead. where 1; represents any state and the scaling factor s, is chosen such
that 21;]; = 1. I refer to Durbin et al. (1998) and the source code for details
on computing f . l; and s.

Another concern with the computation of BAQ is the quadratic time
and space complexity 0(L-l). This can be resolved by only computing the
forward and the backward matrices within a band that is large enough to
contain the likely alignments.

l

 

 

131} = bi)? =

3 RESULTS AND DISCUSSIONS

BAQ is implemented in the SAMtools software package (Li et al.,
2009), distributed under the MIT open source license.

2.3
2.25
2.2
2.15
2.1
2.05
2
1.95
1.9

Raw alignment, unfit ----A---
1.85 BAQ, unfiltered 
BAQ, filtered —|—

1.8
130 140 150 160 170 180 190 200 210 220 230

Accumulative transition/transversion ratio

 

# SNP calls (x1000)

Fig. 2. Transitionetransversion ratio (ts/tV) as a function of the number of
SNP calls. SNPs are sorted by the posterior probability of the site being a SNP
(SNP probability). Given a threshold on the SNP probability. the number of
SNPs of higher probability and their ts/tV are plotted. For the solid line. ﬁlters
in use are as follows: (i) total depth below 500; and (ii) root mean square
mapping quality above 10; (iii) P-Value of reference and non-reference bases
being evenly distributed on both strands is above 10‘4 (by exact test).

I applied the method to the chromosome 20 alignment of 6010w-
coverage pilot CEU samples from the 1000 Genomes Project (1000
Genomes Project Consortium, 2010), which is done in 12 CPU
hours with 110MB memory. Figure 2 compares the quality of the
call sets with and without BAQ applied. Note that for human, the
transition/transversion ratio (ts/tv) is above 2, while ts/tv of random
errors is 0.5. Thus, a worse call set tends to have a lower ts/tv.
The much higher ts/tv with BAQ applied indicates that BAQ has
effectively suppressed many false SNPs.

In conclusion, BAQ successﬁilly resolves false SNPs caused
by misalignment and improves the accuracy of SNP discovery. In
addition to base quality and mapping quality (Li and Homer, 2010),
BAQ is another useﬁil statistic towards accurate SNP calling.

ACKNOWLEDGEMENTS

I am grateful to Gabor Marth and Hyun Min Kang whose works have
inspired me to develop BAQ, to the 1000 Genomes Project analysis
subgroup for the helpful discussions and to the three reviewers
whose comments have helped me to improve the manuscript.

Funding: NIH 1000 Genomes Project (grant 1 U01 HG005208-01 ).

Conﬂict of Interest: none declared.

REFERENCES

1000 Genomes Project Consortium (2010) A map of human genome variation from
population-scale sequencing. Nature, 467, 106171073.

Durbin,R. et al. (1998) Biological Sequence Analysis: Probabilistic Models of Proteins
and Nucleic Acids. Cambridge University Press, Cambridge, UK.

Li,I-I. et al. (2009) The Sequence Alignment/Map format and SAMtools. Bioinformatics,
25, 207872079.

Li,I-I. and Homer,N. (2010) A survey of sequence alignment algorithms for next-
generation sequencing. Brief Bioinform., 11, 473783.

 

1158

112 /3.Io's[Bumo[pJOJXO'sotwuiJOJurorqﬂ:duq ulotj papeolumoq

9103 ‘Og isnﬁnv uo ::

