APPLICATIONS NOTE

Vol. 30 no. 9 2014, pages 1329—1330
doi:1 0. 1093/bioinfonnatics/btt770

 

Systems biology

Advance Access publication January 8, 2014

Enhanced flowType/RchyOptimyx: a Bioconductor pipeline for
discovery in high-dimensional cytometry data
Kieran O’Neilll'z'l, Adrin Jalalil'z'e'l, Nima Aghaeepourl'z'l, Holger Hoos4 and

Ryan R. Brinkman1'5'*

1Terry Fox Laboratory, British Columbia Cancer Agency, Vancouver, BC V5Z 1L3, Canada, 2Bioinformatics Graduate
Program, University of British Columbia, Vancouver, BC V6T 1Z3, Canada, 3Max-Planck-lnstitut fur lnformatik, Saarland
University, 66123, Saarbrucken, Germany, 4Departments of Computer Science and 5Departments of Medical Genetics,
University of British Columbia, Vancouver, BC V6T 1Z3, Canada

Associate Editor: Martin Bishop

 

ABSTRACT

Summary: We present a significantly improved version of the flowType
and RchyOptimyx BioConductor-based pipeline that is both 14 times
faster and can accommodate multiple levels of biomarker expression
for up to 96 markers. With these improvements, the pipeline is pos-
itioned to be an integral part of data analysis for high-throughput ex-
periments on high-dimensional single-cell assay platforms, including
flow cytometry, mass cytometry and single-cell RT-qPCR.
Availability: FlowType and RchyOptimyx are distributed under the
Artistic 2.0 license through Bioconductor.

Contact: rbrinkman@bccrc.ca

Received on October 7, 2013; revised on November 25, 2013;
accepted on December 11, 2013

1 INTRODUCTION

Flow cytometry has undergone a ‘chromatic explosion’ over the
past decade and can now measure 17 markers at once for each of
hundreds of thousands of individual cells (Chattopadhyay et al.,
2008). Since then, mass cytometry has enabled measurement of
3045 markers /cell (Bendall et al., 2012), whereas single-cell multi-
plexed RT-qPCR can measure 5&96 messenger RNAs/cell
(White et al., 2011). The growth in high-throughput single-cell
data continues to outpace development of corresponding bio-
informatics techniques (Chattopadhyay et al., 2008). To answer
this challenge, we previously developed ﬂowType (Aghaeepour
et al., 2012a) and RchyOptimyx (Aghaeepour et al., 2012b).
FlowType uses partitioning of cells, either manually or by cluster-
ing, into positive or negative for each marker to enumerate all cell
types in a sample, e.g. Aghaeepour et a]. (2013). RchyOptimyx
measures the importance of these cell types by correlating their
abundance to external outcomes, such as disease state or patient
survival, and distills the identiﬁed phenotypes to their simplest
possible form. These packages have been used to identify several
novel cell populations correlated with HIV outcome (Aghaeepour
et al., 2012a). More recently, this pipeline has been used to evalu-
ate standardized immunological panels (V illanova et al., 2013), to

 

*To whom correspondence should be addressed.
7‘The authors wish it to be known that, in their opinion, the ﬁrst three
authors should be regarded as joint First Authors.

optimize lymphoma diagnosis (Craig et al., 2013) and to analyze a
range of other clinical data (unpublished data).

However, the higher dimensionality of data produced by mass
cytometry generates up to 345 B 1021 possible cell types, with an
even greater number (up to 396 B 1045) for single-cell qPCR;
these magnitudes are beyond the capabilities of ﬂowType and
RchyOptimyx. Furthermore, ﬂowType and RchyOptimyx have
thus far only treated cells as being either positive or negative for
a marker. In practice, many biomarkers can have a range of
expression levels such as ‘dim’ and ‘bright’. In this application
note, we detail architectural improvements to ﬂowType and
RchyOptimyx to overcome these limitations.

2 APPROACH

Our primary challenge was to enable ﬂowType to generate a
number of cell types tractable on most common workstations
(e. g. those with #12 GB of RAM). We hereafter denote the ori-
ginal ﬂowType implementation as ﬂowType-BF (brute force) and
the new version as flowType-DP (dynamic programming).
Whereas ﬂowType-BF completely enumerates all cell types over
all [1, ..., m] markers, we opted in ﬂowType-DP to use a breadth-
ﬁrst strategy of enumerating all cell types defined over a subset of
k 5 m markers. We provide a memory use estimation function to
assist users in ﬁnding a k that fits within the limits of their hard-
ware. To improve computation time in ﬂowType-DP, we imple-
mented a dynamic programming approach, which exploits the
fact that cell types can be arranged into a hierarchy, and member-
ship of any given cell type over n markers is equal to the intersec-
tion of one of its parent types (over n—l markers) with a single-
marker cell type. FlowType-DP first enumerates all cell types
involving only one marker by simple partitioning and then iterates
over 2, ..., k markers, computing all cell types for each level n by set
intersections between corresponding cell types in levels n— 1 and 1.

For example, membership of the cell type CD45++CD117Jr
CD34‘ is computed as follows:

{CD45++CD117+CD34’}
= {CD45++CD117+} n {CD34’}
2 {CD45++} n {CD117+} n {CD34’}

To allow partitioning into levels other than positive and nega-
tive, we used a string representation for cell types. The string has

 

© The Author 2014. Published by Oxford University Press. All rights resen/ed. For Permissions, please e—mail: journals.permissions@oup.com 1329

112 /310'S[BIIJHO[pJOJXO'SOlJ’BLUJOJIIlOlq”K1111] 11101} papBoIII/noq

91oz ‘Og isnﬁnV uo ::

K.O’Neill et al.

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

, I Comparative run time by
(a) Comparative run time by number of cells  (0m number 0' markers
I i
,' I
§ _ i a t
_ Mmop , — mrmnp It
' I
a l ’5‘ '
i g _ l a I
a: — ,' K E ' l
.E ; E .'
.. 'z i
c ,' = y
= = .
m a ' I
g _ I. n: E _ I,
ll /
I, I'
a _ l _______ - — "' _/ a —___-_-’/
l é ; i Q 5 Q . s . {In
Iog10(number of cells) Number of markers
(c) Theoretical memory use  Maximum number of markers which can be used
for 34 markers, 100.000 cells in combination for 15 marker data
:2. s
u:
z
.2
TI?
‘5_ .E
T D
in
.E a
3 n)
E , i‘
E E
ll
E 2
‘e- 1%
3
n.
E
E- a
. . . . . . . N
n 5 m I5 2:: u m as 4 o 2 4 e a 10

Maximum marker combination size Number of cells (x 100,000)

 

 

 

(e) CD45/SSC gating strategy  RchyOptimyx analysis of
CD34+ prevalence in an AML sample
q ‘ c045. 0045 . ems...
CW5 toms"? c045 (coasw‘) @
m _
SSC»
3": (556”)
(\l
w ssc‘ CD45+CD117+ SSC+
"3 {sscm‘i

 

 

 

 

 

 

 

sscr
{ssc'wl
r I I
4

CD457ECD

SSC+ CD117+ CD45+

CD117+ SSC+ CD45+

SSC+CD117+CD45+

SSC+CD117+

n
Proportion of phenotype which is 0034+

Fig. 1. (a and b) Run time comparison of ﬂowType-DP to ﬂowType-BF in terms of number of cells (a) and number of markers (b). (c and (1) Possible
thresholds for marker combinations using ﬂowType-DP for typical mass cytometry data (c) and polychromatic ﬂow cytometry data ((1). (e and 1') Three/
four partition ﬂowType-generated RchyOptimyx-visualized cell type hierarchy on a bone marrow sample from a patient with AML. Cell population
identiﬁcation strategy used for SSC and CD45, with the CD34-enriched subset highlighted (e). RchyOptimyx analysis showing CD34 enrichment (1)

one integer character for every marker, denoting the partition, or
zero if the marker is not used. Values 1, ...,n denote partitions
1 to n. For example, if the set of markers were {CD3, CD45,
CD13, CD117, CD34}, the cell type CD45++CD117+CD34’
would be represented by 03021. RchyOptimyx uses a dynamic
programing algorithm for efﬁciently constructing k-shortest
paths (Eppstein, 1998). We modiﬁed RchyOptimyx’ graph con-
struction component to be able to handle more than one parti-
tion per marker.

3 RESULTS AND DISCUSSION

We evaluated ﬂowType-DP against ﬂowType-BF on a 10-
marker dataset available from Flow Repository (ID FR-FCM-
ZZZK) (Aghaeepour et al., 2012a). FlowType-DP showed a sub-
stantial speedup over ﬂowType-BF, which increases exponen-
tially with the number of cells and markers. For example, at
106 cells and 10 markers, flowType-DP is 14 times faster (see
Fig. 1a and b). Comparison on larger datasets was not possible
due to the limitations of ﬂowType-BF.

We also computed the limits for k on a hypothetical machine
with 12 GB of RAM for samples representative of mass cytome-
try (Fig. 1c) and polychromatic ﬂow cytometry (Fig. 1d), both of
which would be intractable for ﬂowType-BF. FlowType and
RchyOptimyx are now able, within the memory of a common
workstation (12GB), to analyze 34-marker data.

Finally, to demonstrate the importance of several partitions
per marker, we applied ﬂowType and RchyOptimyx to an acute
myeloid leukemia (AML) sample from Flow Repository (ID FR-
FCM-ZZYA) (Fig. 1e and f). CD34 is a stem cell marker typic-
ally expressed on AML blast cells. These blasts are also known to
have dimly positive CD45 expression and low side scatter (SSC)
(Vial and Lacombe, 2001). By partitioning CD45 and SSC into

four and three partitions and naively running ﬂowType and
RchyOptimyx to search for CD34-enriched cell types, we were
able to find that the SSCIWCD45dim cell type had a high propor-
tion of CD344r cells, as expected. This would not have been
possible with only two partitions for each of CD45 and SSC.

Funding: ISAC scholar program, CIHR/MSFHR scholarship for
strategic training in bioinformatics, UBC 4YF scholarship, NIH/
NIBIB (EB008400), Canadian Cancer Society (700374), the
Terry Fox Research Institute and the Terry Fox Foundation.

Conﬂict of Interest: none declared.

REFERENCES

Aghaeepour,N. et al. (2012a) Early immunologic correlates of HIV protection can
be identiﬁed from computational analysis of complex multivariate T—cell ﬂow
cytometry assays. Bioinformatics, 28, 100971016.

Aghaeepour,N. et al. (2012b) RchyOptimyx: cellular hierarchy optimization for
ﬂow cytometry. Cytometry A, 81, 102271030.

Aghaeepour,N. et a]. (2013) Critical assessment of automated ﬂow cytometry data
analysis techniques. Nat. Methods, 10, 2287238.

Bendall,S.C. et a]. (2012) A deep proﬁler’s guide to cytometry. Trends Immunol., 33,
3237332.

Chattopadhyay,P.K. et a]. (2008) A chromatic explosion: the development and
future of multiparameter ﬂow cytometry. Immunology, 125, 441.

Craig,F. et a]. (2013) Computational analysis optimizes the ﬂow cytometric evalu—
ation for lymphoma. Cytometry B Clin. Cytom., [Epub ahead of print, doi:
10.1002/cytob.21115].

Eppstein,D. (1998) Finding the k shortest paths. SIAM J. Comput, 28, 652$73.

Vial,J.P. and Lacombe,F. (2001) Immunophenotyping of acute leukemia: utility of
CD45 for blast cell identiﬁcation. Methods Cell Biol., 64, 3437358.

Villanova,F. et a]. (2013) Integration of lyoplate based ﬂow cytometry and compu—
tational analysis for standardized immunological biomarker discovery. PLoS
One, 8.

White,A.K. et a]. (2011) High—throughput microﬂuidic single—cell RT—qPCR. Proc.
Natl Acad. Sci. USA, 108.

 

:: 112 /310's112u1n0[p10}x0"sotJBuiJOJutotq/ﬁduq 11101} papeolumoq

910z ‘09 Isnﬁnv 110

