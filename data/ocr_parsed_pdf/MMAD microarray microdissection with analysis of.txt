BIOINFORMA TICS

0'so;112u110}u101q//2duq

SIBumoprOJX

£10"

MMAD

 

normalization bias, incorporation of information theory criteria
to minimize overﬁtting and methods for comparing gene expres—
sion between classes, either globally or on a cell—speciﬁc basis. An
overview of MMAD is provided in Supplementary Figure SI.

2 METHODS

2.1 Deconvolution model

Let X ,7 be the observed microarray expression value for gene (or probe) i
and sample j, and Xi) be the logz-transform of Xi). Let I denote the number
of genes (or probes) and J denote the number of samples. If we assume
that there are K cell types that exist in varying mixing proportions in the
given samples, then we can model the observed gene expression proﬁle
as a linear combination of contributing cell types with a log-normally
distributed error term:

K
Xij = logz  Cikfkj) + eij (1)
[:1

Here, C ,k is the characteristic gene expression for gene i with respect to
cell type k, and fk/ is the fraction of total messenger RNA (mRNA)
contributed by cell type k in sample j. Of note, although we refer to C
and f as characterizing the gene expression proﬁles of individual ‘cell
types’, they can more generally characterize any source of mRNA with
a characteristic expression proﬁle that is present in varying concentrations
in a set of samples. These could include individual cell types (e.g. ﬁbro-
blasts, cardiomyocytes, adipocytes), different cellular states (e.g. cells
entering mitosis, cells in G0) or even pure sources of mRNA mixed
within a laboratory setting. For simplicity, we will continue to refer to
these as ‘cell types’ for the remainder of this article.

2.2 Adjustment for bias in reported cell fraction

Unfortunately, there is no guarantee that the estimated cell fraction pro-
vided by the investigator corresponds directly to the measurable fraction
of RNA contributed by each cell type. We consider the (not infrequent)
case in which the cellular fraction (as assessed by cell count) is used as a
surrogate for the RNA fraction, f. Let NM represent the number of cells of
type k in sample j. If the measurable RNA content per cell, pk, varies for
each cell type k, the reported value off will be biased. That is,
N »' DAN/‘7'

A1
fkj. reported = , whereas fkj~ mum = — (2)
2'] NW 24] quqj

 

To account for this, we introduce the concept of the effective RNA
fraction f ’, which replaces f in Equation (1), and which is linked to the
investigator-reported fraction f for a given sample j and cell type k by the
following:

11,- = awn,- (3)

Here, ozk is a non-negative RNA source-speciﬁc scaling constant, and )3) is
a non-negative sample-speciﬁc scaling constant. This formulation
allows for straightforward correction of systematic reporting biases in
f described earlier in the text. Of note, for this article, we do not constrain
Zkﬂ‘j = l for all samples j, as normalization of microarray data
during preprocessing typically results in small but computationally
signiﬁcant deviations from this ideal constraint. We do, however, include
the option to constrain Zkfkj = 1 during implementation of MMAD.

2.3 Optimization

For microarray studies of mixed tissue specimens, the contributing cell
types, their characteristic gene expression proﬁles, C, and the effective
RNA fractions, f ’, may or may not be known. These parameters can be

estimated in MMAD using a maximum likelihood approach by minimiz-
ing the residual sum of squares given by

I .
a = Z 2 (xi,- — a]? (4)
where
A K A A
Xi]- : Z Cikfj‘j and xi]- = log2 Xi]- (5)

Additional modiﬁcations are incorporated, depending on the level of
prior knowledge about the cell types present in the mixed tissue.

2.3.] C is known, f is unknown In this case, we optimize the un-
known parameters by simply minimizing the residual sum of squares
given by Equation (4) using a non-linear conjugate gradient search algo-
rithm implemented in MATLAB. The maximum likelihood estimates of
oz, )3 and f are all constrained to be non-negative.

2.3.2 C is unknown, f is known Estimation of C when f is known
can be performed independently for each gene i by minimizing the re-
sidual sum of squares for that gene. We modify this approach by
hypothesizing that some cell types may share common expression levels
for gene i. To address this possibility and minimize overﬁtting, we evalu-
ate all possible partitions of the K cell types into subsets, and constrain all
cell types in a given subset to have identical expression levels for that gene
i. Let P represent one possible partition, and let N p be the number of
distinct subsets under that partition, where l 5 N p: K. Let P be the
expression level of gene i for cells in subset s under partition P. In this
case, the estimated expression of gene i for cell k is given by

NP
Cik = ZSA‘MP ' CZ“: 
s21
where

(7)

8 _ 1, if cell k e subset s, given partition P
“MP _ 0, else

Let 8"”) be the residual sum of squares after optimizing model fit under
partition P for gene i. To select which partition is best supported for each
gene by the available data, we use the corrected Akaike information
criterion (AICC) as deﬁned by Hurvich and Tsai (1989). AICC provides
a measure of model fit that balances the likelihood of observing the given
data under the model against the number of parameters estimated for
that model. The AICC for partition P and gene i is given by

2.1-(Np+1)

J—Np—Z (8)

AICC = J - lOgEi‘p +

The partition that is associated with the lowest AICC for each gene is

used to generate the ﬁnal estimates of C‘ for that gene. It is important to

note that different partitions may be selected for different genes. In situ-

ations where it is computationally intractable to consider all possible
partitions, we can approximate the number of distinct subsets by

K K Eip_8iq 2 ’1
 >l> 

where A. is a small positive number. We solve for the values of C‘ that
minimize the approximate AICC. We gradually shrink A(.—>0, allowing
the ﬁnal estimates to approach an AICc-informed model ﬁt. Of note,
during optimization, we constrain our estimates 817‘. = log2 6,). to fall ap-
proximately within the same dynamic range as the given dataset by using
the minimum (Xmin) and maximum (Xmax) expression values over all genes

and all samples in the dataset to deﬁne our constraint boundaries:

(Xmin _  S 81* S (Xmax +  

 

ﬁm'spzumofpmﬂo'sopnuuopnoiq/ﬁdnq

D.A.Liebner et al.

 

2.3.3 C and f are unknown In this case, we note that maximum
likelihood estimates of C and f ’ obtained by minimizing [Equation (4)]
are not uniquely determined without the incorporation of prior know-
ledge or additional constraints (Taslaman and Nilsson, 2012). We agree
with Gaujoux and Seoighe (2012) and Zhong et al. (2013) that a priori
knowledge about the cell types of interest should be incorporated if pos-
sible; in particular, if certain genes are known to be highly speciﬁc for a
given cell type, then those genes can be used to estimate f for that cell
type. Let us assume that for each cell k, there exists a subset of genes, Gk,
which is highly speciﬁc to that cell k. Then, for all genes g e Gk, xg/ would
be approximated by

xgl- =10g2(Cgkfl{j + Bg) + e,»,- (11)

where 1'3g is the background expression for gene g. Unfortunately, a spe-
ciﬁc list of genes is not always available for each of the cell types present
in a given sample. For the purposes of MMAD, in the absence of prior
information about the constituent cell types, we assume that those genes
with the highest variability in the sample set are most likely to be differ-
entially expressed by the different cell types. We assign each of these
highly variable genes (default is the top 1% most variable genes) to a
putative cell type using k-means clustering with Pearson’s correlation
coefﬁcient as the distance metric.

Once appropriate cell-speciﬁc gene subsets have been established, we
estimate C, f and B for each gene by minimizing the residual squared
error.

80:

K .I
2 Zoe- — fig-)2] (12)
A 1 1

EC]; j:

We use the estimate off obtained in this manner to approximate C for
all genes in the sample by AICC optimization as outlined in Section 2.3.2.

2.4 Tests for differences between classes

Assume that the samples in a given dataset X can be divided into two
distinct classes. Let C“) and Ca) be the characteristic gene expression
proﬁles for the different cell types, and let f (I) and f (2) be the class-speciﬁc
cell fractions. Differences in gene expression and cell type composition
between classes are assessed as follows:

2.4.] Differences in cell fraction between classes Estimates of
effective RNA fraction in each sample are ﬁrst obtained using the appro-
priate algorithm mentioned earlier in the text without using class infor-
mation. Class-speciﬁc cell fractions are then compared using a two-tailed
unpaired t-test as implemented in MATLAB using the function t-test2().

2.4.2 Differences in cell type—specific gene expression between
classes In cases where f is unknown, we ﬁrst estimate f for all of the
samples as per Section 2.3.3. For each gene i, we then compare the null
model of differential expression (no differential expression in any of the
cell types between the two classes) with all models in which gene i is
differentially expressed by just one of the cell types k. For computational
reasons, we do not consider models in which >1 cell type differentially
expresses gene i. We calculate the AICC for each of these models, as well
as the AICC weight, which is the relative support for the given model
when compared with all models under consideration:

1
eifAICc. modcudm‘tlztl

(13)

wrnodcl[diff(k)] = ilAIC fjAIC ‘
e 2 c.modcl[null] + 28 2 c.modcl[dtﬂ(lt)]
[7

We deﬁne the MMAD cell-speciﬁc differential expression test statistic
for gene i and cell type by

Mccllispcciﬁc. ik = —10g(1 — winodcl[diff(k)]) (14)

Larger values are consistent with greater support for differential
expression of gene i in cell type k. P-values and false discovery rates
can be estimated using a permutation-based approach in which class
labels are randomly permuted and the statistics are recalculated.

2.4.3 Global test for differences in cell—specific gene
expression The global test for differences in cell-specific gene expres-
sion summarizes the existing support for differential expression in at least
one of the cell types present in the sample:

Mglobal.i = — 10g(1 — 2A, winodcl[diff(k)]) (15)

Once again, larger values are consistent with greater evidence for
differential expression for gene i in at least one of the cell types in the
sample. P-values and false discovery rates can be estimated using a
permutation-based approach.

2.4.4 Comparison metrics for differences in gene expression As
our comparison metrics, we evaluated (i) a two-tailed t-test, (ii)
signiﬁcance analysis of microarrays (SAM) (Tusher et al., 2001) and
(iii) cell type-speciﬁc signiﬁcance analysis of microarrays (csSAM)
(Shen-Orr et al., 2010). The t-test was implemented using the
MATLAB function t-test2() (MATLAB R2012b), SAM using the
samr() package in R (version 2.15.1) and csSAM using the csSAM R
package (R version 2.15.1).

2.5 Simulation

To assess model performance, we created a dataset consisting of simulated
colorectal adenocarcinoma cells, adipose cells and CD84r T-cells in differ-
ent mixing proportions. For each of the selected cell types, we used publicly
available gene expression data from the Gene Expression Omnibus (GEO),
series GSE1133, to deﬁne the characteristic gene expression proﬁles (Su
et al., 2004). All samples selected had been run on the Affymetrix HG
U133A Array. We downloaded the raw CEL ﬁles from GEO and used
the median-normalized gene expression data to deﬁne the cell-speciﬁc ex-
pression proﬁles (C). For each sample j and cell type k that was simulated,
we sampled the effective RNA fractions (fkf) from a Dirichlet distribution.
The ﬁnal value ofxif was calculated per Equation (1) with eif drawn from a
normal distribution with variance set equal to the global variance in gene
expression between duplicate samples in GSE1133.

2.6 Data preprocessing

Background adjustment for simulated data was performed using the
MATLAB function rmabackadﬂ). Median and quantile normalization
were performed using the MATLAB functions manorm() and quantile-
norm(), respectively. Robust Multichip Average (RMA) summarization
(Bolstad et al., 2003) was performed using the MATLAB function rma-
summary(). Preﬁltering of Affymetrix probes was performed using the
Micro Array Suite 5.0 (MAS5.0) algorithm with r=0 (Hubbell et al.,
2002).

3 RESULTS

We present a method for the in silico microdissection of tissue
samples into component cell types that is both ﬂexible and
robust.

3.1 Properties of MMAD deconvolution algorithm

3.1.] Data preprocessing Background subtraction and quantile
normalization can alter the linear relationship between probes
in an intensity—dependent manner; median normalization pre—
serves linearity though it is less robust when adjusting for

 

ﬁm'spzumofpmjxo'sopnuuqurorq/ﬁdnq

 

/310'S[BIIJHO[pJOJXO'SOIJBLUJOJIIIOIq/ﬂduq

 

/310'S[BIIJHO[pJOJXO'SOIJBLUJOJIIIOIq/ﬂduq

MMAD
Reps bar (201

High Var (MMAD) 00'0" Ca (MMAD)
High Var (SAM) Colon Ca (csSAM)

Moderate Var (MMAD) CDS' Toe" (MMAD)

Moderate Var (SAM) CD8‘ Toell (csSAM)
i Low Var (MMAD) — Adipose (MMAD)

Low Var (SAM) A ' 5e csSAM

 

/310'S[BIIJHO[pJOJXO'SOIJBLUJOJIIIOIq/ﬂduq

D.A.Liebner et al.

 

In this article, we designed and validated a ﬂexible new
method for performing computational microdissection of com—
plex tissues and analyzing differences between classes. By
accounting for this heterogeneity with robust methodologies,
we believe that investigators will improve their ability to discover
pertinent (and potentially disease—modifying) differences in gene
expression.

MMAD incorporates features of previous algorithmic
approaches to tissue deconvolution (Abbas et al., 2009; Bolen
et al., 2011; Erkkila et al., 2010; Gong et al., 2011; Lahdesmaki
et al., 2005; Lu et al., 2003; Repsilber et al., 2010; Shen—Orr et al.,
2010; Stuart et al., 2004; Venet et al., 2001; Wang et al., 2006)
and also introduces several novel ideas. Key features of MMAD
include the following:

(1) Computational microdissection with MMAD does not
require prior knowledge about contributing cell types
(although such knowledge can be incorporated into the
model). We have demonstrated that estimates of cell frac—
tion and cell type—speciﬁc gene expression can be obtained
using existing gene expression data or cell fraction data
when available or by using a ‘blind’ deconvolution. In all
cases, results obtained with MMAD compare well to pre—
viously described approaches. This is particularly true for
‘blind’ deconvolutions. The ﬂexibility of this approach is
important for analysis of many biologic systems, as the
fractional contribution of individual cell types may be un—
known or known with limited precision.

(2) Biologic variation is modeled assuming log—normal vari—
ation, an assumption which is shared with several standard
normalizations and analysis metrics used to test for differ—
ential expression (Bolstad et al., 2003; Tusher et al., 2001).
Importantly, though, the deconvolution uses the natural
scale gene expression values (not log—transformed) as rec—
ommended in Zhong and Liu (2012). This allows us to fit
the observed data with more realistic models and, conse—
quently, to make more natural inferences about differen—
tial gene expression. A similar statistical model was
recently used by Ahn et al. (2013).

(3) We introduce the concept of effective RNA fraction (as
distinct from the reported RNA fraction) that improves
the results of computational microdissection by account—
ing for subtle normalization and reporting biases.

(4) We note that overﬁtting is a potential source of bias in
computational microdissection, which has been largely
overlooked in previous approaches. We include a standard
information metric (AICC) during model fit to reduce po—
tential overﬁtting. We demonstrate that the effect of this
approach is most noticeable in cell types present at low
frequencies within mixed tissue samples.

(5) We introduce several techniques that can be used to com—
pare differences in gene expression between classes, includ—
ing global differences in gene expression between sample
classes (adjusted for tissue heterogeneity), differences in
cell type frequency between sample classes and differences
in gene expression between sample classes at the level of
individual cell types. These metrics improve on standard
approaches for the detection of differentially expressed

genes (e.g. SAM) as well as more recently described
approaches that attempt to incorporate computational
microdissection (csSAM).

We note that deconvolution of gene expression data from
RNAseq experiments is now an area of active research
(Gong and Szustakowski, 2013). We note that although
MMAD cannot be used directly for the analysis of RNAseq
data, the approach that we have outlined in MMAD can easily
be adapted for use in RNAseq experiments and other quantita—
tive sequencing datasets by incorporating the appropriate statis—
tical models. This would be a natural extension of our current
work.

We believe the ﬂexibility provided by MMAD will be key to
allowing tissue deconvolution to be adopted more generally in
microarray studies. Of particular interest will be the application
of deconvolution to tumor samples with the potential to investi—
gate biologically signiﬁcant changes in both tumor and stroma.
This concept has been strongly driven by findings that gene
expression in tumor associated fibroblasts affects tumor growth
in epithelial cells (Trimboli et al., 2009). Because MMAD has the
potential to derive the characteristic gene expression of a speciﬁc
cell type in the microenvironment of a tumor, or other tissue, we
propose that it will now be possible to more rigorously evaluate
speciﬁc contributions of the microenvironment to disease devel—
opment in mixed tissue samples, including the evaluation of
changes in gene expression in stromal cells, such as ﬁbroblasts
or macrophages.

Funding: Ruth L. Kirschstein T32 Institutional National
Research Service Award (NRSA) (to D.A.L.) through the
Department of Health and Human Services (5T32CA009338—
33 and 5T32CA009338—34) and by NIH grant (5R01CA141090
to K.H. and J.D.P.).

Conflict of Interest: none declared.

REFERENCES

Abbas,A.R. et al. (2009) Deconvolution of blood microarray data identiﬁes cellular
activation patterns in systemic lupus erythematosus. PMS One, 4, e6098.

Ahn,J. et al. (2013) Demix: deconvolution for mixed cancer transcriptomes using
raw measured data. Bioinformatics, 29, 186571871.

Alizadeh,A.A. et al. (2000) Distinct types of diffuse large B—cell lymphoma identiﬁed
by gene expression proﬁling. Nature, 403, 5037511.

Beer,D.G. et al. (2002) gene—expression proﬁles predict survival of patients with lung
adenocarcinoma. Nat. Med, 8, 81(r824.

Belbin,T.J. et al. (2002) Molecular classiﬁcation of head and neck squamous cell
carcinoma using cDNA microarrays. Cancer Res, 62, 11844190.

Bittner,M. et al. (2000) Molecular classiﬁcation of cutaneous malignant melanoma
by gene expression proﬁling. Nature, 406, 5367540.

Bolen,C.R. et al. (2011) Cell subset prediction for blood genomic studies. BMC
Bioinformatics, 12, 258.

Bolsmd,B.M. et al. (2003) A comparison of normalization methods for high density
oligonucleotide array data based on variance and bias. Bioiiy’ormaties, 19,
1857193.

Chiogna,M. et al. (2009) A comparison on effects of normalisations in the detection
of differentially expressed genes. BMC Bioiiy’ormaties, 10, 61.

Cleator,S.J. et al. (2006) The effect of the stromal component of breast tumours on
prediction of clinical outcome using gene expression microarray analysis. Breast
Cancer Res., 8, r32.

Debey,S. et al. (2004) Comparison of different isolation techniques prior gene ex—
pression proﬁling of blood derived cells: impact on physiological responses, on

 

ﬁle'spzumofpmjxo'soptzuuqutotq/ﬁdnq

MMAD

 

overall expression and the role of different cell types. Pharmacogenomics J., 4,
1937207.

Dhanasekaran,S.M. et al. (2001) Delineation of prognostic biomarkers in prostate
cancer. Nature, 412, 8227826.

Elloumi,F. et al. (2011) Systematic bias in genomic classiﬁcation due to contaminat—
ing non—neoplastic tissue in breast tumor samples. BM C Med. Genomics, 4, 54.

Erkkila,T. et al. (2010) Probabilistic analysis of gene expression measurements from
heterogeneous tissues. Bioinformatics, 26, 257172577.

Feezor,R.J. et al. (2004) Whole blood and leukocyte rna isolation for gene expres—
sion analyses. Physiol. Genomics, 19, 2477254.

Gaujoux,R. and Seoighe,C. (2012) Semi—supervised nonnegative matrix factoriza—
tion for gene expression deconvolution: a case study. Infect. Genet. Evol., 12,
9137921.

Gaujoux,R. and Seoighe,C. (2013) Cellmix: a comprehensive toolbox for gene
expression deconvolution. Bioinformatics, 29, 221172212.

Gong,T. et al. (2011) Optimal deconvolution of transcriptional proﬁling data using
quadratic programming with application to complex clinical blood samples.
PLoS One, 6, e27156.

Gong,T. and Szustakowski,].D. (2013) Deconrnaseq: a statistical framework for
deconvolution of heterogeneous tissue samples based on mrna—seq data.
Bioinﬁ)rmatics, 29, 108371085.

Hubbell,E. et al. (2002) Robust estimators for expression analysis. Bioinformatics,
18, 158571592.

Hurvich,C.M. and Tsai,C.L. (1989) Regression and time series model selection in
small samples. Biometrika, 76, 2977307.

Lahdesmaki,H. et al. (2005) In silico microdissection of microarray data from het—
erogeneous cell populations. BMC Bioinﬁ)rmatics, 6, 54.

Lu,P. et al. (2003) Expression deconvolution: a reinterpretation of DNA microarray
data reveals dynamic changes in cell populations. Proc. Natl Acad. Sci. USA,
100, 10370710375.

Meyniel,J.P. et al. (2010) A genomic and transcriptomic approach for a differential
diagnosis between primary and secondary ovarian carcinomas in patients with a
previous history of breast cancer. BMC Cancer, 10, 222.

Perou,C.M. et al. (2000) Molecular portraits of human breast tumours. Nature, 406,
7477752.

Repsilber,D. et al. (2010) Biomarker discovery in heterogeneous tissue samples —
taking the in—silico deconfounding approach. BMC Bioinformatics, ll, 27.
Shen—Orr,S.S. et al. (2010) Cell type—speciﬁc gene expression differences in complex

tissues. Nat. Methods, 7, 2877289.

Sorlie,T. et al. (2001) Gene expression patterns of breast carcinomas distinguish
tumor subclasses with clinical implications. Proc. Natl Acad. Sci. USA, 98,
10869710874.

Stratford,J.K. et al. (2010) A six—gene signature predicts survival of patients with
localized pancreatic ductal adenocarcinoma. PLoS Med, 7, e1000307.

Stuart,R.O. et al. (2004) In silico dissection of cell—type—associated patterns of gene
expression in prostate cancer. Proc. Natl Acad. Sci. USA, 101, 615%20.

Su,A.I. et al. (2004) A gene atlas of the mouse and human protein—encoding tran—
scriptomes. Proc. Natl Acad. Sci. USA, 101, 6062$067.

Taslaman,L. and Nilsson,B. (2012) A framework for regularized non—negative
matrix factorization, with application to the analysis of gene expression data.
PLoS One, 7, e46331.

Trimboli,A.J. et al. (2009) Pten in stromal ﬁbroblasts suppresses mammary epithe—
lial tumours. Nature, 461, 108¢1091.

Tusher,V.G. et al. (2001) Signiﬁcance analysis of microarrays applied to the ionizing
radiation response. Proc. Natl Acad Sci. USA, 98, 51 1&5121.

van ‘t Veer,L.J. et al. (2002) Gene expression proﬁling predicts clinical outcome of
breast cancer. Nature, 415, 53(k536.

Venet,D. et al. (2001) Separation of samples into their constituents using gene
expression data. Bioinformatics, 17 (suppl. 1), 527%5287.

Wang,M. et al. (2006) Computational expression deconvolution in a complex mam—
malian organ. BM C Bioinformatics, 7, 328.

Zhong,Y. and Liu,Z. (2012) Gene expression deconvolution in linear space. Nat.
Methods, 9, 879.

Zhong,Y. et al. (2013) Digital sorting of complex tissues for cell type—speciﬁc gene
expression proﬁles. BMC Bioinformatics, 14, 89.

 

689

ﬁle'spzumofpmjxo'soptzuuqutotq/ﬁdnq

