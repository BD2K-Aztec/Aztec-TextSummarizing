Vol. 29 ISMB/ECCB 2013, pages i274—i282
doi:10. 1 093/bioinformatics/btt225

 

Automated target segmentation and real space fast alignment
methods for high-throughput classification and averaging
of crowded cryo-electron subtomograms

Min Xu and Frank Alber*

Molecular and Computational Biology, Dependent of Biological Sciences, University of Southern California, 1050 Childs

Way, Los Angeles, CA 90089, USA

 

ABSTRACT

Motivation: Cryo-electron tomography allows the imaging of macro-
molecular complexes in near living conditions. To enhance the nominal
resolution of a structure it is necessary to align and average individual
subtomograms each containing identical complexes. However, if the
sample of complexes is heterogeneous, it is necessary to first classify
subtomograms into groups of identical complexes. This task becomes
challenging when tomograms contain mixtures of unknown com-
plexes extracted from a crowded environment. Two main challenges
must be overcomed: First, classification of subtomograms must be
performed without knowledge of template structures. However,
most alignment methods are too slow to perform reference-free clas-
sification of a large number of (e.g. tens of thousands) of subtomo-
grams. Second, subtomograms extracted from crowded cellular
environments, contain often fragments of other structures besides
the target complex. However, alignment methods generally assume
that each subtomogram only contains one complex. Automatic meth-
ods are needed to identify the target complexes in a subtomogram
even when its shape is unknown.

Results: In this article, we propose an automatic and systematic
method for the isolation and masking of target complexes in subto-
mograms extracted from crowded environments. Moreover, we also
propose a fast alignment method using fast rotational matching in real
space. Our experiments show that, compared with our previously
proposed fast alignment method in reciprocal space, our new
method significantly improves the alignment accuracy for highly dis-
torted and especially crowded subtomograms. Such improvements
are important for achieving successful and unbiased high-throughput
reference-free structural classification of complexes inside whole-cell
tomograms.

Contact: alber@usc.edu

Supplementary information: Supplementary data are available at
Bioinformatics online.

1 INTRODUCTION

Cryo-electron tomography enables the 3D imaging of macromol-
ecular complexes at nanometer-scale resolution in near native
conditions (Best et al., 2007; Lucic et al., 2005; Medalia et al.,
2002). Tomograms of individual cells are essentially 3D represen-
tations of the entire proteome providing a snapshot of the dis-
tributions of protein complexes (Beck et al., 2011). However,
comprehensive detection of individual complexes in cell tomo-
grams is challenging because of the inherent low signal-to-noise

 

*To whom correspondence should be addressed.

ratio (SNR), missing data, nonisotropic resolution and the fact
that individual macromolecules are difﬁcult to recognize in a
highly crowded environment (Beck et al., 2009; Best et al., 2007;
Bohm et al., 2000; Frangakis et al., 2002; Medalia et al., 2002;
Nickell et al., 2006).

Most methods for detecting complexes in cell tomograms rely
on a template structure, which serves as a reference in searching
for a similar pattern in the tomogram (e.g. Beck et al., 2009).
However, for an unbiased detection and classiﬁcation of all the
different complexes in a cellular tomogram, template-free meth-
ods are needed 0(u et al., 2011). Such an analysis is challenging
and relies on three main steps: First, the locations of potential
complexes are detected by using particle-picking methods and a
subregion surrounding the potential complex is extracted (i.e. the
subtomogram). Second, the subtomo gram regions corresponding
only to the target complex must be detected, which allows mask-
ing out all background regions, which in turn contain noise and
in case of crowded subtomograms also fragments of surrounding
structures. Third, reference-free structural classiﬁcation of the
masked subtomograms is performed, which is typically based
on an iterative process of subtomogram alignments, classiﬁca-
tions and averaging (e.g. Amat et al., 2010; Bartesaghi et al.,
2008; Chen et al., 2013; Forster et al., 2008; Volkmann, 2010;
Xu et al., 2012). Finally, the averaging of aligned subtomograms
of the same complexes will enhance the nominal resolution of the
resulting density maps.

In this article, we address two main challenges in reference-free
subtomogram classiﬁcations. First, we propose an automatic
method for adaptive masking of target regions in crowded sub-
tomograms without the knowledge of the shape of the complex.
Such a method is particularly important for subtomograms ex-
tracted from crowded environments, such as the cell cytoplasm.
In such a case, subtomograms will also contain fragmental re-
gions of other complexes owing to the high particle density in the
tomogram. Masking out these regions is of great importance in
the subsequent classiﬁcation process. Unlike automatic masking
methods based on voxel weighting 0(u et al., 2012) or dimension
reduction methods such as Principle Component Analysis
(Heumann et al., 2011), our method is highly scalable because
it is independent of the classiﬁcation process and does not in-
volve iterative processing of a large number of subtomograms.
Second, we propose a new method for fast rotational matching
of subtomograms in real space. The 3D subtomogram alignment
is computationally the most intensive step in the classiﬁcation
process. Currently, most alignment methods are based on max-
imizing the overlap similarity of two subtomograms through
exhaustive search over all rigid transforms (rotation and

 

© The Author 2013. Published by Oxford University Press.

This is an Open Access article distributed under the terms of the Creative Commons Attribution Non—Commercial License (http://creativecommons.org/licenses/
by—nc/3.0/), which permits non—commercial re—use, distribution, and reproduction in any medium, provided the original work is properly cited. For commercial

re—use, please contact journals.permissions@oup.com

112 /310'slvu1nofp103xo"sorJBurJOJurorq/ﬁduq 11101} pQPBOIHAAOG

9103 ‘Og isnﬁnv uo ::

Crowded subtomogram segmentation and alignment

 

translation) of one subtomogram with respect to the other (e.g.
Amat et al., 2010; Forster et al., 2008). Such methods scan ex-
haustively through each rotational angle, and ﬁnd the best cor-
responding translation using Fast Fourier Transform (FFT) (e. g.
Amat et al., 2010; Forster et al., 2008). These methods are com-
putationally intensive, which limits their applicability in refer-
ence-free classiﬁcations. To increase alignment accuracy, local
search methods have been developed to refine initial alignments
(e.g. Bartesaghi et al., 2008; Hrabe et al., 2012; Xu and Alber,
2012). To increase computational efﬁciencies, two approximate
alignment methods have been developed, which separate the
translational from the rotational subtomogram alignments
(Bartesaghi et al., 2008; Xu et al., 2012). These methods are
based on similarity scores deﬁned in the reciprocal space (i.e.
Fourier space). To separate translational and rotational search,
these methods use an approximate score that introduces transla-
tional invariance by eliminating the phase information of the
complex coefﬁcients in the reciprocal space and use only the
magnitude of the Fourier coefﬁcients (Bartesaghi et al., 2008;
Xu et al., 2012). By expressing the structural information in
Spherical Harmonics (SH) Expansion, it is possible to formulate
the rotational alignment as a fast rotational matching, which
simultaneously calculates alignment scores of all rotations
using FFT. This procedure signiﬁcantly increases the alignment
speed. For example, our previously published method 0(u et al.,
2012) achieved between hundreds to thousands fold speedup (de-
pending on subtomograms size and rotational angle interval)
compared with the standard scanning-based alignment method
(Forster et al., 2008) by using a translational invariance approxi-
mation of a similarity score equivalent to a popular score pro-
posed by (Forster et al., 2008).

However, formulating the fast rotational matching in recipro-
cal space has some limitations. In reciprocal space, the majority of
informative signals of a complex is usually contained in a rela-
tively small amount of high magnitude Fourier coefficients (Amat
et al., 2010). These coefﬁcients are often occupying relatively few
voxels in the reciprocal space located within a small region cen-
tered at the origin. Therefore, the SH expansion in the fast rota-
tional matching may be hampered by interpolation errors, which
reduces the accuracy in the alignment process. In contrast, in real
space, the signal covers a wider area within a subtomogram, and
the SH expansion is expected to be more accurate. It is therefore
beneﬁcial to formulate fast rotational matching in real space.
In addition, real space fast rotational matching uses the full
constrained alignment score instead of a translation invariant
approximation when the method is expressed in reciprocal space
(Bartesaghi et al., 2008; Xu et al., 2012).

Here, we devise an improved alignment method, which formu-
lates the fast rotational matching of subtomograms in real space.
To achieve this goal, we ﬁrst identify a keypoint in the target
complex whose relative location is invariant to rigid transform-
ations and serves as the center of rotation in the fast rotational
matching of the two subtomograms. A natural choice is the
center of mass of a complex. However, detection of the center
of mass is not trivial and cannot be approximated by the geo-
metrical or mass density center of the subtomogram. The reason
for this complication is that tomograms are images of the
crowded cellular environment (Beck et al., 2009), and a subto-
mogram contains not necessarily mass density of only one single

complex. When a potential complex is detected and its subtomo-
gram extracted as a rectangular cube then this subtomogram
typically contains also fragments of other surrounding structures
that occupy parts of the subtomogram. Then, the center of mass
estimation and subtomogram alignment are affected by the ex-
istence of the additional mass density in the subtomogram. It is
necessary to focus only on the regions that contain the actual
target complex. Even when a subtomogram does not contain any
surrounding structures, its mean intensity is often close to back-
ground intensity owing to the suppression of low frequency
signal owing to the Contrast Transfer Function (CTF) effect,
which also makes the estimation of the center of mass of the
complex inaccurate.

Applying our automatic target complex segmentation method,
it is possible to estimate a center of mass based only on the target
complex regions in the subtomogram (i.e. the constrained center
of mass). Once the constrained center of mass is detected, we
design a fast subtomogram alignment method that uses real
space signals and takes into account missing wedge corrections
using reciprocal space signals. Moreover, the alignment focuses
exclusively on the target complex regions in each subtomogram,
which signiﬁcantly decreases the inﬂuence of background noise
and surrounding structures to the alignment process.

Our experiments show that our new approach signiﬁcantly
increases the alignment accuracy compared with our previous
proposed fast alignment method 0(u et al., 2012) for highly dis-
torted subtomograms. Most importantly, the new method is
highly robust to the inﬂuence of surrounding structures inside
crowded subtomograms.

2 METHODS

This section begins by describing the automatic segmentation of the target
complex and then focuses on the fast rotational alignment in real space.

2.1 Automatic segmentation of the target complex in a
subtomogram

The automatic target complex segmentation method consists of several
steps (Figs 1, 2 and 7): (i) automatic scale selection is performed to max-
imally enhance the detection of structural boundaries in a subtomogram;

Automatic Scale Selection
Segment Detection

Model Based Clustering
Segment Grouping

Target Complex Region
Constrained Center of Mass

       

   
  
   

Target Complex
neglon Detection

Feature
Extraction

Real Space Fast Rotation
Alignment

Translation Alignment

Fig. 1. Flow chart for segmentation of target complex regions and the
real space alignment of subtomogram using only target complex regions

Palrwlse

a
e
I:
E
e

.9

E

 

 

 

i275

112 /310'sleu1nofp103xo"soiJBuiJOJuioiq/ﬁduq 11101} papeorumoq

9103 ‘Og isnﬁnv uo ::

M.Xu and F.Alber

 

 

A B C D E F G

Fig. 2. Four typical examples for target complex segmentation based on
simulated data. Each row is an example, whereas each subﬁgure is a slice
through the x-z plane in the 3D image. (A) Ground truth. (B) Simulated
subtomograms at SNR 0.005 and tilt angle range :l:50c (Section 3.1). (C)
After Gaussian smoothing with automatic scale selection. (D) After
Watershed segmentation. (E) After boundary segment detection. (F)
Selected segment cluster from model based clustering. (G) Detected
target complex regions

 

Fig. 3. A subtomogram’s image features. The boundary feature is a sur-
face that has strong negative intensity (yellow arrow). A local maxima in
Smax_stmcmml_boundary is highlighted by a red cross, which is inside the
macromolecular complex. Its corresponding structural boundary segment
is highlighted by a red circle. A local maxima in Smax_backgmund_boundary is
highlighted by a green cross, which is inside a background region. Its
corresponding background boundary segment is highlighted by green
circle. See Section 2.1.2 for the details of these two types of local maxima

(ii) segments are deﬁned that describe the boundaries between structural
elements; and (iii) a classiﬁcation of the detected structural segments into
candidate regions is performed by using a statistical model based
clustering.

2.1.] Automatic scale selection for optimal smoothing and bound-
ary enhancement In this article, we assume that in a subtomogram
high image intensity corresponds to high electron density. When a sub-
tomogram is renorrnalized so that its mean intensity is zero, the boundary
of a complex tends to have a negative intensity surface (Fig. 3, yellow
arrow). This property is due to the CTF effects in the electron tomog-
raphy imaging process, which suppresses low frequency signals. We use
this negative intensity surface as a main characteristic when identifying
the segments at the boundary of structural elements, such as the target
complex and those structures captured at the outer regions of the sub-
tomogram. To reduce the inﬂuence of noise, smoothing of the subtmo-
grams is needed. However, too much smoothing will weaken the negative
intensity boundary. To ﬁnd the optimal degree of smoothing, we use the
scale-space representation method and propose an automatic scale selec-
tion method to ﬁnd the optimal degree of smoothing that maximally
enhances the boundary surface while minimizing the noise. Scale-space
(Witkin, 1983) is a framework for multi-scale signal representation. An
image is represented as a one-parameter family of smoothed images, the
scale-space representation, parameterized by the size of the Gaussian
smoothing kernel (Lindeberg, 1994):

*XTX

e12—

 

ga (X) i: 3
(21102)2

Given a subtomogram, f, a Gaussian smoothing can be expressed as the
convolution between f and ga:

f-a :=f*ga

In the smoothed subtomogramfa, all features with a size smaller than a
are ﬁltered out, whereas others are preserved. Our objective is to deter-
mine the optimal scale a to enhance the formation of a negative intensity
surface while minimizing the inﬂuence of noise. To do so, we scan a range
of feasible 0 values. For a given smoothed subtomogram with scale a, we
ﬁnd all local minima with negative intensities in fa and denote this set as
Smin. We then deﬁne a local surface score for each minima in Smin, to
identify those minima that are likely part of a negative intensity surface.
The surface score is calculated as follows: we calculate the Hessian matrix
H(x), whose elements are second-order derivatives of fa evaluated at
x e [R3,
H,-,-(xk) =  Mk, Vk e smin, 1,}: 1,2,3

where xk is the corresponding location of a voxel k.

For any k e Smin, let 14,10, )4 be the ordered eigenvalues of H(xk)
such that ml 3 |y2| 3 ha |. Then, we can construct a local surface
score sfa(xk) similar to (Martinez-Sanchez et al., 2011) as follows:

_ _ Ital—m ify1>0,
wk) — {0 “<0

We ﬁnd the a value that maximally enhances the surface scores of all the
minima so that the most negative minima tends to have a strong surface
score. To do so, we calculate an accumulative surface score from all the
minima. First, the minima are ordered in ascending order in fa such that

few.) sigma :  sfxxzcmmaw

where k1, . . . ,k15mm1 e Smin. Then the accumulative surface score s?“ is
deﬁned as

a“: = 2%»
j:1

Because {fa(xki)} is in ascending order with respect to i, this score .5?“
forms a monotonically increasing function of face“). We can measure the
Area Under Curve, AUCa, using {.s?““} and {fa(xki)}. AUCa tends to be
large when the most negative minima have large surface scores. To meas-
ure how much the AUC reﬂects true surface signals rather than random
noise, we also randomly perrnutate all voxels in f and repeat the afore-
mentioned procedure to calculate a perrnutated AUC, AU cge’m.

To determine the optimal Gaussian ﬁltering value a, we scan through a
range of different as to ﬁnd the 0* value that maximizes

AUCa
AUCgerm

For simplicity, in the following sections, we denote f :=ﬁ,~ (Figs 2C
and 7B) and also denote f,- :=f(x,—) for any voxel i.

2.1.2 Detecting structural, boundary and background segments
in the subtomogram After identifying the optimal scale 0*, we now
determine those local minima that have strong surface scores and are
likely to separate different structural elements (i.e. the target complex
and surrounding structures). We deﬁne them as those local minima
with both high surface scores and low intensity values. To do so, ﬁrst
we select the minima whose intensity is signiﬁcantly smaller than the
average intensity, i.e.

Smin_intcnsity =  E  :
fk < medianiesmin (ff)

_ Cmin_intcnsity_factor madiESmin 

 

i276

112 /810's112um0[p101x0"soiJBMJOJuioiq//:d11q 11101} pap201umoq

9103 ‘0g isanV uo ::

Crowded subtomogram segmentation and alignment

 

where cmimmmsityiactor is a constant parameter to control the signiﬁcance
level, and mad is the Median Absolute Deviation, which is a robust
measure of variability.

In addition, we also collect those minima whose surface score is
signiﬁcantly larger than the average scores of all minima, i.e.

Sminjurfacc  E  I
sf (xk) > median-ESmin (sf (x0)

+ Cminjurfaccjactor madiESmin (Sf 

where ijn_5urfacc_factor is a constant parameter.
All minima with strong surface scores are deﬁned as the intersection of
both groups.

Smin_boundary :2 Smin_intcnsity ﬂ Smin_surfacx:

We denote these minima as the boundary surface minim_a.

We then determine all local intensity maxima Smax inf, which are likely
to be inside structural elements. We ﬁrst perform Watershed segrnenta-
tion (Beucher and Lantuéjoul, 1979; Volkmann, 2002) using Smax as seeds
(Figs 2D and 7C). Each segment corresponds to one local maximum, and
therefore the terms local maximum and segment are used interchange-
ably. We then select all the segments that border with local minima
deﬁned in Smmboundary and denote the corresponding set of maxima as
SmaLboundary. The actual separations between structural elements and
background regions are always at the boundary between segments in
SmaLboundary. The segments in SmaLboundary can be divided into two
types: a structural boundary segment is located in the target complex or
the surrounding structures (Fig. 3, inside red circle), and it contains a
maximum with high intensity value (Fig. 3, highlighted by red cross); a
background boundary segment is located in the regions that do not contain
structural elements (Fig. 3, inside green circle), and which contain a max-
imum with low intensity value (Fig. 3, highlighted by green cross).

To separate these two types of boundary segments, we perform
k-means clustering on Smaxiboundary (with cluster number = 2), resulting
in the two groups SmathructuraLboundary and Smax_background_boundary-
Smax_stmcmml_boundary are segments containing local maxima with higher
intensity values and are deﬁned as structural boundary segments (Figs 2E
and 7D), whereas Smax_backgmund_boundary are deﬁned as background
boundary segments.

After focusing on boundary segments (i.e. those that border with sur-
face minima), we now characterize the remaining segments as either part
of structural elements or background regions. To do this, we ﬁrst deter-
mine a cutoff intensity value CmaximaJutoff as the largest intensity value in
all the background boundary segments Smax_backgmund_boundary. All remain-
ing segments that contain a local maxima with an intensity value smaller
that cmaximuutoff are assigned as background regions.

Finally, the remaining segments whose maxima have intensity values
larger than Cmaxima_cutoff are deﬁned as structural segments and are there-
fore assumed to be either part of the target complex or other structural
elements:  Smax_structural :2  E Smax :fi>cmaxima_cutoff}-

2.1.3 Combining structural segments into complexes using model
based clustering We now cluster structural segments in SmaLstrmmml
according to the intensity values and location of their local maxima so
that each cluster of segments will approximately correspond to one con-
secutive structural region. We choose a model-based clustering approach
because it allows an automatic determination of the optimal set of clus-
ters. To perform the clustering, we assume that the location and intensity
of local maxima from clusters follows a probabilistic mixture model,
where each component probability distribution corresponds to a cluster
(Fraley and Raftery, 2002). We model the probability of independently
observing both location and intensity of a local maxima i e SmaLstmctml
from a cluster k as:

Pik =13], ¢(Xi;ﬂk,2k) (1)

where pfi is a probability proportional to the intensity if, and CI) is a
probability density function in the form of a multivariate normal distri-
bution with mean uk and covariance 2k. For simpliﬁcation, we assume
that the clusters are spherical with different sizes, i.e. 22k 2 MI. The main
difference between our model and the standard model-based clustering
(Fraley and Raftery, 2002) is the inclusion of the image intensity related
term pfi in Equation (1). Our simulation experiments show that the
inclusion of image intensity improves the clustering performance
(Supplementary Document).
The likelihood for the mixture model with K clusters is:

,MK;}»1,---J~K|X)

K
= H E TkPik

iESmaX_strucIural [€21

£(ri,...,rK;m,...

where x represents the collection of observed local maxima, and I}, is the
probability of cluster k (i.e. cluster mixing probability). A model-based
clustering determines the parameters {1k}, {uk}, {Ak} that maximizes [3.
We use a scale-space representation to estimate cluster centers {uk}.
Given a scale a 3 20*, we obtain the set Sum“ of local maxima with
positive intensities in fa. The local maximajl, . . . , 1'15 7W1 are ordered with
decreasing intensity values, i.e. ﬂoral-l) 3  3 id ijmymaﬂ) >0, where
an-k is the corresponding location of local maxima jk on fa. We choose
cluster centers as the first K local maxima, i.e uk 2 an-k, Vk = 1, . . . , K
Similar to the standard model based clustering (Celeux and Govaert,
1995; Fraley and Raftery, 2002), an Expectation Maximization algorithm
is used to estimate {1k} and {M}. The expectation maximization is deﬁned
by two iterative steps:
E-step: update an estimated posterior probability 2,-k that the local
maximum i belongs to cluster k:
TkPik
K

Z 7113:]

,:1

21k (—

M-step: update the cluster mixing probability 1),, and variances Ak, given
the new parameters in the previous step:

"k

K

 

Tk(—

where

iESmax_slructural
and
tr(Wk)
371k

 

Ak(—

where

3:7: (Xi - MkXXi — MDT

Wk = Z

iESmax_slructural
The Expectation Maximization algorithm iterates until there is no signiﬁ-
cant change in the likelihood [3. The clustering of local maxima leads to
clusters of the corresponding segments (Figs 2F and 7E). Using statistical
modeling for clustering enables the determination of an optimal set of
clusters through model selection. By varying the scale a and cluster
number K, we obtain the optimal values for scale and cluster set using
the Bayesian Information Criterion (Fraley and Raftery, 2002):

BIC = 2 log ﬂ — Klog lSmathruCturall

The ﬁnal target complex is then represented by combining multiple seg-
ments that fulﬁll the following criteria: (i) they belong to same cluster
in the model based clustering; (ii) they are in consecutive contact to each
other; and (iii) the maximum intensity values  of the voxels between

 

i277

112 /310's112u1n0[p101x0"soiJBuiJOJuioiq/ﬁduq 11101} pap201umoq

9103 ‘0g isanV uo ::

M.Xu and F.Alber

 

two consecutive segments i and j is larger than a threshold. The thresh-
OId is comp uted as C bound ary_cutoff _f actor Stdi,jESmax_struciuml  ’ Where
cboundaryjumfmacmr is a constant parameter.

The target complex region is then selected as the combined segments
that contain at least one structural boundary segment (deﬁned by
Smax_stmcmml_boundary) and are located closest to the center of the subto-
mogram. To prevent that small features of the target complex are
excluded, a dilation operation is performed to deﬁne the target complex
region A (Figs 2G and 7F).

2.2 Real space fast subtomogram alignment using the
target complex region and its center of mass

Fast rotational matching in real space relies on an initial alignment of the
center of masses of the two subtomograms. Therefore, we describe ﬁrst
how the center of mass of each target complex is calculated before we
describe the fast rotational matching approach.

2.2.] Calculation of center of mass for target complex region The
determination of the center of mass in subtomograms is not trivial, pri-
marily owing to high noise levels, the suppression of low frequency signals
in the reciprocal space and the existence of surrounding structures inside a
subtomogram.

Here, the center of mass is calculated only based on the regions in the
target complex A. We set a thresholded region Athrcsholdcd on the ﬁltered
SUbtomogram 1;, i-e- Athrcsholdcd = {X E A iﬂx)>meall(/;) + 0.55td(f)}.
Then, we use Athmholdcd to calculate the center of mass. We deﬁne another
intensity function

ﬁm(x) =  _ minyEAthrcsholad ﬂy) ifx E Athrcsholcd,
0 1f x¢Athrcsholcd -

We then calculate the constrained center of mass ccm of fem.

2.2.2 Fast rotation alignment We represent two subtomograms f
and g as two integrable functions f, g : [R3 —> ER. They have been trans-
formed such that (i) their mean intensities are adjusted to zero, (ii) the
voxel intensities outside the target complex region A is set to zero, and
(iii) they are translated according to cGem so that their constrained centers
of mass are aligned. The constrained center of mass is used as rotational
centers in our fast rotational alignment. To correct for the missing wedge
distortions, we only keep the Fourier coefﬁcients within the overlap of
nonmissing wedge regions of both subtomograms. Following Bartesaghi
et al. (2008), F6rster et al. (2008) and Xu et al. (2012), we use a binary
missing wedge mask function as M : [R3 —> {0,1}, which deﬁnes valid
and missing Fourier coefﬁcients in reciprocal space. For example, with
a tilt angle range :l:6, the missing wedge mask function can be deﬁned as
M(§) := |](153151511m(9»(§), where I] is the indicator function. Given M, the
real space subtomogram that excludes any coefﬁcients inside of any of the
two missing wedge regions is deﬁned as,

r = Elt[f’1(Mfff)]

g = Silf’1(Mgfg)l

where ER denotes the real part of a complex function; .7: is the Fourier
transform operator; and M] and Mg are missing wedge masks for f and
g, respectively.

Given a 3D rotation R, we can calculate a correlation



pR(fa g) = f
,/f|ff|2 ARMngMf AlegP

where A R is the rotation operator such that (A Re)(x) := e[R’1(x)] for
any function e: [R3 —> C, and R e R3“ is the rotation matrix corres-
ponding to 3D rotation R. As in Xu et al. (2012), the correlation measure
m; in Equation (2) is equivalent (up to a constant factor.) to a popular

(2)

constrained correlation score with missing wedge correction (Férster
et al., 2008).

The fast rotational alignment is based on sampling of m; simultan-
eously over all rotations R. To do so, we apply a fast 3D volumetric
rotational matching (Kovacs and Wriggers, 2002; Xu et al., 2012). It
can be seen that Equation (2) can be formulated as being composed of
three rotational correlation functions of the form KR := fp A—Rq, where
p and q are component functions; E denotes the complex conjugate (when
e is a real valued function, the complex conjugate E = e.) of a function e.
Speciﬁcally, we can represent m; as

K33)

pi; = —
Jan/K33)

fpo ARqO

‘lfpl Aqu 1/fl72 [\qu

where 170:: f, (10:: g, [71 := |.7-'f12, q1 := M2,
£12 := lfglz-

When represented in spherical coordinates, the p and (1 components of
these three functions KR can be approximated by an SH expansion.
Following Garzén et al. (2007), Kovacs and Wriggers (2002) and Xu
et al., (2012), the p and (1 components in Equation (3) can be expressed as:

(3)

p2 := M}, and

B71 l
mm a Z X) 652.0) Yaw, A)

[:0 m:7l
B71 l

(An/M) a Z Z Gianna/8.x)
[:0 m:7l

where B is the bandwidth, and C ,m(r) are the coefficients associated with
the complex-valued spherical harmonic function Y,m(,8, A) with degree I
and order m, where r, ,8 and A are the radial distance, co-latitude and
longitude, respectively, which deﬁne the position in spherical coordinate.

When a suitable parameterization of the 3D rotational group is
achieved, the rotational correlation function KR := fp TM of all
sampled rotations R can be represented as an inverse FFT of a 3D
array of the sum of integrals as follows (Garzén et al., 2007; Kovacs
and Wriggers, 2002; Xu et al., 2012):

KR = rim, [2 dim,de / Cfm(r)Cj’M(r)r2dr:|
l

where Dink are real coefﬁcients deﬁning the elements of the Wigner small
d-matrix evaluated at 90°.

As a consequence of the aforementioned formulation, the cross-correl-
ation functions can be efﬁciently sampled by using FFT simultaneously
over all sampled rotations (Kovacs and Wriggers, 2002; Xu et al., 2012).
The sampling is given as twice the bandwidth B used in the SH trans-
formations. Therefore, pR can be efﬁciently computed over all sampled
rotations R. Similar to Bartesaghi et al. (2008) and Xu et al. (2012),
the set of candidate rotations are then obtained by identifying the
local maxima of p with respect to the rotational degrees of freedom R.
To obtain the optimal translation, a fast translational search is per-
formed for each candidate rotation over the full correlation function
m; by using FFT. Finally, the best combination of rotation and transla-
tion is chosen.

3 RESULTS

We assess the performance of our method by using simulated
subtomograms of a phantom model. In addition, we test our
method by experimentally determined structures of ﬁve com-
plexes as well as experimental ribosome subtomograms extracted
from a whole-cell tomogram.

 

i278

112 /310's112u1n0[p101x0"soiJBuiJOJuioiq/ﬁduq 11101} pap201umoq

9103 ‘0g isanV uo ::

Crowded subtomogram segmentation and alignment

 

3.1 Generation of simulated tomograms from phantom
and experimental structures

We follow a previously applied methodology for generating sub-
tomograms from initial structures by simulating the tomographic
imaging process as realistically as possible, allowing for the in-
clusion of noise, tomographic distortions due to missing wedge
and electron optical factors such as CTF and Modulation
Transfer Function (MTF) (Beck et al., 2009; Férster et al.,
2008; Nickell et al., 2005; Xu and Alber, 2012; Xu et al., 2011,
2012).

A density map of the complexes (Fig. 4) are generated by
applying a low pass ﬁlter at 4nm resolution to the atomic struc-
tures using the PDB2VOL program of the Situs 2.0 package
(Wriggers et al., 1999) with voxel length of lnm. In addition, a
density map of a phantom model is generated (Fig. 4A). These
density maps are used as base maps, both of size 643 voxels, and
they are randomly rotated and translated to generate density
map instances in uncrowded conditions. To generate a crowded
environment, two additional structures (randomly chosen from
the phantom model or the ribosome complex) are randomly ori-
ented and placed into the density map ~32 voxels away from the
center of the map.

The density maps of the target complex and neighboring struc-
tures are used as input for simulating electron micrograph images
at different tilt angles. Our simulated subtomograms therefore
contain a wedge-shaped region in reciprocal space for which no
structure factors have been measured (i.e. the missing wedge

>

 

  
  

:50“

a
'U
0
E o
O
5 a
E
N
i a)
ﬁg?
HS
2
o 05
3%
HE
G, l—
E l
g 'b
o .\D
.o I H
«w
32

. a- -
afﬁx:

Octameric c|pp
enolase

Carboamoyl
phosphate synthase

B GroEL

    

Fig. 4. Structures used for simulating the tomographic image process.
(A) Top: a phantom model that consists of four elliptical Gaussian f unc-
tions as branches and one spherical Gaussian function to connect the
elliptical functions. Bottom: Ribosome complex (PDB ID: 2AW7,
2AWB). Left: isosurface of the two structures. Right: Slices of the cor-
responding x-z plane in the simulated tomograms with different degree of
distortions, i.e. different SNRs and tilt angle ranges. (B) The isosurfaces
of four additional benchmark complexes (Xu et al., 2012)

effect), resulting in distortions in the density map as observed
in the experimental measurements. To generate realistic micro-
graphs, noise is added to the images according to a given SNR
level (ranging between 0.05 and 0.001), defined as the ratio be-
tween the variances of the signal and noise (Férster et al., 2008)
(Fig. 4A).

The resulting image is convoluted with a CTF, which describes
the imaging in the transmission electron microscope in a linear
approximation (Frank, 2006; Nickell et al., 2005). We also con-
volute the density map with the corresponding MTF of a typical
detector used in tomography. Typical experimental acquisition
parameters (Beck et al., 2009) were used: voxel grid length = 1
nm, the spherical aberration = 2 x 10’3m, the defocus value
= —4 x 10’6m, the MTF corresponded to a realistic electron
detector (McMullan et al., 2009), defined as sinc(7'ra)/2) where
a) is the fraction of the Nyquist frequency. Finally, we use a
backprojection algorithm (Nickell et al., 2005) to generate a
tomogram from the individual 2D micrographs generated at
the various tilt angles (Beck et al., 2009; Xu et al., 2011, 2012;
Xu and Alber, 2012).

3.2 Segmentation of the target complex in simulated
subtomograms

To determine the optimal scale for surface enhancement, we vary
a from 1.0nm to 3.0nm. At high noise levels (e.g. SNR 5 0.01),
the optimal 0* is usually obtained at ~2.0nm.

For the detection of boundary segments, we set the signiﬁ-
cance levels CAmin_intensityfactor : CAmin_surfacefactor :  For deter-
mining the target complex, we choose Cboundary_cuwff_facwr = 0,
ignoring all boundary segment maxima with negative intensities
in ,7}. For combining segments, we scan a from 20* to 10 nm
and scan the cluster number K from 1 to 5.

To assess the target complex segmentation, we calculate the
overlap between the determined target complex A and the
ground truth Amwomplex. We also calculate the overlap between
A and regions occupied by the surrounding structures in the
crowded ground truth density map Asurroundingﬁmmre. Then, we
calculate the median of the following three overlap scores across
100 simulated subtomograms at each distortion level and for
each of the benchmark structures:

IA ﬂ Atrue_complex l
l Atrue_complex l

|Am1c |

true_complex

0true_positive_rate :

0false.positive_rate : I c I
true_complex

_  ﬂ Asurrounding_structurel
osurrounding_slructure — —
l Asurrounding _structure I

where A‘ denotes the complementary set of A. Our results show
that for all distortion levels, the median of omLPosmveJme is at
least 0.9, and ofaISLposmveJa‘e is at most 0.004, demonstrating a
good performance in segmenting the areas of the corresponding
target structures. In contrast, the median of osurroundingimmre is
close to zero for most of the distortion levels, indicating that our
target complex segmentation method can successfully exclude
surrounding structures in the subtomograms. Only at high dis-
tortion levels, the median of osurromdingﬂmmm starts to deviate
from zero (Supplementary Tables S77S12).

 

i279

112 /310's112u1n0[p101x0"soiJBuiJOJuioiq/ﬁduq 11101} pap201umoq

9103 ‘0g isanV uo ::

M.Xu and F.Alber

 

3.3 Assessment of constrained center of mass detection

The constrained center of mass is expected to be invariant to
rigid transforms of the corresponding structures. The assessment
of the rotational invariance of our constrained center of mass is
performed as follows. We randomly select 100 pairs of subtomo-
grams for each of the benchmark structures. For each pair of
subtomograms i and j, we calculate

dccmnnverser :: licccm_inverse,i _ ccchnverseJiiZ

as a measure of the degree of invariance, where cccmjnversw- and
CccmjnverseJ are the corresponding locations of the constrained
center of masses in the original complex that is used to generate
the instances by random rigid transforms. The smaller
dccm 41mm, ,7, the higher is the degree of invariance, indicating a
good performance.

The performance is expressed as the median of {dCCmJnVEI—SEJJ'},
which is listed in Figure 5 and Supplementary Tables S1, S4, S13
and S16. We can see that the estimation error is generally smaller
than 3, indicating high accuracy even at high distortion levels. As
can be seen in the following section, the degree of invariance is
sufﬁciently small to allow successful pairwise fast rotational
alignments in real space.

3.4 Fast rotational alignment of subtomograms

Our fast alignment method relies on fast rotational matching. In
the following two subsections, we calculate the rotational align-
ment errors for the pairs of complexes, both for the crowded as
well as uncrowded cases. The rotational alignment error is cal-
culated as follows: Suppose R* is the rotation matrix calculated
for an alignment, and Rmle is the true rotation matrix. The ro-
tation alignment error can then be measured as

drotjrr :  _ RtrueiiFs

where H - HP is Frobenius norm.

Un-crowded Crowded

Center of mass invariance

   
    

9 Center of mass invariance

 

Phantom model

i :70. T'lt an le ran e
Tilt angle range I g g

,0 Center of mass invariance
Center of mass invariance

Ribosome

 

:70 Tilt angle range 170

Tilt angle range

Fig. 5. The performance of the center of mass invariance, expressed as
the median of {dmgnvmcﬂ-j} across 100 pairwise comparisons of subto-
mograms simulated at different distortion levels. The surface region color
is rescaled hue saturation value (HSV) color and proportional to the
surface height

3.4.] Uncrowded subtomograms First, we test our alignment
method with uncrowded subtomo grams, which contain one com-
plex without surrounding structures. We compare the alignment
errors between our new alignment method presented here and
our previous method that relied on fast rotational matching in
reciprocal space 0(u et al., 2012) (left column of Fig. 6 and
Supplementary Tables S2 and S5). It is evident that our new
method improves the alignment accuracy on highly distorted
subtomograms.

3.4.2 Crowded subtomograms Next, we compare the two align-
ment methods 0(u et al., 2012) with crowded subtomograms,
which also contain fragments of additional complexes (right
column of Fig. 6 and Supplementary Tables S14 and S17). It
can be clearly seen that when considering crowded subtomo grams
without excluding surrounding structures, our previous method
0(u et al., 2012) generally fails in ﬁnding the correct alignment. By
contrast, our new alignment method aided by target complex seg-
mentation is only marginally affected by crowding and the exist-
ence of the surrounding structures. Our new method clearly
outperforms our previous method when dealing with subtomo-
grams from crowded cellular environments. Similar improvement
in performance is also observed by testing the crowded subtomo-
grams of four additional benchmark complexes (Supplementary
Tables S197S22) (Fig. 4B) used in 0(u et al., 2012).

We have also measured the correlation between dccm 41mm, ,7
and drown (Supplementary Tables S3, S6, S15 and S18) and

Un-crowded Crowded

    
 

    
 

N w

tional angle error

. Rotational angle error

Phantom model
0
E Rota
0‘s

Tilt angle range Tilt angle range

Rotational angle error

'8 Rotational angle error

Ribosome

o.
O. 5

o

Tilt angle range Tilt angle range

Fig. 6. Rotational alignment error for the phantom model and the ribo-
some complex inside uncrowded and crowded subtomograms simulated
at different distortion levels. The error is measured in terms of the median
drown across 100 pairwise alignments. The nodes on the solid black grid
correspond to the alignment performance of our new method. The nodes
in the red dashed grid correspond to the alignment performance of our
previous method (Xu et al., 2012). The green regions correspond to the
distortion levels at which both methods can successfully perform align-
ments. The yellow regions correspond to the distortion levels at which our
new method outperforms our previous method and correctly aligns the
subtomograms, whereas our previous method (Xu et al., 2012) fails. The
gray region corresponds to the distortion levels at which both methods
fail. For both alignment methods, we choose a rotation angle interval 56 ,
i.e. the bandwidth B: 36

 

i280

112 /310's1izu.mofp.ro;xo"sorJBurJOJurorq/ﬁduq 11101} papeo1umoq

9103 ‘0g isanV uo ::

Crowded subtomogram segmentation and alignment

 

tested the performance with respect to the levels of crowdedness
(Supplementary Figs S17S3). At low to median distortion levels,
we observe moderate correlation between the aforementioned
two quantities. At high distortion levels, the correlations are
small, showing that the alignment is more affected by high
levels of distortions.

3.5 Segmenting target complexes in subtomograms
extracted from experimental whole-cell tomogram
of the human pathogen Leptospira interrogans

We tested our method also on experimental subtomograms
extracted from a whole-cell tomogram of Leptospira interrogans
in undisturbed conditions (Beck et al., 2009). Segmenting of
complexes in such subtomograms is significantly more challen-
ging because the macromolecular crowding is high and because
the SNR levels and resolution of these subtomograms is typically
low. Beck et al. (2009) have identified several complexes in the
tomogram using template matching (Best et al., 2007). The tem-
plates were generated by using density maps of structures in the
Protein Databank and convoluted with CTF and MTF. As a test
case, we use two subtomograms with high template matching
scores to the ribosome template. For each of these matches, we
extracted a subtomogram of size 493 voxels that was large
enough to contain an instance of the complex and certain
amount of surrounding structure fragments.

The results shown in Figure 7 demonstrate that our method
can successfully segment the target ribosome complex while sur-
rounding structures are clearly excluded. The ribosome positions
agree with those detected in the template matching. We further
extended the study to the subtomograms corresponding to the
top 20 template matching scores. Overall, 18 of them showed
successful segmentation (Supplementary Fig. S4). We also ana-
lyzed the target complex segmentation performance with respect
to the level of crowdedness. The crowdedness of the Leptospira
interrogans subtomograms ranges from 0 to 60%. The true-posi-
tive and false-positive rates plotted in Supplementary Figure S4
shows that, in most situations, our method can correctly identify

 

Fig. 7. Segmentation of target complex regions in Leptospira interrogans
subtomograms. Each row shows the segmentation process for a ribosome
instance. Each subﬁgure in a row consists of the consecutive slices
through the y-axis of the 3D image. (A) Original extracted subtomo-
grams. (B) Images after Gaussian smoothing with automatic scale selec-
tion. (C): Images after Watershed segmentation. (D) Images after
structural boundary segment detection. (E) Images of the selected seg-
ment clusters resulting from the model-based clustering. (F) Images of the
ﬁnal segmented target complexes. Because the contrast is low, for the
detection of signiﬁcant boundary segments, we relaxed signiﬁcance level
parameters by setting Cmin_intcnsity_factor = Cmin_surfacc_factor =  When
determining the target complex region, we set cboundary_cutoff_fmor = 2

the target complex region. Only at high crowdedness level, (i.e.
>50%), our method fails to correctly identify the target complex
regions.

3.6 Analysis of computational costs

We implemented the methods in MATLAB and carried out our
tests on a computer cluster consisting of 2.3727 GHz computer
nodes. On average, the target complex detection step takes 14.8 s.
In this step, the major proportion of computation time was used
for the scale selection (8.6s on average). In practice, we can de-
termine a ﬁxed scale parameter a from a set of training subto-
mograms and directly apply it to all subtomograms. Then, on
average, only 6.2s would be used for detecting the target com-
plex. The computer memory consumption is small. Because a
subtomogram is typically small (a subtomogram of size 643 cor-
responds to at most 2M memory), our detection step uses no
more memory than 20 times the size of a single subtomogram.
The most computational intensive step in the classiﬁcation
process is the alignment. The computational cost of our new
method is essentially the same as our previous method 0(u
et al., 2012) and therefore allows high-throughput subtomogram
classiﬁcations.

4 CONCLUSION

Cryo-electron tomograms provide useful information for simul-
taneously detecting the native structures and their spatial cellular
locations of a large number of macromolecular complexes.
However, the high level of macromolecular crowding and distor-
tions in the extracted subtomograms makes such analysis
challenging. In addition, the availability of a large number of
subtomograms containing potential complexes requires high-
throughput analysis techniques. In this article, we propose an
automatic segmentation technique that isolates the target com-
plex inside a crowded subtomogram. We further detect the rigid
transform invariant center of mass of the target complex and
propose an improved fast alignment method using fast rotational
matching in real space. The new method shows good perform-
ance in segmenting target complexes in crowded subtomograms
and performing fast rotational alignments using both simulated
and experimental subtomograms. This performance is a neces-
sary condition for high-throughput structural classiﬁcations of
complexes in whole-cell tomograms. This work represents a step
toward high-throughput and reference-free Visual Proteomics
analysis of highly crowded whole-cell cryo-electron tomograms.

ACKNOWLEDGEMENTS

The authors thank Dr Martin Beck for providing the experimen-
tal tomograms for testing. They thank the anonymous reviewers
for their constructive suggestions.

Funding: Human Frontier Science Program RGY0079/2009-C,
the Arnold and Mabel Beckman foundation; NIH
[R01GM096089 and U54RR022220] and NSF CAREER
[1150287] (to F.A.). EA. is a Pew Scholar in Biomedical
Sciences, supported by the Pew Charitable Trusts.

Conﬂict of Interest: none declared.

 

i281

112 /310's1izu.mofp.ro;xo"sorJBurJOJurorq/ﬁduq 11101} papeo1umoq

9103 ‘0g isanV uo ::

M.Xu and F.Alber

 

REFERENCES

Amat,F. et al. (2010) Subtomogram alignment by adaptive Fourier coefﬁcient
thresholding. J. Struct. Biol, 171, 3327344.

Bartesaghi,A. et al. (2008) Classiﬁcation and 3D averaging with missing wedge
correction in biological electron tomography. J. Struct. Biol, 162, 436450.
Beck,M. et al. (2009) Visual proteomics of the human pathogen Leptospira inter—

rogans. Nat. Methods, 6, 8174823.

Beck,M. et al. (2011) Exploring the spatial and temporal organization of a Cell’s
proteome. J. Struct. Biol, 173, 483496.

Best,C. et al. (2007) Localization of protein complexes by pattern recognition.
Methods Cell Biol, 79, 615438.

Beucher,S. and Lantuéjoul,C. (1979) Use of watersheds in contour detection. In:
International Workshop on Image Processing, Real—Time Edge and Motion
Detection/Estimation, CCET T /IRISA, Rennes, France.

B6hm,J. et al. (2000) Toward detecting and identifying macromolecules in a cellular
context: template matching applied to electron tomograms. Proc. Natl Acad.
Sci. USA, 97, 14245714250.

Celeux,G. and Govaert,G. (1995) Gaussian parsimonious clustering models. Pattern
Recognit., 28, 7817793.

Chen,Y. et al. (2013) Fast and accurate reference—free alignment of subtomograms.
J. Struct. Biol, [Epub ahead of print, doi: 10.1016/j.jsb.2013.03.002, March 22,
2013].

F6rster,F. et al. (2008) Classiﬁcation of cryo—electron sub—tomograms using
constrained correlation. J. Struct. Biol, 161, 2767286.

Fraley,C. and Raftery,A. (2002) Model—based clustering, discriminant analysis, and
density estimation. J. Am. Stat. Assoc., 97, 611431.

Frangakis,A. et al. (2002) Identiﬁcation of macromolecular complexes in cryo—
electron tomograms of phantom cells. Proc. Natl Acad. Sci. USA, 99,
14153714158.

Frank,J. (2006) T hree—dimertsional electron microscopy of macromolecular assemblies.
Oxford University Press, New York.

Garzon,J. et al. (2007) Adp_em: fast exhaustive multi—resolution docking for high—
throughput coverage. Bioinformatics, 23, 427433.

Heumann,J. et al. (2011) Clustering and variance maps for cryo—electron tomog—
raphy using wedge—masked differences. J. Struct. Biol, 175, 2887299.

Hrabe,T. et al. (2012) Pytom: a python—based toolbox for localization of macro—
molecules in cryo—electron tomograms and subtomogram analysis. J. Struct.
Biol, 178, 1777188.

Kovacs,J. and Wriggers,W. (2002) Fast rotational matching. Acta. Crystallogr.
D. Biol. Crystallogr., 58, 128271286.

Lindeberg,T. (1994) Scale—Space Theory in Computer Vision. The Kluwer
International Series in Engineering and Computer Science. Kluwer Academic
Publishers, Dordrecht, The Netherlands.

Lucic,V. et al. (2005) Structural studies by electron tomography: from cells to mol—
ecules. Annu. Rev. Biochem., 74, 8337865.

Martinez—Sanchez,A. et al. (2011) A differential structure approach to membrane
segmentation in electron tomography. J. Struct. Biol, 175, 3727383.

McMullan,G. et al. (2009) Detective quantum efﬁciency of electron area detectors in
electron microscopy. Ultramicroscopy, 109, 112(r1143.

Medalia,O. et al. (2002) Macromolecular architecture in eukaryotic cells visualized
by cryoelectron tomography. Science, 298, 120971213.

Nickell,S. et al. (2005) TOM software toolbox: acquisition and analysis for electron
tomography. J. Struct. Biol, 149, 2277234.

Nickell,S. et al. (2006) A visual approach to proteomics. Nat. Rev. Mol Cell. Bio., 7,
2257230.

Volkmann,N. (2002) A novel three—dimensional variant of the watershed transform
for segmentation of electron density maps. J. Struct. Biol, 138, 1237129.

Volkmann,N. (2010) Methods for segmentation and interpretation of electron
tomographic reconstructions. Methods Enzymol, 483, 3146.

Witkin,A.P. (1983) Scale—space ﬁltering. In: International Joint Conference on
Artﬂicial Intelligence, Karlsruhe, Germany. pp. 101%1022.

Wriggers,W. et al. (1999) Situs: a package for docking crystal structures into
low—resolution maps from electron microscopy. J. Struct. Biol, 125, 1857195.

Xu,M. and Alber,F. (2012) High precision alignment of cryo—electron subtomo—
grams through gradient—based parallel optimization. BMC. Syst. Biol, 6
(SuppL l), 318.

Xu,M. et al. (2011) Template—free detection of macromolecular complexes in
cryo electron tomograms. Bioinformatics, 27, i697i76.

Xu,M. et al. (2012) High—throughput subtomogram alignment and classiﬁcation
by Fourier space constrained fast volumetric matching. J. Struct. Biol, 178,
1527164.

 

i282

112 /810's1au.mofp.ro;xo"sorJBuiJOJurorq/ﬁduq 11101} papao1umoq

9103 ‘0g1sn8nv uo ::

