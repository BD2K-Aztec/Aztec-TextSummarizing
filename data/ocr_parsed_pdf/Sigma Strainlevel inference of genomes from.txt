ORIGINAL PAPER

Vol. 31 no. 2 2015, pages 170—177
doi:10. 1093/bioinfonnatics/btu641

 

Genome analysis

Advance Access publication September 29, 2014

Sigma: Strain-level inference of genomes from metagenomic

analysis for biosurveillance

Tae—Hyuk Ahn, Juanjuan Chai and Chongle Pan*
Computer Science and Mathematics Division, Oak Ridge National Laboratory, Oak Ridge, TN, 37831, USA

Associate Editor: Michael Brudno

 

ABSTRACT

Motivation: Metagenomic sequencing of clinical samples provides a
promising technique for direct pathogen detection and characteriza-
tion in biosun/eillance. Taxonomic analysis at the strain level can be
used to resolve serotypes of a pathogen in biosurveillance. Sigma was
developed for strain-level identification and quantification of patho-
gens using their reference genomes based on metagenomic analysis.
Results: Sigma provides not only accurate strain-level inferences, but
also three unique capabilities: (i) Sigma quantifies the statistical uncer-
tainty of its inferences, which includes hypothesis testing of identiﬁed
genomes and confidence interval estimation of their relative abun-
dances; (ii) Sigma enables strain variant calling by assigning metage-
nomic reads to their most likely reference genomes; and (iii) Sigma
supports parallel computing for fast analysis of large datasets. The
algorithm performance was evaluated using simulated mock commu-
nities and fecal samples with spike-in pathogen strains.

Availability and Implementation: Sigma was implemented in C++
with source codes and binaries freely available at http://sigma.omics
bio.org.

Contact: panc@ornl.gov

Supplementary information: Supplementary data are available at
Bioinformatics online.

Received on June 15, 2014; revised on September 1, 2014; accepted
on September 21, 2014

1 INTRODUCTION

It is a public health and national security imperative to prepare
for a broad range of biological threats, including infectious dis-
eases and food-borne illnesses (Fox, 2012). Biosurveillance will
provide early detection of disease outbreaks and rapid character-
ization of pathogens. Conventional methods for biosurveillance
include laboratory culture, immunoassays, and genotyping
(Wagner et al., 2006). Metagenomic sequencing, developed in
environmental microbiology, is a promising new method for bio-
surveillance. For example, fecal samples of suspected patients in
food-borne disease outbreaks can be sequenced directly to iden-
tify responsible pathogens, bypassing the steps of strain isolation
and culturing for pathogen identiﬁcation. In the 2011 German
Shiga toxin-producing Ecoli (STEC) OlO4:H4 outbreak, the
pathogen was identified by the standard epidemiology procedure
of isolation, culturing, and genotyping (Rubino et al., 2011).
Multiple isolate cultures of this pathogen from different patients
were subsequently sequenced, which generated whole genome

 

*To whom correspondence should be addressed.

sequences for pathophysiology analysis. In the future, metage-
nomics could be used to sequence fecal samples of patients in the
early stage of such an outbreak, potentially allowing more rapid
and unambiguous identiﬁcation of the pathogen.

It is a computational challenge to achieve sensitive and speciﬁc
identiﬁcation of pathogens in a complex metagenome back-
ground. Many algorithms have been developed to infer the taxo-
nomic composition of a microbial community using metagenomic
sequencing data. The algorithms generally used the following
three approaches. (i) The k—mer statistics approach compares
k-mer frequency proﬁles of metagenomic reads with those of or-
ganisms representing a wide range of clades. This approach is used
by Na'ive Bayes Classiﬁer (Rosen et al., 2008), PhymmBL (Brady
and Salzberg, 2011), and PhyloPythiaS (Patil et al., 2011). (ii) In
the marker gene approach, metagenomic reads are aligned with a
set of preselected clade-speciﬁc marker genes, and taxonomic clas-
siﬁcation is inferred from phylogenetic distances to these marker
genes. This approach is used by MetaPhlAn (Segata et al., 2012)
and AMPHORA2 (Wu and Scott, 2012). Both of the two
approaches can produce high-quality classiﬁcation results at the
species level or above without using a signiﬁcant amount of com-
putation. However, these two approaches may not be adequate
for taxonomic classiﬁcation at the strain level. Genome identiﬁ-
cation for metagenomic biosurveillance needs to resolve different
strains (or serotypes) of the same species. For example, pathogenic
Ecoli strains need to be unambiguously differentiated from
coexisting non-pathogenic Ecoli strains in the metagenome.

Alternatively, (iii) the read mapping approach infers the taxo-
nomic composition of a community by searching metagenomic
reads against a database of reference genomes. This approach is
used by MEGAN (Huson et al., 2007), Sort-ITEMS (Monzoorul
Haque et al., 2009), MetaPhyler (Liu et al., 2011), Grammy 0(ia
et al., 2011), GASiC (Lindner and Renard, 2013), and Pathoscope
(Francis et al., 2013). This approach can provide accurate high-
resolution taxonomic classiﬁcation for clades well represented by
reference genomes. It is suitable for metagenomic biosurveillance
of known pathogens, which generally have reference genomes
available for a variety of strains. However, it is difﬁcult for this
approach to detect novel pathogens. When a new strain is present
in a sample, its closely related strains in a reference genome data-
base need to be identified and their sequence variations be
determined.

Here, we present the Sigma algorithm (strain-level inference of
genomes from metagenomic analysis) for metagenomic biosur-
veillance. A novel probabilistic model was developed to identify
and quantify genomes using the read mapping approach.
Our benchmarks showed that Sigma provided more accurate

 

© The Author 2014. Published by Oxford University Press.

This is an Open Access article distributed under the terms of the Creative Commons Attribution License (http://creativecommons.org/licenses/by/4.0/), which
permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.

112 /310's112u1n0fp10}x0"sotJBurJOJutotq/ﬁduq 11101} papaolumoq

91oz ‘Og anﬁnv uo ::

 

strain-level and species-level classiﬁcation than an established
read mapping algorithmiMEGAN, a representative marker
gene algorithmiMetaPhlAn, and a recent pathogen detection
algorithmiPathoscope. Sigma was scaled from desktops to
supercomputers to achieve a short turnaround time for large
metagenomic datasets. This allows a prompt response of a meta-
genomic biosurveillance network to disease outbreaks using
supercomputers.

The existing taxonomic analysis algorithms generally do not
provide statistical conﬁdence assessment of their results. It is
difficult to make a biosurveillance decision based on the inference
of an algorithm on a pathogen’s presence without knowing the
uncertainty on such inferences or to use the estimated relative
abundance of a genome without knowing the conﬁdence inter-
vals of such estimates. After the identification and quantification
of genomes, Sigma can rigorously evaluate the statistical conﬁ-
dence of its ﬁndings. Hypothesis testing based on the likelihood
ratio test was used to calculate P—Values for the detection of rele-
vant genomes. Bootstrapping was used to estimate the conﬁdence
intervals of the relative abundances of identiﬁed genomes.

When an outbreak spreads or a pathogen re-emerges, it is
important to determine the sequence variations between the gen-
omes of this pathogen in the ﬁeld-collected samples and its ref-
erence genomes in the database. This allows accurate
reconstruction of the transmission sources of the outbreak and
the evolutionary history of the pathogen. Thus, biosurveillance
further requires information on the single-nucleotide polymorph-
isms (SNPs) of a detected pathogen to distinguish different vari-
ant populations. Identiﬁcation of variants is straightforward for
isolate genome sequencing by mapping all reads to a reference
genome. However, in metagenome sequencing, one cannot
simply map all metagenomic reads to a reference genome, be-
cause some of the aligned reads may originate from different
microorganisms, which could introduce false variations. Sigma
solves this problem by assigning each read to its most likely
originating genome based on the Sigma probabilistic model,
which allows subsequent variant calling by variants calling soft-
ware such as SAMTools (Li et al., 2009).

2 ALGORITHM AND IMPLEMENTATION

2.1 General description of the Sigma algorithm

Figure 1 shows an overview of the Sigma algorithm. Sigma starts
with mapping all reads in a metagenomic dataset onto a user-
defined database of reference genomes. A parallelization wrapper
is provided as an option for users to speedup the read alignment
using computer clusters. A read can be aligned to many genomes
with up to a given number of mismatches.

The foundation of all statistical inferences in Sigma is a simple
probabilistic model for sampling reads with mismatches from
genomes at unknown abundances. The Sigma probabilistic
model permits maximum likelihood estimation (MLE) of the
relative abundances of all genomes measured by the percentages
of reads sampled from these genomes. Importantly, we proved
the convexity of the objective function of the MLE so that Sigma
can guarantee to attain a global optimum solution using interior
point non-linear programming (NLP) provided in the Ipopt li-
brary (Wachter and Biegler, 2006).

 

r Metagenomic reads sat

 

 

 

E. coii strain A: —
E mi' 1 ' B — _ — - —
. i 5 FBI" i
_ I * — — -
E. coil strain E: - — — —
L — - — - —
J
r . . .
Align reads to reference genomes In parallel ::::r‘""'°
f [ﬂ 3‘19 $13 £913 £919 um {913 mm
' E. MA E. MI E. MC . . _ - Mu
- I a a
Dumon to E5 5E 55
supercomme   

L

 

 

r 1
Strain-level relative Statistical confidence
abundance esllmauon measurements “am” calling

 

 

 

 

 

 

 

 

M ATCGGM:
E E Lanh'A
E ! ATCRGIG
g g Emu-um = aromas
. _ E A'I'CAGM:
0? eye 0? ere ¢¢<ee¢¢ 3322::
L “a at». it. at». swam. ,

 

Fig. 1. Conceptual overview of the Sigma algorithm. The inputs are
metagenomic reads and user-deﬁned reference genomes (top panel).
The alignment of reads to genomes is used to deﬁne a probabilistic
model of metagenomic sequencing (middle panel). Genomes are detected
with hypothesis testing, quantiﬁed with conﬁdence interval estimation,
and scanned for sequence variations (bottom panel).

The Sigma probabilistic model further provides the statistical
framework for hypothesis testing and confidence interval estima-
tion. Sigma calculates the P-Value for identiﬁcation of a genome
using a likelihood ratio test of the null hypothesis that this
genome is not present in the sample. To account for the quanti-
ﬁcation uncertainty from the stochastic sampling process of meta-
genomic sequencing, bootstrapping is used to estimate conﬁdence
intervals of relative abundances of identiﬁed genomes. As both
bootstrapping and likelihood ratio tests entail solving the non-
trivial NLP optimization problem for many times, the NLP solver
of Sigma is multithreaded and parallelized to computer clusters.

Finally, given the MLE of genome relative abundances, Sigma
can calculate the probabilities of sampling a read from its
mapped genomes, which allows assigning metagenomic reads
to their most likely originating genomes for variant calling.
For a selected genome, Sigma provides the alignment of its as-
signed reads on the genome sequence as the input for variant
calling with SAMtools. Sigma ﬁlters the variant calling output to
identify high-conﬁdence sequence variations.

2.2 Mathematical framework of Sigma

The Sigma probabilistic model is used to represent the stochastic
process of sampling reads from genomes during metagenomic
sequencing. Let Pr(gj) e [0, 1] be the probability of sampling a
random read from the reference genome gj. Considering only
reads sampled from reference genomes in the database, we have:

Pr(gj) is determined by the relative abundance, size, and
sequencing bias of the genome gj. Sigma estimates Pr(gj) from
the alignment results using MLE. Consider a read, r), mapped
onto g with z base-pairs of mismatches. A uniform probability

 

171

112 /310's112u1n0fp10}x0"sorJBurJOJurorq/ﬁduq 11101} papaolumoq

91oz ‘Og anﬁnv uo ::

T.-H.Ahn et al.

 

of a (default: 5%) is assumed for any mismatch between a read
and a genome, which can stem from genome variability and
sequencing errors. Given that a read r,- is sampled from gj, the
probability of obtaining r,- with z mismatches and (I — 2) matches

in the alignment is:
Pr(r,~|gj) =oz(l — o)lTZ; Z 5 U, (1)
Pr(r,-|gj) = 0; Z> U.

where I is the length of r,- in base pairs (bp) and U is the max-
imum number of mismatches allowed in the read alignment.
Sigma calculates Pr(r,-|gj) between each read and each genome
based on their alignment, or lack thereof, and populates a con-
stant matrix, Q

Qi.j=Pr(Vilg/')-
Then, the probability of sampling r,- from gj is simply:
Pr (0781') =Pr (Vilgj) 'Pr (81)
= Q0 ' PT (81')

Because a read may originate from any one of the reference
genomes, the probability of generating r,- is:

Pr (n) = Z Pr(r,-, gj).
V]

MLE ﬁnds the estimate of Pr(gj) by maximizing the probabil-
ity of all reads, which is the joint probability of all reads:

max Pr (r1,...,r,,)

=max nWPr (Vt)
=max 1—[Vi|:ZVjPr (“7 gj
=max nw|:ZVjQL/' ‘ Pr(gf):|‘

After log-transformation and linear scaling of Q for the conveni-
ence of precise numeric calculation, we formulate an optimiza-
tion problem:

Objectivefunction: min{ — Zv' log|:Zv' Ql'JGj]}
t J
=mml—ZE:WR¥(QGT)j (a

Subject to: 0 5 Gj 5 1 forj=1, ...,m, and

Zijj = I,

where G=[G1, ...,G,,,] = [Pr (g1), . . . , Pr (gm)] for m genomes.
This optimization problem is solved using a NLP method
(Nocedal and Wright, 2006). Sigma uses the primal-dual interior
point NLP method implemented in the Ipopt library (Wachter
and Biegler, 2006). The interior point method guarantees global
optimum solutions for convex objective functions. The convexity

of Sigma’s objective function is proved in Supplementary
Proposition 1. Therefore, Sigma can guarantee the maximum
likelihood estimates of G. Only aligned reads were considered
in the estimation of G. A relative abundance of a genome can
be calculated by

Abkoﬂ. (»

where 6 is the proportion of aligned reads out of all sequenced
reads.

Sigma calculates the percentile bootstrap conﬁdence intervals
for G. All reads are randomly sampled with replacement to gen-
erate a bootstrap resample dataset with the same number of
reads as the original dataset. A total of B resamples (default:
1000) are generated and Sigma calculates MLEs from the boot-
strap resamples: G’f, . . . , G}, where G; =[G1,k, . . . , Gmk]. Let T]-
be the quantile function for all bootstrap estimates of Gj, i.e.
[Gib . . . , G133]. The (1 — a) conﬁdence interval of Gj is calcu-
lated as:

mwmrowm>

The bootstrap confidence interval estimation measures the un-
certainty caused by the stochastic sampling process of metage-
nomic sequencing. The conﬁdence interval of Gj is converted to
the conﬁdence interval of its relative abundance, A(gj), using
Equation (3).

Reference genomes with relative abundances above a certain
threshold (default: 0.01%) can be considered to be identiﬁed in
the metagenome sample. Sigma performs hypothesis testing on
the null hypothesis that g is not present:

muGﬂQemenQ=mehemﬂl

HuGﬂQemHWHQEmenﬁemH]
The likelihood ratio test is used for the hypothesis testing:

_ max Pr (r1.....rn|H0)
max Pr (V1,---.rn|Hl)-

The likelihood ratio compares the maximum likelihood of the
data under the null hypothesis versus that under the alternative
hypothesis. The likelihood ratio is small if the data strongly sup-
ports alternative hypothesis. The likelihood ratio test calculates a
P-Value by assuming a X2 distribution with one degree of free-
dom for the statistic, —2ln A. The statistical signiﬁcance of an
identiﬁed genome is determined not only by its Gj, but also by
the distinctness of the genome in the database.

2.3 Alignment of sequencing reads to reference genomes

The inputs for Sigma are a reference genome database and meta-
genomic sequencing reads. Sigma can scale up to large databases
with tens of thousands of reference genomes. Sigma uses a hier-
archical structure for the reference genome database as set up by
RefSeq (Pruitt et al., 2012): a root directory containing many
sub-directories of FASTA ﬁles. Each sub-directory corresponds
to a genome and the directory names are used by Sigma as the
genome names because they are unique identiﬁers. A genome
may have multiple FASTA ﬁles in its sub-directory. Genomes

 

172

112 /310's112u1n0fp10}x0"sorwurJOJurorq/ﬁduq 11101} pQPBOIII/lAOG

91oz ‘Og isnﬁnv uo ::

Sigma

 

can be added or removed from the reference genome database by
simply adding or removing their sub-directories in the root dir-
ectory. The root directory is speciﬁed in the conﬁguration file of
Sigma.

Sigma uses a third-party short-read alignment algorithm to
align all metagenomic reads onto every reference genome. By
default, Bowtie 2 (Langmead and Salzberg, 2012) is used, but
users can change to any other short-read alignment algorithm
that uses FASTQ/FASTA formats for read input and SAM/
BAM formats for alignment output. Users may specify the max-
imum number of mismatches per read and the range of the inter-
mate distance for the read alignment in the Sigma conﬁguration
ﬁle. The default maximum number of mismatches per read was
three for 100—bp reads to balance between the alignment strin-
gency and the computing time of read alignment.

Sigma provides a C-l-+ hybrid parallelization wrapper to
scale up the read alignment from multi-core workstations to
distributed-memory supercomputers. Computation on a work-
station is distributed to multiple processes, each containing 8724
threads, across CPU cores with shared memory. The Message-
Passing Interface (MPI) library is used to distribute the compu-
tation across nodes in distributed-memory systems from small
clusters to supercomputers. Dynamic load balancing is per-
formed at both the multi-process level and the MPI level to
maximize throughput and minimize wall-clock computing time.

2.4 Implementation of MLE, bootstrapping, likelihood
ratio tests, and variant calling.

Sigma parses the alignment results and generates the Q matrix.
The relative abundances of genomes are estimated from the Q
matrix using MLE. Sigma solves the NLP problem for MLE
using the Ipopt library (Wachter and Biegler, 2006). Most of
the computing time for NLP is spent in the objective function
evaluation step, which involves non-trivial linear algebra calcu-
lation on the large Q matrix. To speedup the calculation, we
parallelized the objective functional evaluation step using
multi-threading with the Open Multi-Processing (OpenMP) li-
brary (Pacheco, 2011).

To perform bootstrapping, Sigma generates a bootstrap Q
matrix by randomly taking rows from the original Q matrix
with replacement. Sigma then performs MLE using the boot-
strap Q matrix. This process is repeated many times to generate
a set of bootstrap estimates, which are used to calculate a per-
centile confidence interval and relative standard deviation
(RSD). Sigma distributes the parallel processing of bootstrap
samples on a cluster using MPI/OpenMP. Users can set the
number of bootstrapping iterations in the Sigma conﬁguration
ﬁle.

Sigma performs likelihood ratio tests on user-selected gen-
omes. The log-likelihood of the null hypothesis (i.e. a selected
target genome is absent) is calculated using a Q matrix that does
not contain the target genome. The log-likelihood of the alter-
native hypothesis (i.e. the target genome is present) is the same as
calculated from the original Q matrix. The log-likelihood of the
null hypothesis should be smaller than that of the alternative
hypothesis, because the target genome has been estimated to
have a non-zero relative abundance. Sigma can perform

likelihood ratio tests for many target genomes in parallel on a
cluster using MPI/OpenMP.

Sigma assigns metagenomic reads to their most likely reference
genomes for variant calling. For each aligned read, the probabil-
ity of each read from each genome is calculated by:

“(Vb 81') = Q0 ' Pr(81')-

Each read is then assigned to the genome with the highest prob-
ability. Sigma generates a BAM alignment file for a selected
reference genome using only its assigned reads. SAMtools is
then used to identify sequence variants from the BAM file and
report results in a variant call format (V CF) file. Finally, the
VCF ﬁle is processed by Sigma to extract high-conﬁdence se-
quence variants based on SAMtool’s variant-calling quality
score (default: >20) and sequence variant frequency (default:
>25%).

All modules of Sigma were implemented in C + + . The results
are presented in two types of formats: a HTML format for result
Visualization and a text format for further data analysis.

3 SYSTEM AND METHODS

MetaSim (Richter et al., 2008) was used to simulate 100-bp
Illumina sequencing reads with an empirical error model. The
Illumina error model provided by MetaSim for 80-bp reads was
extended to simulate 100—bp reads. The simulated reads contained
0.88 errors per read on average. The preprocessed metagenomic
sequencing dataset of a fecal sample from a healthy subject was
downloaded from ftp://public-ftp.hmpdacc.org/Illumina/stool/
SRS011529.tar.bz2. The Illumina sequencing dataset of the
Ecoli OlO4:H4 strain 280 (UK Health Protection Agency’s ma-
terials identiﬁer H112160280) was downloaded from https://
github.com/ngscomparison/NGS-Benchtop-Comparison.

MEGAN (Huson et al., 2007; version 4.70) was downloaded
from http: / / ab.inf . uni-tuebingen.de / s of tware /me gan/ .
Metagenomic datasets were aligned to their corresponding refer-
ence genome databases using megablast in BLAST (version
2.2.26) with parameters (em 7 7V 100 7b 100). MEGAN was
run using the default parameters for lowest common ancestor
(LCA) except the “Min Support” parameter. The “Min
Support” parameter is a threshold for the minimum number of
reads that must be assigned to a taxon. It was set to 0.01%, the
same as in Sigma.

MetaPhlAn (Segata et al., 2012; version 1.7.7) was down-
loaded from https://bitbucket.org/nsegata/metaphlan/. The
alignment was performed using Bowtie 2 with options speciﬁed
by MetaPhlAn. Default parameters were used for the
MetaPhlAn classiﬁcation analysis.

Pathoscope (Francis et al., 2013; version 1.0.1) was down-
loaded from http://sourceforge.net/projects/pathoscope/.
BLAST was used for read alignment with suggested parameters
(7m 8 7V 100 7b 100) by Pathoscope. Pathoscope was run with
the default parameters and the results were reported with the
0.01% relative abundance cutoff (is 0.01).

All benchmarking was performed on a 64—core computer
system with 256 GB shared memory. The scalability of Sigma
was also tested on an open-science supercomputer, Titan, at Oak
Ridge Leadership Computing Facility.

 

173

112 /310's112u1n0fp10}x0"sorwurJOJurorq/ﬁduq 11101} pQPBOIII/lAOG

91oz ‘Og isnﬁnv uo ::

T.-H.Ahn et al.

 

Table 1. Comparison of Sigma, Pathoscope, MetaPhlAn, and MEGAN in strain-level identiﬁcation and quantiﬁcation using a S-genome synthetic

community. (RA%: relative abundance in percentage)

 

 

 

 

 

 

 

Simulation Input Sigma Pathoscope MEGAN MetaPhlAn
Strains RA(%) Strains RA(%) Strains RA(%) Strains/Species RA(%) Species RA(%)
S .antarica S .antarica S .antarica Santeria: serovar 1.58
serovar Paratyphi A 60 serovar Paratyphi A 59.85 serovar Paratpr A 60_11 Paraprhi A Santarica 31.05
strain ATCC 9150 strain ATCC 9150 strain ATCC 9150 Semen?” subsp- 45-49
entenca
Santeria: others 7.78
Efargusonii Efargusonii Efargusonii Efargusonii ..
E. . 28.84
ATCC 35469 27 ATCC 35469 2694 ATCC 35469 27'” ATCC 35469 “'49 fergm‘m”
E.coli 9 E.coli 8 91 E.coli 9 64 E.coli 0 02
K12 substr MG1655 K12 substr MG1655 ' K12 substr MG1655 ' K-IZ '
E.coli 3 E.coli 3 11 E.coli 2 6 ECO” 2-19 Ecoli 13.36
0157:H7 TW14359 0157:H7 TW14359 ' 0157:H7 TW14359 ' Others
E.coli E.coli E.coli ECO” 0.02
l 0.94 0.018 0157:H7

0157:H7 Sakai 0157:H7 Sakai

0157:H7 Sakai

 

Entarobactariacaasa 25.26 Salmonella others 26.76
others

 

4 RESULTS

4.1 Comparison of genome identiﬁcation and
quantiﬁcation performance

Sigma was compared with three existing taxonomic classiﬁcation
algorithms: MEGAN (Huson at al., 2007), Pathoscope (Francis
at al., 2013), and MetaPhlAn (Segata at al., 2012). A 5-genome
synthetic community was constructed using MetaSim (Richter
at al., 2008) to test the taxonomic resolution of their classiﬁcation
(Table 1 and Supplementary Figure 1). Reads simulated from a
target genome, Escherichia coli 0157:H7 Sakai, were mixed with
reads from genomes of the same serotype (E.c0li 0157:H7
TW14359), the same species (E.c0li K12), the same genus
(Efargusoniz), and the same family (Salmonella anterica serovar
Paratyphi A strain ATCC 9150). The average nucleotide identity
(ANI; Goris at al., 2007) of the target genome (E.c0li 0157:H7
Sakai) was 99.95% to Each 0157:H7 TW14359, 98.35% to
Each K12, 92.88% to the Efargusonii genome, and 84.47% to
the Santerica genome.

A total of 20 million simulated reads were aligned to all 2266
RefSeq genomes (retrieved in May 2013). The reads from the
three E.c0li strains were mapped to 58 other E.c0li strains in
the database (Supplementary Figure 1a), which challenged the
four algorithms’ ability to identify the target E.c0li 0157:H7
Sakai genome and quantify its relative abundance. The relative
abundance of the target genome was estimated at 0.94% by
Sigma and 0.018% by Pathoscope (Table 1 and Supplementary
Figure 1b). The target genome was aggregated with other gen-
omes to the serotype level (Each 0157:H7 at 0.02%) by
MEGAN and to the species level (Each at 13.36%) by
MetaPhlAn. Thus, Sigma provided the most accurate

quantiﬁcation for the target E.c0li genome. However, all algo-
rithms performed relatively well for other genomes at the species
level.

Sigma was then compared with the other three algorithms
using a more complex synthetic community composed of 100
diverse bacterial and archaeal genomes with relative abundances
ranging from 0.41% to 1.59%. The synthetic community covered
35 classes, including 22 genomes from Gammaproteobacteria, 9
from Clostridia, 7 from Betaproteobacteria, and 7 from Bacilli.
There were seven E.c0li strains, two Santerica strains, two
Mathanococcus maripaludis strains, and two Shawanella baltica
strains. 100 million reads were simulated by MetaSim and the
RefSeq database was provided to Sigma, Pathoscope, and
MEGAN for read alignment. Supplementary Figure 2 shows
the expected relative abundances of all included genomes and
the quantification results from the four algorithms. Sigma cor-
rectly identiﬁed all 100 genomes and accurately quantiﬁed their
relative abundances within 09571.05 of their expected relative
abundances. For the other algorithms, Table 2 shows the num-
bers of false-positive and false-negative identiﬁcations and the
numbers of accurate and inaccurate abundance estimations for
the correctly identified genomes. Pathoscope was unable to ac-
curately resolve many closely related genomes, such as between
the Gammaproteobacteria genomes. MEGAN incorrectly as-
signed many reads to taxa at higher taxonomic ranks.
MetaPhlAn also made many errors at the species level.
Overall, this test indicated the superior accuracy of Sigma quan-
tiﬁcation at the strain and species levels in a complex synthetic
community.

Biosurveillance requires short turnaround time in data analysis
for quick response to outbreaks. The wall-clock analysis time

 

174

112 /3.10's112u.1n0fp.101x0"sorwurJOJurorq/ﬁduq 111011 papaoprmoq

91oz ‘Og isanV uo ::

Sigma

 

Table 2. Summary statistics of the identiﬁcation and quantiﬁcation re-
sults of a loo-genome synthetic community

 

Sigma Patho MEGAN Meta

 

scope PhlAna
Expected Genomes/Species 100 100 100 91
True Accurate RAb 100 73 23 6
Positive Inaccurate RAb 0 25 67 71
False Positive 0 0 1 18
False Negative 0 2 10 14

 

Z“MetaPhlAn performed species—level analysis. Statistics in this column are numbers
of species.

bTrue positive identiﬁcations may have either accurate RA estimations within 0.95
to 1.05 of their expected RAs or inaccurate RA estimations outside this range.

Table 3. Comparison of analysis time and peak memory usage

 

 

Alignment Abundance Estimation Total
Wall-Clock Wall-Clock Memory Wall-Clock
Time (hr) Time (hr) (GB) Time (hr)
Sigma 18 1 62 19
Patho scope 70 13 1 18 83
MEGAN 70 12 93 82
MetaPhlAn N/A 0.2 1 0.2

 

and peak memory usage of the four algorithms were compared
based on the 5-genome synthetic community benchmarks on a
workstation with 64 CPU cores and 256 GB memory (Table 3).
The entire analysis of MetaPhlAn was completed within 10 min
using 1 GB memory. Conversely, MEGAN, Pathoscope, and
Sigma all required computing-intensive read alignment using
BLAST or Bowtie. The abundance estimation by NLP in
Sigma was signiﬁcantly faster and used less memory than the
estimation by expectation-maximization (EM) in Pathoscope
and by LCA in MEGAN (Table 3). To further speedup the
alignment step for large metagenomic datasets, Sigma provides
a hybrid parallelization wrapper with dynamic load balancing,
which scaled nearly linearly up to 10000 cores on the supercom-
puter, Titan. This enabled Sigma to complete the alignment step
in only 10 min using 10000 cores.

4.2 Statistical conﬁdence assessment by Sigma.

The unique capability of Sigma for statistical conﬁdence assess-
ment was tested using a fecal metagenome dataset (SRS011529)
generated by the Human Microbiome Project (HMP;
Huttenhower at al., 2012; Methé at al., 2012). To determine
the taxonomic composition of the fecal sample, ~125 million
Illumina reads in this dataset was mapped to 24 994 reference
genomes from GenBank (retrieved in July 2014). Sigma identi-
ﬁed 135 genomes, including many Bacteroidales genomes such as
Pravotalla copri, P.stercorea, Bacteroides vulgatus, and

B.xylanisolvans (Supplementary Figure 3). This test also demon-
strated the scalability of Sigma to large reference databases.

No Salmonella genome was found in this fecal sample. To test
detection of Salmonella poisoning, varying amounts of reads
simulated from a Santerica genome (serovar Paratyphi A
strain ATCC 9150) were spiked into the fecal dataset at the rela-
tive abundances of 1%, 0.1%, 0.01%, 0.001%, and 0.0001%,
which corresponded to genome coverage depths ranging from
27x to 0.0027x. The spike-in fecal metagenomes were aligned
with the RefSeq database. There were 26 other genomes from
different Santerica strains in the RefSeq database, which served
as decoys for testing the statistical uncertainty of strain
identiﬁcation.

Likelihood ratio tests were performed on all Santerica strains
in RefSeq in each spike-in dataset (Figure 2a). The correct
Santerica strain, and only this strain, was identiﬁed with a
P—Value less than 0.01 from 1% down to 0.001% spike-in
datasets. As expected, the likelihood ratio of this strain’s identi-
ﬁcation decreased with its relative abundance. The correct
Santerica strain was not identiﬁed in the 0.0001% (0.0027x)
spike-in dataset. More importantly, using a P—Value cutoff of
0.01, there was no false-positive identiﬁcation of other
Santerica strains in all spike-in datasets (Figure 2a). We then
quantiﬁed the spike-in Santerica strain with bootstrap confi-
dence interval estimation (Figure 2b). This strain was quantiﬁed
at accurate abundances in the 1%4).001% spike-in datasets, but
not in the 0.0001% dataset. The bootstrap confidence intervals
were very tight in all except the 0.0001% dataset. The quantiﬁ-
cation precisions in the ﬁve datasets were also measured with
RSD of bootstrap estimates. The RSD increased with decreasing
amounts of spike-in reads from 1% to 0.0001% (Figure 2b).

To test Sigma’s performance on smaller metagenomic datasets,
we repeated the Salmonella spike-in experiments using a 10%
sub-sample (~12.5 million reads) and a 1% sub-sample (~1.25
million reads) of the fecal dataset. Supplementary Figure 4 shows
that the target Santerica strain was identiﬁed correctly and
quantiﬁed accurately from all samples with at least 0.027x cover-
age depth of the target genome, which corresponded to 0.01%
spike-in for the 10% sub-sample and 0.1% spike-in for the 1%
subsample. Therefore, the detection limit of Sigma was deter-
mined by the minimum coverage of a target genome and
deeper metagenomic sequencing provided more sensitive
detection.

4.3 Identiﬁcation of nearest genomes and detection of
strain variations

When a sampled strain is not present in the reference genome
database, Sigma can identify its closest relative and detect SNPs
between the sampled strain in the metagenome and the identiﬁed
strain in the database. This capability was tested by searching the
above Santerica l%-spike-in dataset against four different ref-
erence genome databases, which represented the spike-in genome
as a known strain (Ref 1), a novel strain (Ref2), a novel species
(Ref3), and a novel genus (Ref4; Supplementary Table 1). When
the full RefSeq database (Ref 1) was used, Sigma correctly iden-
tiﬁed and accurately quantified the spike-in strain (serovar
Paratyphi A strain ATCC 9150) at 0.988%. Furthermore,
Sigma did not find any SNP between the sampled strain and

 

175

112 /3.10's112u.1n0fp.101x0"sorwurJOJurorq/ﬁduq 111011 papBOIH/noq

91oz ‘Og isanV uo ::

T.-H.Ahn et al.

 

A
9
v

E

 

 

 

1'11. (2710 0.193121%) 0.01% (0.2710 0.00111. (0.0211) 0.0001% (0.002110 .3. <1,— 1150:1112 941,."
o 1e+6 - a; I .
:5 N — “50103996 ."
tn .
§ E (9‘ 
'u  1'
an 66' .‘ RSD: 1.25 91.
8 1e+4 - h 09" . ‘
5 a O'IFIISD 3 92%
.— ap- , : .
a: .
r‘.‘ g 069 I
a 1e+2 - E .99" 
3 E 9511?  E RSD: 33.5491.
P-Value = 0.01 -- a it in I; ix
I I'll   Ill 1; <9“: 96'} ('0 Q1 we?
.‘I . ;I . 't ‘.. . . -   f... _ I.   I. .-. - I ; .  1...... u: ......... .1. Lu ms,- wk 6‘ duel“ \
u v - u , K
S. enterica S. enterica S. enterica S. enterica S. enterica a? ‘9

9- “Expected RA ("/61

Fig. 2. Identiﬁcation of a Salmonella enterica strain at a serial dilution of relative abundances in a human fecal microbiota background. (a) Likelihood
ratios of all aligned Salmonella enterica strains. Only the correct strain (highlighted in red outline) has statistically significant identiﬁcation with <0.01
p-value down to the 0.001% dataset. (b) Estimated and expected relative abundances (RA) of the spike-in Salmonella enterica strain. Point estimates
(red dots) were bracketed by 95% conﬁdence intervals (blue error bars) with small relative standard deviations (RSD) down to 0.001 % (0.027X coverage

depth).

the identiﬁed reference strain with 100% genome coverage. This
indicated that the identified strain was exactly the same as the
sampled strain in the metagenome.

The Ref2 database was constructed by removing the spike-in
genome from the RefSeq database. The Ref2 database allowed
Sigma to identify a closely related strain of the same serovar,
Santerica serovar Paratyphi A strain AKU 12601 (ANI:
99.98%), and quantiﬁed its relative abundance at 0.986%. 190
high-conﬁdence SNPs were found on the identiﬁed genome of
strain AKU 12601 using Ref2, which were verified using the
original genome of strain ATCC 9150. 99.95% of the identiﬁed
genome was covered. The covered region divergence (CRD),
deﬁned as the percentage of high-confidence SNPs out of the
covered regions of the identified genome, was 0.0042%. The
sequence divergence showed a high genome-wide similarity be-
tween the identified reference genome and the actually sampled
genome.

The Ref3 database was then constructed by removing all
Santerica species genomes from the RefSeq database. Sigma
identiﬁed a genome of the same genus, S.bongori NCTC 12419
(ANI: 90.50%), at a relative abundance of 0.031%. The relative
abundances and P—Values calculated by Sigma were based on the
covered regions of the identiﬁed genomes. Only 11.46% of
the identiﬁed S.bongori genome was covered and 3750 high-
confidence SNPs were found on the covered regions with a
CRD of 0.734%. This indicated that only a small portion of
the identiﬁed genomes was related to the sampled genomes
in the metagenome.

Finally, the Ref4 database was constructed by removing all
Salmonella genus genomes from the RefSeq database. Sigma did
not identify any genome that was not a background genome in
the fecal sample.

4.4 Demonstration of Sigma for biosurveillance of the
2011 German E.coli outbreak
A hypothetical biosurveillance scenario was constructed based

on the 2011 German STEC OlO4:H4 outbreak (Rubino at al.,
2011). The STEC OlO4:H4 strain 280 (UK Health Protection

Agency’s materials identiﬁer H112160280) was isolated from
this outbreak and sequenced by Illumina shotgun sequencing
(Loman at al., 2012). We spiked 1.7 million reads from this iso-
late into ~125 million reads of the fecal metagenomic dataset,
which simulated the existence of STEC OlO4:H4 strain 280 in a
fecal sample at a relative abundance of 1.37%. The RefSeq data-
base contained a reference genome, STEC OlO4:H4 strain
2011C-3493, isolated from a contracted US. citizen after travel
to Germany during the outbreak (Ahmed at al., 2012). OlO4:H4
2011C-3493 was closely related to two other OlO4:H4 genomes
in the RefSeq database, 2009EL-2050 and 2009EL-2071, which
were isolated from 2009 bloody diarrhea cases in the Republic of
Georgia.

After searching the spike-in metagenomic dataset against the
RefSeq database, Sigma identiﬁed OlO4:H4 2011C—3493 at
1.14%, OlO4:H4 2009EL 2050 at 0.18%, and OlO4:H4
2009EL 2071 at 0.05%. No other genomes were identiﬁed
from the addition of OlO4:H4 strain 280. This provided evidence
for the presence of the STEC OlO4:H4 strain, which was very
closely related to OlO4:H4 2011C—3493, and further to its two
immediate phylogenetic neighbors. Sigma detected 211 high-
confidence SNPs on the OlO4:H4 2011C-3493 genome from
the metagenomic dataset. 99.96% of the OlO4:H4 2011C-3493
genome was covered with 0.004% CRD.

5 DISCUSSION

A number of taxonomic classiﬁcation algorithms have been
developed for metagenomic data with different advantages.
For example, the LCA algorithm used by MEGAN can provide
classiﬁcation at a higher taxonomic rank for a novel microorgan-
ism without a reference genome from a closely related strain or
species in the database. The marker gene approach used by
MetaPhlAn only requires a small amount of computing re-
sources for large metagenomic datasets. The general-purpose
taxonomic classiﬁcation algorithms (Brady and Salzberg, 2011;
Diaz at al., 2009; Liu at al., 2011; Monzoorul Haque at al., 2009;
Patil at al., 2011; Xia at al., 2011) typically provide

 

176

112 /310's112u1n0[p101x0'so1112111101u101q//:d11q 111011 papaolumoq

91oz ‘0g1sn8nv 110 ::

Sigma

 

comprehensive phylogenetic coverage and identiﬁcations at
proper taxonomic ranks for complex microbial communities,
which is important for many microbial ecology studies.

Conversely, Pathoscope and Sigma both are designed for
detecting pathogens in metagenomic samples. However,
Pathoscope did not provide accurate resolution of different
strains in a sample, which is required for biosurveillance to dis-
tinguish pathogenic strains from non-pathogenic strains and to
pinpoint the serotype of a pathogen from a complex metagenome
background. This is probably because the EM algorithm used by
Pathoscope can only provide a local optimum solution for
genome abundance estimation. The local optimum solution
may deviate signiﬁcantly from the global optimum solution for
metagenomes that are complicated by multiple different strains.
However, the NLP algorithm used by Sigma mathematically
guarantee a global optimum solution for genome abundance es-
timation, due to the convexity of the objective function for the
MLE.

Furthermore, Sigma provides three unique capabilities needed
for metagenomic biosurveillance. First, Sigma can evaluate the
statistical conﬁdence of genome identification and quantification
with hypothesis testing and conﬁdence interval estimation.
The uncertainty quantiﬁcation will support more informed deci-
sion making in biosurveillance. Second, Sigma can determine the
divergence of the actual genomes in the sample from the refer-
ence genomes in the database by variant calling. By assigning
metagenomic reads to their most likely originating genomes,
Sigma makes the metagenomic SNP analysis amenable to the
existing variant calling algorithms designed for isolate genomes.
Strain variations can be used to track the divergence of a patho-
gen during its spread. Finally, Sigma users can optionally use
high-performance computing to achieve fast analysis with short
turnaround time. The computation is scalable to very large
metagenomic datasets.

ACKNOWLEDGEMENTS

The authors would like to thank Richard Stouder, Loren
Hauser, and Robert Cottingham for their support and assist-
ance. This work was supported by Laboratory Directed
Research and Development (LDRD) funding from Oak Ridge
National Laboratory. The contribution of J .C. was sponsored by
the Ofﬁce of Advanced Scientific Computing Research. This re-
search used resources of the Oak Ridge Leadership Computing
Facility at the Oak Ridge National Laboratory, which is sup-
ported by the Ofﬁce of Science of the US. Department of Energy
under Contract No. DE-AC05-000R22725.

Conﬂict of interest: none declared.

REFERENCES

Ahmed,S.A. et a]. (2012) Genomic comparison of Escherichia coli OlO4:H4 isolates
from 2009 and 2011 reveals plasmid, and prophage heterogeneity, including
shiga toxin encoding phage stx2. PLoS One, 7, e48228.

Brady,A. and Salzberg,S. (2011) PhymmBL expanded: conﬁdence scores, custom
databases, parallelization and more. Nat. Methods, 8, 367.

Diaz,N.N. et a]. (2009) TACOA: taxonomic classiﬁcation of environmental gen—
omic fragments using a kernelized nearest neighbor approach. BMC
Bioinformatics, 10, 56.

Fox,J.L. (2012) Biosurveillance plan unveiled. Nat. Biotechnol, 30, 1014.

Francis,O.E. et a]. (2013) Pathoscope: species identiﬁcation and strain attribution
with unassembled sequencing data. Genome Res., 23, 172171729.

Goris,J. et a]. (2007) DNA—DNA hybridization values and their relation—
ship to whole—genome sequence similarities. Int. J. Syst. Evol. Microbiol, 57,
81791.

Huson,D.H. et a]. (2007) MEGAN analysis of metagenomic data. Genome Res., 17,
3777386.

Huttenhower,C. et a]. (2012) Structure, function and diversity of the healthy human
microbiome. Nature, 486, 2077214.

Langmead,B. and Salzberg,S.L. (2012) Fast gapped—read alignment with Bowtie 2.
Nat. Methods, 9, 3577359.

Li,H. et a]. (2009) The sequence alignment/map format and SAMtools.
Bioinformatics, 25, 207872079.

Lindner,M.S. and Renard,B.Y. (2013) Metagenomic abundance estimation and
diagnostic testing on species level. Nucleic Acids Res., 41, e10.

Liu,B. et a]. (2011) Accurate and fast estimation of taxonomic proﬁles from meta—
genomic shotgun sequences. BMC Genomics, 12 (Suppl 2), S4.

Loman,N.J. et a]. (2012) Performance comparison of benchtop high—throughput
sequencing platforms. Nat. Biotechnol, 30, 4344139.

Methé,B.A. et a]. (2012) A framework for human microbiome research. Nature, 486,
2157221.

Monzoorul Haque,M. et a]. (2009) SOrt—ITEMS: Sequence orthology based
approach for improved taxonomic estimation of metagenomic sequences.
Bioinformatics, 25, 172271730.

Nocedal,J. and Wright,S.J. (2006) Numerical Optimization. Springer series in oper—
ations research, New York, Springer.

Pacheco,P.S. (2011) An Introduction to Parallel Programming. Morgan Kaufmann,
Amsterdam.

Patil,K.R. et a]. (2011) Taxonomic metagenome sequence assignment with struc—
tured output models. Nat. Methods, 8, 1917192.

Pruitt,K.D. et a]. (2012) NCBI Reference Sequences (RefSeq): current status, new
features and genome annotation policy. Nucleic Acids Res., 40, D1307D135.

Richter,D.C. et a]. (2008) MetaSim: a sequencing simulator for genomics and
metagenomics. PLoS one, 3, e3373.

Rosen,G. et a]. (2008) Metagenome fragment classiﬁcation using N—mer frequency
proﬁles. Adv. Bioinf., 2008, 205969.

Rubino,S., Cappuccinelli,P. and Kelvin,D.J. (2011) Escherichia coli (STEC) sero—
type 0104 outbreak causing haemolytic syndrome (HUS) in Germany and
France. J. Infect. Dev. Ctrie.s., 5, 4374140.

Segata,N. et a]. (2012) Metagenomic microbial community proﬁling using unique
clade—speciﬁc marker genes. Nat. Methods, 9, 8117814.

Wachter,A. and Biegler,L.T. (2006) On the implementation of an interior—point
ﬁlter line—search algorithm for large—scale nonlinear programming. Math.
Program., 106, 25757.

Wagner,M.M., Moore,A.W. and Aryel,R.M. (2006) Handbook of biosurveillance.
Academic Press, Amsterdam.

Wu,M. and Scott,A.J. (2012) Phylogenomic analysis of bacterial and archaeal
sequences with AMPHORA2. Bioinformatics, 28, 103371034.

Xia,L.C. et a]. (2011) Accurate genome relative abundance estimation based on
shotgun metagenomic reads. PLoS One, 6, e27992.

 

177

112 /310's112u1n0[p101x0'so1112111101u101q//:d11q 111011 papaolumoq

91oz ‘0g1sn8nv 110 ::

