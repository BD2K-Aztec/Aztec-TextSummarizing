Bioinformatics, 2016, 1—8

doi: 10.1093/bioinformatics/btw346

Advance Access Publication Date: 13 June 2016
Original Paper

 

Sequence analysis

Unbiased probabilistic taxonomic classification
for DNA barcoding

Panu Somervuo1'*, Sonja Koskela1, Juho Pennanen1, R. Henrik Nilsson2
and Otso Ovaskainen1'3

1Department of Biosciences, University of Helsinki, Helsinki, Finland, 2Department of Biological and Environmental
Sciences, University of Gothenburg, Gothenburg, Sweden and 3Centre for Biodiversity Dynamics, Department of
Biology, Norwegian University of Science and Technology, Trondheim, Norway

*To whom correspondence should be addressed.
Associate Editor: John Hancock

Received on September 15, 2015; revised on May 26, 2016; accepted on May 27,2016

Abstract

Motivation: When targeted to a barcoding region, high—throughput sequencing can be used to
identify species or operational taxonomical units from environmental samples, and thus to study
the diversity and structure of species communities. Although there are many methods which pro—
vide confidence scores for assigning taxonomic affiliations, it is not straightforward to translate
these values to unbiased probabilities. We present a probabilistic method for taxonomical classifi—
cation (PROTAX) of DNA sequences. Given a pre—defined taxonomical tree structure that is partially
populated by reference sequences, PROTAX decomposes the probability of one to the set of all
possible outcomes. PROTAX accounts for species that are present in the taxonomy but that do not
have reference sequences, the possibility of unknown taxonomical units, as well as mislabeled ref—
erence sequences. PROTAX is based on a statistical multinomial regression model, and it can util—
ize any kind of sequence similarity measures or the outputs of other classifiers as predictors.
Results: We demonstrate the performance of PROTAX by using as predictors the output from BLAST,
the phylogenetic classification software TIPP, and the RDP classifier. We show that PROTAX improves
the predictions of the baseline implementations of TIPP and RDP classifiers, and that it is able to com—
bine complementary information provided by BLAST and TIFF, resulting in accurate and unbiased
classifications even with very challenging cases such as 50% mislabeling of reference sequences.
Availability and implementation: Perl/R implementation of PROTAX is available at http://www.hel
sinki.fi/science/metapop/Software.htm.

Contact: panu.somervuo@helsinki.fi

Supplementary information: Supplementary data are available at Bioinformatics online.

 

 

1 Introduction

DNA barcoding has gained much interest in recent years, the
Barcode of Life project (Sarkar and Trizna, 2011) being the most
widespread endeavour in this field. The great promise of barcoding
approaches is that in principle any organism can be identified from a
tissue (or other biological) sample. To be effective and practical,
barcoding genes should have sufficient variation between species,
but limited variation within species, to provide the necessary signal

for species-level identification. Commonly used barcoding genes in-
clude COI in animals, ITS in fungi, and rbcL as well as niatK in
plants (Hebert et (11., 2003; Hollingsworth et (11., 2009; Schoch
et (11., 2012). Barcoding approaches are particularly powerful when
combined with next-generation sequencing (NGS) methods, which
can be used to produce massive amounts of sequence data from en-
vironmental samples (Wall et (11., 2009). That way, entire species
communities can be profiled for taxonomic affiliations.

(C7 The Author 2016. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com l

/310‘srcumo[p10}xo‘soucuHOJIItotq/ﬁdnq

Ham (7/ LIL, 2011

Schloss
(7/ LIL, 2009 (lapoi‘aso (7/ LIL, 2010

11uson (7/ LIL, 2007

chata (7/ LIL, 2012
Kiclbasa (7/ LIL, 2011
Di‘ogc (7/ LIL, 2015
Brad) and Salzbcrg, 2009
Sunagawa (7/ LIL,
2013 Edd}, 2011
Ngt1}011 (7/ LIL,
2014
W’ang (7/ LIL, 2007

Luo (7/ LIL, 2014

\X’ood and Salzbcrg, 2014
()uuit (7/ LIL, 2015

Austcrlitz
(7/ LIL, 2009 Bazinct and Cummings, 2012

Ross (7/ LIL, 2008

()mskaincn (7/ LIL,
2010

Figure 1

 

Nilsson (7/ LIL, 2012

d o be
identiﬁed

Sequence data with
taxonomic labels
and their reliabilities

/310'S[BIIJHO[pJOJXO'SOTJ’BLUJOJIITOTCI”Zduq

Fiourc 2

55,2kgogmoddmmowoio~&o:~=£¢o~m\

 

Eq.1

P.Somervuo et al.

 

species belonging to each of the known branches. If the branch does
not contain any sequence data, the row of the design matrix is set to
(1, 0, 0, 0), and thus the regression coefficient [3’1 models the prob—
ability (relative to a missing branch) that the species belongs to a
node that is included in the taxonomy but for which no reference se—
quences are available. For branches for which one or more reference
sequences are available, the row of the design matrix is set to
(0, 1, 51,52), where 51 and 52 are respectively the mean and the max—
imal sequence similarity between the query sequence and a represen—
tative subset (see Supplementary Material) of reference sequences
under the node. The mean 51 is first averaged over the sequences for
each species, then over the species within each genus, and so on, al—
ways averaging over all units for which at least one sequence is
available. Thus the regression coefficients [3,2,1313 and [32 model the
probability by which the query sequence belongs to a node with ref—
erence sequences with a given mean and maximal similarity. The
reason for including not only maximal similarity but also mean simi—
larity is that the latter is expected to be more robust to mislabeling
error.

As the second example, denoted by PROTAX(TIPP), we con—
struct the predictors using the classification provided by TIPP, with
three predictors (m : 3). In this case the first row (i: 0) of the de—
sign matrix is (0, 0, 0), and rows for branches not containing se—
quence data are set to (1, 0, 0). The remaining rows are (0,1,53),
where 53 : logit(e + (1 — 2e)p), where p is the probability predicted
by TIPP, logit(p) : log(p/(1 — 17)), and we have set the parameter 8
: 0.001 to avoid singular cases related to classifications with p: 0
and p : 1. Similarly as with PROTAX(TIPP), we also construct the
predictors for the output of RDP classifier.

As a fourth example, denoted by PROTAX(BLAST+TIPP), we
utilize the predictors s1, 52 and 53 for nodes with reference sequences,
thus ending up to a model with five predictors (m : 5).

2.3 Generation of training data
As PROTAX aims to estimate the probabilities of all possible out—
comes for query sequences derived from environmental data, the
training data should be constructed in such a way that they represent
the expected species diversity in the environmental data. In the con—
text of Bayesian analysis, information about the expected species di—
versity can be incorporated as a prior. The prior is constructed by
listing all the possible outcomes associated with the taxonomical
tree, and giving each outcome a prior probability. Training data can
then be generated by first randomizing the desired outcome from the
prior, and then generating data that mimic the chosen outcome (see
below). The prior that we assume here corresponds to the assump—
tion that it is equally likely that the environmental sequence belongs
to any node at each level, including the possibility of an unknown
branch. Thus, if the taxonomy involves e.g. two genera in a given
family, we assume that conditionally on the species belonging to this
family, it belongs to either genera with probability 1/3, and to an un—
known genus under this family with the remaining probability 1/3.
Applying this algorithm recursively generates prior probabilities for
each possible outcome, and these prior probabilities sum to unity.
Ideal training data would consist of sequences that would repre—
sent all outcomes and that would be independent of the sequences
present in the reference database. While such sequences could be
generated in a simulation study, they will not be available with real
data (e.g. sequences that represent species unknown to science, or se—
quences that represent known species without reference sequences).
Thus, we attempt to mimic ideal training data as closely as possible.

Exactly how this is done depends on the nature of the outcome to be
mimicked, for which there are the following three possibilities.

The outcome is a known species with at least one reference se-
quence available. In this case ideal training data would be an add—
itional query sequence of that species. If the species has at least two
reference sequences, we used a randomly selected sequence as the
query sequence, and left the other sequences to the reference data—
base. If the species has only one sequence, it is not possible to gener—
ate training data for that particular species, as no reference
sequences would remain available after taking the only sequence as
the query sequence. In this case we generated training data for an—
other outcome, which is as similar as possible to the originally
chosen one, but for which the required data are available. This other
outcome is the node which has the smallest taxonomic distance to
the original node and which is on the same taxonomic level as the
original node.

The outcome is a known species with no reference sequences
available. In this case ideal training data would be a test sequence
for the chosen species. As such data do not exist, we selected another
species which had at least one reference sequence and was as related
to the original species as possible, following the recursive algorithm
described above. We randomly selected one of the reference se—
quences as the query sequence, and removed all the other reference
sequences for that species to mimic the situation where no reference
sequences would be available.

The outcome is an unknown branch of a given node. In this case
ideal training data would be a sequence for a randomly selected spe—
cies under that node. As such data are not available, we mimicked
such a situation as follows: if the node had any branches with se—
quences, we selected randomly one of those branches, proceeded to
a randomly selected species with at least one sequence, and selected
randomly one of the sequences as the query sequence. We then
removed the entire branch under the node to generate training data
mimicking the case of a missing branch. If the originally chosen
node had no branches with sequences, we generated training data
for another node, which was at the same level as the originally
chosen node (e.g. both representing genera) and as related to the ori—
ginal node as possible (in the sense of the recursive algorithm as
described above), and which had the required data.

2.4 Evaluating the performance of the algorithm with
simulated data

We evaluated the performance of the algorithm with the help of
simulated data, including taxonomies, reference sequences and val—
idation sequences. We assumed that the taxonomy consists of two
levels, called here genus and species. We thus consider classification
within a single family, and assume that in the underlying reality it is
split to 10 genera, each of which is split to 10 species, thus yielding
100 species together. We model barcoding sequences by strings con—
sisting of 300 nucleotides (A, C, T or G). We first generated an ‘an—
cestral sequence” to the root level by assigning each nucleotide
randomly to one of the four possibilities. We generated a mutated
sequence for each genus by assuming that each nucleotide mutates
to a random one with probability 61. Similarly, we generated a se—
quence for each species by mutating each nucleotide of the genus—
level sequence with probability 62. Finally, to generate multiple se—
quences for each species, we mutated the nucleotides of the species—
level sequences with probability E3. The first 50 nucleotides were
assumed to form a conserved region, and they were thus kept identi—
cal for all sequences.

ﬁm'srcumot‘pquo'soptzuuowtotq/ﬁdnq

Unbiased probabilistic taxonomic classification

 

We tested the algorithm with eight case studies summarized in
Supplementary Table 51. Case 1 was chosen as an easy starting
point in which sequence identification should be successful to the
species level. In this case, we assume that all species were known to
science and thus included in the taxonomy, and that 4 sequences
were available for all species, and that none of the sequences were
mislabeled. The levels of sequence dissimilarity were set to
e1 : 0.05, 62 : 0.02, 63 : 0.01, and thus we assumed larger differ—
ences among genera than among species within a genus, and larger
differences among species within a genus than among individuals
within a species.

The remaining cases are derived from Case 1 by changing some
of the parameters. In Case 2 we made the classification more diffi—
cult by setting 61 : 62 : E3, : 0.01, and thus having only small dif—
ferences among genera and species. Case 3 is otherwise identical to
Case 1, but reference sequences are available only for the fraction
P : 0.5 of all species. Cases 4 and 5 differ from Case 3 in that we as—
sume that 20% (q : 0.2) or 50% (q : 0.5) of the sequences are mis—
labeled, respectively. Case 6 differs from Case 3 in that only 7 out of
the 10 genera are assumed to be known to science, and that within
each known genus only 7 out of the 10 species are assumed to be
known to science. Thus in this case the taxonomy file consists of 49
species while the underlying reality still consists of the full set of 100
species. Case 7 is otherwise as Case 3 but the level of sequence simi—
larity is assumed to vary within the taxonomical tree: when generat—
ing the mutations for a given node at level I, we randomized the
level of sequence dissimilarity using a uniform distribution in the
range (0,2.E[), so that the mean mutation probability is E]. The mo—
tivation for this case is that while such variation in sequence similar—
ity is present in real taxonomies, the statistical model ignores it.
Finally, Case 8 combines the aspects of Case 4 (mislabeled reference
sequences), Case 6 (incomplete taxonomy) and Case 7 (heterogen—
eity in levels of sequence similarity) that are expected to make taxo—
nomic classification difficult in the case of real data.

For each of these eight cases, we simulated 5 independent repli—
cates of the taxonomy and the reference database, as well as 100 in—
dependent validation sequences, one for each species. We generated
training data with 1000 data points for each of the four PROTAX
models (BLAST, TIPP, RDP classifier and BLAST +TIPP), and used
the MAP (maximum a posterior) parameter estimate for classifica—
tion. We performed a full classification of the validation sequences
by decomposing the probability of one among all possible outcomes
of the taxonomic tree. We selected the outcome with the highest
probability, and examined if it was the correct one, i.e. if it matched
with the species behind the generated validation sequence. We as—
sessed the accuracy and bias of the classifications by plotting the cu—
mulative predicted probabilities against the cumulative number of
cases in which the outcome with the highest probability was correct.
Concerning a possible bias, if an outcome is assigned e.g. the prob—
ability 0.9, it should be correct in 90% of the cases and wrong in
10% of the cases. If in reality the answer would be correct, say in
5 0% or in 99% of the cases, the assessment of classification reliabil—
ity is biased. An unbiased classification is accurate if it assigns high
probabilities to some outcomes and low to others, while it is not ac—
curate if it assigns equally low probabilities for all outcomes. For ex—
ample, if the algorithm would return just the prior probabilities, it
would be unbiased, but not accurate.

While we predicted the probabilities separately for each possible
outcome, we pooled some of them before comparing to the true spe—
cies identity in the validation data. The reason here is that if a genus
has several species with no reference sequences, the classification
probabilities for these outcomes are necessarily identical. Thus we

summed these to obtain a single probability for the outcome being
any species within a particular genus with no reference sequences.
Further, we added to this prediction the probability of the sequence
belonging to an unknown species of that genus, and thus the pooled
outcome was ‘an unknown species within this genus, or one of the
species in this genus without reference sequences”.

To compare the performance of the PROTAX models with the
baseline implementations of the TIPP and RDP classifiers, we per—
formed sequence classification with these (without the PROTAX ex—
tension) and assessed the bias and accuracy in the same way as we
did for the PROTAX models.

2.5 Singling out mislabeled reference sequences

In addition to identifying environmental sequences (mimicked
above by the validation sequences), the fitted model can be used
to single out mislabeled reference sequences by treating the
reference sequences as test sequences, and by comparing the proba—
bilities of the outcomes to the species label. While making such pre—
dictions, the sequence to be classified is removed from the set of
reference sequences to avoid circular results due to the 100% match
to itself.

We considered a reference sequence as inconsistent if the model
predicted a wrong genus with high confidence. To be conservative,
we required the probability of the most likely classification to be at
least 100 times the probability of the outcome corresponding to the
species label. We examined how well this heuristic approach per—
formed by counting the fraction of truly mislabeled sequences that
were classified as inconsistent (in the optimal case this would be
one), as well as the fraction of correctly labeled sequences that were
classified as inconsistent (in the optimal case this would be zero).
We did this test for the three PROTAX models as well as the base—
line TIPP model.

2.6 Case study of Polyporales of Finland

For the evaluation of the method with real data, we used a data—
base consisting of ITS sequences of all Polyporales (one fungal
order) species of Finland available through UNITE (Kéljalg et al.,
2013). We used a two—level taxonomy consisting of the genus and
species levels. Our database involves 265 known species in 75 gen—
era, and 336 ITS sequences that belong to 162 species in 58 genera.
Sequence lengths vary between 502 and 972 bp, mean length being
688 bp. In addition to 103 species without any reference sequences,
more than half (89/162) of the species with sequence information
contained only one reference sequence. We computed pairwise se—
quence similarities with BLAST, as detailed in the Supplementary
Material.

Unlike with simulated data, with real data there are no valid—
ation sequences for which the species identity would be known with
full certainty. Thus, we tested the performance of the fitted model
by identifying each of the reference sequences against the database
from which the focal sequence was excluded. We then assessed the
performance of the model like we did with simulated data, with the
assumption that the query sequences were not mislabeled. Thus, our
assessments of the model’s identification success are likely to be con—
servative. We compared the performances between TIPP, RDP clas—
sifier, and the four versions of PROTAX as with simulated data. In
addition, we constructed PROTAX for the full combination where
BLAST, TIPP and RDP classifier were used as predictors in the same
model.

ﬁm'srcumot‘pquo'soptzuuowtotq/ﬁdnq

Figure 3

Supplementary Material

Fig. 3

Fig. 3
Supplementary Figs S2 and S4

Supplementary Table S1

Fig. 3

Supplementary Fig. S7

Supplementary Fig. S8

Supplementary Fig. S8
Supplementary Fig. S7

Figure 4

 

/310'S[EUm0prOJXO'SOIJEIIIJOJIIIOIq/ﬂduq

 

 

 

 

 

 

 

 

 

 

 

 

 

 

Kielbasa at al., 2011

55,2\Ewogmoddmmowoio~&o:~=£¢o~m\

P.Somervuo et al.

 

Luo,C. et al. (2014) MyTaxa: an advanced taxonomic classiﬁer for genomic
and metagenomic sequences. Nucleic Acids Res., 42, e73.

Nilsson,R. et al. (2012) Five simple guidelines for establishing basic authenti-
city and reliability of newly generated fungal ITS sequences. MycoKeys, 4,
37—63.

Nguyen,N. et al. (2014) TIPP: taxonomic identiﬁcation and phylogenetic
proﬁling. Bioinformatics, 30, 3548—3555.

Ounit,R. et al. (2015) CLARK: fast and accurate classiﬁcation of metagenomic
and genomic sequences using discriminative k-mers. BMC Genomics, 16, 23 6.

Ovaskainen,O. et al. (2010) Identifying wood-inhabiting fungi with 454
sequencing — what is the probability that BLAST gives the correct species.
Fungal Ecol., 3, 274—283.

Ross,H. et al. (2008) Testing the reliability of genetic methods of species iden-
tiﬁcation via simulation. Syst. Biol., 57, 216—230.

Sarkar,I.N. and Trizna,M. (2011) The Barcode of Life data portal: bridging
the biodiversity informatics divide for DNA barcoding. PLOS ONE, 6,
e146 89.

Schloss,P. et al. (2009) Introducing mothur: open-source, platform-independ-
ent, community-supported software for describing and comparing microbial
communities. Appl. Environ. Microhiol., 75, 7537—7541.

Schoch,C. et al. (2012) Nuclear ribosomal internal transcribed spacer (ITS) re-
gion as a universal DNA barcode marker for fungi. Proc. Natl. Acad. Sci. U.
S. A., 109, 6241—6246.

Segata,N. et al. (2012) Metagenomic microbial community proﬁling using
unique clade-speciﬁc marker genes. Nat. Methods, 9, 811—814.

Sunagawa,S. et al. (2013) Metagenomic species proﬁling using universal
phylogenetic marker genes. Nat. Methods, 10, 1196—1199.

Wall,P. et al. (2009) Comparison of next generation sequencing technologies
for transcriptome characterization. BMC Genomics, 10, 347.

Wang,Q. et al. (2007) Nai've Bayesian classiﬁer for rapid assignment of rRNA
sequences into the new bacterial taxonomy. Appl. Environ. Microhi01., 73,
5261—5267.

Wood,D. and Salzberg,S. (2014) Kraken: ultrafast metagenomic sequence
classiﬁcation using exact alignments. Genome Biol., 15, R46.

/810'sreumofploqxo"soueuuoqutotqﬂ:duq

