Bioinformatics, 32112), 2016, 1779—1787

doi: 10.1093/bioinformatics/btw040

Advance Access Publication Date: 1 February 2016
Original Paper

 

Sequence analysis

Optimization of alignment-based methods for
taxonomic binning of metagenomics reads

Magali Jaillard1'2'*"‘, Maud Tournoud”, Faustine Meynier3 and
Jean-Baptiste Veyrieras1

1Bioinformatics Research Department, bioMerieux, Marcy L'etoile 69280, France, ZLBBE, UMR CNRS 5558
University Lyon 1, Villeurbanne F-69622, France and 3Biomathematics System Development, bioMerieux, Marcy
L'etoile 69280, France

*To whom correspondence should be addressed.
TThe authors wish it to be known that, in their opinion, the first two authors should be regarded as joint First Authors.
Associate Editor: Dr. John Hancock

Received on 4 August 2015; revised on 8 December 2015; accepted on 19 January 2016

Abstract

Motivation: Alignment—based taxonomic binning for metagenome characterization proceeds in
two steps: reads mapping against a reference database (RDB) and taxonomic assignment accord—
ing to the best hits. Beyond the sequencing technology and the completeness ofthe RDB, selecting
the optimal configuration of the workflow, in particular the mapper parameters and the best hit se—
lection threshold, to get the highest binning performance remains quite empirical.

Results: We developed a statistical framework to perform such optimization at a minimal computa—
tional cost. Using an optimization experimental design and simulated datasets for three sequenc—
ing technologies, we built accurate prediction models for five performance indicators and then
derived the parameter configuration providing the optimal performance. Whatever the mapper
and the dataset, we observed that the optimal configuration yielded better performance than the
default configuration and that the best hit selection threshold had a large impact on performance.
Finally, on a reference dataset from the Human Microbiome Project, we confirmed that the opti—
mized configuration increased the performance compared with the default configuration.
Availability and implementation: Not applicable.

Contact: magali.dancette@biomerieux.com

Supplementary information: Supplementary data are available at Bioinformatics online.

 

1 Introduction

 

Metagenomics is the study of the DNA content of a sample particu-
larly powerful to recover complex mix of organisms, including those
difficult to isolate by standard techniques (Hugenholtz et (11., 2002;
Padmanabhan et (11., 2013). In the last decade, the advent of next
generation sequencing (NGS) technologies has quickly shifted meta-
genomics approaches from low-scale studies to large-scale investiga-
tions, thereby creating a need for improvement and development of
specific bioinformatic methods. Taxonomic profiling and taxonomic
binning are popular methods to assess the taxonomic diversity of a
sequenced sample (Drége et (11., 2015). Taxonomic profiling meth-
ods aim to estimate the relative abundance of each taxon in the

sample by classifying reads using a set of marker-genes specific to
each taxonomic clade (Liu et (11., 2010; Segata et (11., 2012;
Sunagawa et (11., 2013) or based on their k-mer composition
(Koslicki et (11., 2014). Taxonomic binning methods aim to assign
each individual read to a given taxon within the microbial tax-
onomy. They are not as fast as taxonomic profiling methods to gen-
erate a taxonomic profile. Nevertheless reads binning is a
mandatory step for subsequent analysis that require draft genome
reconstruction (Droge et (11., 2015).

Taxonomic binning algorithms are based either on read alignment
strategies or on compositional approaches (such as nucleotide k-mer
frequencies), or possibly on a mixture of these two approaches

(63 The Author 2016. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com 1779

/310‘srcumo[p10}xo‘sopcuHOJIItotq/ﬁdnq

1780

M.Jaillard et al.

 

(Mande et al., 2012). In this article, we focused on alignment—based
taxonomic binning methods, whose principle was introduced by
Huson et al. (2007). Such methods proceed generally in two steps.
First, reads are aligned against a reference database (RDB). Then, for
each read, the lowest common ancestor (LCA) among the best hits is
retrieved. To this end, a threshold is applied to select only hits whose
scores lie within a percentage of the best hit score.

Several evaluation studies have been published that compare
mapper performance for resequencing applications (Bfinda et al.,
2015; Caboche et al., 2014; Hatem et al., 2013; Holtgrewe et al.,
2011; Schbath et al., 2012; Ruffalo et al., 2011). However, in the
context of taxonomic binning, there is still no consensus on which
mapper and configuration to use. The most comprehensive study to
date was performed in the context of the Human Microbiome
Project (HMP), where Martin et al. (2012) compared six mappers
and optimized the parameters for the best mapper, CLC (CLCbio
website: http://www.clcbio.com), by testing six combinations of two
parameter values.

Beyond the NGS technology (e.g. read length, sequencing error
profile) and the completeness of the RDB, taxonomic binning per—
formance depends on the mapper configuration and the taxonomic
assignment strategy. Mappers can have many parameters (e.g. more
than 15 alignment and score parameters for Bowtie2), some being
numerical and other categorical (often with many levels). It is nearly
impossible to evaluate the performance of all parameter configur—
ations to identify the best one. Here, we present a statistical frame—
work to efficiently select the optimal configuration (mapper
parameters and best hit threshold for LCA calculation) which maxi—
mizes taxonomic binning performance for a given NGS technology
and level of RDB completeness. We relied on the design of experi—
ments (DOE) methodology (NIST/SEMATECH e—Handbook of
Statistical Methods, http://www.itl.nist.gov/div898/handbook/,
2015—07—14) to reduce the number of configurations to run while
still efficiently analyzing the parameter space. This optimization
strategy could be adapted to any NGS technology, applied to differ—
ent mappers and adjusted according to the targeted microbial com—
plexity and distinct levels of the RDB completeness.

2 Materials and methods

As previously stated, our objective was to find the optimal param—
eter configuration for a set of sequencing technologies and mappers.
To fulfill this objective, we implemented the two following steps:
first, we screened the parameters expected to have the largest effect
on the pipeline performance, and then we optimized the values of
the selected parameters to select the pipeline configuration leading
to the best performance. The first screening step was mandatory be—
cause optimization studies can only be performed on a limited num—
ber of factors (or parameters). In this step, we relied on previously
published studies to select the most influential parameters and re—
duce the number of parameters to optimize up to five. Then, we
used an optimization experimental design to find the optimal par—
ameter configuration. As detailed later, the advantage of the experi—
mental design is to identify the optimal configuration at a minimal
computation cost.

2.1 Screening pipeline parameters

2.1.1 Mappers

Four mappers were included in this study: BWA—backtrack (Li and
Durbin, 2009) (version 0.7.4), BWA—MEM (Li, 2012) (version
0.7.4), Bowtie2 (Langmead and Salzberg, 2012) (version 2.1.0) and

TMAP (The Ion Torrent flow sequence mapping, see https://github.
com/iontorrent/T MAP) (version 3.0.1). Mappers from the BWA
suite include around 20 parameters, mostly integer and Boolean. In
addition to >15 alignment and scoring parameters, Bowtie2 offers
eight preset modes for fast, sensitive, local or end—to—end mapping.
TMAP, which embeds four mappers, is fully customizable with >50
numerical parameters and >20 categorical parameters.

To reduce the parameter space, we selected parameters expected
to have the largest effect on the taxonomic binning performance.
This selection was based on mapper documentation and previously
published benchmarks (Hatem et al., 2013). We targeted parameters
typically controlling the seed characteristics, the clipping or the
alignment effort. Briefly, the parameters evaluated for BWA—MEM
were minimum seed length (s.lengt/a), off—diagonal X—dropoff
(zdropoff), trigger reseeding (rseedJengt/a), the clipping penalty
(clipping), for TMAP: score threshold (score), soft—clipping (clip-
ping), mapping sequence (mode), for Bowtie2: seed length (slengt/a),
number of errors in the seed (s.error), number of consecutive seed
extensions (effort), local or end—to—end mode (mode) and for BWA—
backtrack: iterative search (iterative), fraction of missing alignments
(alignerror), maximal edit distance in the seed (s.error) and seed
length (slengt/a). For each quantitative parameter, we selected lower
and upper values based on the mapper documentation but default
mapper parameters were also evaluated. For each mapper, the par—
ameters, their corresponding option in the software, the tested val—
ues (lower, default and upper values for quantitative parameters and
levels for qualitative parameters) are presented in Supplementary
Table 52.

2.1.2 Best hit selection threshold

For each hit / obtained by mapping read i against the RDB, an align—
ment quality score AS,, was defined as the alignment length minus
the edit distance. This score was calculated for each read independ—
ently and was not used to compare hits from different reads. Both
values could be found in the SAM output (Li and Durbin, 2009) irre—
spective to the mapper.

Then for each read i, a hit / was retained as a candidate for LCA
calculation if AS”- 2 (1 — bestHit) * max/AS”, with bestHit a thresh—
old parameter in [0;1]. When bestHit: 0 only the best hits (includ—
ing ties) were retained, and when bestHit: 1, all hits were
considered as best hits and retained for the LCA calculation. bestHit
was included in our study as the model parameter controlling for the
best hit selection; the three tested values for the bestHit threshold
parameter were: bestHit : 0. 0.25. 0.5.

2.2 Optimization plan

The objective of this study was to find the optimal pipeline configur—
ation for each mapper. However, running the pipeline for all the com—
binations of the selected mapper parameters and the bestHit values
was not feasible, motivating the use of an experimental plan. Indeed,
an optimal experimental design ensures to find the best configuration
in a minimum number of experiments. In this application, an experi—
ment was a run of the pipeline with a set of parameters and the out—
come to optimize was the pipeline performance. The set of
experiments to perform are given by the experimental plan. There
exists several optimization plans, with different assumptions for the
nature of the parameter effects (linear or quadratic) and interactions,
and thus leading to different number of experiments. Given that we
wanted to evaluate the optimal configurations for four mappers
(BWA—backtrack, BWA—MEM, TMAP and Bowtie2) and three
sequencing technologies (Roche 454, IT PGM, Illumina HiSeq), we

[310'sp2umofp105xo'sopeuHOJIItotq/ﬁdnq

Taxonomic binning optimization

1781

 

had to make two reasonable assumptions to limit the number of ex—
periments to perform: linear effect of parameters and negligible inter—
actions. Given these assumptions, we chose a Hadamard design. This
design relies on a Hadamard matrix, which is an orthogonal matrix
with all elements equal either to —1 or+ 1, such that HHT : 111”,
where 1,, is the n X 11 identity matrix. This design ensures that the vari—
ance of the estimators for the parameter effects are minimal. Plackett
and Burman (1946) proposed an algorithm to generate the Hadamard
design for a given number of factors. In practice, we used the
Nemrodw software (http://www.nemrodw.com) to generate automat—
ically all the Hadamard designs. The —1/+ 1 values in the Hadarmard
matrix were replaced by the lower and upper bounds of the interval
considered for each factor. Table 1 presents the Hadamard design
used for BWA—MEM; each line corresponds to an experiment, i.e. to
a configuration of the pipeline with the values of each parameter
(BWA—MEM parameters and bestHit parameter), the original —1/+ 1
values are mentioned into brackets. It should be noted that
Hadamard designs are also frequently used as screening designs when
the number of parameters to screen is very large.

The Hadamard experimental plans for BWA—backtrack, TMAP
and Bowtie2 are given in Supplementary Tables S3—SS. Without the
experimental plan, testing all the parameter combinations would
have led to 162, 243, 216 and 81 experiments while 18, 9, 40 and
45 experiments were tested for, respectively, BWA—backtrack,
BWA—MEM, Bowtie2 and TMAP, leading thus to a total of 112 ex—
periments. In practice, these 112 experiments were run on each of
the three simulated small studies (Roche 454, IT PGM, Illumina
HiSeq, see Section 3). As detailed in Section 2.3, models were built
from the performance observed in these experiments, then these
models were used to predict the best pipeline configuration for each
mapper and each dataset.

2.3 Performance prediction

2.3.1 Read categories and performance indicators

The completeness of the RDB depends on the application. For in—
stance, pathogenic bacteria present in bronchoalveolar lavage sam—
ple from patients in intensive care unit are very likely to have at least
one genome of their species available in the RDB. On the other
hand, species found in environmental samples such as those found in
marine ecosystems may have no RDB representation (Magasin and
Gerloff, 2015; Yang et al., 2015).

To cover different levels of RDB completeness, we defined three
read categories. (i) Non-stringent, where the genome from which the
read derives was present in the RDB, (ii) Reachable, where the gen—
ome was absent from the RDB, however the RDB included at least
two genomes of the same species. (iii) Unreac/aable, where the

Table 1. Experimental plan for BWA-MEM

 

Run s.length zdropoff reseed. length clipping bestHit

 

1 19(—1) 80(—1) O.5(—1) 7(+1) O(—1)
2 27(+1) 80(—1) O.5(—1) 3(—1) O.5(+1)
3 27(+1) 120 (+1) 0.5 (—1) 3(—1) O(—1)
4 19(—1) 120 (+1) 1.5 (+1) 3(—1) O(—1)
5 27(+1) 80(—1) 1.5 (+1) 7(+1) O(—1)
6 19(—1) 120 (+1) 0.5 (—1) 7(+1) O.5(+1)
7 19(—1) 80(—1) 1.5(+1) 3(—1) O.5(+1)
8 27(+1) 120 (+1) 1.5 (+1) 7(+1) O.5(+1)
9 23(0) 100(0) 1(0) 5(0) 0.25 (O)

 

Figures within brackets correspond to the 71/+ 1 values in the correspond—
ing Hadarmard matrix.

genome was absent from the RDB and the RDB did not include any
genome of the same species. Therefore, the best possible prediction
for an unreachable read was the LCA among the closest genomes
present in the RDB (Supplementary Fig. 51).

Considering these three read categories, we introduced five per—
formance indicators: (i) the proportion of mapped reads, (ii) the pro—
portion of non—stringent mapped reads mapped at the correct position
along the correct genome sequence, (iii) the pipeline running time, (iv)
the proportion of mapped reachable reads correctly predicted at the
species rank, abbreviated ‘reachable’ thereafter, (v) the proportion of
mapped unreachable reads correctly predicted at the expected rank or
at a higher rank (i.e. the predicted taxon should be the best possible
prediction or any taxon among its parents), abbreviated ‘unreachable’
thereafter. The first three indicators referred to the intrinsic quality of
the mapper, while the other two indicators evaluated the performance
of the Whole taxonomic binning pipeline.

2.3.2 Models

For each mapper, the taxonomic binning pipeline was run for all the
configurations given by the experimental plan of the mapper. For
example, BWA—MEM pipeline was run for the nine configurations
described in Table 1. The five individual performance indicators
described earlier were computed from the outputs of each pipeline
run. Then the performance indicators were modeled using logistic
and Weibull regression models. The logistic model (McCullagh and
Nelder, 1989) was used for proportion performance indicators
(lying in [0;1j), and the Weibull model (Kalbfleisch and Prentice,
2011) was used for the running time. A linear effect for all the con—
tinuous covariates was assumed without interaction. For instance,
the following logistic model was used to study the effect of param—
eters and to predict the proportion of reads mapped with BWA—
MEM: logit(pi) : [30 + [31 X slengt/ai + [32 X zdropoff, + [33 X re—seed.
length, + [34 X clippingi+ [35 X bestHiti, with i : 1  9, with p, the
observed proportion of mapped reads, slengt/ai the seed length
value, zdropofﬁ the off—diagonal X—dropoff value, reseedlengt/ai the
trigger reseeding, clipping, the clipping penalty and bestHit, the best
hits threshold value in the i’h, ': (1 . . . 9) row of the BWA—MEM
experimental plan (Table 1).

2.3.3 Optimal mapper configuration

Using the previous models, it was then possible to predict each per—
formance indicator, for any combination of the values of the param—
eters. For example, using the BWA—MEM mapper, the proportion of
mapped reads can be predicted for slengt/a : 23, zdropoff: 80,
reseedJengt/a : 1, clipping25 and bestHit: 0 (although this pipe—
line configuration was not included in the experimental plan): pro—
portion mapped : exp(ﬂ))/(1 + exp(ﬂ))), with it : lie + [fl >< 23+
[fl >< 80+[f3 >< 1+1?4 ><23+lf§ ><5+l§6 ><0andl§0 tolié, thepar—
ameters of the fitted logistic model for the proportion of mapped
reads. In practice, the performance indicators were predicted for all
the combinations of the parameter values presented in
Supplementary Table 52.

Then, to have a single indicator which acts as a compromise be—
tween the five individual performance indicators, we defined a com—
posite performance indicator (CPI) as a weighted sum of the
individual performance indicators. Since read indicators had values
in [0; 1], to compute the CPI we standardized the running time with
the minimum taken over all predicted running times for a given
mapper: std.time : min(time)/time.

Finally, we retained three parameter configurations: the ‘best’,
maximizing the CPI, the ‘worst’, minimizing the CPI and the

[BJO'SWHIHOIPJOJXO'SOplZIIJJOJLItOIQ/[idnq

S2

Supplementary Data

Martin et al. (2012

Supplementary Table

Angly et al., 2012

Martin et al., 2012

Supplementary Data

Figure1
Supplementary Figs S2
and S3
Figure2
2 o”
z o 0‘
of '5 T
. z”
.0 o
38' a o 0
’6 0 ° 0
' Q
' oﬁQ an 0"
'4" "9
2
o ..2
0 3
o
O
9
0') o
o ' if
C
.3 O
o O o
o %
O

/3.IO‘SI€III[10[p.IO}X0‘SDDEIIIJOJIIIOIQ/[Zdllq

19 23 27
80 100 120
0.5 l 15
3 5 7 -
O 0.2.r 05 I —
—I —| —I I - I—
8 12 16 I I

both right no - I i - I

complete seed sequential

O 0.2:, or - —
— —| —I I I —
20 24 28
0 1 I I I I
15 20 2 I
ETE1 ETE2 L1 L2 F I q . -
0 0.2,r 0r - —
- - —| —I I - -_
20 2: 30 I
1 2 3 -
0.04 0.00 0.08
TRUE FALSE I - -
0 0.2,r 0r I -

/3.IO'S[BIIm0[p.IOJXO'SOIJEIIIJOJIIIOIq/ﬂdnq

1784

M.Jaillard et al.

 

when the —N option was used. Decreasing the number of errors in
the seed (s.error) also decreased the mapping time.

The bestHit had no effect on the proportion of mapped reads
nor the proportion of reads mapped at the correct position because
this parameter was only used for LCA calculation after the mapping
steps. This parameter strongly impacted the performance of the
reachable and unreachable indicators. Larger bestHit values
increased the proportion of correct predictions among unreachable
reads because more mapping hits were considered for the LCA cal—
culation, and conversely decreased the proportion of correct predic—
tions among reachable reads because prediction ranks were too high
(not specific enough). Hence, no configuration maximizing all the
indicators simultaneously could be found. That explained why we
had to find a tradeoff between indicators using a weighted score.

For the smallPGM study, the impact of the mapper parameters
on performance indicators was very similar to what was observed
on the small454 study, while some specific effects were observed for
the smallHiSeq study, such as the effect of the iterative parameter on
BWA—backtrack correct positions (Supplementary Figs S4 and SS).

4.2 Configurations comparison

The best and the worst configurations as well as the default config—
uration were run for each mapper. Figure 3 presents the predicted
versus observed CPI values obtained for these three configurations.
Observed and predicted values were close, highlighting the high

 

Fig. 3. Worst, default and best configurations in the small454 study. Observed
(dashed lines) and predicted (solid lines) CPI for the worst, default and best
configurations, for each mapper

generalization ability of the prediction models, except for configur—
ations with bestHit: 0.25 (this is the case for all default scenarios),
for which the predictions are globally above the observed values.

As expected, the CPI increased from the worst, then to the de—
fault and then to the best pipeline configuration. This highlights the
ability of our method to identify configurations that improve per—
formance. The same results were observed in the smallPGM and the
smallHiSeq studies (Supplementary Figs S8 and S9). BWA—MEM
presented a small difference of CPI between the default and the best
configurations, meaning that the default parameters for BWA—MEM
were already optimal in our context.

The best configurations for the three datasets and the four map—
pers can be found in Supplementary Table S6.

4.3 Mappers comparison

Table 2 presents the predicted performance indicators for each map—
per and sequencer, obtained with the best configuration, along with
the maximum value of each performance indicator.

In the small454 study, TMAP mapped 100% of the reads, BWA—
MEM mapped more than 95% of the reads and Bowtie2 could map
a maximum of 66% of reads but the best configuration only mapped
52%. BWA—backtrack did not manage to map more than a quarter
of the reads. Indeed, BWA—backtrack was developed and optimized
to align short reads (<100 bp) and failed to map the Roche 454
simulated reads which had an average length equal to 450 bp. The
proportion of reads mapped at the correct position among mapped
non—stringent reads was close to 100% for all mappers, except for
BWA—backtrack.

As the weight of the reachable indicator was very high in the
CPI, all the mappers had a reachable indicator value close to their
maximum value for the best configuration. However, the price to
reach this maximum value was paid for at the expense of the un—
reachable indicator. This was true for all the mappers. The largest
drop was observed for TMAP, which could theoretically reach 79%
for the unreachable indicator but got 23% under the best configur—
ation. Using more balanced weights for the reachable and unreach—
able indicators would reduce this gap.

The shortest running times were obtained by BWA—backtrack
and BWA—MEM, while TMAP running time was particularly long.

Performance indicator values predicted in the smallPGM study
were close to those predicted in the small454 study. BWA—backtrack
presented better performance in the smallHiSeq study than in the

Table 2. Predicted performance indicators for the four mappers (BWA-MEM, TMAP, Bowtie2 and BWA-backtrack) and the three sequencers

(small454, smallPGM and smallHiSeq studies)

 

 

Sequencer Mapper Proportion mapped Correct position Reachable Unreachable Time (s)
Best Max Best Max Best Max Best Max Best Min
Roche 454 (450 bp) BWA-MEM 0.95 0.95 0.99 0.99 0.86 0.88 0.19 0.61 1924 1583
TMAP 1.00 1.00 0.96 0.98 0.87 0.87 0.23 0.79 10 960 10 376
Bowtie2 0.52 0.66 0.99 0.99 0.89 0.89 0.23 0.59 3468 3468
BWA-backtrack 0.24 0.25 0.64 0.64 0.85 0.85 0.34 0.61 1090 1089
IT PGM (200 bp) BWA-MEM 0.87 0.87 0.99 0.99 0.82 0.84 0.17 0.45 633 517
TMAP 1.00 1.00 0.96 0.98 0.83 0.84 0.30 0.80 3978 3266
Bowtie2 0.53 0.64 0.99 0.99 0.85 0.85 0.26 0.55 1325 1307
BWA-backtrack 0.41 0.42 0.56 0.56 0.83 0.83 0.37 0.58 376 358
Illumina Hiseq (100 bp) BWA-MEM 0.86 0.86 0.57 0.57 0.89 0.91 0.37 0.41 252 197
TMAP 0.67 1.00 0.90 0.94 0.78 0.81 0.11 0.81 1119 1119
Bowtie2 0.54 0.62 0.97 0.97 0.81 0.81 0.29 0.49 796 748
BWA-backtrack 0.54 0.54 0.96 0.99 0.79 0.79 0.40 0.54 98 98

 

‘Best’ values are obtained with the best conﬁguration, and ‘Max’ (resp. ‘Min’) are the maximum values (resp. minimum value, for the running time) predicted

for each indicator.

ﬁm'spzumol‘pmyo'sopeuuowtotq/ﬁdnq

Taxonomic binning optimization

1785

 

two other studies, with a larger predicted proportion of mapped
reads, and reads mapped at a correct position. As expected, the pre-
dicted running time decreased with the read length (Supplementary
Fig. S6).

4.4 Generalization to a larger metagenomic sample

and RDB with different composition

We evaluated how predictions generalized to both a larger RDB and
to a larger metagenomic dataset with a different taxonomic compos-
ition. We evaluated the pipeline performance on the largeHiSeq
study under the best, default and worst configurations obtained on
the smallHiSeq study, for the four mappers.

First, Bowtie2 failed to scale to realistic-sized metagenomic sam-
ples and RDBs: worst and default configurations were still running
after 30 days. Second, we observed similar profiles for all the per-
formance indicators for the three remaining mappers (Fig. 4). Even
though profiles were similar for the proportion of mapped reads, the
values obtained on the largeHiSeq study were higher because it only
included reachable reads while the smallHiSeq study also included
unreachable reads, leading thus to a smaller proportion of mapped
reads. We also observed a drop of the reachable indicator between
the worst and default configurations for TMAP. This drop was al-
ready observed between predicted and observed smallHiSeq but was
greater on largeHiSeq. Although it was not testable with the
Hadamard design, we suspect here an interaction between the clip-
ping and bestHit parameters. Indeed, the default configuration
allows right clipping with bestHit: 0.25, while the worst configur-
ation does not allow clipping, with bestHit: 0.5. Allowing clipping
with a non-null bestHit value tends to make more predictions at
higher ranks than not allowing clipping with a very large bestHit
value. We also compared the observed running times in the
smallHiSeq and largeHiSeq studies for five configurations, corres-
ponding to the minimum, maximum and the three quartiles of
the predicted time distribution obtained in the smallHiSeq study.
Figure 5 presents the running times scaled for 250 000 pairs of reads

F/—‘\‘/\

 

<7

44%

Fig. 4. Generalization of the performance indicators to the largeHiSeq study.
The first and second column present the predicted and observed perform-
ance indicators for the smallHiSeq study, and the third column the observed
performance indicators for the largeHiSeq study. The proportion of reads
mapped at the correct position and the unreachable indicator are not pre-
sented as they cannot be computed on the large dataset which only contains
reachable reads. Each plot presents a performance indicator values for the
worst, default and best configurations, for BWA-MEM (black line), TMAP (red
line) and BWA-backtrack (blue line)

for BWA-MEM, TMAP and BWA-backtrack. All the configurations
for Bowtie2 and the configuration corresponding to the maximum
running time for BWA-backtrack are not presented, because running
times exceeded 30 days. For BWA-MEM and TMAP, the scaled run-
ning times were highly similar for the two studies. For BWA-back-
track, we observed the same running time ordering between the two
studies but the observed running time values were not equal when
scaled for the number of reads. Thus, contrary to BWA-MEM and
TMAP, the BWA-backtrack running time did not increase linearly
with the number of reads in the dataset but was also impacted by
the size/composition of the RDB.

4.5 Validation on HMP mock community

We applied the taxonomic binning pipeline on the HMP mock com-
munity with the best, default and worst configurations obtained on
the small454 study, for the three mappers suitable for Roche 454
reads (BWA-MEM, TMAP and Bowtie2). Figure 6 presents the pre-
dicted proportion of the 21 spiked organisms at two taxonomic
ranks, species and family. At each rank, a barplot represents the pro-
portions of (i) unmapped reads, (ii) reads assigned at a higher taxo-
nomic rank, (iii) reads assigned to a wrong taxon (i.e. not in the
direct lineage of one of the 21 spiked strains) and (iv) reads assigned
to each of the 21 expected strain lineages. As a reference for the ex-
pected proportions of spiked strains, we used the relative genome
depth obtained by Martin et al. (2012) with the CLC mapper on the
same sample [sequenced on Illumina GAIIx in Martin et al. (2012)
article].

Although results presented by Martin et al. (2012) were obtained
with another sequencer, the taxon proportions attributed to the
spiked organisms were highly consistent with the proportions we
observed. Unfortunately, the proportion of unmapped reads and
reads incorrectly assigned to other species could not be retrieved
from Martin et al. (2012). Thus, we also presented the predicted
proportion of the 21 spiked organisms at the species and family
ranks, after removal of unmapped, incorrect and reads assigned at
higher ranks (Supplementary Fig. 510). We observed a lower con-
sistency between HMP predictions and Bowtie2 and TMAP predic-
tions for the default and worst configurations. Best configurations
and HMP results were still highly consistent, whatever the mapper.

For each mapper, the best configuration retrieved all the spiked
organisms, and the proportion of reads assigned at the species level
was very high. Indeed, by definition, the reachable indicator contrib-
uted highly to the CPI, leading to an increased proportion of reads
correctly predicted at the species rank under the best configuration,
compared with the default and worst configurations. For all the

Fig. 5. Generalization of the running time to the large HiSeq study. Running
times (scaled to 250 000 reads) observed for three mappers in the smallHiSeq
and largeHiSeq studies for five configurations. The five configurations corres-
pond to the minimum, maximum and the three quartiles of the predicted time
distribution obtained in the smallHiSeq study

[310'sp2umofp105xo'sopeuHOJIItotq/ﬁdnq

53x\Ewogmoizmnnw.oxmoagoﬁsiwbwﬁ

 

Martin et al. (2012

Supplementary Figure

S6

Supplementary Fig. S7

Supplementary

Table S7

Lundstedt et al., 1998

Taxonomic binning optimization

1787

 

Contrary to previous studies, we defined performance indicators
related to both the performance of the mapper itself (proportion of
mapped reads, reads mapped at the correction position and running
time) and to the whole taxonomic binning strategy (reachable and
unreachable indicators). The unreachable indicator was particularly
important to evaluate the binning strategy in case of incomplete
RDB. However, this indicator favored high rank predictions (e.g.
superkingdom) for unreachable reads because best possible predic—
tion and correct prediction at a higher rank were both considered to
be correct. To limit this effect, predictions made at a higher taxo—
nomic rank than the rank of the best possible prediction could be
down—weighted (e.g. using the distance between the prediction rank
and the best possible rank).

Interestingly, our study showed that for each mapper, no more
than two mapper parameters had a significant effect on the perform—
ance. It also highlighted the importance of the best hit threshold on
the reachable/unreachable performance indicators.

Moreover, to select the best configuration, we defined a CPI as
the weighted sum of the five performance indicators where the
choice of the weights highly depends on the targeted application.
The reachable indicator received a higher weight, because the HMP
RDB was complete (in terms of reference sequences corresponding
to the spiked species), and low—rank taxonomic predictions were
preferred. In contrast, with incomplete RDB, the unreachable indi—
cator should receive a higher weight. For resequencing applications,
the proportion of mapped reads, the proportion of reads mapped at
the correct position, and the time would be the only three indicators
with a non—zero weight. Hence, the advantage of the CPI is to cover
many applications using the same prediction model, just by adjust—
ing the weights of the performance indicators.

Finally, we evaluated the ability of the predicted performance to
scale to both larger datasets and RDB with a different composition
than the ones used in the optimization study. Although, our main in—
dicators appear to well generalize, it would be safer for a targeted
application to use the RDB envisioned for the final application when
running the experiments for the pipeline performance optimization.
As regards the simulated metagenomic dataset, it should have ideally
the same taxonomic complexity than the real metagenomic samples,
but with a limited number of reads so that the optimization study re—
mains computationally feasible.

In conclusion, we hope this computationally tractable statistical
framework will contribute to improve taxonomic binning perform—
ance by providing rational criteria to optimize any mapper configur—
ation for a given application.

Conflict of Interest: none declared.

References

Angly,F.E. et al. (2012) Grinder: a versatile amplicon and shotgun sequence
simulator. Nucleic Acids Res., 40, e94—e94.

Brinda,K. et al. (2015). RNF: a general framework to evaluate NGS read map-
pers. arXiU preprint arXiv:1504.00556.

Caboche,S. et al. (2014) Comparison of mapping algorithms used in high-through-
put sequencing: application to Ion Torrent data. BMC Genomics, 15, 264.

Droge,]. et al. (2015) Taxator—tk: precise taxonomic assignment of metage-
nomes by fast approximation of evolutionary neighborhoods.
Bioinformatics, 3 1, 817—824.

Hatem,A. et al. (2013) Benchmarking short sequence mapping tools. BMC
Bioinformatics, 14, 184.

Holtgrewe,M. et al. (2011) A novel and well-deﬁned benchmarking method
for second generation read mapping. BMC Bioinformatics, 12, 210.

Hugenholtz,P. et al. (2002) Exploring prokaryotic diversity in the genomic
era. Genome Biol., 3, 1—0003, http://genomebiology.biomedcentral.com/
articles/10.1186/gb-2002-3-2-reviews0003.

Huson,D.H. et al. (2007) Megan analysis of metagenomic data. Genome Res.,
17, 377—386.

Kalbﬂeisch,].D. and Prentice,R.L. (2011) The Statistical Analysis of Failure
Time Data, 2nd edn. Wiley, New York, USA.

Koslicki,D. et al. (2014) Wgsquikr: fast whole-genome shotgun metagenomic
classiﬁcation. PloS One, 9, 91784.

Langmead,B. and Salzberg,S.L. (2012) Fast gapped-read alignment with
Bowtie 2. Nat. Methods, 9, 357—359.

Li,H. (2012) Exploring single-sample snp and indel calling with whole-gen-
ome de novo assembly. Bioinformatics, 28, 1838—1844.

Li,H. and Durbin,R. (2009) Fast and accurate short read alignment with
Burrows—Wheeler transform. Bioinformatics, 25, 1754—1760.

Liu,B. et al. (2010) Metaphyler: taxonomic proﬁling for metagenomic se-
quences. In: 2010 IEEE International Conference on Bioinformatics and
Biomedicine (BIBM), IEEE, pp.95—100.

Lundstedt,T. et al. (1998) Experimental design and optimization. Chemometr.
Intell. Lah. SW, 42, 3—40.

Magasin,].D. and Gerloff,D.L. (2015) Pooled assembly of marine metage-
nomic datasets: enriching annotation through chimerism. Bioinformatics,
3 1, 311—317.

Mande,S.S. et al. (2012) Classiﬁcation of metagenomic sequences: methods
and challenges. Brief Bioinform., 13, 669—681.

Martin,]. et al. (2012) Optimizing read mapping to reference genomes to de—
termine composition and species prevalence in microbial communities.
PLOS One, 7, e36427.

McCullagh,P. and Nelder,].A. (1989) Generalized Linear Models, 2nd edn.
Chapman and Hall, London.

Padmanabhan,R. et al. (2013) Genomics and metagenomics in medical micro-
biology. ]. Microbial. Methods, 95, 415—424.

Plackett,R.L. and Burman,].P. (1946) The design of optimum multifactorial
experiments. Biometrilza, 33, 305—325.

Ruffalo,M. et al. (2011) Comparative analysis of algorithms for next-
generation sequencing read alignment. Bioinformatics, 27, 2790—2796.

Schbath,S. et al. (2012) Mapping reads on a genomic sequence: an algorithmic
overview and a practical comparative analysis. ]. Compnt. Biol, 19, 796—813.

Segata,N. et al. (2012) Metagenomic microbial community proﬁling using
unique clade-speciﬁc marker genes. Nat. Methods, 9, 811—814.

Sunagawa,S. et al. (2013) Metagenomic species proﬁling using universal
phylogenetic marker genes. Nat. Methods, 10, 1196—1199.

Yang,X.]. et al. (2015) High-throughput sequencing of 16s rdna amplicons char-
acterizes bacterial composition in bronchoalveolar lavage ﬂuid in patients
with ventilator-associated pneumonia. Drag Des. Devel. Ther., 9, 4883.

[BJO'SWHIHOIPJOJXO'SOplZIIJJOJLItOIQ/[idnq

