ORIGINAL PAPER

Vol. 27 no. 17 2011, pages 2346-2353
doi:10. 1 093/bioinformatics/btr420

 

Genome analysis

Advance Access publication July 14, 2011

Sufficient statistics and expectation maximization algorithms in

phylogenetic tree models
Hisanori Kiryu

Department of Computational Biology, Faculty of Frontier Science, The University of Tokyo, Kashiwa,

Chiba 277—8561, Japan
Associate Editor: David Posada

 

ABSTRACT

Motivation: Measuring evolutionary conservation is a routine step
in the identification of functional elements in genome sequences.
Although a number of studies have proposed methods that use
the continuous time Markov models (CTMMs) to find evolutionarily
constrained elements, their probabilistic structures have been less
frequently investigated.

Results: In this article, we investigate a sufficient statistic for
CTMMs. The statistic is composed of the fractional duration of
nucleotide characters over evolutionary time, Fd, and the number
of substitutions occurring in phylogenetic trees, M. We first
derive basic properties of the sufficient statistic. Then, we derive
an expectation maximization (EM) algorithm for estimating the
parameters of a phylogenetic model, which iteratively computes the
expectation values of the sufficient statistic. We show that the EM
algorithm exhibits much faster convergence than other optimization
methods that use numerical gradient descent algorithms. Finally, we
investigate the genome-wide distribution of fractional duration time
Fd which, unlike the number of substitutions M, has rarely been
investigated. We show that Fd has evolutionary information that is
distinct from that in M, which may be useful for detecting novel types
of evolutionary constraints existing in the human genome.
Availability: The C++ source code of the ‘qur’ software is available
at http://www.ncrna.org/software/fdur/

Contact: kiryu-h@k.u-tokyo.ac.jp

Supplementary information: Supplementary data are available at
Bioinformatics online.

Received on April 20, 2011; revised on June 17, 2011; accepted on
July 10, 2011

1 INTRODUCTION

Although the number of sequenced genomes is increasing rapidly,
the technologies that extract biological information from them are
still in their infancy. Finding evolutionarily constrained elements
in a target genome sequence is among the most successful uses of
those massive genomic sequences (Asthana et (11., 2007; Boffelli
et (11., 2003; Cooper et (11., 2005; Garber et (11., 2009; Mugal et (11.,
2010; Pollard et (11., 2010; Prabhakar et (11., 2006; Siepel et (11.,
2005). In those studies, the researchers estimated the level of the
substitution rate for each genomic region and tested whether it
was signiﬁcantly lower or higher than an estimated rate of neutral
evolution. The substitution rates were computed from a given species
tree and genome-wide alignments by using variants of continuous

time Markov models (CTMMs), which have been used in the
maximum likelihood (ML) method of phylogenetic tree construction
(Felsenstein, 1981). While the relations between the likelihoods of
CTMMs and possible topologies of the phylogenetic trees have been
extensively studied for many years, their probabilistic structures for
a ﬁxed tree topology, which are very important for the genome-wide
studies mentioned above, have been less frequently studied.

In this article, we investigate a sufﬁcient statistic for CTMMs
that is composed of the fractional duration of each nucleotide
over evolutionary time, Fd, and the number of substitutions that
have occurred in a phylogenetic tree, NS. The sufﬁcient statistic
naturally appears in expectation maximization (EM) algorithms
for ﬁnding the local maximum of the likelihood ﬁinction (Garber
et (11., 2009; Hobolth and Jensen, 2005; Holmes and Rubin,
2002; Klosterman et (11., 2006). However, previous studies treated
them only as intermediate variables for parameter optimization
and did not investigate their properties or their genome-wide
distributions. Siepel et (11. (2006) developed a dynamic programming
algorithm for computing the null distribution of NS, corresponding
to neutral evolution which was then used for computing P-values for
constrained elements. However, no investigation of the distribution
of F d has appeared in the literature.

In the following sections, we ﬁrst derive basic properties of
the sufﬁcient statistic, such as its behaviors in the limiting cases
at the time where the parameter is close to zero or inﬁnity. We
derive an EM algorithm (Dempster et (11., 1977) for estimating
the substitution matrix and the branch lengths, which iteratively
computes the expectation values of the sufﬁcient statistic, then
we explain how the branch lengths used in parsimony methods
are related to those in the ML method. Many previous studies
of the EM algorithm optimized only some of the phylogenetic
model parameters, which means that some of the expectation values
required for a full parameter optimization are lacking. Holmes
and Rubin (2002); Klosterman et (11. (2006) and Garber et (11.
(2009) derived an EM algorithm for substitution matrices, but did
not optimize branch lengths. Consequently, the expected durations
deﬁned by them are not appropriate expected values when the
branch lengths are optimized. Hobolth and Jensen (2005) did not
optimize the stationary distribution of the general time reversible
model and thus missed the expectation n({)(i) deﬁned in our article.
Siepel and Haussler (2004) derived a partial EM algorithm for
phylogenetic models but the hidden variables of their EM algorithm
only included the nucleotide states on ancestral nodes, instead
of considering all the possible substitution histories along tree
branches, which are the random processes described by the models.

 

2346 © The Author 2011. Published by Oxford University Press. All rights reserved. For Permissions, please email: journals.permissions@oup.com

112 /3.Io's[Bumo[pJOJXO'sorwurJOJurorqﬂ:duq 11101} papBOIHAAOG

9103 ‘Og anﬁnv uo ::

Sufficient statistics in phylogenetic tree models

 

Iwasaki and Takagi (2007) presented a complete derivation of an EM
algorithm for a special kind of gain-and-loss model for gene family
evolution, but they explicitly used a speciﬁc parametrization for their
transition matrices, so it was not possible to apply it to nucleotide
substitution models. Furthermore, previous studies, except for that
of (Siepel and Haussler, 2004), did not compare the run times
of their EM algorithms with that of gradient descent methods of
likelihood maximization. We derive a complete description of the
EM algorithms for the general unrestricted (UNREST) model and
the general time reversible (GTR) model (Yang, 2006). We also
derive a stationary equation method for the M step in the algorithm
for the GTR model. We show that the EM algorithm converges much
faster than other optimization methods that use numerical gradient
descent algorithms. We also show that the EM algorithm and the
stationary equation method for the M step optimization have the nice
property that the objective functions monotonically approach the
optimal values in every iteration (Dempster et (11., 1977)—a property
which the gradient descent methods do not possess. Finally, we
investigate the genome-wide distribution of the Kullback—Leibler
divergence D1: between fractional durations F d and the stationary
distribution of the CTMM, It. We show that the non-conserved
promoter regions of human genes related to anatomical structure
development have higher D]: values than those of other genes. We
also show that the non-conserved third codon positions of human
genes have higher D]: values than the background. These indicate
that the fractional duration F d contains evolutionary information that
NS does not have, which may be useful for detecting novel kinds of
evolutionary constraints existing in the human genome.

2 ALGORITHMS AND IMPLEMENTATION

2.1 Sufﬁcient statistic on a single branch

A continuous time Markov model for nucleotide evolution can be deﬁned by
a differential equation that determines the time evolution of the probability
of observing each nucleotide:

3

—P(a|b,tR)= Z Ra,P(i|b,tR), P(alb,0)=8,,;,,

at .

zeNuc

where P(alb,t) is the probability of observing base a at time t conditioned
upon base I) being observed at time zero. Nuc={A,C,G,T}= {1,2,3,4} is
the set of nucleotides. (3,]- is the Kronecker delta which is 1 if i: j and is
0 otherwise and R: {RU} is the substitution rate matrix. which satisﬁes the
conditions

Rij>0for(i7éj).ZRiJ-=O. (1)

This differential equation can be solved by using the matrix exponential
of IR:

P(alb, z) = P(alb, 1R): [exp(tR)]a,, ,

A2 A3 °° Ak
exp(A)=I+A+E+§+-~= 
k:0

Here. [A] i]- is the (i , j) element of matrixA and I is the unit matrix. Equation (1)
guarantees that the transition matrix has positive matrix elements P(alb, t) > O
for t > 0. and that it satisﬁes the probability conditions P(alb, t) Z 0. and
ZIP(1 lb, IR) 2 1 for all t Z 0. (A proof is presented in the Supplementary
Material.) Since it is difﬁcult to handle matrix exponentials directly. we use
an inﬁnite product representation:

A N
exp(A)=Nli_>moo<I+ﬁ) .

By applying this formula to P(alb,t). the continuous Markov model can be
considered as a limit of a discrete time Markov model with transition matrix
Q = (I+tR/N). as follows.

P(alb, tR) 11131001)”, (all), tR)

N

PN(aIb.zR>= [QN],,,, = Z HQX,X,_,
XeQN(a,b)k:l
where 9N (a, b) is the set ofall patth along discrete time points 0, . . . ,N such
that X: {Xk eNuclkzO, . . . ,N,X0 =a,XN :17}. Q satisﬁes the probability
conditions for a transition matrix. Qij Z O and X:ng = 1. if N is sufﬁciently
large (N Z maxithiil). In the following. we derive a few formulas for ﬁxed
N . then take the continuum limit N —> 00. The likelihood P(X |tR) of path X
can be rewritten as

N tRkk N‘fk ZR," Ni);
P(XltR)= HQX,X,_, =1‘[ (1+ V) 1‘1 (W1)
k:l k i¢j
Z xp [ 2,211,717.10.X>+z,¢jN.(i.j.X>log(2R1) ]
+N..0(X>log(§) +0 (1) ’

where N; is the number of i <—j transitions that occurred in X . F “(1 ,X):
Ng/N is the fractional duration of base i. Nv(i,j,X)=Nij-( is the number of
substitutions i<—j (1751‘). and NV0(X) = Zi¢jNv(i,j,X) is the total number of
non-trivial substitutions inX. We have used the Taylor expansion log(1 +x) 2
21:1(—1)k+1xk/k to derive the ﬁnal equation. (The derivation of the last
equation is described in the Supplementary Material.) The equation above
indicates that the probability of each path X decreases as ~NTN-‘0(X) in the
limit N —> 00. On the other hand. the number of paths with the same number
of non-trivial substitutions N «)(X ) increases as ~NN-‘0(X). since the number
of positioning patterns of substitution events in the time course increases

roughly as the combination < .Thus. the paths with a positive number

N )
NMX)
of substitutions give ﬁnite contributions in the continuum limit. Since the
likelihood function depends on X only through F “(1 ,X ) and Nv(i , j ,X ). these
form a sufﬁcient statistic for the model (Fisher. 1922).

The expected value of Fd(i,X) is
1

F b ‘ =—
M’ ’1) ZN(a,b,tR)

Z Fd(i,X)P(X|tR),

XeQN(a,b)

ZN(a,b,tR)= Z P(XltR)=PN(a|b,tR).
XeQN(a,b)
As shown in the Supplementary Material. the continuum limits of Fd(i,X)
and Nv(i,j,X). which are denoted by Fd(a,b, i,tR) and Nv(a,b, i,j,tR). have
integral representations:

Fd(a,b,i,tR)=IC(a,b,i,i,tR) (2)
M(a, b, 1,]; 1R): (RU-Km, b, i,j,tR)

1 l
’b’ .’ .JR 2 d‘ [ 0—3112] SIR _ _
Km 1] ) P(alb,tR),[) Y e mle Lb

2.2 Sufﬁcient statistic for phylogenetic tree models

Throughout this article. we assume that the topology of phylogenetic trees
is ﬁxed. In the following. 4‘ denotes the root node. m: 1,...,M denote node
indexes other than the root node. in which m = 1, . . . , S represent the indexes
of the leaf nodes. Pa(m) is the parent of node m. tn, is the length of branch
(m. Pa(m)). T: {tmlmz 1,...,M} is the set of the branch lengths. and 6:
(T,R). The random processes in these models correspond to the set of all the
substitution histories X over the phylogenetic branches. The log likelihood
of X has the following form in the ﬁnite product approximation:

1(X.6>=Zz,,,RﬁFf;")(i.X)+ Z N§"'>(i.j.X>log(sz,»,->
m,i m, i¢j

+Zn<0(i.X>log(ni>+-~. (3)

l

 

2347

112 /3.Io's[Bumo[pioixosoiwuiioiuioiqﬂ:duq uroii papeolumoq

9103 ‘Og isnﬁnv uo ::

H. Kiryu

 

where Ffim)(i,X) and Ngm)(i , j ,X ) are the fractional duration and the number
of substitutions at branch (m,Pa(m)) computed from history X. The number
n(§)(i,X) is 1 if the base is i at the root in X, and is 0 otherwise. The
ellipsis ‘---’ represents irrelevant terms that are independent of the model
parameters T and R, or those that vanish in the continuum limit N —> 00.
The equation implies that the sufﬁcient statistic of the model consists of
Ff,”')(i,X), NS’")(i,j,X) and n<€>(i,X). The expectation values of Ff,”')(i,X),

Ngm)(i,j,X) and n(§)(i,X) for an alignment column C are as follows:

Ff,”')(i, C, 9) = 213,919, 1, z,,,R)P<'">(a, blC, 9),
(1,17

NS’">(i.j.C.9>=ZN.(a.b.i.j.z...R>P<"'>(a.blue),
(1,17

Wu, C, 9) =P<0(i|C, 9) .

Here, P(”')(a, bl C, 9) is the posterior probability that the ﬁnal and initial bases
of branch (m, Pa(m)) are a and b, respectively. P(§)(a|C,6) is the posterior
probability that the base at the root node is (1. These values are calculated by
using insidemutside algorithms, which are described in the Supplementary
Material. Finally, the fractional duration and the total number of substitutions
over the entire phylogenetic tree are deﬁned by

F (. C 9) Td(i.C.6)

l. . =—.v

" 22103.9)

N.0(C.9)=ZZN§'">UJ.C9).
m i¢j

Td(i, C, 9) = Zz,,,Ff,’")(i, C, 9).

m

2.3 EM algorithm

The EM algorithm (Dempster at (11., 1977) is a method to ﬁnd a local
maximum of the likelihood function when there exist unobserved hidden
random variables. The algorithm iteratively maximizes the likelihood
function by alternately calling two distinct subroutines called the E step
and the M step. In the E step, the expected values of certain statistical
operators are computed by using current estimates of parameter values. In
the M step, an expected log likelihood function QEM is maximized with
respect to the model parameters. In the present case, the unobserved hidden
variables correspond to the substitution histories X over the phylogenetic
tree. We deﬁne the QEM function by

1
QEM(A.9.6’)=WZ Z P(X|9’)1(X,9)

CeAXemC)

= ZtmRiiFfii’? + Z  lOgUmRij) + 2”?) 10g(”i) v

m,i m,i;£j i
<1)
I
are, respectively, the means of Ffim)(i, C,6’), Ngm)(i,j, C,9’) and n(§)(i, C,9’)
averaged over all the columns C E A. We have omitted the irrelevant terms

where |A| is the number of columns in alignment A, and F32), 5'3.) and n

in Equation (3). In the E step, we compute the expectations F523;»),  and

n?) for the entire alignment data. This is very compute-intensive step for
genome-scale multiple alignments. In the M step, we maximize the QEM
function with respect to 6 with ﬁxed expectations. Then we set 9’ to the
optimized values. The E and M steps are repeated until the convergence of
model parameters 9. The EM algorithm has the important property that the
likelihood function always increases at each iteration (Dempster 21111., 1977).
This is not the case in the gradient descent method ofpararneter optimization,
in which the likelihood usually undergoes several cycles of increasing and
decreasing before the optimal value is reached. To maximize QEM at each
M step using the gradient descent method, we must compute the gradient of
QEM with respect to parameters.

We deﬁne the UNREST model, which is the most general, time-
irreversible substitution model, by the parametrization RU- : Bi]- (1 751‘), {Bi}- >
0, 21¢]- Bij = 1}. Then, the derivatives of QEM with respect to B and tm are
given by

 

 

aQEM (m) (m) 1 :| (C) 1 377k
2 —z F .+N .- — + n — .
3817  m [1,] 5,1] BU 2k: k 71k 

m

 

3 EM 1
Q = ZRﬁFg’? +Nfg') — .
all"  , ‘ till

The derivatives of the stationary distribution are given by

371
k = — Zoe — nk-1>(R,t—R,1>n,-. (4)
l

38,,-

 

where RT = UDT UT1 and DT =diag(0,a’2_l , . . . ,dzl) is the Moore-Penrose
pseudoinverse of R (Ben-Israel and Greville, 2003). The proof of this
equation is described in the Supplementary Material. In the above equations,
Bi]- (1 751‘) are regarded as independent variables and the conditions Bi]- > O and
21%]. Bi]- : 1 are not taken into account. A simple method to deal with these
conditions in gradient descent methods is described in the Supplementary
Material.

The GTR model is deﬁned by the parametrization RU- : 703,; (1751‘), {m >
0,211,»: 1,Bi]- > O,Bji=Bij(i<j),Zi<J-Bij=1}, where 7'! is the stationary
distribution. The derivatives of QEM with respect to 9=(JI,B, T) are given
by

aQEM (m) (m) 1 (g) 1
meet)

 

3 1

39;? = ; [4.9.9.19 +nszi';>>+<~:::;> +N§f}§)>B—U_] .

The derivatives BQEM/Btm are the same as in the UNREST model. In
the above equations, all the parameters 71, and Bi]- (1 < j) are regarded as
independent variables. For GTR models, there is an alternative to the gradient
descent method for solving the M step problem. In this method, we maximize
QEM by iteratively solving the stationary equations. The stationary equations
are satisﬁed at any local maximum and can be obtained by setting all the
derivatives to zero. The stationary equations can be formally solved in the
GTR model and the solutions are given by

(K)
,_ Zj<¢i>Nnif+ni
l_ — 7
Zi<¢DBidej+Arr
thj‘l‘iji
BU: —,
ﬂde,j+JTde,i+AB

N171) Non) _ ZN< :0

2i lRiilFfin? ’ 50 i¢j 5,1]
Here, A” and A3 are the Lagrange multipliers that impose the probability
conditions on 7'! and B, respectively. The Lagrange multipliers can be
efﬁciently computed by using a NewtoniRaphson method (Press at (11.,
1992), which is described in the Supplementary Material. The above
equations can be solved for each of 71, B and T, but not simultaneously.
Therefore, we serially update those three types of parameters until
convergence. Because QEM is exactly maximized with respect to the
currently updating parameter type, the method is guaranteed to converge
(Drton, 2004; Lauritzen, 1996). This also indicates that the stationary
method has the monotonicity property that QEM increases at every iteration
(Dempster at (11., 1977).

Since the stationary equations are satisﬁed at any local maximum of the
log likelihood, it is possible to derive an interesting connection between
the branch lengths in ML solutions and those in parsimony methods. The
stationary equations also suggest that there is a natural deﬁnition of the
posterior local tree, which has the same topology as that of the global tree
but has different edge lengths, for each genomic region. A more detailed
description of these issues is given in the Supplementary Material.

m

 

2348

112 /3.Io's[Bruno[pJOJXO'soiwuiJOJHrorqﬂ:duq uror} papeo1umoq

9103 ‘0g anﬁnv uo ::

Sufficient statistics in phylogenetic tree models

 

2.4 Derivatives of the likelihood function

Using the derivative formula of matrix exponentials presented in the
Supplementary Material as well as the derivative formula of the stationary
distribution [Equation (4)], we can ﬁnd the derivatives of the log likelihood
function with respect to parameters (T, R). We present the explicit formulas in
the Supplementary Material. Those formulas are used in the gradient descent
methods in the following sections. We have described the comparison of the
EM algorithm of Siepel and Haussler (2004) and the gradient descent method
and our EM algorithm in the Supplementary Material. We have also described
the relationships between the stationary equations and the approaches that
optimize a part of model parameters for each alignment column to detect
signals of evolutionary selection (Cooper et (11., 2005; Garber at (11., 2009).

3 DATASET AND DATA PROCESSING

3.1 Training model parameters

We trained the phylogenetic model from the Multiz 44-way dataset, which
is a large set of alignments created from 44 vertebrate genome sequences
including the human genome (hg18) that is provided at the UCSC genome
browser site (Blanchette at (11., 2004; Kent at (11., 2002). We used a ﬁxed tree
topology that is also provided at the UCSC site and obtained the maximum
likelihood estimates of the GTR model parameters and branch lengths.
Because many of the alignments include only human and closely related
monkey species, and partly because of limited computational resources, we
used only a subset of the Multiz 44-way alignments, which was selected by
the condition that fugu (fr2) is contained in each alignment. The number
of alignment columns was 74 X 106 and the data size of the alignment ﬁle
in MAP format was 3.1 GB. The species that is least frequently aligned
is petMarl which is included in 38% (28 X 106) of the alignment columns.
Fugu was the best species for such ﬁltering in the sense that the coverage
of the species with the lowest coverage in the alignment was the maximal.
For example, if we used petMarl instead of fr2 for selecting the alignment
subset, then the taeGutl genome covers only 29% (14 X 106) of the alignment
columns.

3.2 Distance measure for F [1(1)

To measure the changes of fractional duration Fd(i), we computed
the KullbackiLeibler divergence Dp between Fd(i) and the stationary
distribution 71, in the model:

DF=ZFd(i>log2(Fd(i>/m>.

which is non-negative and zero if Fd(i)=ni. Since the trained stationary
distribution is very close to the uniform distribution, the maximal value
of Dp is reached when the distribution of Fd(i) is close to a single-peak
distribution (3,” for some a e Nuc.

3.3 Comparison of gradient descent and EM
algorithms

The run time of numerical optimization depends on many factors, and the
optimal implementation can be completely different for different alignment
sizes and tree topologies. This means that it is, in general, difﬁcult to judge
whether differences of running time are caused by differences between
the underlying algorithms or by differences at the implementation level.
However, here we are interested in optimizing parameters for genome-scale
alignments. In such cases, the most time consuming step is the computation of
insideioutside variables, which is required for each computation of gradient
in the gradient descent methods, and is also required for each E step in the
EM method. Hence, the number of times that a program passes through the
alignment data until convergence is an accurate measure for comparing the
convergence properties of the algorithms themselves, at least when the input
contains a large number of alignments. In the following section, we used

10000 alignment columns sampled from the Multiz 44-way alignment and
plotted the relative differences of likelihood or parameter values from the
optimal values. The relative difference of log likelihood 1 from the optimal
value [Opt is deﬁned by U —10p1|/|10p1|). Similarly, the relative difference of
parameter vector x is deﬁned by ||x—x0plll/llx0plll, where ||-|| represents
the Euclid norm. For gradient descent, we used a BFGS (Press at (11., 1992)
routine implemented in the PHAST package (Siepel at (11., 2005) and the
FORTRAN code of the L-BFGS-B (Nocedal, 1980; Zhu and Byrd, 1997)
routine provided by the original authors.

3.4 Gene Ontology term analyses of promoter regions

We collected the human RefSeq genes from the UCSC site and selected a
representative RefSeq gene model with the longest transcript size for each
Entrez gene. Then we collected a 1000 base sequence upstream of each
transcription start site, and assigned the Entrez gene identity for it. To reduce
the effects of possible overlaps with different gene isoforms, we masked
the promoter positions that overlap with any of the putative gene models
provided at the UCSC site (the UCSC genes). Then, the Entrez genes were
sorted according to the conservation properties in their associated promoter
regions. We considered three sorting criteria:

(i) The ratio of the number of conserved promoter sites to that of
unmasked sites. The conserved sites are deﬁned by positions with
Nvo less than the median of the distribution (Nﬂmedian 25.41).

(ii) The ratio of the number of non-conserved sites (Nvogmedian <Nvo) to
that of unmasked sites.

(iii) The ratio of the number of non-conserved and highly biased F ,1 sites
to that of non-conserved sites. The non-conserved and highly biased
F ,1 sites are deﬁned as follows. First, we collected the non-conserved
sites by the ﬁltering Nvomedian <N,0. Then, we divided the sites into
100 bins according to their Nvo values. For each bin, the upper 5%
of the sites with high Dp values are deﬁned as the non-conserved,
highly biased sites. These sites are characterized by their stronger
nucleotide preference despite the lack of conservation (see Fig 5 for
more explanation).

The Entrez genes were divided into 100 bins by each sorting criterion. For
each bin ID i, we performed gene ontology (GO) term enrichment analyses
for the gene set with bin ID 5 i by computing hypergeometric P-values. The
number of non-trivial GO terms was 8000 for our dataset, which indicates
that the hypergeometric P-values with —log10(P-Value) > 5.2 correspond to
Bonferroni corrected P < 0.05. The plots in Figure 6 are inspired by the ones
proposed in van Dongen et a1. (2008) to analyze the gene repression effects
of miRNAs and siRNAs.

3.5 Evolutionary characteristics of 4-fold degenerate
sites

The 4-fold degenerate (4d) sites are the third codon positions where any kind
of mutation does not cause a change of amino acid sequence. We collected the
human 4d sites from the representative RefSeq genes. We divided the human
genome into the ﬁrst, second and third codon positions and the remaining
positions. The third codon positions are subdivided into 4d sites and non-
4d sites. For each position, we computed the pair of statistics (N.0,Dp)
and dropped the conserved positions which have a number of substitutions
Nvo <N,0,median. We divided the data into 100 bins according to their N ,0
values, and compared the Dp distributions for each bin k. We consider the
Dp distribution fk(d) of bin k in the non-coding positions as the background
distribution. We computed the upper quantile values q(y)=Z:.:}fk(d) for
each Dp value y of the coding sites in the same bin k. Then we plotted the
distribution of quantile values (1 for all the non-conserved Nvo bins for each
codon type (Fig. 8). The peaks of those distribution at small (1 indicate that the
codon positions tend to have high Dp values compared with the background
at the same conservation level.

 

2349

112 /3.Io's[BrunoprOJXO'soiwuiJOJHrorq”:duq uror} papeo1umoq

9103 ‘0g anﬁnv uo ::

H. Kiryu

 

4 RESULTS AND DISCUSSION
4.1 EM algorithm

Figure 1 shows a comparison of the convergence of log likelihood
and model parameters between the gradient descent methods and
the EM algorithm. The x-axes represent the number of iterations
that the input alignments are traversed to compute the gradient
vector or the expectation values. The y-axes are the relative distances
from the optimal values. Although the differences of convergence of
log likelihood values might appear small, the convergence rates of
parameters are considerably different. The EM algorithm converges
much faster toward the optimal value than the gradient descent
methods. The ﬁgure shows the monotonic convergence of the EM
algorithm (Dempster et (11., 1977) while the parameters of the
gradient descent methods show oscillatory behavior before reaching
the optimum.

Figure 2 shows the convergence of the M step maximization.
The x-axes represent the number of updates of model parameters.
The y-axes represent the relative distance of the parameters from
the optimal values. The stationary equation method converges more
rapidly than the LBFGS method. At the 10-th EM iteration (Fig. 2B),
the stationary equation method makes almost no changes to the
parameters since the initial parameters are already close to the
optimal values. On the other hand, the gradient descent method alters
them from the optimal values at least once since it needs to recognize
the local landscape of the objective function.

 

 

 

 

 

 

 

 

 

 

A 8_ B <o_ \
o _ EM — EM
—--BFGS u, 5 —--BFG$
a, ——-LBFGS o" E ---LBFGS
<r._ \“
0

Relative Error
0.3

Relative Error
0.2

 

 

 

 

 

 

 

I I I I
0 20 40 60 80 100 0 20 40 60 80 100

Iteration Iteration

Fig. 1. Comparison of the convergence of log likelihood (A) and model
parameters (B) between the gradient descent methods and the EM algorithm.

 

>
m

RelatIve Error
0.00 0.05 0.10 0.15 0.20 0.25 0.30

 

 

 

— Stationary
——- LBFGS

— Stationary
——- LBFGS

 

 

 

 

 

 

|
a
Relative Error
0.00 0.01 0.02 0'03 0.04 0.05 0.06 0.07

I
’r

 

I
r

'r

I

 

 

 

 

 

I I I I I I I I I I I I
0 20 40 60 80 100 0 20 40 60 80 100
Iteration Iteration

Fig. 2. Comparison of convergence in gradient descent methods and the
stationary equation method. (A) M step maximization at the ﬁrst EM iteration.
(B) M step maximization at the 10-th EM iteration.

Table 1 shows the comparison of run time of three optimization
methods. The computation was performed on a Intel Xeon E5450
3 GHz with 32 GB memory. It is noted that the BFGS method is
slower than the others since the optimization code requires additional
log likelihood ﬁinction evaluations other than at each gradient
computation.

4.2 Genome-wide distribution of F d and M

Figure 3 shows the genome-wide distribution of D1: and NS0. The
genomic data are divided into equally sized bins according to D1:
or NSO values. Then we compared the proportion of each type of
genomic region (Repeat, Intergenic, Intron, UTR and CDS) in each
bin with that in the entire distribution. The bars represent log2(fold
enrichment) of each genomic region. The ﬁgure shows that CD5
is enriched and Repeat is depleted in high D1: or low NSO regions.
The repeat elements are depleted in both low and high NSO regions,
because most of them have small number of aligned species, and thus
their N .0 values are close to the prior expectation N .0 = 5.28 for the
alignment column ﬁlled with missing characters. Figure 4 shows the
correlation between D]: and N 90 in the human genome. Although D1:
and NSO are roughly inversely correlated, a large variability of D]:
values for the same NSO values is observed.

Figure 5 illustrates how differences of D]: can occur with the
same number of substitutions NSO. Both (A) and (B) have a single
substitution event, but (A) has a substitution only recently and (B)
has a substitution in a deep ancestral branch. This difference results
in an approximately single-peak Fd(i) for (A) and a double-peak
F d(i) distribution for (B), and hence D1: of (A) is larger than that

Table 1. The run time of three methods

 

 

Name Iteration Run time (5) Run time per iteration (5)
EM 83 143 1.67
LBFGS 134 271 2.00
BFGS 107 3 19 2 .95

 

The input alignment size is 10 000 columns of 44 species. The unit of time is second.
Iteration represents the number of the E steps or the gradient computations that are
required until the relative errors of the parameters become <0.01. Run Time shows the
total time spent for these iterations. Run Time Per Iteration is the average time spent
for each iteration.

>
m
a

 

3

 

repeat
intergenic
odintron
utr

Dds

:Jwﬂﬂ |  T 

Bin (DF) Bin (N...)

5.
5
(3
m
E.
n
2
EIDDII

 

 

UDEIII
=2.
3
=

 

 

 

1

J

Logz(Fold Enrichment)
Logz(Fold Enrichment)

 

Fig. 3. Genome-wide distribution of Dp and Nvo. The bars represent
log2(fold enrichment) of genome regions (Repeat, Intergenic, Intron, UTR
and CDS) of each bin from the entire distribution. (A) The data points are
binned by the Dp values. (B) The data points are binned by the Nvo values.

 

2350

112 /3.Io's[BrunoprOJXO'soiwuiJOJHrorq”:duq uror} papao1umoq

9103 ‘0g isnﬁnv uo ::

Sufficient statistics in phylogenetic tree models

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

Fig. 5. Illustration of the combination of conservation patterns and Dp. The
back slashes indicate substitution events. The branches that remained as base
G are represented by solid lines. Similarly, The evolutionary time courses
that stayed as base C, A and T are represented by dot-dash, broken and dotted
lines, respectively.

of (B). Next, both (C) and (D) have three substitutions, but (C) has
a strong bias which prefers base G or C, while (D) has no such a
preference, which results in a larger D1: value for (C) than for (D).

4.3 GO term analysis of human promoters

Figure 6 shows GO term enrichment analysis of promoter regions.
Positive values on the y-axes represent GO term enrichment and
negative values represent depletion. The x-axes represent gene ranks
(or bin identities) which are determined according to the sorting
criteria: (i) high conservation (Fig. 6A); (ii) high non-conservation
(Fig. 6B); and (iii) non-conserved but highly biased Fd (or high
DF) values (Fig. 6C), which correspond to the conservation pattern
(C) of Figure 5. Figure 6A shows that the genes with conserved
promoters are enriched with the term ‘regulation of transcription’
(GO:0045449). Figure 6B is essentially an inversion of the Figure 6A
and shows that the genes with non-conserved promoters are depleted
of ‘regulation of transcription’. Figure 6C shows that the genes
with promoters that have highly biased F d values despite low level
of conservation, which are not reported as constrained regions by

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

A B S
8' I“ JILL : ggjgﬁggg: —« (300045449
by a; \_ - — 60:0048856
A . .
(3° In” ﬁt ’60- 1M I
— N— . .
o I \‘-\ g x I
T  ‘ > \ If
a. - "I I S- ‘ 1
v0 I - o. - I. .
S "_ f  ‘o’ L' ,I
0) I“ ‘I. 5, ‘- I
O . o o I. I
-.' i _| ‘2" I".
°- ' In. at!”
.1
‘a 9’“. .1
8: "1.“ N
| | | | | | I I I I I I
0 20 40 60 80 100 o 20 40 so an 100
BIn Bin
C
o _ —-- 6020045449
V — G0:0048856
O—
A ('3
(D
3 o
9 N ,J“\uq_
I 
\Q’. o _ an.
9 ‘- x.__
8) ‘5...“-
O— n
—.I “'x
| I | I |
0 20 40 60 80
Bin

Fig. 6. GO term analysis of promoter regions. The genes are sorted in
descending order according to (i) the fraction of conserved sites (A); (ii) the
fraction of non-conserved sites (B); (iii) the fraction of non-conserved, highly
biased sites (C). See Section 3 for more explanation of the sorting criteria.
Solid line: GO:0048856, anatomical structure development. Dot-dash line:
GO:0045449 regulation of transcription. Gray lines: other GO terms. Positive
values on the y-axes represent GO term enrichment and negative values
represent depletion of GO terms

previous methods based on NSO values, are enriched with the term
‘anatomical structure development’ (GO:0048856). These ﬁgures
show that the fractional duration Fd captures distinct evolutionary
constraints which are not contained in the expected number of
substitution N .0.

4.4 D}: distribution in coding regions

Figure 7 shows the normalized N .0 distribution of each codon phase
position. Large portions of the ﬁrst and second codon positions are
strongly conserved and have small N .0 values. Both the non-4d sites
and the 4d sites have broader tails than the non-coding sites. The 4d
sites have thick tail in the large NSO values.

Figure 8 shows the D1: distribution of each codon phase position
relative to the background distribution. As described in the Section 3,
the data only include non-conserved sites. The sharp peaks around
the zero quantile in the Figure 8A indicate that all the codon
positions are subject to a strong bias that constrains Fd to be far
from the stationary distribution, unlike the background distribution
at the same level of conservation NSO. The fact that this bias is
prominent even in the 4d sites indicates that it might capture the
selective pressures related to transcription and translation efﬁciency,
such as codon bias and CpG islands. There is, however, another
possible reason behind this bias for the 4d sites. Since the 4d
sites are within coding regions, many species are aligned on those
positions. On the other hand, non-coding regions which are used as

 

2351

112 /3.IO'S[1211anprOJXO'SOIJBLUJOJIIIOIq”Idllq uror} papao1umoq

9103 ‘0g isnﬁnv uo ::

H. Kiryu

 

 

    
   

— —-- phase 1
---- phase 2

_  phase 3 no4d
— phase 3 4d

 

 

 

Frequency

0.00 0.05 0.10 0.15 0.20 0.25 0.30

 

 

 

Fig. 7. Normalized N Y0 distribution of each codon site in the human genome.

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

A e B a_ ,

g- __I Was“ a i —-- phase1

_... phasez ---- phase2

Rf  phasesnMd m  phase3no4d
>.° — phase34d >3- — phase34d
2 ° 0

“‘-- C
(I) o (D
:5 3 a
0' In a. ‘-._
a) ".- a) o
|— o h
“- LI.

o “'1

E' g-

In

o__

o

8-
o
(II-0 0'2 (II-4 0'5 Ill-8 1'0 (in 0'2 11.4 11.6 (is 1'.o

Quantile value Quantile value

Fig. 8. Dp distribution of 4-fold degenerate sites. (A) Dp values are
computed for the entire tree and dataset. (B) Dp values are computed for
the subtree which has human, rhesus, mouse and dog as the tree leaves, and
the data only include the sites that have no ambiguous or gap characters for
these four species.

the background distribution generally have fewer aligned species,
which might cause artiﬁcial differences between the distributions.
To investigate this effect, we computed the fractional duration F d(i)
on the subtree that has human, rhesus, mouse and dog as the tree
leaves. Furthermore, we removed the data points that have any
ambiguous or gap characters for these four species. Figure 8B shows
the recomputed distribution. It still shows peaks at small quantile
values, which indicates that the observed bias to the fractional
duration F d is not caused by the difference of the number of aligned
species. These ﬁgures indicate that the codon sites including the 4d
sites show distinct behaviors from the non-coding sites in terms of
D1: distributions even in the extremely diverged sites.

5 CONCLUSION

We have investigated the sufﬁcient statistic, composed of the
fractional duration time F d and the number of substitutions NS, for
continuous time Markov models. We have derived EM algorithms
for the general unrestricted (UNREST) model and the general
time reversible (GTR) model. In the case of the GTR model, we
have derived a stationary equation method for solving the M step

optimization problem. Both the EM algorithm and the stationary
equation method have a property which is not shared by the gradient
descent methods: the objective functions monotonically approach to
their optimal values (Dempster et (11., 1977). We have also shown
that the EM algorithm converges faster than the gradient descent
methods. Although we did not describe EM algorithms for other
phylogeny models with discrete gamma rate variations (Yang, 1994)
and invariance sites (Gu et (11., 1995), the application of our method
to such models is straightforward. There is a natural deﬁnition of
local posterior trees which are derived from the stationary equations,
and we have discussed the relationships between the branch lengths
in the maximal likelihood method and those in the parsimony
method. Finally, we have investigated the genome-wide distributions
of the sufﬁcient statistic. We have shown that the fractional duration
F d has evolutionary information that is not contained in the expected
number of substitutions NSO.

In our experiments on the F d distributions, we have focused on
only the point that the fractional duration F d contains information
different from those contained in the expected substitution count
NSO, which is not obvious from the outset since conserved regions
(NSO~0) naturally have biased distributions (larger DF) and thus
they are strongly anti-correlated. In order to establish a novel
method for ﬁnding novel constrained elements based on statistics
(NSO, DF), several additional factors should be considered and
investigated. First, we need to explore at least 2D space (NSO, DF)
of statistics. It means that we have to determine a threshold curve
rather than a single threshold value to determine the constrained
sites. Also, more precise characterization of the correlations between
(NSO, DF) and the patterns of aligned species (i.e. the 0—1 patterns
representing whether each species have an aligned nucleotide or
not in an alignment column). We have touched on this issue in
the codon sites experiment, but discarding most of the information
from the 44 species alignments and keeping only four species for
computing statistics is not a satisfactory method. It requires the
genome-wide distribution of 244 possible patterns of alignment
column types. To make any statistical statement on the level of
constraint, computation of the theoretical distribution will be useful.
We have only analyzed the empirical distributions of the sufﬁcient
statistic and have not analyzed the distribution determined by the
phylogenetic model. There is a dynamic programming algorithm
for computing the distribution of N .0 (Siepel et (11., 2006). Although
it seems difﬁcult to compute the theoretical distribution of Fd
with similar methods, it can be computed by a sampling method
as shown in the Supplementary Material. Furthermore, we must
investigate other nuisance parameters such as the length scales
of the constrained elements in order to decide if a consecutive
segment is constrained or not. Lastly, we assumed that the genome-
scale alignments provided at the UCSC site are completely reliable.
However, there are studies that suggest that the errors contained
in the Multiz alignments may be considerable (Frith et (11., 2008;
Prakash and Tompa, 2007). It will be interesting to investigate to
what extent the computed statistics are sensitive to the errors of the
alignments.

ACKNOWLEDGEMENTS

The author thank their colleagues who worked on the project for
discussions and comments.

 

2352

112 /3.IO'S[1211anprOJXO'SOIJBLUJOJIIIOIq”Idllq uror} papao1umoq

9103 ‘0g isnﬁnv uo ::

Sufficient statistics in phylogenetic tree models

 

Funding: ‘Functional RNA Project’ funded by the New Energy
and Industrial Technology Development Organization (NEDO) of
Japan; Grants-in-Aid for Young Scientists (21700330); Grants-
in-Aid for Scientiﬁc Research (A) (22240031). Supercomputing
resources were provided by the Human Genome Center, University
of Tokyo (http://sc.hgc.jp/shirokane.html).

Conﬂict of Interest: none declared.

REFERENCES

Asthana,S. et al. (2007) Analysis of sequence conservation at nucleotide resolution.
PLoS Comput. Biol., 3, 6254.

Ben-Israel,A. and Greville,T. N. (2003) Generalized Inverses Springer, New York,
USA.

Blanchette,M. et al. (2004) Aligning multiple genomic sequences with the threaded
blockset aligner. Genome Res, 14, 7084715.

Boffelli,D. etal. (2003) Phylogenetic shadowing of primate sequences to ﬁnd functional
regions of the human genome. Science, 299, 139141394.

Cooper,G.M. et al. (2005) Distribution and intensity of constraint in mammalian
genomic sequence. Genome Res, 15, 9014913.

Dempster,A.P. et al. (1977) Maximum likelihood from incomplete data via the EM
algorithm. J. R. Stat. Soc. Sect. B, 39, 1438.

Drton,M. (2004) Maximum Likelihood Estimation in Gaussian AMP Chain Graph
Models and Gaussian Ancestral Graph Models. PhD Thesis, University of
Washington.

Felsenstein,J. (1981) Evolutionary trees from DNA sequences: a maximum likelihood
approach. J. Mol. Evol, 17, 3687376.

Fisher,R. (1922) On the mathematical foundations of theoretical statistics. Philos Trans
R. Soc. Lond. Ser A, 222, 3097368.

Frith,M.C. et al. (2008). The whole alignment and nothing but the alignment: the
problem of spurious alignment ﬂanks. Nucleic Acids Res, 36, 586345871.

Garber,M. et al. (2009) Identifying novel constrained elements by exploiting biased
substitution patterns. Bioinformatics, 25, 54$2.

Gu,X. et al. (1995) Maximum likelihood estimation of the heterogeneity of substitution
rate among nucleotide sites. Mol. Biol. Evol, 12, 543557.

Hobolth,A. and Jensen,J.L. (2005) Statistical inference in evolutionary models of DNA
sequences via the EM algorithm. Stat. Appl. Genet. Mol. Biol., 4, Articlel8.

Holmes,I. and Rubin,G. M. (2002) An expectation maximization algorithm for training
hidden substitution models. J. Mol. Biol., 317, 7534764.

Iwasaki,W. and Takagi,T. (2007). Reconstruction of highly heterogeneous gene-content
evolution across the three domains of life. Bioinformatics, 23, i2304i239.

Kent,W.J. et al. (2002) The human genome browser at UCSC. Genome Res, 12,
9931006.

Klosterman,P.S. et al. (2006) XRate: a fast prototyping, training and annotation tool for
phylo-grammars. BMC Bioinformatics, 7, 428.

Lauritzen,S. (1996). Graphical Models. Clarendon Press, Oxford, UK.

Mugal,C.F. et al. (2010) Conservation of neutral substitution rate and substitutional
asymmetries in mammalian genes. Genome Biol. Evol, 2, 19428.

Nocedal,J. (1980) Updating Quasi-Newton Matrices with limited storage. Math.
Comput., 35, 7737782.

Pollard,K.S. et al. (2010) Detection of nonneutral substitution rates on mammalian
phylogenies. Genome Res, 20, 1104121.

Prabhakar,S. et al. (2006) Accelerated evolution of conserved noncoding sequences in
humans. Science, 314, 786.

Prakash,A. and Tompa,M. (2007). Measuring the accuracy of genome-size multiple
alignments. Genome Biol., 8, R124.

Press,W.I-I. et al. (1992) Numerical Recipes in C: The Art of Scientiﬁc Computing. 2nd
edn. Cambridge University Press, NY, USA.

Siepel,A. and Haussler,D. (2004) Phylogenetic estimation of context-dependent
substitution rates by maximum likelihood. Mol. Biol. Evol, 21, 468488.

Siepel,A. et al. (2005) Evolutionarily conserved elements in vertebrate, insect, worm,
and yeast genomes. Genome Res, 15, 103441050.

Siepel,A. et al. (2006) New methods for detecting lineage-speciﬁc selection.
In Proceedings of 10th International Conference on Research in Computational
Molecular Biology, Springer, Berlin and Heidelbelg; GmbH & Co. KG, Berlin/DE.

van Dongen,S. et al. (2008) Detecting microRNA binding and siRNA off-target effects
from expression data. Nat. Methods, 5, 102341025.

Yang,Z. (1994) Maximum likelihood phylogenetic estimation from DNA sequences
with variable rates over sites: approximate methods. J. Mol. Evol, 39, 3064314.

Yang,Z. (2006) Computational Molecular Evolution. Oxford University Press, Oxford,
UK.

Zhu,C. and Byrd,R.H. (1997) L-BFGS-B: Algorithm 778: L-BFGS-B, FORTRAN
routines for large scale bound constrained optimization. ACM Trans Math. Softw.,
23, 5507560.

 

2353

112 /3.IO'S[1211anprOJXO'SOIJBLUJOJIIIOIq”Idllq uror} papao1umoq

9103 ‘0g isnﬁnv uo ::

