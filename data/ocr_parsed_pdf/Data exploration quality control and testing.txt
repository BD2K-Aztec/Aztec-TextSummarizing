ORIGINAL PAPER

Vol. 29 no. 4 2013, pages 461-467
doi:10. 1093/bioinformatics/bts714

 

Gene expression

Advance Access publication December 24, 2012

Data exploration, quality control and testing in single-cell
qPCR-based gene expression experiments

Andrew McDavidl'Z, Greg Finak2, Pratip K. ChattopadyayS, Maria Dominguezs,
Laurie Lamoreaux4, Steven S. Ma“, Mario Roederer3 and Raphael Gottardol'2'*

1Department of Statistics, University of Washington, Seattle, WA 98195, USA, 2Vaccine and Infectious Disease Division,
Fred Hutchinson Cancer Research Center, Seattle, WA 98109, USA, 3ImmunoTechnology Section, Vaccine Research
Center, NIAID, NIH, Bethesda, MD 20892, USA and 4Immunology Laboratory, Vaccine Research Center, NIAID, NIH,

Bethesda, MD 20892, USA
Associate Editor: Janet Kelso

 

ABSTRACT

Motivation: Cell populations are never truly homogeneous; individual
cells exist in biochemical states that define functional differences be-
tween them. New technology based on microfluidic arrays combined
with multiplexed quantitative polymerase chain reactions now enables
high-throughput single-cell gene expression measurement, allowing
assessment of cellular heterogeneity. However, few analytic tools
have been developed specifically for the statistical and analytical chal-
lenges of single-cell quantitative polymerase chain reactions data.
Results: We present a statistical framework for the exploration, quality
control and analysis of single-cell gene expression data from micro-
fluidic arrays. We assess accuracy and within-sample heterogeneity
of single-cell expression and develop quality control criteria to filter
unreliable cell measurements. We propose a statistical model ac-
counting for the fact that genes at the single-cell level can be on
(and a continuous expression measure is recorded) or dichotomoust
off (and the recorded expression is zero). Based on this model, we
derive a combined likelihood ratio test for differential expression that
incorporates both the discrete and continuous components. Using an
experiment that examines treatment-specific changes in expression,
we show that this combined test is more powerful than either the
continuous or dichotomous component in isolation, or a t-test on
the zero-inflated data. Although developed for measurements from a
specific platform (Fluidigm), these tools are generalizable to other
multi-parametric measures over large numbers of events.
Availability: All results presented here were obtained using the
SingIeCellAssay R package available on GitHub (http://github.com/
RGLab/SingleCellAssay).

Contact: rgottard@fhcrc.org

Supplementary information: Supplementary data are available at
Bioinformatics online.

Received on September 20, 2012; revised on November 18, 2012;
accepted on December 16, 2012

1 INTRODUCTION

The development of ﬂuorescence-based ﬂow cytometry (FCM)
revolutionized single-cell analysis. Although populations of cells
sorted by FCM using surface markers may appear monolithic,

 

*To whom correspondence should be addressed.

mRNA expression of speciﬁc genes within these cells can be
heterogeneous (Dalerba et al., 2011) and could further discrim-
inate cell subsets. On the other hand, classical gene expression
experiments [microarrays, RNA-seq, quantitative polymerase
chain reactions (qPCR)] richly characterize a cellular population
but at the cost of reporting a summation of expression from
many individual cells. Recent advances in microﬂuidic technol-
ogy now permit performing thousands of PCRs in a single
device, enabling gene expression measurements at the single-cell
level across hundreds of cells and genes (Kalisky and Quake,
2011). This provides a technology that probes the stochastic
nature of biochemical processes, resulting in relatively large
cell-to-cell expression variability.

This heterogeneity may carry important information; thus,
single-cell expression data should not be analysed in the same
fashion as population-level data. At the scale of a single cell,
biological variability (the object of interest) and technical vari-
ability (a nuisance factor) are often of the same magnitude,
making it difﬁcult to distinguish between the two. No expression
(i.e. the gene is off) may be detected in individual cells owing to
real biological effects, resulting in zero-inflation of otherwise
continuous measures. These features of single-cell data require
special attention during analysis.

Here, we focus on the reverse-transcriptase qPCR (rt-qPCR)-
based Fluidigm (San Francisco, CA) single-cell gene expression
assay, which provides simultaneous measurements of up to 96
genes on mRNA sources as minute as a single cell. In traditional
rt-qPCR, despite careful measurement of input cDNA concen-
trations, differences in starting material below the limit of detec-
tion require correction for reliable results (V andesompele et al.,
2002). Subtraction of internal control genes, or averages thereof
is typically used (e.g. the A-Ct method), and results are often
reported in fold increase per cell (Schmittgen and Livak, 2008).
In array-based gene expression, differences in hybridization and
washing of non-speciﬁc DNA between chips require additional
correction.

Such normalization schemes are not directly applicable in
single-cell gene expression experiments, nor is it obvious that
they are needed. For single cells, the individual cell is the
atomic unit of normalization and the amount of starting material
naturally measured in number of cells per reaction. Even if
one attempted direct application of traditional normalization

 

© The Author 2012. Published by Oxford University Press. All rights reserved. For Permissions, please e—mail: journals.permissions@oup.com
This is an Open Access article distributed under the terms of the Creative Commons Attribution License (http://creativecommons.org/Iicenses/by/3.0/), which
permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.

112 /310'S[BIIJHO[pJOJXO'SOlJBLUJOJIIlOlq”Zduq 11101} pepaolumoq

9103 ‘Og anﬁnV uo ::

A.McDavid et al.

 

approaches, the dichotomous nature of single-cell expression hin-
ders their use.

Nonetheless, it is important to test for and address any tech-
nical biases. We present a ﬁltering approach for removing out-
lying measurements at the single-cell level that accounts for the
dichotomous nature of the data. Using concordance measures
derived from three datasets where gene expression was measured
at the single-cell and 100-cell levels, we show that classical
rt-qPCR type normalization is not necessary with single-cell
multiplexed PCR data, and that our filtering step removes tech-
nical artifacts that most severely impact quantitation.

A typical goal of gene expression experiments is to search for
differential expression across groups. The zero-inﬂation of ex-
pression in Fluidigm introduces problems for testing differential
representation of cell subsets characterized by expression
patterns, as well. Traditional tests of differential expression
such as the t-test or other approaches based on normality are
likely inappropriate for zero-inﬂated data (Gottardo et al., 2006;
Smyth, 2004). Approaches to this problem have varied. Powell
et al. (2012) used a winsorized z—transformation of the expression
values and then treated them as continuous. Glotzbach et al.
(2011) used the non-parametric, Kolmorgov+Smirnov test for
differences in distribution to find differentially expressed genes
after winsorizing. Flatz et al. (2011) dichotomized the expression
and worked with the binary trait. Of these authors, only Flatz
et al. (2011) and Glotzbach et al. (2011) made use of formal tests
of differential expression. However, as we will see later, both the
continuous and discrete parts of the measurements are inform-
ative for differential expression and should be used. A parametric
test allows directions of difference to be assessed.

Here, we propose a discrete/continuous model for single-cell
expression data based on a mixture of a point mass at zero and a
log-normal distribution. Using this model, we derive a likelihood
ratio test (LRT) that can simultaneously test for changes in mean
expression (conditional on the gene being expressed) and in the
percentage of expressed cells.

2 METHODS

2.1 Datasets and notations

We use three Fluidigm single-cell gene expression datasets described later
in the text. We offer a brief overview of the assay technology used for our
data. Desired cells (e.g. antigen-speciﬁc CD8+ T cells) are selected
and lysed, and a cDNA library is generated through rt-qPCR. A short
(0. 15 cycle), multiplexed pre-ampliﬁcation selects and enriches for the
desired genes. These products are loaded onto the Fluidigm chip, and
gene-speciﬁc primers are added for single-cell gene expression quantita-
tion. For the data presented here, we used a 96 x 96 format plate, i.e. 96
genes across 96 cells. The design of the chip generates each combination
of the 96 genes and 96 enriched cDNA libraries producing 9216 separate
PCR reactions. After each cycle, the ﬂuorescence is read. The cycle
(or interpolated fraction thereof) at which the ﬂuorescence crosses a
pre-determined threshold is recorded, deﬁned as the ‘ct’ value. For all
datasets considered here, primers were chosen to have >90% ampliﬁca-
tion efﬁciency.

Dataset A: Twenty-eight 96 x 96 format plates of CMV- or HIV-speciﬁc
CD8+ single cell T cells were isolated from 16 individuals. The donors’
cells were stimulated with one of four tetramers. Cells were sorted imme-
diately after tetramer incubation (‘unstimulated’) or after 3 hours of

exposure (‘stimulated’). Approximately 90 individual cells were measured
for each patient-stimulation combination (‘unit’).

Dataset B: Ten subjects were considered, and ~180 activated CD4+
memory T cells were sorted per subject, with each subject crossed between
two arrays.

Dataset C: Two subjects were considered. Fluorescent staining of CD4+
T cells allowed cytometric sorting into CD154+/— sub-populations.
Approximately 40 cells were sorted per sub-population per subject
across three arrays.

Additionally, for each individual and treatment within each dataset,
aggregates of 100 cells (i.e. 100 cells per well on the array) were isolated
and assayed by Fluidigm technology. The expression measured in these
100-cell aggregates, after dividing by 100, provides a ‘biological’ average
of expression per cell and can be compared with an in silico average of the
single-cell measurements. The concordance between these two averages
serves as a measure of experimental ﬁdelity (Lin, 1989).

Notations: The standard assumptions of qPCR-based assays apply to the
Fluidigm technology, namely that the cycle threshold (ct) is inversely
proportional to the log of ﬂuorescence. The ﬂuorescence is directly pro-
portional to the starting concentration of mRNA (Higuchi et al., 1992;
Karlen et al., 2007). The Fluidigm instrument returns the cycle threshold
(ct); however, we ﬁnd it more useful to work with the complement of ct,
which we define as the expression threshold (et)

et 2 cmax — ct

where cm1x is the maximum number of cycles used, 40 in our case.
Assuming all reactions are in the exponential ampliﬁcation phase, this
quantity should be directly proportional to the log-abundance of mRNA,
plus an intercept term corresponding to the number of cycles it takes
for the minimally detectable quantity of mRNA to cross threshold. If
the ﬂuorescence does not cross the threshold after 40 cycles, then the
Fluidigm instrument records a value of N/A, and we say that the gene
is not detected. As we will see in the Section 3, detected genes typically
have a value of ct much less than cm“, suggesting that undetected genes
might be regarded as unexpressed genes. This assumption is supported by
the idea that transcription of mRNA is thought to occur in bursts of
activity (Kaufmann and van Oudenaarden, 2007; Levsky et al., 2002),
followed by quiescence. Other authors have noted this feature in single-
cell expression studies as well (Glotzbach et al., 2011). When looking at
the concordance of the single-cell and 100-cell experiments, this assump-
tion is reasonable and leads to better concordance than omitting the N/A
values. As a consequence, we treat the undetected genes as unexpressed
genes, and we set the corresponding et value to —00 so that the mRNA
abundance is zero (i.e. 2” = 0).

For a fixed sample or experimental unit, let us denote by etij the
expression threshold of well i and gene j, for i = 1, . . . , I and
j = 1,. . . ,J. This results in a matrix of log —based expression values,
ET 2 (en-j), just as in array-based gene expression. Similarly, we will
denote by Y =(y,-j) the matrix of untransformed expression values,
where yij = 2””. Usually, a well contains one cell, but the Fluidigm tech-
nology can be used with multiple cells per well to quantify the gene
expression of a mixture of cells. As a consequence, we prefer to use the
term ‘well’ instead of ‘cell’. In the three datasets used here, wells will
contain either 1 or 100 cells. Finally, several biological units are typically
measured in an experiment, and in this case, we will use an extra index k
to refer to the biological units.

2.2 A model for single-cell expression

As described previously, for a given cell, a gene can be deﬁned as on
(i.e. a positive et value is recorded) or as oﬂ (i.e. the gene is undetected
and yij : 0). To simplify our model, we will denote by vi]- : 1[y,-j>0] the
indicator variable equal to one if the gene j is expressed in well i and zero

 

462

112 /310's112u1n0fp10}x0"sotJBuiJOJutotq/ﬁduq 11101} papeolumoq

9103 ‘Og isanV uo ::

Statistical methods for single-cell gene expression

 

otherwise. Following classical statistical conventions, we use upper cases
to denote the random variables and lower cases to denote the values
taken by these random variables. Using these notations, we introduce
the following model of single-cell expression

(Ya-I14,- = 1) ~ logNorma1(u,-.a,2) (1)
(YijIVij = 0) ~ 80 (2)
Vij ~ 136011) (3)

where 80 denotes a point mass at zero, W and 01.2 are the logz-based mean
and variance expression-level parameters conditional on the gene being
expressed (i.e. V," = 1), and :1]- is the frequency of expression of gene j
across all cells. In the datasets considered here, the frequency of expres-
sion greatly varies across genes from 0 to 0.99 with a median value of IT]-
~0.1 (see Supplementary Fig. Sl). Assuming a log-Normal model for
(Ya-l Vi]- : 1) is equivalent to modeling (ETg-l Vi]- : 1) as normally distrib-
uted. The empirical distribution of the data (Fig. 1 and Supplementary
Figs 887810) motivates our selection of a log-normal distribution and
follows observations of previous authors (Bengtsson et al., 2005).

Thus, in a particular gene, three parameters characterize the expression
distribution: m, of, the mean and standard deviation of the etijl Vi]- : 1,
and 211-, the Bernoulli probability of expression.

2.3 Quality control and ﬁltering

The Fluidigm assay is sensitive, and owing to the exponential ampliﬁca-
tion of starting mRNA, even minute contamination can render a mea-
surement unreliable. Similarly, variation in cell preparation can have
signiﬁcant impact on the resulting experiment and data, such as uninten-
tional empty wells, which would distort estimates of 211-. This suggests
identifying, and possibly removing outliers before conducting further
analysis. We examine both the discrete component vij and the continuous
component (et,-j|v,-j = 1) in screening for outliers. We deﬁne the robust
z-transformed positive expression value as

etij — median,- (etij)
k f  ,

2,];

where the median and median absolute deviation (MAD) are calculated,
for a given gene, over expressed cells (i.e. vij = 1), and k = 1.48 is a
scaling constant that gives the standard deviation in terms of the MAD
for the normal distribution. Next, let f,- = asinﬁ; be the Bernoulli var-
iance-stabilizing transformation of the proportion of genes expressed in
well i. Then, we deﬁne the robust z-transformed fraction as

f,- — median,- (fi)

if; k BLADAﬁ)

where the median, MAD and k are as deﬁned previously. This leads to
the following steps for ﬁltering:

(1) Remove null cells with no detected genes, i.e. Vi]- : 0, for all j.
(2) Pick threshold for z ﬁltering ([2); threshold for g ﬁltering ([5).
(3) Calculate 2,-1- and (i.

(4) Remove wells in which genes have |z| >tz OR |§| >t;.

Step 1 removes wells where no cells were loaded, and thus all measured
expression values are null. It is important to perform this step ﬁrst to
prevent break-down in the median and MAD estimates for the zeta
values in experiments with many ampliﬁcation or FCM failures.
Finally, step 4 removes unreliable wells that either have an extreme pro-
portion of expression or extreme cell x gene expression values. The
thresholds tz and t; control the tolerance to outliers; therefore, typical
advice for outlier thresholding applies. Biological replicates, such as the
100-cell replicates described in Section 2.1, permit the assessment of intra-

10 14 18 22 26 30

 

 

 

 

 

 

 

 

 

I|l|lI|I|lII|l||I|l||I
FASLG IFNg
— -45
_ — 4o
' ‘38
_ (1) _
_ 1t 1 _25
- -20
g : nl‘)o.59 :13
— — 5

lg — — o

4.. BIRC3 CD69

c _ _

a, 45

g 40 — _

61-) 35- -
33: 169—033 :
$3: n<‘)=o.97 :
1o — —
5— _
0_ _

IIIIIIIIIIIIIIIIIIIIII

10 14 18 22 26 30
Iog2(mRNA) (ET)

Fig. 1. Histogram and theoretical (normal) distribution of (et,-j|v,-j = 1)
for single-cell (left, light gray) and 100-cell experiments (right, dark gray).
Genes FASLG, IFN- y, BIRC3 and CD69 are depicted. The frequency
expression of each gene in the single-cell experiments 21(1) is printed above
each histogram. The mean of the 100-cell and single-cell experiments
is indicated by a thick black line along the x-axis

class deviance, and then the thresholds can be selected to minimize this
deviance. We present such a calculation in the Supplementary Material.
Using this approach, we ﬁnd that picking tz = 9, t; = 9 works well for the
datasets we consider here, see Section 3.

2.4 Testing for ET differences between experimental
groups

One typical goal of gene expression analysis is to test for difference in
expression patterns between experimental units. Here, we focus on testing
differential gene expression between two paired-biological units, e.g.
before and after stimulation. Our framework should be generalizable to
other types of situations, see Section 4. The classical test for changes in
mean for samples with continuous measurements is the t-test. Conversely,
if only a change in 1'! were of interest, then a contingency table test (Chi-
square, Fisher’s exact or Bernoulli likelihood ratio) is appropriate.
However, in our case, we would like to test for a change in p. and 1'!
simultaneously, as both could be biologically relevant. Formally, we wish
to test

H02ﬂ0=ﬂ1 and M0=lt1
versus the alternative
Harmném and Morel“.

This can be accomplished using an LRT that would simultaneously
test for differences in means or proportions of expression.

Suppose that I wells are assayed in each unit, though the unbalanced
case (Io 7e 11) would be treated similarly with obvious changes of
notation. Based on (1), the likelihood function for one gene across two
biological units, omitting the gene index j for clarity, is given by

L(6Iy.v) = H :1ku — not“ Ugo-kink. oz) (4)
k

resk

 

463

112 /310's112u1n0fp10}x0"sotJBuiJOJutotq/ﬁduq 11101} papeolumoq

9103 ‘Og isanV uo ::

A.McDavid et al.

 

where y and v are the vectors of observations for the gene across the
two groups, 6 = {uk,02,nk;k = 0,1} is the vector of unknown para-
meters, Sk is the set of cells expressing the gene in group k (i.e.
Sk = {i: vik = 1}), nk = Zivik is the number of cells expressing the
gene in group k and g is the density function of the log-normal distribu-
tion with parameters uk and 02. The LRT statistic A(y, v) is then deﬁned
as the ratio of the null and alternative likelihoods obtained by replacing
the unknown parameters with their null and alternative maximum like-
lihood estimates. Detailed derivations of the likelihood function and the
LRT statistics are described in Supplementary Material.

An interesting observation is that the likelihood function given by (4) is
the product of the Bernoulli likelihood for all cells and the log-normal
likelihood for the expressed cells. It follows that the log-LRT statistic
decomposes as a sum of a Bernoulli log-LRT test statistic and a log-
normal log-LRT test statistic, as each component can be maximized
independently. It thus combines the two sources of information in a
natural way, and this decomposition allows post-hoe assessment of
which of the component(s) drive the detected difference by simply com-
paring the magnitude of the two log-LRTs. In Section 3, we will show
that our combined LRT test is more powerful than the Bernoulli or log-
normal tests alone.

Applying classical asymptotic results about LRTs (Wilks, 1938),
—2 log A(y, v) converges to a X2 distribution with two degrees of freedom
under H0. Some care is warranted in invoking this asymptotic result,
as even for large I, the sample size for the log-normal LRT will be :11.
We show in Supplementary Figs S2 and S3 that the X2 convergence is
adequate for :11 >8 even under departures from normality. Below this
value, it is possible to derive the null distribution of this statistic through
permutation procedures as is commonly done for microarray data (Ge et
al., 2003). This proviso applies similarly for purpose of power calcula-
tions; hence, one may wish to conduct these through simulation.

3 RESULTS
3.1 Distributional assumptions

In Figure 1, we observe good agreement between the empirical
distributions of positive et values and their postulated normal
distribution for four genes in dataset A. This conﬁrms that a
log-normal model for the positive expression level, yijlvij = 1, is
appropriate. Even cells in the lowest quantiles of et (and lowest
quantiles of expression) still have expression far away from the
bound at 0, suggesting that undetected genes represent cells with
null or negligible RNA abundance. It is also noteworthy that the
difference between the means (shown as a heavy, vertical line) of
the 100-cell replicates and single-cell replicates is approximately
log2(100 - 711(1)) cycles, where 711(1) is the expression frequency of
gene j in the single-cell experiments. As such, in genes with
711(1) << 1, such as FASLG, this difference between means is smal-
ler than genes with 711(081. As we will see the next section,
inclusion of the unexpressed cells (vb-=0) is important to accu-
rately relate the expression level of the single-cell experiments to
the 100-cell experiments.

3.2 Concordance between 100-cell and single-cell
experiments

The 100-cell aggregates (see Section 2.1) allows us to assess the
accuracy and reliability of our single-cell experiments by compar-
ing this in vitra 100-cell expression to an in silica estimate
obtained by averaging the expression of 100 single-cell measure-
ments. The in silica average of signal in a gene j and unit k from

100 single-cell wells is y}? =  yijk/100 where yijk is the
expression measurement of gene j in cell i and unit k. We com-
pare this with the in vitra ‘average’ of signal from a 100-cell
aggregate. In this case, we just use the expression of a gene
unit and divide by the number of cells (100).

The concordance here is assessed both Visually by plotting
log2(y](-,:) + 1) versus log2(y](.,:00) + 1) (Fig. 2) and by calculating
the concordance correlation coefﬁcient (rc) between the two vari-
ables, which is often used to quantify reproducibility (Lin, 1989).
The shifted log transformation allows Visualization of both the
discrete and continuous components while being on the et scale.

We first use this concordance experiment to test whether wells
that do not cross the ﬂuorescence threshold after cmx should be
treated as exact zeroes or missing values. If we suppose that
vi]- : 0 implies an assay failure and the measurement should
be discarded, we would simply compute the single-cell average
over expressed cells, i.e. y)” = 2,. yijvij/ 2,. vi). Figure 2 demon-
strates good concordance between the 100-cell and single-cell
experiments when the undetected genes are treated as zeros.
However, this is not the case when the zeros are treated as
missing values.

3.3 Filtering outlying cells

In addition to the concordance measure rc, we use another
goodness-of—fit measure to optimize our ﬁltering parameters tz,
I; deﬁned by,

_ 2
wss = ank(log2(yj(.,:) + 1) —1og2(y;,:°°> + 1)) /JK (5)
j,k

where njk = 2,. ijk is the number of positive wells for gene j in
unit k in the single-cell experiments. For a particular gene and
unit, the WSS decreases as we lower the ﬁltering threshold and
extreme values are filtered. Eventually, so many cells are
removed that there is zero expression (and a large deviance)
for the in silica estimate. Thus, we wish to find a set of values
for the ﬁltering parameters that would lead to the lowest WSS
measure across the three datasets used here. The addition of the
scaling factor njk gives higher weight to combinations with more
ex ante positive observations so that the contribution to the sum
of squares would be smaller in gene x unit combinations that
have fewer expressed cells. The factor njk can also be interpreted
as the scaling factor for the variance of the mean over positive
observations. Finally, the WSS is computed on the log2(y + 1)
scale to reduce the effect of extreme outliers.

When 100-cell aggregates are available, one can optimize
the filter parameters tz, t; by minimizing the W over possible
combinations. In our case, we found that setting I = 9, t; = 9
achieves the best reduction in WSS across the three datasets
explored here (Supplementary Figs S4+S6 and Supplementary
Table S1). Using these values, our ﬁltering criteria moderately
improve the concordance between the single-cell and 100-cell
experiments in two of the datasets but dramatically improve
(decrease) the weighted sum of squares. This improvement is
evident graphically, as the per unit averages of et of multiple
genes move toward the diagonal.

Beside improving WSS and generally improving rc, we explore
the effect of filtering on detection of control genes in the
Supplementary Material (Supplementary Table S2).

 

 

 

 

 

 

464

112 /3.10's112u.m0[p.101x0"sotJBuiJOJHtotq/ﬁduq 111011 pep201um0q

9103 ‘0g isanV uo ::

Statistical methods for single-cell gene expression

 

 

 

 

 

 

 

 

 

C
25— —
20— —
§
15—2 5 _
03 3
O
 1 -
a no
5— j —
0_ no u on _
C — -25
wig) WSS=51.8
5 —w rc=0.46 —20
g 8
a) —E —15
E a
E —: _1o
0 a
E J“ —5
'0
c
:5
I _ —O
25— —
WSS=31.2 on:
20— —
§
15-23 g —
E I
10—: i. _
a no
5— Z -
0— o no own-non» no u 00 —

 

 

 

 

 

 

 

Single Cell log—expression

Fig. 2. Concordance between 100 cell y(100)/ 100 and ya), the in silica average of single-cell wells for datasets A, B and C. In the top row, wells with vi]- : 0
are included and treated as exact zeroes. In the middle row, they are excluded, resulting in a clear lack of concordance. In the ﬁnal row, wells are ﬁltered
as per Section 2.3. Dark, thin lines show the initial location of a gene before ﬁltering and connect to the location of the gene after ﬁltering. In each panel,
r,., the concordance correlation coefﬁcient and WSS, the average weighted squared deviation of expression measurements is printed. The dotted black
line shows a loess ﬁt through the data. In all cases, the expression values are transformed using a shifted log-transformation [log2(y + 1)]. As such, a

 

graphed value of zero corresponds to a zero expression value (i.e. y = 0)

3.4 Normalization and housekeeping genes

Other authors have noted that ‘the gene transcript number is
ideally standardized to the number of cells’ (Vandesompele
et al., 2002), which is the case with gene expression from
sorted cells. Therefore, it is not entirely a surprise that we find

little evidence for housekeeping genes providing useful normal-
ization here. For a housekeeper to have good validity, it should
have high cross-correlation with other housekeeping genes.
This is not the case for housekeepers GAPDH and POLR2A,
which in dataset A, in linear regression, have an R2 = 0.027.

 

465

112 /3.10's112u.m0[p.101x0"sotJBuiJOJHtotq/ﬁduq 111011 pep201um0q

9103 ‘0g isanV uo ::

A.McDavid et al.

 

 

HIVnel(KF11) CMVpp65(NLV5)

 

 

Test
— Bernoulli

 

 

cMVppesnMw) ngamsm)  Combined
--- Normal

 

- - I-Iesl

Number of Discoveries

 

 

 

 

 

 

1
0.001 0.01 0.1

I
1e-04 0.001 0.01

. 4
False Discovery Rate

Fig. 3. Number of discoveries (genes x units) versus FDR, by treatment,
dataset A. The combined LRT is compared with a Bernoulli or normal-
theory only LRT, as well as a t-test of the raw expression values
(2” scale), including zero measurements

In Supplementary Figure S7, we observe in scatter plots of
housekeepers’ et that the correlation drops even further (to an
R2 = 0.017) after filtering outlying cells (see previous section). As
the correlation between housekeepers is present primarily in cells
we suspect suffered from technical error, we ﬁnd little utility in
normalization schemes. In fact, the use of housekeeping genes for
normalization could even result in masking cellular artifacts that
should be filtered.

3.5 An efﬁcient test of differential expression for single
cells

In dataset A, ~90 cells in each of 16 subjects were measured in
unstimulated and stimulated states (see Section 2.1). This permits
conducting a test for each gene in each subject for differences in
71 and 11, as described in Section 2.4. We plot the number of
discoveries at various false discovery rates (FDR) in Figure 3.
The combined likelihood test produces the greatest number of
discoveries over a wide range of FDR. For example, at an FDR
of 1%, our combined test could detect more than 20 additional
gene x unit changes across the four stimulations.

Another feature of the combined LRT is its robustness to
background gene frequency 711-. Of course, if 71]- B 0 on average,
then any test will be underpowered to detect group differences.
But using only the continuous components amounts to
“throwing away” data for genes with intermediate 70. And simi-
larly, using only the dichotomous component results in a test
insensitive to differences in [z]- in frequently expressed genes.
This robustness to the 70 spectrum is shown in Figure 4 in
which —log10 P-Values are shown for the Bernoulli, normal
and combined LRTs versus frequency of 70.

 

 

 

E . . . Tst‘rype
g . -Bemoulli
'5‘: ' , .Corrbined
Li" . awormal
. I u u
. . .
, . .
.‘ o I
5- ' -
. - I
i := ' . n
' t: ' . ' ° o
. ; . - . ' 3
i I .= .
i: u . '
i i : ° u n
.
.
.
0.
¥ * ¥ ¥ ¥ ¥ 4

 

 

[0.111) 10.1302) [02:03) [03:011qu Lixﬁgibf gipgsigém) [(17:08) [03:09) [0.54.11
Fig. 4. — loglo P of tests (genes x units) versus frequencies of expression
1'! of the genes. The Bernoulli, normal-theory and combined LRTs are
plotted. Asterisk indicates test is different from the combined test at 5%
signiﬁcance in a Wilcoxon signed-rank test

Color Key
.4
l:
85
O
O
—5 o 5
Value

 

 

 

 

Fig. 5. Heatmap of signed log10 P for selected genes (rows, see main text)
and all 16 individuals (columns). The color above each column indicates
the antigen stimulation applied to the cells; thus, individuals are ran-
domly arranged in each antigen block. Red and purple are two different
CMV antigen pools; yellow and orange are two different HIV antigen
pools

A total of 65 genes were detected at an FDR of 1% in at least
one individual. We deﬁne P* = —sign(/zl — no) -log10P as the
negative log10 P—Value times an indicator variable, which is
positive when stimulated groups have greater expression, and
negative otherwise. Figure 5 plots a heatmap of signed loglo

 

466

112 /3.10's112u.1n0[p.101x0"satieuuqutotq/ﬁduq 111011 pep1201um0q

9103 ‘0g isanV uo ::

Statistical methods for single-cell gene expression

 

P-Values. The selected genes are in clustered rows; the 16 indivi-
duals are arranged in columns by stimulation. The color above
each column indicates which of the four antigen stimulations
the individual received. From this, it is clear that genes cluster
into upregulated and downregulated modules, and that there is
much individual variability in response. Some genes appear to
have stronger responses to particular antigens, such as the
response to CMV (red and purple columns) in FASLG and
CLEC2B.

4 CONCLUﬁONS

Current approaches for analysis of single-cell assays have
incompletely used the salient features of the experiment, and
the resulting inference can be suboptimal. In this article, we
have presented a framework for data exploration, quality control
and testing for differential expression using single-cell data.
Our comparison of 100-cell and single-cell measurements
shows that undetected genes in an assay should be treated as
effective ‘zeroes’. Both the discrete, zero-inﬂated portion and
continuous portion of single-cell expression data are meaningful
for detecting outliers. Moreover, differences in either could be
of biological interest; therefore, it is desirable to combine evi-
dence from both to detect changes in expression. Our LRT
allows just that.

Although we have suggested default parameters for the
ﬁltering of outliers, informed from several datasets, our defaults
are likely conservative. They are 3+4 times larger than the most
substantial difference in expression between experimental groups
we observed. Acquiring forms of ground-truth besides ‘bulk’
experiments (in our case, 100-cell aggregates) could allow form-
ing tighter bounds. As in any outlier-based ﬁltering procedure, it
is desirable to tune for the problem at hand. The thresholds tz
and t; should be different when eliminating potential technical
error is of greatest concern than when one is most interested in
searching for biological heterogeneity.

In this article, we have used the X2 asymptotic distribution of
the LRT to compute P-Values and assess signiﬁcance. This
approximation is relatively accurate and robust to the distribu-
tional form of Y when the expected number of expressed cells is
greater than 8 (see Supplementary Material). Otherwise, approx-
imating the null distribution using permutations as in Ge et al.,
2003 is more appropriate.

Further work, incorporating a mixed-effects model to our
LRT, could extend its applicability. The test outlined in this
article may not be appropriate in cases where traits of interest
are not blocked within individuals (e. g. comparing between phe-
notypes like HIV+ versus HIV—). In this case, one wishes to
identify gene expression changes across groups, despite high indi-
vidual-to-individual heterogeneity. By modeling the mean and
proportion of expression as common across groups and adding
speciﬁc random effects for between-individual variability, our
model could be extended to address such experimental questions
as well.

Single-cell gene expressions assays have already been shown
to be useful in multiple studies and will become even more rou-
tine once sequencing at the single-cell level becomes practical
(Ramskold et al., 2012; Varadarajan et al., 2011). As a conse-
quence, the development of effective statistical methods to ana-
lyse such data is becoming increasingly important. This article
offers a coherent framework for researchers using this nascent
technology.

Funding: Intramural Research Program of the National Institute
of Allergy and Infectious Diseases, National Institute of Health
and the Collaboration for AIDS Vaccine Discovery [#38650];
National Institute of Health [U19 A1089986-01, R01 EB008400
to R.G., GR and A.M.]; and the Bill & Melinda Gates
Foundation [#OPP1032325].

Conﬂict of Interest: none declared.

REFERENCES

Bengtsson,M. et al. (2005) Gene expression proﬁling in single cells from the pan—
creatic islets of Langerhans reveals lognormal distribution of mRNA levels.
Genome Res., 15, 138871392.

Dalerba,P. et al. (2011) Single—cell dissection of transcriptional heterogeneity in
human colon tumors. Nat. Biotechnol, 29, 112G1127.

Flatz,L. et al. (2011) Single—cell gene—expression proﬁling reveals qualitatively dis—
tinct CD8 T cells elicited by different gene—based vaccines. Prac. Natl Acad. Sci.
USA, 108, 572475729.

Ge,Y. et al. (2003) Resampling—based multiple testing for microarray data analysis.
TEST, 12, 1777.

Glotzbach,J.P. et al. (2011) An information theoretic, microﬂuidic—based single
cell analysis permits identiﬁcation of subpopulations among putatively homo—
geneous stem cells. PLaS One, 6, e21211.

Gottardo,R. et al. (2006) Bayesian robust inference for differential gene expression
in microarrays with multiple samples. Biometrics, 62, 1&18.

Higuchi,R. et al. (1992) Simultaneous ampliﬁcation and detection of speciﬁc DNA
sequences. Biotechnology, 10, 4137417.

Kalisky,T. and Quake,S.R. (2011) Single—cell genomics. Nat. Meth., 8, 3117314.

Karlen,Y. et al. (2007) Statistical signiﬁcance of quantitative PCR. BMC
Biainfarmatics, 8, 131.

Kaufmann,B.B. and van Oudenaarden,A. (2007) Stochastic gene expression: from
single molecules to the proteome. Curr. Opin. Genet. Dev., 17, 1077112.

Levsky,J.M. et al. (2002) Single—cell gene expression proﬁling. Science, 297, 8364140.

Lin,L.I. (1989) A concordance correlation coefﬁcient to evaluate reproducibility.
Biometrics, 45, 2557268.

Powell,A.A. et al. (2012) Single cell proﬁling of circulating tumor cells: transcrip—
tional heterogeneity and diversity from breast cancer cell lines. PLaS One, 7,
e33788.

Ramskold,D. et al. (2012) Full—length mRNA—Seq from single—cell levels of RNA
and individual circulating tumor cells. Nat. Biatech., 30, 7777782.

Schmittgen,T.D. and Livak,K.J. (2008) Analyzing real—time PCR data by the
comparative CT method. Nat. Protocols, 3, 110171108.

Smyth,G.K. (2004) Linear models and empirical bayes methods for assessing differ—
ential expression in microarray experiments. Stat. Appl. Genet. Mal. Biol., 3,
article 3.

Vandesompele,J. et al. (2002) Accurate normalization of real—time quantitative
RT—PCR data by geometric averaging of multiple internal control genes.
Genome Biol., 3, RESEARCH0034.

Varadarajan,N. et al. (2011) A high—throughput single-cell analysis of human CD8
T cell functions reveals discordance for cytokine secretion and cytolysis. J. Clin.
Invest., 121, 43224331.

Wilks,S.S. (1938) The large—sample distribution of the likelihood ratio for testing
composite hypotheses. Ann. Math. Stat, 9, 60—62.

 

467

112 /3.10's112u.1n0[p.101x0"sotwuuqutotq/ﬁduq 111011 pep1201um0q

9103 ‘0g1sn8nv uo ::

