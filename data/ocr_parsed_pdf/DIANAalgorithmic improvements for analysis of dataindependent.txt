ORIGINAL PAPER

Vol. 31 no. 4 2015, pages 555—562
doi:1 0. 1093/bioinfonnatics/btu686

 

Gene expression

Advance Access publication October 27, 2014

DIANA—algorithmic improvements for analysis of
data-independent acquisition MS data

Johan Telemanl'z, Hannes L. Boste’, George Bosenbergere’, Uwe Schmitt“,
Lars Malmstroms, Johan Malmstrom” and Fredrik Levander2'*

1Department of Clinical Sciences, Lund University, BMC B14 221 84 Lund, 2Department of Immunotechnology,
Lund University, Medicon Village (Building 406) 223 81 Lund, Sweden, 3Department of Biology, Institute of Molecular
Systems Biology, 4ITS Scientific IT Services, ETH Zurich and 5SIT, University of Zurich, Winterthurerstrasse 190, 8057,

Zurich, Switzerland
Associate Editor: Ziv Bar—Joseph

 

ABSTRACT

Motivation: Data independent acquisition mass spectrometry has
emerged as a reproducible and sensitive alternative in quantitative
proteomics, where parsing the highly complex tandem mass spectra
requires dedicated algorithms. Recently, targeted data extraction was
proposed as a novel analysis strategy for this type of data, but it is
important to further develop these concepts to provide quality-con-
trolled, interference-adjusted and sensitive peptide quantification.
Results: We here present the algorithm DIANA and the classifier
PyProphet, which are based on new probabilistic sub-scores to clas-
sify the chromatographic peaks in targeted data-independent acqui-
sition data analysis. The algorithm is capable of providing accurate
quantitative values and increased recall at a controlled false discovery
rate, in a complex gold standard dataset. Importantly, we further dem-
onstrate increased confidence gained by the use of two complemen-
tary data-independent acquisition targeted analysis algorithms, as well
as increased numbers of quantified peptide precursors in complex
biological samples.

Availability and implementation: DIANA is implemented in scala and
python and available as open source (Apache 2.0 license) or pre-
compiled binaries from http://quantitativeproteomics.org/diana.
PyProphet can be installed from PyPi (https://pypi.python.org/pypi/
pyprophet).

Supplementary information: Supplementary data are available at
Bioinformatics online.

Received on June 27, 2014; revised on September 26, 2014; accepted
on October 15, 2014

1 INTRODUCTION

Accurate and precise quantification of proteins is a critical com-
ponent of life science and systems biology applications. The pre-
vailing method for quantification of complete proteomes was
until recently data-dependent acquisition (DDA), also referred
to as shotgun mass spectrometry (MS). Shotgun MS can provide
extensive maps of the measurable and expressed proteomes of a
large numbers of organisms, tissues, organs and organelles.
However, <50% of identiﬁed peptides are typically shared

 

*To whom correspondence should be addressed.

between two replicate shotgun MS injections (Tabb et al.,
2010), requiring multiple injections of the same sample to repro-
ducibly measure peptides in all samples (Liu et al., 2004; Vincent
et al., 2013; Bailey et al., 2014). The limited analytical reprodu-
cibility observed in shotgun MS has fuelled the development of
targeted MS strategies such as selected reaction monitoring
(SRM), to increase reproducibility and speciﬁcity compared
with shotgun MS (Wolf-Yadlin et al., 2007).

To perform targeted MS strategies requires a priori deter-
mined information on how to target a given peptide sequence.
Such information typically consists of the peptide sequence, the
preferred charge state, the empirical or predicted high perfor-
mance liquid chromatography (HPLC) elution time, as well as
the relative intensities and masses of the n most prominent frag-
ments. The construction of these MS assays requires a substan-
tial effort, which has resulted in the assembly of public
repositories of peptides and MS assays, to simplify further stu-
dies (Desiere et al., 2006; Picotti et al., 2008; Farrah et al., 2012;
Karlsson et al., 2012). Although the targeted MS strategies such
as SRM provides reproducible and accurate protein quantiﬁca-
tion, the throughput is normally limited to up to a few hundred
peptides per injection (Picotti et al., 2009; Waldemarson et al.,
2012), limiting the technique for whole-proteome studies.

Data-independent acquisition MS (DIA-MS) was originally
used to improve peptide identification rates (Purvine et al.,
2003; Plumb et al., 2006; Panchaud et al., 2009), but lately work-
ﬂows using DIA-MS combined with targeted data extraction
have been described in attempts to combine the reproducibility
of SRM with the throughput of shotgun MS (Gillet et al., 2012;
Weisbrod et al., 2012; Egertson et al., 2013). Data acquisition in
DIA-MS relies on deterministic splitting of the survey scan pep-
tide-ion mass range into one or more subsets, followed by co-
fragmentation of all precursor masses in one entire subset, while
leaving the de-convolution of the peptide ions in these complex
MS2 spectra to the post-acquisition analysis. The acquisition
method yields complete MS2-retention time maps, compared
with the discontinuous maps of shotgun MS, and can be seen
as a complete digitization of the sample as seen by the mass
spectrometer.

Targeted extraction DIA-MS has the sensitivity, precision, re-
producibility and dynamic range to allow deep large-scale meas-
urement of the proteomes of biological systems (Collins et al.,

 

© The Author 2014. Published by Oxford University Press. All rights reserved. For Permissions, please e—mail: journals.permissions@oup.com 555

112 /310's112u1n0fp10}x0"sotJBurJOJutotq/ﬁduq 11101} papBoIII/noq

91oz ‘Og anﬁnV uo ::

J.Teleman et al.

 

2013). However, the strategy’s data analysis needs further im-
provement, and currently only a few tools exist that are capable
of large-scale robust targeted extraction DIA-MS analysis
(Bernhardt et al., 2012; Egertson et al., 2013; Rost et al.,
2014). The poor availability of data analysis tools limits robust-
ness, as users are blindly exposed to any potential error in the
particular algorithm used, and lowers sensitivity, as parts of the
proteome might be unreachable due to the potential preferences
of a given algorithm. For example, the combination of multiple
algorithms in shotgun MS has been shown to increase the
amount of peptide-spectrum matches with up to 50% compared
with a single algorithm (Hakkinen et al., 2009; Jones et al., 2009;
Nahnsen et al., 2011; Shteynberg et al., 2013).

We have previously described algorithms for detection of the
correct signals in SRM chromatograms based on fragmentation
patterns (Teleman et al., 2012), and we hypothesized that these
concepts can further improve the targeted data analysis in DIA
data, and also provide complementarity towards existing tools.
Here, we investigate this by combining the DIA-MS targeted ana-
lysis strategy with our previous efforts in SRM data analysis, and
present a new algorithm and software for automated analysis of
DIA-MS data. The algorithm, called DIANA, introduces a new
function for computing chromatographic peak sub-scores based on
expected ratios between fragments, as well as a new interference-
corrected measure of quantity. These factors, together with the new
semi-supervised classiﬁcation tool PyProphet, increase the
amounts of peptide quantiﬁcations and enable more accurate
quantiﬁcations in complex samples. Finally, we also demonstrate
that DIANA is complementary to the previously published
OpenSWATH software (Rost et al., 2014), and that the combin-
ation of results from the two engines can further improve on the
confidence in and number of peptide quantiﬁcations.

2 METHODS

The DIANA analysis workﬂow has similarities to classical shotgun MS
data analysis workﬂows. For each target peptide ion, chromatograms are
extracted, followed by chromatogram peak detection and scoring by sev-
eral sub-scores. The same procedure is applied to a large number of decoy
peptides to allow for signiﬁcance estimations, analogous to shotgun MS/
MS database searching (Elias and Gygi, 2007). In addition, a number of
retention time peptides are targeted using the same method, which are
used to normalize retention times for the peptide-ion assays in the current
injection. Target and decoy peptide peaks are then subjected to a semi-
supervised learner to merge the sub-scores into a ﬁnal score, to select the
best peak in each chromatogram, and to estimate false discovery rates
(FDRs).

Input MS data to DIANA should be in szL format (Martens et al.,
2011) with optional MS-numpress (Teleman et al., 2014) and gzip com-
pression. Apart from the raw MS data, three assay lists in TraML format
(Deutsch et al., 2012) are required; one with target assays, one with decoy
assays and one with retention time normalization assays.

2.1 Targeted data extraction

DIANA is based on a targeted data analysis approach, which in turn
requires targeted data extraction. During acquisition, the mass spectrom-
eter systematically collects one MS1 spectrum followed by MS2 spectra of
preselected subsets of the MS1 range (Fig. 1A). For the targeted extrac-
tion of a peptide ion, DIANA relies on an MS assay consisting of a
number of channels, describing the most prevalent fragments and the

A _ M81 M82
'°" sowsoo 4007425 4257450

collection
mm

m spectrum spectrum

. 117571200

 
 

         
    
   

spectrum
cycle time: 3.3 ms
B C :

ASSAY natural
isotopes

pOSi'vaUlSlilOﬂ

 

 

 

 

Precursor rniz 544
24.1 min
LAEEDFTFR(UniMod:267)
frag m/z intensity
y7 735 23% D
y4 487 41%
b5 518 13%

 

 

 

 

 

Fig. 1. Overview of DIA-MS and targeted extraction. (A) The instrument
typically performs a single full-range MSl scan, followed by a number of
MS2 scans on subsets of the precursor range. (B) For the targeted ex-
traction and analysis, a peptide ion assay is used, with information on the
prevalent isotopes and fragments for the peptide. Assay isotopes (C) and
fragments (D) are extracted from the MS] and relevant MS2 spectra to
get chromatograms related to the target peptide ion

A
channel peak candidate peak c

I . I trace peak validation
y4  
' ' = 0 1 1 1 1

|
I I |
y5 W 01110

data point

ya I I

 

 

 

0 1 1 10
sampling
ratio channel
y4/y5 > 11101
y4/y8 ~ @0110
yS/y8 = 00111

retention time

Fig. 2. Nomenclature for chromatogram extraction and peak picking.
Target fragments and isotopes can be thought of as data channels (A), a
ratio between two channels a ratio channel (B), and the measurements for a
channel are called a trace. Local maxima in channels are called peak can-
didates (A); of which several aligned is a multi-channeled peak. (C) For all
peaks a Boolean peak-validation object is computed. The peak-validation
object displays the data points that are close to the target ratios (within the
target tolerance window), which is an indication of a correct peak

most prominent natural isotopes of the peptide (Fig. 1B).
Chromatograms for each channel are extracted from the MS1 and rele-
vant MS2 spectra, using a given window size and deconvolution function,
to give a multi-channeled measurement of the targeted peptide ion
(Fig 1C). The extracted chromatogram for a channel is here referred to
as a trace, and all the traces for a peptide-ion assay will be collectively
called a peptide-ion assay trace (Fig. 2).

2.2 Peak detection and initial scoring

Each trace under analysis is smoothed by taking the second level Laplace
eight-point wavelet decomposition, and a baseline is also calculated as the
maximum of 1.0 and the median of a 20-point sliding window, resulting
in a minimum value of 1. The smoothed trace is partitioned by its local
minima, resulting in a number of peak candidates (Fig. 2A). These are
considered further if the smoothed curve intensity at the apex (local max-
imum for the candidate) is larger than twice the baseline at the same time.

Peak candidates from the different channels in the peptide-ion assay
trace are then grouped if peak candidate apices are maximally 1 data

 

556

112 /310's112u1n0fp10}x0"soiJBuiJOJuioiq/ﬁduq 11101} pQPBOIIIAAOG

9103 ‘Og isnﬁnV uo ::

DIANA: analysis of DIA-MS

 

point (Fig. 2A) off, and ﬁltered to only leave peaks (Fig. 2A) with at least
two fragment candidate peaks, or at least one fragment candidate peak
that has a sufﬁciently large area (default cutoff 25.0).

Peaks are initially scored by four different scoresithe fragment
Markov ratio probability (FMRP), the fragment correlation score
(FCS), the isotope Markov ratio probability (IMRP) and the isotope
correlation score (ICS). As indicated by the names, the scores represent
two types of calculations (Markov ratio probability (MRP) and correl-
ation score) for two types of inputs (fragments and precursor isotopes).

2.3 Markov ratio probability

MRP is here introduced as a type of P-value that can be calculated for
sections in an n-channeled input, with the goal to ﬁnd sections where the
ratio between each pair of channels maintains a target value. In our case,
the channels and ratios are either peptide fragments and an empirical
fragmentation pattern, or peptide isotopes and a natural isotope distri-
bution. To calculate the MRP for a peak of width w data points, ﬁrst all
the pairwise ratio channels (Fig. 2B) between the channels are calculated
as previously described (Teleman et al., 2012), followed by the computa-
tion of a Boolean peak-validation object (Fig. 2C). This object consists of
Boolean vectors of length w: the vectors v,-, 0 5 i < n, correspond to the
input channels 0,, and the vectors will, i<j5n correspond to the ratio
channels rm, giving a total of m vectors, m =n -l- (n >l< (n — 1))/2. The pur-
pose of the peak-validation object is to specify in detail which data points
in each channel and ratio channel that provide evidence of the target
relationship. For a description of the population of the peak-validation
object, see the Supplementary Methods.

With the peak-validation object, a P-value is calculated for each ratio
channel using a two-state Markov model (see Supplementary Methods
for motivation). The states represent agreement or non-agreement with
the target ratio, and the likelihoods for the four state-transitions in the
model are chosen by frequency counting of the measured state-transitions
using all data points in the ratio channel that are inside any peak. If the
peak has t of w data points in agreement with the target ratio in a ratio
channel, the P-value is calculated as the likelihood of getting t or more
data points in agreement given the above Markov model. These P-values
are combined to one according to Kost and McDermott (Kost and
McDermott, 2002), as they are calculated on pair-wise ratios and there-
fore dependent. This ﬁnal P-value is the MRP.

2.4 Interference correction/signal estimation

The peak-validation object is a detailed map of the data points in the
channels believed to support the target ratios, but inversely also a map of
possibly noisy data points. These noisy data points will heavily inﬂuence
the reported quantity if some high-abundant alternative ion is causing the
deviation. Therefore, for any data point that is not validated according to
the peak-validation object, we calculate an estimated intensity as the
average of all validated channels at that time, multiplied by the expected
ratios. If this estimated intensity is less than half the measured one, the
estimated intensity is used in place of the measured.

2.5 Correlation sub-score

As a complement to the MRP, a correlation sub-score is calculated using
the corrected assay trace over the peak. The Pearson correlation between
each pair of corrected traces is computed, and the correlation score is
calculated as the mean of these correlations. The correlation score is
calculated separately for the precursor isotope traces (ICS) and the frag-
ment traces (FCS).

2.6 Retention time normalization

Once the ﬁrst four sub-scores are calculated, the FMRP is used to select
the best peak (lowest FMRP) in each decoy and retention time assay

trace, and q-values are calculated using a simple non-parametric
method (Kall et al., 2008). Retention time peptide peaks at q-value
<15% are selected. For these a linear regression is made for measured
versus expected retention time. To correct for possible false positive iden-
tiﬁcations, peaks with residuals outside 3 standard deviations are dis-
carded, and the linear regression is performed again on the remaining
peaks. The linear transformation speciﬁed by the regression is used to
map the expected (assay) retention times for all target- and decoy-assays
to the speciﬁc chromatographic proﬁle of this injection, and a retention
time score is calculated as the absolute deviation of a peak apex from the
adjusted expected retention time. This supports assay libraries with iRT
retention times (Escher et al., 2012), although any linear retention time
scale can be used.

2.7 Semi-supervised classiﬁcation with PyProphet

Using the above ﬁve sub-scores, decoy and target peaks are used to per-
form semi-supervised learning, using the new tool PyProphet. PyProphet
is a Python reimplementation of mProphet (Reiter et al., 2011), using
optimized C code and NumPy (http://numpy.org) calculations to de-
crease computation times and memory usage by several orders of mag-
nitude for large input sets. Apart for optimizations, PyProphet also
extends the original mProphet functionality with (i) multiple inner lear-
ners from SkLearn (Pedregosa et al., 2011) like stochastic gradient des-
cent, logit and support vector machine (SVM), apart from the original
linear discriminant analysis, (ii) non-parametric and log-normal null-dis-
tribution models, (iii) q-value calculation according to Storey (Storey,
2002) and (iv) traditional cross-validation. To account for the non-gaus-
sian sub-score null distributions, DIANA uses a SVM with an rbf-kernel,
and the non-parametric null model. DIANA uses a traditional cross-val-
idation where all samples are used for learning, instead of the random
sampling cross-validation used by mProphet and OpenSWATH.

2.8 Implementation

The software representing the DIANA algorithm is packaged into a set of
stand-alone Java Virtual Machine 1.6 command line applications. These
can be run individually, or combined and scheduled using a small toolbox
of python programs that is also provided. All software exists as self-
contained binary packages, which can be downloaded from http://quan
titativeproteomics.org/diana, and should be compatible with any operat-
ing system. PyProphet is a stand-alone Python tool, which can be in-
stalled from PyPi (https://pypi.python.org/pypi/pyprophet/0.9.1) or
downloaded and compiled from source from https://github.oom/ﬁck
ludd/pyprophet. For installation of PyProphet, we currently recommend
a Linux environment.

2.9 Analysis of gold standard dataset and Streptococcus
pyogenes dataset

Vendor data ﬁles and assay lists were obtained from (Rost et al., 2014).
Decoys for the gold standard dataset were generated by shuffling each
target peptide trice, giving 1026 decoy assays, whereas a random sub-
sample of 3000 Streptococcus pyogenes peptide ions were shufﬂed once to
give 3000 S.pyogenes decoy assays. Decoy generation was performed
using an in-house tool called DecoyGenerator, which shuffles the peptide
amino acid sequence randomly, but preserves the c-terminal amino acid.
Data ﬁles were processed through the DIANA workﬂow, using an in-
house MS-Numpress enabled Msconvert build (essentially performing
equally to msconvert in current ProteoWizard builds (Chambers et al.,
2012)). Chromatograms were extracted with a :l:20 ppm uniform extrac-
tion window, using DianaExtractor, unless other window sizes are indi-
cated. Apart from additionally using the three most abundant precursor
isotopes, the extracted fragments and retention time peptides were as
previously described (Rost et al., 2014). In PyProphet we used weighted

 

557

112 /310's112u1n0fp10}x0"soiJBuiJOJuioiq/ﬁduq 11101} pQPBOIIIAAOG

9103 ‘Og isnﬁnV uo ::

J.Teleman et al.

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

A B C
1.00 - 0.20 -
th d d' |
>‘ 0.75 _ 0.15 _ me o I Iana manua
E a: water east
"’ _ 0.15 -
0-25 0.05 — > I
o 0.10 -
0'00 _ I I I I I I I I I 0'05 _
0.00 0.25 0.50 0.75 1.00 0.05 0.10 0.15 0.20 000 — I I I I
FPR estimated FDR
D E . F
r2 Intercept slope
1.000 - 0.50 - _ 2.0 - i
0.975 - 0.25 - ' 1.5 - I
I I  1 _|
0.950 - t a , 0.00 - _l 1.0 -
I : I 5
0.925 - ; j  ‘ -o.25 — 3 _ 0.5 — i
. . : z ' : E : ~ .
0.900- ' I - - I ' -o.5o— g I ' I 0.0— I I
water yeast water yeast water yeast

Fig. 3. Validation of DIANA of gold standard data set compromising 342 manually analyzed peptides in 60 injections. (A) ROC-curve of DIANA and
PyProphet semi-supervised classiﬁcation. (B) Evaluation of true FDR according to the manual analysis as a function of estimated FDR by DIANA.
(C) Coefﬁcients of variation calculated on the three technical replicates for each peptide and dilution level. Precision is similar to manual analysis. (D-E)
Linearity of peptides. Log-log scale linear regression on each peptide and dilution series reveals conﬁdently high coefﬁcients of determination (r2) and
intercepts and slopes close to theoretical values (0.0 and 1.0), with performance identical to manual analysis

classes, 10 iteration traditional cross-validation (xeval.type = split), all
peptides were used in the cross-validation, and an rbeVM inner learner
with 1 GB cache size was used. The non-parametric null distribution was
used with Storey FDR calculation (Storey, 2002), and mProphet (Reiter
et al., 2011) statistics calculation and sampling. Applied data analysis was
done using custom R scripts, mainly using reshape and ggplot2 packages.

3 RESULTS

Targeted data extraction for the analysis of complex DIA-MS
data was recently demonstrated as a promising data analysis
strategy. With the goal to further explore and improve this strat-
egy, we have designed a new peak detection algorithm, as well as
four new peak sub-scoresiFMRP, FCS, IMRP and ICS.
Analogous to previous published work on SRM data analysis
(Teleman et al., 2012), the sub-scores consider the data channels
in a pair-wise manner to provide robustness toward interfering
signals from non-targeted compounds. All sub-scores are used to
calculate a q-Value, which allows the user to determine the
strength of the found evidence for a certain peptide, and to
ﬁlter the results at a target FDR.

To evaluate DIANA performance, we used the gold standard
water and yeast background datasets from the OpenSWATH
publication (Rost et al., 2014). The gold standard dataset con-
sists of 342 detectable stable isotope labeled peptides, diluted in

10 concentrations from 1:1 to 1:512 in water and yeast lysate
backgrounds, yielding 20 separate samples, analyzed in tripli-
cates, resulting in 60 DIA-MS maps. Targeted extraction of
the spiked-in peptide traces from the 60 DIA-MS maps gener-
ated 20 520 extracted chromatograms, which were analyzed
manually in the OpenSWATH publication (Rost et al., 2014).

3.1 Parameter optimization and quantity calculation

Before analyzing the 60 DIA-MS maps from the gold standard
dataset using DIANA, we selected a subset of six DIA-MS maps
(yeast background, dilutions 1:2 to 1:64) to optimize the chro-
matogram extraction parameters. We tested extraction window
sizes of :I:5, :I:10, :I:20, :I:40 and :I:80 ppm from the theoretical
mass, using either uniform or top-hat extraction profiles, result-
ing in 10 extracted chromatogram sets per map. Each chromato-
gram set was scored and classiﬁed using DIANA and the gold
standard target and decoy assays, and evaluation was based on
the amount of significant peptides at 1% FDR. The :I:20 ppm
uniform window resulted in the highest number of significant
peptides in the more diluted samples (Supplementary Fig. S1)
and was used for the rest of this study. Note that the selected
extraction window shape and size should be close to optimal for
any measurement using the same method on the same instru-
ment. Other DIANA parameters (Supplementary Table S1 for

 

558

112 /310's1eu1nofp101x0'soIJBuIJOJIIioIq/ﬁduq Incl} pap1201umoq

9103 ‘0g isnﬁnV uo ::

DIANA: analysis of DIA-MS

 

full list) are treated as constants for MS methods similar to the
used method, and do not need to be changed. For example,
DIANA is robust with respect to the retention time mapping
parameters (Supplementary Figs S2 and S3).

Larger extraction windows could decrease the accuracy of
quantiﬁcation because of a higher risk of co-extraction of inter-
fering compounds, but linear regression of measured versus the-
oretical quantities showed excellent linearity, with r2 values for
the interference corrected extracted ion current (XIC) of >092
for 75% of the peptides, as well as median slope of 0.89:I:0.32
(median:l: SD) and median intercept of 70.13 :I:0.18
(Supplementary Fig. S4). DIANA reports three measures that
can be used to represent the quantity of a peptide: the XIC of
the measured fragments, the XIC of the measured precursor iso-
topes and the interference-corrected XIC of the measured frag-
ments. The interference-corrected XIC values gave higher r2
values compared with the raw XICs of the fragments or the
isotopes, and they also resulted in slopes and intercepts closer
to their expected theoretical values (Supplementary Fig. S4).
Therefore the interference corrected XIC is used as the measure
of quantity throughout this article.

3.2 DIANA compared with gold standard

To evaluate the performance of DIANA, we analyzed the com-
plete 60 DIA-MS gold standard data using the optimized param-
eters and original assays. The results were comparable to those
from manual analysis performed previously (R6st et al., 2014). At
a 1% FDR, DIANA detected 7004 out of 7689 manually detected
peptides in water, and 4786 out of 5716 peptides in yeast, repre-
senting sensitivities of 91.1% and 83.7%, respectively. A pseudo-
roc curve of sensitivity versus false positive rate results in an area
under the curve (AUC) of 0.92 (Fig. 3A). As the presumed correct
peak in a few cases was not the highest scoring of the peaks for
that assay, the sensitivity did not reach 1.0 even at the maximal
score cutoff. The gold standard dataset also enabled the evalu-
ation of the quality of FDR estimations. DIANA estimated the
true FDR according to the gold standard reasonably well, with
exact estimation at 10% FDR, underestimation for lower FDRs
and overestimation for higher FDRs (Fig. 3B).

For the purpose of hypothesis-driven quantitative experi-
ments, the precision and accuracy of a method is equally import-
ant to classiﬁcation power. Precision calculations for DIANA
and manual analysis yielded similar coefﬁcients of variation
(CV) across the technical replicates, with median CVs of
14.3% and 13.5% in water and 9.0% and 8.0% in yeast, respect-
ively (Fig. 3C). Orthogonally, reported quantities from DIANA
are also as accurate as manual analysis, and closely follow the
theoretical dilutions. In log-log scale, 95% of peptide dilutions
have r2>0.96 in both water and yeast (0.964 and 0.968 with
DIANA, 0.972 and 0.960 with manual) (Fig. 3D). Apart from
r2, the slope and intercept of a linear regression can be used to
evaluate quantification. We normalized peptide quantities by
division of the most concentrated sample followed by log2 trans-
form. As theoretical log2 concentrations were set to [79, e8, . . . ,
0], slopes should theoretically be 1 and intercepts 0. Log-log scale
intercepts had a median value of 0.18:I:0.25 and 0.02:I:0.10
(DIANA) compared with 0.19:I:0.25 and 0.03 :I:0.11 (manual)
for water and yeast backgrounds (Fig. 3E), whereas slopes were

A water yeast
OpenSWATH DIANA OpenSWATH DIANA
DIANA = OpenSWATH 0.5% 0.4% 0.5% 0.5%
DIANA != OpenSWATH 13.4% 86.6% 24.4% 66.7%
only DIANA - 20.8% - 26.6%

only OpenSWATH 22.4% — 26.4%
no detection - -

wallet yeast

‘.:II."   '
 - I I - . I I I I I
'I l's'-__‘ ' 'r_-..E ' “ I ' ' ' I-.i ' .-: |

num assays

dilution-

Fig. 4. True FDR and number of identiﬁcations when combining search
engines for DIA-MS analysis. Peptide ions were either detected as the
same peak by both engines (green), as different peaks by the two engines
(red), exclusively by DIANA (blue) or OpenSWATH (yellow), or not at
all (gray). (A) True FDRs depending on detection status. Peptide ions
selected at 1% FDR by both DIANA and OpenSWATH (green) had a
true FDR of <0.5%, whereas the peptide ions exclusively quantiﬁed by
only one engine (blue/yellow) had true FDRs of 2(F27%. (B) Number of
peptides ions quantiﬁed, stratiﬁed by detection status. The two engines
agreed on a majority of the peptide peaks, but there are still exclusive
contributions from both engines in both backgrounds

1.20 :I: 0.46 and 1.01 :I: 0.22 (DIANA) compared with 1.26 :I: 0.45
and 0.98 :I: 0.24 (manual) (Fig. 3F). We conclude that DIANA is
well ﬁt for targeted analysis of DIA-MS data, with high sensi-
tivity and very accurate quantiﬁcation.

3.3 DIANA compared with OpenSWATH

The novelty and utility of new algorithms should not only be
evaluated compared with time-consuming gold standard manual
analysis, but also by comparison with existing software. At a
controlled FDR-level of 1%, DIANA reported similar peptide
quantiﬁcation results compared with the main existing software
OpenSWATH (12174 versus 11932) in the gold dataset. This
global trend was preserved across the entire dilution series in
water, whereas the algorithms diverge in the yeast dilution,
with DIANA performing better in the concentrated half, and
OpenSWATH better in the diluted half (Fig. 4B and
Supplementary Fig. S5).

The classiﬁcation parameters precision and recall were used to
compare the semi-supervised learning strategies of DIANA and
OpenSWATH. Overall, the behavior over dilution in both par-
ameters is similar, with a high precision (as forced by the target
FDR of 1%), and a high recall that is declining with spiked
peptide concentration (Supplementary Fig. S6). As indicated
by the number of quantiﬁcations, the only difference lies in the
recall of the yeast dilution series, where DIANA has a higher
recall in the concentrated samples, while OpenSWATH has a
higher recall in the diluted samples.

The corrected quantity measure of DIANA consistently yields
minor increases in accuracy on peptides significantly and

 

559

112 /310's1eu1nofp101x0'soIJBuIJOJIIioIq/ﬁduq Incl} pap1201umoq

9103 ‘0g isnﬁnV uo ::

J.Teleman et al.

 

correctly detected by both engines, compared with the
OpenSWATH quantity measure (Supplementary Fig. S7). Both
DIANA (DI) and OpenSWATH (OS) had high performance,
with 95% of peptide dilutions having an r2>0.966 (DI) and
r2>0.963 (OS) in water, and r2>0.972 (DI) and r2>0.969 (OS)
in yeast. Intercepts were 0.17 :I: 0.29 (DI) and 0.20 :I: 0.25 (OS) in
water, and 0.023:I:0.10 (DI) and 0.028:I:0.10 (OS) in yeast.
Finally, slopes of the regressions were 1.18:I:0.43 (DI) and
1.19:l:0.45 (OS) in water and 1.01:l:0.20 (DI) and 0.97:l:0.22
(OS) in yeast.

3.4 Combination of DIANA and OpenSWATH

Previous studies have reported that the successful combination of
multiple search engines improves both the number and quality of
reported peptides detected in DDA data (Hakkinen et al., 2009;
Jones et al., 2009; Nahnsen et al., 2011; Shteynberg et al., 2011).
To investigate the possibility of similar performance gains in
DIA data analysis, we studied the extent of overlap in reported
peptides between DIANA and OpenSWATH. We observe that
the conﬁdence in the peptides identified by both engines is con-
siderably increased. Using the gold standard manual analysis, the
actual FDRs for the identiﬁcation status groups could be calcu-
lated (Fig. 4A). Across all samples the agreeing identiﬁcations
have actual FDRs of 0.5%, well below the target 1%. In con-
trast, the few conﬂicting identiﬁcations have actual FDRs ran-
ging between 13% and 86%, with OpenSWATH being correct in
a majority of cases, whereas single algorithm identiﬁcations have
actual FDRs of 2&27% in both backgrounds. The vast majority
of the identiﬁed peptides were detected in consensus by both
engines and therefore in the high-confidence group (green),
emphasizing the robustness of the targeted analysis strategy
(Fig. 4B). Nonetheless, the total number of detectable peptides
does increase when considering exclusive quantifications, and
these could prove to be suitable targets for further study, for
example by SRM.

3.5 Analysis of a bacterial lysate proteome using DIANA

To complement the strictly controlled setting of spiked-in syn-
thetic peptides, we reanalyzed 4 MS injections of S.pyogenes
grown with or without 10% human plasma from a previous
study (Malmstréim et al., 2012), which was also used in the
OpenSWATH manuscript (R6st et al., 2014). Streptococcus pyo-
genes is a major microbial pathogen, responsible for millions of
cases of pharyngitis and 500 000 deaths annually (Carapetis
et al., 2005). Apart from this very relevant reason for study,
the bacterium’s proteome of 1905 open reading frames makes
it suitably complex for whole-proteome measurements. The data
was evaluated using the pre-existing assay library (Rést et al.,
2014), generated from 10 shotgun MS measurements of fractions
of the S. pyogenes proteome, consisting of 1322 proteins repre-
sented by 20027 proteotypic peptide precursors.

The reanalysis of the streptococcal lysates with DIANA
yielded similar numbers of measured peptide ions at 1% FDR
compared with OpenSWATH without inter-sample alignment,
resulting in 38 776 versus 38 272 peptide ion identiﬁcations
(Supplementary Fig S8). Together, 47 467 identiﬁcations were
reported as significant by at least one algorithm. Of these,
29 397 (61%) peptide-ion identiﬁcations could be considered

IOnS

30000-
20000-
10000—

| | | I
agree conflict DIANA none OpenSWATH
identification state (q<0.01)

num peptIde

Fig. 5. DIA-MS analysis of four Streptococcus pyogenes lysates grown
with 0% or 10% plasma supplement. Combined analysis using Open-
SWATH and DIANA conﬁrms close to 3(F000 peptide ion quantiﬁca-
tions, but each engine also quantiﬁes over 8000 peptides exclusively. Less
than 1000 peptide ions have conﬂicting quantiﬁcations from the two
algorithms

high conﬁdence because of consensus identiﬁcation by the two
algorithms (Fig. 5). In addition, DIANA identiﬁed 8713 (18%)
peptide ions exclusively, whereas OpenSWATH added another
8353 (18%). The algorithms gave conﬂicting results for only 824
(1.7%) peptide ions. According to the gold standard analysis we
would expect consensus identiﬁcations to have a true FDR of
0.5% and single identiﬁcations to have a true FDR of about 20-
27%. However, as the number of single identiﬁcations is larger
compared with consensus identiﬁcations in this dataset, true
FDRs are likely to be closer to 1% if the FDR estimates of
algorithms are correct. We conclude that the combination of
two search engines improves the total number of detected peptide
ions at 1% FDR but also importantly increases the conﬁdence
for the majority of the detected peptides.

4 DISCUSSION

The presented work demonstrates three advancements in tar-
geted extraction DIA-MS analysis. First, the invention of a prob-
abilistic score for fragmentation patterns is shown to give high
analytical power in the complex bacterial and yeast backgrounds,
which should be considered the minimal expected sample com-
plexity for in Vivo or cell-line studies. Second, the adopted inter-
ference-corrected measure of quantity from our previous SRM
work is shown to provide increased accuracy in quantiﬁcation in
the noisy DIA-MS data. Third, we demonstrate the advance of
combining two analysis tools for DIA-MS data processing. The
combined output from DIANA and OpenSWATH generated
both an increased number of identifications and considerably
increased conﬁdence in the peptides identiﬁed by both engines.
The DIANA algorithm is very reliant on the peptide fragmen-
tation pattern, both for scoring and interference correction. This
is both a strength and a weakness. The advanced probabilistic
score is very powerful as the probabilities are individually calcu-
lated based on the noise in each speciﬁc ratio channel, and this
allowed us to rely completely on extracted chromatograms for
the analysis. On the other hand, the algorithm depends on con-
served fragmentation, and changes in instrument collision energy
tuning or mass-dependent ion transmission could hinder detec-
tion of true peptides. Nevertheless, we have demonstrated power-
ful classiﬁcation (AUC<0.92) and accurate quantification (95%
of peptides have r2>0.96) of the new scoring software DIANA
and classiﬁer PyProphet in a gold standard dataset. Further,

 

560

112 /310's1eu1nofp101x0'soIJBuIJOJIIioIq/ﬁduq Incl} pap1201umoq

9103 ‘0g isnﬁnV uo ::

DIANA: analysis of DIA-MS

 

even if performance is largely similar, DIANA is shown to im-
prove performance in samples from bacterial whole cell lysates
with sufﬁcient amounts of true positives, compared with
OpenSWATH.

The structure of DIANA and OpenSWATH are conceptually
similar. The observed differences in performance between the
engines can likely be explained by the detailed differences such
as the different sub-scores or the exact chromatogram extraction
or peak detection. We believe that further improvement of
DIANA could be achieved by including something similar to
OpenSWATH’s intensity and signal-to-noise sub-scores, as well
as a preliminary score to initiate the semi-supervised learning
better. The lack of such sub-scores could well explain
DIANA’s lower sensitivity in samples with very few true
positives.

In the performed gold standard and streptococcal lysate ana-
lysis, we demonstrate the usefulness of utilizing multiple analysis
tools, to increase the confidence and amounts of detected pep-
tides. Increasing peptide identiﬁcation rates and conﬁdence using
a combination of search engines is an attractive option, as it only
requires computer hardware investments that are minor com-
pared with instrument investment and maintenance costs.
Being standard procedure in shotgun MS data analysis, we be-
lieve this study to validate the approach also in DIA-MS.

Although shotgun MS data analysis is a mature ﬁeld with tens
of different tools available, research on the analysis of targeted
analysis DIA data has only begun. It can be anticipated that
several powerful concepts for DIA analysis remain to be dis-
covered. We believe DIANA demonstrates some such new ana-
lysis concepts, and their successful application to the complex
task of detecting and quantifying peptide ions.

ACKNOWLEDGEMENTS

The authors thank Ufuk Kirik for the helpful discussions on the
algorithms.

Funding: J .T. and J .M. were supported by the Swedish Research
Council (projects 2008:3356 and 621-2012-3559), the Swedish
Foundation for Strategic Research (grant FFL4), the Crafoord
Foundation (grant 20100892), Stiftelsen Olle Engkvist
Byggmastare, the Wallenberg Academy Fellow KAW
(2012.0178) and European research council starting grant
(ERC-2012-StG—309831). H.L.R. was funded by ETH (ETH-30
11-2). G.R. was funded by the Swiss Federal Commission for
Technology and Innovation CTI (13539.1 PFFLI-LS). L.M. was
support by ETH Zurich, Department of Biology, within the
frame of an IT-strategy initiative. F.L. was funded by the
Swedish Foundation for Strategic Research (RBb08-0006) and
Mistra Biotech.

Conflict of interest: none declared.

REFERENCES

Bailey,D.J. et al. (2014) Intelligent data acquisition blends targeted and discovery
methods. J. Proteome Res., 13, 215272161.

Bernhardt,O.M. et al. (2012) Spectronaut: a fast and efﬁcient algorithm for MRM—
like prooessing of data independent acquisition (SWATH—MS) data. In:

Proceedings of 60th American Society for Mass Spectometry Conference
American Society for Mass Spectrometry, Vancouver 2012.

Carapetis,J.R. et al. (2005) The global burden of group A streptococcal diseases.
Lancet Infect. Dis, 5, 685$94.

Chambers,M.C. et al. (2012) A cross—platform toolkit for mass spectrometry and
proteomics. Nat. Biotechnol, 30, 9187920.

Collins,B.C. et al. (2013) Quantifying protein interaction dynamics by SWATH
mass spectrometry: application to the 14—3—3 system. Nat. Methods, 10,
124(r1253.

Desiere,F. et al. (2006) The PeptideAtlas project. Nucle‘w Acids Res., 34, D655$58.
Deutsch,E.W. et al. (2012) TraMLea standard format for exchange of selected
reaction monitoring transition lists. Mol. Cell. Proteomics, ll, R111.015040.
Egertson,J.D. et al. (2013) Multiplexed MS/MS for improved data—independent

acquisition. Nat. Methods, 10, 744e746.

Elias,J.E. and Gygi,S.P. (2007) Target—decoy search strategy for increased conﬁ—
dence in large—scale protein identiﬁcations by mass spectrometry. Nat.
Methods, 4, 2077214.

Escher,C. et al. (2012) Using iRT, a normalized retention time for more targeted
measurement of peptides. Proteomics, 12, 111171121.

Farrah,T. et al. (2012) PASSEL: the PeptideAtlas SRMexperiment library.
Proteom’ws, 12, 117(k1175.

Gillet,L.C. et al. (2012) Targeted data extraction of the MS/MS spectra generated
by data independent acquisition: a new concept for consistent and accurate
proteome analysis. Mol. Cell. Proteomics, 11, 0111016717.

Hakkinen,J. et al. (2009) The proteios software environment: an extensible multiu—
ser platform for management and analysis of proteomics data. J. Proteome Res.,
8, 303773043.

Jones,A.R. et al. (2009) Improving sensitivity in proteome studies by analysis of
false discovery rates for multiple search engines. Proteomics, 9, 122071229.
Kall,L. et al. (2008) Assigning signiﬁcance to peptides identiﬁed by tandem mass

spectrometry using decoy databases. J. Proteome Res., 7, 29734.

Karlsson,C. et al. (2012) Proteome—wide selected reaction monitoring assays for the
human pathogen Streptococcus pyogenes. Nat. Commun., 3, 1301.

Kost,J.T. and McDermott,M.P. (2002) Combining dependent P—values. Stat.
Probab. Lett., 60, 1837190.

Liu,H. et al. (2004) A model for random sampling and estimation of relative protein
abundance in shotgun proteomics. Anal. Chem, 76, 419374201.

Malmstrde. et al. (2012) Streptococcus pyogenes in human plasma: adaptive
mechanisms analyzed by mass spectrometry—based proteomics. J. Biol. Chem,
287, 141571425.

Martens,L. et al. (2011) szLea community standard for mass spectrometry data.
M0]. Cell. Proteom’ws, 10, R110.000133.

Nahnsen,S. et al. (2011) Probabilistic consensus scoring improves tandem mass
spectrometry peptide identiﬁcation. J. Proteome Res., 10, 333273343.

Panchaud,A. et al. (2009) Precursor acquisition independent from ion count: how to
dive deeper into the proteomics ocean. Anal. Chem, 81, 6481$488.

Pedregosa,F. et al. (2011) Scikit—learn: machine learning in Python. J. Mach. Learn.
Res., 12, 282572830.

Picotti,P. et al. (2008) A database of mass spectrometric assays for the yeast prote—
ome. Nat. Methods, 5, 9137914.

Picotti,P. et al. (2009) Full dynamic range proteome analysis of S. cerevisiae by
targeted proteomics. Cell, 138, 7957806.

Plumb,R.S. et al. (2006) UPLC/MS(E); a new approach for generating molecular
fragment information for biomarker structure elucidation. Rapid Commun.
Mass Spectrom., 20, 198971994.

Purvine,S. et al. (2003) Shotgun collision—induced dissociation of peptides using a
time of ﬂight mass analyzer. Proteomics, 3, 8477850.

Reiter,L. et al. (2011) mProphet: automated data processing and statistical valid—
ation for large—scale SRM experiments. Nat. Methods, 8, 43(P435.

R6st,H.L. et al. (2014) OpenSWATH enables automated, targeted analysis of data—
independent acquisition MS data. Nat. Biotechnol., 32, 2197223.

Shteynberg,D. et al. (2011) iProphet: multi—level integrative analysis of shotgun
proteomic data improves peptide and protein identiﬁcation rates and error es—
timates. M0]. Cell. Proteomics, 10, M111.007690.

Shteynberg,D. et al. (2013) Combining results of multiple search engines in prote—
omics. M0]. Cell. Proteomics, 12, 238372393.

Storey,J.D. (2002) A direct approach to false discovery rates. J. R. Stat. Soc. Ser. B
Stat. Methodol., 64, 4794198.

Tabb,D.L. et al. (2010) Repeatability and reproducibility in proteomic identiﬁca—
tions by liquid chromatography—tandem mass spectrometry. J. Proteome Res., 9,
7617776.

 

561

112 /310's1eu1n0fp101x0'soIJBuiJOJHIOIq/ﬁduq Incl} pap1201umoq

9103 ‘0g1sn8nv uo ::

J.Teleman et al.

 

Teleman,J. et al. (2012) Automated selected reaction monitoring software for ac—
curate label—free protein quantiﬁcation. J. Proteome Res., 11, 37653773.

Teleman,J. et al. (2014) Numerical compression schemes for proteomics mass spec—
trometry data. Mol. Cell. Proteomics, 13, 153771542.

Vincent,C.E. et al. (2013) Segmentation of precursor mass range using ‘tiling’ ap—
proach increases peptide identiﬁcations for MSl—based label—free quantiﬁcation.
Anal. Chem., 85, 282572832.

Waldemarson,S. et al. (2012) Protein expression changes in ovarian cancer during
the transition from benign to malignant. J. Proteome Res., 11, 287(r2889.
Weisbrod,C.R. et al. (2012) Accurate peptide fragment mass analysis: multiplexed pep—
tide identiﬁcation and quantiﬁcation. J. Proteome Res., 11, 162171632.

Wolf—Yadlin,A. et al. (2007) Multiple reaction monitoring for robust quantitative
proteomic analysis of cellular signaling networks. Proc. Natl Acad. Sci. USA,
104, 586(k5865.

 

562

112 /310's1eu1n0fp101x0'soIJBuiJOJHIOIq/ﬁduq Incl} pap1201umoq

9103 ‘0g1sn8nv uo ::

