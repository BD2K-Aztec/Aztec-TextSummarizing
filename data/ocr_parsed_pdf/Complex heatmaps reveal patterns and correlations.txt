Bioinformatics Advance Access published June 22, 2016

Bioinformatics, 2016, 1—3

doi: 10.1093/bioinformatics/btw313

Advance Access Publication Date: 20 May 2016
Applications Note

 

Genome analysis

Complex heatmaps reveal patterns and
correlations in multidimensional genomic data

Zuguang Gum, Roland Eils1'2'3 and Matthias Schlesner1'*

1Division of Theoretical Bioinformatics, 2Heidelberg Center for Personalized Oncology (DKFZ-HIPO), German
Cancer Research Center (DKFZ), Heidelberg, Germany and 3Department for Bioinformatics and Functional
Genomics, Institute for Pharmacy and Molecular Biotechnology (IPMB) and BioOuant, Heidelberg University,

Heidelberg, Germany

*To whom correspondence should be addressed.
Associate Editor: John Hancock

Received on December 27, 2015; revised on May 12, 2016; accepted on May 13, 2016

Abstract

Summary: Parallel heatmaps with carefully designed annotation graphics are powerful for efficient
visualization of patterns and relationships among high dimensional genomic data. Here we present
the CompleXHeatmap package that provides rich functionalities for customizing heatmaps, arrang—
ing multiple parallel heatmaps and including user—defined annotation graphics. We demonstrate
the power of CompleXHeatmap to easily reveal patterns and correlations among multiple sources

of information with four real—world datasets.

Availability and Implementation: The CompleXHeatmap package and documentation are freely
available from the Bioconductor project: http://www.bioconductor.org/packages/devel/bioc/htm|/

ComplexHeatmap.html.
Contact: m.schlesner@dkfz.de

Supplementary information: Supplementary data are available at Bioinformatics online.

 

1 Introduction

Heatmaps are a fundamental visualization method that is broadly
used to unravel patterns hidden in genomic data. They are especially
popular for gene expression analysis (Eisen et (11., 1998) and methy—
lation profiling (Sturm et (11., 2012). With the increasing availability
of genomic datasets, visualization methods that effectively show re—
lations within multidimensional data are urgently needed. In this
paper, we demonstrate how heatmaps with carefully designed anno—
tation graphics can give great enhancement for revealing underlying
data structure and how utilization of parallel heatmaps which focus
on different sources of information gives a quick and comprehensive
overview of the data.

In the R programming environment, traditional tools for draw—
ing heatmaps, like the basic heatmap function or add—on packages
such as pheatmap or heatmapplus, only provide limited functional—
ity to display annotation graphics and do not support plotting of
multiple parallel heatmaps. The ComplexHeatmap package has
been designed to overcome these limitations. It provides a general
solution to juxtapose different sources of information in multiple

parallel heatmaps. Each heatmap can be enhanced by multiple anno—
tation graphics to complete the portrayal of the dataset. Both col—
umn and row annotation graphics supported in ComplexHeatmap
can either be predefined graphics, e.g. points, bar plots or boxplots
or more general user—defined graphics. Other features of
ComplexHeatmap include: (i) ﬂexible support for clustering. For ex—
ample, rendered dendrograms (Galili, 2015) or a user—defined dis—
tance function that accepts two paired vectors are supported; (ii)
separating of heatmap rows into slices to support visualization of
subgroups, where splitting on rows can be done either by a parti—
tioning method, e.g. k—means clustering or a data frame that con—
tains classifications; (iii) user—customization of the heatmap grids for
more advanced visualization of complex information, e.g. the
enhanced OncoPrint (Gao et (11., 2013) in Figure 1A ; (iv) interactive
selection on heatmaps to obtain subset of rows and columns if heat—
maps are drawn on an interactive device (e.g. X11) and (v) the abil—
ity to add more customized graphics after heatmaps are generated.
ComplexHeatmap has a modular design with a user—friendly ap—
plication programming interface (API). The ﬂexibility and

©The Author 2016. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com l

 

91oz ‘Og JSanV uo seleﬁuv soc] ‘BtHJOJtIBQ JO AJtSJQAtuf] 112 /310'S[BIIJHO[pJOJXO'SOlJBLUJOJIIlOlq”K1111] 11101} popcolumoq

ZGu et al.

 

extensibility of the package enables fast and easy generation of novel
views of multidimensional datasets and greatly facilitates discoveries
from genomic and other omics data.

2 Implementation

ComplexHeatmap is implemented in an object—oriented way. The
main classes are:

Heatmap: Representation of a single heatmap. The class proc—
esses the data matrix and provides methods for drawing heatmap
components, i.e. the heatmap body, row/column names, titles, den—
drograms and column annotations.

HeatmapList: Representation of a list of heatmaps. The class ad—
justs graphical settings for the list of heatmaps, creates the layout
and provides methods for drawing components like the heatmap le—
gends. The ‘+’ operator is used to concatenate parallel heatmaps
(i.e. heatmaps in which corresponding rows in all matrices corres—
ponds to the same object):

Heatmap(matrixl, ...) +Heatmap(matrix2, ...)

HeatmapAnnotation: Heatmap annotation is a general and ﬂex—
ible concept. The only requirement for heatmap annotations is that
the graphics should be aligned to columns or rows in the heatmap,
respectively. The most commonly used annotation graphics are a list
of grids that show different groups of the data. However, other
types of graphics can also be used, e.g. it can be boxplots which
visualize data distribution in corresponding rows or columns.
ComplexHeatmap provides several fixed types of annotation graph—
ics, e.g. points, bar plots and boxplots. The package also provides
an API that allows users to design their own annotation graphics.

Column annotations and row annotations are both encapsulated
by HeatmapAnnotation class. Column annotations are components
of a single heatmap:

ha = HeatmapAnnotat ion (. . .)

Heatmap(matrix, top_annotation=ha, ...)

Row annotations are concatenated to the heatmap list by the ‘+’
operator and can correspond to multiple parallel heatmaps:

ha = HeatmapAnnotat ion (. . . , which = ‘ row’ )

Heatmap (matrix , ...) + ha

)-

Genomic alterations and biological lunctions of associated genes
UﬂmFHHt ID! I‘m/"Uri"? mwuﬂ none; I! Luna WWW! Min lo SIM Uﬂlﬂm [D3]

omng

   
 

omega“...

 

law IMF «on

iiiiii?

gagging a s

Emgﬂigg

a Wéaa
i gr-

".383 E
iiIInIIIIIIIIIIIIIIII"""' ""

a2"

R637
in:

0mm

3 aggiiiiiééééééiéémi

“ﬁ?§§~*§c‘¥$‘%

s (I ale.) ‘3’ ' ‘

eat-gags.
ﬂ.» 8 “‘Wu
aﬁ‘iswx

9?

     

There is no limitation for the amount and order of heatmap an—
notations in the list of heatmaps.

3 Application

Figure 1A visualizes genomic alterations for 38 selected genes in 134
patients from the TCGA lung adenocarcinoma cohort (Collisson
et al., 2014) as an enhanced OncoPrint. Genes are split into two
groups based on the amplification rate among patients. Bar plots are
added to rows and columns to show the numbers of alterations
across patients and genes, respectively. An additional heatmap on
the right indicates the biological functions of the mutated genes. The
combination of OncoPrint and this heatmap reveals that highly
amplified genes are relatively enriched in cellular response processes,
while mutated genes are enriched in processes related to develop—
ment and metabolism.

Figure 1B illustrates heterogeneity of mouse T—cells analyzed by
single cell RNA—Seq data (Buettner et al., 2015). Expression pro—
files of 721 selected genes classify the cells into two subpopula—
tions. The left subpopulation (highlighted in light red in the
column dendrogram) is characterized by relatively high expression
of a subset of cell cycle genes, however, the absolute expression
level is low. The subpopulation on the right side exhibits relatively
low expression of this subset of cell cycle genes, while the other se—
lected genes, including other cell cycle genes, are expressed at high
levels. A group of ribonucleoprotein genes show very strong coex—
pression. Gene names of highly expressed cell cycle genes are indi—
cated. The heatmap on the right visualizes pairwise correlations
between the 721 genes. The correlation values were hierarchically
clustered and the resulting row order used to define the row order
of all parallel heatmaps.

Supplementary File 53 visualizes correlations between methyla—
tion, gene expression, enhancers and gene—related information. The
data is randomly generated based on patterns found in an unpub—
lished work. In the heatmaps, each row corresponds to a differen—
tially methylated region (DMR) or other objects that are associated
with the DMR. These objects are, for example, the nearest gene
with expression negatively correlating to the methylation level in the
associated DMR, or enhancers that overlap with the DMR. The
complex heatmaps reveal that highly methylated DMRs are enriched
in intergenic and intragenic regions and rarely overlap with

Heierogenelty Of mouse T-CBIIS "0m single cell RNASEQ dalﬂ
Baum-secunuunon huh-m M

Fig. 1. Examples by ComplexHeatmap. (A) Genomic alterations and biological functions of the associated mutated genes. (B) Heterogeneity of mouse T-cells
from single cell RNA-Seq data. Data sources and R code for the plots can be found at Supplementary Si and 82

910g ‘09 isanV no sepﬁuv $01 ‘BIIIJOJIIBO JO KJISJQAIII f] 112 /3.IO'S[BIIJI’IO[pJOJXO'SOIJBLUJOJIIIOICI”Idllq 11101} pepeoIH/noq

Complex heatmaps reveal patterns and correlations

 

enhancers. In contrast, lowly methylated DMRs are enriched for
transcription start sites (TSS) and enhancers.

Supplementary File S4 reimplements Figure 1 in Sturm et al.
(2012) to demonstrate the ability of ComplexHeamtap to make
complex annotations. Compared to the original figure, two new
heatmaps are added, one visualizing the distance between CpG sites
and the nearest TSS, and the second visualizing annotations to CpG
Islands (CGI). The heatmap is split according to the CGI annotation,
revealing that the CpG sites that are in CGI Shelf and open sea have
higher methylation levels and higher distance to the nearest TSS.

Funding

This work was supported by the German Cancer Research Center-Heidelberg
Center for Personalized Oncology (DKFZ—HIPO) and the BMBF—funded
de.NBI HD-HuB network (#031A537A, #031A537C).

Conﬂict of Interest: none declared.

References

Buettner,F. et al. (2015) Computational analysis of cell-to—cell heterogeneity
in single—cell RNA-sequencing data reveals hidden subpopulations of cells.
Nat. Biotechnol, 33, 155—160.

Collisson,E.A. et al. (2014) Comprehensive molecular proﬁling of lung adeno-
carcinoma. Nature, 511, 543—550.

Eisen,M.B. et al. (1998) Cluster analysis and display of genome—wide expres-
sion patterns. Proc. Natl. Acad. Sci, 95, 14863—14868.

Galili,T. (2015) dendextend: an R package for visualizing, adjusting, and com—
paring trees of hierarchical clustering. Bioinformatics, 31, 3718—3 720.

Gao,J. et al. (2013) Integrative analysis of complex cancer genomics and clin-
ical proﬁles using the cBioPortal. Sci. Signal, 6, p11.

Sturm,D. et al. (2012) Hotspot mutations in H3F3A and IDHl deﬁne distinct
epigenetic and biological subgroups of glioblastoma. Cancer Cell, 22,
425—437.

9103 ‘Og isanV uo sejeﬁuv soc] ‘BtHJOJtIBQ JO AJtSJQAtuf] 112 /3.IO'S[BIIJI’IO[pJOJXO'SOIJBLUJOJIIIOICI”Idllq 11101} papeolumoq

