Bioinformatics, 31 (1 5), 2015, 2461—2468

doi: 10.1093/bioinformatics/btv183

Advance Access Publication Date: 29 March 2015
Original Paper

 

Genome analysis

Power and sample-size estimation for
microbiome studies using pairwise distances
and PERMANOVA

Brendan J. Kelly1'*, Robert Gross1, Kyle Bittingerz, Scott Sherrill-Mixz,
James D. Lewis3, Ronald G. Collman1, Frederic D. Bushman2 and
Hongzhe Li3'*

1Department of Medicine, 2Department of Microbiology and 3Department of Biostatistics and Epidemiology,
University of Pennsylvania Perelman School of Medicine, Philadelphia, PA 19104, USA

*To whom correspondence should be addressed.
Associate Editor: John Hancock

Received on December 17, 2014; revised on March 9, 2015; accepted on March 24, 2015

Abstract

Motivation: The variation in community composition between microbiome samples, termed beta
diversity, can be measured by pairwise distance based on either presence—absence or quantitative
species abundance data. PERMANOVA, a permutation—based extension of multivariate analysis of
variance to a matrix of pairwise distances, partitions within—group and between—group distances to
permit assessment of the effect of an exposure or intervention (grouping factor) upon the sampled
microbiome. Within—group distance and exposure/intervention effect size must be accurately mod—
eled to estimate statistical power for a microbiome study that will be analyzed with pairwise dis—
tances and PERMANOVA.

Results: We present a framework for PERMANOVA power estimation tailored to marker—gene
microbiome studies that will be analyzed by pairwise distances, which includes: (i) a novel method
for distance matrix simulation that permits modeling of within—group pairwise distances according
to pre—specified population parameters; (ii) a method to incorporate effects of different sizes within
the simulated distance matrix; (iii) a simulation—based method for estimating PERMANOVA power
from simulated distance matrices; and (iv) an R statistical software package that implements the
above. Matrices of pairwise distances can be efficiently simulated to satisfy the triangle inequality
and incorporate group—level effects, which are quantified by the adjusted coefficient of determin—
ation, omega—squared (602). From simulated distance matrices, available PERMANOVA power or
necessary sample size can be estimated for a planned microbiome study.

Availability and implementation: http://github.com/brendankeIIy/micropower.

Contact: brendank@mai|.med.upenn.edu or hongzhe@upenn.edu

 

1 Introduction

 

Microbiome studies often compare groups of microbial communities
with different environmental exposures, or to which different inter—
ventions have been applied. For example, a study may evaluate the
difference between the respiratory tract microbial communities of
human subjects with exposure to different antibiotic treatments.

The fundamental measure in such a study is the count of community
members (species or operational taxonomic units—OTUs), typically
accomplished Via sequencing a marker gene such as the 16S riboso—
mal RNA gene for bacteria. Pairwise distance metrics facilitate
standardized comparison of community membership between indi—
Vidual study subjects by addressing the problems of differential

©The Author 2015. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com 2451

112 /3.10'speum0fp1q1x0"sothJJOJutotq/ﬁduq 11101} popcolumoq

91oz ‘Og anﬁnv 110 ::

2462

B.J.Kelly et aI.

 

membership and mutual absence. To assess differences between
groups of subjects (i.e. the explanatory power of a grouping factor,
such as antibiotic exposure), pairwise subject—to—subject distances
must be arrayed in a square distance matrix. Group—level differences
can then be analyzed by ordination methods such as principal coord—
inates analysis or by a significance test such as PERMANOVA
(Anderson, 2001; Legendre and Legendre, 2013; McArdle and
Anderson, 2001).

The design of microbiome studies demands consideration of stat—
istical power—an adequate number of subjects must be recruited to
ensure that the effect expected from the exposure or intervention of
interest can be detected. Here, we focus on the power of 16S tag
sequencing studies that are analyzed using pairwise distances (specif—
ically, UniFrac and Jaccard distances) and PERMANOVA. UniFrac
is a distance metric based upon the unique fraction of branch length
in a phylogenetic tree built from two sets of taxa. Comparison of
microbiome samples can be performed via unweighted UniFrac,
which considers strictly the presence or absence of taxa, or weighted
UniFrac, which also considers relative abundance (Lozupone and
Knight, 2005; Lozupone et (11., 2007, 2010). Jaccard distance, a
non—phylogenetic measure of difference between two sample sets, is
calculated as one minus the ratio of the intersection to the union; it
can also be calculated in unweighted (‘binary’) or abundance—
weighted fashion (Chao et (11., 2005; Levandowsky and Winter,
1971).

The power of PERMANOVA, like the power of traditional ana—
lysis of variance, depends on the number of exposure or intervention
groups (degrees of freedom), the number of subjects per group (re—
sidual degrees of freedom), the within—group distances (within—group
sum of squares) and the size of the effect (the difference between the
between—group sum of squares and within—group sum of squares).
Type 11 error increases and statistical power decreases with more
groups, fewer subjects, greater within—group distance and lesser ef—
fects (Zar, 1999). However, the pseudo—F ratio is not distributed
like Fisher’s F—ratio under the null hypothesis, so standard methods
of power estimation for parametric ANOVA do not apply to the
studies analyzed by PERMANOVA (Anderson, 2001). Furthermore,
the relationship between microbiome community structure and
within—group distances is often obscure, and the effect size to be ex—
pected from anticipated exposures or planned interventions upon
the microbiome is often uncertain.

Here, we present a framework for PERMANOVA power and
sample size estimation tailored to marker—gene microbiome studies
that will be analyzed with pairwise distances. We first describe a
novel method for distance matrix simulation that permits modeling
within—group pairwise distances according to pre—specified popula—
tion parameters. We then demonstrate how to incorporate effects of
different sizes within the simulated distance matrix. Building on the
capacity to accurately model within— and between—group distances,
we present a simulation—based method for estimating
PERMANOVA power. Finally, we outline an R statistical software
package (The R Foundation for Statistical Computing, www.r—pr0j
ect.0rg—R Core Team, 2014) that implements the above, and pro—
vide examples of its use.

2 Methods
2.1 PERMANOVA and effect size

In many microbiome studies, one is interested in testing the null hy—
pothesis that there is no difference in overall microbiome compos—
itions of p bacterial taxa among the a exposure groups. Consider the

simple case that we have a exposure or intervention groups and 71 ob—
servations in each group with a total of N 2m: observations. The
microbiome composition between two subjects 1' and / determines
their distance d,,-. We focus on UniFrac and Jaccard distances because
they are widely used and conveniently implemented in bioinformatic
analysis packages (Caporaso et (11., 2010; Schloss et (11., 2009).
Distance—based multivariate analysis of variance therefore provides a
non—parametric test of the null hypothesis of no differences in overall
bacterial compositions among the a exposure groups.

PERMANOVA is a non—parametric method of multivariate ana—
lysis of variance based on pairwise distances (Anderson, 2001). It
extends traditional analysis of variance to a square matrix of pair—
wise distances with significance testing performed by permutation.
Let d,,- be the distance of microbiome between observation 1' and j,
and 6,,- takes the value 1 if observation 1' and j are in the same group
and 0 otherwise. For pairwise distances, the within—group sum of
squares (SSW) is defined as the sum of the squares of distances within
groups divided by the number of subjects per group,

1N—1 N 2
SSW :  Z (iii-61",",

i:1 i:i+1

and the total sum of squares SST is defined as

1N—1 N
ssT :NZ 2 (1,2,.

i:1 i:i+1

The between—group sum of squares (SSA) is defined as the
difference between the total sum of squares SST and SSW,
SSA : SST — SSW. The PERMANOVA test statistic, termed the
pseudo F—ratio, is analogous to Fisher’s F—ratio; it is based upon the
ratio of the sum of the squared between—group distances to the sum
of the squared within—group distances

7 ssA/(a — 1)

F ‘ SSW/(N —a)’

where a — 1 are the degrees of freedom defined by the grouping fac—
tor and N —a are the residual degrees of freedom. The significance
of the pseudo F—ratio can be assessed by permutations.

As with the conventional ANOVA, the effect size of the pseudo
F—ratio can be quantified as the coefficient of determination (R2),
which is one minus the ratio of the within—group sum of squares to
the total sum of squares. This is equivalent to the ratio of the be—
tween—group sum of squares to the total sum of squares,

55W 7 55A

2
:1————.
R SSw+SSA 551'

However, the R2, which is the proportion of distance accounted for
by the grouping factor, is biased because it depends solely on the
sums of squares of the sample, without adjustment to estimate the
effect size in the general population. Omega—squared (col) provides a
less biased measure of effect size for ANOVA—type analyses by ac—
counting for the mean—squared error (Olejnik and Algina, 2004;
Ziegler and Buhner, 2009) of the observed samples,

 

2 :ssA—(a_1),§5_v;
ssT+,§S_“:,

 

The power of PERMANOVA depends on the sample sizes, the alter—
native hypothesis that can be specified by different population—level
microbial compositions among a groups, and their variances. These
parameters determine the pairwise distances and their variances, the
between—group sum of squares SSA and the total sum of squares SST.

112 /3.10'speum0fp1q1x0"sothJJOJutotq/ﬁduq 11101} pQPBOIHAAOG

9103 ‘Og anﬁnv 110 ::

Microbiome studies using pairwise distances and PERMANO VA

2463

 

100- 100-

075-

075-

050-

050-

025- 025-

Unweighted Jaccard Distance
Unweighted UniFrac Distance

 

 

 

 

0 00 - 0 00 -
r r r r r r
0 00 0 1 00 0 00 0 2 0 1 00
Subsampling OTUs: Proportion Retained Subsampling OTUs: Proportion Retained
1 00 - 1 00 - 3
o
o
8 8
c 075 - c 075 -
S S
.12 .12
CI CI
'0 u
a E
8 0 50 -  0 50 -
g 3
'c 'c
E E
.c .c
2’ 2’
a: 025 - a: 025 -
E E
0 00 - 0 00 -
r r r r r r r r r r
000 025 050 075 100 000 025 050 075 100

Subsampling OTUs: Proportion Retained Subsampling OTUs: Proportion Retained

Fig. 1. Random subsampling from OTUs permits simulation of specified pair-
wise distances. Each point represents a pair of uniform OTU vectors ran-
domly subsampled without replacement to the same proportion of retained
OTUs. The relationship between the proportion of OTUs retained in subsam-
pling and the distance between the members of the pair is shown for four dif-
ferent distance metrics: as the proportion retained increases, the distance
decreases from 1 to 0. For unweighted distances, subsampling was applied
to uniform OTU vectors with a single sequence read per OTU bin; for
weighted distances, subsampling was applied to uniform OTU vectors with
10 sequence reads per OTU bin. For unweighted Jaccard distances, a line is
also shown to indicate direct computation of expected distance from the pro-
portion of OTUs retained

In planning microbiome studies, the key to sample size/power calcu—
lation is to specify these key quantities. We present in the following
sections a novel way of generating the pairwise distances that can be
used to calculate the within— and between—group sums of squares
and the effect size col. This provides a valid method for simulation—
based sample—sizejpower calculations.

2.2 Simulating within—group pairwise distances by
random subsampling from OTU counts

Many different distributions of community members may yield the
same distance between two microbiome samples. PERMANOVA
testing operates on distances, not species or OTU counts. Therefore,
multiple different species distributions may serve to model micro—
biome community structure for the purposes of PERMANOVA test—
ing so long as the species distributions accurately recapitulate the
distribution of distances. We developed a technique to simulate a
pre—specified distribution of pairwise distances based upon random
subsampling from a simple, uniform OTU vector.

We began with a uniform vector of species or OTU counts, repre—
senting the microbial community of a single subject. For example, we
generated a vector of 1000 OTUs with a single sequence count in each
OTU bin. We then sampled the OTU vector, randomly selecting a
proportion of the sequences to retain (Hughes and Hellmann, 2005).
We found that random subsampling from two subject vectors at the
same level (i.e. with the same proportion of sequence counts retained)
generated a predictable pairwise distance. Though the subsampling
procedure operates randomly and independently on each subject

vector, its effect upon pair—wise distance is consistent: the fewer se—
quences retained, the greater the distance between subjects.

Figure 1 depicts the relationship between subsampling and pair—
wise distance for four distance metrics. Each point represents a subject
pair, and each panel depicts 10000 pairs. Pairs are identical subject
vectors that were subsampled to randomly generated levels; each sub—
ject in a pair was assigned the same proportion of sequences to be re—
tained, but the retained sequences were randomly chosen for
individual subjects and differed between subjects in a pair. We
observed that, for unweighted and weighted Jaccard and UniFrac met—
rics, the distances between subjects varied according to the proportion
of sequences retained. Where all sequences were retained the distance
was 0, and as fewer sequences were retained, the distance approached
1. (Weighted UniFrac is presented in normalized form for this and all
subsequent analyses.) The pattern of this increase varied among dis—
tance metrics. For weighted metrics, it also varied according to the
number of sequences included in each OTU bin prior to subsampling
(data not shown). Nevertheless, random subsampling applied to uni—
form OTU vectors served to generate a set of pairwise distances
matching any pre—specified mean distance; this was accomplished by
choosing the proportion of retained OTUs from a distance—metric—
specific hash table with the form of Figure 1. Because all distances
were calculated from OTU count data, the simulated pairwise dis—
tances satisfied the triangle inequality. Thus, we were able to simulate
a distance matrix with pre—specified mean distance and any number of
subjects for use in the estimation of PERMANOVA power. For un—
weighted Jaccard, expected distance can be calculated directly from
the proportion of OTUs retained; as shown in Figure 1, the calculated
distances confirm our simulation—based method.

2.3 Simulating within—group distance variance by
specifying the number of OTUs in the simulated vector
Just as the mean pairwise distance of a group of simulated subjects
can be specified by random subsampling from the sequence counts
in OTU bins, we found that the variance of the pairwise distances
can be specified by the number of simulated OTU bins. Repeated
random subsamples from a uniform OTU vector with 5000 OTUs
produced a distribution of distances with less variance than repeated
random subsamples from a uniform OTU vector with 500 OTUs,
which in turn produced a distribution of distances with less variance
than subsampling a uniform vector of 50 OTUs. Figure 2A depicts
the same analysis of unweighted Jaccard distance generated between
subject pairs subsampled to a proportion of retained OTUs as was
depicted in Figure 1, but with subject pairs generated to include dif—
ferent numbers of OTUs per subject. As the number of OTUs per
sample increased, the variance of unweighted Jaccard distances
decreased. The same relationship was observed for weighted Jaccard
distances, unweighted and weighted UniFrac distances.

We found that the relationship between the number of OTUs in
the subsampled OTU vector and the standard deviation of the pair—
wise distances that result from subsampling is linear on a log—log
plot. Figure 2B depicts this relationship for unweighted and
weighted Jaccard and UniFrac distances. The pairwise distances de—
picted were simulated by subsampling to retain 50% of the simu—
lated OTUs. The relationship between the number of OTUs and
standard deviation of pairwise distances was found to also depend
upon the extent of subsampling (Fig. 2A). Therefore, accurate mod—
eling of a pre—specified distance standard deviation can be accom—
plished by choosing the number of OTUs after the proportion of
OTUs to be retained in subsampling was decided (based upon the
pre—specified mean distance parameter). This strategy allows

112 /3.10'speum0fp1q1x0"sotJBuiJOJutotq/ﬁduq 11101} pQPBOIHAAOG

9103 ‘Og anﬁnv uo ::

B.J.Kelly et al.

 

 

 

 

 

 

   

 

A B
urn
-3
2
gen E
E
‘2 'E“
gorse E
E “E
E
on .. i
as. .1. : a ' ' a

0 a3 0 '90 0 =3 5 ;
Smsmruirg OTUs: Proportion smiled Lngroru number:

Fig. 2. The number of OTUs subsampled determines the variance of simu-
lated distances. The variance of simulated distances depends upon the num-
ber of simulated OTUs in the vector to which the random subsampling
procedure is applied. (A) depicts the relationship between the proportion of
OTUs retained and the resulting unweighted Jaccard distance. As in Figure 1,
each point represents a pair of OTU vectors randomly sampled without re-
placement to the same level. The color of points indicates the number of
OTUs in the vector. (B) quantifies the relationship between number of OTUs
in the subsampled vector and the standard deviation of the resulting dis-
tances. The relationship between OTU number and distance standard devi-
ation is linear on a log—log plot, though the relationship differs for the four
distance metrics depicted. All data shown are from subsampling at 50%

specification of pairwise distance variance as well as mean in a simu—
lated square distance matrix.

2.4 Group differences incorporated into simulated
distance matrices by segregating OTU membership

We next sought to incorporate group differences into simulated dis—
tance matrices, a necessary step to allow specification of effect size in
power analysis. Having modeled within—group distances by subsam—
pling OTUs and the variance of within—group distances by specifying
the number of OTUs to be subsampled, we found that groups of simu—
lated subjects could be distinguished by segregating community mem—
bership between groups. For example, for a simulated study of three
exposure groups, with 10 subjects per group, we specified the within—
group distance distribution across all groups by specifying the number
of OTUs in the simulated community and the proportion of OTUs to
be retained per sample in subsampling. We then selected at random a
single group of subjects as the affected group. For this group of sub—
jects alone, we renamed a proportion of OTUs. By renaming the
OTUs only in a single group we preserved the modeled distribution of
within—group distances across all groups, but with greater between—
group distances (i.e. with an effect of the exposure). The effect size
was determined by the proportion of unique OTUs in the affected
group, relative to the unaffected groups.

In this way, a range of effect sizes could be generated: where the af—
fected group included no unique OTUs, the between—group distances
matched the within—group distances, and the effect was near 0; where
the affected group included entirely unique OTUs (i.e. community mem—
bership was completely segregated between affected and unaffected
groups), the effect size was large. As we proceeded to quantify these ef—
fect sizes, we found that the definition of small and large effects is con—
tingent upon the chosen distance metric and sampling site—i.e. upon
the distribution of within—group distances (see Section 2.8).

2.5 Estimation of PERMANOVA power using simulated
distance matrices

In order to estimate statistical power for PERMANOVA testing, we
first simulated a set of distance matrices. The within—group pair—
wise—distance distributions were specified to be the same across the
entire set of distance matrices, but each simulated distance matrix

WF‘IH _"

0.?5 -

_ Subject:

0.50 I," amp
0 5

4— IO

... 2°

PERMANOVA Power

0.25 ~

 

 

ODD -

Simulated of

Fig. 3. Bootstrap sampling of simulated distance matrices allows
PERMANOVA power estimation. An example of PERMANOVA power estima-
tion by bootstrap sampling from simulated distance matrices is shown. The
horizontal axis depicts the effect sizes simulated by segregating OTU group
membership, and the vertical axis represents the power to detect the effect,
as determined by the proportion of bootstrap distance matrices drawn from
the simulated distance matrix for which PERMANOVA P—values were below
the specified type I error threshold. The simulated study includes three ex-
posure groups; the power to detect effects with five, 10 and 20 subjects per
group is depicted in red, green and blue, respectively. Power estimated for a
null effect (i.e. differences between subjects but not between groups) was
equal to PERMANOVA type I error

differed in its simulated effect size (i.e. in the proportion of unique
OTUs that distinguish subjects in a randomly selected affected group
from subjects in the unaffected groups). The set of simulated dis—
tance matrices thus encoded a range of effects, extending from very
small effects (no specified difference in group membership, only the
stochastic differences in group membership that may result from the
subsampling procedure) to very large effects (no common member—
ship between affected and unaffected groups).

We then selected bootstrap samples of subjects from each of the
simulated distance matrices. For example, to analyze the
PERMANOVA power for a study that includes 10 subjects per ex—
posure group, we randomly selected with replacement 10 subjects
from each exposure group in each simulated distance matrix, and
we repeated the selection procedure 100 times. The result of each
bootstrap selection was a small matrix of pairwise distances—a sub—
set of the larger simulated distance matrix. The 100 bootstrap selec—
tions taken from each simulated distance matrix thus served as 100
estimates of the true effects encoded in the larger distance matrices.

We next performed PERMANOVA testing on each bootstrap
distance matrix and compared the PERMANOVA P—value with the
pre—specified threshold for type I error (typically, 0.05). For boot—
strap distance matrices drawn from distance matrices that incorpor—
ate true effects, the proportion of PERMANOVA P—values that
exceed the type I error threshold (i.e. which would be deemed not
statistically significant despite the true group—level effect) is the type
II error. For each simulated effect, PERMANOVA power can be cal—
culated as the proportion of bootstrap distance matrices for which
PERMANOVA P—values are less than the pre—specified threshold for
type I error. Figure 3 depicts the result of this procedure: along the
horizontal axis the co2 values associated with the simulated distance
matrices (true effects) are shown; the vertical axis shows the
PERMANOVA power that corresponds with each simulated effect,
based upon PERMANOVA testing of bootstrap distance matrices.

112 /310'S[BHJnOprOJXO"SOTJBHIJOJIITOTCI/ﬂduq 111011 pap1201um0q

9103 ‘0g15n8nv uo ::

Microbiome studies using pairwise distances and PERMANO VA

 

We performed the bootstrap procedure with five, 10 and 20 subjects
per group. As expected, PERMANOVA power increased with the
number of subjects per group.

To confirm the accuracy of our estimation method, the
PERMANOVA power observed under the null hypothesis was cal—
culated from a null distance matrix, which was generated by calcu—
lating pairwise distances from a set of simulated samples in which
all groups of subjects were identical (i.e. without any difference be—
tween groups, only differences between subjects within groups). The
described bootstrap procedure applied to the null distance matrix
produced an estimate of PERMANOVA power equal to the pre—
specified threshold for type I error, as should be the case. We thus
validated our method of power estimation.

2.6 The micropower package permits convenient
estimation of statistical power for microbiome studies
We implemented the strategy described above in a package for R
statistical software in order to facilitate planning of microbiome
studies that are to be analyzed by pairwise distances and
PERMANOVA. The package is freely available under a GPLv2
license and is available online via Github (http://github.c0m/bren
dankelly/micropower). The package can be installed with the
Rcommands:

library(devtools)

install_github(repo=“micropower” ,username=“ brendankelly”)

2.7 Human Microbiome Project datasets provide
parameters for within—group distances

Having established techniques to simulate pairwise—distance matri—
ces with pre—specified distance mean and standard deviation, we
sought to define the range of these parameters observed in biological
data. The Human Microbiome Project (HMP) dataset provides ex—
tensive 16S rRNA marker gene data from the human microbiome
sampled at multiple body sites. As such, it is a resource from which
population parameters (i.e. mean pairwise distance and distance
standard deviation) can be drawn to specify simulated distance
matrices. We analyzed the distributions of unweighted and weighted
Jaccard and UniFrac distances calculated from 16S rRNA marker
gene samples from 18 human body sites, which provide parameters
for modeling the expected within—group distance distribution (HMP
Consortium, 2012a, b). The within sampling—site distance distribu—
tions observed in the HMP datasets (July 2010 165 data freeze;
NCBI SRA projects SRP002395 and SRP002012; http://hmpdacc.
org/HMQCP/), which comprise 2910 samples from which V1—V3
16S rRNA amplicon sequencing was performed and 4788 samples
from which V3—V5 amplicon sequencing was performed, are de—
picted in Figure 4.

2.8 Effect sizes based on published microbiome
datasets

We cataloged the effect size in several published microbiome studies,
representing a variety of sampling sites, exposures and interventions
(Charlson et 41]., 2010, 2012; Peterfreund et 41]., 2012; Wu et 41].,
2011). Table 1 depicts the results of this analysis, with observed co2
values calculated from unweighted and weighted Jaccard and
UniFrac distances. We restricted our analysis to comparisons within
distance metrics because the choice of distance metric is a decision
to be determined by a priori hypotheses regarding the most import—
ant features of community membership.

 

 

 

 

 

 

 

 

 

 

 

 

iitrrrrrrtjirrrrrrrr101011111111”ng
§§§l++ll++iit++li+l+++ 44110111110111;
 rrrrrr _ 11111 
 lillllilllilrl ill )1 (1%

lllt II II

«.141. as; a... ' ' ﬁat? gate '1; '
hbgﬁEﬁbhsgﬁgﬁfsgﬂﬁs
“a ‘1» ta. “*1.

Fig. 4. HMP data provide parameters for modeling the distribution of within-
group distances. The distribution of within-sampling-site distances is shown
for 18 different human microbiome sampling sites. Four different distance
metrics are depicted as applied to data from two different 168 rRNA ampli-
cons (V1—V3 and V3—V5). The colored boxes delineate the interquartile range
(10R), and the whiskers extend to 1.5 x 10R. Outliers are depicted as points.
The HMP data provide parameters according to which the within-group dis-
tance distribution can be modeled to estimate power for planned microbiome
studies

Comparison of co2 values across different studies demonstrated
the range of effect sizes observed. For weighted UniFrac, co2 values
ranged from 0 to 0.646; for unweighted UniFrac, from 0.0001 to
0.201. For weighted Jaccard, co2 values ranged from 0 to 0.230; for
unweighted Jaccard, from 0 to 0.117. (By convention, negative co2
values are treated as 0.) The scale of effects was different for the dif—
ferent distance metrics, but the rank order of effect sizes observed
for different interventions was largely consistent.

The HMP data described above provided a helpful comparator,
by which we judged large and small effects. The large effect
observed with clindamycin treatment exceeded even the effect of
human anatomy—i.e. the difference observed between two distinct
sampling sites (grouping samples from anterior nares versus stool
yields co2 of 0.567 using weighted UniFrac distance). And, though
the observed effects of smoking upon the microbial communities of
the human nares and oral cavity were small (co2 from 0.007 to
0.042), they did exceed the presumably stochastic effect observed
between left and right retroauricular crease skin microbiome sam—
ples (co2 from 0 to 0.0001).

3 Application and results

Here, we provide two examples of applications of the micropower
package in order to demonstrate its use.

3.1 Example 1: power calculation based on unweighted
Jaccard distances

For the first example, we estimated statistical power for a study of
the impact of antibiotic exposure upon the human stool micro—
biome. The study includes three antibiotic exposure groups, with a
primary outcome of community structure difference between groups

112 /310'S[BHJnOprOJXO"SOTJBHIJOJIITOTCI/ﬂduq 111011 pap1201um0q

9103 ‘0g15n8nv uo ::

2466

B.J.Kelly et al.

 

Table 1. Effect sizes observed from various exposures/interventions in studies of various microbiome sampling sites are shown as meas-
ured by omega-squared (wz) statistics, together with the P-values from PERMANOVA test

 

 

 

Site Comparison groups w2/P—value

Control Exposure Weighted Unweighted Weighted Unweighted Reference

UniFrac UniFrac Jaccard Jaccard

Nares Non—smoker (33) Smoker (29) 0042/0001 0009/0001 0023/0001 0.007/0001 Charlson et a]. (2010)
Oral Non—smoker (33) Smoker (29) 0032/0001 0008/0001 0024/0001 0007/0001 Charlson et a]. (2010)
Gut Before feeding (10) After feeding (10) 0056/0138 0013/0986 0/0.989 0014/0985 Wu et a]. (201 1)
Oral No azithromycin (42) Azithromycin (6) 0063/001 0039/0001 0099/0004 0032/0001 Charlson et a]. (2012)
Lung No azithromycin (34) Azithromycin (6) 0065/0005 0038/0001 0019/0089 0033/0001 Charlson et a]. (2012)
Skin Left retroauricular (186) Right retroauricular (187) 0000/0828 0.0001/0.327 0000/0986 0000/1000 HMP Consortium (2012b)
Human Anterior nares (161) Stool (187) 0567/0001 0201/0001 0230/0001 0.1 1 7/0001 HMP Consortium (2012b)

 

The range of observed effect sizes differs according to the metric of pairwise distance chosen for analysis. HMP data are shown to demonstrate a large effect

(the degree of difference between two different human microbiome sampling sites) and a negligible effect (the degree of difference between skin sampling in the

left versus right retroauricular crease)

to be analyzed by unweighted Jaccard distances and
PERMANOVA. Given the study plan, we began by simulating a set
of matrices of pairwise distances for which within—group distances
match the distribution of distances observed in the HMP stool sam—
ple set analyzed by unweighted Jaccard distance (see Fig. 4). In order
to determine the level of subsampling and number of OTUs neces—
sary to model the expected within—group distances, we applied the
hashMean and has/75D commands: simulating 100 OTUs and sub—
sampling to retain 23% of OTUs generated the desired mean
within—group distance of 0.87 and within—group distance standard
deviation of 0.05. A set of OTU tables, incorporating a range of
between—group effects in addition the desired within—group—distance
distribution, was then generated using the simPower command. For
unweighted Jaccard distances, the calc Ujstudy function was applied
to simPower output to compute pairwise distances from simulated
OTU tables within R. Having calculated pairwise distances for each
simulated OTU table, we proceeded with power analysis using the
bootPower command, which produced a data frame that relates
power to simulated col. We applied the bootPower command three
times, to assess PERMANOVA power with either five, 10 or 20 sub—
jects per group. We found that five subjects per group allows 90%
power to detect a co2 of 0.05; 10 subjects per group allows 90%
power to detect an co2 of 0.02; and 20 subjects per group allows
90% power to detect an co2 of 0.008. The effect detectable with the
targeted statistical power, typically 90%, was estimated by LOESS
regression of the power and simulated co2 variables from the
bootPower dataframe. From Table 1, an co2 of 0.02 is smaller than
the effects observed in studies of antibiotic exposure that were ana—
lyzed by unweighted Jaccard distances; therefore, a sample size of
10 subjects per group (30 total subjects) likely affords adequate stat—
istical power for the primary outcome measure.

3.2 Example 2: power calculation based on weighted
UniFrac distances

As a second example, we analyzed the same study—but with the pri—
mary outcome to be measured by weighted UniFrac distances rather
than unweighted Jaccard distances. To do so we used the same com—
mands to perform our power analysis, but we specified a sequence
depth >1. Because the micropower package only includes tools to
compute Jaccard distances, we then exported the simulated OTU
tables for pairwise distance computation by applying the
writeOTU/ist function directly to the output of simPower. This pro—
duced tab—delimited OTU table files that are compatible with bio—
informatics analysis pipelines capable of computing many pairwise

distance metrics (Caporaso et (11., 2010; McMurdie and Holmes,
2013; Schloss et (11., 2009). To compute UniFrac distances also re—
quires a phylogeny. We used the simTreeList command to produce a
phylogeny to match the OTU tables produced by simPower; the ape
package, which loads with micropower, includes a writatree com—
mand to export this simulated phylogeny in Newick tree format
(Paradis, 2012). The matrices of pairwise distances produced from
the OTU tables and phylogenetic tree can be read with the
readDMdir command, and bootPower can be applied to the result—
ing list. In the case of analysis by weighted UniFrac distances, the
mean within—group distance was simulated as 0.2, and the standard
deviation of within—group distances as 0.07 (see Fig. 4). We found
that five subjects per group afford 90% power to detect an co2 of
0.17, 10 subjects per group an co2 of 0.08, and 20 subjects per group
an 002 of 0.04. From Table 1, an (02 of 0.04 is smaller than the effect
observed in a studies of antibiotic exposure that were analyzed by
weighted UniFrac distances; therefore, a sample size of 20 subjects
per group (60 total subjects) likely affords adequate statistical power
for the primary outcome measure if weighted UniFrac distances are
used.

4 Discussion

The accurate estimation of statistical power for planned microbiome
studies demands a detailed accounting of the steps involved in data
analysis. We focused on the 16S rRNA gene sequencing studies that
are analyzed using pairwise distances (specifically, UniFrac and
Jaccard distances) and PERMANOVA. To ensure adequate statis—
tical power for such studies, one must quantify the expected within—
group variance and the effect to be expected from the planned
exposure or intervention. We built a framework for PERMANOVA
power estimation that depends upon prior knowledge of these two
essential parameters. The planned sampling site and chosen pairwise
distance metric inﬂuence both within—group variance and range of
possible effect sizes (as quantified with col). We analyzed datasets
from the HMP and other published studies to provide references
from which the within—group distance distribution and expected ef—
fect can be estimated. These tools, combined with the micropower R
package described above, permit power estimation for planned
microbiome studies.

Since the UniFrac distances depend on the phylogenetic tree of
the OTUs, we reviewed the phylogenetic trees generated from the
HMP project’s V1—V3 and V3—V5 16S rRNA gene sequencing data,
and we observed that the distribution of phylogenetic tree branch

112 /310'S[Buln0prOJXO'SOTJBLUJOJIITOTq/ﬂduq 111011 pap1201um0q

9103 ‘0g isanV uo ::

Microbiome studies using pairwise distances and PERMANO VA

2467

 

lengths was approximately log—normal. To simulate a phylogenetic
tree for a set of simulated OTU tables (the simTreeList function in
the ‘micropower’ package), we first extract all OTU names from the
simulated OTU tables, set each OTU name as a tip of the tree and fi—
nally generate random branch lengths to connect the tips, with the
branch lengths specified according a log—normal distribution. The
final step of random tree generation makes use of the ape package’s
rtree command (Paradis, 2012). We explored other distributions of
branch lengths. The distribution of the branch lengths in the simu—
lated phylogenetic tree does impact the distribution of phylogenetic
(e.g. UniFrac) distances calculated from the simulated OTU table.
For example, simulating branch lengths according to a normal dis—
tribution inﬂates the distance variance. But we found that all distri—
butions of phylogenetic tree branch lengths preserve the observed
relationship between level of OTU subsampling and mean distance,
as well as the observed relationship between number of OTUs sub—
sampled and distance standard deviation.

La Rosa et al. (2012) recently proposed another method for the
detection of significant between—group differences in microbiome
data based on parametric testing of overdispersed taxonomic data
against the Dirichlet—multinomial (DM) distribution and imple—
mented their method as an R package, HMP. HMP allows the esti—
mation of power or necessary sample size for studies with
microbiome outcome measures, based on the framework of hypoth—
esis testing at the level of the OTU vectors themselves. However, the
DM distribution must be specified, via parameters representing the
degree of overdispersion, the number of taxa and the expected com—
position of taxonomic frequencies in both groups, in order to detect
a significant difference. Under the DM model, the effect size is
defined by how far apart the vector of taxa frequencies are from
each other. Specifying the taxonomic frequencies is often difficult,
especially when many such taxa are considered. In addition, one has
to specify the number of reads, which can also be quite variable
from sample to sample. The micropower package, in contrast, uses
the distribution of pairwise distances to be expected from the chosen
distance metric and planned sampling site, and provides data on em—
pirical distributions for comparison (e.g. Fig. 4 and Table 1). By
using PERMANOVA, our method is non—parametric; by allowing
for the use of different distance metrics, our method allows incorp—
oration of phylogenetic relationships among the taxa in power cal—
culation. We have demonstrated that the choice of distance metric
may significantly influence the observed effect, and that the within—
group variance depends upon both the chosen distance metric and
planned sampling site.

By focusing on 16S rRNA sequencing studies analyzed by pair—
wise distances and PERMANOVA significance testing, we have lim—
ited the application to power estimation for global measures of
community structure. In some cases, there are advantages to model—
ing OTU vectors themselves, rather than analyzing community struc—
ture via beta diversity—particularly in cases where categorical
community types and transitions between community types may
match observed biological phenomena (Ding and Schloss, 2014).
Nevertheless, we believe that the presented method will prove useful
given the utility of pairwise distances to the analysis of microbiome
data and the intuitive appeal of an ANOVA—type test in studies with
categorical exposures/interventions and microbiome outcome meas—
ures. One limitation of our method and that of La Rosa et al. (2012)
is that these methods can only perform power calculation for categor—
ical covariates. For a continuous covariate such as age or body mass
index, one can test its association with microbiome composition using
kernel—based regression (Chen and Li, 2013), where the kernel matrix
can be defined based on the pairwise distances. We can then perform

power analysis using simulations or analytical calculation based on
score test. Alternatively, for the purpose of power calculation, one
can discretize the data into categories and apply our proposed
method, which should provide a conservative estimate of power.

Funding

B.J.K. was supported by two National Institutes of Health T32 training grants
(T32 AIO55435 and T32 HL758627). R.G., R.G.C. and F.D.B. were sup-
ported by the Penn Center for AIDS Research (5P3OAIO45008—15). R.G.C.
and F.D.B. were supported by National Institutes of Health (U01
HLO98957). J.D.L. was supported by National Institutes of Health (K24—
DKO78228 and UH3-DK083981). H.L. was supported by National Institutes
of Health (GMO97505 and CA127334). The funders had no role in study de—
sign, data collection and analysis, decision to publish or preparation of the
manuscript.

Conﬂict of Interest: none declared.

References

Anderson,M.J. (2001) A new method for non—parametric multivariate analysis
of variance. Aust. Ecol., 26, 32—46.

Caporaso,J.G. et al. (2010) QIIME allows analysis of high—throughput com-
munity sequencing data. Nat. Methods, 7, 335—336.

Chao,A. et al. (2005) A new statistical approach for assessing similarity of spe-
cies composition with incidence and abundance data. Ecol. Lett., 8,
148—159.

Charlson,E.S. et al. (2010) Disordered microbial communities in the upper re—
spiratory tract of cigarette smokers. PLoS One, 5, e15216.

Charlson,E.S. et al. (2012) Lung—enriched organisms and aberrant bacterial
and fungal respiratory microbiota after lung transplant. Am. ]. Respir. Crit.
Care Med., 186, 536—545.

Chen,J. and Li,H. (2013) Kernel methods for regression analysis of micro-
biome compositional data. In: Hu, M., Liu, Y., and Lin, J. (eds.), Topics in
Applied Statistics. Springer, New York, pp. 191—201.

Ding,T. and Schloss,P.D. (2014) Dynamics and associations of microbial com—
munity types across the human body. Nature, 509, 35 7—360.

HMP Consortium (2012a) A framework for human microbiome research.
Nature, 486, 215—221.

HMP Consortium (2012b) Structure, function and diversity of the healthy
human microbiome. Nature, 486, 207—214.

Hughes,J. and Hellmann,J. (2005) The application of rarefaction techniques
to molecular inventories of microbial diversity. Methods Enzymol., 397,
292—308.

La Rosa,P. et al (2012) Hypothesis testing and power calculations for taxo-
nomic—based human microbiome data. PLoS One, 7, e5 2078.

Legendre,P. and Legendre,L. (2013) Numerical Ecology. Elsevier, Amsterdam.

Levandowsky,M. and Winter,D. (1971) Distance between sets. Nature, 234,
34—35.

Lozupone,C. and Knight,R. (2005) UniFrac: a new phylogenetic method for
comparing microbial communities. Appl. Environ. Microbiol, 71,
8228—8835.

Lozupone, C. et al. (2007) Quantitative and qualitative beta diversity meas—
ures lead to different insights into factors that structure microbial commun-
ities. Appl. Environ. Microbiol, 73, 1576—1585.

Lozupone,C. et al (2010) Unifrac: an effective distance metric for microbial
community comparison. ISME j., 5, 169—172.

McArdle,B.H. and Anderson,M.J. (2001) Fitting multivariate models to com—
munity data: a comment on distance-based redundancy analysis. Ecology,
82, 290—297.

McMurdie,P.J. and Holmes,S. (2013) phyloseq: an R package for reproducible
interactive analysis and graphics of microbiome census data. PLoS One, 8,
e61217.

Olejnik,S. and A1gina,J. (2004) Generalized eta and omega squared statistics:
measures of effect size for some common research designs. Psychol.
Methods, 8, 434—447.

112 /310's1cu1n0[p1q1x0"soticuiJOJHtotq/ﬁduq 111011 pap1201um0q

9103 ‘0g isanV uo ::

2468

B.J.Kelly et al.

 

Paradis,E. (2012). Analysis of Phylogenetics and Evolution with R. Springer,
New York.

Peterfreund,G. et al (2012) Succession in the gut microbiome following anti-
biotic and antibody therapies for clostridium difﬁcile. PLoS One, 7,
e46966.

R Core Team (2014) R: A Language and Environment for
Statistical Computing. R Foundation for Statistical Computing, Vienna,
Austria.

Schloss,P.D. et al. (2009) Introducing mothur: open—source, platform—inde—
pendent, community-supported software for describing and comparing mi—
crobial communities. Appl. Environ. Microbiol, 75, 7537—75 41.

Wu,G.D. et al. (2011) Linking long-term dietary patterns with gut microbial
enterotypes. Science (New York, N. Y), 334, 105—108.

Zar,J.H. (1999) Biostatistical Analysis. Prentice Hall, Upper Saddle River, NJ.

Ziegler,M. and Buhner,M. (2009) Statistik fur Psychologen und
Sozialu/issenschaftler. Pearson Studium, Munich.

112 /310's1cu1n0[p1q1x0"soticuiJOJHtotq/ﬁduq 111011 pap1201um0q

9103 ‘0g isanV uo ::

