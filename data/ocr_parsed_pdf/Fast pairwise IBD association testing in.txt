BIOINFORMA TICS

0'so;112u110}u101q//2duq

SIBumoprOJX

£10"

Fast Pain/vise IBD Association

 

of permutations, often resulting in many SNPs having the same
minimal P—values in the region.

In this article, we present a new method, ‘Fast—Pairwise’,
to overcome the computational challenges of the traditional
pairwise method. Fast—Pairwise uses ‘importance sampling’
(W asserman, 2004) to improve efficiency and to enable approxi—
mation of extremely small P—value. To devise an importance
sampling procedure, we introduce a new statistic that has two
properties; it can approximate the pairwise method statistic, and
it can be conveniently used for designing a sampling procedure.
We show that the new statistic has a close relationship with the
pairwise method statistic through the properties of the graph
representation of IBD.

Fast—Pairwise is efficient and takes only days to complete a
genome—wide scan. To demonstrate the utility in ﬁne—mapping,
we apply our method to the type 1 diabetes dataset of the
Wellcome Trust Case Control Consortium (2007). In this dataset,
the traditional pairwise method can identify a signiﬁcant region in
chromosome 6 (Browning and Thompson, 2012), but it gives the
same minimal P—value for a wide region (26.77355 Mb), including
all eight classical human leukocyte antigen (HLA) genes. Among
these, Fast—Pairwise pinpoints HLAiDQBI, which is known to
cause the disease (Todd et al., 1987).

Fast—Pairwise is publicly available at http://genetics.cs.ucla.
edu/graphibd.

2 METHODS
2.1 IBD graph

Given N individuals, the IBD information at a genomic locus can be
represented as a graph with N vertices (Fig. 1). An edge exists between
a pair of vertices if the individuals are IBD.

2.2 Pairwise methods for IBD association mapping

We refer to a class of IBD association mapping methods as ‘pairwise
methods’ if they examine the relative number of edges in the IBD
graph at each locus. There are three different types of edges: edges that
connect two case individuals, edges that connect two control individuals
and edges that connect a case and a control individual. Pairwise methods
can be performed in two different ways. One way is to compare the
number of case/case pairs with control/control pairs. A second way is
to compare the number of case/case pairs with non-case/case pairs (union
of control/control pairs and case/control pairs). We will call the ﬁrst
method CC and the second method CN. In this article, we mainly
focus on CN consistent with previous studies (Browning and
Thompson, 2012; Purcell et al., 2007). If we simply refer to the ‘pairwise
method’, we are referring to CN.

IBD information

(pairs of individuals that are IBD) i 5
1 (AB) IBD B c F G
2 (AC) W, l I O O
3 (3,0) D H
4 (DH I .
5

“3”
.Control
Fig. 1. An example of IBD graph. IBD detection method provides IBD

information (Table). Then we build a graph where vertices are individuals
and edges are IBD relationships

Suppose that we have NJr cases and N’ controls (NJr + N’ = N). Let
VJr be the set of case vertices and V’ be the set of control vertices. Let EJFJr
be the set of all possible case/case vertex pairs, E" be the set of all possible
control/control vertex pairs and E+’ be the set of all possible case/control
vertex pairs. Let 8,7 be 1 if there exists an edge between vertices i and j, and 0
otherwise. Then, the CC and CN statistics are deﬁned as

SCC = Iﬁcasc/casc — Iﬁcomrol/comrol
— z  z 

_ + — 7
(i.ﬂeE++ N (211361?" N

2 2

SCN = IBDcasc/casc _ IBDnonicasc/casc
8,; 8,»,-

= Z + Z 7
(i.ﬂeE++  ) (i.j)eE"UE+’  > + N+N7

The asymptotic distributions of these statistics are difﬁcult to obtain ana-
lytically. This is because the statistics are based on the edges that depend
on each other. For this reason, statistical signiﬁcance is assessed by per-
mutation. We assume a one-sided test, where IBD segments carry vari-
ants that are involved in disease (Browning and Thompson, 2012).

The relationship between CC and CN is worth noting. Under the con-
dition that the background IBD rates of control/control pairs and the
non-case/case pairs are equivalent (IBDCOmml/Comml = IBDnonLCasc/msc),
CN will be more powerful than CC owing to the additional N+N’
pairs it considers. We expect that, however, the relative ordering of the
two statistics is similar to each other (Fig. 2), as most of the pairs for both
CC and CN are the same. As we will show later, we will use this similarity
as the basis of increasing the computational efﬁciency of computing the
signiﬁcance of SCN.

 

 

 

2.3 Permutation test

Permutation is the standard approach for assessing the signiﬁcance of the
pairwise method. A single permutation can be thought of as a randomly
sampled a vector of case/control disease statuses. Let

v 2 (v1, ...,vN), Vvi 6 {0,1}
be the vector of disease status of N individuals, where 0 denotes control
and 1 denotes case. The test statistic of pairwise method, SCN, is a func-
tion of v. Let 9 be the case/control status that was originally observed in
the data. The standard permutation test is equivalent to sampling new v
from all possible permutations of v assuming a uniform distribution. Let
B be the set of sampled v. The estimated P-value is

1 Emma) 2 mo» (1)

13 =—
 veB

where 8 is the indicator function.

Null hypothesis

Alternative hypothesis

 

"e

e L 0
O X '—
2 ” 5r
8
“‘7” O
O
0 to
<0 'o

; 0

c1’

—3><10'5 o 3><1O'5 0 4x10‘4

SCN statistic SCN statistic

Fig. 2. High correlation between CC and CN statistics. We simulated
1000 studies under the alternative hypothesis (see Section 3.2). We then
permuted phenotypes to simulate the null hypothesis. Spearman p is 0.89
and 0.99 under the null and the alternative, respectively

 

207

ﬁm'spzumol‘pmﬂo'sopeuuopuotq/ﬁdnq

53x\Ewogmoizmnnw.oxmoagoﬁsiwbwﬁ

oo~o
o
o
I
.Y.
I
o
o o
0
III

Fast Pain/vise IBD Association

 

2.6 Substitution strategy

Here we propose to use SSUM in sampling as a substitution to the pairwise
method statistic, SCN. The logical ground for this strategy comes from the
relationship between SCN and SSUM. We have empirically shown that SCN
and SCC are highly correlated (Fig. 2). Because SCC and SID are in MIR
in a balanced study (Lemma 1), we expect that they will be correlated in
general even in an unbalanced study, and we show this property through
a simulation experiment (Supplementary Fig. S1). SID is in MIR with
SSUM (Lemma 2). Thus, SSUM can be an approximation to SCN (Fig. 4).

Given this relationship between SCN and SSUM, our strategy is to
sample v such that SSUM(v) will be similar to Sgt/MG) on average. Our
new goal can be described as

[E/(SSUM(V)) = SSUMW) (4)

It turns out that this new goal is much easier to achieve. Note that SSUM
is used only for sampling. After the sampling is done, the sampled v is
used to approximate the P-value of CN method.

This substitution approach works because in importance sampling, the
sampling distribution need not guarantee optimality (the smallest vari-
ance of P-value estimate). Instead, a reasonably similar distribution to the
optimal distribution sufﬁces. It is clear that this strategy will perform the
best if the balanced study condition is met. However, even if the condition
is not met, only the variance of P-value estimate is affected and not the
mean. The P-value estimate will still be unbiased, and it only means that
we will need a larger number of samples to obtain the same accuracy.

2.7 Sampling with replacement

In this section, we devise a sampling procedure satisfying Equation (4).
Such a sampling procedure will be the core part in our importance sam-
pling framework for speeding up CN method.

Sampling a random v from all permutations of v can be thought of as
sampling NJr of N individuals that will be assigned case status, or equiva-
lently, sampling NJr case indices among 1, ...,N. Let a1, ...,aN+ be the
sampled case indices. These are the indices in v that will be assigned ‘1’.
Sampling case indices is without-replacement sampling procedure; we
cannot sample the same index twice, so that exactly NJr distinct indices
will be sampled at the end (Vi 75 j, a,» 7A aj). This way, we can restrict
sample space of v to the set of all permutations of v.

However, the design of sampling procedure satisfying Equation (4) is
considerably easier if we assume sampling case indices with replacement.
That is, we allow the same index can be sampled multiple times. Although
this assumption is not valid for our purpose, our strategy is to devise a
sampling approach satisfying Equation (4), assuming sampling with re-
placement ﬁrst, and then extend the approach to the sampling without
replacement.

Suppose that we pick a 1 among 1, . . . , N with probability P(a1 = k) =
g(k), 2L] g(k) = 1. Because we assume sampling with replacement,
sampling a2 is no different from sampling al; in fact, for any
1 5 i 5 N+, a,- is independent and identically distributed (IID) with dis-
tribution g. Now consider w“l , the IBD-degreetype allele of a1. Let

Pairwise method

 

 

 

 

 

SCN SCC SID SSUM
| || H l
Correlated MIR in MIR
balanced (Lemma 2)
design
(Lemma 1)

 

Approximate

Fig. 4. Relationship between different statistics

[Eg(wul) be the expected value of w“l with respect to g. Again, because
we assume sampling with replacement, [Eg(wul) = . . . = [Eg(wuN+ ).
Then, by the deﬁnition of SSUM, we can easily see that

[Eg(SSL/M) = N+ [Eg(Wui)
Thus, equation (4) can be described as

N+[Eg(Wul) = SSUlw(€’)
or

SSUMW)
N+

 

Eg(wui) = (5)

where the left side is the expected case IBD-degreetype allele in our dis-
tribution g and the right side is the average case IBD-degreetype allele in
the observation v. This shows that, if the P-value is highly signiﬁcant (e.g.
the right side is large), we should pick a1 (and all a,-) such that the expected
value of IBD-degreetype allele can be large.

Here we propose a new sampling procedure that satisﬁes condition (5).
We deﬁne distribution g as follows

P(a1 = k) = g(k) oc IA. where ti. = 1 + pwk

and

N—Swf“) — ﬁ wk
p = —N ‘le (6)
Z wi — —S“j\ﬂ(v) 2 wk
k2] [:1
It is easy to show that this sampling procedure meets condition (5), as
condition (5) can be described as

N
1+ w. w. A

_A§1( p A) A _SSUM(V)

+

N

Z [kwk

k:
[Eg(wui) :

 

N
[A Z (1 + WA»)
[:1

2_.

k

and by solving this for p, we exactly have equation (6). If p<0, then we
set p to 0 to prevent negative tk. Such a case is not of our interest at any
rate, as we focus on the one-sided test for detecting excess of case/case
IBD. We choose the most simple linear function for tk, which enables us
to calculate p easily. As a result, for any v, we can calculate p and com-
pletely deﬁne the distribution g. So far, we have successfully deﬁned a
sampling procedure satisfying Equation (4), assuming sampling with
replacement.

2.8 Sampling without replacement

In this section, we extend the sampling procedure from the previous sec-
tion to the ‘sampling without replacement’. Here we propose to heuris-
tically apply the same sampling scheme based on [1, . . . , [N to the
without-replacement context. When we pick a,- (ith case index), we pick
index k among {1, . . . , N}\{a1, . . . ,aH} with probability
tk/(ijil tj —  rm). That is, we assume the same sampling probabil-
ity proportional to tk, but we exclude indices previously picked as cases
from our consideration.

However, this sampling procedure does not exactly satisfy Equation
(4) in the without-replacement sampling context. The indices with larger
IBD-degreetype alleles are likely to be picked as cases earlier in the pro-
cedure and removed. Thus, if we use p calculated assuming sampling with
replacement, the expected case IBD-degreetype allele [the left side of
Equation (5)] will be smaller than what we would obtain in the with-
replacement context. To compensate for this difference, we use the fol-
lowing heuristic. In the middle of sampling, we empirically assess the left
side of Equation (4) by examining the currently obtained samples. Then,

 

209

ﬁlO'SIIZIImOprOJXO'SOplZILLIOJLIIOIQ/[idnq

B.Han et al.

 

we dynamically increment p until the left side of Equation (4) is close to
the right side. This simple heuristic is sufﬁcient because, again, in import-
ance sampling, we only need to approximately satisfy Equation (4).

2.9 P—value calculation

By using the sampling procedure developed in the previous section, we
can obtain many sample v that approximately satisfy Equation (2). The
ﬁnal step is to use these samples to assess the P-value of pairwise (CN)
method. In importance sampling, we must account for the fact that we
used a sampling distribution that is different from the original distribu-
tion. Our original distribution is the uniform distribution deﬁned by the
standard permutation approach. The sampling distribution is deﬁned by
the sampling procedure that we developed in the previous section.

For a given v, the probability of sampling v differs in the two distri-
butions as follows. To sample a v, we sample the case indices a1, . . . , a M.
The probability of sampling case indices in the standard uniform distri-
bution is

1

PUniform(v) = 

On the other hand, the probability of sampling case indices in our sam-
pling procedure described in the previous section is

[:1 j:1 1:1
This is because at each step we pick ith case index a,-, we sample the index
with probability proportional to rm, where the previously picked indices
a1, . . . , aN+ are excluded from consideration. Using the standard formula
of importance sampling, we approximate the P-value

A 1 PUnifonn(v) A
= — — - 8 S v 2 S v
p IBI  PNCWM ( m ) CM ))
Note that we use the pairwise CN statistic in this formula. We use SSUM
only to facilitate the sampling of v, and then use the obtained samples for
CN method at the ﬁnal step.
We can approximate the variance of 13 with the following formula

1 PUniform(V) 2 A A2
EX};  -(3(SCN(V) Z SCN(V)) _p /|B|

2.10 Adjusting for population structure

A simple correction for population structure has been previously pro-
posed (Browning and Thompson, 2012; Purcell et al., 2007) for the pair-
wise method. In this simple approach, the genomic average is subtracted
from each of the two contrasting terms of the statistic. For example, in
CN method, the genomic average of case/case IBD rate is subtracted
from the observed case/case IBD rate, and the genomic average of
non-case/case IBD rate is subtracted from the observed non-case/case
IBD rate before calculating the statistic. The same approach can be
applied to our Fast-Pairwise method.

3 RESULTS
3.1 Efficiency

To assess the efﬁciency gain of our Fast—Pairwise method, we use
the Wellcome Trust Case Control Consortium (WTCCC) data
(Wellcome Trust Case Control Consortium, 2007). We first run
Beagle FastIBD to detect IBD between individuals (Browning
and Browning, 2011). Then we test individual IBD segments for

associations. We perform IBD association testing using both
the traditional pairwise method based on permutation and our
Fast—Pairwise method. We perform 10 million permutations for
the traditional pairwise method. For our Fast—Pairwise method,
we perform importance sampling with 1000 samples and 10 000
samples. We implemented both methods in the Java program—
ming language.

Table 1 shows the estimated running time of both methods for
analyzing the whole genome data (500 000 SNPs) of a single
disease. The time is extrapolated from the estimated time for
chromosome 22. Our Fast—Pairwise method is several orders of
magnitude faster than the traditional pairwise method. It takes
only 4 days for the whole genome, whereas the traditional
method can take 13000 days or 35 years of CPU time.

We can reduce the computation time for the traditional pair—
wise method by using an adaptive permutation approach. We
can terminate the permutation earlier if the P—value approxi—
mates to a non—signiﬁcant value. Given a P—value p, we need
100/p permutations to obtain the standard error of ~ p/ 10.
Suppose that we sample 100/p permutations for each P—value
with upper limit of 10 millions. When we apply this adaptive
approach to the WTCCC type 1 diabetes data, the estimated
computation time is 474 days. Thus, Fast—Pairwise is still an
order of magnitude faster than the traditional pairwise method
with an adaptive permutation approach.

3.2 Accuracy

To assess the accuracy of our importance sampling, we use the
simulation framework similar to Browning and Thompson
(2012). Using the HapMap ENCODE regions (International
HapMap Consortium, 2005), we run HapGen2 to simulate
10000 individuals (Su et al., 2011). These individuals deﬁne
our founder population. Then we simulate the ﬁrst generation
by sampling 100 000 individuals from the founders. Next we
simulate the second generation by sampling 100 000 individuals
from the first generation. We repeat until we obtain the 25th
generation. Finally, we use the 25th generation to simulate a
case/control study. Within the ENCODE region, we randomly
select five causal variants among all rare variants (minor allele
frequency <1%). If a haplotype contains one or more causal
variants, it confers risk with relative risk selected from uniform
(3,10). We assume the disease prevalence of 0.1. Given this dis—
ease model, using the standard formula of the case and control
minor allele frequencies (Han et al., 2009), we sample 1500 cases
and 1500 controls from the 25th generation. The IBD informa—
tion between a pair of individuals is determined by tracking
whether they are descendants of the same founder. We repeat

Table 1. Running time for pairwise IBD association testing for the
WTCCC whole genome data

 

Traditional pairwise method Fast-Pairwise

 

107 permutations Adaptive permutations 104 samples 103 samples

 

35 years 474 days 40 days 4 days

 

 

210

ﬁlO'SIIZIImOprOJXO'SODBILLIOJLIIOICV/idnq

Fast Pain/vise IBD Association

 

this simulation 100 times per each of the 10 ENCODE regions to
generate 1000 sets of case/control studies.

Given these case/control study sets, we assess the P—values of
pairwise (CN) method using both the standard permutation and
the importance sampling of Fast—Pairwise. We use 10000 sam—
ples for importance sampling and compare with 104, 105 and 106
permutations. Figure 5 shows that the P—values of two methods
track well within the P—value range that permutation can ap—
proximate (up to P—values of 104, 10’5 and 10*, respectively).
Within this range, the Pearson correlation r2 of two log P—values
are 0.98, 0.94 and 0.99, respectively. This shows that our import—
ance sampling procedure obtains accurate P—values.

Moreover, Figure 5 emphasizes a fundamental difference be—
tween the two methods. In permutation, the range of P—values
one can obtain is limited by the number of permutations. Given
|B| permutations, if none of the permutations exceeds the
observed statistic, a conservative approximation of P—value is
1/|B|. In contrast, in Fast—Pairwise, the P—value range is not
bounded by the number of samples. With a relatively small
number of samples (10000), Fast—Pairwise can obtain accurate
P—values comparable with the permutation test for a wide range
of P—values. We also performed extra permutations (>106) to
estimate P—values between 10’6 and 108. The P—values of the
two methods are still consistent within this P—value range (tri—
angles in Fig. 5C).

3.3 Application to WTCCC type 1 diabetes data

Browning and Thompson (2012) applied the pairwise (CN)
method to the WTCCC type 1 diabetes (T1D) data based on
the Beagle FastIBD IBD mapping results (Browning and
Browning, 2011). Using 5 million permutations, they found
that the major histocompatibility complex (MHC) region in
the chromosome 6 is statistically signiﬁcant given the genome—
wide threshold 6 x 10*. Because the MHC association to T1D
has been historically known (Todd et al., 1987), this result was a
validation that IBD association testing can detect the true asso—
ciation signal.

The limitation of Browning and Thompson’s (2012) permuta—
tion approach is that although it is possible to determine whether
each test is signiﬁcant (p<6 x 10*) using 5 million permuta—
tions, it is not possible to approximate much smaller P—values.
Given 5 million permutations, the smallest P—value one can ap—
proximate is bounded to 2 x 107. In the MHC region, because
of the strong signal and the long linkage disequilibrium, the lo—
cation of the top peak of P—value is important for interpreting
and fine—mapping the results. Figure 6A shows that the top peak
of P—value is stretched over a wide region (>8 Mb) including all
eight classical HLA genes. Therefore, it is difﬁcult to interpret
which HLA gene is likely to be involved in the association.

We applied our Fast—Pairwise to the same dataset. Because
Fast—Pairwise is the same pairwise method with increased efﬁ—
ciency, we expected to see the similar results as Browning and
Thompson (2012). We discovered signiﬁcant associations within
the MHC region. However, the difference is that because our
method can approximate small P—values well beyond the
genome—wide threshold, it is possible to localize the statistical
signal to a single marker (Fig. 6B). The top hit is at SNP
rs241432 (p = 7 x 1045) at the intron of TAPZ gene. Among

A B C

g E o  I o   o
3 a E‘ E i a - 2
“Lo '53 3 r i = ‘ r = 
6) ‘L g 
2 g 9

LL 9 “.° °r °r A

—8 —4 o —a —4 o —8 —4 o
long by long by Iong by

10,000 Permutations 100,000 Permutations 1,000,000 Permutations

Fig. 5. Accuracy of importance sampling. In simulations using the
HapMap ENCODE region, we assess the P-values of pairwise (CN)
method using both the standard permutation and Fast-Pairwise (import-
ance sampling). We compare 10000 samples of Fast-Pairwise to (A)
10000, (B) 100000, and (C) 1000000 permutations. The vertical
dashed line denotes the lower bound of P-value that permutation can
approximate given the number of permutations. The dots along the ver-
tical line denote the simulations where none of the permutations exceeds
the observed statistic, and therefore the lower bound of P-value is re-
ported by the permutation test. The triangles in (C) are the P-values that
we performed extra permutations (> 106)

all major class I and II HLA genes, the closest gene to this
peak is HLAiDQBI (150 kb upstream from the peak). It is his—
torically known that the main contributing gene for the MHC
association to T1D is HLAiDQBI (Todd et al., 1987). Thus, this
result demonstrates that our Fast—Pairwise method can pinpoint
the causal gene among many HLA genes within the MHC
region, while the traditional pairwise method cannot.

One interesting observation is that the peak association of our
IBD association test is on the T AP2 gene that encodes antigen
peptide transporter 2 and has been shown to confer independent
risk to the T1D when conditioned on the DQ haplotypes (Qu
et al., 2007). Thus, the peak revealed by our Fast—Pairwise
method may imply the added effect of T AP2 in addition to the
primary effect of HLAiDQBI, which is in linkage
disequilibrium.

4 DISCUSSION

We have developed a new efficient method for pairwise IBD
association testing called ‘Fast—Pairwise’. Fast—Pairwise uses im—
portance sampling and can perform the pairwise method more
efﬁciently than the traditional method based on permutation.
Moreover, unlike permutation, Fast—Pairwise can approximate
extremely small P—values beyond the genome—wide threshold.
Using the WTCCC type 1 diabetes data, we show that Fast—
Pairwise can successfully pinpoint a gene known to be associated
to the disease within the MHC region.

The true utility of the IBD association testing is on ﬁnding
novel loci where there are potentially multiple rare variants that
cannot be found using single SNP tests (Browning and
Thompson, 2012). An important advantage of IBD association
testing is its wide applicability. The analysis can be performed
using the same genotype data collected for single SNP tests with—
out incurring additional cost. For this reason, we feel that many
investigators will apply our method to search for these additional
loci bearing rare causal variants. What is preventing researchers
from applying this approach is an efﬁcient method for IBD as—
sociation testing, which we provide in this article. We expect that

 

211

ﬁle'spzumol‘pmﬂo'sopcuuowrorq/ﬁdnq

HLA—DOB 1

 

your» w <9 0
‘0 o

.- ( 

x 9) Ann”?

    

 

HLA—A HLA—C HLA—DFIB1 HLA—D031 HLA—DPA1
|| | II Mill Hill III II" |||II||II|||lIIII|||I|IlI|||||||||||l||l|||l||||l||||| III II I “III” III
HLA—B HLA—DQA1 TAP2 HLA—DPB1

/3.IO'S[BIIm0[p.IOJXO'SOIJBIIIJOJIIIOIq/ﬂdnq

Fast Pain/vise IBD Association

 

Han,B. et a]. (2009) Rapid and accurate multiple testing correction and power
estimation for millions of correlated markers. PLoS Genet, 5, e1000456.

International HapMap Consortium. (2005) A haplotype map of the human
genome. Nature, 437, 129971320.

Marchini,J. et a]. (2007) A new multipoint method for genome—wide association
studies by imputation of genotypes. Nat Genet, 39, 90(r913.

Purcell,S. et a]. (2007) Plink: a tool set for whole—genome association and popula—
tion—based linkage analyses. Am. J. Hum. Genet, 81, 5597575.

Qu,H.Q.Q. et a]. (2007) Genetic control of alternative splicing in the tap2 gene:
possible implication in the genetics of type 1 diabetes. Diabetes, 56, 27(F275.

Su,Z. et a]. (2011) Hapgen2: simulation of multiple disease SNPs. Bioinformaties, 27,
230442305.

Todd,J.A. et a]. (1987) Hla—dq beta gene contributes to susceptibility and resistance
to insulin—dependent diabetes mellitus. Nature, 329, 599%04.

Wasserman,L. (2004) All of Statistics. Springer, New York.

Wellcome Trust Case Control Consortium. (2007) Genome—wide association study
of 14,000 cases of seven common diseases and 3,000 shared controls. Nature,
447, 6617678.

 

213

/3.IO'S[BIIInO[p.IOJXO'SOIIBHIJOJIIIOICV/Idllq

