Bioinformatics, 31 (14), 2015, 2269—2275
doi:10.1093/bioinformatics/btv165

Advance Access Publication Date: 19 March 2015
Original Paper

 

Genome analysis

A robust approach for identifying differentially
abundant features in metagenomic samples
Michael B. Sohn1, Ruofei Du2 and Lingling An1'2'*

1Interdisciplinary Program in Statistics and 2Department of Agricultural and Biosystems Engineering, University of
Arizona, Tucson, AZ 85721, USA

*To whom correspondence should be addressed.
Associate Editor: Inanc Birol

Received on November20, 2014; revised on February 3, 2015; accepted on March 16, 2015

Abstract

Motivation: The analysis of differential abundance for features (e.g. species or genes) can provide
us with a better understanding of microbial communities, thus increasing our comprehension and
understanding ofthe behaviors of microbial communities. However, it could also mislead us about
the characteristics of microbial communities if the abundances or counts of features on different
scales are not properly normalized within and between communities, priorto the analysis of differ—
ential abundance. Normalization methods used in the differential analysis typically try to adjust
counts on different scales to a common scale using the total sum, mean or median of representa—
tive features across all samples. These methods often yield undesirable results when the difference
in total counts of differentially abundant features (DAFs) across different conditions is large.
Results: We develop a novel method, Ratio Approach for Identifying Differential Abundance
(RAIDA), which utilizes the ratio between features in a modified zero—inflated lognormal model.
RAIDA removes possible problems associated with counts on different scales within and between
conditions. As a result, its performance is not affected by the amount of difference in total abun—
dances of DAFs across different conditions. Through comprehensive simulation studies, the
performance of our method is consistently powerful, and under some situations, RAIDA greatly
surpasses other existing methods. We also apply RAIDA on real datasets of type II diabetes and
find interesting results consistent with previous reports.

Availability and implementation: An R package for RAIDA can be accessed from http://cals.arizona.
edu/%7Eanling/sbg/software.htm.

Contact: anling@email.arizona.edu

Supplementary information: Supplementary data are available at Bioinformatics online.

 

 

1 Introduction

Metagenomics is the study of microbes by analyzing the entire
genomic sequences directly obtained from environment samples,
bypassing the need for prior cloning and culturing of individual
microbes (Thomas et (11., 2012). This has been a tumultuous obs-
tacle to overcome for the purposes of studying the structural entir-
ety of a microbial community, primarily because more than 99%
of microbes cannot be isolated and independently cultured in labo-
ratories (Schloss and Handelsman, 2005). The field of metagenom-
ics has attracted researchers of diverse backgrounds, including

microbial ecology, biosciences and health and medical sciences,
due to the increasing availability of high throughput sequencing
technologies (Virgin and Todd, 2011). An important application
of metagenomics is the identification of differentially abundant
features (DAFs), which can be either taxonomic units (e.g. species)
or functional units (e.g. genes) across different environmental
(including host-associated) conditions (White et (11., 2009).
Detection of differentially abundant microbes across healthy and
diseased populations, for instance, can enable us to identify poten-
tial pathogens or probiotics.

(C7 The Author 2015. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com 2269

/310‘srcumo[p10}xo‘sopcuHOJIItotq/ﬁdnq

Dillics cl (1]., 2013 Paulson cl (1]., 2013

Robinson and Oshlack, 2010

_

 

C.2

_

C.2

Figure 1

Anders

and Huber, 2010 Robinson cl (1]., 2010

Hughes

cl .21., 2001

r’hitc cl (1].,
2009 Paulson cl (1]., 2013

Qin cl (1]., 2012

/810'sreumoprOJxo"sormuuogurorqﬂ:duq

RAIDA

2271

 

community (false zeros). All zeros remain unchanged after trans—
forming the count data into ratio data using a common divisor. It can
be a vector of the counts of a feature consisting of non—zeros in all
samples or a vector of the sums of a group of features consisting of
non—zeros in all samples. To fit ratios with zeros, we use a modified
ZIL. Note a lognormal distribution has been used as a fundamental
distribution for non—zero ratios in the compositional data analysis
(Aitchison, 1986).

Let 6,, denote the observed count for feature 1' and sample /, and
1,, denote the ratio of 6,, to 6k,, where k represents a feature (or a set
of features) used as a divisor and Ch, > 0 for all /. Here, i : 1,2, .. . ,
n and/ : 1,2, . . . ,m. Throughout this article, we denote undersam—
pling of the microbial community or insufficient sequencing depth
by the false zero state. Assuming a ZIL model for the ratio R,,, we
have:

with probability 11,

- (1)
with probability 1 — 11,

0
R, ~
1 2
LN(.”i7 ‘71 1
This model does not account for zero counts from the true zeros
since the support for a lognormal distribution is (0, +00); that is, 1,,
is assumed to be in the false zero state if 6,,: 0, whether or not the
zero count comes from the false zero state. To accommodate for this
insufficiency, a small number 6 is added to 6,, for all i and / before
computing the ratios. We denote the ratio computed this way as Rf,-
and we have:

Unif(0, 6)
R; N
I LN(.”i7 

with probability 11, (2)
with probability 1 — 11, i

In this study, we use 6 : min (r,,)r,, > 0) for all i and j. The par—
ameters 0, : (11,,11,, 0,) are estimated by the following expectation—
maximization (EM) algorithm.

2.2 EM algorithm

Given that a ratio R follows a lognormal distribution,

2
exp (3,

 

2 7
fLNUlHJ )— a 27W 202
by definition Y : log R is normally distributed with mean 11 and
variance 02. Thus, the maximum—likelihood estimate of 0, for the

modified ZIL model, Equation (2), can be obtained by solving

[(oilyi/vzii) : ZZi/loglﬂi + (1 — ﬁi)fN(yi/;Hm7,~2)l
/:1

m

+Z(1 - Zi/110g(1 — '11) (4)
/:1

m

+2“ — Zi/ﬂongWi/WMEZL
;:1
where 31,, : log 11;, fN is the probability density function of a normal
distribution and z,, is a unobservable latent variable that accounts
for the probability of zero coming from the false zero state. The
E and M steps of our EM algorithm are defined as follows:

Initialization step
Initialize the values of (11,,11,, (7,) using 11(0) : NF/N, where N5 is the

i
number of y,,§loge and N is the number of y,,,
1110) : E(y,,1y,, > log 5) and (7)0) : Var(y,,)y,, > log 6). In cases that

0', : 0, we initialized 0'50) with 10—6.

E step
Estimate Zlk)

11' 9
. . [2
state given current estimates  ) 

the probability of zero coming from the false zero

(1%)
VI,‘ .
— 1f y,,£loge
k k [2
2,1,1) 2 11,1 )+ (1 — 11,1 ))<1>(\/zr§, 1) , (5)
0 if 31,-, > loge

where (I) is the cumulative distribution function of a normal distribu—
. k k 12
tion and C1,) : (31,-,- — 11,) ))/(\/20',) )).

M step
Estimate 0
Equation (4) subject to the constraints: 0311,31 and a, > 0 for all 1'.

1k“) given current estimates of Z110) by maximizing

We used a limited—memory modification of the BFGS quasi—Newton
method (Byrd et al., 1995).

Repeat the E step and M step until all the parameters converge,
i.e. the differences between (k + 1)th and kth estimations for all the
parameters are <10_6.

2.3 Selection of possible common divisors

The ratio between a pair of features in samples under the same condi—
tion remains constant in the absence of random variations and the
ratios between features in a sample are invariant when features are
divided by a common divisor. As an illustration, consider the follow—
ing example. Let s : {61,62,  ,6,,} denote a sample containing
counts of 11 features and s’ : K - 5 denote another sample on a differ—
ent scale. Then, the ratio, for instance, between feature 1 and feature
2 in sample 5’ is (K - 61)/(I€ - 62) : 61/62, which is the same for the
ratio between feature 1 and feature 2 in sample 5. That is, the ratio is
not affected by the scaling factor K. Clearly the ratio between 61/6,,
and 62 /6,, is also 61/62. We utilize this invariance property of ratios to
identify possible common divisors across different conditions.

For each condition, we temporarily remove the features that
have 32 non—zero counts in all samples and select a feature with
non—zero counts in all the samples as a preliminary divisor. Note if
no such features exist, which is very rare, we can remove some sam—
ples to have such one(s). We then obtain 1f, with the preliminary div—
isor and estimate 0 using the EM algorithm. The proportion of the
false zero state 11 does not carry much information in the comparison
of abundances. Therefore, we simply use mean ,u and variance 0'2 to
measure the similarity in abundance between features using the
Bhattacharyya distance (Aherne et al., 1998) and cluster similar fea—
tures using hierarchical clustering with minimax linkage (Bien and
Tibshirani, 2011) based on the Bhattacharyya distance.

2.3.1 Bhattacharyya distance

The Bhattacharyya distance has been long used as a measure of fea—
ture selection in pattern recognition, which is defined (Kailath,
1967) as

DB (177 q) : _log(BC(p7 q))7 

where p and q are probability distributions, and BC is the
Bhattacharyya coefficient, which measures the amount of overlap
between two distributions (Reyes-Aldasoroa and Bhalerao, 2006).
For continuous probability distributions, the Bhattacharyya coeffi—
cient is defined (Kailath, 1967) as

3Com) : jvp<x>q<x>dx. <7)

ﬁm'spzumofpmJXO'sopcuuqurotq/ﬁdnq

2272

M.B.Sohn et al.

 

If p and q are normal distributions, the Bhattacharyya distance has a
closed form solution (Coleman and Andrews, 1979) given by

 

 

 

1 1 oz 02 1(11 Ml
4 4

2.3.2 Hierarchical clustering with minimax linkage
Hierarchical clustering builds a hierarchy of clusters commonly dis—
played as a tree diagram called a dendrogram, thus not requiring
any pre—specified number of clusters. Instead, the hierarchy can be
cut at a pre—specified level of similarity, commonly called height 19,
to create a set of disjoint clusters satisfying a clustering criterion. We
use the clustering criterion for the minimax linkage, where for any
point x the minimax linkage between two clusters C1 and C2 is
defined as
‘ I

d(C1, C2) : 3:611:11ng xléréajcg d(x,x ), (9)
where d is a distance function (e.g. the Bhattacharyya distance). In
words, the distance between C1 and C2 is the smallest distance to
merge the two clusters and the largest distance possible between
any point and the prototype that is the point giving the smallest
distance among the largest distances between all paired points in
C1 and C2. That is, for a given height 10, the minimax linkage as—
sures that the distance between any point and the prototype for a
cluster is £10.

Cluster analysis is performed separately for each condition and
we cut a minimax clustering of features with the Bhattacharyya dis—
tance at 10: 0.05 that corresponds to approximately 95% overlap
between two distributions. We then create a set of clustered features
common in both conditions and use its elements as possible com—
mon divisors. Let’s assume, for instance, that we had a set of
two clusters {{A, B, E}, {C, D}} for one condition and three clusters
{{A}, {B, C,D},  for another condition. We would then have a
set of possible common divisors {{A}, {B}, {C, D}, 

2.4 Identification of DAFs

To compare ratios across different conditions, the common divisor
must be a non—DAF or a group of non—DAFs. However, the identifi—
cation of non—DAFs or DAFs, which is the ultimate goal of the ana—
lysis of differential abundance, is not attainable without a priori
information or assumption. Under the assumption that majority of
features are not differentially abundant, the number of DAFs
obtained with a non—DAF or a group of non—DAFs as a common div—
isor should be the smallest. This assumption is stronger than neces—
sary in most cases as shown in the proof of Proposition
(Supplementary File).

Proposition: Under the assumption that majority of features are
not differentially abundant, the minimum number of DAFs is
achieved when a non—DAF or a group of non—DAFs is used as a com—
mon divisor.

In other words, the common divisor that gives the smallest num—
ber of DAFs is a non—DAF or a group of non—DAFS. DAFS obtained
with this common divisor are the most probable, true DAFs. To
identify this common divisor and the corresponding DAFs, we re—
peat the following steps for each possible divisor obtained in the sec—
tion 2.3:

1. Sum up the counts of features in a possible common divisor for
each sample, which will reduce variation in counts across sam—
ples since the abundance of all features in a possible common
divisor is assumed to be statistically identical.

2. Compute the ratios r;- with these sums as a common divisor.
Estimate 0 using the EM algorithm for each condition.
4. Construct a moderated t—statistics (Smyth, 2005) for the log

ratio of each feature 3),, using the estimated mean ,u and variance

OJ

0'2 and obtain P values for the null hypotheses, Ho : 111 : 112 for
all features.

5. Adjust P values using a multiple testing correction method. In
this study, we used the Benjamini—Hochberg (BH) procedure
(Benjamini and Hochberg, 1995 ).

6. Compute the number of DAFs.

In the step 2 earlier, if the sums contain zeros, we treat the zeros as
missing values since the probability of the zeros being true zeros be—
comes small when a cluster contains more than a few features,
that is, the zeros result most likely from undersampling. We estimate
the missing values using the following steps of a parametric
approach:

1. Compute the ratios of a common divisor to a feature, that has
non—zero counts in all samples. Note a common divisor is in the
numerator here.

ii. Log—transform the non—zero ratios and estimate the mean and
SD of the log—ratios.

iii. Generate random normal values with the estimated mean and
SD.

iv. Transform log—ratios to ratios.

v. Multiply the estimated ratios by the corresponding counts of
the feature.

For the temporarily removed features in the selection of possible
common divisors, which have 32 non—zero counts in all samples in a
condition, we compute their ratios using the common divisor ob—
tained by the earlier steps after splitting them into two cases: (i) at
least one non—zero in each condition and (ii) all zeros in one of con—
ditions. We then use a two—sample moderated t—test for the first
case. However, for the second case, we use a one—sample moderated
t—test to test whether a distribution of ratios contains 5. Finally, we
combine all the features and readjust P values using a multiple test—
ing correction method, BH procedure, to control the FDR. A flow
chart of RAIDA is given in Supplementary File.

3 Results

3.1 Simulation studies

To compare the performance of RAIDA to that of edgeR,
metagenomeSeq and Metastats, we used simulated data where we
can control the settings and the true differential abundance of each
feature. We simulated counts using a zero—inflated negative binomial
model:

with probability é,-

0
Q, ~ { (10)
N304,» Vi)

where we use mean 11 and size y as the parameterization of a nega—

with probability 1 — 6, I
tive binomial, such that its probability mass function is

i 7 1"(6+0 LI 14 C
PNB(C_C)_1'(V)1'(C+1) <V+H> <v+u>’ I11)

 

giving E(C) : 11 and Var(C) : 11 + yz/y.

To minimize any possible bias toward any method, we randomly
generated the mean 11 and size y parameters from wide ranges of
values partially drawn from real data (Supplementary File).
For instance, the computed range of y for non—zero counts from the

ﬁm'spzumofpmJXO'sopcuuqurotq/ﬁdnq

 

Supplementary Fig. S2

Supplementary Table S2

Figure 2

Supplementary Figures S3 S5

Figure 3

S7

Figure 2

Supplementary Figures S4 S6 S8

Figure 4

Figure 4

Table S3

Supplementary Figure S9

Supplementary

/3.IO'S[EIIm0Fp.IOJXO'SOIJEIIIJOJIIIOIq”Zduq

Su pplementa 1‘} Table S4

Qin (71111., 2012

Larsen (7/ al., 2010

Lag (7/ al., 2004
2009

Sohn (7/ al., 2014

 

Figure 5

Yuan (7/ al.,

/310'SIBanoprOJxo"sotJBuiJOJurorqﬂ:duq

RAIDA

2275

 

responsible for insulin secretion, targeted by Botox to find new meth—
ods of diagnosis and treatment for type II diabetes (http://www.hw.ac.
uk/news—events/news/botoxs—target—could—hold—cure—diabetes—12960.

htm). Raw and adjusted P values for the species whose raw P values
are <0.05 are given in Supplementary Table SS in Supplementary File.

4 Discussion

Even though the importance of microbial communities from the nat—
ural environment, industry and health has been well acknowledged,
the composition of microbial communities is still barely known.
Therefore, a method for identifying DAFs in metagenomic samples
should not depend on characteristics of microbial communities across
different conditions, such as the amount of difference in total abun—
dances of DAFs across different conditions. RAIDA has been de—
veloped to satisfy this essential criterion, specifically for the analysis of
differential abundance across different, but closely related conditions,
such as healthy and diseased, where majority of features are unlikely
differentially abundant across conditions. We have shown the consist—
ency of RAIDA on various types of samples in the simulation study.

In this study, we used the smallest non—zero ratio for the value of
e in our modified ZIL model, Equation (2). However, some other
quantities such as the smallest number in the 5th percentile can be
used in the estimation of DAFs across different conditions. As an il—
lustration, we analyzed the simulated data for the 10 and 20%
DAFs in the balanced and unbalanced conditions for the sample size
111: 15 using the smallest number in the 5th percentile for e. We
then compared results with those obtained using the smallest non—
zero ratio for 6. Both the values of 6 give almost identical results in
terms of TPR and FPR as shown in Supplementary Figure 510 in
Supplementary File.

A non—DAF can be a common divisor but will not provide reli—
able results if the non—DAF contains more than a few zeros, which is
often the case, because all the zeros will be treated as missing values
and estimated even if some zeros are truly zero. It will be similar for
a group of non—DAFs with a few members. Since we assume that the
majority of features are not differentially abundant, it is highly prob—
able that non—DAFs form one of the largest cluster. Therefore, it is
more practical to use only the clusters with larger numbers of fea—
tures as possible common divisors.

We have optimized our calculations to the analysis of differential
abundance between two conditions of samples such as healthy versus
diseased in this article. However, our method can be easily extended
to more than two conditions. Note it is just a two—sample t—test with
modified variances for two conditions. Thus, for more than two con—
ditions, the test will be just the analysis of variance with modified
variances. Nevertheless, our method may not be applicable for too
many conditions where a common divisor with more than one feature
for all conditions may not exist. Moreover, even though we have de—
veloped our method for metagenomic data, our method should be ap—
plicable to other types of count data such as RNA—seq data. However,
our method might not be appropriate for the comparison of environ—
mentally different samples (e.g. soil versus sea water, or human gut
versus soil), where the assumption that majority of features are not
differentially abundant could be violated.

Acknowledgement

The authors thank Ahmad Abdul Wahab and Sara Ziebell for helpful com-
ments on the manuscript.

Funding

This work was supported by National Science Foundation [DMS-1043080
and DMS-1222592 to LA] and partially supported by National Institutes of
Health [P30 ESOO6694 to LA] and United States Department of Agriculture
[Hatch project, ARZT-1360830-H22-138 to LA].

Conﬂict of Interest: none declared.

References

Aherne,F.]. et al. (1998) The Bhattacharyya metric as an absolute similarity
measure for frequency coded data. Kybernetilza, 34, 363—368.

Aitchison,]. (1986) The Statistical Analysis of Compositional Data. 1st edn.
Chapman and Hall, New York.

Anders,S. and Huber,W. (2010) Differential expression analysis for sequence
count data. Genome Biol., 11, R106.

Benjamini,Y. and Hochberg,Y. (1995) Controlling the false discovery rate: a
practical and powerful approach to multiple testing. ]. R. Stat. S06. B. 57,
289—300.

Bien,]. and Tibshirani,R. (2011) Hierarchical clustering with prototypes via
minimax linkage.]. Am. Stat. Assoc, 106, 1075—1084.

Byrd,R.H. et al. (1995) A limited memory algorithm for bound constrained
optimization. SIAM]. S6i. Comput., 16, 1190—1208.

Coleman,G.B. and Andrews,H.C. (1979) Image segmentation by clustering.
Proc IEEE, 67, 773—785.

Dillies,M.A. et al. (2013) A comprehensive evaluation of normalization meth-
ods for Illumina high-throughput RNA sequencing data analysis. Brief.
Bioinform., 14, 671—83.

Hughes,].B. et al. (2001) Counting the uncountable: statistical approaches to
estimating microbial diversity. Appl. Environ. Microbiol, 67, 4399—4406.
Kailath,T. (1967) The divergence and Bhattacharyya distance measures in sig-

nal selection. IEEE Trans. Commun., 15, 52—60.

Lacy,B.E. et al. (2004) The treatment of diabetic gastroparesis with botulinum
toxin injection of the pylorus. Diabetes Care, 27, 2341—2347.

Larsen,N. et al. (2010) Gut microbiota in human adults with type 2 diabetes
differs from non-diabetic adults. PLoS One, 5, e9085.

Paulson,].N. et al. (2013) Differential abundance analysis for microbial
marker—gene surveys. Nat. Methods, 10, 1200—1202.

Qin,]. et al. (2012) A metagenome—wide association study of gut microbiota in
type 2 diabetes. Nature, 490, 55—60.

Reyes—Aldasoroa,C.C. and Bhalerao,A. (2006) The Bhattacharyya space for
feature selection and its application to texture segmentation. Pattern
Recognit., 39, 812—826.

Robinson,M.D. and Oshlack,A. (2010) A scaling normalization method for
differential expression analysis of RNA-seq data. Genome Biol., 11, R25.
Robinson,M.D. et al. (2010) edgeR: a Bioconductor package for differential
expression analysis of digital gene expression data. Bioinformatics, 26,

139—140.

Schloss,P.D. and Handelsman,]. (2005) Metagenomics for studying uncultura-
ble microorganisms: cutting the Gordian knot. Genome Biol., 6, 229.

Smyth,G.K. (2005) Limma: linear models for microarray data. In:
Gentleman,R. et al. (eds.) Bioinformatics and Computational Biology
Solutions using R and Bioconductor. Springer, New York, pp. 397—420.

Sohn,M.B. et al. (2014) Accurate genome relative abundance estimation
for closely related species in a metagenomic sample. BMC Bioinformatics, 15,
242.

Thomas,T. et al. (2012) Metagenomics — a guide from sampling to data ana-
lysis. Microb. Inform. Exp, 2, 3.

Virgin,H.W. and Todd,J.A. (2011) Metagenomics and Personalized Medicine.
Cell, 147, 44—56.

White,].R. et al. (2009) Statistical methods for detecting differentially abun-
dant features in clinical metagenomic samples. PLOS Comput. Biol., 5,
e1000352.

Yuan,R.Y. et al. (2009) Botulinum toxin for diabetic neuropathic pain: A
randomized double-blind crossover trial. Neurology, 72, 1473—1478.

ﬁm'spzumol‘wqxo'sopcuuqurotq/ﬁdnq

