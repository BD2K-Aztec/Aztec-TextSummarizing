Bioinformatics, 32(11), 2016, 1601—1609

doi: 10.1093/bioinformatics/btv485

Advance Access Publication Date: 26 August 2015
Original Paper

 

 

Genome analysis

Identification of hierarchical chromatin domains

Caleb Weinreb1 and Benjamin J. Raphael1'2'*

1Center for Computational Molecular Biology and 2Department of Computer Science, Brown University,
Providence, RI 02912, USA

*To whom correspondence should be addressed.
Associate Editor: Gunnar Ratsch

Received on April 7, 2015; revised on July 25, 2015; accepted on August 10, 2015

Abstract

Motivation: The three—dimensional structure of the genome is an important regulator of many cel—
lular processes including differentiation and gene regulation. Recently, technologies such as Hi—C
that combine proximity ligation with high—throughput sequencing have revealed domains of self—
interacting chromatin, called topologically associating domains (TADs), in many organisms.
Current methods for identifying TADs using Hi—C data assume that TADs are non—overlapping, des—
pite evidence for a nested structure in which TADs and sub—TADs form a complex hierarchy.
Results: We introduce a model for decomposition of contact frequencies into a hierarchy of nested
TADs. This model is based on empirical distributions of contact frequencies within TADs, where
positions that are far apart have a greater enrichment of contacts than positions that are close to—
gether. We find that the increase in contact enrichment with distance is stronger for the inner TAD
than forthe outer TAD in a TAD/sub—TAD pair. Using this model, we develop the TADtree algorithm
for detecting hierarchies of nested TADs. TADtree compares favorably with previous methods,
finding TADs with a greater enrichment of chromatin marks such as CTCF at their boundaries.
Availability and implementation: A python implementation of TADtree is available at
http://compbio.cs.brown.edu/software/

Contact: braphael@cs.brown.edu

Supplementary information: Supplementary data are available at Bioinformatics online.

 

1 Introduction

The 3D architecture of the genome inﬂuences key cellular processes et (11,, 2009). Typically, the raw read pairs generated by a Hi—C

such as gene regulation, replication timing and differentiation experiment are assigned to bins of fixed width (e.g. 40 kb),

(Cavalli and Misteli, 2013). Chromosome conformation capture
(3C) technologies use proximity ligation of DNA to elucidate gen—
ome structure at high resolution (De Wit and de Laat, 2012).
Recently, techniques such as Hi—C that couple proximity ligation
and high—throughput sequencing have revealed megabase—sized do—
mains of self—interacting chromatin called topologically associating
domains (TADs) in both mammals and fruit ﬂies (Dixon et (11.,
2012; Hou et (11., 2012; Nora et (11., 2012; Sexton et (11., 2012).
Conserved across cell types and species, TADs may partition the
genome into functional units and help regulate the distribution of
epigenetic marks (Symmons et (11., 2014; Tanay and Cavalli, 2013).
Hi—C uses proximity—based ligation to measure the frequency of
physical interaction between pairs of genomic loci (Lieberman—Aiden

resulting in a contact matrix A, where A,-,- is the number of con—
tacts between bins i and /, normalized for experimental bias.
Several methods have been developed for the identification of
TADs from Hi—C data. These methods may be roughly classified
into two categories: (i) methods that define a one—dimensional
(1D) test statistic from the contact matrix A,-,- and (2) methods
that exploit the two—dimensional (2D) structure of the contact
matrix.

Dixon et al. (2012) compute a 1D ‘directionality index’ (DI)
from the contact matrix. This index defines whether contacts have
an upstream bias, downstream bias or no bias. Next, they use a hid—
den Markov model (HMM) to partition the genome into regions
defined by changes in the DI. Each transition into downstream bias

©The Author 2015. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com 1501

9103 ‘Og JSanV 110 salaﬁuv soc] ‘BtHJOJtIBQ 30 AJtSJQAtuf] 112 ﬁle'smumofqutxo"sothJJOJutotq/ﬁduq 11101} popcolumoq

1602

C. Weinreb and B.J.Raphael

 

marks the start of a domain and the next transition out of upstream
bias marks its end. Sauria et al. (2014) introduce a 1D statistic called
the ‘boundary index’ (BI) which captures sudden shifts in interaction
preference. Sauria et al. (2014) identify domain boundaries by call—
ing peaks in the BI, but do not explicitly pair these boundaries into
domains, leaving the domain structure ambiguous.

Recently, a number of methods have been introduced to identify
chromatin domains using the full 2D contact matrix. Filippova et al.
(2014) use dynamic programing to find domains with maximal
intra—domain contact frequency. This method includes a tunable size
parameter and outputs the set of non—overlapping domains that are
most robust to changes in the parameter value. More recently, Levy—
Leduc et al. (2014) developed a 2D model that fits a block diagonal
matrix to observed contacts using maximum likelihood. This
method is based on a generative model where the expected contact
frequency across a TAD is uniform.

All the methods above assume that TADs are non—overlapping.
However, several studies have observed a hierarchical chromatin
organization including both TADs and sub—TADs within them
(Fig. 1). Although TADs are conserved across cell types, sub—TADs
are thought to vary between cell types and may facilitate changes
in gene regulation during differentiation (Phillips—Cremins et (11.,
2013) and development (Berlivet et (11., 2013). In addition, distinct
combinations of proteins such as CTCF, Mediator and Cohesin
may demarcate TAD and sub—TAD boundaries (Phillips—Cremins
et (11., 2013; Zuin et (11., 2014). The distinct properties of TADs
and sub—TADs highlight the need for methods that can detect both
simultaneously. A very recent development in this direction is the
‘Arrowhead’ algorithm (Rao et (11., 2014). Although this algorithm
can identify overlapping domains, it does not explicitly require
that overlapping domains be nested, and it is at present not pub—
licly available.

In this article, we introduce the TADtree algorithm, which de—
tects nested hierarchies of TADs. In contrast to previously published
methods that rely on ad [706 assumptions about the structure of
TADs, we derive a straightforward model for the frequency of con—
tacts within TADs. Our model is based on the empirical observation
that within TADs, the enrichment of contacts over background
grows linearly with the distance between bins, but at a rate that de—
pends on the TAD length. Thus, every TAD can be characterized by
two parameters: If, the baseline enrichment for contacts between ad—
jacent bins within the TAD and 5, the rate at which contact fre—
quency increases with distance between bins. Using reported TADs

from previous studies, we derive relationships between the values of
l)’ and 5 when one TAD is nested inside another. From these observa—
tions, we propose a model for TAD hierarchies.

We combine our model for contact enrichment within TADs
with a 1D BI similar to the one used by Sauria et al. (2014). We for—
mulate and optimize an objective function that scores a hierarchy of
nested TAD trees according to both the fit to the observed contact
matrix and the BI of each TAD and sub—TAD in the hierarchy. We
demonstrate that our resulting TADtree algorithm outperforms
existing methods on real data, predicting TADs that have greater en—
richment for binding of factors known to delineate chromatin 0r—
ganization, and showing greater overlap with high—resolution data.

2 Methods
2.1 Model

Background contact frequencies

Consider a chromosome of length ] (in bins) and a ] >< ] symmetric
matrix A, where A,-,- is the frequency of contact between bins i and /.
Typically, A,-,- represents a normalized count of paired sequencing
reads, where each read represents a ligation event between DNA
fragments derived from bins i and /, respectively. Based on A, we
form a ‘background’ function B giving the mean contact frequency
for bins at each distance d. Formally,

1 I‘d
B(d) :F—dZAmd. (1)

1:1

Modeling TADs

A TAD, D, is modeled by the quadruple D : (LD,RD, 5D, ﬁD), spe—
cifying an interval [LD, RD] of bins and two parameters 5D and lb,
which determine the expected contact frequency at each intra—TAD
bin pair, as follows:

ADM/e) : ((k — MD + ﬁD)B(k — l) for La :1: k: RD. (2)

AD expresses the expected enrichment of contacts over background
235%) as a linear function of the distance ([2 — I), having slope 5D and

intercept lip.

 

This model is motivated by the observed properties of TADs
identified by Dixon et al. (2012). We grouped TADs with similar
sizes and computed the enrichment of contacts over background for

 

 

Fig. 1. Illustration of hierarchical TAD structure. A Hi-C contact map is shown on the left, with a close-up of the diagonal top-right. TADs and sub-TADs are anno-

tated as triangles. The corresponding DNA structure is illustrated below

9103 ‘Og JSanV uo seleﬁuv soc] ‘BtHJOJtIBQ JO AJtSJQAtuf] 112 ﬁle'smumofqutxo"sothJJOJutotq/ﬁduq 11101} popcolumoq

Hierarchical chromatin domains

1603

 

bin pairs in each group. We observed that across many TAD groups,
contact enrichment increases linearly with distance (Fig. 2A), with
slope dependent on the size of the TAD. Although small deviations
from linearity are observed for pairs of bins near TAD boundaries
(Fig. 2B), a linear model is favored for the sake of simplicity.
Because contact enrichment increases with distance, we require
5D > 0. The positive correlation between contact enrichment and
distance may arise from looping interactions between TAD bounda—
ries, or because local interactions due to sequence proximity pro—
duce most of the contacts between closely spaced bins, drowning

out the contacts that arise from the higher order structure imposed
by TADs.

Modeling sub-TADs

Consider two TADs, D : (LD,RD,5D,/)’D) and D’ : (LDI,RDI,
5DI,/)’DI), such that D’ lies within D (i.e. LD§LDI < Rnlan).
Because D’ represents a proper subset of the bins in D, the param—
eters 5D, [in may differ from 5D, ﬁD. We investigated this difference
systematically using pairs of TADs from Filippova et al. (2014) and
Dixon et al. (2012) where a TAD from one dataset was contained
by a TAD from the other dataset. We find that enrichment over

    

    

    

A Emma] B 3-0_—1\Ds from-(Dixon,2012)- — random1irétaw:s
— . m
BU: — I) e mkb 1.2mb
.. £ 25
“>’ i“
o :s
E 75 2.0
E 9 1.5
1: Q |:
0)
I k E 10 B
lOW — high —0 40° 500 1200 1:300
distance between bins (kb)
6 True "551w Pairs Random nested pairs E _ outer TADS
0'4 I I I I I — inner TADs
0'3 . I a 4 .
:0 Fe - - ' 51,
0.2 E 2 I .- . _ . EE 3
me a hey/“g?
‘- h It. . ' 0 GI 2
0.0 2 . g - ' E1:
.5 .s " ‘ " . a
-o.1 . ‘ ' o ' 4o'o ' abo
_//  . . - distance between bins (kb)
‘02. . ' outer delta: 6 F — __
D -o.1 0.0 9.1
3.0
En. El; -
iii a; __ ,6  _
2.0 o- u:
E 3 5'3 4
a as ‘E 2 a
1.0 g E E g! 2
/ $3
outer beta: is / outer beta: 6 E 1

010.0 1.0 2.0 3.0 0.0 1.0 2.0 3.0 diS‘anoe hem-Gen Bins

Fig. 2. TADs from a previous study (Dixon er al., 2012) were each rescaled to
match the closest of four sizes (400 kb, 800 kb, 1.2 Mb, 1.6 Mb) using bilinear
interpolation. (A) The superposition of all TADs in the 1.2 Mb size class shows
that contact enrichment increases with increasing distance between bins. (B)
For each size class, the average enrichment of intra-TAD contacts increases
linearly with distance. This linear function has slope 6 and intercept {3.
Average enrichment for a set of random intervals is shown in red for compari-
son. Next, combining TADs from Filippova er al. (2014) and Dixon er al. (2012)
revealed 114 nested pairs D’ C D, where D’ had length 400—600 kb and D had
length 800 kb to 1.2 Mb. (C) Nearly all nested pairs (black dots) had 6’ 26 (left),
while this relationship was not true for nested pairs with randomized pos-
itions (right). (D) No similar inequality holds for values of {3, although if and ii”
are strongly correlated for both real and randomized nested pairs. (E)
Rescaling nested TADs so that D’ was 500 kb and D was 1Mb shows that
average contact enrichment for D’ (green) and D (black) follows the linear
model [Equation (2)] with 6’ > 6 and ti” : if. (F) Examples of nested pair
(above) with contact enrichment plotted against distance (below)

background (38351)) rises with distance at a higher rate for inner

TADs than for their respective outer TADs, that is 5D: > 5D
(P < 10—29; Fig. 2C). This inequality is not just a consequence of
TAD size, because it does not hold for nested pairs with randomized

 

positions (P: 0.3). In contrast, the values ﬁn and [in for the outer
and inner TADs show no systematic difference, but are strongly cor—
related (r : 0.88,P < 10‘”; Fig. 2D).

Based on these observations, we define D’ to be a sub-TAD of D
provided

1. LD SLDI < RD! SRD  D’ C 

2. 5D! > 5D.

Thus, sub—TADs are defined as local regions within a larger TAD
that have a different distribution of contacts, characterized by higher
rate of increase in contact frequency with distance (Fig. 3A). In the
same way that a single TAD D specifies an expected contact
frequency function AD, a TAD/sub—TAD pair T : {D,D’} has an
expected frequency function AT, defined below. For convenience,
we write (I, k) E D when LBS] < kSRD.

Aum{&mt)ﬁmneo (a
T’ _ ADM) if(l,k)eD\D’

Note that AT is defined for all bin pairs (Lie) 6 D, because D is the
union of the domains of AD and AD, respectively. AT is identical to
AD outside the sub—region defined by D’, where it becomes identical
to AD. This definition reﬂects the role of sub—TADs in capturing
local regions within an existing TAD that have a distinct distribution
of contacts, characterized by higher 5.

Generalizing the TAD/sub—TAD arrangement shown in
Figure 3A, we allow a single TAD to have multiple sub—TADs, and
also allow sub—TADs to have their own sub—TADs. Formally, define
a TAD tree T to be a rooted hierarchy of TADs, such that for each
D,D’ E T where D’ C D, (SD: > 5D. A collection of disjoint TAD
trees is called a TAD forest (Fig. 3B). Each TAD forest F specifies a
map AF of expected contact frequencies. Because sub—TADs model
the local distribution of contacts, which differs from that of the
enclosing TAD, the expected contact frequency for each pair of bins
in a TAD forest F is modeled using the minimal TAD D E F that
contains them both or by background if there is no such TAD.

      

 

distance between bins
— cuterTAD —- inner TAD

B F={T,.T,.T,}
T; T: T3
C
'32
E; i are) j
5% . ./ \
DF[ 5  ‘ 51'1"}! £::(S,J:D)
i.

30") = 5(0) + £0") - £c(i’.i’.D)

Fig. 3. (A) When one TAD lies inside another, the enrichment of contacts in-
creases at a faster rate for the inner TAD (green line) than for the outer TAD
(black line), that is 63: > 63. (B) Example of a TAD forest containing TAD trees
T1, T2 and T3. (C) The squared error 8(T) for a TAD tree Twith root D and
sub-tree T’ is obtained as 8(T) :8(D)+8(T’) 785, where 85 is an ‘error
compensation' term that corrects double counting of the squared error over
bin pairs in T’

9103 ‘01; JSanV uo sejeﬁuv soc] ‘Bnuomcg JO AJtSJQAtuf] 112 /310'S[BIIJHO[pJOJXO'SOIJ’BLUJOJIIIOICI”Idllq 11101} pQPBOIII/lAOG

1604

C. Weinreb and B.J.Raphael

 

Formally, let minp(l, [2) denote the minimal D E F such that
(l, k) E D, where minp(l, k) : 0 if there is no such D. Then

- {ADM k) if minp(l, k) 2 D (4)

A 1,]: z
A ) B(k—l) ifminp(l,k):0.

Boundary index

So far we have described a model for the distribution of contacts
within TADs, requiring that intra—TAD contact frequencies are en—
riched over background, especially for bins that are far apart.
Another important feature of TADs is that their boundaries mark
a shift in interaction preference. Dixon et al. (2012) use this fea—
ture as the basis for an HMM that predicts TADs by detecting
shifts from upstream to downstream preference. Here, we define a
1D test statistic called the BI that measures local shifts in inter—
action preference. Note that Sauria et al. (2014) recently posted a
preprint that also uses the term BI for their 1D statistic, which has
a more complicated form. For constants p, q representing the scale
and persistence of interaction shift, we define the BI BM as
follows:

Hg 12

EMU) = Z (2AM — Al,i—kl- (5)

I:i—q k:1

The BI measures the shift in contacts around an interval i.
Specifically, in an interval of length p containing i, the BI BM totals
the differences in contact frequencies up to q bins upstream and
downstream of i. Let EMU) :: (EMU) — mean(Bp,q))/var(l§pﬁq) be
the Z—score of BM, where mean and variance are taken over all bins
on the given chromosome. We define EM for a TAD forest as
follows:

EM 2 23174100) +Epa(RD)- (6)
D61”
Because the end points of TADs should have high BI, we say that
D has valid boundaries if DEALD) > 0 and DWARD) > 0.

2.2 Fitting TAD trees to data

Given a matrix A of observed contacts, we aim to find a TAD forest
F that best fits the data. Specifically, we want a TAD forest F that
has high BI and minimizes the error between A and the expected
contact frequency function AF. We measure the latter using the sum
squared error,

500 2 2011101,?) - A102 (7)

1,}:

Finally, we require that F has valid boundaries in order to exclude
false—positive TAD calls in regions of the genome that have high con—
tact frequencies but low BI. We combine these criteria into the fol—
lowing optimization problem.

PROBLEM 1: Given N E N and y 6 RT, find a TAD forest F, with
[F[ : N and each D E F having valid boundaries, that maximizes the
objective function 0.,(F) : yDM(F) — 

Here, N and y are user—defined parameters controlling the num—
ber of TADs and the balance between 5 and EM, respectively.

We now define a recursive algorithm that solves Problem 1.
First, we note that any TAD forest can be decomposed into a set
of non—overlapping TAD trees. Thus, we will first show how to
find TAD trees that locally maximize the objective 0?. To

that end, we define an objective function <I>(i,/',N, 5) over inter—
vals [i, j].

DEFINITION 1: Given the interval [i,/'] and parameters N E N and
5 6 RT, let <I>(i,/',N, 5) 2: max 0.,(T) over all TAD trees Tsuch that
(i) Tis rooted at the interval [i,/']; (ii) Tcontains N TADs  : N);
(iii) each D E T satisfies (SD > 5 and (iv) each D E T has valid
boundaries.

We will compute <I>(i,/',N,5) by dynamic programing. At each
step, beginning with the interval [i , i], we must make optimal choices
of the following.

1. Parameters 5D, [in deﬁning the root TAD D : (i,/', 5D, dB).

2. A collection of non—overlapping sub—intervals [in [X] which deﬁne
the locations of the top—level sub—trees in T.

3. For each interval [in [X], a ‘multiplicity’ nx representing the total
number of TADs in that sub—tree. Note that in order for T to
have N TADs, the multiplicities nx must satisfy 2 nx : N — 1.

To implement the steps above, one must be able to compute the
optimal score for a TAD tree having the specified root and first—
level sub—trees. Recall that 0.,(T) : yEM(T) — £(T), where 5 is
the sum squared error defined in Equation (7). Suppose T is a
TAD tree consisting of a root TAD D and a single sub—tree T’.
From Equation (6), we have FEAT) : DEAD) +EM(T’).
However, £(T) 5E £(D) + £(T’), because pairs of bins within the
sub—tree T’ contribute to both £(T’) and £(D), and are double
counted when these terms are summed. Because the expected
contact frequency for a pair of bins is modeled using the smallest
TAD that contains them both [Equation (4)], we retain the con—
tribution to squared error made by the sub—tree T’, and subtract
the contribution to squared error from the root TAD D (Fig.
3C). Thus, if T’ spans the interval [i’,/"], then £(T) :
£(D) + £(T’) — £c(i’,/’,D), where £c(i’,/", D) is the error compen-
sation term defined below.

DEFINITION 2: Consider a TAD D and interval [i,/'] 2 [DL, DR]. Let
the error compensation £c(i,/', D) be
i 1' ~ 2
ace/3D) : XXX/tame) —Alk)- (8)

:i k:l

Using the error compensation, we derive an expression for the score
of a TAD tree in terms of its root TAD and sub—trees.

PROPOSITION 1: Let T be a TAD tree consisting of a root TAD D
and a collection of non-overlapping sub-trees T1, ..., Tm,

spanning the intervals [i1,/'1],...,[im,/'m]. The score 0.,(T) can be
decomposed as
ONT) 2 04D) + EKG/(TX) + scam/MD». (9)
95:1

We now describe Steps (1—3) above in greater detail. To perform
step (1), recall that a TAD is defined by four parameters
(LD,RD, 5D,/)’D). Thus, in choosing the root TAD D, two param—
eters are given ahead of time ([LD,RD] : [i,/']), meaning we only
need to select optimal values for 5D and [313. Next, for a given choice
of 5D and [313, we must choose a set of non—overlapping sub—trees,
defined by sub—intervals [in [X] and multiplicities nx (steps 2—3). To
that end, let I(i,/', N) be the collection of sets {(ix,/'x,nx)} that
satisfy the following properties: (i) [ix,/'x] are non—overlapping
sub—intervals of [i,/']; (ii) 2%, : N — 1 and (iii) ix and [x are valid

9103 ‘01; JSanV uO sejeﬁuv soc] ‘BIIIJOJIIBD JO AJISJQAqu] 112 /310'SIBanOprOJx0"sonuIJOJuIOIq/ﬁduq 11101} pQPBOIII/lAOG

Hierarchical chromatin domains

1605

 

boundaries. Using I(i, j, N) as a search space, we evaluate
(I>(i,j, N, 5) as follows.

PROPOSITION 2: For each interval [i, j] and positive integer N,

(I) i, ',N,5 : max 0. D + max Wx
( ’ ) {<rn.6n)6n>a}( ’( ) (ix.ix.nx)}ez<i.i.N)<zx: 

whereWx : (Dam/ImnxaaD) + £C(ix1/X7D)'
(10)

To our knowledge, there is no efficient algorithm for evaluating
Equation (10). To see why, note that Wx depends on both (ix,jx,nx)
and (13,3, 5D), meaning the two maximizations cannot be performed in—
dependently. To perform the maximizations jointly, we could proceed
in two directions. On the one hand, we could enumerate interval sets
from the collection I (i, j, N ) and optimize (lib, 5D) for each. This is
not practical, however, because I (i, j, N) is very large: ([I(i,j,N ~
0((j — i)N). Going in the other direction, we could discretize the space
R X RT and test a finite set of pairs (5D, ﬁD), optimizing the interval
set {(ix, jx, nx)} for each. This method has the advantage that the opti—
mization over interval sets can be performed efficiently using a version
of weighted interval scheduling (described below). However, there
would still be a very large set of (5D, ﬁD) pairs to check, making
this approach impractical as well. Therefore, instead of evaluating
<I>(i, j, N, 5) exactly, we approximate it, using pre—computed values for
(5D, ﬁD) rather than true argmax. The pre—computed values are chosen
to be optimal in the trivial case where D has no sub—TADs.

DEFINITION 3: For each interval [i, j], let

(fut/150,1»: argmin aux/M». (11>
(ﬂ,5)ElK><lK+

We define a TAD D to be locally fitted if 5D : 5(LD, RD) and
[3D : [3(LD,RD). Thus, D is locally fitted if its parameters are opti—
mal in the case where D has no sub—TADs. We use D,,- to denote the
unique locally fitted TAD spanning [i,j]. Using 5(i,j) and [3(i,j) as
pre—computed TAD parameters is convenient because they are easily
found by linear regression. By restricting to locally fitted TADs, we
obtain a simpler optimization problem which admits an efficient
algorithm.

PROELEM 2: Given N E N and y 6 RT, find the TAD forest F that
maximizes the objective 0.,(F) : yBM(F) — £(F) such that  : N,
and each D E F is locally fitted and has valid boundaries.

Once again, our first step in solving Problem 2 will be to find op—
timal TAD trees over every interval.

DEFINITION 4: Given N E N and the interval [i, j], define <I>(i, j, N) 2:
max 0.,(T) over all TAD trees Tsuch that (i) T is rooted at the interval
[i,j], (ii) Tcontains N TADs  : N) and (iii) each D E T is locally
fitted has valid boundaries.

In contrast to <I>(i,j, N, 5), <I>(i,j, N) does not take 5 as an argu—
ment, because it maximizes over TAD trees whose 5 values are fixed
by the requirement that they be locally fitted. This leads to the fol—
lowing proposition, which shows how to evaluate <I>(i, j, N

PROPOSITION 3: For each interval [i, j] and positive integer N,

ct: i,'.N :0. 13; + m" W" 12
(I ) ;( I) {(,-x,,-x,n,)}ez(i.i.N) > ( >

where

W {cam/m)wean/mm) imam/.1250,»

—oo otherwise.

2.3 Algorithm

To evaluate Equation (12), we must choose a set of non—overlapping
intervals [ix,jx] and multiplicities nx that maximize 2x Wx and satisfy
2 nx : N — 1. Similarly, to assemble a TAD forest from TAD trees,
we will likewise be choosing a non—overlapping set of intervals (leaves
of TAD trees) with multiplicities (number of TADs in each tree) such
that the sum of their scores is maximized and the multiplicities sum to
a predefined N. These tasks are both similar to the weighed interval
scheduling problem (Kleinberg and Tardos, 2005), which asks for the
highest weight set of non—overlapping intervals from a given collec—
tion. However, the two tasks described above have the added require—
ment that the interval multiplicities sum to a predefined value.
Therefore we define a variant of weighted interval scheduling called
weighted interval scheduling with multiplicities (WISM).

DEFINITION 5: WISM: Let {[imja] [ u E A} be a set of intervals with
multiplicities leg, and weights wa. For a given integer N, the WISMN
problem asks for the subset B Q A that maximizes ZaEBwa subject
to the following constrains: (i) the intervals {[ia, jg] [ u E B} are non-
overlapping and (ii) 2063/20, : N.

We solve the WISM problem using a dynamic programing ap—
proach based on the following recurrence.

PROPOSITION 4: Let N be an integer and let {[imja] [ u E A} be a set
ofintervals with multiplicities leg, and weights wa. Let WISMN(n) be
the score of the solution to the WISMN problem, restricted to inter-
vals that end before n. When n < mine, ia, then clearly
WISMN(n) : 0. In all other cases

maid/aw} (Wm + WISan—Ia) (ial)

WISM : 13
NM) maxl WISMN(n—1). ( ’

TADtree algorithm

We now outline an algorithm for solving Problem 2, which we call
TADtree. (Fig. 4) Consider a chromosome with a ] >< ] contact matrix
A. Let N be the number of TADs in the desired TAD forest. To con—
strain runtime, we limit the maximum TAD size to S and the number

TAD paramters Dynamic program

 

 

Enrichment over background

    

 

TAD scores

 

Optimal TAD-trees

 

 

 

 

Optimal TAD-forest

 

Absolute contact matrix

Boundary Index

Fig. 4. Overview of TADtree algorithm. (A) Beginning with contact matrix A,
we compute the fold-enrichment over background for each pair of positions.
(B) For each interval [i,j], we estimate parameters 3(i,j),ii’(i,j). (C) Next, for
each genomic position iwe compute the BI, a 1D statistic that looks for local
shifts in interaction frequency at TAD boundaries. (D) Finally, a dynamic pro-
gram finds TAD trees that maximize the BI and best fit the contact matrix A,
then selects an optimal set of TAD trees to form a TAD forest

9103 ‘01; JSanV uO se1e§uv soc] ‘BIIIJOJIIBD JO AJISJQAqu] 112 /310's112u1n0[p101x0"SOIJBuIJOJutOIq/jzduq 11101} pep1201um0q

1606

C. Weinreb and B.J.Raphael

 

of TADs in each tree to M. The TADtree algorithm contains WISM as
a subroutine, for which we do not provide pseudocode. The runtime of
TADtree is OUN2 + ]S3M2 + ]S5 Beyond the contact matrix A,
TADtree accepts six user—defined parameters: N ,M,S,y,p and q. We
do not provide a rigorous procedure for setting these parameters, but
have detailed the rationale for our choices in Section 3.

 

Algorithm 1: TADtree(A,N,M,S,y,p,q)

 

Input : Matrix A of length ] and parameters N, M, S, y, p, q.
Output: TAD forest F representing solution to Problem 2.

T :  // list of optimal TAD trees
for i E {1,  — 1} do
for j E {i, ...,i+ S} do
compute 3(i, j) and [3(i,j) by linear regression
if EMU) > o, EMU) > o and 30', j) > 0 then
Pop/.1) e 0103..)
S :  // list of sub—trees
for i’ E {i, ...,j — 1} do
for j’ E {i’ + 1, do
if BMU’) > 0, BMU’) > 0 and
3(1', j’) > 30', j) then
for m’ E {1,...,M — 1} do
w <— <I>(i’,j’,m’) + £c(i’,j’,D,-,-)
S <— append (i’,j’,m’,W)
for m E {2,  do
ci>(i,/, m) <— WISM(m,S)
T <—append (i,j,m,(I>(i,j,
return WISM(N,T)

 

 

Algorithm 2: WISM(n, J)

 

Input : n E N and list J containing tuples (i,j,m,W) repre—
senting intervals [i,j] with multiplicity m and weight
W. Assume that J is ordered by the right end points
of its constituent intervals.

Output: Highest weight subset of J with non—overlapping
intervals whose multiplicities sum to n.

 

3 Results

We used TADtree to analyze Hi—C data from Dixon et al. (2012) for
mouse embryonic stem cells, which had been binned at 40 kb and nor—
malized for sequencing bias using the method from Yaffe and Tanay
(2011). This dataset included a matrix of contact frequencies for each
chromosome (available at http://yuelab.org/hi—c/download.html).

3.1 TADtree parameters

For each contact matrix A, we ran TADtree (Algorithm 1) with the
following parameters. We set the maximum TAD size to be 2Mb
(S250 bins), because TADs were originally defined at a scale of
1Mb. We note that chromatin ‘megadomains’ larger than 2Mb
have been observed (Lieberman—Aiden et al., 2009), but the current
focus is on TADs. In theory, it is desirable to use a large value of S in
order to avoid biasing the solution by prior assumptions on TAD
size. However, in practice, the O(S5) runtime of TADtree makes
large values of S impractical.

We allowed at most M: 10 TADs per TAD tree. We find that
TAD trees almost never attain this limit for the number of TADs
(data not shown), implying that our choice for M did not limit the
complexity of our output. We hypothesize that setting M : 10
allows our algorithm to detect the full complexity of TAD structure
in the underlying Hi—C data used in this study, although higher reso—
lution Hi—C data may warrant larger values of M.

For the remaining parameters, we used the following values:
y:500, p23 (120kb) and q: 12 (480kb). These values were
chosen based on visual inspection of output for small subsets of the
full Hi—C contact maps. Although we do not have a rigorous proced—
ure for choosing values of p and q, we observed that larger values of
p and q make the BI insensitive to small—scale boundaries, while
smaller values result in the algorithm outputting many TADs and
sub—TADs, many of which are likely noise.

We varied the total number N of TADs to examine the tradeoffs
in sensitivity and specificity (see below). Because TADtree runs inde—
pendently on each chromosome, we chose N for each chromosome
such that the number of TADs per megabase was consistent, using a
range of densities (0 TADs/Mb, up to 6 TADs/Mb) across the differ—
ent runs. For large values of N, we observed some duplicate TAD
calls defined as pairs of TADs whose boundaries are both within
1 bin (40kb) of each other (Fig. 5A). We filtered these duplicates by
removing the inner TAD from each pair. Because of the dynamic
programing approach used in TADtree, computing the optimal
TAD forest for a given value N: No also entails computing optimal
TAD forests for all N < No. Thus our implementation of TADtree
outputs a duplicate—filtered set of TADs (as well as the percentage of
duplicates in the unfiltered set) across a user—specified range of val—
ues of N. Because a high percentage of duplicates suggests that
TADtree is saturating the space of TAD forests, users can examine
this percentage—0r other relevant data—t0 choose a final value of
N for downstream analysis.

3.2 TAD nesting

We found that the TADs returned by TADtree show extensive nest—
ing. We define the order of a TAD as the number of TADs that con—
tain it: TADs with no sub—TADs are order 0, sub—TADs have order
1, sub—sub—TADs have order 2 and so on. When we run TADtree
with N : 2200 TADs, which is the number identified by Dixon et al.
(2012), we find that 13% have order greater than 0. When we allow
5200 TADs, which is close to the number identified by Filippova et
al. (2014), 45% have order greater than 0 (Fig. 5B). Although TADs
of high order (up to 4) are observed, they are relatively rare. For ex—
ample, with 5200 TADs, 10% have order 22 and only 1.4% have
order 23. As expected, TADs of increasing order have decreasing
size (Fig. 5 C) and decreasing genomic coverage (Fig. 5D).

3.3 Comparison with previous studies

We compared the TADs from TADtree with those found in two pre—
vious studies (Dixon et al., 2012; Filippova et al., 2014) that ana—
lyzed the same contact matrices. To compare TADs from different
approaches, we compared the partitions of bins determined by TAD
end points using the variation of information (VI) measure (Meila,
2003). The VI is a distance measure for set partitions, and thus
lower values of VI mean that two partitions of bins into TADs are
more similar. We find that the VI between TADtree TADs with
N:2200 and TADs from Dixon et al. (2012) was 0.82, compared
to 1.72 when the positions of our TADs were randomly shufﬂed.
Similarly, we find that VI:0.99 between TADtree TADs with
N25200 and those reported in Filippova et al. (2014), compared

9103 ‘01; JSanV 110 se1e§uv soc] ‘BIIIJOJIIBD JO AJISJQAqu] 112 /310's112u1n0[p101x0"SOIJBuIJOJutOIq/jzduq 11101} pep1201um0q

Hierarchical chromatin domains

1607

 

     

 

 

 

 

 

 

 

 

 

 

._ B 0 C an D 1 o E 1 u d________
A <1.) a c
S E 2500 . 0" g
0' 0.8 .3
'E 5 A 1.5 a, E
2, g 2000 1,. .o g a .15
8 "5 g 5 0'6 F 0.0 0.5 1.0
'5 ,,, 1500 $3 1.0 5 1.0 -
,_ o '0 ° 04 5
O < = .9 ._
._ 1— 1000 g , i E 1. I!
g B '— 0'5 I 5 3 02 E r——-~..
:E, 5 500 2,. a El , g . 05
E E . _ $ 2“ '
3 o o - o_o 3a 0.0 0.5 1.0
0 4000 8000 E o 2500 5000 0° 10 2° 3° 0 2500 5000 ___Flefﬂ _
number of TADs (total) number of TADs 5200 TADs number of TADs I 3_o H3K4m§i
G. .(Dixon, 2012) . (Filippova, 2014) —TADtree H 1 7 a. 2-5
l 2 e ' ,
- E16 gs 2-°_.._...__..
Dixon et al. megabase C ~_ g 13 Pol"
H .9 I g D
_ E 1'5 éE 1.4
_ I...; _ _ __ :é a g I
5 1.4 g5 1.0 _ _ _e
3 E ”’ CTCF
g 1.3 $5 3.3 W‘-
E 3 2.9
B 12 - - - - - -
'0 2000 4000 6000 2'5 5 5 .
number Of TADS number of TADs

Fig. 5. (A) Total number of unique TAD output by TADtree (solid green curve) as a function of the value of N, the desired number of TADs. Dotted line is equality.
(B) Number of TADs of each order as a function of total number of TADs. As the total number of TADs increases, the number of zero-order TADs (indicating new
positions not covered by TADs) start to plateau and high order TADs appear. (C) Higher order TADs have smaller sizes and (D) lower coverage of the genome,
consistent with their nesting inside larger TADs. (E, F) Precision-recall curves comparing TADs found by TADtree with those reported in Dixon et al. (2012). (G)
Example of TADs from TADtree (bottom) and two previous studies (Dixon et al., 2012; Filippova et al., 2014). (H) TADs found by TADtree (black line) are more
similar (lower VI) to those found in a recent analysis of higher resolution Hi-C data (Rao et al., 2014), compared with TADs reported in Dixon et al. (2012) (blue
square) and Filippova et al. (2014) (red disk). (I) Number of ChlP-seq peaks for CTCF, Polll and the histone modification H3K4me3 within 50 kb of TAD boundary
(y—axis) versus total number of TADs (X—axis) for TADtree TADs (black line), Dixon et al. (2012) (blue square) and Filippova et al. (2014) (red disk). TADtree shows

greater enrichment for all four chromatin marks

with 1.73 when our TADs were shufﬂed. Interestingly, the VI: 1.2
is much higher between Dixon et al. (2012) TADs and Filippova
et al. (2014) TADs. This higher VI is likely a consequence of differ—
ing size preference. The method used by Dixon et al. (2012) tends to
favor large TADs, while the approach used by Filippova et al.
(2014) tends to favor small TADs. The greater similarity between
our TADs and those from both Dixon et al. (2012) and Filippova et
al. (2014) highlights the ability of TADtree to robustly identify
TADs across a range of scales.

As an additional comparison between TADs from Dixon et al.
(2012) and TADtree, we computed precision—recall curves, treating
the Dixon et al. (2012) TADs as the true set. We performed the com—
parison in two ways: first counting bins inside TADs as true posi—
tives (Fig. 5E) and then counting the positions of TAD boundaries
(Fig. 5F), where boundaries within one bin (40kb) of each other
were considered to match. TADtree obtained a recall of 89% at a
precision of 95% in determining which bins were inside TADs, and
a recall of 85% at a precision of 41% in determining TAD bounda—
ries. Note that a low precision in the later comparison is expected
since a large fraction of TAD boundaries predicted by TADtree be—
long to sub—TADs, and therefore lie between the boundaries of
TADs called by Dixon et al. (2012).

As an independent measure of the quality of TADs output by the
three approaches, we compared them to the TADs identified by Rao
et al. (2014) in higher resolution Hi—C data. Specifically, Rao et al.
(2014) generated Hi—C maps for mouse lymphoblasts at 5 kb reso—
lution. Because this increased resolution allows significantly more
data for estimating TADs, the TADs from these data are a useful
benchmark for evaluating the accuracy of TAD calls based on the
lower resolution (40 kb) contact maps used here. Fixing the number
of TAD output by TADtree to the same as the other approaches, we
find that the TADtree TADs are more similar to the TADs in the

higher resolution (Rao et al., 2014) data than those from the other
methods. The difference is relatively small in comparison with
Dixon et al. (2012): VI: 1.24 for TADtree versus 1.27 for Dixon et
al. (2012), and not statistically significant (P : 0.3) using a paired t—
test that compares the values across individual chromosomes. A
larger difference was observed in comparison with Filippova et al.
(2014): VI: 1.28 for TADtree versus 1.54 for Filippova et al.
(2014) (P < 10‘6). Interestingly, we also observe that the lowest VI
occurs when TADtree is run with N: 2600 TADs, a number in be—
tween the number of TADs in Dixon et al. (2012) and Filippova et
al. (2014) (Fig. 5H).

3.4 Enrichment of chromatin marks

As another measure of the quality of TADs produced by each algo—
rithm, we examined the enrichment of Chip—Seq derived binding
sites of several proteins and chromatin marks that were shown by
Dixon et al. (2012) to cluster at domain boundaries. Specifically, we
examined binding sites of the transcription factor CTCF, an insula—
tor protein that has been shown experimentally to contribute to
TAD boundary formation (Zuin et al., 2014). We also examined the
presence of PolII sites, as well as H3K4me3 marks—a transcription—
associated chromatin mark—because TAD boundaries are fre—
quently gene dense sites of active transcription (Hou et al., 2012)
and have been shown to be enriched for housekeeping genes (Dixon
et al., 2012). These marks were also used by Filippova et al. (2014)
to validate their TAD predictions. We downloaded ChIP—Seq data
for mES cells from ENCODE (GEO accession ID GSE29184). Peak
calling for these data was performed in their initial publication
(Shen et al., 2012). For each dataset, we counted the average num—
ber of ChIP—Seq peaks within 50 kb of a TAD boundary. Below, we
present summary statistics for the whole genome, but compute P

9103 ‘01; JSanV 110 se1e§uv 50’] 0211110111123 JO AJISJQAIIIQ 112 /310's112umofp101x0"SOIJBuIJOJuIOIq/jzduq 11101} pep1201um0q

1608

C. Weinreb and B.J.Raphael

 

values using a paired t—test that compares the values across each
chromosome. We found that TADs from TADtree show a signifi—
cantly greater enrichment for all four ChIP—Seq signals than TADs
from previous studies. For PolII and H3K4me3, our TADs have at
least 14% more ChIP—seq peaks within 50 kb of a TAD boundary
than the TADs from Dixon et al. (2012) and Filippova et al. (2014)
when controlling for number of TADs (Fig. SI) (P< 0.005 for 4/4
comparisons). Although our TAD boundaries show a similar enrich—
ment of CTCF as those from Dixon et al. (2012), they have a 30%
greater enrichment compared with TADs from Filippova et al.
(2014) (P < 10‘6). Enrichment of these marks decreases as we in—
crease the total number of TADs, indicating a tradeoff between sen—
sitivity and specificity. However, the robust improvement compared
with previous methods over a large range of TAD numbers demon—
strates the advantages of the hierarchical decomposition performed
by TADtree.

4 Discussion

Hi—C and other approaches that combine high—throughput sequenc—
ing with 3C are becoming widely used to probe the 3D organization
of the genome. There is increasing evidence that sub—TAD structure
varies between cell types and contributes to changes in gene regula—
tion during differentiation and development (Berlivet et al., 2013;
Phillips—Cremins et al., 2013). TADtree is the first publicly available
algorithm that detects nested hierarchies of TADs in Hi—C data.
Thus, TADtree will enable further research into the organization of
TADs and sub—TADs.

TADtree employs a straightforward linear model of contact en—
richment that is derived from earlier annotations of TADs. TADtree
finds the best TAD hierarchy via a dynamic programing algorithm,
using an approximation of this model. We demonstrate that
TADtree outperforms earlier methods on real Hi—C data. In particu—
lar, we show that TADs determined by TADtree on lower resolution
(40 kb) data match more closely to TADs derived on higher reso—
lution (5 kb) Hi—C data from Rao et al. (2014). Moreover, we find
that TADtree—derived TADs have a higher enrichment at their boun—
daries for binding sites of factors such that CTCF than are known to
demarcate chromatin boundaries.

Although the TADtree algorithm demonstrates that TAD hier—
archies can be informative, there are several areas where the algo—
rithm can be improved. First, TADtree finds only an approximate
best fit to our model. Tests on smaller datasets using a brute force
search suggest that the approximate solution differs little from the
true solution (data not shown). Nonetheless, finding an exact solu—
tion in polynomial time—or proving that this cannot be done—
may be an interesting problem for future research. A second limita—
tion of TADtree is the rapid increase in runtime ~ 0(S5) with max—
imum TAD size S. Third, although our use of a parameter N
specifying the number of TADs returned by TADtree is a novel
contribution compared with previous methods, we have not
included a procedure for model selection, leaving the choice of N
to the user.

Chromatin structure is highly dynamic and varies widely from
cell to cell (Lanctot et al., 2007). Because approaches such as Hi—C
typically pool contacts from across a whole population, it is unclear
to what extent the TAD trees identified in this article represent true
chromosomal structures within individual cells. Although efforts
have been made to deconvolve Hi—C contacts computationally (Sefer
et al., 2015), this remains a challenging problem. In the future, ad—
vances in microscopy and single cell Hi—C (Nagano et al., 2013) may

shed light on whether TAD trees are true chromosomal structures or
artifacts of super position.

The emerging field of higher order chromatin organization is
providing a new lens for viewing the regulatory landscape of cells.
Chromatin structure may provide a missing link for understanding
the regulatory changes that occur during differentiation and disease
(Andrey et al., 2013; lager et al., 2015). Because megabase—scale
TADs appear to be highly conserved across both cell types and spe—
cies, it is likely that key changes in chromatin organization occur at
the sub—TAD scale. For example, changes in the structure of sub—
TADs could fine—tune opportunities for contact between genes and
enhancers. Therefore, methods for deciphering the hierarchical
structure of chromatin will be important for linking genome archi—
tecture to cellular state.

Funding

This research is supported by a National Science Foundation (NSF) CAREER
Award CCF-1053753 and NIH ROlHGOO5690. B.J.R. is also supported by a
Career Award at the Scientiﬁc Interface from the Burroughs Wellcome Fund,
an Alfred P Sloan Research Fellowship.

Conﬂict of Interest: none declared.

References

Andrey,G. et al. (2013) A switch between topological domains underlies
HoxD genes collinearity in mouse limbs. Science, 340, 1234167.

Berlivet,S. et al. (2013) Clustering of tissue—speciﬁc sub-TADs accompanies the
regulation of HoxA genes in developing limbs. PLoS Genet, 9, e1004018.

Cavalli,G. and Misteli,T. (2013) Functional implications of genome topology.
Nat. Struct. Mol. Biol, 20, 290—299.

De Wit,E. and de Laat,W. (2012) A decade of 3C technologies: insights into
nuclear organization. Genes Dev., 26, 11—24.

Dixon,J.R. et al. (2012) Topological domains in mammalian genomes identi-
ﬁed by analysis of chromatin interactions. Nature, 485, 376—380.

Filippova,D. et al. (2014) Identiﬁcation of alternative topological domains in
chromatin. Algorithms Mol. Biol, 9, 14.

Hou,C. et al. (2012) Gene density, transcription and insulators contribute to
the partition of the Drosophila genome into physical domains. Mol. Cell,
48, 471—484.

lager,R. et al. (2015) Capture Hi-C identiﬁes the chromatin interactome of
colorectal cancer risk loci. Nat. Commun, 6, 6178.

Kleinberg,J. and Tardos,E. (2005) Algorithm Design. Addison-Wesley
Longman Publishing Co., Inc., Boston, MA, USA.

Lanctot,C. et al. (2007) Dynamic genome architecture in the nuclear space: regu—
lation of gene expression in three dimensions. Nat. Rev. Genet, 8, 104—115.
Levy—Leduc,C. et al. (2014) Two-dimensional segmentation for analyzing Hi—

C data. Bioinformatics, 30, i386—i392.

Lieberman—Aiden,E. et al. (2009) Comprehensive mapping of long-range
interactions reveals folding principles of the human genome. Science,
326, 289—293.

Meila,M. (2003) Comparing clusterings by the variation of information.
Lecture Notes in Computer Science, 2777, 173—187.

Nagano,T. et al. (2013) Single-cell Hi—C reveals cell—to-cell variability in
chromosome structure. Nature, 502, 5 9—64.

Nora,E.P. et al. (2012) Spatial partitioning of the regulatory landscape of the
X-inactivation centre. Nature, 485, 381—385.

Phillips-CreminsJF. et al. (2013) Architectural protein subclasses shape 3—D or-
ganization of genomes during lineage commitment. Cell, 153, 1281—1295.

Rao,S.S.P. et al. (2014) A 3D map of the human genome at kilobase resolution
reveals principles of chromatin looping. Cell, 159, 1665—1680.

Sauria,M.E. et al. (2014) Hiﬁve: a normalization approach for higher-
resolution hic and 5c chromosome conformation data analysis. bioinv.

9103 ‘01; isnﬁnv 110 so1e§uv 50’] 0211110111123 JO AJISJQAIIIQ 112 /310's1BanOprOJx0"SOIJBuIJOJuIOIq/jzduq 11101} pep1201um0q

Hierarchical chromatin domains

1609

 

Sefer,E. et al. (2015) Deconvolution of ensemble chromatin interaction data
reveals the latent mixing structures in cell subpopulations. In: Przytycka,T.
(ed). Research in Computational Molecular Biology. Springer, Switzerland.

Sexton,T. et al. (2012) Three-dimensional folding and functional organization
principles of the Drosophila genome. Cell, 148, 45 8—472.

Shen,Y. et al. (2012) A map of the cis—regulatory sequences in the mouse gen—
ome. Nature, 488,116—120.

Symmons,O. et al. (2014) Functional and topological characteristics of mam—
malian regulatory domains. Genome Res., 24, 390—400.

Tanay,A. and Cavalli,G. (2013) Chromosomal domains: epigenetic contexts
and functional implications of genomic compartmentalization. Curr. Opin.
Genet. Dev., 23, 197—203.

Yaffe,E. and Tanay,A. (2011) Probabilistic modeling of Hi—C contact maps
eliminates systematic biases to characterize global chromosomal architec-
ture. Nat. Genet, 43, 1059—1065.

Zuin,J. et al. (2014) Cohesin and CTCF differentially affect chromatin archi-
tecture and gene expression in human cells. Proc. Natl. Acad. Sci. USA, 111,
996—1001.

9103 ‘01; isnﬁnv 110 so1e§uv 50’] 0211110111123 JO AJISJQAIIIQ 112 /810's1BanOprOJx0"SOIJBuIJOJuIOIq/jzduq 11101} pep1201um0q

