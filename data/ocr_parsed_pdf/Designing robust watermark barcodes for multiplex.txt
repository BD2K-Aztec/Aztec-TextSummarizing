Bioinformatics, 2016, 1—7

doi: 10.1093/bioinformatics/btw322

Advance Access Publication Date: 3 June 2016
Original Paper

 

Sequence analysis

Designing robust watermark barcodes for
multiplex long-read sequencing

Joaquin Ezpeleta1'2'*, Flavia J. KrsticevicI, Pilar Bulaci01'2 and
Elizabeth Tapia1'2

1Centre Internacional Franco Argentine de Ciencias de la Informacién y de Sistemas, Rosario 82000EZP, Argentina
and 2Facultad de Ciencias Exactas, Ingenieria y Agrimensura, Universidad Nacional de Rosario, Rosario
SZOOOBTP, Argentina

*To whom correspondence should be addressed.
Associate Editor: Cenk Sahinalp

Received on April 8,2016; revised on April 28, 2016; accepted on May 16, 2016

Abstract

Motivation: To attain acceptable sample misassignment rates, current approaches to multiplex
single—molecule real—time sequencing require upstream quality improvement, which is obtained
from multiple passes over the sequenced insert and significantly reduces the effective read length.
In order to fully exploit the raw read length on multiplex applications, robust barcodes capable of
dealing with the full single—pass error rates are needed.

Results: We present a method for designing sequencing barcodes that can withstand a large num—
ber of insertion, deletion and substitution errors and are suitable for use in multiplex single—
molecule real—time sequencing. The manuscript focuses on the design of barcodes for full—length
single—pass reads, impaired by challenging error rates in the order of 11%. The proposed barcodes
can multiplex hundreds orthousands of samples while achieving sample misassignment probabil—
ities as low as 10’7 under the above conditions, and are designed to be compatible with chemical
constraints imposed by the sequencing process.

Availability and Implementation: Software tools for constructing watermark barcode sets and
demultiplexing barcoded reads, together with example sets of barcodes and synthetic barcoded
reads, are freely available at www.cifasis—conicet.gov.ar/ezpeleta/NS—watermark.

Contact: ezpeleta@cifasis—conicet.gov.ar

 

 

1 Introduction

Single-Molecule Real-Time (SMRT) sequencing, with average read
lengths of ~10 kbp (Jiao et (11., 2013), is poised to remarkably sim-
plify genome assembly and targeted sequencing in many applica-
tions (Carneiro et (11., 2012; Guo et (11., 2015; Koren and Phillippy,
2015). In this new era, DNA reads are considerably longer, but un-
fortunately corrupted by unusually high rates of sequencing errors.
For SMRT sequencing, error rates of ~11% (Korlach, 2013), with a
predominance of insertions/deletions (indels) and only ~1% substi-
tution errors (Carneiro et (11., 2012), must be considered.
Fortunately, in any information transmission process affected by
noise—in this case SMRT sequencing—errors can be corrected by
adding enough redundancy to transmitted information—in this case

DNA sequences—(Gallager, 1968). The simplest way to add redun-
dancy is to transmit multiple copies of the information in the hope
that it will be possible to recover the original data through some
form of consensus. This is, for example, the rationale behind gen-
ome oversampling or coverage, which is used across sequencing
technologies to obtain virtually error-free sequences from noisy
reads. We will see, however, that this approach cannot be directly
applied to parallel multiplex (Hamady et (11., 2008) SMRT sequenc-
ing without sacrificing the much desirable read length.

Multiplex sequencing relies on the use of short oligonucleotides,
known as barcodes, to tag DNA fragments belonging to different
samples, which provides a means for translating the massive through-
put of next-generation sequencing (NGS) technologies into reduced

(63 The Author 2016. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com l

/310‘srcumo[p10}xo‘sopcuHOJIItotq/ﬁdnq

J.Ezpeleta et al.

 

sequencing costs. Barcodes are sequenced and identified to assign
each read to a sample, which is known as demultiplexing. A variant
of SMRT sequencing called Circular Consensus Sequencing (CCS),
which provides more accurate reads, is generally advised for SMRT
multiplex applications (Travers et al., 2010). In this variant, SMRT
reads of improved quality are generated from intramolecular consen—
sus over subreads obtained from multiple (2 2><) polymerase passes
along a circularized sequencing template, which follows the repetition
approach described above. With CCS, however, the length of native
reads is reduced by a factor equal to the number of polymerase
passes. To attain Illumina—level quality values, about five passes
are needed and the effective read length drops to a few kilobases
(Jiao et al., 2013).

For the longer read length afforded by SMRT sequencing to be
fully leveraged, multiplexing would need to work directly with
single—pass reads, known as Continuous Long Reads (CLRs). In this
scenario, all error correction would depend on redundancy
embedded in the barcodes themselves. However, it has been noted
that current barcodes for SMRT—CCS reads, with lengths below
20 nt, are not sufficiently robust and that longer barcodes would be
needed for this purpose (Wang et al., 2015). This comes as no sur—
prise, since most existing SMRT—CCS barcodes are obtained by
imposing a minimum edit distance constraint to sets of random se—
quences (Buschmann and Bystrykh, 2013), a design method known
to scale poorly with increasing barcode length (Masek and Paterson,
1980). To overcome the limitations of random barcodes in general
multiplex SMRT sequencing applications, systematic barcodes can
be alternatively explored.

Recently, watermark barcodes, a class of systematic barcodes
able to deal with sequencing indels and substitutions, have been pro—
posed by Kracht and Schober (2015). These are inspired in the de—
sign of watermark error correcting codes (Davey and MacKay,
2001), originally developed to deal with synchronization and substi—
tution errors in digital communications. In these applications, syn—
chronization errors are modeled as the random insertion and
deletion of symbols (Levenshtein, 1966), and are thus assimilable to
sequencing indels.

Briefly, watermark codes consist of an information—containing
carrier sequence imprinted with an arbitrary but fixed sequence of
equal length, known as watermark. In the original formulation of
watermark codes, the carrier sequence is sparse, meaning it contains
a majority of null or ‘zero’ symbols (i.e. symbols which, when im—
printed with—or added to—another, will not modify it, much like
zero in regular arithmetic). To obtain this carrier sequence, an infor—
mation message is protected by a tandem of two error correcting
codes, known as outer and inner code. Both of these embed redun—
dancy in the form of additional symbols, so that the resulting se—
quence is considerably longer than the original message. For
example, one of a set of 48 DNA samples, which in principle re—
quires only three bases (43 : 64 2 48), might be represented by a
carrier of, say, 16 symbols, most of the null type. When the water—
mark is imprinted over the carrier, the sparse constraint implies that
the resulting sequence will match the watermark at most positions.
Since the watermark is known to the decoder, this similarity pro—
vides a means to maintain synchronization in the presence of ran—
dom insertions and deletions. Substitution errors which remain after
achieving synchronization are dealt with through regular error cor—
rection, making use of available redundancy.

Although watermark barcodes appear promising, their practical
design for sequencing applications remains an open problem: for
SMRT—CLR sequencing error rates, even the best barcodes reported
by Kracht and Schober (2015) yield sample misassignment rates in

the vicinity of 5%. In this paper, we revisit the design of DNA barc—
odes around the watermark concept. As opposed to Kracht and
Schober (2015 ), we consider short low—density parity check (LDPC)
codes (MacKay, 1999) as outer codes, which offer the interesting
possibility of discarding very noisy reads rather than risk erroneous
decoding. In addition, as our main contribution, the key watermark—
carrier imprinting that conveys resilience to challenging insertion
and deletion errors is modified so that non—sparse carriers are now
allowed. This is accomplished by introducing a non—sparse inner
code and an appropriate decoding algorithm adapted from Briffa
et al. (2010), and is shown to significantly improve multiplexing per—
formance. Further, we propose an algorithm that leverages know—
ledge about the chemical context where the barcodes are embedded
to detect their boundaries. Finally, we show that the number of
barcodes which are chemically suitable for use on the sequencing
platform can be increased by exploiting the arbitrariness of the
watermark. Together, these design enhancements define the flexible
class of non—sparse watermark (NS—watermark) barcodes, which
offer high multiplexing capacity and are sufficiently robust for use
in SMRT—CLR sequencing applications.

2 Approach

To allow correct demultiplexing in the presence of errors, redun—
dancy must be added to sequencing barcodes. While this can be
done directly in the domain where errors naturally occur, it has been
shown that better performance can be achieved by ‘packing’ low—
level symbols together and designing codes in higher order finite
fields (Davey and MaeKay, 1998). A finite field of order q, denoted
by 1174, is an alphabet of q symbols with special rules for addition,
subtraction, multiplication and division. Watermark barcodes,
introduced by Kracht and Schober (2015 ) and revisited here, exploit
the above fact and embed redundancy into an information message
through a combination of an outer code, defined on a high order fi—
nite field IF 4 and an inner code, which operates at the level of nucleo—
tides or quaternary (IF 4) symbols.

2.1 Watermark barcodes based on short LDPC outer
codes

The outer code adds redundancy to an information message, which
encodes the sample number, to protect it against substitution errors.
This message is represented as a sequence x of length k whose elem—
ents belong to IF 4, i.e. x 6 IF 5. Redundancy is introduced by a linear
error correcting code, which encodes each of the qk possible values of
x into an ‘outer codeword” d 6 IF 3 of length n, that carries k inform—
ative symbols and m 2: n — k redundant ones (Fig. 1). In a linear
code, redundancy is added in such a way that the elements d, of d sat—
isfy a series of linear constraints (e.g. d4 : 3d1 + 4d2). In Kracht and
Schober (2015), tabulated linear codes found by exhaustive methods
and collected in Grassl (2006) were used as outer codes. Instead, we
preserve the original formulation of watermark codes relying on
powerful LDPC codes (MacKay, 1999). In particular, we use short
quaternary LDPC codes developed by Tapia et al. (2015) for DNA
barcoding applications affected mainly by substitution errors. These
can be easily extended to arbitrary order fields, unlike the codes col—
lected in Grassl (2006), currently limited to IF 9.

2.2 Watermark barcodes based on non—sparse inner
codes

Given an outer codeword d, the inner code expands each symbol
d, 6 IR, into a quaternary sequence ed, of fixed length 14, taken

ﬁlO'SWHmOprOJXO'SOIJBIIIJOJIIIOICV/Idnq

Designing robust watermark barcodes

 

 

 

 

 

 

 

 

 

8

di ed,

0 312

IFqr 1 213

2 302

3 023

Addition over in;    I,"   .3— (ed1 ed) 4 032

0w3e cﬂmﬂﬂmﬂmmmonnnmm 23%

0 0123 ®@®®®®®®®®®®®®® 7 210
w, 1 1032 F4 wEIE

2 2301 b: 663W

3 32b1 10?? F 0123

i  1114—)” Af ACTG
N __

Fig. 1. Construction of a NS-watermark barcode, illustrated for the message x : 21 e 11%, representing a particular sample number, and for parameters (1:8,
n: 5, k: 2, m: 3 and u: 3. The specific inner codebook S and mapping 1174 a N used are shown on the right. The definition of addition over 1174 is shown on the
left. The linear encoder is assumed to enforce the following linear constraints: (11 2X1; (12 2X2; (13 : 2X1 + X2; (14 : X1 + X2; (15 : 2X1 + 2X2

from an inner codebook 5 of size q X 14. As a result of this expansion,
quaternary carriers c of length l :: nu are obtained. Carriers are
then imprinted with a known quaternary watermark sequence w of
the same length (by simple symbol—wise addition over IF 4), resulting
in imprinted sequences b. Finally, using a fixed mapping from IF4
into the ‘nucleotide space’ N 2: {A, C. T. G}, a set of qk candidate
barcode sequences is obtained (Fig. 1). Davey and MacKay (2001),
as well as Kracht and Schober (2015), constrain the sequences of 5
(e0 through eq_1) to be sparse. This helps achieve synchronization
by introducing relatively few modifications to the watermark.
However, it is accomplished at the expense of increased similarity
between watermark—imprinted codewords, which may in turn lead
to diminished error correction performance. Still, if codewords are
sufficiently long (e.g. with hundreds or thousands of symbols, as in
communication applications), the blessing face of dimensionality
turns such effect unnoticeable. Conversely, if the length of code—
words is reduced to the range of tens of symbols, as in the case of
DNA barcodes, similarity between codewords may become a major
concern, particularly at high levels of noise, as in the case of SMRT—
CLR sequencing. This may explain the poor performance of water—
mark barcodes recently proposed by Kracht and Schober (2015) for
this range of error rates. To overcome this problem, we instead se—
lect the sequences of 5 with no constraints other than large pairwise
hamming distance (i.e. choosing them to be as different as possible).
As a result, the minimum edit distance factor, which is key for the
performance of any coding scheme, improves significantly.

2.3 Barcode filtering

Of the initial M 2: (1’2 candidate barcode sequences, only a reduced
number B will be chemically suitable for the SMRT sequencing plat—
form. Different factors can reduce multiplexing capacity, including
GC content, homopolymers, primer dimer formation and compati—
bility with sequencing adapters. In order to account for these effects
and filter out unsuitable barcodes, we consider a filtering stage
based on a version of the barcrawl filtering tool (Frank, 2009)
adapted to accept external candidate barcodes. Specifically, barco—
des are filtered based on the following criteria: GC content between
35% and 65%, maximum homopolymer length of 5, maximum het—
eroduplex length of 6 and maximum hairpin length of 6. This filter—
ing stage considers not only the individual barcodes but also their

compatibility with one another and with the SMRT sequencing
adapter.

2.4 On the choice of the watermark sequence

As long as it is fixed and known, the watermark can be arbitrarily
chosen, and a random sequence is the usual choice (Davey and
MacKay, 2001; Kracht and Schober, 2015). However, random
watermarks can perform poorly when it comes to satisfying chem—
ical constraints. To overcome this limitation, we propose a method
that exploits the arbitrariness of the watermark string to minimize
the loss of multiplexing capacity due to chemical constraints. More
precisely, we traverse the watermark from left to right and, at each
position, select the base which maximizes the number of surviving
barcodes after the barcrawl filtering stage. This process is repeated
until no improvement is achieved in an entire pass (indicating a local
minimum). At this point, a fixed number of bases are changed at
random before traversing the pattern again. In essence, this is an
iterated local search (Gendreau and Potvin, 2010) where the number
of barcodes lost during the filtering stage is taken as the cost
function. For the seven NS—watermark barcode sets discussed
later in this paper, this simple heuristic approach yields an average
~1.5—fold increase in multiplexing capacity relative to the use of
random watermarks, with no apparent degradation in multiplexing
performance.

2.5 A model for SMRT sequencing errors

In order to formally describe indels and substitutions introduced by
the sequencing process, DNA sequences were modeled as being trans—
mitted over a noisy channel. For this purpose, the Insertion Deletion
Substitution (IDS) channel model, defined by Davey and MacKay
(2001) and adapted to sequencing by Kracht and Schober (2015), was
considered (Fig. 2). For each incoming base, a random base can be in—
serted with probability P, (which can happen a maximum of I times),
and then the current base is either deleted with probability Pd or
sequenced (‘transmitted’) with probability Pt. Sequenced bases can
themselves be correctly sequenced with probability 1 — PS or suffer a
substitution error with probability PS. When a substitution occurs, the
three possible base replacements are equiprobable.

ﬁlO'SWHmOprOJXO'SOIJBIIIJOJIIIOICV/Idnq

an?kgogmomammowoio~&o:3m7.omm\

Fig. 4

Fig. 2

{J

(6)

Tapia (7/ Lil. (2015)

\Wolf, 1978

blacKa) , 1999

Dme} and IVILICKLI), 1998

Figure 5

Pacific Biosciences, 2015

Timers (7/ al., 2010 Figure 6

Kracht and Schober (2015)

/810'sreumofp103xo'sopeuuoyiioiq”:dnq

Kracht and Schober (2015)

Wolf, 1978

1999

I. “IIIIIIIIIIIIIIIIIIIIIIIIIIIIII

O

Schober (2015)

Schober (2015)

MacKay,

Table 1

Kracht and

Fig. 7
Kracht and

 

/3.IO'S[BIIm0fp.IOJXO'SOIJBIIIJOJIIIOIq/ﬂdnq

Designing robust watermark barcodes

 

different values of k (i.e. different multiplexing capacities) were also
considered.

4 Discussion

As seen in Figure 7, NS—watermark barcodes consistently outperform
the best watermark barcodes reported by Kracht and Schober (2015)
for the same barcode length (1:24), while simultaneously increasing
multiplexing capacity. Additionally, results show that both the decod—
ing failure probability Pe (discarded reads) and the undetected demulti—
plexing error probability PL1 (misassigned reads) decrease
monotonically with barcode length (Table 1). In connection with this,
we note that, although working with CLRs introduces significantly
higher error rates than using CCSs, it also makes it possible to use lon—
ger barcodes while keeping the relative barcoding overhead within rea—
sonable limits. For example, 96 bp barcodes, which are unfeasible for
CCS reads or short read technologies, introduce a relative overhead of
less than 1% on the average CLR of around 10 kb. Additionally, the
use of scalable design and demultiplexing algorithms makes such lon—
ger barcodes feasible from the computational point of view.

We further note that, because of the low sample misassignment
rates, correctly assigned reads are expected to vastly outnumber mis—
assigned reads for any given sample. Under these conditions, misas—
signed reads are likely to be ‘washed away’ by downstream consensus
within each sample group and, therefore, the final per—base error due
to undetected demultiplexing errors could be several orders of magni—
tude smaller than the reported sample misassignment rate.

A major advantage of the proposed NS—watermark is the flexibil—
ity it offers for code construction. Within reasonable ranges, any com—
bination of u, q, n, l, k, m, w and 5 yields an admissible barcode set.
For a given outer code length 11, using more information
symbols (higher values of k, lower values of m) increases multiplexing
capacity but decreases multiplexing performance. For a given multi—
plexing capacity M and barcode length 1, higher order fields (higher
values of q) improve the sample misassignment rate, albeit at the ex—
pense of higher read losses. For a given I, there is usually also more
than once choice for u and n such that l 21114. Of these, those with
higher 14 invest more redundancy in the inner code than in the outer
code and may be better suited for error profiles with high rates of in—
sertions and deletions, such as the one considered here. Conversely,
those with higher 11 invest more in resilience to substitution errors and
may be appropriate for more traditional error profiles.

This increased flexibility, along with the systematic construction
method, means new code configurations can be explored virtually
effortlessly to adapt to changing requirements, given by admissible
rates of read losses and sample misassignments, acceptable coding
overhead, number of samples or error profiles. In particular, our de—
sign method can be easily extended to other sequencing technologies
impaired by high rates of indels and substitution errors, notably the
much anticipated Nanopore sequencing (Akeson et al., 1999), by
appropriately tuning design—time and decoding—time parameters.

Funding

This work has been supported by the National Agency for the Advancement
of Science and Technology of Argentina through grant PICT 2012-2513.

Conﬂict of Interest: none declared.

References

Akeson,M. et al. (1999) Microsecond time-scale discrimination among poly-
cytidylic acid, polyadenylic acid, and polyuridylic acid as homopolymers or
as segments within single RNA molecules. Biophys. ]., 77, 3227—3233.

Briffa,]. et al. (2010). An improved decoding algorithm for the Davey-
MaCKay construction. In: Proc. IEEE Int. Conf. Commun. (ICC), 2010, pp.
1—5.

Buschmann,T. and Bystrykh,L. (2013) Levenshtein error-correcting barcodes
for multiplexed DNA sequencing. BMC Bioinformatics, 14, 272—273.

Carneiro,M. et al. (2012) Paciﬁc biosciences sequencing technology for
genotyping and variation discovery in human data. BMC Genomics, 13,
375.

Davey,M. and MacKay,D. (1998) Low-density parity check codes over GF(q).
IEEE Commun. Lett., 2, 165—167.

Davey,M. and MacKay,D. (2001) Reliable communication over channels with
insertions, deletions, and substitutions. Inf. Theory IEEE Trans., 47,
687—698.

Frank,D. (2009) Barcrawl and bartab: software tools for the design and imple—
mentation of barcoded primers for highly multiplexed DNA sequencing.
BMC Bioinformatics, 10, 362.

Gallager,R. (1968) Information Theory and Reliable Communication. Wiley,
New York.

Gendreau,M. and Potvin,].Y. (2010) Handbook of Metaheuristics. vol. 2.
Springer, New York.

Grassl,M. (2006) Searching for linear codes with large minimum distance. In:
Bosma,W. and Cannon,]. (eds.) Discovering Mathematics with Magma,
Volume 19 of Algorithms and Computation in Mathematics. Springer,
Berlin, Heidelberg, pp. 287—313.

Guo,X. et al. (2015) SMRT sequencing for parallel analysis of multiple targets
and accurate SNP phasing. G3 (Bethesda), 5, 2801—2808.

Hamady,M. et al. (2008) Error-correcting barcoded primers for pyrosequenc-
ing hundreds of samples in multiplex. Nat. Methods, 5, 235—237.

]iao,X. et al. (2013) A benchmark study on error assessment and quality con-
trol of CCS reads derived from the PacBio RS. ]. Data Min. Genomics
Proteomics, 4. 1—12.

Koren,S. and Phillippy,A. (2015) One chromosome, one contig: complete mi-
crobial genomes from long—read sequencing and assembly. Curr. Opin.
Microbiol., 23, 110—120.

Korlach,]. (2013) Understanding accuracy in SMRT sequencing. pacb.com/
wp-content/uploads/2015/09/Perspective_
UnderstandingAccuracySMRTSequencing.pdf. (Jan 2016, date last
accessed).

Kracht,D. and Schober,S. (2015) Insertion and deletion correcting DNA barc-
odes based on watermarks. BMC Bioinformatics, 16, 50.

Levenshtein,V. (1966) Binary codes capable of correcting deletions, insertions
and reversals. Soviet Physics Dolzlady, 10. 707—710.

MacKay,D. (1999) Good error-correcting codes based on very sparse matrices.
IEEE Trans. Inf: Theory, 45, 399—431.

Masek,W. and Paterson,M. (1980) A faster algorithm computing string edit
distances]. Comput. Syst. Sci., 20, 18—31.

Paciﬁc Biosciences. (2015) Multiplexing amplicons up to 10 kb. pacb.c0m/Wp-
content/uploads/2015/09/ProductNote-Barcoded-Adapters-Barcoded-
Universal-Primers.pdf. (Jan 2016, date last accessed).

Tapia,E. et al. (2015) DNA barcoding through quaternary LDPC codes. PLoS
ONE, 10, e0140459.

Travers,K. et al. (2010) A ﬂexible and efﬁcient template format for circu-
lar consensus sequencing and SNP detection. Nucleic Acids Res., 38. 6159.
Wang,M. et al. (2015 ) PacBio-LITS: a large-insert targeted sequencing method
for characterization of human disease—associated chromosomal structural

variations. BMC Genomics, 16, 214.

Wolf,]. (1978) Efﬁcient maximum likelihood decoding of linear block codes

using a trellis. IEEE Trans. Inf. Theory, 24, 76—80.

ﬁm'spzumol‘pmyo'sopeuuowtotq/ﬁdnq

