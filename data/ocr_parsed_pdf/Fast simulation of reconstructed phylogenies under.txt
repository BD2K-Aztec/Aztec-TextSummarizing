BIOINFORMA TICS

0'so;112u110}u101q//2duq

SIBumoprOJX

£10"

S.H6hna

 

are simulated and the process converges only slowly to the ter—
minating species number.

In this article, I will derive the joint probability density of the
reconstructed phylogeny using a new approach that shows that
each speciation time in the reconstructed tree is independent and
identically distributed (iid). I will then develop an algorithm that
uses the cumulative distribution function for fast simulation of
the reconstructed tree under anyicontinuous or discreteitime—
dependent speciation and extinction rate function. I apply this
new simulation technique to sample from the posterior predictive
distribution of an empirical dataset, the bird family Cettidae.

2 METHODS

The strategy of the simulation algorithm, developed in the following sec-
tion, is to derive the probability density of a single speciation event inde-
pendent of all other speciation events in the reconstructed tree. Once the
probability density is known, it is (at least numerically) possible to com-
pute the inverse cumulative distribution function and thus samples from
the desired distribution. The simulation procedure only needs to draw
n — 1 speciation events for a tree of size n and does not need to draw all
speciation events that are pruned because they do not have extant des-
cendants. I will start by deﬁning the birthideath process.

The process starts with a single species at time to. Every species has the
same speciation and extinction rate at any time t, denoted by Mt) and
u(t), respectively. The time until a speciation event of a given species is
exponentially distribution with rate Mt). At a speciation event, a species
gives birth to exactly one new species. The time until an extinction event
of a given species is exponentially distributed with rate u(t). Furthermore,
let N(t) denote the number of species at time t. Following standard no-
tation, I will use to as the time of the origin or start of the process and Tas
the present time when the process was stopped.

The observation of a tree generated by the birth41eath process con-
taining extant as well as extinct species is called a complete tree (Fig. 1a).
Removing all extinct branches gives the reconstructed tree (Nee et al.,
1994b) (Fig. lb). From the reconstructed tree with n extant species,
I obtain the set of speciation times {t} = {[0, ...,t,,,1}. In this article,
I consider the reconstructed sampled tree as the data.

Let me begin with stating some known probability densities of the
birth41eath process, the probability of survival P(N(T)>0|N(t) = 1),
the probability of exactly one descendant P(N(T) = 1 |N(t) = 1) and
the probability of n descendants P(N(T) = n | N(t) = 1) (Kendall, 1948;
Thompson, 1975; Nee et al., 1994b; Morlon et al., 2011). Although I will
follow closely Nee et al. (1994b), I modiﬁed the process to start at time t

(a)

Speciation

\

 

 

 

Extinction

 

 

 

 

F 4
r1

 

and stop at time Tinstead of starting at time 0 and stopping at T— t and
thus is a generalization of the original equations in Nee et al. (1994b).
Finally, I derive the probability density of a single speciation event, fol-
lowing the idea of Thompson (1975), by using the above-mentioned prob-
ability densities.

First, I deﬁne the rate function r as

m, s) = ﬂmz) — mm: (1)

The probability of a single species alive at time t surviving until time
T [P(N(T)>0 | N(t) = 1)] is given (Nee et al., 1994b, Equation 24) by
T

P(N(T)>0|N(t)=1)= <1+f

I

71
(“(5) exp(r(t, S)))dS) . (2)

The probability of n species at time T when starting with a single
species at time t is (Nee et al., 1994b, Equation 3)
P(N(T) = n|N(t) = 1)
= (1 - P(N(T) > 0 | N0) = 1)exp(r(t, T)))"71 (3)
x P(N(T) > 0 | N0) = If export, T))
which leads to the probability of obtaining a single lineage at time T

P(N(T) = 1|N(t) = 1) = P(N(T) > 0|N(t) = 1)Zexp(r(l,7))- (4)
Equation (3) can be derived from a geometric distribution with parameter
P(N(T)>0 | N(t) = 1)exp(r(t, T)) multiplied by the probability of sur-
vival of the process P(N(T)>0 |N(t) = 1). Thus, the probability of n
species at time T given that we had 1 species at time t [N(t) = 1] and
the species survives, denoted by S(1, t, T), is

P(N(T) = n | N(t) = 1, S(1, t, T))
=(1 -1’(1V(7)>0|N(l)=1)exp(r(l,7)))"’1 (5)
X P(N(T)>0 | N(t) = 1)exp(r(t, T)).
Now, following the reasoning of Thompson (1975, p. 5458), I give the

joint probability distribution of all speciation times {t} of the recon-
structed tree given that we sample (or stop) the process at time T

PBD({1}|N(10)= 1’ T)

=P(N(T) = 1|N(10) = 1) (6)

"71
X 1‘1 (i X 21(1)) >< P(N(T) = 1|N(ti) = 1))

 

 

 

 

 

 

 

 

it: """"""" "r1

 

Fig. 1. A simulated birth41eath tree starting with a single species. (a) The complete tree containing both extant and extinct species. (b) The reconstructed

tree containing only extant species

 

1 368

ﬁm'spzumofpmﬂo'sopeuuopnorq/ﬁdnq

Fast simulation of reconstructed phylogenies

 

The intuitive interpretation of the probability density is that the pro-
cess starts with one species that survives until the present time
[P(N(T) = 1 |N(t0) = 1)]. Then, for each speciation event, we multiply
with the density to obtain a speciation event at time ti [il(t,»)] and the
probability that this new species has one sampled descendant at the pre-
sent [P(N(T) = 1 |N(t,») = 1)]. A short proof is given in the Appendix.
Using Equations (3) and (6), we can compute the probability of the
conditioned process on n lineages at the present time T results

PBD(1z}1N(zo)=1,N(T> = n, T)
_Mimmwwndwm=u (D
‘ . 1—P(N(T>> 011m.) = 1>exp(r(zo,T>>

Note, the factor i in front of 2(a) is simply a combinatorial constant
representing the (n— 1)! possible orderings of the speciation events
(Aldous and Popovic, 2005). Hence, the probability density of each
single speciation event is iid by the deﬁnition of independence
mammwamm=LMD=mD=mmmMM=LMD=mm
and have the probability density

P300) CX 1(I)P(N(T) = 1|N(l) = 1) (8)

This has previously been shown by Yang and Rannala (1997) for
constant rates and been exploited by Hohna et a]. (2011) for estimations
of model parameters.

I will now show how to use these probability distributions to simulate
reconstructed trees under the three different conditions.

 

2.1 Simulating reconstructed trees for a fixed time t and
number of species n

I will start developing the algorithm for simulating reconstructed trees
when conditioning on bothithe time of the process I and the number of
sampled extant species nialthough this might not be the common or
natural condition for simulating reconstructed trees. It is, however, used
by the two other simulation conditions. Random speciation events are
drawn by solving the inverse cumulative distribution function of the spe-
ciation times.

From Equation (7) we have that the joint probability of all speciation
times in the reconstructed tree and established that all speciation times are
iid with the probability density given in Equation (8). Thus, to obtain
n — 1 speciation times (or n — 2 in the case when starting at the MRCA),
one needs to draw n — 1 random draws from the above distribution. Such
random draws can be obtained by ﬁrst drawing a random number u form
the Uniform (0,1) distribution. Then, the speciation time t* for which the
cumulative distribution function of Equation (8) equals u, gives the ran-
domly drawn speciation time:

7510mm]:
1. = 0T—
f PBD(t)dt
‘3. (9)
f x1(t)P(N(T) = 1 |N(t) = 1)dt
_ 0

[T)(zwmm = 1 |N(t) = 1)dt
0

Figure 2 shows an example of how to draw random speciation times in
the sampled reconstructed tree.

The algorithm how to construct a random from the set of speciation
time is given below.

2.2 Simulating reconstructed trees for a ﬁxed time t

I start by simulating the number of species after the time t. Equation (3)
gives the probability of n species at time t. Therefore, one only needs

 

     

 

 

 

0. _
H
00
o _  IJ
E‘
E
8 5:] _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ . _ _ _ _ _ __
 o- - :
'5 I
(U
.a I
E I
a. v I
E 0' _ I
‘5' I
S I
E I
3
U N_ _ I I
o mass-extinction 5 :
P=0-2 I I
I
o I
o' ' . : f
I I I I I I I
0.0 0.5 1.0 1.5 2.0 2.5  3.0
Time

Fig. 2. An example birthideath process with rates of A = 1.0 if t< 1.0 or
[>20 and A = 0.1 otherwise; it = 0.95 if t<1.0 or [>20 and p, = 0.0
otherwise. Additionally, there is a mass-extinction event at time t = 0.8
with a survival probability of P = 0.2 per species. The algorithm for
drawing new speciation times t* draws a random u\simunif(0,1), and
searches the t* for which CDF(t*) = u

to make a random draw u ~ unif(0, 1) and ﬁnd the maximal n for
which the cumulative distribution function of Equation (3) is smaller or
equal to u:

I!
max (u : P(N(t) = i|N(t0) = 1)) (10)
" >7
Once the number of species is obtained by a random draw, the speciation
times can be simulated using the above algorithm conditioning on both,
the number of species and the time of the process.

1—1

2.3 Simulating reconstructed trees for a ﬁxed number of
species n

A tree with a ﬁxed number of extant species can be simulated by ﬁrst

simulating the time of the process T given that the number of species was

N(T) = n. Let us assume that one draws a random time T with some

probability P(T) and maximum value max, then simulates a tree under

the birthideath process. A new time T and a new tree are drawn until the

tree contains n species at time T. Thus, using Bayes Theorem, the prob-

ability of the time of the process (or the time of the origin/MRCA) is
P(N(T)="|N(lo)=1aT)><P(T) (11)

max '

f P(N(t) = n | N(to) = 1, t) x P(t)dt

0

 

P(Tln) =

If a uniform distribution as the prior distribution on the time of the
process is assumed, then the probability P(T) in the numerator cancels
out with the probability P(t) in the denominator. However, in the general
form, when one wants to specify some informative prior distribution of
the time of the process, then the integral needs to be computed
numerically.

Only a random draw from the distribution given in Equation (11)
needs to be obtained and the same algorithm as for conditioning on
the number of species and the time of the process can be used.

 

1 369

ﬁm'spzumofpmjxo'sopeuHOJmorq/ﬁdnq

S.H6hna

 

2.4 Starting at the MRCA

In the previous sections, I only considered the situations when the process
starts with N(to) = 1. Now I will give the necessary modiﬁcations if one
wants to condition on the MRCA. Let the process start with two species
and both survive until the present S(2, to, t), then Equation (5) needs to be
modiﬁed to condition on two species to start with

P(N(l) = n | N(to) = 150.10,!»

"71
= 200mm = :1 MM) = 1. so, to, t»
[:1 . (12)
X P(N(t) = n — z | N(to) = 1, 5(1, [0, 1)))
= (n — 1)(P(N(T> >01N(r) = 1? export, T)))Z
x (1 — P(N(T)>01N(r> = 1) export, T)))”

The rationale behind the derivation is that one could consider two inde-
pendent processes, both starting with one species at time to = 0, and the
sum of the species of both processes equals n.

The algorithms for simulating reconstructed phylogenies remain un-
changed, and only Equation (3) needs to be replaced by Equation (12).

2.5 Reconstruction of a tree from speciation times

In the previous sections, I only elaborated the methods how to draw the
set of speciation times. The reconstructed phylogeny can be created from
the set of speciation times by ﬁrst creating a set of n species. Then,
repeatedly join two random species together. The time of the i-th speci-
ation event is the i-th largest speciation time of the previously created set
of speciation times. This procedure is closely related to the UPGMA
method (Sokal and Michener, 1958; Felsenstein, 2004). The resulting
tree is from the correct distribution because the speciation times are iid
and the birth41eath process implies a uniform distribution on labeled
histories (Aldous and Popovic, 2005).

2.6 Modeling mass-extinction events and random
taxon sampling

The rate functions have been provided as general functions of time.
Following Nee et al. (1994b), mass-extinction events are modeled by

t,,,e(t. x]

was): /(M(z)—/1(z))dz— 2 logo...) (13)

where tm is the time and pm the survival probability of the m-th mass-
extinction event.

Then, the probability of a single species alive at time t surviving until
time T [P(N(T)>0 | N(t) = 1)] from Equation (2) changes to

P(N(T)>0|N(t) = 1)

T ’1 (14)
= (1— / (11(s)exp(r(r,s»)dv — 2 (p... —1)exp(r(r,rm»)

I {m e(t. .\']

Note that here 1 — pm represents the extinction probability at the m-th
mass-extinction event. Furthermore, random taxon sampling is the same
as a mass-extinction event at the present time (Nee et al., 1994b).

2.7 Implementation and numerical integration

The methods described to simulate trees are implemented in the R
(R Core Team, 2012) package TESS (Tree Evolution Simulation
Software). TESS can handle any type of rate functions and is designed
for fast simulation of reconstructed trees. Furthermore, TESS computes
the likelihood function [Equation (6)] conditioned on the time of the
process, survival of the process or the time and number of taxa at present.

The likelihood function can be used for Bayesian and Maximum
Likelihood inference, posterior prediction and model testing (see the
Supplementary Material).

There are no closed form solutions known for the equations presented
above. Only for the special cases when the rates are constant, one can
compute the probability densities analytically. Nevertheless, R provides
several methods for numerical integration. TESS uses the package
deSolve (Soetaert et al., 2010) to perform the numerical integration.
If only a single draw or few draws from a distribution are needed, then
TESS performs a simple Monte Carlo sampling instead.

3 RESULTS

In this section, I compare the performance of TESS to TreeSim
and show a potential application: posterior prediction of recon—
structed phylogenies.

3.1 Performance

One of the major shortcomings of the GSA as implemented in
TreeSim is the long computation time, especially in situation
when Mt) 8 Mt). Additionally, TreeSim cannot handle continu—
ous increasing or decreasing rate functions but only constant
rates in predeﬁned intervals. Thus, I designed a challenging but
hopefully interesting function of the rates. The speciation rate
Mt) = 1.0 for t e [0.0, 0.8], then is increased for a time of rapid
radiation as Mt): 2.0 for IE (0.8,1.0] and switches back to
the original rate when t>1.0. The extinction rate changes
at the same time points. First, the rate is comparably high
lMt) = 0.95 for t 6 [00,08] and then slows down to lMt) = 0.5
for IE (0.8,1.0] before switching back to the original value as
well. Additionally a mass—extinction event occurs at time t = 0.8
and each species survives with probability P = 0.2. The process
resembles the situation when the diversity increases only slowly
but a high species turnover happens until a mass—extinction event
removes most species but also opens new niches, which results
into a time of rapid radiation. Furthermore, each extant species
was sampled with probability P = 0.5.

I ran both R packages on a MacBook Pro with a 2.3GHz
Intel Core i7 using only one core at a time to produce as fair
as possible results. Simulations with the given rates where per—
formed for n e {10, 20, ..., 200} species sampled at the present
time. For each n, 100 trees were simulated and the median run—
ning time was reported (Fig. 3). Note that the distribution of
running times is skewed for TreeSim. Therefore, the median is
a more stable estimator than the mean but the median is also
much lower. TESS outperforms TreeSim up to four orders
of magnitude. Furthermore, TESS computation time is mostly
independent of the number of species, and the main challenge
is to compute the integral of the probability of survival.
Additionally, TESS can simulate a batch of trees faster once
the integral of the survival probability is precomputed, which is
shown in the simulations of 10000 trees (TESS 10K).

3.2 Posterior prediction

For each simulated tree, I computed the posterior predictive
distribution can be used to assess the ﬁt of the model to the
observed data (Gelman et al., 2003). Posterior predictive tests
have the advantage to take the uncertainty in the model param—
eters into account, if applied an a Bayesian analysis (Bollback,

 

1370

ﬁm'spzumofpmjxo'sopeuHOJmorq/ﬁdnq

:39\Ewowsmoaﬁmowoxmoagoﬁsambwﬁ

 

S.H6hna

 

general as possible so that any possible model might be used. See
the additional ﬁle PosteriorPredictionCettiidae.R that was used
for this study.

4 DISCUSSION

In the present article, I only considered simulations of recon—
structed phylogenies. Most estimated phylogenies are recon—
structed phylogenies because no information about extinct
species is available, such as ancient molecular sequences, and
only the extant species are included. Nevertheless, phylogenetic
trees including some extinct species might provide more inf orma—
tion in estimating the time—dependent diversiﬁcation rates.
In these cases, either the GSA or simulating the missing speci—
ation and extinction events following the idea of Bokma (2008)
are useful.

Another drawback of the GSA is that events%.g. mass—
extinction eventswannot be speciﬁed to happen at a given
time before the present when one conditions on the number of
species being sampled. In this manuscript, I did not consider
these circumstances, although the simulation procedure can be
modiﬁed to accommodate events at speciﬁc times before the
present without major difﬁculties. In this case, the distribution
of the time of the origin (or the MRCA) needs to be considered
backward in time instead of forward. Finally, once the time of
the process is obtained, the simulation of the single speciation
events remains unchanged.

The simulation algorithm presented here in this article relies
on the factorization of the probability density function.
Previously, only for the constant—rate birth41eath process has
such a factorization been known (Yang and Rannala, 1997;
Hohna et al., 2011). I derived the factorization for the time—de—
pendent birth41eath process. Unfortunately, other types of
birth41eath process, e.g. the diversity—dependent birthideath
process (Etienne et al., 2012) or the protracted speciation process
(Etienne and Rosindell, 2012), do not have a know factorization.
Nevertheless, the time—dependent birthideath process might be
used to approximate other birthideath processes, such as the
diversity—dependent birth41eath process (Rabosky and Lovette,
2008).

It is possible to simulate tree using an MCMC algorithm, once
the likelihood equations are known. However, if no direct simu—
lation technique from the desired distribution is known, then the
MCMC algorithm must start from some arbitrary starting
values. Furthermore, samples are random draws from the speci—
ﬁed distribution only after the chain has reached its stationary
distribution. When the chain has reached its stationarity
distribution and how long it takes to do so is a challenge in
itself (Gelman et al., 2003). Thus, direct sampling, as I propose
here, is safer, faster and can even be used for starting values of
MCMC runs.

Several of the more complicated birth41eath processes, e.g.
containing different rates for different species (FitzJohn et al.,
2009) or heritable extinction rates (Rabosky, 2009), do not have
a known likelihood function. Instead, approximate Bayesian
computation (ABC) can be applied to estimate the parameters
of interest (Beaumont et al, 2002) although ABC has been criti—
cized and should be used cautiously (Robert et al, 2011).
The birth41eath simulations implemented in TESS rely on the

likelihood function, and therefore, neither ABC is necessary
nor are these simulations needed for parameter estimation.
Nonetheless, the simulation techniques can be used to test the
summary statistics used in ABC. Currently, only the number
of species at the present time, the time of the origin and the
y—statistic have been used as summary statistics for ABC under
a birth41eath model (Rabosky, 2009). Using TESS, it might be
possible to test the performance of these summary statistics and
develop new ones.

5 CONCLUSION

Simulating reconstructed phylogenies is important for develop—
ing and testing macro—evolutionary processes but has been a
challenge for non—constant birthideath models (Hartmann
et al., 2010). In the present manuscript, I present an algo—
rithm that can be used to simulate reconstructed phylogenies
when conditioning on the number of species being sampled or
the time of the process or both. The presented algorithms can
accommodate any time—dependent rate functionwontinuous
and discreteiand can model mass—extinction events as well
as periods of rapid radiation. Compared with the currently
only available software for these types of simulations,
TreeSim, my implementation is four orders of magnitude
faster for 200 taxa and does not need signiﬁcantly more com—
putational time to simulate larger trees. Thus, simulations
under even more complex models and many taxa at present
are now feasible.

I derived the probability density of the sampled reconstructed
phylogenetic tree. The derivation follows the ideas of Thompson
(1975) and Nee et al. (1994b). The newly derived probability
density is provided in a general and new form. It shows that the
speciation times are iid, which has previously only been shown
for constant rates (Yang and Rannala, 1997). This enables for
instance the Diversified Sampling under time—dependent speci—
ation and extinction rates (Hohna et al., 2011).

R is widely used for inferring diversification patterns (Harmon
et al., 2008; O’Meara, 2012). It provides a good framework to
implement new methods that can be shared and used freely. The
methods of this article are implemented in the R package TESS.
TESS constructs trees in the phylo format of APE (Paradis et al.,
2008). Thus, the trees simulated in TESS can be directly analyzed
in APE and other tools using the phylo format. The implemen—
tation is kept general so that any time—dependent rate function
can be used. Additionally, an implementation of the likelihood
computation is provided that can be used either in a maximum
likelihood or in a Bayesian inference, as shown in the posterior
prediction example.

ACKNOWLEDGEMENTS

I am very grateful to Fredrik Olsson for countless discussions on
several aspects of this and related projects, to Tom Britton and
two anonymous reviewers for comments on the manuscripts,
Rich FitzJohn for his comments on the manuscript and the
R package and the associate editor.

Conﬂict of Interest: none declared

 

1372

ﬁm'spzumofpmjxo'sopeuHOJmorq/ﬁdnq

Fast simulation of reconstructed phylogenies

 

REFERENCES

Aldous,D. and Popovic,L. (2005) A critical branching process model for biodiver—
sity. Adv. Appl. Pro/mix, 37, 10941115.

Alfaro,M.E. et al. (2009) Nine exceptional radiations plus high turnover
explain species diversity in jawed vertebrates. Proc. Natl Acad. Sci, 106,
1341(k13414.

Astrom,P. et al. (2011) Non—monophyly and intricate morphological evolu—
tion within the avian family Cettiidae revealed by multilocus analysis of a
taxonomically densely sampled dataset. BMC Evol. Biol, 11, 352.

Beaumont,M.A. et al. (2002) Approximate Bayesian computation in population
genetics. Genetics, 162, 204572035.

Bokma,F. (2008) Bayesian estimation of speciation and extinction probabilities
from (in) complete phylogenies. Evolution, 62, 244172445.

Bollback,J.P. (2002) Bayesian model adequacy and choice in phylogenetics.
Mol Biol. Evol., 19, 117171180.

Etienne,R. et al. (2012) Diversity—dependence brings molecular phylogenies
closer to agreement with the fossil record. Proc. Natl Acad. Sci, 279, 130071309.

Etienne,R.S. and Rosindell,]. (2012) Prolonging the past counteracts the pull
of the present: protracted speciation can explain observed slowdowns in
diversiﬁcation. Syst. Biol, 61, 20¢213.

Felsenstein,]. (2004) Distance Matrix Methods. Inferring Phylogenies. Sinauer
Associates, Sunderland, MA, USA.

FitzJohn,R. et al. (2009) Estimating trait—dependent speciation and
extinction rates from incompletely resolved phylogenies, Syst. Biol, 58,
5957611.

Gelman,A. et al. (2003) Model checking and improvement. In: Bayesian Data
analysis, 2nd edn. Chapman & Hall/CRC, New York.

Geweke,.I. (1991) Evaluating tlte Accuracy of Sampling—Based Approacltes to the
Calculation of Posterior Moments. Federal Reserve Bank of Minneapolis,
Research Department.

Harmon,L.J. et al. (2008) GEIGER: investigating evolutionary radiations.
Bioinﬁ)rmatics, 24, 1297131.

Hartmann,K. et al. (2010) Sampling trees from evolutionary models, Syst. Biol, 59,
4657476.

Hastings,W.K. (1970) Monte carlo sampling methods using Markov chains and
their applications. Biometrika, 57, 977109.

Hohna,S. et al. (2011) Inferring speciation and extinction rates under different
species sampling schemes. Mol Biol. Evol., 28, 257772589.

Kendall,D.G. (1948) On the generalized “Birth—and—Death" process. Ann. Math.
Statist., 19, 1715.

Liow,L.H. et al. (2010) When can decreasing diversiﬁcation rates be
detected with molecular phylogenies and the fossil record? Syst. Biol, 59,
64(r659.

Maddison,W. et al. (2007) Estimating a binary character’s effect on speciation and
extinction. Syst. Biol, 56, 701.

Metropolis,N. et al. (1953) Equation of state calculations by fast computing
machines. J. Chem. Phys, 21, 108771092.

Morlon,H. et al. (2011) Reconciling molecular phylogenies with the fossil record.
Proc. Natl Acad. Sci, 108, 16327716332.

Nee,S. (2006) Birth—death models in macroevolution. Ann. Rev. Ecol. Evol. Syst., 37,
1717.

Nee,S. et al. (1994a) Extinction rates can be estimated from molecular phylogenies.
Philos. Trans. R. Soc. Lond. B. Biol. Sci, 344, 77782.

Nee,S. et al. (1994b) The reconstructed evolutionary process. Philos. Trans. R. Soc.
Lond. B. Biol. Sci, 344, 3057311.

O’Meara,B.C. (2012) Evolutionary Inferences from phylogenies: a review of
methods. Annu. Rev. Ecol. Syst., 43, 2677285.

Paradis,E. et al. (2004) APE: analyses of phylogenetics and evolution in R language.
Bioinﬁ)rmatics, 20, 2897290.

Phillimore,A.B. and Price,T.D. (2008) Density—dependent cladogenesis in birds.
Plos Biol, 6, e71.

Pybus,O.G. and Harvey,P.H. (2000) Testing macroaevolutionary models using
incomplete molecular phylogenies. Proc. R. Soc. Lond. B Biol. Sci, 267,
22677272.

Quental,T.B. and Marshall,C.R. (2009) Extinction during evolutionary radiations:
reconciling the fossil record with molecular phylogenies. Evolution, 63,
315873167.

Rabosky,D. (2006) Likelihood methods for detecting temporal shifts in diversiﬁca—
tion rates. Evolution, 60, 115271164.

Rabosky,D.L. (2009) Heritability of extinction rates links diversiﬁcation patterns
in molecular phylogenies and fossils. Syst. Biol, 58, 6297640.

Rabosky,D. and Lovette,I. (2008) Explosive evolutionary radiations:
decreasing speciation or increasing extinction through time? Evolution, 62,
186C1875.

R Core Team. (2012) R: A Language and Environment for Statistical Computing.
R Foundation for Statistical Computing, Vienna, Austria. htpp://www.
R—project.org (18 April 2013, date last accessed).

Ricklefs,R. (2007) Estimating diversiﬁcation rates from phylogenetic information.
Trends Ecol. Evol., 22, 601$10.

Robert,C.P. et al. (2011) Lack of conﬁdence in approximate Bayesian computation
model choice. Proc. Natl Acad. Sci, 108, 15112715117.

Soetaert,K. et al. (2010) Solving differential equations in R: Package deSolve.
J. Stat. Softw., 33, 1725.

Sokal,R. and Michener,C. (1958) A statistical method for evaluating systems
relationships. Univ. of Kans. Sci. Bull, 38, 140%1438.

Stadler,T. (2011) Simulating trees with a ﬁxed number of extant species. Syst. Biol,
60, 676$84.

Thompson,E. (1975) The Likelihood Approach. Human Evolutionary Trees.
Cambridge University Press, Cambridge.

Yang,Z. and Rannala,B. (1997) Bayesian phylogenetic inference using
DNA sequences: a Markov Chain Monte Carlo method. Mol Biol. Evol., 14,
7177724.

APPENDIX A

I give here a short version of the proof of the joint probability
density of all speciation times of a reconstructed tree. First, let
me restate the probability of obtaining exactly one species at time
T with T > t. At any given time s, t<s< T the number of species
could be between one and inﬁnity; however, all but one species
must go extinct until time T (Thompson, 1975):

P(N(T) = 1 |N(l) = 1)
00 k X P(N(s) = k|N(t) = 1) X P(N(T) = 1 |N(s) = 1)

k_1
>4HMD=0mm=1N4
(A. 1)

The factor k arises because any of the k currently alive species
could survive until the present and we need to consider each
possibility.

Let us transform the reconstructed tree from Figure 1 into a
set 0113131101168 b = {{10, ll}, {11, 12}, {11, 13}, {12, 14}, {12, T}, {13, T},
{t3,T},{t4, T},{t4,T}}. There are two types of branches, those
that end at a speciation event and those that end at the sampling
time T. The probability density of a branch that ends at the
present time is simply the probability of starting with one species
and observing exactly one species

P({tr. 1)) = P(N(T) = 1 |N(t.~) = 1) (A2)

The probability of any other branch starting at time ti and
ending at a speciation event at time tj is given by the prob—
ability that there were k species at time tj, one of these
speciated with probability kMti), this species survived but all
other k—l species went extinct before the present time:

ziikxMmeMﬂ=kmmd=U (A3
k:l

MHMD=MMW=WH

 

1 373

ﬁm'spzumofpmjxo'sopeuHOJmorq/pdnq

S.H6hna

 

If we multiply the equation by P(N(T) = 1 |N(t,-) = 1)/P(N(T) =
1 |N(t,«) = 1), we can see that we get exactly Equation (A1)

00

Pwmn=UHMD=HMm=ufythxnmm

1.»:1
= k|N(l.-) = 1) >< (P(N(T) = 0 | N01) = 1))k_1 X P(N(T)
= 1 WW = 1) = 10.) X P(N(T)
=1|N(li)=1)/P(N(T) =1|N(l/)= 1)
(A.4)
Finally, by multiplying the probability densities of all branches

together, we obtain the probability density of the reconstructed
tree

P(b) = n I101) >< P(N(T) = 1 WW = 1)/P(N(Y)

Vb, [173T

=Hmo=uxflnmo=umm=u

Vb, tj=T

nil
=HMD=Hmm=ufUmHMD=Hmm=U
i=1
(A5)

The probability density of all branches P(b) is equivalent
to the probability density of all branching times [Equation (6)].

 

1 374

/310'S[BHmOIpJOJXO'SOIJBLUJOJIIIOICIH201111]

