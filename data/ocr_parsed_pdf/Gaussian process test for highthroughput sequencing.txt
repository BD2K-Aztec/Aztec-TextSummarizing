Bioinformatics, 31 (1 1), 2015, 1762—1770

doi: 10.1093/bioinformatics/btv014

Advance Access Publication Date: 21 January 2015
Original paper

 

Genetics and population analysis

Gaussian process test for high-throughput
sequencing time series: application to
experimental evolution

Hande Topa1'*"’, Agnes Jonasz'3'*"’, Robert Koflerz, Carolin Kosio|2'*
Antti Honkela4'*

1Helsinki Institute for Information Technology (HIIT), Department of Information and Computer Science, Aalto
University, Espoo, Finland, 2Institut fiir Populationsgenetik, Vetmeduni Vienna, 1210 Wien, Austria, 3Vienna
Graduate School of Population Genetics, Wien, Austria and 4Helsinki Institute for Information Technology (HIIT),
Department of Computer Science, University of Helsinki, Helsinki, Finland

*To whom correspondence should be addressed.
TThe authors wish it to be known that, in their opinion, the first two authors should be regarded as Joint First Authors.
Associate Editor: Alfonso Valencia

Received on March 13, 2014; revised on November 7, 2014; accepted on January 7, 2015

Abstract

Motivation: Recent advances in high—throughput sequencing (HTS) have made it possible to moni—
tor genomes in great detail. New experiments not only use HTS to measure genomic features at
one time point but also monitor them changing over time with the aim of identifying significant
changes in their abundance. In population genetics, for example, allele frequencies are monitored
over time to detect significant frequency changes that indicate selection pressures. Previous at—
tempts at analyzing data from HTS experiments have been limited as they could not simultan—
eously include data at intermediate time points, replicate experiments and sources of uncertainty
specific to HTS such as sequencing depth.

Results: We present the beta—binomial Gaussian process model for ranking features with signifi—
cant non—random variation in abundance over time. The features are assumed to represent propor—
tions, such as proportion of an alternative allele in a population. We use the beta—binomial model
to capture the uncertainty arising from finite sequencing depth and combine it with a Gaussian pro—
cess model over the time series. In simulations that mimic the features of experimental evolution
data, the proposed method clearly outperforms classical testing in average precision of finding se—
lected alleles. We also present simulations exploring different experimental design choices and re—
sults on real data from Drosophila experimental evolution experiment in temperature adaptation.
Availability and implementation: R software implementing the test is available at https://github.
com/handetopa/BBGP.

Contact: hande.topa@aalto.fi, agnes.jonas@vetmeduni.ac.at, carolin.kosiol@vetmeduni.ac.at,
antti.honkela@hiit.fi

Supplementary information: Supplementary data are available at Bioinformatics online.

 

©The Author 2015. Published by Oxford University Press.

 

1762
This is an Open Access article distributed under the terms of the Creative Commons Attribution License (http://creativecommons.org/Iicenses/by/40/I, which permits
unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.

112 /3.10'speum0[p1q1x0"sotquJOJutotq/ﬁduq 11101} popcolumoq

9103 ‘Og anﬁnv 110 ::

Gaussian process test for high—throughput sequencing time series

1763

 

1 Introduction

Most biological processes are dynamic and analysis of time series
data is necessary to understand them. Recent advances in high—
throughput sequencing (HTS) technologies have provided new
experimental approaches to collect genome—wide time series. For
example, experimental evolution now uses a new evolve and re—
sequencing (ER) approach to understand which genes are targeted
by selection and how (Burke and Long, 2012; Kawecki et (11., 2012).
Such experiments enable phenotypic divergence to be forced in re—
sponse to changes in only few environmental conditions in the la—
boratory while other conditions are kept constant. The evolved
populations are then subjected to HTS.

Experimental evolution in microorganisms has focused on the
fate new mutations. For example, in Escherichia coli (Barrick et (11.,
2009) and Sacc/oaromyces cerevisae (Lang et (11., 2013) new muta—
tions were studied. In contrast, ER experiments with sexually repro—
ducing multicellular organisms address selection on standing
variation and allele frequency changes (AFCs) in small populations
where drift plays an important role. For example, for Drosophila
melanogaster (Dmel), several phenotypic traits, such as accelerated
development (Burke et (11., 2010), body size variation (Turner et (11.,
2011), hypoxia—tolerance (Zhou et (11., 2011) and temperature adap—
tation (Orozco—terWengel et (11., 2012) have been investigated.
Motivated by these experimental studies, we believe that experimen—
tal evolution combined with HTS supplies a good basis for studying
AFC through time series molecular data.

To perform allele frequency comparisons, pairwise statistical
tests between base and evolved populations were typically carried
out. Burke et al. (2010) combined Fisher’s exact tests with a sliding—
window approach to identify genomic regions that show allele fre—
quency differences between populations selected for accelerated de—
velopment and controls without direct selection. Turner et al.
(2011) developed a pairwise summary statistic, called ‘diff—Stat’ to
estimate the observed distribution of allele frequency differences and
compared this to the expected distribution without selection.
Orozco—terWengel et al. (2012) identify single nucleotide polymor—
phisms (SNPs) with a consistent AFC among replicates by perform—
ing a Cochran—Mantel—Haenszel test (CMH) (Agresti, 2002). The
latter is an extension of the Fisher’s exact test to multiple replicates.
All aforementioned statistical methods are based on pairwise com—
parisons between the base and evolved populations and they do not
take full advantage of the time series data now available. Bollback
et al. (2008) developed a method to analyze time series data based
on population genetic models and estimated the effective population
size Ne of a bacteriophage from a single locus. Illingworth et al.
(2012) derived a model for time series data from large populations
of microorganisms (N, z 108) where drift can be ignored and the
population allele frequencies evolve ‘quasi—deterministically’. Here,
we propose an alternative Gaussian process (GP) based approach to
study AFCs over the entire time series experiment genome—wide for
small populations (Ne w 102 — 103).

GP is a non—parametric statistical model that is extremely well
suited for modelling HTS time series data, which usually have rela—
tively few time points that may be irregularly sampled. Recently,
there have been some works applying GP models with parameters
describing the process of evolution (e.g. Jones and Moriarty, 2013
account for phylogenetic relationships, Palacios and Minin, 2013
for effective population size). GPs have also recently been applied to
gene expression time series by a number of authors (Aijé et (11.,
2013; Cooke et (11., 2011; Gao et (11., 2008; Hensman et (11., 2013;
Honkela et (11., 2010; Kalaitzis and Lawrence, 2011; Kirk and

Stumpf, 2009; Liu et (11., 2010; Liu and Niranjan, 2012; Stegle et (11.,
2010; Titsias et (11., 2012; Yuan, 2006). In differential analysis, GPs
have been applied to detect differences in gene expression time series
in a two—sample setting by Stegle et al. (2010) and for detecting sig—
nificant changes by Kalaitzis and Lawrence (2011). Although these
methods provide a sensible basis for detecting the changing alleles,
they fail to properly take into account all aspects of the available
HTS data, such as differences in sequencing depth between different
alleles and time points. These differences can have a huge impact in
the reliability of different measured allele frequencies and taking
them into account is vital for achieving good accuracy with the
available short time series.

2 Methods

To identify the candidate alleles which evolve under selection, we
model the allele frequencies by GP regression. We fit time—dependent
and time—independent GP models and rank the alleles according to
their corresponding Bayes factors (BFs), i.e. the ratio of the marginal
likelihoods under the different models.

GPs provide a convenient approach for modelling short time ser—
ies. However, when applying them to a large number of short paral—
lel time series as in many genomic applications, naive application
leads to overfitting or underfitting in some examples. Although these
problems are rare, the bad examples can easily dominate the rank—
ing. We overcome these challenges by excluding non—sensical param—
eter values, for example using a good variance model that can be
incorporated into the GP models.

2.1 Data and preprocessing

In the following, we use the term SNP for the markers and alleles
under study, but the methods can be applied to any features whose
abundance can be quantified in a similar manner. We consider SNPs
that are bi—allelic for a specific position of the genome in a popula—
tion. Multi—allelic SNPs, however, exist but are rare and likely to be
sequencing errors (Burke et (11., 2010). Multi—allelic cases can be
treated by simply ignoring the least frequent allele or transformed
to bi—allelic site by summing up the frequencies of the most
infrequent alleles. Here, we assumed that only two of the alleles
from (A, T, C, G) can be observed at each SNP position. After deter—
mining the abundances of these two specific alleles, we model
the time dependency of the rising allele’s frequency over several
generations. We will refer to generations as time points for
simplicity.

We denote the replicate index of each observation by r,- and the
time point by t,, j : 1, . . . ,], with] denoting the total number of ob—
servations. For each of these points, we assume HTS reads have
been aligned to a reference genome with y,,- reads with a specific al—
lele at SNP position i. We use m,- to denote the total sequencing
depth at the position.

2.2 Mean and variance inference: beta—binomial model
We model 31,-,- as a draw from a binomial distribution with param—
eters 71,-,- and 17,7:

yiiIniir 1717 ~ Bin(nijr 1717)) (1)

where 17,-,- denotes the frequency of the specific allele in the popula—
tion. We set a uniform Beta(1,1) prior on 17,7:

piiIutﬁN Beta(“7ﬁ)7 

whereor:1,/)’:1.

112 /310'S[BIIJHO[pJOJXO'SOIJ’BLUJOJIIIOICI”Idllq 11101} popcolumoq

9103 ‘Og anﬁnv 110 ::

1764

H. Topa et al.

 

Since beta prior is conjugate to the binomial likelihood, the pos—
terior distribution will also be a beta distribution:

pil'IyiirniirarﬁN Beta(“Z’rﬁZ’L 
where
 I 0‘ + yiir
I}; I I), +7117 — 3’17-

Then, the posterior mean and variance of 17,-,- can be calculated as
follows:

*

 

on or + y--
“Pi/"Winner 067/3) I My... lbw: : a + I): +17%. (4)
z/ z/ * ,,
V3r(piinii7ni/'7 0!) If) I 
(“17+ ﬁij) (“17+ ﬁij ‘I' 1) (5)

2 (M + yii)(/)’ + "ii — 3’27) .
(«+li+n,-,-)2(oc+/i+m,- + 1)

The inferred posterior means and posterior variances are used to fit
the GP models as described in the following sections. As the results
will show, this step is very important for incorporating the available
uncertainty information into the GP models by taking into account
different sequencing depths. For example, beta—binomial model as—
signs larger variances to the alleles with lower sequencing depths
(Fig. 1). Moreover, the Beta(1,1) prior on 17,-,- leads to a symmetry in
the posterior mean and variance. Therefore, the result of our method
is not affected whichever allele is chosen from the alternative alleles.

2.3 GP regression
A GP is a collection of random variables, any finite number of which
has a joint Gaussian distribution. We write

W) N 9P(m(t)rK(trt’)) (6)

to denote that f(t) follows a GP with mean function m(t) : 
and covariance function K(t,t’) :  —  — 
We let y : (yi)§:1 be a vector of the noisy observations measured at
points I : (will satisfying

yi:f(ti)+er 

where e is Gaussian observation noise with zero mean and a diag—
onal covariance matrix 2.. To simplify the algebra, we assume the
mean function m(t) : 0 and subtract the mean of y.

 

 

 

 

 

 

 

 

 

C 0.2 - - - - - -- n=1o -
.g — — — n=30
(5
.S n=60
g 0.15 . V I I I . . H -
'9 . ‘ ‘ I
<5 . ' .
U . ‘ I I ' I
g 0.1   -
m y ’ , —— — — — _‘ \ g
.5 / ’ \ \
‘- /
g 0.05 / \ \-
O
n.
o I I I I
0 0.2 0.4 0.6 0.8 1
Frequencies

Fig. 1. Posterior standard deviations of the allele frequencies with sequencing
depths 10, 30 and 60

Gaussian processes allow marginalizing the latent function to
obtain a marginal likelihood. The covariance function K and the
noise covariance 2. depend on hyperparameters 0 that can be esti—
mated by maximizing the log marginal likelihood:

1 _
10g(z>(ylt7 0)) = -§yTlK(t7t) + Eel 1y
1 N (8)
— ZIOgIK(L t) + Eel — zlogaﬁ)

where K(t, t) denotes the covariance matrix constructed by evaluat—
ing the covariance function at points I. It is also possible to compute
the posterior mean and covariance at non—sampled time points t*,
given the noisy observations y at sampled time points I. This is often
useful for visualization purposes. We obtain (Rasmussen and
Williams, 2006):

f*IyNN(m*72*)7 (9)
where

m = Elﬁlyl = K(t*rt)l1<(trt) + Eel‘lyr
2. : K(t., I.) — K(t.,t)11<(t,t) + 2.1—11m, a).

In our GP models, we use the squared exponential covariance
matrix to model the underlying smooth function. The squared expo—
nential covariance

K5E(t, t’) : alge(_“—;I;i) (10)

has two parameters: the length scale, I, and the signal variance, 
Length scale specifies the distance beyond which any two inputs be—
come uncorrelated. A small length scale means that the function
ﬂuctuates very quickly, whereas a large length scale means that the
function behaves like a constant function. Three example real—
izations generated with squared exponential covariance matrix can
be seen in Figure 2a.

In the standard GP model, the observation noise is assumed to be
white: the noise at different time points is independent and identi—
cally distributed. The corresponding covariance matrix

zfzzwzaﬁr (11)

is an identity matrix multiplied by the noise variance parameter, 
Three example realizations generated with white noise covariance
matrix can be seen in Figure 2b.

2.4 Beta—binomial Gaussian process

The beta—binomial Gaussian process (BBGP) method combines beta—
binomial model with the GP model in the sense that the posterior
means and posterior variances of the frequencies, which are inferred
by beta—binomial model, are used to fit the GP model by means of

 

 

 

 

 

 

 

 

 

 

 

(a) (b) c)
r:r r:r
 I] O** :1
\ I." *ngggoﬂé m 0 **
\Jl 058*0 03.6% BOﬁﬁﬁauo
*o O on
KSE 2W ZFBB

Fig. 2. Example realizations from GPs and noise processes with different co-
variance structures

112 /310's1cu1noip101x0"sotwurJOJutotq/ﬁduq 11101} pap1201umoq

9103 ‘0g anﬁnv uo ::

Gaussian process test for high—throughput sequencing time series

1765

 

an additional noise covariance matrix which we call fixed beta—
binomial (FBB) covariance matrix.
Returning to Section 2.2, let us denote the posterior mean and

variance of 17,-,- by m,,- and 5%,, respectively. That is,
"127' : E(piini/'7 "177 017/3) (12)
5%," : Var(piiniirni/'7 “7 I0- (13)

To fit the BBPG model, we assume
mii:ﬁ(ti)+ﬂmi+ev 

where  ~ 973(0, K5E(t, t’)) and e N N(0, 2W + EFBB). The
mean pm, is eliminated by subtracting the mean from m,,-. Because
of EFBB this is an approximation that may fail if 71,-,- vary signifi—
cantly, but it speeds up inference significantly. The additional
covariance

EFBB : diag(s§i) (15)

is a diagonal FBB covariance matrix which is used to include known
variance information for each observation in the GP model. The
elements of 21:13]; are determined by the posterior variances which
are inferred from beta—binomial model in Section 2.2. Three ex—
ample realizations generated with FBB covariance matrix can be
seen in Figure 2c, where larger variance values were inferred for the
later time points.

2.5 BBGP—based test
We fit the ‘time—dependent’ BBGP model of Equation (14) and a
‘time—independent’ model without the GP term fi(t,-) for each SNP i.
As can be seen from the graphical models in Figure 3, ‘time—inde—
pendent’ model assumes that the observations are randomly gener—
ated around a constant mean with no temporal dependency,
whereas ‘time—dependent’ model captures the dependency between
the observations by the function fi(t), which follows a GP with the
squared exponential covariance function. Thereby the parameters of
the squared exponential covariance [K5E, Equation (10)] in the time—
dependent model and the white noise covariance [2% Equation
(11)] in both models are fitted by maximizing the marginal likeli—
hood. The FBB covariance [21:33, Equation (15 )] does not contain
any free hyperparameters. If the model is actually time independent,
the length scale in the squared exponential covariance is estimated
to be very large, which makes the maximum likelihood of the time—
dependent model equivalent to that of time—independent model.
Figure 4 shows an example of the time—dependent (left) and time—
independent (right) BBGP models.

We maximize the log marginal likelihood functions for the mod—
els by scaled conjugate gradient method using the ‘gptk’ R package

 

Time—dependent model

Trme—independent model

Fig. 3. Graphical models for the (a) time-dependent and (b) time-independent
BBGP models

by Kalaitzis and Lawrence (2011). We use a grid search over the
parameter space and initialize the parameters to the grid value with
highest likelihood. We also set a lower bound equal to the shortest
spacing between observations for the length scale parameter to
avoid overfitting.

We compute the BF for SNP i as (Kalaitzis and Lawrence, 2011;
Stegle et al., 2010)

p(m,l01, “time—dependent model”)

BF,- : (16)

 

p(m,l02, “time—independent model”) I

where 01 and 02 contain the maximum likelihood estimates of the
hyperparameters in the corresponding BBGP models. BFs indicate
the degree of the models to be ‘time dependent’ rather than ‘time
independent’.

2.6 CMH test
We compare BBPG against the CMH test, which was used by
Orozco—terWengel et al. (2012) to identify alleles with consistent
AFC across replicates. The CMH test has been proven to be the
best—performing test statistic applied on HTS evolutionary data so
far (Kofler and Schlotterer, 2014). Therefore, we take it as the basis
of comparison with BBGP.

CMH allows to test whether the joint odds ratio of replicated
(r : 1,  ,R) allele counts in a 2 X 2 X R contingency table
(Table 1) is significantly different from one. Significant deviation
from one implies dependence of allele counts between two time
points that is consistent among replicates. The CMH tests pairwise
observations of the two alternative allele counts 31(1)

,7- and 31572). In our
bi—allelic case 31(1) *

il- — y,,- and 31572) : 71,-,- — 3),). To compare the counts
for all replicates r : 1, .. . ,R at the base (B) and the end (E) time
points for each SNP position i, we denote B, : {/Iti : B, r,- : r} and
E, : {/Iti : E,r,- : r}. The CMH test statistic [see Agresti (2002)
and Supplementary Text Section S1] compares the cell counts in
Table 1 to their null expected values and it follows a chi—squared dis—
tribution with one degree of freedom Xﬁdfﬂ). We performed CMH
tests on the simulated and real data for each SNP position independ—
ently, using the implementation of the software PoPoolation2
(Kofler et al., 2011).

2.7 Simulations
To evaluate the performances of the BBGP and the CMH tests, we
simulated data that mimic the dynamics of evolving Dmel

06 0.8 10

 

Frequencies
0.4 .
“glib—I

Frequencies

Log—likelihood: 11.71

Log—likelihood: 1.01

0.2

0.0

0 15 23 27 37 0 15 23 27 37
Time Time

Time—dependent model:
ml}:   rumr + 6

Time—independent model:
my = ,uml. + 6

Fig. 4. BBGP fits for the time-dependent and time-independent models for an
example SNP taken from the real dataset (Orozco-terWengel et al., 2012).
Confidence regions are shown for: 2 standard deviation. Similarly, error
bars indicate :r 2 standard deviation (from FBB) interval. Replicates at the same
time points are shifted by 0.5 for better visualization. Maximum likelihood
estimates of the parameters: (91 : {Z : 15.53, 0:? : 0.05, 0?, : 3.6 X 10’s};
(92 : {02 : 0.05}

112 /310's1cu1noip101x0"sotwurJOJutotq/ﬁduq 11101} pap1201umoq

9103 ‘0g anﬁnv uo ::

1766

H. Topa et al.

 

Table 1. 2x2 contingency table of allele counts for the r-th
replicate

 

 

Base generation (B) End generation (E) Z

. 1 1 1
SNP 1 allele 1 yf-BE yI-E) yl,’
. 2 2 2
SNP 1 allele 2 yf-B} yI-E) yl,’
2 "1'3, 71115, 711.,

 

populations at the genomic level. For this aim, we first simulated
three sets of genome—scale data to evaluate the overall performances
of the methods under the experimental design which is close to the
natural settings. Additionally, we also carried out smaller size simu—
lations on one chromosome arm to investigate the further inﬂuences
of different parameter settings on the methods.

2.7.1 Whole-genome simulations

We carried out forward Wright—Fisher simulations of genome—wide
allele frequency trajectories of populations using the MimicrEE
simulation tool (Kofler and Schlotterer, 2014). The initial haplotypes
were taken from Kofler and Schlotterer (2014), and they capture the
natural variation of Dmel population. By sampling from the initial
set, we established r25 replicated base populations using H :200
founder haplotypes and let each of them evolve for g:60 gener—
ations at a constant census size of N: 1000. We used the spatially
varying recombination rate defined for Dmel by Fiston—Lavier et al.
(2010). Low recombining regions were excluded from the simula—
tions because of the elevated false—positive rate in these regions
(Kofler and Schlotterer, 2014). We followed the evolution of the
total number of 19 39 941 autosomal SNPs among which 100 were
selected with selection coefficient of 520.1 and semi—dominance
(1720.5). Furthermore, we required the selected SNPs to have a
starting frequency in the range [0.12, 0.8], not to lose the minor allele
in the course of time due to drift. We recorded the nucleotide
counts for every second generation and performed Poisson sampling
with 2:45 (overall mean coverage in Orozco—terWengel et al.,
2012) on the count data to produce coverage information (see
Supplementary Text Section S2). We repeated the whole simulation
experiment three times, each time using a different set of selected
SNPS.

2.7.2 Single-chromosome-arm simulations

For experimental design, additional simulations were carried out on
a single chromosome arm (~16 Mb) with 25 selected SNPs to assess
the performance under various parameter combinations, such as
population size (N), number of founder haplotypes (H), selection co—
efficient (s), level of dominance (17), number of generations (g) and
number of replicates (r). We defined a basic set up with parameter
space close to that of the whole—genome simulations, i.e.
N : 1000,H : 200,r : 5,g : 60,5 : 0.1,]7 : 0.5, and investi—
gated the effect on the performance when only one parameter is per—
turbed from its basic value.

2.8 Evaluation metrics

The methods were evaluated based on precision, recall and average
precision (AP) (Manning et al., 2008). Precision and recall are com—
monly used metrics to measure the fraction of relevant items that
are retrieved when comparing ranking based methods. Precision and
recall are defined as

 

7 number of selected SNPs in [2 top SNPs

 

pre(k) k , (1 7)
7 number of selected SNPs in [2 top SNPs
red/2) _ number of selected SNPs I1 8)

The curve obtained by plotting the precision at every position in the
ranked sequence of items as a function of recall is called the preci—
sion—recall curve. The area under the curve can be summarized using
AP (Manning et al., 2008), which is defined as the average of pre(k)
after every returned selected SNP:

N
Z(Pfe(k)1lsel(k))
7 13:1
aveP _ number of selected SNPs I I1 9)

where N is the total number of SNPs and

1, if item at rank [2 is a selected SNP,
IIsel(k) : 

0, otherwise.

3 Results

3.1 Simulated whole—genome data

We applied the BBGP and CMH on the genome—wide simulated
data with different numbers of time points (i.e. generations) and rep—
licates. To evaluate the effect of the number of time points used, we
tested the method using subsets of different sizes of the nine time
points {0, 6, 14,22, 28, 38, 44,50, 60} (see Supplementary Text
Section S3 for details). We performed BBGP separately for each of
the sampling schemes while CMH can only use two time points (first
and last). All simulated SNPs were scored using BFs for the BBGP,
and P—values for the CMH test (e.g. see Supplementary Fig. S1 for a
graphical visualization of the scores).

To investigate the effect of the number of replicates (r), we chose
up to five replicates at each sampled time point. We first performed
CMH tests with all possible r—replicate combinations. We then
applied BBGP only to the best performing replicate combinations of
each size according to AP in the CMH evaluations. This strategy en—
sures a fair comparison between the methods as BBGP is always
evaluated against the best CMH results. We also compared BBGP to
the standard GP of Kalaitzis and Lawrence (2011) that does not use
the FBB model variances using the same replicate combinations as
BBGP with 6 time points.

As shown in Figure 5 (see also Supplementary Figs. S2 and S3),
BBGP achieves a higher AP than the standard GP and the CMH.
Somewhat surprisingly, CMH seems to benefit very little from more
replicates while the performance of the GP methods improves no—
ticeably. The CMH is sensitive to the specific replicates included, as
including the fifth replicate in the optimal sequence actually leads to
worse performance than four replicates (Supplementary Fig. S3c and
d). We did not observe similar behaviour with the GP methods. On
average over all possible r—replicate combinations, adding more rep—
licates helps the CMH as well (mean AP in Fig. 5). The performance
of the standard GP approaches that of BBGP as the number of repli—
cates increases, which is consistent with the view that the stronger
prior information from sequencing depth is most important when
the data are otherwise scarce, as is often the case in real experiments.
In contrast to more replicates, adding more time points improved
BBGP’s performance very little (Fig. 5).

We also investigated whether the two methods identify different
types of selected SNPs. We calculated AFC for each SNP based on
the average difference between the base and end populations across

112 /310's112u1n0[p101x0"sotJBurJOJutotq/ﬁduq 11101} pap1201umoq

9103 ‘0g anBnV uo ::

Gaussian process test for high—throughput sequencing time series

1767

 

replicates. The CMH is sensitive to large AFCs, while the candidates
detected by the BBGP have a much more uniform distribution of
AFCs (Supplementary Fig. S5). In general, we would expect a uni—
form distribution of AFCs, as very large AFCs are only possible for
SNPs with low starting frequency giving them the potential to rap—
idly increase. BBGP is much more accurate than CMH in all AFC
classes as demonstrated by the performance breakdown in
Supplementary Figure S6.

Furthermore, we performed a generalized CMH test (gCMH)
that can be applied to more than two time points but requires a
weighting scheme (Supplementary Text Section S1.1). As there is no
straightforward way to find weights that accurately reﬂects natural
selection, we used mid—ranks assigned to time points. The perform—
ance of the gCMH drops rapidly with increasing the number of time
points and replicates (Supplementary Fig. S7), which might be due
to a poor weighting scheme.

The performance of the methods can vary noticeably between
different experiments depending on their difficulty. For example,
there is a 10—fold difference in AP between Experiment 1 and
Experiment 3 for both methods (Supplementary Fig. S4, see also
Kofler and Schlotterer (2014) for the CMH), but the BBGP—based
test consistently outperforms the CMH test.

The running time needed to analyze 1000 SNPs in a 4—replicate
6—time point setting is $30 min on a desktop running Ubuntu 12.04
with Intel(R) Xeon(R) CPU E3—1230 V2 at 3.30 GHZ.

3.2 Influence of parameter choice
For the purpose of experimental design, we investigated further par—
ameter settings on the single chromosome arm of 2L.

3.2.1 Population size and number of founder haplotypes

In finite populations, genetic drift has a large impact on shaping the
population allele frequencies. We studied the effect of census popu—
lations size (N) and the number of founder haplotypes (H). H can be
thought as the number of different individuals (isofemale lines) in
the base population. The populations were established by randomly
choosing N individuals with replacement out of the H founders. The
simulation results show that AP increases with increasing N

 

 

  
 

 

 

 

008 + BBGP, t=9
+ BBGP, t=6
E BBGP, t=3
-% 006 — 9(- — GP, 1:6
'3 ---v u CMH
‘6. "'O -‘ CMH (mean AP)
3%. 0.04 - —+- - Random
33
<

0.02 _.

 

 

 

Number of replicates

Fig. 5. APs for CMH, BBGP and standard GP with different number of repli-
cates (r) and time points (I) in the whole-genome simulation. The best-per-
forming r—replicate combination in the CMH test has been used in GP and
BBGP, and the mean AP for CMH has been computed by taking the mean of
the APs over all r—replicate combinations for r: 2,3,4,5. The corresponding
precision—recall curves are shown in Supplementary Figures 82 and 83.
Additionally, average AP for random ranking (line of no discrimination) is
shown by a constant line at the true fraction of selected SNPs in the simulated
data, i.e. 100/1,939,941 w 5 410’5

(Fig. 6a). This has also been observed by Kofler and Schlotterer
(2014) for the CMH test. The AP is the highest with the ratio of H /
N : 0.5 in all cases (Fig. 6a, Supplementary Figs. S8—S10) and the
BBGP consistently outperforms the CMH test. Kofler and
Schlotterer (2014) reported that the true—positive rate for CMH test
increases with H but the increment levels off with H /N : 0.5 for
N: 1000. Baldwin—Brown et al. (2014) detected a constant increase
in the power to localize a candidate SNP; however, they used a dif—
ferent method and investigated different parameter settings not com—
parable to ours. We hypothesize that as more low—frequency
variants are present in the population with H /N > 0.5, the selected
SNPs with multiple linked backgrounds are competing with each
other, resulting in an AP drop.

3.2.2 Selection strength and level of dominance

We investigated the performance using various selection coefficients
(5) and fixed semidominance (17 : 0.5). For moderate and strong se—
lection (s>0.01), the BBGP outperforms the CMH test (Fig. 6b,
Supplementary Fig. S11). The BBGP reaches the highest precision at
s : 0.1, whereas the CMH test is the most precise at s : 0.05 which
is consistent with Kofler and Schlotterer (2014). For strong selection
(5202) the precision drops for both methods. The performance
decay is presumably due to interference between selected sites,
known as the Hill—Robertson effect, i.e. linkage between sites under
selection will reduce the overall effectiveness of selection in finite
populations (Hill and Robertson, 1966). Also, we hypothesize that
long—range associations become more apparent as the strength of se—
lection increases (Supplementary Fig. S12) resulting in larger blocks
rising in frequency together, which was also observed by Tobler
et al. (2014).

For weak selection ($30.01), it becomes hard to distinguish be—
tween selection and drift in small populations. Thus, for low 5, both
methods perform rather poorly and the CMH has a slightly higher
AP in these cases. However, for a more ideal parameter choice of N
: 5000, H : 2500 and a long runtime of the experiment (g: 120),
the BBGP gains a large performance improvement over the CMH

 

 

 

 

 

 

 

 

 

(a)
540
150
m 40
e \
>< 10 0' 9 —o_ e
D.
<
1 . . r . r r . r . . r . r . . r . r . . r . r r . r . . r . r . . r . r
002 0.05007 0.1 0.14 0.2

 

Population size

 

 

+ BBGP
— 9 — CMH

m

 

 

 

—N-bm

o_3e-eee<>-o—o—o-o-eeeeo

 

 

 

 

 

 

23455739101112131415 30 so 120
Y 9

Number of replicates Time points and spacing

Fig. 6. APs for different experimental designs. AP for random ranking is
shown in (b) by a constant line at the true value of the ratio of selected SNPs
in the simulated data, i.e. 25/496,611 w 5 *10’5. Log scale was used on both
axes for (a), (b), (d) and on the y—axis for (c). Other parameters are as in the
basic setup in Section 2.7

112 /310's112u1n0[p101x0"sotJBurJOJutotq/ﬁduq 11101} pap1201um0q

9103 ‘0g anBnV uo ::

1768

H. Topa et al.

 

test for s : 0.01 (see Supplementary Figs. S13 and S14) even in the
difficult scenario of weak selection.

We also simulated evolving populations using different levels of
dominance (la). The following relative fitness values were used on
genotypes AA, Aa and ad: wAA : 1 +5, 1154,, : 1 + 175, WM: 1,
where s: 0.1. As 17 varies, we observed different behaviour of the
methods. The AP of the CMH test increases as we are moving from
complete recessivity (17 : 0, recessive phenotype is selected) to com—
plete dominance (17 : 1, dominant phenotype is selected)
(Supplementary Figs. S15 and S16). Selection on completely reces—
sive allele results in a gradual initial change in AF with more rapid
change in later generations and eventual fixation. In contrast, the
change in AF of a completely dominant allele is initially rapid but
never reaches fixation as the recessive allele is shielded from natural
selection in the heterozygote. When the fitness of the heterozygote is
intermediate between the two homozygotes (additivity, 17 : 0.5) the
allele frequency trajectory is the combination of the aforementioned
ones, i.e. rapid initial change and quick fixation. BBGP reaches the
highest AP with the additive scenario and relatively high AP in the
recessive case (Supplementary Fig. S15). When the dominant pheno—
type is selected (17 ~ 1) and the unfavoured allele stays present in the
population at low frequency, it is likely to result in an inconsistent
behaviour of replicates, which lower the power of the BBGP.

3.2.3 Number of replicates

In addition to the whole—genome experiments with a maximum of
five replicates, we simulated up to r: 15 replicates for the single
chromosome arm. We observed a constant increase in performance
for the BBGP up to r: 6 (Fig. 6c, Supplementary Fig. S17). The AP
kept increasing up to r: 12 but rather in a ﬂuctuating manner and
then dropped with adding even more replicates. Consistently with
the whole—genome simulations, we did not observe a large perform—
ance improvement with increasing the number of replicates for the
CMH test.

3.2.4 Length of the experiment and spacing of the samples

We also examined the performance with increasing the length of the
experiments up to g : 120 generations. For longer experiments,
more recombination events can happen, which uncouples linked
sites letting them evolve independently. The AP rises rapidly for lon—
ger experiments (Fig. 6d, Supplementary Fig. S18). Thereby the per—
formance gain is noticeably higher for the BBGP. We also

 

 

(a) 8'
E _'
In -"
N
E 8
9
D'- 1"—
5'
.-
8’ 0
ID
a .
x '21. 2R 3L 3R 4
Chromosome

Genomemwide distribution of CMH -log(p-values).

 

investigated the spacing of the sampled time points (t E {3, 6, 9}) for
the BBGP and observed similar pattern that of the whole—genome
simulations, i.e. an intermediate number of sample time points is
sufficient as shape of selected trajectories is simple.

3.3 Real data application

Orozco—terWengel et al. (2012) applied ER methods on Dmel popu—
lations adapting to elevated temperature regime. They established
base populations from isofemale lines collected in Portugal. The
populations were propagated at a constant size of 1000 for 37 gen—
erations under ﬂuctuating temperature regime (12h at 1 8°C and 12h
at 28°C). DNA pools of 500 females (Pool—Seq) were sequenced at
the following time points: three replicates at the base generation 0
(B); two replicates at generation 15, an additional replicate at gener—
ation 23 and 27; three replicates at the end generation 37 (E).

CMH tests were performed on a SNP—wise basis to identify sig—
nificant AFCs between the B and E populations [see Orozco—
terWengel et al. (2012) and Supplementary Text Section S4]. We
applied the BBGP method on 12 57 117 SNPs and compared the re—
sults with that of the B—E comparison of the CMH test. The overlap
between the top 2000 candidate SNPs of the CMH and the BBGP
was rather small (609 SNPs). However, the peaks of both methods
covered the same regions (Fig. 7).

The difference between the methods is illustrated with some ex—
ample allele trajectories in Supplementary Figures S23—S25. BBGP
emphasizes between—replicate consistency and sometimes picks can—
didate SNPs that start already at high frequency and go rapidly to
fixation. On the other hand, CMH test assigns high ranks to SNPs
with large frequency change and fails to detect between—replicate
consistency if the fold change is otherwise low.

Using a gene set enrichment analysis (see Supplementary Text
Section S5), we also found that the top ranked significantly enriched
Gene Ontology categories were similar for both tests
(Supplementary Tables S3 and S4, Supplementary Fig. S19).
Furthermore, Figure 7 shows how well the posterior beta—binomial
variance inference can handle false signals resulting from uneven
coverage. While the CMH test is misled by strong signal coming
from high coverage of the chorion cluster with high copy number
variation, the BBGP test does not falsely indicate signatures of selec—
tion (Fig. 7, green region on 3L).

Although Dmel generally has rather small levels of linkage, link—
age disequilibrium (LD) might have built up during the course of the

' (b)g

10

8

 

Intaayes Factor}
6

 

 

‘1'
N
O
X 2L 2R 3L 3R 4
Ch romosnme

Genome-wide distribution of BBGP ln(Bayes factors).

Fig. 7. Manhattan plots of genome-wide SNP-values. (a) flog 10(P7values) for the CMH test B-E comparison. P—values below 1e730 were clipped to 1e730 on
the plot. (b) In (BFs) for the BBGP. Only those SNPs are indicated for which we calculated both the P—values and the BFs (we did not infer BFs for tri-allelic SNPs).
A 1 Mb region was excluded from the analysis on 3R as a low-frequency haplotype spreads during the experiment. Previously, the chorion gene cluster on 3L

was also excluded as this region has extremely high coverage (Orozco-terWengel et al., 2012). Regions that were excluded from the analysis are shown in green.
The red horizontal line indicates the top 2000 candidate cutoff. The common candidates among the top 2000 are highlighted in magenta. Figure 7(b) shows how
well the beta-binomial variance control can handle high coverage problem of the excluded region on 3L

112 /310's112u1n0[p101x0"sotJBurJOJutotq/ﬁduq 11101} pap1201um0q

9103 ‘0g anBnV uo ::

Gaussian process test for high—throughput sequencing time series

1769

 

experiment. In fact, LD had a major effect on the number of candi—
date SNPs identified by the CMH as well as the BBGP test. As the
ﬂanking SNPs showed signs of hitchhiking, the observed AFC of
the ﬂanking SNPs were also significant (see also Manhattan plot for
the simulated SNPs Supplementary Fig. S1), and this made it difficult
to narrow down functionally important regions for thermoadaptation.

4 Discussion

Our results in detecting SNPs that are evolving under selection using
a GP model clearly demonstrate the importance of careful modelling
of the measurement uncertainty through a good noise model, in our
case using the beta—binomial model of sequencing data. Especially
when data are scarce, the BBGP approach leads to much higher ac—
curacy than standard maximum likelihood estimation of noise vari—
ances. Incorporating the non—Gaussian likelihood directly to the GP
would also be possible, but it would lead to computationally more
demanding inference.

In terms of experimental design, the most effective way to im—
prove performance is to use a larger population (N) and a larger
number of founder haplotypes (H). As expected, alleles under mod—
erate to strong selection (5 : 0.05—0.1) are easier to detect than al—
leles changing under weak selection (53 0.01). However, for very
strong selection (5 2 0.2), it is again hard to detect the causal SNPs.
In a real experiment, the strength of selection might also not be
known and often cannot be changed for the trait of interest. Adding
more replicates can also help improve performance up to some
point. Compared with the CMH test, the BBGP is clearly superior in
utilizing additional replicates. We suspect this is because CMH as—
sumes all replicates should have similar odds ratios between the two
time points and this is not sufficiently satisfied by the noisy data.
Longer experiments can help significantly (Supplementary Fig. S13),
but the benefit of adding more intermediate time points seems
smaller. This may be because the shape of selected trajectories is a
simple sigmoid, and adding more points provides limited help in
estimating them. The presented GP—based test is sensitive to SNPs
with a consistent time—varying profile. A statistically more accurate
model could be derived by assuming each replicate to follow an in—
dependent GP, but this would require different kind of constraints
to differentiate between selection and drift, which may be difficult
to formulate for multiple interacting SNPs. Exploring hierarchical
GP models to capture the correct dependence structure is an interest—
ing avenue of future research.

In a whole—genome experiment, LD between nearby markers and
interactions between nearby selected SNPs are important confound—
ers in identifying the selected markers. Especially for moderate—sized
populations, the interactions can be problematic, leading to very large
segments in the genome raising together in frequency (Supplementary
Fig. S12). The issue does not appear when simulating only a single
selected SNP (Supplementary Fig. S20), which strongly suggests it is
caused by the interactions. The issue can be most effectively mitigated
by using larger populations (Supplementary Fig. S21c and d). An artifi—
cially high recombination rate (Supplementary Fig. S21a and b) could
also break the interactions. Working with larger fixed window sizes
might not improve the performance as a substantial number of hitch—
hikers can still be found hundreds of kilobases from the selected SNPs
(See Supplementary Fig. S22: The removal of nearby hitchhikers did
not improve the AP noticeably). It is possible to extend the GP models
for joint analysis of multiple SNPs, and this is clearly an important av—
enue of future research. This is potentially a further advantage of the
GP, because it is much more difficult to similarly extend the frequentist
tests.

5 Conclusion

In this article, we developed a new test that is based on combining
GP models with a beta—binomial model of sequencing data, and
compared it with the CMH test that allows the pairwise comparison
of base and evolved populations across several replicates.

Our results demonstrate that GP models are well suited for ana—
lyzing quantitative genomic time series data because they can effect—
ively utilize the available data, making good use of additional time
points and replicates unhindered by uneven sampling and consist—
ently show performance superior to the CMH test.

The GP framework is very ﬂexible, which enables extensions
utilizing for example LD over nearby alleles. As GP models can eas—
ily incorporate additional information on the data, we envisage that
further promising combinations of the GP approach with evolution—
ary models will emerge.

Acknowledgements

C.K. thanks the Institute of Pure and Applied Mathematics (IPAM) for a stay
at the Genomics programme at which the idea of working on evolutionary
time series data evolved. The computational results presented above have
been performed using the computational resources provided by Aalto Science-
IT project and partly using the Vienna Scientiﬁc Cluster (VSC).

Funding

The work was supported under the European ERASysBio+ initiative project
‘SYNERGY’ through the Academy of Finland [135311]. A.H. was also sup-
ported by the Academy of Finland [259440] and H.T. was supported by
Alfred Kordelin Foundation. R.K. was supported by ERC (ArchAdapt). A]. is
member of the Vienna Graduate School of Population Genetics which is sup-
ported by a grant of the Austrian Science Fund (FWF) [W1225-B20].

Conﬂict of Interest: none declared.

References

Agresti,A. (2002) Categorical Data Analysis. Wiley, New York.

Aijo,T. et al. (2013) Sorad: a systems biology approach to predict and modu-
late dynamic signaling pathway response from phosphoproteome time-
course measurements. Bioinformatics, 29, 1283—1291.

Baldwin—Brown,J.G. et al. (2014) The power to detect quantitative trait loci
using resequenced, experimentally evolved populations of diploid, sexual
organisms. Mol. Biol. Evol, 31, 1040—1055.

Barrick,J.E. et al. (2009) Genome evolution and adaptation in a long-term ex—
periment with Escherichia coli. Nature, 461, 1243—1247.

Bollback,J.P. et al. (2008) Estimation of 2Nes from temporal allele frequency
data. Genetics, 179, 497—502.

Burke,M. et al. (2010) Genome—wide analysis of a long-term evolution experi—
ment with Drosophila. Nature, 467, 5 87—5 90.

Burke,M.K. and Long,A. (2012) What paths do advantageous alleles take dur-
ing short-term evolutionary change? Mol. Ecol., 21, 4913—416.

Cooke,E.J. et al. (2011) Bayesian hierarchical clustering for microarray time
series data with replicates and outlier measurements. BMC Bioinformatics,
12, 399.

Fiston-Lavier,A.S. et al. (2010) Drosophila melanogaster recombination rate
calculator. Gene, 463, 18—20.

Gao,P. et al. (2008) Gaussian process modelling of latent chemical species: ap-
plications to inferring transcription factor activities. Bioinformatics, 24,
i70—i75.

Hensman,J. et al. (2013) Hierarchical Bayesian modelling of gene expression
time series across irregularly sampled replicates and clusters. BMC
Bioinformatics, 14, 252.

Hill,W. G. and Robertson,A. (1966) The effect of linkage on limits to artiﬁcial
selection. Genet. Res., 8, 269—294.

112 /310'S[BHJnOprOJXO'SOIJBLUJOJIIIOICI”Zduq 11101} pap1201um0q

9103 ‘0g anBnV uo ::

1770

H. Topa et al.

 

Honkela,A. et al. (2010) Model-based method for transcription factor target
identiﬁcationwith limited data. Proc. Natl Acad. Sci. USA, 107, 7793—7798.
Illingworth,C.J.R. et al. (2012) Quantifying selection acting on a complex trait

using allele frequency time series data. Mol. Biol. Evol., 29, 1187—1197.

Jones,N.S. and Moriarty,J. (2013) Evolutionary inference for function—valued
traits: Gaussian process regression on phylogenies. ]. R. Soc. Interface, 10,
20120616.

Kalaitzis,A.A. and Lawrence,N.D. (2011) A simple approach to ranking dif-
ferentially expressed gene expression time courses through Gaussian process
regression. BMC Bioinformatics, 12, 180.

Kawecki,T.J. et al. (2012) Experimental evolution. Trends. Ecol. Evol., 27,
547—5 60.

Kirk,P.D.W. and Stumpf,M.P.H. (2009) Gaussian process regression boot—
strapping: exploring the effects of uncertainty in time course data.
Bioinformatics, 25, 1300—1306.

Koﬂer,R. and Schlotterer,C. (2014) A guide for the design of evolve and rese—
quencing studies. Mol. Biol. Evol., 31, 474—483.

Koﬂer,R. et al. (2011) PoPoolation2: identifying differentiation between popu-
lations using sequencing of pooled DNA samples (Pool-Seq).
Bioinformatics, 27, 3435—3436.

Lang,G.I. et al. (2013) Pervasive genetic hitchhiking and clonal interference in
forty evolving yeast populations. Nature, 500, 5 71—5 74.

Liu,Q. et al. (2010) Estimating replicate time shifts using Gaussian process re—
gression. Bioinformatics, 26, 770—776.

Liu,W. and Niranjan,M. (2012) Gaussian process modelling for bicoid mRNA
regulation in spatio-temporal Bicoid proﬁle. Bioinformatics, 28, 366—372.

Manning,C.D. et al. (2008) Introduction to Information Retrieval. Cambridge
University Press, Cambridge, England.

Orozco—terWengel,P. et al. (2012) Adaptation of Drosophila to a novel labora-
tory environment reveals temporally heterogeneous trajectories of selected
alleles. Mol. Ecol, 21, 4931—4941.

Palacios,J.A. and Minin,V.N. (2013) Gaussian process—based Bayesian non—
parametric inference of population size trajectories from gene genealogies.
Biometrics, 69, 8—18.

Rasmussen,C.E. and Williams,C.K.I. (2006) Gaussian Processes for Machine
Learning. The MIT Press, Cambridge, MA.

Stegle,O. et al. (2010) A robust Bayesian two—sample test for detecting inter—
vals of differential gene expression in microarray time series. ]. Comput.
Biol, 17, 355—367.

Titsias,M.K. et al. (2012) Identifying targets of multiple co—regulating tran—
scription factors from expression time—series by Bayesian model compari—
son. BMC Syst. Biol., 6, 53.

Tobler,R. et al. (2014) Massive habitat—speciﬁc genomic response in D. mela-
nogaster populations during experimental evolution in hot and cold envi-
ronments. Mol. Biol. Evol., 31, 364—375.

Turner,T. et al. (2011) Population—based resequencing of experimentally
evolved populations reveals the genetic basis of body size variation in
Drosophila melanogaster. PLoS Genet., 7, e1001336.

Yuan,M. (2006) Flexible temporal expression proﬁle modelling using the
Gaussian process. Comput. Statist. Data Anal., 51, 1754—1764.

Zhou,D. et al. (2011) Experimental selection of hypoxia—tolerant Drosophila
melanogaster. Proc. Natl Acad. Sci. USA, 7, 2349—235 4.

112 /310'S[BHJnOprOJXO'SOIJ’BLUJOJIIIOICI”Zduq 11101} pap1201um0q

9103 ‘0g anBnV uo ::

