ORIGINAL PAPER

Vol. 27 no. 12 2011, pages 1660-1666
doi:10. 1093/bioinformatics/btr188

 

Systems biology

Advance Access publication April 14, 2011

An optimal peak alignment for comprehensive two-dimensional
gas chromatography mass spectrometry using mixture similarity

measure

Seongho Kimlai‘, Aiqin Fang2, Bing Wang2, Jaesik Jeong3 and Xiang Zhang2a*

1Department of Bioinformatics and Biostatistics, 2Department of Chemistry, University of Louisville, Louisville,
KY 40292 and 3Division of Biostatistics, Department of Medicine, Indiana University, Indianapolis, IN 46202, USA

Associate Editor: Alfonso Valencia

 

ABSTRACT

Motivation: Comprehensive two-dimensional gas chromatography
mass spectrometry (GC >< GC—MS) brings much increased
separation capacity, chemical selectivity and sensitivity for
metabolomics and provides more accurate information about
metabolite retention times and mass spectra. However, there is
always a shift of retention times in the two columns that makes
it difficult to compare metabolic profiles obtained from multiple
samples exposed to different experimental conditions.

Results: The existing peak alignment algorithms for GO >< GC—MS
data use the peak distance and the spectra similarity sequentially
and require predefined either distance-based window and/or spectral
similarity-based window. To overcome the limitations of the current
alignment methods, we developed an optimal peak alignment using
a novel mixture similarity by employing the peak distance and the
spectral similarity measures simultaneously without any variation
windows. In addition, we examined the effect of the four different
distance measures such as Euclidean, Maximum, Manhattan and
Canberra distances on the peak alignment. The performance of
our proposed peak alignment algorithm was compared with the
existing alignment methods on the two sets of GC >< GC—MS data.
Our analysis showed that Canberra distance performed better than
other distances and the proposed mixture similarity peak alignment
algorithm prevailed against all literature reported methods.
Availability: The data and software mSPA are available at
http://stage.louisville.edu/faculty/szhan17/software/software-
development.

Contact: s0kim023@louisville.edu; xiang.zhang@louisville.edu
Supplementary information: Supplementary data are available at
Bioinformatics online.

Received on December 7, 2010; revised on March 14, 2011;
accepted on April 5, 2011

1 INTRODUCTION

An emerging technology, comprehensive 2D gas chromatography
mass spectrometry (GC >< GC—MS) brings much increased separation
capacity, chemical selectivity and sensitivity for metabolomics
analysis although there are several issues [Mondello et al. (2008);
Ramos (2009)]. This approach usually uses a short column after the

 

*To whom correspondence should be addressed.

main analytical column. Typically, the second column is operated at
a higher temperature than the ﬁrst column with different stationary
phase. The compounds co-eluted from the ﬁrst column are further
separated in the second column because of the difference of column
temperature and the chromatography matrix. The ﬁirther separated
compounds are directed to a high capacity time-of-ﬂight mass
spectrometry system for detection. The GC >< GC—MS platform
offers signiﬁcant advantages for analysis of complex samples
including: an order-of-magnitude increase in separation capacity,
signiﬁcant increase in signal-to-noise ratio and dynamic range and
improvement of mass spectral deconvolution and similarity matches
Dettmer et al. (2007), Li et al. (2009). Since the GC >< GC—MS
system can provide more accurate information about compound
retention times and mass spectrum, it represents a powerﬁil tool for
the analysis of compounds in complex biological systems. However,
while gathering GC >< GC—MS data, there is always a shift of
retention times in the two columns. Retention time shifts make
it difﬁcult to compare metabolic proﬁles obtained from multiple
samples.

In order to correct the retention time shifts in the GC >< GC system,
two alignment approaches have been developed: proﬁle alignment
and peak alignment. The proﬁle alignment directly uses the entire
chromatographic data, i.e. the raw instrument data, as the input data.
In the peak alignment approach, the raw instrument data are ﬁrst
deconvoluted to peak list, and the peak lists of multiple samples
are then employed as the input data to correct retention time shifts.
The selection of the two approaches for retention time correction
depends on the methods of downstream statistical analysis.

Currently, four proﬁle alignment methods have been reported.
Fraga et al. (2001) introduced an algorithm based on the generalized
rank annihilation method. Mispelaar et al. (2003) developed a
correlation-optimized shifting method. These two methods were
designed to align small or local regions of interest in GC >< GC
data. In order to correct the entire chromatogram in both dimensions,
Pierce et al. (2005) proposed an indexing scheme together with a
piecewise retention time alignment algorithm. Zhang et al. (2008)
developed a 2D correlation optimized warping (2-D COW) method
for warping the GC >< GC data. However, all the proﬁle alignment
methods align the GC >< GC—MS data based on 2D retention times
alone, although the signature feature of a compound, i.e. mass
spectrum of fragment ions, is readily available in the raw instrument
data. Aligning compound peaks solely based on the 2D retention
times may introduce a high rate of false-positive alignment because

 

1660 © The Author 2011. Published by Oxford University Press. All rights reserved. For Permissions, please email: journals.permissions@oup.com

112 /3.Io's[Bumo[p.IOJxosoiwuiJOJuioiq”:duq 11101} papeolumoq

91oz ‘Og anﬁnv uo ::

Mixture similarity peak alignment for 60 X GC—MS

 

some compounds with similar chemical ﬁinctional groups have
similar retention times in the two columns.

For this reason, two peak alignment methods, MSort (Oh et (11.,
2008) and DISCO (Wang et al., 2010), were developed. In these
methods, the raw instrument data of each sample were ﬁrst
reduced to a compound peak list, where each compound was
characterized by its two dimension retention times, mass spectrum
and other features. The two dimension retention times and the mass
spectrum of compound fragment ions were then used for compound
alignment. These two methods greatly reduced the rate of false-
positive alignment compared with the proﬁle alignment methods.
MSort was developed to align only for homogeneous data while
DISCO can be applied to both homogeneous and heterogeneous
data. The homogeneous data mean that all samples were analyzed
under the identical GC >< GC—MS experiment conditions while
the heterogeneous data refer that experiment data were acquired
under different GC >< GC—MS conditions. In terms of analytical
methods, there are two main differences between MSort and DISCO
approaches. First, they employ the different peak distance measures,
Maximum distance and Euclidean distance for MSort and DISCO,
respectively. However, the effect of different peak distance measures
was not examined. In this study, we examined the effect of the
different peak distances on the peak alignment using four distance
measures: Euclidean, Maximum, Manhattan and Canberra. Second,
the different variation windows are used in both approaches. MSort
requires a distance-based window and a spectral similarity-based
window is required in DISCO. However, it is usually difﬁcult for
users to set an optimal value for each of the variation windows.
To avoid this difﬁculty, we proposed a novel similarity measure,
a mixture of the peak distance and the spectra similarity, and
developed peak alignment algorithms in a software package named
mSPA, using the proposed similarity measure in which any variation
window is unnecessary. We evaluated the performance of the
different peak alignment methods along with the different peak
distance measures using two sets of GC >< GC—MS data.

The remaining part of this article is organized as follows. The
four different distance measures and spectral similarity measures
are introduced along with two sets of real GC >< GC—MS data in
Section 2. In Section 3, the four peak alignment algorithms are
described and followed by the introduction of the algorithms of the
proposed mixture similarity peak alignment. All the peak alignment
algorithms are then compared using the two sets of GC >< GC—MS
data in Section 4. Discussion and conclusion are given in Section 5.
We will use the following notations throughout the article. Let
T ={11,...,In} be a peak list ofthe target GC >< GC—MS data and R =
{r1 , . . . , rm} the peak list of the reference GC >< GC—MS data, where
rl- and tj (i: 1,...,m,j= l, ...,n) are composed ofits ﬁrst and second
retention times (rug 1) , 4132)) and (to, 1) , 103)), respectively. Note that
the distance and the similarity always refer to the retention times
and the mass spectra information, respectively. All the statistical
analysis and simulations are performed using a statistical package
R (www.r-project.org).

2 METHODS

2.1 Distance measure

The four different distance measures are employed in this study: Euclidean
distance, Maximum (aka Chebyshev) distance, Manhattan distance and

Table 1. The summary of two GC >< GCiMS data: a mixture of compound
standards (S17S 10) and a spiked-in sample (D17D5)

 

RUN ID S1 S2 S3 S4 S5 S6 S7

 

The number of 78 76 76 75 74 73 74
compounds (180)3 (186) (161) (151) (151) (145) (172)

 

 

S8 S9 S10 D1 D2 D3 D4 D5
76 77 75 466 456 436 452 418
(163) (168) (174) (759) (733) (694) (727) (661)

 

3The number of peaks found by ChromaTOF before correcting multiple peaks.

Canberra distance. Each distance measure between two peaks If and r, is

as follows:
D1(tj. Vi): ‘/ (to-,1) - r<i,1))2 +0012) - mm)2 (1)

D2(lj.ri)=mﬂx(|l(j,1)—r(i,1)|.llg,2)—r(i,2)|) (2)

D3(tjvri)=lt(j,l)_r(i,l)l+lr(j,2)_r(i,2)l (3)
ll',1—r’,1| ll',2 -r',2|

DAUj’ri): o > <2 > o > <2 > (4)
llg,1)+r(i,1)| llg,2)+r(i,2)|

where [031) and r0», 1) are the ﬁrst dimension retention time of the peaks t]- and
r,, and 10,2) and ran) are the second dimension retention time of the peaks
t]- and r,. To help understand the variation among the distance measures, the
four distance measures are delineated in Figure S1 of the Supplementary
Data II.

2.2 Similarity measure

We use the dot product Stein and Scott (1994), which is the most popular
approach, for spectrum similarity measure between two mass spectra, 1,]. and
In, of two peaks. If and r,. as follows:

30,-. ri>=dot(1., .I..>=<I.,.Ir. > /(II., | - IL, I)

where <15. ,1“. > is an inner product between the two mass spectra, 1,]. and
In, of two peaks If and r,, and |I,].|=W, |Iri|= <Iri,I,l. >. We
also use the Pearson’s correlation coefﬁcient, corr(I,/. ,1”), as an alternative
method for the spectrum similarity calculation and it showed the same
conclusions as the dot product (see Supplementary Data I). The difference
between two similarity measures is centering of the variables and normalizing
by the variance of each variable. In fact, Liu et al. (2007) compared the
different measures of spectral similarity and concluded that the Pearson’s
correlation coefﬁcient is robust but the difference between the dot product
and the Pearson’s correlation coefﬁcient is subtle. We included the Pearson’s
correlation coefﬁcient in our mSPA software as an option for users to select.

2.3 GC x GC—MS data

In this study. two sets of GC >< GCiMS data were used. One is a mixture of
106 compound standards and the other is metabolite extract from rat plasma
with spiked-in six compound standards. In the ﬁrst dataset (Dataset I), the
GC >< GCiMS analysis were repeated 10 times under 5°C / min temperature
gradient, resulting in a total of 10 datasets (S17S10 in Table 1). As
for the spiked-in sample (Dataset II), the compounds were analyzed ﬁve
times on GC >< GCiMS (D17D5 in Table 1). The detailed procedure for
generating these two datasets is described in the Supplementary Data II. The
LECO ChromaTOF software version 3.4 was used for instrument control.
spectrum deconvolution and compound identiﬁcation. The peak list of each
GC >< GCiMS data was then manually examined. In case that there are
multiple peaks identiﬁed as the same compound in an experiment. only the
peak with the largest peak areas was selected.

 

1661

112 /3.Io's[Bumo[p.IOJxosoiwuiJOJuioiq”:duq 11101} papeolumoq

91oz ‘Og anﬁnv uo ::

S.Kim et al.

 

3 ALGORITHM

3.1 Four peak alignment algorithms

Four algorithms are considered here to compare the performance
of the peak alignment for the homogeneous GC >< GC—MS data.
For each peak alignment algorithm, we employ the four different
distance measures.

3.1.] Peak alignment without window In this case, there are
two methods. One is a peak alignment procedure using solely the
peak distance without window (PAD) and the other peak alignment
algorithm is rendered only based on the spectral similarity between
two peaks without window (PAS). In detail, for each peak tj e T in
the target chromatogram, the peak distances and spectral similarities
between the current target peak and all the peaks rh(eR), h:
l,...,m, in the reference sample are calculated for PAD and PAS,
respectively. Then the best matched peak ri(eR) of tj is decided by:

PAD: n = argminrh ERDd (tj, rh)
PAS : r,- = argmaxrh GRS(tj, rh)

where |R| =m and Dd is a distance measure (d=1,...,4).

3.1.2 Peak alignment with window The previous methods ﬁnd a
best match by searching the peak with the minimum distance or
the maximum spectral similarity. Therefore, there might be a false
positive alignment if the experimental variations are bigger than
the information of the peak distance or the spectral similarity. This
can be resolved if both measures are used on the peak alignment
at the same time. To this end, MSort (Oh et al., 2008) uses the
distance-based window while the spectral similarity-based window
is used by DISCO (Wang et al., 2010). In other words, MSort and
DISCO require users to provide predeﬁned variation windows for the
distance and the spectral similarity among the different experiments.
The detailed description of MSort and DISCO can be found in the
Supplementary Data II.

We here introduce two algorithms which can be considered as
generalized versions of MSort and DISCO, respectively. The ﬁrst
method is called the peak alignment with the distance-based window
(DW—PAS) and the second method the peak alignment with the
similarity-based window (SW-PAD). In case of DW—PAS, for each
peak tj e T, the distances between the current target peak tj and all
the peaks r,- ER in the reference chromatogram are calculated by
the chosen distance measure and some of the reference peaks are
selected for the peak alignment by the distance-based window,

Rs={rh|Dd(Ith)S3(/c). rhER} (5)

where 600 is the k-th closest peak’s distance to the current peak
tj obtained by using the chosen distance measure Dd, d: 1,...,4.
Once the several reference peaks are selected by the distance-based
window, the best matching reference peak r,- of the current target
peak tj is inferred using the following expression:

r,- = argmaxrh GRSS(tj, rh)

where |RS|§|R|=m. Note that MSort employs the Maximum
distance D2 to build the window and considers the Pearson’s
correlation as spectral similarity measure. The difference between
DW—PAS and SW—PAD is the way to construct the variation
window. In case of SW—PAD, the window is constructed by the

spectral similarity measure, dot product in this work. Once some
of the reference peaks are selected by the window constructed, the
reference peak with the minimum distance is chosen as the best
match of the current target peak. The entire procedure of SW—PAD
for ﬁnding the best matching reference peak r,- ER of the current
target peak t,- e T can be summarized by

r,- = argminrh eRst (tj, rh)

where RS={rh|S(tj,rh)3 ,0, rh ER} and lel f |R| =m and ,0 is the
user-deﬁned threshold for the spectra similarity by the dot product.
SW—PAD becomes DISCO when the Pearson’s correlation as a
similarity measure is used to extract the subset R5 of R instead
of the dot product accompanied by the Euclidean distance D1.

3.2 Mixture similarity

We ﬁirther developed a novel similarity measure which uses both the
peak distance and the spectral similarity measures simultaneously.
We call the proposed measure the mixture similarity, and the mixture
similarity to ri(eR) given tj can be deﬁned:

Md(zj,r.-Iw>=w-(1+Dd(y,ri>>—1+(1—w>-S(y.ri> (6)

where w is the weight for the mixture similarity measure and
0 f w 3 1. Note that the distance part in the right-hand side of
Equation (6) is normalized so that the range becomes between
0 and l. Certainly, when w: 1, the mixture similarity use the
peak distance only and it is only based on the spectral similarity
measure when w=0. That is, Md(tj, ri|w= l) = 1/(1 +Dd(tj, r,)) and
Md (tj, ri|w= 0) =S(tj, ri). As the mixture similarity between n and
tj becomes large, the possibility of tj matching to r,- increases. Using
the mixture similarity measure, the peak alignment can be rendered
as follows. For each peak tj ET, the mixture similarities between
the current target peak and all the peaks rh(eR),h= l, ...,m, in the
reference sample are calculated. Then the best matching peak ri(e R)
of tj is decided by

r,- = argmaxrh ERMd(tj, rh |w)

where |R| =m. We call this method the peak alignment using
the mixture similarity without window (PAM). One of the main
beneﬁts of the proposed PAM method is the ability to use both
the peak distance and the spectral similarity simultaneously without
constructing the variation window differing from DW—PAS and SW-
PAD in which both the distance and spectral similarity measures are
used sequentially through a constructed window.

4 IMPLEMENTATIONS

In the previous section, the ﬁve methods are introduced for the peak
alignment, which are PAD, PAS, DW—PAS, SW—PAD and PAM.
For each method, we apply the four different distance measures,
Euclidean, Maximum, Manhattan and Canberra distances, along
with the spectral similarity measure to GC >< GC—MS data. We
ﬁrst describe the comparison criteria to evaluate the performance
of each method. Then we consider two cutoff values (k and ,0)
which need to be predeﬁned for the variation window-based peak
alignment methods, DW—PAS and SW—PAD, as well as the weight
w for the mixture similarity measure, PAM. Then the performances
of each method are considered for each dataset and followed by the

 

1 662

112 /3.Io's[Bumo[p.IOJxosoiwuiJOJuioiq”:duq moi; papeolumoq

9103 ‘Og anﬁnv uo ::

Mixture similarity peak alignment for 60 X GC—MS

 

description of the method of ﬁnding the optimal distance measures
and w value.

4.1 The comparison criteria

The performances of all ﬁve methods are compared by
calculating the true positive rate (TPR), positive predictive value
(PPV) and F 1 score of the peak alignment. Suppose there
are n target peaks T={t1,...,tu,tu+1,...,tn} and m reference
peaks R:{r1,r2,...,ru,ru+1,...,rm} with u positive peak pairs
{(t1,r1),(t2,r2),...,(tu,ru)}, where ufmin(n,m). Note that if two
peaks are generated by the same compound, it is called a positive
peak pair. If a certain peak alignment method is applied to the two
datasets, T and R, and v matched peak pairs are found, then the
values of TPR and PPV of the peak alignment between two datasets
are estimated by the following equations:

TPR = TP/(TP + FN); PPV = TP/(TP + FP)

where TP is the number of positive peak pairs that were aligned
as positive (true positive) and is less than or equal to min(u,v), FF
is the number of negative peak pairs that were aligned as positive
(false positive) and is v-TP, FN is the number of positive peak pairs
that were not aligned (false negative) and is u-TP and TN is the
number of negative peaks that were not aligned (true negative) and
is mn-u-FP. Note that the total number of peak pairs is mn. TPR is
called recall and PPV precision and their harmonic mean (:2 X TPR-
PPV/(TPR+ PPV)) is used as an accuracy which is called F 1 score.
Thus, we use F 1 score as an accuracy of the peak alignment. Once
all the implementations were ﬁnished, the means and standard errors
(SE) of TPR, PPV and F 1 score for all the cases of each peak
alignment method were estimated for the purpose of comparing
their performance. The results of this estimation are given in the
Supplementary Data I.

4.2 The cutoff values and the weight w

DW—PAS method requires to construct the distance-based window
for peak alignment. To do this, k, which is described in expression
(5), should be set up prior to the peak alignment. It means that the
window is constructed by the reference peaks which have less than
or equal to the distance of the k-th closest reference peaks to the
current target peak. In our studies, the ﬁve values, (3, 5, 10, 15,
20) were used to see the effect of the k value on the performance
of the peak alignment. On the other hand, the cutoff value for the
spectral similarity, ,0, is necessary for SW—PAD method and the 13
values (0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.93, 0.95, 0.97,
0.99) were considered to investigate how the performance of the
peak alignment was affected. The performance of PAM depends on
the weight w of the mixture similarity. If w goes to one, then the
peak distance will play an important role in the peak alignment and
the contribution of the spectral similarity measure will increase as
w goes down to zero. In this study, we examined the performance
of PAM according to the 13 different w values, (0.01, 0.05, 0.1, 0.2
0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.95, 0.99).

4.3 Performance analysis of pair-wise peak alignment

All the pairs among the data are constructed, considering that one is
a reference chromatogram and the other is a target chromatogram.
As a result, there are a total of 45 homogeneous chromatogram

pairs for Dataset I and 10 for Dataset II used for the comparison
analysis of the peak alignment methods. For each peak pair, the ﬁve
different peak alignment methods were implemented along with four
different distance methods as well as the different cutoff and weight
values.

4.3.] Dataset I: a mixture of compound standards When
PAD was used for Dataset I, Canberra distance measure
signiﬁcantly outperformed other distance measures in terms
of F 1 score. Their mean and SE of F 1 scores are as follows:
Euclidean = 0.9253 :l: 0.0052; Maximum = 0.9035 :l: 0.0072;
Manhattan = 0.9276 :l: 0.0049; Canberra = 0.9652 :l: 0.0026 (see
Supplementary Data I). The effect of the cutoff value, k, for the
peak alignment method DW-PAS was ﬁrst examined as depicted in
Figure 1(a).

Note that k is the rank of the distance in ascending
order, meaning that if k is close to one, the distance
goes to zero. Euclidean distance with PAD performs the
best when k = 3, but its F 1 score is overlapped with
those of Maximum and Manhattan distances when k = 3
(Fl: Euclidean = 0.9618 :l: 0.0037; Maximum: 0.9614 :l: 0.0037;
Manhattan=0.9604:l:0.0039). Interestingly, the superiority of
Canberra distance with PAD is disappeared in case of DW—PAS
(F1: 0.8981 :l: 0.0069).

We examined the performance of the SW—PAD method according
to its different cutoff value, ,0, which is used to construct the
similarity-based window. Figure 1(b) displays that the optimal ,0 may
be around 0.5 for Dataset I. As ,0 goes to near zero, both TPR and PPV
tend to be decreased. If ,0 goes to near one, the PPVs are increased
but the TPRs are sharply decreased. When the cutoff value, ,0, is
small, Canberra distance shows much better performances than other
distance measures. However, no signiﬁcant difference is observed
among the different distance measures in case that the cutoff value
is large. The ,0=0.5 version for SW—PAD with Canberra distance
performs the best (F l = 0.9766 :l: 0.0026).

Figure 1(c) shows the performance of the PAM method using
the mixture similarity measure. The performances were examined
according to the different weight values (w) between 0 and 1. Clearly,
Canberra distance behaves differently from other distance measures.
Namely, as w increases, the performance of the peak alignment
of Euclidean, Maximum and Manhattan distances with PAM drop
down sharply, while the performance of Canberra distance tends
to increase up to some point as w goes to one. As a result,
Canberra distance performs the best when w is greater than or
equal to 0.5 and other distances have the best performance when
w is smaller than 0.5. That is, while the spectral similarity plays
an important role in the version of PAM with other distance
measures, the peak distance and the spectral similarity are equally
contributed to the case of PAM with Canberra distance. The w =
0.5 version of PAM with Canberra distance outperforms others
(F1: 0.9810 :l: 0.0020).

When Dataset I was used for each peak alignment method, PAS
(M2) shows the worst performance (F l = 0.9023 :l: 0.0069) as can be
seen in Table 2 and Table S2 and Figure S3(a) of the Supplementary
Data II. Apparently, PAM (M5) shows a promising performance,
especially coupled with Canberra distance (D4) as depicted in
Figure S3(a). Collectively, in case of Dataset I, the ,0 = 0.5 version of
SW—PAD with Canberra distance and the w = 0.5 version of PAM

 

1 663

112 /3.IO'S[1211,1110prOJXO'SOIJBLUJOJIIIOIq”Idllq 11101} papeolumoq

9103 ‘Og anﬁnv uo ::

S.Kim et al.

 

 

 

 

          

 

 

 

 

 

 

   

 

 

 

 

 

 

 

 

(a)  aim—g" w=o.5
3; _
D
“"001
3
E d _
._
o
as _
o
-9- Euciclean
k=3 k=20 ‘3" Maximum
m 1 V -+- Mmhaﬁm
Q — gr—x“ '*' Canberra _
o I I I I I I ' I I I I I I I I I I I
0.92 0.93 0.94 0.95 0.90 0.9? 0.90 0.9? 0.93 0.99
ppv PPV
In
(:0 m (e) g -.
(q _
O CI
u:
I‘- U
(Q _
o
[II
In
3 _ c:
d
E E E -
*- 3- I— d
d
a
3, _ I:
o
n \ a .
Iri— , cs '
O x \ _ =09; ‘
I‘— k—3 g : D . 1“
I | I I I d | | I I I I I I I I I I I
0.49 0.50 0.51 0.52 0.53 0.45 0.50 0.55 0.00 0.65 0.70 0.44 0.40 0.40 0.50 0.52 0.54 0.56
PIWr F'F'VII PPV

Fig. 1. The effects of k. p, w on the peak alignment methods for Dataset I (aw) and Dataset II (def). The scatter plots of the TPR versus the PPV are depicted
for Datasets I and II. The Euclidean. Maximum, Manhattan and Canberra distances are depicted as black circles. red triangles. green pluses (+) and blue
crosses ( >< ), respectively. (a and d) The performance of the DW-PAS method is examined using different k values. (b and e) The performance of the SW-PAD
method is examined using different p values. (c and f) The performance of the PAM method is examined using different w values.

 

 

 

Table2. The maximum F1 scores of eachpeakalignmentmethodforDataset measures when PAD was employed in terms of F1 scores
13nd H (Fl: Euclidean = 0.4728 :l: 0.0178; Maximum: 0.4677 :l: 0.0179;
Manhattan = 0.4729 :l: 0.0177; Canberra: 0.4694 :l: 0.0273).
Dataset MathOd k pm) Dismme F1 95%CIOfF1 PAS outperforms against PAD (F l: PAS=0.6109:I:0.0102;
PAD with Manhattan=0.4729:l:0.0177), while PAD performed
1 PAD canbmm 09652 (0‘96OOQ‘9704) better than PAS signiﬁcantly in case of Dataset I as shown in
PAS . 0.9023 (08888419157) Table 2 This means that the variation in peak distance might
DW-PAS 3 Euclldean 0.9618 (0.9546k0.9690) ' , , ,
SW_PAD 05 Canberra 0.9766 (0.9716k09817) be larger 1n Dataset II than that 1n Dataset I compared w1th
pAM 0.5 Canbelm 0.9810 (09771419849) the variation in spectral similarity, which is true because the
sample complexity is signiﬁcantly increased in the Dataset II.
II PAD Manhattan 0.4729 (04382415076) As a result, the contribution of the spectral similarity to the
PAS 0.6109 (05908416310) peak alignment will be larger than that of the peak distance in
DW-PAS 15 Canberra 0.5932 (0.5716k0.6l49) Dataset H,
SW'PAD 0-93 Manhattan 05954 (0568741621) When DW—PAS was applied to Dataset II, the Canberra
PAM 0.05 Manhattana 0.6148 (05945416351)

version performed better than other distances as clearly shown in
Figure 1(d). When k is three, the difference between Canberra and
other distances becomes much bigger than when k is larger than 15.
The k: 15 version of DW—PAS with Canberra distance shows the

With canberra diStance have the better Performances Signiﬁcantly best performance (F l = 0.5932 :l: 0.0110) as can be seen in Tables 2
different from other methods as shown in Table 2. and 52’

 

aEuclidean and Maximum have the same F1 value as that of Manhattan.

It seems that the optimal cutoff value, ,0, for Dataset II is different
4.3.2 Dataset II: a spiked-in sample The performance of the ﬁve from the value for Dataset I. As shown in Figure 1(e), the highest

different peak alignment algorithms was examined with Dataset TPR is occurred when ,0=0.8 which is consistent with the result
II and we observed several different trends from Dataset I. of DISCO (Wang et al., 2010). However, if TPR and PPV are
There was no clear distinction among the four different distance considered through F 1 score which is the harmonic mean between

 

1 664

112 /3.IO'S[1211anprOJXO'SOIJBLUJOJIIIOlq”Idllq moi; papeo1umoq

9103 ‘0g isnﬁnv uo ::

Mixture similarity peak alignment for 60 X GC—MS

 

TPR and PPV, then the best performance is occurred when p = 0.93.
On the other hand, Dataset I gives us 0.5 as an optimal p as displayed
in Figure 1(b).

All the distance measures have the similar trends according
to w when PAM was applied to Dataset II as depicted in
Figure 1(f). Namely, as w goes to one, the performance
decreases, while the performance increases if w decreases to
zero. Interestingly, when w =0.99, the version of Canberra
distance outperforms against other version of distance measures
(F1: Euclidean : 0.4811 :l: 0.0169; Maximum : 0.4814 :l: 0.0168;
Manhattan : 0.4815 :l: 0.0169; Canberra: 0.5414 :l: 0.0148 as
shown in the Supplementary Data I), while no signiﬁcant difference
was observed when PAD was applied to the same dataset. This
means that although the amount of the contribution of the spectral
similarity is relatively small (1 —w=0.01), the number of false
positives can be reduced signiﬁcantly by aid of the spectral
similarity measure. Similar to the conclusion in Dataset I, PAM
shows the best performance in peak alignment as shown in Table 2
and Figure S3(b).

4.4 Peak alignment of all peak lists

In the previous section, we considered the performance of the peak
alignment of each method based on the pairwise peak alignment.
However, the peak table that all peak lists were aligned together is
absolutely necessary for ﬁirther analysis. For this reason, we aligned
all peak lists using the cases which have the maximum F 1 score for
each peak alignment method as summarized in Table 2 in order to
examine the performance of the peak alignment of each method
when all peak lists were aligned. As for Dataset I, we aligned 10
peak lists with 9 pairs of the pairwise alignment, (S1,S2), (S2,S3),
(54,55), (56,57), (57,58), (58,59) and (S9,S10), by choosing the
best cases of each pair for each method which has the maximum F 1
score except for OP-PAM which is described in the next section. In
case of OP-PAM, it was done by optimization. Similarly, Dastset
II was aligned with four pairs of the pairwise alignment, (D1,D2),
(D2,D3), (D3,D4) and (D4,D5). Once the peak table of all peak lists
was constructed, the peaks that had at least one missing were deleted.
Using the scheme described above, the peak alignment of the entire
peak list was done with the best cases for each peak alignment as
depicted in Figure S6 in the Supplementary Data II.

To examine the performance of the peak alignment for each
algorithm, we calculated TPR, PPV and F 1 score based on the
true peak alignments for Datasets I and II as shown in Figure S5
in the Supplementary Data II. The true number of peaks matched
throughout all the homogeneous chromatograrns was 66 and 146 for
Datasets I and II, respectively. The results were consistent with the
previous validation studies in Section 4.3. Indeed, PAM outperforms
others in terms of F 1 scores. In case of Dataset I, SW—PAD and
PAM show the largest Fl scores (F1: PAD : 0.9365; PAS : 0.8333;
DW-PAS : 0.9219; SW-PAD : 0.9618; PAM : 0.9618) as can be
seen in Figure S6(a). Figure S6(b) also shows that PAM performs
the best out of the ﬁve peak alignment algorithms using Dataset
II (F 1: PAD : 0.3275; PAS : 0.5048; DW-PAS : 0.4940; SW-
PAD : 0.5091; PAM : 0.5363).

4.5 Finding the optimal value of w for PAM method

For the PAM method, it is indispensable to ﬁnd the optimal
value of w and distance measure for the best performance of

the peak alignment. Therefore, we developed an optimal version
of PAM which is called OP-PAM. In case of OP-PAM, the
optimal value of w and optimal distance measure will be estimated
iteratively based on a certain likelihood ﬁinction differently from
ﬁxing their values for PAM by users in advance. To do this, the
following likelihood ﬁinction L(Y,X |6) was considered to evaluate
the potential performance of the peak alignment:

1
2mm]..rkIw>+s(zk.rk>+(1+Dd(zk.rk>>—1> (7)
k=1

where 6 = (w, d), d is the index of the four different distance measure
(1 : Euclidean; 2 : Maximum; 3 : Manhattan; 4 : Canberra), l is the
number of all the matched peaks between T and R, |T| =n, |R| =
m, and l fmin(n,m). Therefore, the optimal weight and distance
measure, 0:09.21) are estimated given T and R by the following
maximization:
9=argmax9=(w1 d)L(T,R|6).

The estimated optimal weight and distance measure, 9: (w,d), can
be found in Table S3 in the Supplementary Data II. The initial
value was 0.5 for all the cases and the maximization was done
using the R package nlminb which is unconstrained and constrained
optimization using PORT routines. In case of Dataset I, the estimates
of w are consistent with the best case of PAM. That is, the best case
of PAM was Canberra distance with w:0.5 as shown in Table S2
and, in case of OP-PAM, Canberra distance was estimated as the
best for all the peak pairs with the mean 0.6939 and SD 0.2558
of the estimates of w as can be seen in Table S3. As for Dataset
II, the estimates of OP-PAM are different from the best case of
PAM. Namely, the best case of PAM was Euclidean, Maximum
and Manhattan distances with w : 0.05 in Table S2, while Canberra
distance was selected having the maximum likelihood with the mean
0.6187 and 0.0786 of the estimates ofw in Table S3.

The peak alignment of all peak lists was then done using OP-
PAM for Datasets I and II as depicted in Figure S6. Interestingly,
the performance of the peak alignment using OP-PAM is the same
as that using PAM for Dataset I and outperforms others in case of
Dataset II (F 1 :0.9618 for Dataset I and F l : 0.5370 for Dataset
II) as shown in Figure S6. Their detailed results such as aligned
retention time, area and compound name tables can be seen in the
Supplementary Data III.

5 DISCUSSION AND CONCLUSION

Homogeneous peak alignment using either the distance of peaks
and/or the similarity of mass spectra was considered with four
different distance measures and the mixture similarity measure
by combining the peak distance and the spectral similarity. Then
the performances of the ﬁve different alignment methods were
compared. In addition, the optimal version of PAM, OP-PAM, was
further implemented into a software package mSPA for automatic
peak alignment.

Compound retention index (I), normalized retention time, can
be employed for peak alignment. As for GC-MS data, Shimadzu
(www.shimadzu.com) developed a retention time correction
algorithm, which is called Automatic Adjustment of Retention Time
(AART), inside their GCMS solution 2.5 software using I features
and showed the promising performance. Similarly, I features can
be used for GC >< GC—MS data to correct the retention times of

 

1 665

112 /3.IO'S[1211anprOJXO'SOIJBLUJOJIIIOlq”Idllq moi; papeo1umoq

9103 ‘0g isnﬁnv uo ::

S.Kim et al.

 

both dimensions. However, mSPA is designed for the alignment of
homogeneous data, where the compound retention time shifts are
not large and therefore, the advantage of converting retention time
to I and then use I for alignment may not be signiﬁcant.

Throughout the comparison, Canberra distance shows better
performances than other distance measures. This may be because
Canberra distance normalizes the variations of retention time by
taking the weight, resulting in reducing the effect of the variation of
each retention time.

The variation in peak distance of Dataset I is larger than that of
Dataset II as seen in Figure S2 and Table S1. Consequently, PAD
performed worst in Dataset II in terms of F 1 score, while it showed
better performance marginally in Dataset I in Table 2. However,
although PAS showed the smallest F 1 score in Dataset I in Table S2,
PAS is less sensitive to the quality of data than PAD. It means that
the measurement error of mass spectra is stable so that PAS may be
robust to variation in peak distance.

In order to utilize the peak distance and the spectral similarity
together, a novel similarity measure, the mixture similarity, was
proposed. This is a mixture of the peak distance and spectral
similarity information in that the contribution of each measure is
controlled by the weight w. Therefore, if the peak distance plays an
important role in peak alignment, w will be large and the weight
w will be small if the spectral similarity plays a primary role in
peak alignment as described in Equation (6). Indeed, when PAM
with the mixture similarity measure was implemented, the smaller
w values were observed when the variation in peak distance is larger
(Dataset II) than when the variation is smaller (Dataset I) as shown
in Table S2 and in the last column of Figure S4. In particular, it
can be seen that PAM prevailed against other four methods in peak
alignment.

As we stated above, the cutoff values are not consistent with the
different dataset so that an optimal cutoff value should be found
according to the quality of the dataset before the peak alignment. For
this reason, OP-PAM, the optimal version of PAM, was developed
to ﬁnd the optimal value of w automatically to avoid this issue.
The main advantages of OP-PAM to peak alignment are (i) it uses
both peak distance and spectral similarity, (ii) it does not need to
construct the window so that the cutoff values are not necessary,
and (iii) it can ﬁnd the optimal distance and weight w based on the
likelihood function statistically as described in Equation (7). In our
comparison analysis, it is demonstrated that OP-PAM outperformed
all the literature reported peak alignment methods and other methods
investigated in this work for the peak alignment of the entire peak

lists as shown in Supplementary Figure S6. Especially, OP-PAM
method can be an optimal approach for the peak alignment because it
performed the best for both datasets. In other words, it provides high-
quality peak alignment regardless of the quality of the GC >< GC—MS
data.

ACKNOWLEDGEMENTS

The anonymous reviewers are thanked for their constructive
comments.

Funding: grant (lROlGM087735-02) through the National Institute
of General Medical Sciences (NIGMS) within the National Institute
of Health (NIH); (DE-EM0000197) through the Department of
Energy (DOE).

Conﬂict of Interest: none declared.

REFERENCES

Dettmer,K. et ai. (2007) Mass spectrometry-based metabolomics. Mass Spectrom Rev.,
26, 51:78

Fraga,C.G. et ai. (2001) Objective data alignment and chemometric analysis of
comprehensive two-dimensional separations with run-to-run peak shifting on both
dimensions. Anal. Chem, 73, 583340.

Li,X. et ai. (2009) Comprehensive two-dimensional gas chromatography/time-of-ﬂight
mass spectrometry for metabonomics: biomarker discovery for diabetes mellitus.
Anal. Chim. Aeta, 633, 2577262.

Liu,J. et ai. (2007) Methods for peptide identiﬁcation by spectral comparison. Prot.
Sci, 5, 3.

Mispelaar,V.G. et ai. (2003) Quantitative analysis of target components by
comprehensive two-dimensional gas chromatography. J. Chromatograph, 1019,
15:29.

Mondello,L. et ai. (2008) Comprehensive two-dimensional gas chromatography-mass
spectrometry: a review. Mass Speetro. Rev., 27, 1017124.

Oh,C. et ai. (2008) Comprehensive two-dimensional gas chromatography/time-of-ﬂight
mass spectrometry peak sorting algorithm. J. Chromatography A, 1179, 2057215.

Ramos,L. (2009) Comprehensive two dimensional gas chromatography. In Barcelo,D.
(ed.), Comprehensive Analytical Chemistry, Vol. 55. Elsevier B.V., Oxford, UK.

Pierce,K.M. et ai. (2005) A comprehensive two-dimensional retention time alignment
algorithm to enhance chemometric analysis of comprehensive two-dimensional
separation data. Anal. Chem, 77, 773577743.

Stein,S.E. and Scott, DR. (1994) Optimization and testing of mass spectral library
search algorithms for Compound Identiﬁcation. J. Am. Soc. Mass Spectrom, 5,
8597866.

Wang,B. et ai. (2010) DISCO: distance and spectrum correlation optimization alignment
for two dimensional gas chromatography time-of—ﬂight mass spectrometry-based
metabolomics. Anal. Chem, 82, 506975081.

Zhang,D. et ai. (2008) Two-dimensional correlation optimized warping algorithm for
aligning GC >< GC:MS data. Anal. Chem, 80, 2664:2671.

 

1 666

112 /3.IO'S[1211anprOJXO'SOIJBLUJOJIIIOlq”K1111] moi; papeo1umoq

9103 ‘0g isnﬁnv uo ::

