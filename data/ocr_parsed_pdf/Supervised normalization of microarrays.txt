ORIGINAL PAPER

Vol. 26 no. 10 2010, pages 1308-1315
doi: 1 0. 1093/bioinformatics/btq1 1 8

 

Gene expression

Advance Access publication March 31, 2010

Supervised normalization of microarrays

Brigham H. Mechaml, Peter S. Nelsonla2 and John D. Storey?”

1Department of Genome Sciences, University of Washington, Seattle, WA 98195, 2Divisions of Human Biology and
Clinical Research, Fred Hutchinson Cancer Research Center, Seattle, WA 98109 and 3Lewis—Sigler Institute for
Integrative Genomics and Department of Molecular Biology, Princeton University, Princeton, NJ 08544, USA

Associate Editor: Joaquin Dopazo

 

ABSTRACT

Motivation: A major challenge in utilizing microarray technologies
to measure nucleic acid abundances is ‘normalization’, the goal
of which is to separate biologically meaningful signal from other
confounding sources of signal, often due to unavoidable technical
factors. It is intuitively clear that true biological signal and
confounding factors need to be simultaneously considered when
performing normalization. However, the most popular normalization
approaches do not utilize what is known about the study, both in
terms of the biological variables of interest and the known technical
factors in the study, such as batch or array processing date.
Results: We show here that failing to include all study-specific
biological and technical variables when performing normalization
leads to biased downstream analyses. We propose a general
normalization framework that fits a study-specific model employing
every known variable that is relevant to the expression study. The
proposed method is generally applicable to the full range of existing
probe designs, as well as to both single-channel and dual-channel
arrays. We show through real and simulated examples that the
method has favorable operating characteristics in comparison to
some of the most highly used normalization methods.

Availability: An R package called snm implementing the
methodology will be made available from Bioconductor (http://
bioconductor.org).

Contact: jstorey@princeton.edu

Supplementary information: Supplementary data are available at
Bioinformatics online.

Received on December 30, 2009; revised on December 30, 2009;
accepted on February 4, 2010

1 INTRODUCTION

The microarray technology measures nucleic acid abundances, such
as from mRNA, in biological samples by producing ﬂuorescence
intensities that reﬂect hybridization events between nucleotide
sequences. Attached to the microarray are single-stranded DNA
probes, which represent a short segment of complementary DNA
within a gene. Differences among current microarray technologies
are typically in terms of probe design and the number of
ﬂuorescent dyes applied to any given array. Regardless of the
technology, statistical analysis of these data usually attempts to

 

*To whom correspondence should be addressed.

infer the relationship between nucleic acid abundance variation
and biological phenotype. One of the main challenges of this
inference process is normalization, which addresses the fact that
factors not of biological relevance can inﬂuence the observed
intensities (Bolstad et (11., 2003; Dudoit et (11., 2002; Tseng et (11.,
2001; Wu et (11., 2004), complicating approaches used to infer
relationships from these data (Dabney and Storey, 2007; Rattray
et (11., 2006; Wu and Irrizary, 2007). The major contribution of
this paper is to provide a general ‘supervised’ framework for
microarray normalization (Fig. 1). This approach is applicable to
all major microarray technologies and performs the normalization
in a manner supervised by all known variables relevant to the
study.

Some of the most highly used microarray normalization methods
are what we call ‘unsupervised’ methods. These are normalization
procedures that do not utilize the variables describing the study,
speciﬁcally the biological variables of interest (Fig. 1). For
example, suppose the goal of a microarray study is to identify
genes differentially expressed with respect to an experimental
treatment. Also, suppose that the arrays were processed in two
separate batches. Unsupervised methods ignore the treatment and
batch variables when performing the normalization. However, if
the goal of normalization is to separate biologically meaningful
signal from technical confounders, then it seems infeasible to
do so without taking into account the signal explained by the
study-speciﬁc variables, such as treatment and batch in this
example.

While unsupervised methods may show favorable operating
characteristics in specialized settings—such as when biological
variables contribute relatively negligible signal to the data—it has
been shown they make assumptions about data that are commonly
invalidated in practice (Dabney and Storey, 2007; Irizarry et (11.,
2006). As a simple motivating example meant to illustrate how
easily these assumptions are violated, we simulated microarray
data (extensive details are given in following sections) with signal
due to a dichotomous biological variable and intensity-dependent
array effects. We simulated 100 000 probes, 30% of which are
differentially expressed. Figure 2 shows the P-value histograms
corresponding to probes, which are not differentially expressed.
Figure 2A is the method we propose in this work, where the P-values
are correctly Uniform(0, 1). Figure 2C and E show the P-values from
the same probes when using invariant set normalization (ISN; Li
and Wong, 2001) and quantile normalization (QN; Bolstad et (11.,
2003), respectively. It can be seen that both sets of P-values are
anti-conservatively biased.

 

© The Author(s) 2010. Published by Oxford University Press.

This is an Open Access article distributed under the terms of the Creative Commons Attribution Non—Commercial License (http://creativecommons.org/licenses/
by—nc/2.5), which permits unrestricted non—commercial use, distribution, and reproduction in any medium, provided the original work is properly cited.

112 /3.Io's[Bumo[p.IOJxosoiwuiJOJuioiq”:duq 11101} papeolumoq

9103 ‘{g anﬁnv 110::

Supervised normalization of microarrays

 

 

STUDY DESIGN TECHNOLOGY

I2 Bl — 

[El [01

UNNORMALIZED

A BIOLOGY

(Lo-urn Teams

 

 

 

 

 

 

 

 

........ TmmNm 12
— Tﬂsﬂwhlw 13

 

 

UNSUPERVISED
NORMALIZATION

SUPERVISED
NORMALIZATION W

 

 

 

 

 

B probe intensity = age + genotype + sex + batch + baseline + array eifea + noise
l J I I | l | | | J

Y = ex + A2 + film] +E

M—l

Fig. 1. A demonstration of the main ideas behind supervised normalization
of microarrays. (A) A hypothetical example to demonstrate the differences
between supervised and unsupervised normalization strategies. The three
boxes arranged across the top display different types of potential effects.
Each of these potentially inﬂuences the unnormalized observed intensities.
which are presented as densities in the middle panel. The blue and red lines
describe the different biological conditions. while the dashed and dotted
lines describe the different dates. The differences among the four arise either
from the biology or study design. After normalization with a supervised
approach that takes all three effects into account when normalizing the
data. the differences between the blue and red lines are still present. while
the differences between the dashed and dotted lines have been removed.
However. for unsupervised approaches. such as quantile normalization. the
resulting data have been transformed so that all arrays have the same
distribution. a result that clearly violates the biological relationship of
interest. (B) An example of the model we ﬁt to the probe-level data from a
microarray study. The model has probe-speciﬁc terms. intensity-dependent
terms and may include other terms such as probe composition effects or
surface level spatial effects.

We show that the main reason for the anti-conservative null
P-value distribution from the two unsupervised normalization
methods is that the known biological variable was not taken into
account. We also show that unsupervised normalization methods
may become more problematic and unpredictable as more study-
speciﬁc variables are ignored. The basic reason for this is that
when performing normalization, one cannot unbiasedly separate
true biological signal from technical and other study-speciﬁc
confounders unless both sets of variables are taken into account
during the normalization process. On the other hand, supervised
normalization methods (Baird et (11., 2004; Dabney and Storey, 2007;

Fisherman or‘l'nm
Pittman «Tum

 

 

o . : o o o u. :1
Pvqus Pause
3 F
.5 ﬂ
is =° - a x-
; a
g
n‘. a: .x

P wuss P wque

 

 

Pmmm n! Tam
leﬂﬂﬂ' Tun.

 

 

TITIT I

w \: r. n no .r o.- .. o‘ :1 a

 

 

 

 

P Vitus: F' wuss

Fig. 2. Results from simulated data with differential expression and array
effects. The true proportion of null probes is 710 = 0.70. (A) P-Value histogram
of null probes after SNM normalization. (B) P-Value histogram of all probes
after SNM normalization. (C) P-Value histogram of null probes after QN.
(D) P-Value histogram of all probes after QN. (E) P-Value histogram of null
probes after ISN. (F) P-Value histogram of all probes after ISN.

Wolﬁnger et (11., 2001; Wu and Irrizary, 2007; Wu et (11., 2004)
use all measured variables as a basis for normalization. Several
supervised methods have been developed for the analysis of dual-
channel microarrays (Baird et (11., 2004; Dabney and Storey, 2007;
Wolﬁnger et (11., 2001), and recent work has demonstrated that results
from supervised techniques offer a clear improvement over results
obtained from unsupervised approaches (Dabney and Storey, 2007).
However, these methods require highly structured experimental
designs and are not applicable to single-channel microarrays or
microarrays with several probes per gene.

We develop a framework for supervised normalization of
microarray data, which is applicable to a large class of experimental
designs and technologies, including single-channel arrays, dual-
channel arrays and different probe designs (e.g. one probe per
gene, probe sets and exon arrays). We focus the examples on
common sources of confounding variation and demonstrate that
the proposed supervised method accounts for their effects on
the data without perturbing the resulting inference. We provide
examples that show how the framework presented here can be
used to analyze several types of microarray data, thus unifying
the problems of data normalization for these alternative microarray
technologies.

 

1 309

112 /3.Io's[Bruno[pJOJXO'soiJBuiJOJuioiqﬂ:duq wort papeolumoq

9103 ‘{g anﬁnv 110::

B.H.Mecham et al.

 

2 APPROACH

In any given study, there are a set of study-speciﬁc variables
known to the researcher that are also capable of being included
in the model used to perform inference. These study-speciﬁc
variables fall into one of the two categories: biological variables
or adjustment variables. We deﬁne biological variables to be those
whose relationships with nucleic acid variation are the target of
the statistical analysis. The other variables, which are utilized as
covariates to account for other sources of variation, are what we call
adjustment variables. Essentially, adjustment variables are all of the
study-speciﬁc variables not of inferential interest in the study but
may correctly explain variation in the data. These include technical
variables such as dye, surface and probe-composition effects. They
include study design variables, such as batch, technical replicates,
or the dates on which the arrays were processed. Adjustment
variables may also include those that are biological in nature, but
not of interest in the study. For example, perhaps the goal is to
characterize the relationship between an experimental treatment and
gene expression, but the study is performed on both males and
females. If the relationship between sex and expression is not of
interest, then this variable would be included among the adjustment
variables.

The basic idea of the proposed approach and how it differs from
unsupervised methods is displayed in Figure 1. Figure 1A shows
that the proposed normalization approach utilizes all that is known
about the study (biology, study design and technology) in order
to perform the normalization. This allows for the signal due to
biology to be left intact in the normalized data. Figure 1B displays an
example of the model we ﬁt to the probe-level data from a microarray
study. The model has probe-speciﬁc terms, intensity-dependent
terms and may include other terms such as probe composition
effects or array surface spatial effects. The probe-speciﬁc terms
are partitioned between the biological variables and the adjustment
variables. The intensity-dependent terms are written as smooth,
random ﬁinctions of these probe-speciﬁc terms. We jointly ﬁt this
model to all probes simultaneously, allowing all relevant variables
to be properly included in the model. Our model ﬁtting procedure is
iterative in order to minimize confounding between the biological
variation of interest and the other sources of variation.

3 METHODS
3.1 Ageneral model

We ﬁrst consider the situation where the complete data from a microarray
experiment consists of three terms: the observed probe intensities.
biological variables and adjustment variables. The intensities are usually
presented as an m><n matrix. Y. where m and n describe the number
of probes and arrays in the entire study. respectively. Deﬁne yij as
the observed intensity for probe i=1,...,m on array j=1,..,n. and yi=
(yi1,yi2,...,yi,,) as the observed intensities for probe i across the n
arrays. The k-th biological variable for array j. xkj. describes factors
of interest such as disease status. experimental treatment. or time
point. All a’ covariates for an individual sample j are denoted by the
vector xj. and we group all n such vectors into a d><n matrix X:
(x1,...,x,,).

Similarly. the Eth adjustment variable for array j. zgj. pararneterizes
variables to be ﬁt in a probe-speciﬁc manner. Let rc denote the number of
probe-speciﬁc adjustment variables. When the baseline value of yij is not of
interest. this probe-speciﬁc intercept term is included among the adjustment
variables. Deﬁne the vector zj and matrix Z in a fashion analogous to the

one described for Xi and X. respectfully. Finally. we assume that there are
rf intensity-dependent effects. which we denote by fU- for effect I: 1, . . . , rf
and array j.

Note that we construct X and Z such that b, = 0 represents the case where
the biological variables of interest show no association with probe i. (This is
straightforward to construct even for time course studies; Storey et al. 2005.)
A concrete example of X and Z can be found in the Supplementary Material.

We model yij as linear combinations of xj. zj. and intensity-dependent
effects. The model for each probe intensity measurement is written as

d ’1: ’f
Vij=zbikaj+Zaizzzj+ U-(mij)+e,j. (1)
k2] [:1 [:1

where mi]- : 253:1 bikxkj +2221aigz5j. The coefﬁcients bik and am describe
the inﬂuence of the k-th biological and E-th adjustment variable on probe i ’s
intensity. We assume that the t-th intensity-dependent function fU- is a random
smooth function such that E[fU-(m)|m] :0 for all m. These are parameterized
as Normal distributed coefﬁcients applied to a B-spline basis (Supplementary
Material). The zero expectation can be made without loss of generality
because we allow for probe-speciﬁc offset terms (i.e. intercepts). which
absorb any systematic deviation from these intensity-dependent functions.
Finally. 2,} is the unexplained random error for probe i on array j with
E[eij] = 0.
We can write model (1) for probe i data across all n arrays. yi. as

’f
y, =b,X+a,z+Zf,(b,X+a,Z)+e,, (2)

[:1

where b, and a, are 1 ><a1 and 1 X rc vectors of the bik and am terms in (1).
andf,(b,»X+a,»Z)= (ﬁ1(mi1),...,ﬁ,,(mm)). The model for the entire dataset
Y can be written as
rf
Y=BX+AZ+Zf,(BX+AZ)+E, (3)

[:1

where B and A are m ><a1 and m X rc matrices of coefﬁcients. the i-th row
corresponding to b, and 3,». respectively. Also. f , (BX +AZ) is an m X n matrix
with the i-th row equal tof,(b,»X+a,»Z).

3.2 The goal of normalization

The statistical goal of microarray analysis is to infer relationships between
biological variables and individual probes or sets of probes. Different
microarray platforms employ different designs. Regardless of the platform.
relevant biological variation can be identiﬁed using individual probes. or
groups of probes that share certain biological characteristics; for example.
probes mapping to the same gene. chromosomal position or pathway. We
use the term ‘probe set” for any such grouping of probes. We ﬁrst establish
a deﬁnition of a correct normalization when inference is performed on
individual probes (e.g. when there is one probe per gene).

One property that a normalization should satisfy is that E[b,»] :0 when
bi=0 and E[b,»] 750 when bi750. Stated more directly. the normalization
procedure should preserve the biological relationships of interest in the
expected values of the estimated coefﬁcients corresponding to the biological
variables. A second. less obvious property is that a normalization method
should remove all latent structure shared across probes due to adjustment
variables. Speciﬁcally. any remaining component of the aiZ +  lf,(b,»X +
aiZ) term will induce dependence in the error terms across probes. and
unmodeled dependence has been shown to cause large-scale study-speciﬁc
biases (Leek and Storey. 2007. 2008). An imperfect normalization procedure
can bias the b, or induce new sources of latent structure shared across probes
(Dabney and Storey. 2007).

Violation of either of these properties can be seen in the joint distribution
of P-values obtained from testing H0, : b, :0 versus H1, : b, 750. Therefore.
we propose the following criteria as the ideal properties for a normalization
model to achieve.

 

1310

112 /3.Io's[Burno[pJOJXO'soiJBuiJOJuioiqﬂ:duq wort papeolumoq

9103 ‘{g anﬁnv 110::

Supervised normalization of microarrays

 

DEFINITION 1. Microarray Normalization Criteria.

(I) The set of ‘null P-values', obtained from testing H0, : bi =
0 versus Hlizbi #0 for all probes i where b,»=0, have a joint
distribution following the Uniform(0, 1) distribution.

(II) The set of ‘alternative P-values' obtained from the above hypothesis
tests forall probes i where b, 75 0 have a joint distribution stochastically
smaller than the Uniform(0, 1) distribution.

Correctly normalizing a microarray study is. therefore. a procedure that
preserves the biological relationships of interest and the expected operating
characteristics of the model ﬁts at the probe level. The framework we
introduce in this paper is designed to accomplish this goal. and numerical
evidence we give indicates it does so when all relevant variables have been
measured and included in the model.

We now explain how this deﬁnition relates to probe sets. The central
challenge for inference on probe sets is that technical sources of variation are
very much probe speciﬁc. while biological sources inﬂuence the entire set of
probes. For example. intensity-speciﬁc effects. probe nucleotide composition
and spatial effects are all most appropriately dealt with at the probe level.
while differential expression in response to a treatment is best measured in
terms of its effect across the entire set of probes measuring a given gene.

In our framework. a probe set summarization would combine all h, for
all probes i corresponding to a given probe set. where the bi coefﬁcients
parameterize the biological relationships for each probe. A general probe set
summarization for probe set k that takes this into account is

Z OlibiX.

itiESk
where the 01, have been chosen to represent relative reliability of probe i . the
set 8k is the set of all probe indices in probe set k. and Ziesk 01, = 1. Note
that if bi=0 for all ieSk then Ziesk a,»b,»=0. In other words. preserving
the proper operating characteristics of b, for all i also preserves them for
Ziesk alibi (notwithstanding issues with P-value calculations of multiple
variables. which is unrelated to the normalization problem).

Given that this general model for probe summarization lacks terms for
adjustment variables. and that statistical inference will be carried out on these
summarized values. the goal for normalization remains the same: namely. to
remove the inﬂuence of adjustment variables on probe intensities in order
to maintain their true relationships with the biological variables of interest.
This is the motivation for formulating the above goal in terms of inference on
probe-level data. making this goal relevant regardless of microarray platform.
technology or biological question.

3.3 Supervised normalization of microarrays

Our proposed method. called ‘supervised normalization of microarrays”
(SNM). ﬁts the model from Section 3.1 to all probes and arrays
simultaneously. The big picture idea of the method is to ﬁt a study-speciﬁc
model based on that in (1)7(3) to yield estimates 3,». a,» and ft. (Note that
there may be more terms in the model to account for other types of effectsi
see Supplementary Material.) The ﬁtted model can then be used accordingly
to perform subsequent analyses.

A key feature of SNM is that it involves simultaneously ﬁtting the
biological and study-speciﬁc adjustment variables. The fact that the intensity-
dependent effects are functions of terms to be estimated by the model
(i.e. BX +AZ) required us to develop a novel algorithm. The method we
propose attempts to estimate a set of probes that are not associated to the
biological variables (i.e. probes such that b,»=0). For ease of discussion.
we call any probe i such that bi=0 a ‘null probe” and any probe i such
that b, 750 an ‘alternative probe”. Once this set of null probes has been
identiﬁed. we estimate the intensity-dependent effects using only these
probes. Successfully doing so allows us to obtain estimates of the biological
variables” coefﬁcients satisfying the criteria from Section 3.2 . Thus. another
key feature of SNM is that it specially handles the biological variables in
order to obtain valid-ﬁtted model coefﬁcients of these variables.

The following are the main steps of the SNM algorithm; see
Supplementary Material for more details. such as speciﬁcally how we ﬁt
smooth. random functions to model the intensity-dependent effects.

 

Algorithm Supervised Normalization of Microarrays (SNM)

 

1. Let we {0, 1}”' be the m-vector indicating our estimate of whether b, :0
(w, = 0) or b, 75 0 (w, = 1). We initially set Wm) = {0, 0, . . . , 0}. We also initially
set 171,]- 2:11;] yij /n and 71(0) 2 1. where fro is the estimated proportion of
probes where b, :0.

Fors=0,1,2,...

2. Fit y,» = wg‘i)biX+aiZ+e,> to obtain 1;, and 3,». Set my- 2 22:1wg‘irbikxkj+
Zléﬁwzzj-

3. Let Y0 be the subset of Y composed of rows y,» such that w?) :0. Deﬁne

A0 and M0 analogously. Fit Y0 =A0Z+Z:f:lf,  to obtain A0 and?,.
r A A

4. Set Y* =Y—Zf:l ,(M).

5. Fit y?‘=b,»X+a,»Z+e,» and test bi=0 versus bi750. Use the q-value

methodology (Storey and Tibshirani. 2003) to form fry). the estimated
(s-l—l)_

proportion of true null probes. For the 71:) least signiﬁcant tests. set wt.

0+1) _

0; set wt. _ 1 otherwise.

Iterate Steps 2-5 until either my“) — 718% < e or a predetermined number of

steps has been reached.

6. To perform statistical inference or probe set summarization. adjust the data
by
’f

31:39! E JIGiX—l—aiz)’
[:1
and perform all subsequent inference according to the model

y?“=b,»X+a,»Z+e,». (4)

For exploratory analyses. such as clustering or principal components
analysis. adjust the data for probe i by

rf
y?“ = y,» —§iZ — Eff @iX +§,Z).
[:1

 

The reason we provide two different types of data adjustments in Step 6 is
that exploratory analyses of the biological signal are best carried out on data
where all signal not of interest has been modeled and removed. However.
for statistical inference. it is necessary to account for the variation explained
and degrees of freedom utilized by the adjustment variables. aiZ. It should
be noted that the model ﬁts we obtain at the ﬁnal iteration of Steps 275 are
exactly what would be obtained when ﬁtting model (4) anyway.

4 RESULTS

Unsupervised normalization methods make data transformations
based on graphical trends visible in diagnostic plots. QN (Bolstad
et al., 2003) transforms the data so that a quantile—quantile plot
comparing the ordered probe intensities between any two arrays
in a study is equal to the line y=x (Fig. 1A); ISN (Li and Wong,
2001) transforms the data so that a plot comparing the intensities
of a selected subset of probes between any two arrays is centered

 

1311

112 /3.Io's[eurno[p.IOJxosoneuIJOJuioiq”:duq wort papeolumoq

9103 ‘{g anﬁnv 110::

B.H.Mecham et al.

 

about the line y=x; and MA-normalization (Dudoit et al., 2002;
Tseng et al., 2001; Yang et al., 2002) transforms the data so that
the relationship between the difference between two groups and
their average value is centered about the line y=0. The implicit
assumption behind each of these unsupervised methods is that
transforming the data to satisfy these criteria removes all variation
due to technical variables, but does not change the signal due
to biological variables. Interestingly, an implicit assumption of
QN is also that the probe intensity distributions among arrays is
always exactly the same, regardless of biology or study design. This
precludes different overall levels and variation of mRNA across
biological conditions, as well as any overall asymmetric differential
expression.

In this section, we demonstrate the operating characteristics
of SNM through simulations and real data analysis, and make
comparisons to the ON and ISN approaches. We also make
comparisons to the eCADS method (Dabney and Storey, 2007),
which is well suited for balanced two group comparisons on
dual-channel arrays and has been shown to outperform the MA-
normalization approach.

4.1 Simulations

While the set of biological and adjustment variables to be utilized
may vary from study to study, we present simulations in the context
of several variables most commonly used: array, batch and dye
effects (Baird et al., 2004; Dabney and Storey, 2007; Wolﬁnger
et al., 2001; Wu and Irrizary, 2007; Wu et al., 2004). For each
type of variable we describe results from data simulations. In the
ﬁrst scenario, we demonstrate how to estimate array effects in the
presence of biological signal. These simulations mimic the most
commonly assumed models for single channel microarray data such
as that provided by Affymetrix. Then, we extend this to a scenario
where we also estimate batch effects, an adjustment variable that
arises in many large microarray datasets, and, as shown below,
can also be present in smaller studies. Finally, we apply SNM
to a scenario based on two-color experiments where the signal is
inﬂuenced by intensity-dependent dye and array effects.

A total of 100 simulated studies were carried out for each of the
three scenarios, with the biological and technical effects simulated
as follows. Data were simulated for a total of 100 000 probes and 12
arrays. The biological variable of interest is a dichotomous variable
deﬁning two groups (Groups 1 and 2) with six arrays sampled from
each group. A randomly selected set of 30000 probes were deﬁned
as differentially expressed between two groups, with the magnitude
of the difference sampled from the Normal(1,1) distribution.

To make our simulations as realistic as possible we based our
sampling of baseline probe intensities on data from a commonly
used spike-in study (Irizarry et al., 2003). Speciﬁcally, the baseline
probe intensities were sampled from a distribution consisting of the
mean raw probe intensities for each of the 201 800 probes used in
this study.

The random variation terms el-j were sampled from a Normal
distribution with mean 0 and a probe-speciﬁc variance term that
was sampled from the Uniform(0.2,0.4) distribution. This implies
that each probe does not have the same variance. The array and
dye ﬁinctions were deﬁned by randomly selecting coefﬁcients for
a two-dimensional B-spline basis ﬁinction from a N(0,0.752), the
probe-speciﬁc batch effects were sampled from a N(0,0.42).

Table 1. Results from data simulations

 

Average fro (710 = 0.70) No. signiﬁcant KS-tests

 

Simulations ISN QN SNM eCADS ISN QN SNM eCADS

 

Array 0.55 0.54 0.75 NA 100 100 1 NA
Array + batch 1.00 1.00 0.74 NA 100 100 4 NA
Array + dye NA NA 0.73 0.72 NA NA 4 1

 

Shown are the average estimated n0 statistics and the KS-tests of Criterion I. The KS-
tests were performed at the 0.05 level, so we expect 5 of 100 to be signiﬁcant when
Criterion I holds, and many >5 to be signiﬁcant when the criterion does not hold. We do
not include results of testing for Criterion 11 because all methods passed this criterion
in these simulations.

For the ﬁrst two scenarios, we compare the SNM normalized
data to QN and ISN normalized data. For the third simulation, we
compare the SNM results to those obtained from eCADS. For all
three simulations we use Kolmogorov—Smirnov tests (KS-test) to
assess the validity of each normalization method in terms of the
criteria described in Section 3.2 deﬁning the desired normalization
operating characteristics. To assess Criterion I, we use a two-sided
KS-test to compare the distribution of observed P-values from the
null probes to a Uniform(0,1) distribution. To assess Criterion II,
we use a one-sided KS-test to compare the distributions of P-values
from the alternative probes to a Uniform(0, 1) distribution. Both tests
are performed at the 0.05 level, so we expect 5 or less signiﬁcant
tests out of 100 when the criteria are satisﬁed. The results of these
simulations are summarized in Table 1.

4.1.1 Array eﬁ’ects The data were simulated according to the
above protocol where only the biological group differences and
intensity-dependent array effects were included. In terms of the SNM
model: Y is a 100000 X 12 matrix of probe intensities; X is a l X 12
matrix indicating Group 2 membership; Z is a l X 12 matrix of 1’s
parameterizing the intercept term; and f (BX +AZ) is a 100000 X 12
matrix that represents the intensity-dependent array effects. Note that
under this construction, we achieve that b,- =0 is equivalent to no
difference in mean probe intensities between Groups 1 and 2.

We normalized data from each of the 100 simulations using
SNM, QN and ISN. Figure 2 presents representative histograms of
P-values of null probes after normalization using SNM (Fig. 2A),
QN (Fig. 2C) and ISN (Fig. 2E). In relation to Criterion I, we expect
these P-values to be Uniform(0,1). While the SNM approach appears
to meet this criterion, the null P-values from the unsupervised
methods are clearly not Uniform(0,1). Of the 100 simulated studies,
1, 100 and 100 were signiﬁcant for SNM, QN and ISN, respectively.

We examined the estimated 710 statistic for each simulation, which
is the proportion of true null probes (Storey, 2002; Storey and
Tibshirani, 2003). Recall that in this simulation the true 710 =70%.
The 95% conﬁdence intervals of fro from the 100 simulations are
0.71 :l:0.04 for SNM, 0.54:l:0.05 for ON and 0.55 :l: 0.04 for ISN.
The distributions of all P-values are presented in Figure 2B, D and
F for SNM, QN and ISN, respectively. These results suggest that
including the study-speciﬁc biological variables provides unbiased
inference, while the inference derived from unsupervised methods
is biased by the asymmetric biological signal.

We also performed a KS-test of Criterion II, speciﬁcally whether
the alternative P-values have a joint distribution stochastically

 

1312

112 /3.IO'S[1211,1110prOJXO'SOIJBLUJOJIIIOIq”Idllq uror} papeo1umoq

9103 ‘1gisn8nv 110::

Supervised normalization of microarrays

 

h

PERCENTAGE 05 tom

 

PERCENTAGE OF TOTAL

 

0.3
P VALUES

0

PE RC ENTAGE OF TOTAL

 

05
P VALUES

Fig. 3. Summary of null P-values from simulated data with differential
expression. batch and array effects. The true proportion of null probes is 710
= 0.70. (A) P-value histogram of null probes after the SNM normalization.
(B) P-value histogram of null probes after QN. (C) P-value histogram of
null probes after QN using a model that includes a term for the batch effects.

smaller than the Uniform(0, 1) distribution. Among the 100 simulated
studies, 0 tests were signiﬁcant for SNM, QN and ISN. These results
suggest that SNM, QN and ISN satisify Criterion II.

Taken together, these results suggest that SNM satisiﬁes Criteria
I and II for a correctly normalized study in this scenario, while
QN and ISN do not satisfy Criterion I. The bias of QN and ISN
is anti-conservative, meaning that P-values have been spuriously
made smaller than they should be.

4.1.2 Array eﬁ’ects plus batch eﬁ’ects The simulated probe
intensities for the second scenario included biological, array and
batch effects as described above. Batch effects generally arise due
to some need of the experimenter to manufacture or hybridize the
arrays in groups; the real data example we consider below includes
a batch effect. To apply SNM, we used the same model as in the
previous simulation, except now Z is a 2 X 12 matrix parameterizing
the probe-speciﬁc intercept terms in the ﬁrst row and an indicator
of batch in the second row.

SNM was applied to normalize data from each of the 100
simulated studies. In the KS-test of Criterion I, 4 out of 100 were
signiﬁcant. The 95% conﬁdence intervals for fro was 0.72:l:0.04.
In the KS-test of Criterion II, 0 out of 100 were signiﬁcant. Thus, it
appears SNM again provides a valid normalization in this simulation
scenario.

Given that there is an extra study-speciﬁc variable, we applied
QN and ISN in two ways. First, we ignored the batch variable
throughout the analysis. In other words, after normalization, batch
was not utilized as an adjustment variable when testing the probes for
differential expression between Groups 1 and 2. Of the 100 simulated
studies, all 100 were signiﬁcant for the KS-test of Criterion I for both
QN and ISN. The 95% conﬁdence intervals for the fro were 1 :l:0
for both QN and ISN.

Figure 3B shows a plot of the null probe P-values when applying
QN. (The analogous plot for ISN shows the same qualitative result
and can be found in Supplementary Fig. 1E.) It can be seen that the
null P-values have been biased in a conservative fashion, pushed
towards one. This is due to the fact that ignoring the batch variable
induced systematic variation in the probe intensities that was not
taken into account.

We then applied QN and ISN in a second way, this time including
batch as an adjustment variable in the test of differential expression
after normalization. This would likely be the recommended way to
include the batch variable when utilizing an unsupervised approach.
Speciﬁcally, the unsupervised normalization is carried out ignoring
the batch variable in addition to the biology variable, and then
both are included in the analysis on the normalized data. Of the
100 simulated studies, all 100 were signiﬁcant for the KS-test of
Criterion I for both QN and ISN. The 95% conﬁdence intervals for
the fro were 0.52:l:0.03 for QN and 0.53 :l:0.04 for ISN. Among
the 100 simulations, 0 were signiﬁcant for the criterion II test for all
three normalization methods.

Figure 3C shows a plot of the null probe P-values when applying
QN in this manner. (Again, the analogous plot for ISN shows the
same qualitative result and can be found in Supplementary Fig. 1F.)
Now, the null P-values are anti-conservatively biased; they are
pushed toward zero as in the previous scenario. This follows because
the systematic variation due to batch has now been modeled at the
inference stage, and the anti-conservative bias due to array effects
has returned. Additionally, since now both the biology and batch
variables were not utilized in the unsupervised normalization, the
null P-value bias and ﬂuctuation from study to study have become
more unpredictable.

4.1.3 Array eﬁ’ects plus dye eﬁ’ects The probe intensities for
the third simulation scenario included biological effects, array
effects and intensity-dependent dye effects as described above.
Dye effects arise in experiments that use two-color microarrays
because of different incorporation rates of the Cy3 and Cy5
ﬂuorescent dyes. To apply SNM, all terms in the model were
deﬁned exactly as in the ﬁrst scenario, except we now deﬁned
f1(BX+AZ) to be a 100000><12 matrix that represents the
intensity-dependent array effects and f 2(BX+AZ) to be a
100 000 X 12 matrix that represents the intensity-dependent dye
effects. The study-speciﬁc model for this case is, therefore,
Y=BX +AZ+f1(BX +AZ)+f2(BX+AZ)+E.

SNM and eCADS were used to normalize data from each of
the 100 simulated studies. Of the 100 studies, 4 KS-tests were
signiﬁcant for Criterion I when applying SNM and l was signiﬁcant
when applying eCADS. The 95% conﬁdence intervals for the fro
were 0.73 :l: 0.03 for SNM and 0.72 :l: 0.03 for eCADS. Among the
100 simulations for both SNM and ON, 0 were signiﬁcant for the
Criterion II test. These results show that SNM and eCADS behave
similarly in this scenario, both providing acceptable norrnalizations.

 

1313

112 /3.IO'S[1211,1110prOJXO'SOIJBLUJOJIIIOIq”Idllq uror} papeo1umoq

9103 ‘1gisn8nv 110::

B.H.Mecham et al.

 

60.6050“ 0 7 71414

   

 

 

 

0 7146050 014 7’

Fig. 4. Results from Vascular Development Study obtained from QN and
SNM. The relationship between samples after normalization are presented as
a clustering dendogram. The labels for each node denote the corresponding
age of the sample hybridized to that array. and the colored boxes indicate
the batch. Note that the SNM results correctly position biological replicate
samples on adjacent nodes (A). and predicts a robust effect of age on gene
expression [fro = 0.51 (C)]. Conversely. the ﬁrst bifurcation in the QN data
separates the data by the batch (B) and these data suggest there is no effect
of age on gene expression [fro = 1 (D)].

In fact, eCADS can be viewed as a special case of the more general
SNM framework.

4.2 Vascular development study

A study was carried out designed to measure the association between
gene expression levels and aging in the mouse aorta. Aorta were
micro-dissected from mice aged 1, 7, 14 and 60 days, RNA was
extracted, a single RNA pool was generated for each age, and each
pool was hybridized to a single Affymetrix mouse430 version 2
microarray. This entire experiment was carried out twice, resulting
in two technical batches.

We ﬁrst veriﬁed that there are intensity-dependent array effects
and effect due to the two batches. To this end, we regressed age on the
unnormalized data by for each probe, ignoring batch and intensity-
depdendent effects. On the residuals resulting from this regression,
we investigated the relationship across arrays using hierarchical
clustering (Supplementary Fig. 2A). From this clustering, it can
be seen that there is a strong batch effect in this study. Finally,
the relationship between overall intensity and the array-speciﬁc
residuals were plotted for each array (Supplementary Fig. 2B). This
result shows that there exist non-linear trends between intensity and
the remaining error. Taken together, these results suggest that batch
and intensity-dependent array effects contribute to the variation of
probe level measurements.

Next, we applied SNM to the study. In relation to model (3),
Y is a 450000 X 8 vector of observed intensities, X pararneterizes
the different ages and Z represents the parameterized probe-speciﬁc
intercepts and batch effects. The results when applying SNM are
shown in Figure 4. First, note that the histogram of P-values
(Fig. 4C) suggests that age has a pronounced effect on differential
expression (fro =0.53). Many genes with known roles in vascular
biology exhibited robust changes in expression across this time

series, suggesting that the experiment-captured biological signal.
For example, previous work identiﬁed a cluster of seven genes
whose expression is activated soon after birth (List C Elastic Fiber
Genes from McLean et al. 2005). Moreover, the relationship across
samples, as described by a clustering dendrogram, correctly places
the replicate arrays for each age on adjacent nodes (Fig. 4A).

We also investigated the results when these data are normalized
with the two unsupervised normalization procedures considered
above, ISN and QN. The histogram of resulting P-values from
QN is shown in Figure 4D. Results for the ISN method are nearly
identical (as in the simulations) and are not shown here. Note that
both approaches estimate fro = 1, suggesting that there are no genes
differentially expressed between the four ages explored in this study.
This result directly contradicts previously published data from a
similar study (McLean et al., 2005) . Moreover, the clustering of the
normalized data, shown in Figure 4B, suggests that batch exhibits
a stronger inﬂuence on the variation of the ON normalized data
than does the biology. This analysis provides a real data example
that supports the results from the data simulations explored earlier,
and the results suggest that the SNM approach outperforms the
unsupervised approaches in this example.

5 DISCUSSION

In this article, we described a framework for the normalization
of microarray data. The central premise of this work is that the
study under investigation should inform the normalization process.
The framework is intended to be general enough to address most
microarray studies, regardless of platform or biological goal. The
examples we explored were selected as they are commonly occurring
in practice and clearly describe the effects on inference of ignoring
relevant information from an analysis. We note that the study-
speciﬁc models utilized in this paper will not satisfy all studies.
Rather, we view this work as a general supervised normalization
framework based on a well-deﬁned goal, namely to remove the
effects of adjustment variables without biasing inference, and the
examples as a means to illustrate the beneﬁt of this approach. A
researcher would utilize this framework to build a study-speciﬁc
model and then apply the proposed algorithm, which is quite
general.

The results presented in this paper demonstrate some of the
problems associated with unsupervised normalization methods. For
example, the simulations show how such approaches can introduce
signal in the presence of asymmetric biological variation. Similarly,
the simulations and vascular development example make clear
that unsupervised approaches ignore effects of study design on
expression data. Finally, these approaches make the assumption that
few genes are differentially expressed, an assumption that is clearly
false in many settings. These and other limitations of unsupervised
methods are the motivation for this work.

The framework is designed to handle a variety of study designs.
We presented a modeling strategy that is designed to model
relevant study-speciﬁc variables (e.g. probe-speciﬁc biological
effects, probe-speciﬁc technical effects and intensity-dependent
effects). The ﬂexibility of our modeling strategy is demonstrated
by the fact that it straightforwardly derives previously described
supervised normalization models for more specialized experimental
designs and technologies (Baird et al., 2004; Dabney and Storey,
2007; Wolﬁnger et al., 2001). Another beneﬁt is that other terms

 

1314

112 /3.IO'S[1211,1110prOJXO'SOIJBLUJOJIIIOIq”K1111] uror} papeo1umoq

9103 ‘1gisn8nv 110::

Supervised normalization of microarrays

 

described in the literature can be included. We describe such a
process for probe sequence effects in the Supplementary Material.
These and other beneﬁts support the claim that we have presented
a ﬂexible set of models for the normalization and analysis of
microarray data.

Model building is paramount to successful implementation of
any supervised normalization, including ours. Properly deﬁning the
model for a given study requires that relevant biological and study-
speciﬁc adjustment variables of interest are known to the analyst, a
situation that is rarely present in the clinical setting. The vascular
development example shows one of many approaches to diagnose
a model from a given dataset. In this work, we focused less on the
difﬁculties associated with this approach; however, future work will
address diagnosing models from the existing data.

Given the potential difﬁculties associated with knowing the true
model, we base our framework on a goal that can be used to
understand the validity of a study-speciﬁc model. The idea to remove
the effects of technical variables without biasing inference has its
roots in ideas originally presented in Dabney and Storey (2007);
Leek and Storey (2007, 2008). To our knowledge, we are the
ﬁrst to explicitly state a goal for microarray data normalization.
Three positive contributions of this goal are: (i) it uniﬁes results
from any particular instance of a study-speciﬁc model; (ii) basing
a normalization algorithm on this goal clariﬁes its purpose and
expected operating characteristics; and (iii) attaining this goal
suggests that the experimenter understands all systematic sources
of variation present in the data. This last point is important as it
allows a user to understand when their assumed model accounts for
variation from all relevant study-speciﬁc variables.

ACKNOWLEDGEMENTS

We thank Dr Robert Mecham and Dr Sean McLean, Washington
University School of Medicine, for providing the mouse vascular
array data.

Funding: National Institutes of Health grants T32 HG00035 and T32
CA80416 (to B.H.M.); PNW Prostate SPORE CA097186 and R01
DK069690 (to P.S.N.); R01 HG002913 (J.D.S.).

Conﬂict of Interest: none declared.

REFERENCES

Baird,D. et al. (2004) Normalization of microarray data using a spatial mixed model
analysis which includes splines. Bioinformatics, 20, 3196.

Bolstad,B. et al. (2003) A comparison of normalization methods for high density
oligonucleotide array data based on variance and bias. Bioinformatics, 19, 1857193.

Dabney,A. and Storey,J. (2007) Normalization of two-channel microarrays accounting
for experimental design and intensity-dependent relationships. Genome Biol, 8,
R44.

Dudoit,S. et al. (2002) Statistical methods for identifying differentially expressed genes
in replicated cDNA microarray experiments. Stat. Sin., 12, 1117140.

Irizarry,R. et al. (2003) Summaries of Affymetrix GeneChip probe level data. Nucleic
Acids Res, 31, 615.

Irizarry,R. et al. (2006) Feature-level exploration of a published Affymetrix GeneChip
control dataset. Genome Biol, 7, 404.

Leek,J. and Storey,J. (2007) Capturing heterogeneity in gene expression studies by
surrogate variable analysis. PLoS Genet, 3, 6161.

Leek,J. and Storey,J. (2008)A general framework for multiple testing dependence. Proc.
NatlAcad. Sci., 105, 18718.

Li,C. and Wong,W. (2001) Model-based analysis of oligonucleotide arrays: model
validation, design issues and standard error application. Genome Biol, 2, 003271.

McLean,S. et al. (2005) Extracellular matrix gene expression in the developing mouse
aorta. In Jeffrey H. Miner, (ed.) Extracellular Matrix in Development and Disease.
Vol. 15 of Advances in Developmental Biology. Elsevier, San Diego, CA.

Rattray,M. et al. (2006) Propagating uncertainty in microarray data analysis. Brief
Bioinformatics, 7, 3747.

Storey,J.D. (2002) A direct approach to false discovery rates. J. R. Stat. Soc. B, 64,
479498.

Storey,J.D. and Tibshirani,R. (2003) Statistical signiﬁcance for genome-wide studies.
Proc. Natl Acad. Sci., 100, 944079445.

Storey,J.D. et al. (2005) Signiﬁcance analysis of time course microarray experiments.
Proc. Natl Acad. Sci., 102, 12837712842.

Tseng,G et al. (2001) Issues in cDNA microarray analysis: quality ﬁltering, channel
normalization, models of variations and assessment of gene effects. Nucleic Acids
Res., 29, 2549.

Wolﬁnger,R. et al. (2001) Assessing gene signiﬁcance from cDNA microarray
expression data via mixed models. J. Comput. Biol, 8, 625$37.

Wu,Z. and Irrizary,R. (2007) A statistical framework for the analysis of microarray
probe-level data. Ann. Appl. Stat, 1, 333.

Wu,Z. et al. (2004) A model-based background adjustment for oligonucleotide
expression arrays. J. Am. Stat. Assoc., 99, 9097917.

Yang,Y. et al. (2002) Normalization for cDNA microarray data: a robust composite
method addressing single and multiple slide systematic variation. Nucleic Acids
Res., 30, 615.

 

1315

112 /3.Io's1eurnoprOJxosorwurrowrorq”:duq uror} papeo1umoq

9103 ‘1gisn8nv 110::

