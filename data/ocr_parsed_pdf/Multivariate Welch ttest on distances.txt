Bioinformatics, 2016, 1—7

doi: 10.1093/bioinformatics/btw524

Advance Access Publication Date: 11 August 2016
Original article

 

Genome analysis

Multivariate Welch t-test on distances
Alexander V. Alekseyenko

Departments of Public Health Sciences and Oral Health Sciences, Program for Human Microbiome Research, The
Biomedical Informatics Center Medical University of South Carolina, 135 Cannon Street, MSC 200, Charleston, SC
29466, USA

*To whom correspondence should be addressed.
Associate Editor: John Hancock

Received on April 1, 2016; revised on June 21, 2016; accepted on August 6, 2016

Abstract

Motivation: Permutational non—Euclidean analysis of variance, PERMANOVA, is routinely used in
exploratory analysis of multivariate datasets to draw conclusions about the significance of patterns
visualized through dimension reduction. This method recognizes that pairwise distance matrix be—
tween observations is sufficient to compute within and between group sums of squares necessary
to form the (pseudo) Fstatistic. Moreover, not only Euclidean, but arbitrary distances can be used.
This method, however, suffers from loss of power and type I error inflation in the presence of heter—
oscedasticity and sample size imbalances.

Results: We develop a solution in the form of a distance—based Welch t—test, T2, for two sample
potentially unbalanced and heteroscedastic data. We demonstrate empirically the desirable type
I error and power characteristics of the new test. We compare the performance of PERMANOVA
and TVZV in reanalysis of two existing microbiome datasets, where the methodology has
originated.

Availability and Implementation: The source code for methods and analysis of this article is avail—
able at https://github.com/alekseyenko/Tw2. Further guidance on application of these methods can

 

be obtained from the author.
Contact: alekseye@musc.edu

 

1 Introduction

The PERMANOVA test (Anderson, 2001), has been proposed for
use in numerical ecology to test for the location differences in micro-
bial communities. The relationships between these communities are
typically described by ecological distance metrics (e.g. Jaccard, Chi-
Squared, Bray-Curtis) and visualized through dimension reduction
(also referred to as ordination in numerical ecology literature). The
PERMANOVA permutation test based on (pseudo) P statistic com-
puted directly from distances is a widely accepted means of estab-
lishing statistical significance for observed patterns. This test and
the extension of this paper are related to the multivariate Behrens-
Fisher problem (Krishnamoorthy and Yu, 2004) of testing the differ-
ence in multivariate means of samples from several populations. The
underlying statistics for both distance-based tests are related to the
Hotelling T2 statistic. The PERMANOVA is more general in allow-
ing for more than two populations to be compared simultaneously.

(6) The Author 2016. Published by Oxford University Press.

The distance-based geometric approach; however, forgoes the need
to estimate the covariance matrices. The cost of these geometric
approaches is that they only provide omnibus tests, which are un-
able to make inferences about individual components of the multi-
variate random vectors tested.

With the revived interest in numerical ecology fueled by the avail-
ability of DNA sequencing-based high-throughput microbial commu-
nity profiling, i.e. microbiomics, the PERMANOVA test is enjoying a
new wave of popularity. Several, cautionary articles have been pub-
lished noting the undesired behavior of the test in heteroscedastic con-
ditions (Warton et (11., 2012). A definitive principled solution to this
issue is still lacking, however. The consensus is to ascertain the pre-
sence of heteroscedasticity using an additional test (e.g. PERMDISP;
Anderson, 2006; Anderson et (11., 2006) in case of positive
PERMANOVA results and to report both with a disclaimer that the
attribution of positive PERMANOVA test to location or dispersion

1

This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (http://creativecommons.org/Iicenses/by-nc/4.0/),
which permits non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited. For commercial re-use, please contact

journals.permissions@oup.com

/310‘srcumo[p10}xo‘sopcuHOJIItotq/ﬁdnq

()ksanen (7/ LI/., 2015

Figure 1

Elfecl: 2

R (Lore Team, 2015

Eﬂacl: 4

Eusct: 5

Table 1

Balanced sample size

. No
A Ves

Observations
In least dispersed
sump e

-5
.10
.15
.20

 

/310'SIBano[pJOJxo"sotJBuiJOJutotqﬂ:duq

Multivariate Welch t—test

 

 

 

: (z1, . . . ,znﬁny) be the concatenation of the observations in X and
Y, then 5 : (11x)? + nyy)/(nx + 11,) is the sample mean of Z. We can
write:
"xny — — 2 "xny —2 —— —2
— x — : — x — 2x + 8
"Hm y) nx+ny( y y) ()
= 1 lnxnyﬁz — "mm + "mil (9)
11,, + My
—nxny9237 + niyz — niyz + niiz — 11:9?2] (10)
2 1 lnxaEZ<nx + ny) + nyy2(nx + 11,) (11)
nx + n,
‘75:”2 ("x92 + ﬂy?) _ "M70569? + “y?” (12)

: nxﬁz + nyyz — nxﬁz — 11ny + nxéz + 11,52 (13)

my? + 11,)! _
14
"x + "y ("x + nyk ( l
: (11xe — nxazz — 11,922 + nxzz) (15)
+(nyy2 — nyyz — 11ny + 11,52) (16)

Now consider the first term of Equation (16).

71x

(11xe — 211,922 + 11,22) : 2(2922 — 922 — 2925 +22) (17)
: 22%sz — z) — (x2 — z2)) (18)
2:7"(£—2)(2x,~—x—2) (19)
:fooc,—z—xi+x)(xi—z+xi—x) (20)
2  (x, _ z)2 —  (x,- — if. (21)

The combined contribution of the first terms of (21) from a? and y
terms of (16) can be written in terms of pairwise differences of 55:

:2“ (x:- — z>2 + Z?" (w — z>2 = 21:? (a — z>2

1
* ZK/(zi — z,)2. (22)

11,, +11y

 

This and Equations (6), (16) and (21) imply that the square of
mean difference is expressable in terms of sums of squares of pair—
wise differences:

 

___Zinx+ny
(x y) ——nxny

1 Z (Z._Z.)2_iZ (x._x.)2_iZ (._ .)2
11x+11y i<i I I nx i<i I I ny i<iyl y] '

(23)

Finally, Equations (7) and (23) can be put together to form the
Welch t—statistic (1) in terms of only the squares of the pairwise
differences.

The point differences can be thought of as distances. Let
D : {diy},-J-:1wnx+ny be the matrix of absolute pairwise differences,

dijzabS(Zi—Z/‘): (zi—z;)2. The elements of D are in fact

Euclidean distances between data points in one—dimension. Now the
sums of squares can be expressed in terms of diy’s:

71;, +71).

Zi<j<zi _Z/)2 :  dizi7 (24)

i</
i.j:1

Esra—w: : d2) (25>

i</'
i./':1

71;, +71).

2 2
Zi</(yi_y/) :  di/ (26)
1</
i.j:nx+1

In terms of squares of pairwise distances the Tég statistic can be writ—

 

 

tenas
11 +11
2 7 X y
TW——><
11,611y
n+n. n nx+n.
1 x ’ 1 x 1 ’
X Zd%-—Zd%-— Z d?
nx+ny.<.’ nx.<.’ ny .<. l
1 / 1 / 1 / 
i./':1 i./':1 i.j:nx+1
+71.
1 “x 1 “x >
— d%+— Z d?
2 _ Z I, 2 _ I,
nx(nx  i<j ny(n)/  i<j
i./':1 i.j:nx+1

Note that Equation (24) expresses total sums of squares, and
Equations (25) and (26) express the within sample sums of squares
in terms of distances, while the term in square brackets of Equation
(23) corresponds to between group sums of squares. These are the
same terms that appear in the PERMANOVA two—sample
(pseudo)F statistic computation. Here we write the PERMANOVA
statistic for the two sample case and arbitrary nx and 11,:

1 nx+ny 2 1 "X 2 1 nx+ny 2
m 2 dij — Z Z dij — ,7). Z dij
i<j i <j i < j
1-,):1 i./':1 i./':nx+1

1 2 1 2
EZI</d‘/WZ‘</d‘/

nx +n,.—2

 

FA 2 (28)

It is easy to check that when the sample sizes are balanced, nxzny,
or within group sums of squares are equal, iZKI-dizj : niyZKI-dizj,
then FA and Tév differ by a multiplicative factor that only depends
on 11,, and 11,. This means that inference under the two statistics will
be different when both unbalanced sample sizes and heteroscedastic—

ity is present, which may help Tég correct the adverse behavior of
PERMANOVA observed in Figure 1 and Table 1.

3.2 Multivariate extension
Next we examine a multivariate extension of the distance—based Tév
statistic. Let the observations be multivariate vectors, Z :

(x1,. .. ,an,Y1,.. .,Y,,y), where x, : (X111), . . . ,Xfml) and Y, :
(SKI-(1),. . . , Yl-(m)) are of arbitrary dimension m. As before, let D : {diy}
be the pairwise matrix of Euclidean distances d); : HZ, — Zyll :

227:1 (ng) — Z1052. We use these distances in place of their uni—

variate counterpart to compute Tég and FA. By extension arbitrary
distances (e.g. Jaccard, Bray—Curtis etc.) can be used for this purpose.
Note that in contrast to the PERMANOVA statistic the distance—
based Té, explicitly accounts for potentially unbalanced number of

ﬁlO'SIlZIImOprOJXO'SOplZILLIOJLIIOIQ/[idnq

Kell) 6/ .11., 2015

Effect: 4 Elleth 5

Balanced sample size
- No
A Yes

Statistical

+ PERMANOVA
Tw2

observations

in leasl dispersed

sample

- 5

u 10

O 15

Q 20

 

Fig. 2
Fig. 2

Fig. 2

Fig. 2
Fig. 2

Fig. 3a and b
Fig. 3a

Fig. 3a

Fig. 2

1‘1ng

/310'SIBanoprOJxo"sotJBuiJOJutotqﬂ:duq

Fig. 3b

Alekse} enko 6/ LI/., 2013

Table 2

Cho (’1 rr/., 2012

Cohen, 198 8

Effect: 4

L

Effect: 5

W

 

Table 3

I
I. O
o
o O.
O o
. 'c
o
I
28.6%; P02

   

Effect: 0 7 Effect: 5

Observations
in leasl dispersed
sample

-a
.9
010
.11
.12

Balanced sample size
- No

A Ves
Statistical
test

+ PERMANOVA
Tw2

 

Fig. 4

 

/310'SIBanoprOJxo"sotJBuiJOJutotqﬂ:duq

A. V.Alekseyenko

 

Table 2. Comparison of PERMANOVA and TVZV on mouse gut microbiome dataset

 

Cecal micro biome

Fecal microbiome

 

 

P-values P-values
Comparison N obs. H (o2 d PERMANOVA Tév N obs. H (o2 d PERMANOVA Tév
C. versus all abx. 10 versus 40 1.4 0.22 1.21 0.040 0.0001 10 versus 36 1.4 0.29 1.34 0.015 0.0014
C. versus penicillin 10 versus 10 0.85 0.12 1.90 0.00001 0.00002 10 versus 9 1.1 0.07 1.94 0.015 0.015
C. versus vancomycin 10 versus 10 1.8 0.08 2.26 0.00009 0.0001 10 versus 9 1.6 0.21 2.70 0.00001 0.00002
C. versus tetracycline 10 versus 10 1.2 0.12 2.05 0.00005 0.00005 10 versus 10 1.0 0.07 1.89 0.007 0.006
C. versus vancomycin + 10 versus 10 1.1 0.10 1.97 0.002 0.002 10 versus 8 1.4 0.11 2.24 0.001 0.002

tetracycline

 

Table 3. Comparison of PERMANOVA and TVZV on human skin microbiome dataset

 

 

P-values
Comparison N obs. H (02 d PERMANOVA Tév
Control versus Lesion 49 versus 51 1.07 0.014 0.77 0.0003 0.0002
Control versus Unaffected 49 versus 51 1.04 —0.0006 0.60 0.5 0.5
Lesion versus Unaffected 51 versus 51 0.97 0.004 0.62 0.07 0.07

 

the multivariate spread is similar in all conditions, and sample sizes
are larger and closer to being balanced.

5 Discussion

By derivation 1%), inherits the characteristics of the univariate un—
equal variance Welch t—test. That test is recommended as a replace—
ment for pooled variance t—test in all circumstances. Testing for
unequal variances by methods, such as PERMDISP, is not recom—
mended before a choice of the primary test is made. The main disad—
vantage of the Welch’s t—test compared with ANOVA is potential
loss of robustness when violations of normality are present (Levy,
1978). This issue, however, rests on the limiting distributions of the
tests. In our case, the inference is obtained by permutation testing,
which alleviates this concern. Thus Tév should also become a first
line replacement for PERMANOVA in simple two—sample case.
Two—sample scenario is a common experimental design, but a
general solution for k—level factors is still desirable. The behavior of
PERMANOVA under heteroscedastic conditions with k—level fac—
tors have not been examined, but is suspected to suffer from similar
shortcomings as in the two sample case. When heteroscedasticity is
suspected, several remedial strategies can be implemented. First, a
variance stabilizing transformation can be applied to the data to re—
move heteroscedasticity (McMurdie and Holmes, 2014). If trans—
formation of the data is not desirable for any reason, other strategies
could include developing specialized sub—sampling and permutation—
based strategies. For example, the data could be re—sampled in times
at balanced sample sizes and an average PERMANOVA statistic
computed FA : % ZiFX). This statistic could then be compared with
the null distribution generated by permuting the sample labels r—
times and computing the re—sampled FA(1), . . . ,FA(r), where
FA(/') :iZingj). The significance can be determined by using
regular permutation testing approach to compare the number of
times the obtained statistic is more extreme than those observed
under the null, i.e. pm : Z;1(FA > FA(/)). This method ensures
that the groups are balanced in each comparison, but may still

lead to loss of power due to decreased effective sample size in each
sub—sampled comparison. This approach is reported here as a sug—
gestion that needs further development and evaluation before in can
be implemented in practice. The final strategy for analysis of data
with arbitrary number of levels could involve the application of T3,
to only relevant pairwise comparisons with appropriate multiple
comparison controls in place.

Acknowledgements
The author would like to thank Dr Ali Shojaee Bakhtiari, Dr Beth Wolf and

three anonymous reviewers for reviewing and suggesting valuable improve-

ments to this work.

Funding

A.V.A. is supported in part by the NIH through 5R01CA16496402 from the
NCI.

Conﬂict of Interest: none declared.

References

Alekseyenko,A.V. et al. (2013) Community differentiation of the cutaneous
microbiota in psoriasis. Microbiome, 1, 1—17.

Anderson,M.J. (2001) A new method for non-parametric multivariate analysis
of variance. Anst. Ecol., 26, 32—46.

Anderson,M.J. (2006) Distance-based tests for homogeneity of multivariate
dispersions. Biometrics, 62, 245—253.

Anderson,M.]. et al. (2006) Multivariate dispersion as a measure of beta diver-
sity. Ecol. Lett., 9, 683—693.

Cho,I. et al., (2012) Antibiotics in early life alter the murine colonic micro-
biome and adiposity. Nature, 621—626.

Cohen,]. (1988). Statistical Power Analysis for the Behavioral Sciences, 2nd
edn. Lawrence Erlbaum Associates, Hillsdale, NJ.

Kelly,B.]. et al. (2015) Power and sample-size estimation for microbiome stud-
ies using pairwise distances and permanova. Bioinformatics, 31,
2461—2468.

ﬁlO'SIIZIIIﬂOprOJXO'SOplZIIJJOJLItOIQ/[idnq

Multivariate Welch t—test

 

Krishnamoorthy,K. and Yu,]. (2004) Modiﬁed nel and van der merwe test for
the multivariate behrens-ﬁsher problem. Stat. Prob. Lett., 66, 161—169.

Levy,K.]. (1978) An empirical comparison of the anova f—test with alternatives
which are more robust against heterogeneity of variance. ]. Stat. Comput.
Simul., 8, 49—57.

McMurdie,P.J. and Holmes,S. (2014) Waste not, want not: Why rarefying
microbiome data is inadmissible. PLoS Comput. Biol., 10, 1—12.

Oksanen,]. et al. (2015) vegan: Community Ecology Package. R package ver-
sion 2.3-0.

R Core Team (2015) R: A Language and Environment for Statistical
Computing. R Foundation for Statistical Computing, Vienna, Austria.

Warton,D.I. et al. (2012) Distance-based multivariate analyses con-
found location and dispersion effects. Methods Ecol. Evol., 3,
89—101.

/810'sleumofp103xo"sotJBuIJOJutotqﬂ:duq

