BIOINFORMA TICS

0'so;112u110}u101q//2duq

SIBumoprOJX

£10"

A two-stage statistical procedure for functional metagenomics

 

distribution on the count data. It is well known that
Poisson model lacks ﬂexibility for over—dispersed count data
(Rapaport et al., 2013). Another method, metagenomeSeq
(Paulson et al., 2013), has been recently developed to assess
differential abundance in sparse high—throughput microbial
marker—gene survey data. Even though it can compare multiple
conditions, metagenomeSeq is designated for comparison of taxo—
nomic compositions of different metagenomes, rather than func—
tional compositions. In this research, we focus on statistical
comparison of functions in metagenomes under various
conditions.

Statistical methods developed for RNA—Seq analysis may be
applicable to metagenomic analysis also, as both RNA—Seq ex—
periments and metagenomic experiments use sequencing technol—
ogies and produce count data. A number of statistical tools have
been developed for RNA—Seq data analysis, such as edgeR
(Robinson et al., 2010) and DESeq (Anders and Huber, 2010).
However, there are differences between RNA—Seq data and
metagenomic data. Different from RNA—Seq data, one of the
common characteristics of metagenomic data is the presence of
many features with zero counts. It is because metagenomic sam—
ples consist of a mixture of microbes, the species—speciﬁc func—
tions may only appear in some microbial conditions, while in
typical RNA—Seq experiments the genes are the same for differ—
ent experimental conditions, and only expression levels change.
Thus, metagenomic sequencing data may be more sparse than
the RNA—seq data.

Our research was motivated by (i) the limitations of existing
methods developed for metagenomic analysis, (ii) the increasing
focus of metagenomic projects on wide applications in various
areas [e. g. Human Microbiome Project (HMP, Turnbaugh et al.,
2007)] and (iii) the limitations of applying current methods de—
veloped for RNA—Seq analysis to metagenomic analysis. In this
article, we propose a two—stage statistical algorithm for selecting
informative features and detecting differentially abundant func—
tional features (e.g. pathways, subsystems, functional roles) be—
tween different microbial conditions. In the ﬁrst stage of our
algorithm, the informative features are selected using elastic net
(Friedman et al., 2010) resulting in dimensional reduction of the
metagenomic dataset. In the second stage of our approach, we
detect differentially abundant features using generalized linear
models (GLMs) with a negative binomial (NB) distribution
(Venables and Ripley, 2002).

In sparse data, elastic net is a satisfactory variable selection
method in the case that the number of predictors (p) is much
bigger than the number of observations (N), that is, when p >>
N. In addition, another advantage of elastic net is that it is well
suitable to data containing a grouping effect, i.e. strongly corre—
lated predictors tend to be in or out of the model together
(Friedman et al., 2010; Zou and Hastie, 2005). The NB distribu—
tion is widely used to model count data. The novelty of our
two—step method is that we take the common characteristics of
metagenomic data into account and combine the feature selec—
tion and feature comparison in metagenomic study to improve
the power of feature detection.

Our method can be directly applied to comparison of more
than two microbial conditions. Therefore, our method can be
applicable to more general situations, e.g. in clinical trials
where the goal is to compare multiple treatment conditions or

in natural environmental studies where multiple conditions are
compared and investigated.

2 METHODS

Our approach requires (i) a metagenomic dataset corresponding to two or
more conditions/phenotypes (e.g. diseased and healthy human guts, or
different locations of sea water); each condition/phenotype consists of
multiple individuals (or samples), and (ii) each sample/individual consists
of count data representing the relative abundance of features, or number
of shotgun reads mapped to a speciﬁc biological pathway or subsystem.
Our goals are to determine a set of informative features associated
with a particular phenotype and to identify statistically signiﬁcant
features whose abundance is different among different conditions/
phenotypes.

2.1 Data normalization

Due to the high-throughput sequencing technologies, an arbitrary
number of reads with large variation across samples is generated under
the sampling process. That is, a common source of bias in a metagenomic
count data is owing to different sequencing depths or various magnitude
of the read counts across multiple individuals (or samples). To proceed
with any statistical analysis, a preprocessing of the metagenomic count
data is necessary to account for this source of bias, i.e. normalizing the
samples to make them comparable. For the data normalization, we used
the trimmed mean of M-values (Robinson and Oshlack, 2010), which is
implemented in the edgeR Bioconductor package.

2.2 Two-stage statistical procedure

In the proposed two-stage statistical algorithm, informative features are
simultaneously selected in the ﬁrst stage, and then the selected features
obtained from the ﬁrst stage are used as the input for the second stage.
Differentially abundant features between metagenomic conditions/pheno-
types are detected in the second stage.

First stage—feature selection using elastic net

The ﬁrst stage aims to detect informative features associated with a par-
ticular phenotype. This results in the dimensional reduction of the meta-
genomic data. As outlined in the introduction, the metagenomic data
consist of relative abundances where low abundant microorganisms
may be missed owing to the sampling process. A statistical method is
needed to deal with a sparse data with the presence of a large percentage
of zero counts. Elastic net, an algorithm for estimation of GLMs with
elastic-net penalties, enables to deal efﬁciently with sparse features
(Friedman et al., 2010).

For the ﬁrst stage, assume there are 17 features and N samples. Let
aXT=[a1X, am, . . ., am] represent the vector of count values for 17 features in
the sample s (s = l, . . .N), and the phenotype of sample s is denoted by
gx, which takes values from {1, 2,. . . ,K} and K is the total number of
phenotypes or categories. For example, when there are only two pheno-
types (e.g. diseased and healthy), K = 2 and gx e {1, 2}.

Algorithm for elastic net

In a linear model, let G represent the response variable (e.g. phenotype
status) and A represent the predictor variables, then the regression func-
tion is typically determined by E(G|A =a) = [30 +aT/3, where a is a real-
ization of the predictors. For N observation sets (aXT, g) s = l, . . . , N, the
elastic net solves the following problem

mi" Rngov l3) =

l N T 2
WWW. [ﬁggv — 130 — a... 13) HAW] (1)

min
(ﬁoﬁlemﬂﬂ

 

159

ﬁm'spzumol‘piopro'sopeuuopnoiq/ﬁdnq

N.Pookhao et al.

 

where
P 1
1%me [5(1 — animal] (2)
.t=1

at is the elastic-net penalty (Zou and Hastie, 2005) and is a compromise
between the ridge regression penalty (at = 0) and the lasso penalty
(at = l). The elastic net model with at = 178 for some small a (a > 0)
performs much like the lasso, but ignores behavior caused by extreme
correlations. This model will tend to pick one feature and ignore the rest
if the features are correlated. On the other hand, the elastic net model
with at = 178 for some large a (a > 0) performs much like the ridge
regression, which is known as a regression model to shrink the coefﬁcients
of correlated predictor variables toward each other, resulting them to
borrow strength from each other. The coordinate descent step used to
solve (l) is detailed in Friedman et al. (2010).

Regularized multinomial regression

When the response variable is binary (K = 2), the linear logistic regres-
sion model is often used. When the categorical response variable G takes
multiple values (K > 2), the linear logistic regression model can be general-
ized to a multi—logit model. The class-conditional probability is repre-
sented through a linear function of the predictors:

Pr(G = Ela)

—= +T =  _
0gPr(G=K|a) ’3‘” “me L K 1 (3)

Here )3, is a p-vector of coefﬁcients, and the parameters (ﬁs) are com-
puted by solving the penalized multinomial log-likelihood problem:

1N K
max [NZ Iog(Pr(gx = Elan) — AZ Pawn] (4)
1:1 i=1

{ﬁot~ﬁt}f€llIK(/’+U

where A is a tuning parameter and will be determined as below.

Selecting the tuning oz and A parameters for regularization path

As shown in (1), two types of constraints (lasso and ridge constraints) on
the parameters are used in the elastic net. The parameter at controls the
relative weight of these constraints. The lasso constraints allow for the
selection/removal of variables in the model, while the ridge constraints
can deal with correlated predictor variables. In our approach, as the
second step can deal with feature detection, in the elastic net step we
put more weight on the ridge constraints to deal with correlated features.
We use grid search for at in [0, 0.1], and for each parameter at, the cor-
responding A was determined by cross-validation (CV) (Hastie et al.,
2009). The values for the parameters at and A that yield the lowest CV
error were selected.

Second stage—differentially abundant feature detection

The second stage of our algorithm is to detect features, which are statis-
tically differentially abundant in two or more conditions. From examin-
ing real metagenomic count data, we discovered that the variance exceeds
the corresponding mean of the feature abundance (detailed in
Supplementary 81784). NB distribution, a commonly used model for
count data with overdispersion, is used to take the overdispersion into
account (Cameron and Trivedi, 1998; Venables and Ripley, 2002).

NB model

Assume r of p features are selected from the ﬁrst stage. Let Y be the
vector of the numbers of reads for feature i in all samples where
i = l, 2, . . . , r. Each element (ys) in Ycan be modeled by NB distribution:

my. +e)_  - 6"

New  (s)

f m; My 9) =

with mean E01,.) = p“. and variance var(yx) = u,\.(l + [LN/9). The variance is

quadratic in the mean. The NB distribution can also be reparameterized
in the term of dispersion by letting ¢ = 1/6. Then, the count y follows NB
with mean = as and variance = uS(l + dubs), where ¢ denotes the disper-
sion parameter. The farther ¢ falls above 0, the greater the overdispersion
relative to Poisson variability. Clearly, when ¢ —> 0, the NB distribution
reduces to the usual standard Poisson distribution with parameter us. In
GLMs, the most convenient way to link the mean response it of NB
variable to a linear combination of the predictors X is the log link, as
in Poisson loglinear models, for each feature i (i = 1,2, . . . ,r),
lOg([,Lx)=X3-ﬁ, where X3- is l X K row vector of indicator variables for
the phenotypes, s = 1,2,. . . ,N, K represents the number of phenotypes
in the dataset and ﬂ is the corresponding K X 1 column vector of un-
known regression parameters (note: ﬁ here is different from the coefﬁ-
cient(s) )3 in the ﬁrst stage. We still use the same symbol for the purpose of
regression models). The covariates can be introduced into a regression
model based on the NB distribution via the relationship

K
Iog(u.)=ny-ﬁ,-4 (6)
'= 1

J

In the NB model for mean a, =8Xp(X3-ﬁ), ﬂ and ¢ are estimated by
maximizing the log-likelihood function:

Z(19415: Y):

N 71
leog(%) — zogm!) — (y. + wwogu +¢lh~l +yx/og¢+y.x{ﬁ}
(7)

s=l

More details on regression models for NB responses can be found in
Cameron and Trivedi (1998).

Hypothesis testing of model parameters in phenotype comparison for each
feature

To test the null hypothesis Hg: )3, = ﬁg = . . . = ﬁx.) = 0, denote the max-
imum value of likelihood function by 60 under H{), and 61 under H 1,
which states that at least one coefﬁcient [3/75 0. H0 stands for no pheno-
type effect, i.e. the feature is not differentially abundant across different
phenotypes. The likelihood ratio test statistic is:

—210g(50/51)= — ZIIngO) — 10g(51)1 = — 2(Lo - L1) (8)

where L0 and L, are the logarithms of maximum likelihood functions.
Under Hg this test statistic has an asymptotically chi-squared distribution
with K 71 degrees of freedom.

Multiple test correction

A typical metagenomic dataset consists of several hundreds or thousands
of features. After comparing multiple metagenomic groups using GLMs
with the NB canonical logarithmic link function for simultaneous com-
parison, we used BenjaminiiHochberg’s procedure (Benjamini and
Hochberg, 1995) to control the false discovery rate (FDR) at signiﬁcance
level of 0.05.

3 SIMULATION STUDIES

Because of high similarity between RNA—Seq and metagenomic
data, the statistical methods developed for RNA—Seq data in de—
tecting differentially expressed genes may be applicable to the
analysis of metagenomic data. For this reason we compared
our method with two widely used statistical packages for
RNA—Seq analysis, edgeR and DESeq, in addition to
metagenomeSeq. As Metastats approach can only be used to

 

160

ﬁm'sIeumoI‘pJOJXO'sopeuuopnoiq/pdnq

A two-stage statistical procedure for functional metagenomics

 

Table 1. The ranges of means of the NB distributions in four simulation
settings

 

 

Setting Minimum loglg (mean) Maximum loglg (mean)
1 (Low) 0 1

2 (Intermediate) 1 2.5

3 (High) 2.5 5

4 (Combined) 0 5

 

Notes: Settings 141 reﬂect the count data of feature abundances with low means,
intermediate means, high means and a combination means, respectively. Setting 4
most resembles to the nature of real metagenomic dataset.

compare two conditions/phenotypes, we also evaluated its per—
formance in the following designs of two—condition or —pheno—
type comparison.

3.1 Experimental data

To make simulated data to reﬂect the nature of real metage—
nomic data we examined several types of real datasets from vari—
ous environmental sources, including human gut, ocean, soil and
fresh water (Supplementary Table S1), and obtained the means
and variances of feature abundance in these studies.
Interestingly, we observed strong linear relationships between
the loglg—transformed means of the feature abundances and the
loglg—transformed variances of abundances (Supplementary
Figs S17S4).

Experimental Design I (two-condition comparison + ﬁxed param-
eters for simulating data)

We designed a metagenomic simulation study in which samples
are drawn from two conditions. Because the sample size affects
the performance of statistical methods, we designed metage—
nomic datasets with various sample sizes, including 10, 25 and
50 subjects drawn from each population. For each dataset,
counts were generated using NB distributions, with different
means (It) and variances (02). The means (u) of the NB distri—
butions were selected by random sampling from the ranges of the
means for the abundances in four simulation settings (Table 1),
and then the corresponding variances were computed from the
following function:

10g10(02) = 50 + 51 *10g10(M) (9)

(In the ﬁrst experiment let ﬁg = 0.6 and ﬁ1 = 1.8, which are from
the observation of four real metagenomic datasets; details can be
found in the supplementary ﬁle. In next two experiments, we will
relax these two values). In each dataset, we simulated 1000 fea—
tures for each sample of two conditions from NB distributions;
950 of them were generated from the same NB distribution, i.e.
M = M with the corresponding variances computed by (9), and
the rest 50 were generated from two different NB distributions,
i.e. a >1< M = #2, where the parameter a (i.e. multiplier) is selected
from the set of 1.5, 2.5, 5, 7.5 and 10. To prevent bias arising
from a speciﬁc partition, we simulated the datasets 100 times for
each sample size. The performance of four methods were com—
pared using the ‘area under the curve’ (AUC) metric of a receiver

operator curve (ROC), and the true—positive rate (tpr, i.e. power)
were calculated at each level of FDR.

Experimental Design 2 (two-condition comparison + varied par-
ameters for simulating data)

Different from the ﬁrst experimental design where the values of
ﬁg and ﬁ1 are fixed, the second experiment allows these two
parameters to vary. They were determined by random sampling
from the ranges of [0.1, l] and [1.5, 2], respectively. These ranges
of the estimates for ﬁg and ﬁ1 were obtained from observing real
metagenomic data (details in Supplementary). As the setting 4
resembles most to the nature of real metagenomic dataset, in the
second experiment we ﬂexed the ﬁg and ﬁ1 on this setting. Similar
to the ﬁrst experiment, we simulated 1000 features for each
sample of the two conditions from NB distributions: 950 of
them were generated from the same NB distribution, and the
rest were from two different NB distributions.

Experimental Design 3 (three-condition comparison + varied par-
ameters for simulating data)

In this experiment the samples were drawn from three condi—
tions. The parameter settings for ﬁg and ﬁl are as same as the
Experimental Design 2. For each sample under different condi—
tions we simulated 1000 features from NB distributions: 950 of
them were generated from the same NB distribution, and the rest
50 features were from different NB distributions. That is, at least
two NB distributions (representing two conditions) of three dis—
tributions are different for each of these 50 features.

3.2 Simulation results

Results from Experimental Designs I and 2

ROC curve is usually used in measuring signal detection. It is
created by plotting the true—positive rate versus the false—positive
rate. AUC shows an overall performance of detection methods.
The higher the AUC value, the better the method is. Figure 1
displays the AUC results for four methods with different sample
sizes (10, 25 and 50) under four simulation settings. AUC values
generally increase when the sample size increases; AUC values
are greater for higher mean setting. The proposed approach
outperforms the other methods in the Setting 2 for small
sample size (n =10) and in Setting 1 for large sample size
(n = 50) and is well comparable with other methods in the rest
of the settings.

In addition to the AUC, which shows an overall performance
of the methods, we also compare our method with other methods
in terms of power in detecting truly differentially abundant fea—
tures, while the FDR is controlled at different levels. Figure 2
shows the power for sample size of 10, 25 and 50 in each simu—
lation setting in Experimental Design 1. For the Settings 241 our
proposed approach either outperforms other methods or is well
comparable with other methods. In the Setting 1, the new
method surpasses other methods for sample size of 50, and is
comparable with metagenomeSeq for sample size of 25 while
much powerde than the rest. Interestingly, for sample size of
10, metagenomeSeq shows much higher power than the new
method. We examined the true (i.e. realized) FDR at adjusted
P—value of 0.05. The boxplots of true FDR across 100 replica—
tions for this experiment show that the FDR cannot be

 

161

ﬁm'spzumol‘pmpro'sopeuuopnoiq/pdnq

him-10 hiqhz50

- _.- aw.-

rnetagenomeSeq t
two-stage

30

 

Sample Size

metageno
two-stage

 

/310'S[BHJHO[pJOJXO'SOINZLUJOJIIIOIq/ﬂduq

 

/310'S[BHJHO[pJOJXO'SOINZLUJOJIIIOIq/ﬂduq

A two-stage statistical procedure for functional metagenomics

 

(ZINB) on the filtered data through elastic net for the
Experiment 1. Comparing the results from NB and ZINB meth—
ods, NB approach exceeds the ZINB ﬁtting for most of the cases
according to the AUC plots and power plots (shown in the
Supplementary File, Supplementary Figs S9 and S10); otherwise
these two methods are comparable. However, the computational
time for ZINB is ~20(L300 times longer than for NB ﬁtting due
to more parameters in the ZINB models.

We also applied the proposed method on two real metage—
nomic datasets related to two human diseases. One of them is
related to obesity and IBD, and the other one is related to CF
lung disease. In the gut data, there are four phenotypes/groups
owing to the combination of the two diseases. Our method is
directly applied to this multiple—group comparison and our find—
ings are consistent with previous reports. Compared with other
existing methods on metagenomic studies, the proposed two—
stage method is more powerful and ﬂexible.

Funding: This work was supported by National Science
Foundation [DMS—1043080 and DMS—1222592 to LA. and
H.J.], and partially supported by National Institutes of Health
[P30 ES006694 to LA] and by The Cecil Miller Endowment at
University of Arizona Foundation (to N.P.)

Conﬂict of interest: none declared.

REFERENCES

Anders,S. and Huber,W. (2010) Differential expression analysis for sequence count
data. Genome Biol., 11, R106.

Benjamini,Y. and Hochberg,Y. (1995) Controlling the false discovery rate: a prac—
tical and powerful approach to multiple testing. J. R. Stat. Soc. B, 57, 2897300.

Boutros,M. and Maron,D. (2011) Inﬂammatory bowel disease in the obese patient.
Clin. Colon Rectal. Sarg., 24, 24¢252.

Cameron,A. and Trivedi,P. (1998) Regression Analysis of Count Data. First Edition.
Econometric Society Monograph No. 30, Cambridge University Press.

Ehsanipour,E.A. et al. (2013) Adipocytes cause leukemia cell resistance to L—
Asparaginase via release of glutamine. Cancer Res., 73, 299873006.

Friedman,J. et al. (2010) Regularization paths for generalized linear models via
coordinate descent. J. Stat. Softw. Jan., 33, 1722.

Gilbert,J.A. et al. (2011) The future of microbial metagenomics (or is ignorance
bliss?) ISME J., 5, 7777779.

Hastie,T. et al. (2009) The Elements of Statistical Learning: Prediction, Inference and
Data Mining. 2nd edn. Springer—Verlag, New York, NY.

Hugenholtz,P. (2002) Exploring prokaryotic diversity in the genomic era. Genome
Biol., 3, REVIEWSOOO3.

Huson,D. et al. (2009) Methods for comparative metagenomics. BMC
Bioiip’ormatics, 10 (Suppl. 1), $12.

Huson,D. et al. (2011) Integrative analysis of environmental sequences using
MEGAN4. Genome Res., 21, 155271560.

Jain,V. et al. (2006) ppGpp: stringent response and survival. J. Microbiol., 44,
1710.

Kristiansson,E. et al. (2009) ShotgunFunctionalizeR: an R—package for functional
comparison of metagenomes. Bioinformatics, 25, 273772738.

Kunin,V. et al. (2008) A bioinformatics’s guide to metagenomics. Microbiol. Mol.
Biol. Rev., 72, 557.

Paulson,J. et al. (2013) Differential abundance analysis for microbial marker—gene
surveys. Nat. Methods, 10, 120(FIZOZ.

Qin,J. et al. (2010) A human gut microbial gene catalogue established by metage—
nomic sequencing. Nature, 464, 59%5.

Quinn,R.A. et al. (2014) Biogeochemical forces shape the composition and physi—
ology of polymicrobial communities in the cystic ﬁbrosis lung. mBio, 5,
800956r13.

Rapaport,F. et al. (2013) Comprehensive evaluation of differential gene expression
analysis methods for RNA—seq data. Genome Biol., 14, R95.

Robinson,M. and Oshlack,A. (2010) A scaling normalization method for differen—
tial expression analysis of RNA—seq data. Genome Biol., 11, R25.

Robinson,M. et al. (2010) edgeR: a bioconductor package for differential expression
analysis of digital gene expression data. Bioinformatics, 26, 1397140.

Rodriguez—Brito,B. et al. (2006) An application of statistics to comparative meta—
genomics. BMC Bioinformatics, 7, 162.

Raskin,D.M. et al. (2007) Regulation of the stringent response is the essential func—
tion of the conserved bacterial G protein CgtA in Vibrio cholerae. Proc. Natl
Acad. Sci. USA, 104, 4636—4641.

Schloss,P. and Handelsman,J. (2006) Introducing SONS, a tool for operational
taxonomic unit—based comparisons of microbial community memberships and
structures. Appl. Environ. Microbiol, 72, 6773$779.

Turnbaugh,P. et al. (2007) The human microbiome project. Nature, 449, 8044510.

Venables,W. and Ripley,B. (2002) Modern Applied Statistics with S. 4th edn.
Springer—Verlag, New York, NY.

White,J. et al. (2009) Smtistical methods for detecting differentially abundant fea—
tures in clinical metagenomic samples. PLoS Compat. Biol., 5, e1000352.

Willner,D. et al. (2009) Metagenomic analysis of respiratory tract DNA viral com—
munities in cystic ﬁbrosis and non—cystic ﬁbrosis individuals. PLoS One, 4,
e7370.

Wooley,J. and Ye,Y. (2010) Metagenomics: facts and artifacts, and computational
challenges. J. Comp. Sci. Tech., 25, 71781.

Zou,H. and Hastie,T. (2005) Regularization and variable selection via the elastic
net. J. R. Statist. Soc. B, 67, 3017320.

 

165

ﬁm'spzumol‘pmpro'sopeuuopnoiq/pdnq

