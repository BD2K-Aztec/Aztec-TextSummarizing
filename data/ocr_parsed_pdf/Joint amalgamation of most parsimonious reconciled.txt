Bioinformatics, 3116), 2015, 841—848

doi: 10.1093/bioinformatics/btu728

Advance Access Publication Date: 6 November 2014
Original Paper

 

Phylogenetics

Joint amalgamation of most parsimonious
reconciled gene trees

Celine Scornavacca1'2'*, Edwin Jacox1 and Gergely J. Szolldsi3'*

1ISEM, UMZ-CNRS-IRD, Place Eugene Bataillon 34095 Montpellier, France, 2Institut de Biologie Computationnelle
(IBC), 95 rue de la Galéra, 34095 Montpellier, France and 3ELTE-MTA 'Lendiilet' Biophysics Research Group 1117
Bp., Pazmany P. stny. 1A., Budapest, Hungary

*To whom correspondence should be addressed.
Associate Editor: David Posada

Received on May 27,2014; revised on October 28, 2014; accepted on October 29, 2014

Abstract

Motivation: Traditionally, gene phylogenies have been reconstructed solely on the basis of mo—
lecular sequences; this, however, often does not provide enough information to distinguish be—
tween statistically equivalent relationships. To address this problem, several recent methods have
incorporated information on the species phylogeny in gene tree reconstruction, leading to dramatic
improvements in accuracy. Although probabilistic methods are able to estimate all model param—
eters but are computationally expensive, parsimony methods—generally computationally more ef—
ficient—require a prior estimate of parameters and ofthe statistical support.

Results: Here, we present the Tree Estimation using Reconciliation (TERA) algorithm, a parsimony
based, species tree aware method for gene tree reconstruction based on a scoring scheme combin—
ing duplication, transfer and loss costs with an estimate of the sequence likelihood. TERA explores
all reconciled gene trees that can be amalgamated from a sample of gene trees. Using a large scale
simulated dataset, we demonstrate that TERA achieves the same accuracy as the corresponding
probabilistic method while being faster, and outperforms other parsimony—based methods in both
accuracy and speed. Running TERA on a set of 1099 homologous gene families from complete
cyanobacterial genomes, we find that incorporating knowledge of the species tree results in a two
thirds reduction in the number of apparent transfer events.

Availability and implementation: The algorithm is implemented in our program TERA, which is
freely available from http://mbb.univ—montp2.fr/MBB/downloadisources/167TERA.

Contact: celine.scornavacca@univ—montp2.fr, ssolo@angel.elte.hu

Supplementary information: Supplementary data are available at Bioinformatics online.

 

 

1 Introduction

Molecular phylogenetics infers gene trees based on the information
contained in molecular sequences. Unfortunately, individual
sequences may contain limited signal, and, as a result, phylogenetic
reconstruction often involves choosing between statistically equiva-
lent or weakly distinguishable evolutionary relationships.

Although each homologous gene family has its own unique
story, these are all related by a shared species history—which can be
helpful for gene tree inference (Maddison, 1997; SZéllb’si et (11.,
2014). In the past decade, several methods have been developed that

(63 The Author 2014. Published by Oxford University Press.

model the evolutionary processes that generate gene trees within the
species tree (Akerborg et (11., 2009; Arvestad, 2003; Hallett and
Lagergren, 2001; Rannala and Yang, 2003; Rasmussen and Kellis,
2007, 2012; Sjostrand et (11., 2014; Suchard, 2005; Szollb'si et (11.,
2012, 2013a; Than and Nakhleh, 2009). From an inference perspec-
tive, these methods attempt to find the optimal way to explain the
phylogenetic signal in extant sequences—represented as a gene
tree—given the species tree. They explore the set of possible recon-
ciliations, i.e. different ways to draw the gene tree into the species
tree given some combination of macro evolutionary events, such as

841

This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (http://creativecommons.org/Iicenses/by-nc/4.0/),
which permits non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited. For commercial re-use, please contact

journals.permissions@oup.com

/310‘srcumo[p10}xo‘sopcuHOJIItotq/ﬁdnq

Akerborg et [11,, 2009
Boussau et [11,, 2013 Rasmussen and Kellis, 2010 Szollosi er [1].,
2013b

Conow et [11,, 2010 Doyon er [1]., 2010

Doyon et [11,, 2010
Bansal et [11,, 2012

David and Alm (2010)

Figure 1 Szollosi et [11.
(2013b) Wu Gt [1]., 2013 2014

David and
Alm (2010)
Hohna and Drummond (2012)

David and Alm, 2010 Nguyen et [11,, 2012 Wu et (11., 2013 Szollosi et [11,, 2013a

[61E]
B

5/10 5’10

3/8

5/8

CA >< (log(%) 

cA x (log<%) + mgr?)

David and Alm,

2010 Hohna and Drummond, 2012

/810'spzumo_fp10}xo"satJBmJOJutotW/zdnq

Joint amalgamation of parsimonious reconciled gene trees

843

 

The self—consistent score estimation scheme used by TERA,
introduced in Section 2.4, should be applicable to other parsimony
methods, while amalgamation is in theory compatible with any rec—
onciliation algorithm that assumes branches of the gene tree to be
independent.

2 Materials and methods

2.1 Preliminaries

Given a binary rooted tree T, we respectively denote by V( T), E(T),
L(T) and r(T), its node, edge, leaf node sets and root node. The label
of each leaf u is denoted by £(u), while the set of labels of leaves of
T is denoted by £(T). Given a node 14 E V(T), we denote respect—
ively by up, 145 and {abut} the father, the sibling and the children of
u (if they are defined). Note that in this article all trees are con—
sidered as unordered, so u] and ur are interchangeable. For a node 14
of T, TLI denotes the subtree of T rooted at 14. Given two nodes 14 and
U of T, u S TU (u<TU, respectively) if and only if U is on the unique
path from u to r(T) (respectively, and 14 9E U); in such a case, 14 is said
to be a (strict) descendant of U. Given a node 14 of T, we define the
clade associated with u, denoted by C(u), as the set £(Tu). If u is an
internal node, we define the tripartition associated with u, denoted
by H(u), as the triple (£(Tu). £(Tm). £(T,,r)). For leaf nodes, the
trivial tripartition H(u) is defined as the triple (£(u), 0, 0). Finally,
the height of T is denoted by 10(T).

In this article, unless stated otherwise, we assume that gene and
species trees are rooted, binary and uniquely leaf labeled, i.e. within
each tree there is a bijection between leaves and labels. Due to this
bijectivity we will refer to leaves and labels interchangeably.

We define a gene tree G as a tree where each leaf represents an
extant gene. Similarly, a species tree S is defined as a tree in which
each leaf represents a distinct extant species. Note that several leaves
of a gene tree can be associated to the same species due to gene birth
corresponding to duplication and transfer events. Formally, we indi—
cate this by a surjective function 5 : £(G) —> £(S), called the species
labeling of G. The set of species labels of the leaves of G is denoted
8

A tree T is said to be time ordered when it is associated with a
time function 07- : V(T) —> 1R+ that associates each of its nodes with
a non—negative value so that, for any two nodes x. x’ E V(T), if x’ is
a strict descendant of x then 0T(x’) < 0T(x). Moreover, Vx E L(T),
we have that 05 (x) : 0. A subdivision T’ of a time—ordered tree T is
the tree obtained from T by adding a new node 31 with 0T:(y) on
each edge (xp.x) E E(T) such that there exists z E V(T) with
0-1-(x) < liq-(z) < 0-1-(xp). For nodes x E V(T’) corresponding to
nodes already present in T, we set 0-1-1 (x) : 0-1-

2.2 Species tree—gene tree reconciliation

Here, we consider the problem of finding the most parsimonious
reconciliation (MPR) when considering—as possible macro—events
that result in the birth and death of gene copies—speciation, gene
duplication, gene transfers and gene loss (Szélldsi and Daubin,
2012). The general problem of finding an MPR is known to be NP—
complete, even for reconciling two binary trees (Tofigh et al., 2011).
The complexity of the problem is due to the difficulty of ensuring
the time consistency of gene transfers, i.e. satisfying the chronolo—
gical constraints among nodes of the species tree that are induced by
transfer events. However, the problem becomes polynomially solv—
able when accepting a time—ordered species tree as input (among
others Conow et al., 2010; Doyon et al., 2010 Tofigh, 2009, see
Doyon et al., 2011 for a review). In this article, we build upon the

combinatorial reconciliation model introduced by Doyon et al.
(2010), which can be used to solve this special case of the problem.

Some parsimony methods (e.g. Bansal et al., 2012) do not need
information on the order of speciations in time. This allows a more
efficient recursion over reconciliations, but at the cost of considering
reconciliations that contain transfer events that are not consistent
with any ordering of the species tree (Tofigh et al., 2011).

The DTIL model of Doyon et al. (2010) can be used to reconcile a
time—ordered binary species tree S with a binary gene tree G by con—
structing a mapping or that maps each node 14 E V(G) into an
ordered list of nodes in V(S’), namely the ancestral and/or extant
species in which the sequence corresponding to u evolved. This
model takes into account four kinds of biological events: speciation,
gene duplication, gene transfer and gene loss. The atomic events of
this model are: a speciation (S), a duplication (ID), a transfer (T), a
transfer followed immediately by the loss of the non—transferred
child (TIL), a speciation followed by the loss of one of the two result—
ing children (SIL), and a contemporary event ((C) that associates an
extant gene to its corresponding species. Finally, a null event (0), is
used to model a gene lineage crossing a time boundary. Note that
duplication—loss events and transfer followed by the loss of the trans—
ferred gene, unlike a transfer followed by the loss of the non—trans—
ferred gene and speciation—loss events, leave no trace and are
therefore undetectable. This is why, in the 1D>T1L model, losses are
never considered alone. We refer the reader to Doyon et al. (2010)
for the formal definition of a DTIL reconciliation.

Let 0, ‘E, /1 be, respectively, the costs of a duplication, a transfer
and a loss. Given a 1D>T1L reconciliation, we define the cost of or,
denoted by c(oc), as the sum 0d + ‘Et + /ll, where d, t and [are respect—
ively the number of 1D) events, of T and TIL events, and of SIL and TIL
events in or. In Doyon et al. (2010) the authors give an efficient algo—
rithm to compute c(G, S) for a time—ordered species tree S and a
gene tree G, where c(G, S) is defined as the minimum cost over all
possible 1D>T1L reconciliations between G and S.

2.3 Choosing a reliable gene tree among several
competing alternatives

Even though our aim is to reconstruct reliable gene trees from a mul—
tiple sequence alignment and a species phylogeny, our approach
does not directly take sequence alignments as an input, but requires
a sample of gene trees, typically produced from the alignment by ei—
ther a Markov Chain Monte Carlo (MCMC) methods such as
PhyloBayes (Lartillot et al., 2009) and MrBayes (Ronquist et al.,
2012), or bootstrap resampling.

To find the optimal gene tree, clades found in the input sample
of gene trees are combined using the amalgamation approach in
order to recover an optimal tree with respect to our scoring scheme.
The optimal tree recovered will only contain clades found in the in—
put sample of gene trees, but it will not in general be found in the
sample itself.

Figure 1 provides a schematic illustration of the amalgamation
approach. Clades present in the sample of trees (the unrooted trees
on the left) can be combined to obtain a tree such that each clade is
found in the sample, but the tree itself is not. For example, one can
produce a green—blue tree consisting of a green subtree with genes a,
b and c, and a blue subtree with genes d, e and f. The sequence score
of each tree is obtained using CCPs that depend on the number of
times different trees are seen in the sample and is described in detail
in the next section. The reconciliation score for each tree corres—
ponds to the MPR of the gene tree with the species tree. The amal—
gamation algorithm itself is a joint dynamic programming recursion

ﬁm'spzumol‘pmyo'sopeuuowtotq/ﬁdnq

844

C. Scornavacca et al.

 

over (i) all trees that can be produced from clades present in the in—
put sample and (ii) all possible ways to reconcile each of these trees
with the species tree, to recover a gene tree with the smallest joint se—
quence—reconciliation score. As shown in Figure 1 in the online
appendix, amalgamation permits us to explore a vastly larger set of
trees than those contained in the sample.

Conceptually, both ALE (Széllé'si et al., 2013b) and TERA are
based on the amalgamation approach of AnGST (David and Alm,
2010), and all three methods are—at the level of the dynamic pro—
gramming recursion—closely related. TERA differs from AnGST in
the underlying reconciliation model (Doyon et al., 2010) and be—
cause it allows transfers going/coming from extinct or unsampled
species (Szolliisi et al., 2013a). Moreover, the AnGST scoring
scheme is solely based on the reconciliation score. ALE differs from
TERA in that it relies on a complex underlying probabilistic model;
the results of which, in contrast to TERA, are contingent on time—
like branch lengths of the species tree.

TERA’s amalgamation algorithm can be regarded as a generaliza—
tion of the gene tree reconciliation algorithm of Doyon et al. (2010),
which iterates over reconciliations by mapping each node of a gene
tree to branches of the species tree. In the joint recursion presented in
this article, instead of nodes of a gene tree, the clades found in the in—
put sample of gene trees are mapped into branches of the species tree.

More formally, assume we are given a set of (unrooted) gene
trees 9 on the same leaf set reconstructed from a unique sequence
alignment. We denote respectively by A(9) and 11(9) the union of
all the clades, and the union of all tripartitions in 9. For each tripar—
tition TE, we denote by 71(1) (71(2) and 71(3), respectively) the first (se—
cond and third, respectively) element of TE. If 9 contains unrooted
trees we consider all possible rootings for each tree when computing
A(9) and 11(9). Furthermore, for a given clade C of A(9), we denote
by 11(C) the set of tripartitions TE 6 11(9) for which 71(1) : C. When
focusing only on the reconciliation score, the optimization problem
consists of computing c(9. S) 2: min Gegmc(G. S), where 9m is the
set of gene trees such that A(G) Q A(9) for all C 6 94,41. The
pseudocode is given in Algorithm 1 in the appendix. Roughly speak—
ing, our algorithm starts by computing the subdivision S’ of S, and
the sets A(9) and 11(9). Then, it performs a joint traversal of all
gene tree clades and species tree branches wherein clades C in A(9)
are considered in order of increasing size, and nodes x’ of S in order
of increasing height. For each pair (C, x’) the algorithm computes
the cost of reconciling clade C with x’ by testing all possible triparti—
tions TE in 11(C). Because each non—trivial tripartition TE can be seen
as an internal node of an amalgamated tree, with children 71(2) and
71(3), the cost of reconciling a tripartition TE with x’ can be computed
according to Algorithm 1 of Doyon et al. (2010). We refer the reader
to Algorithm 1 of Doyon et al. (2010) for a better understanding of
the pseudocode. The correctness of our approach is proven in the
appendix.

Note that—for ease of writing—the pseudocode of the algorithm
does not contain the transfers from the dead, i.e. the transfers going/
coming from extinct or unsampled species (Szolliisi et al., 2013a).
However, Algorithm 1 can be easily modified to accommodate this
kind of event by adding to the species tree S a sister group of the root
clade such that, within this group, duplications and losses are free, spe—
ciations are not permitted, and transfers to this new group (formally
corresponding to unrepresented speciations) cost zero—similar to what
is done in the likelihood framework by Szolliisi et al. (2013a).

2.4 Taking into account the CCP
As described in the introduction, our goal is to create a species tree
aware method for reconstructing gene phylogenies that uses

information from both gene sequences and from the reconciliation
with a species tree. That is, we wish to construct a method that opti—
mizes a joint sequence—reconciliation score. In order to do this, we
must find an efficient manner to incorporate a sequence based cost
in addition to the reconciliation cost of Doyon et al. (2010) in the
amalgamation scheme.

AnGST, the seminal algorithm of David and Alm (2010) that
introduced the idea of amalgamation, does not distinguish between
trees that can be amalgamated. The problem with this approach is
that, as the number of input trees—and thus the amount of informa—
tion given as input—increases, the set of possible trees that can be
amalgamated also increases—until all possible tree topologies can
be amalgamated. At this point, since all possible tree topologies can
be amalgamated, the most parsimonious reconciled gene tree will
only depend on the reconciliation score. In practice this introduces
the problem that the topology of the amalgamated gene tree may
vary significantly when adding only a few trees to the sample of trees
(in the worst case only one tree).

In a probabilistic framework, conditional clade probabilities
(CCPs, cf. Fig. 1) provide an accurate approximation of posterior
probabilities for a very large number of tree topologies from a
smaller MCMC sample (Hohna and Drummond, 2012; Larget,
2013; Szolliisi et al., 2013b). The CCP of a rooted tree G E 9am
(Hohna and Drummond, 2012), denoted by Pccp(G), is defined as
the product of the conditional probabilities of all partitions in
11(G). The conditional probability of the partition of clade C ac—
cording to the tripartition T15 is denoted PCCP(7'E) and is approximated
by the ratio fg(n)/fg(n[1]), where for each clade C E A(9) and for
each tripartition TE 6 11(9). fg(7t) and fg(C) is the frequency of C and
T1: in 9.

Here, in order to construct a parsimony method that optimizes a
joint sequence—reconciliation score, we choose to minimize the joint
cost

Cjoint(G7S) : C(Gi  ‘I' CAI\IA 

over G 6 94,“, Where the parameter c A weights the contribution of
the sequence alignment N A to the cost, defined as

PCCP(G) > (2)

N : —l
A 0g (PCCP(GMAP)

where PCCP(GMAP) corresponds to the posterior probability of the
gene tree with the highest posterior probability according to the se—
quence alignment. The logarithm of the CCP provides an additive
cost for deviation from the phylogeny preferred by the sequence
alignment alone, similar to the additive cost for deviation from spe—
cies phylogeny provided by the DTL event costs. The parameter cA
is analogous to a statistical support threshold, corresponding to a
cost c A for each point of log posterior probability difference between
the log posterior probability of a given phylogeny and the gene tree
with highest posterior probability.

As illustrated in Figure 1, Algorithm 1 in online appendix is easily
modified by adding cA - log (Pccp(rr)C)) to cs, cm; 011‘ while filling the
dynamic programming matrix (on line 15, 17 and 18 of Algorithm 1,
respectively). The term +cA - log (Pccp(GMAP)), corresponding to the
gene tree with the highest posterior probability, can be neglected dur—
ing cost minimization as it simply corresponds to an additive constant.

Given estimates for the DTL costs (available for example in
David and Alm, 2010; Nguyen et al., 2013), the parameter cA can
be estimated in a self—consistent manner.

However, finding the proper weight between the disagreement
with the species tree (increase in DTL events) and the disagreement

[310'sp2umofp105xo'sopeuHOJIItotq/ﬁdnq

Joint amalgamation of parsimonious reconciled gene trees

845

 

with the sequence alignment (decrease in log (Pccp(G))) is difficult.
Our estimation approach consists of looking for the set of costs that
are the most self—consistent, i.e. the ratio of costs that best corres—
ponds to the ratio of events.

We assume a simple model for how costs determine the number
of events: each type of event, i.e. DTL events as well as the disagree—
ment with the alignment counted by N A, are considered to occur in—
dependently, such that events with smaller costs are expected to
occur more frequently. In particular, the expected amount of dis—
agreement with the species tree due to, respectively duplications,
transfers and losses, is proportional to exp (—6), exp (—‘5)
and exp (—/l), while the expected amount of disagreement with the
sequence alignment is propotional to exp (—cA). The observed
amount of disagreement with the species tree is given by the sum of
the number of DTL events, i.e. ND, NT and NL, while the observed
amount of disagreement with the sequence alignment is given by
N A. We then employ an expectation maximization like recursion
equating at each step the observed frequencies with the expected

NA
712“) : _l .
6" 0g<ND+NT+NL+NA> (3)

frequencies:

new

Algorithm 1 is then run until )cA — cA) is larger then a threshold 6.

2.5 Implementation and validation
TERA is implemented in C++ and is freely available from http://
mbb.univ—montp2.fr/MBB/download_sources/ 1 6_TERA.

Posterior samples of gene trees, for both simulated and real
alignments, were downloaded together with the ‘true’ gene trees
used to simulate alignments from the dryad data repository
(doi:10.5061/dryad.pv6df) provided by Szolliisi et al. (2013b).

For all the parsimony—based species tree aware methods, includ—
ing TERA, we used the DTL costs 5:2, 1:3, 2: 1 obtained by
David and Alm (2010) using a criteria based on minimizing the
change in ancestral genome sizes on a large biological dataset. We
ran TreeFix—DTL with default parameters, JTT/GTR with a gamma
distribution as models of evolution, and as a starting tree the
PhyML tree. MowgliNNI was run with default parameters, a thresh—
old of 50 for weak edges, and with the PhyML tree—with bootstrap
values—as a starting gene tree. AnGST was run with default param—
eters using the dated species tree on samples of 1000 gene trees,
whereas JPrIME—DLTRS was run with JTT with a gamma distribu—
tion as model of evolution, 100 000 iterations, a thinning factor of
10 and a time out of 10h. Finally, we ran TERA with a starting cA
of 0.1 and for 9 samples from 10 up to 10 000 gene trees for each
simulated alignment. The gene trees reconstructed by ALE were
downloaded from the above mentioned data repository.

Note that, from a practical perspective, the DTL costs we use are
the default parameters for all the parsimonious methods described
in the article, and seem to work well for several parts of the Tree of
Life. If the user suspects that these values are not suited for the ana—
lyses, these parameters should be estimated beforehand, e.g. using
the ALE method.

3 Results

To test the accuracy of gene trees reconstructed using TERA we
chose a dataset based on 1099 homologous gene families present in
36 cyanobacterial genomes. This dataset, published in Széllé'si et al.
(2013b), was constructed using homologous families from the
HOGENOM database (Penel et al., 2009) and contains both real

and simulated alignments as well as the gene trees used to simulate
sequences. The mean number of genes per family in this dataset
is 36.66, the largest family has 114 genes and the smallest 21
genes; the mean number of species in which a family is found is
31.49, with a minimum of 4 and a maximum of 36; the mean copy
number per genome—counting as zero genomes in which a family
is absent—is 1.012, with a minimum of 0.5833 and a maximum
of 3.17.

We chose this dataset, because (i) it contains a diverse set of gene
families from a reasonably large and divergent set of species, and (ii)
the parametric bootstrap—like simulation procedure used attempts to
retain as much of the complexity of the underlying biological dataset
as possible (Szolliisi et al., 2013b). Furthermore, to emulate the rela—
tive complexity of real data compared with available models of se—
quence evolution, we used a complex model of sequence evolution
to simulate sequences—an LG model (Le and Gascuel, 2008) with
across—site rate variation and invariant sites—and used PhyloBayes
(Lartillot et al., 2009) with a simpler model—a Poisson model
(Felsenstein, 1981) with no rate variation—to produce the sample of
gene trees used by both TERA and AnGST (see below for more
details).

3.1 Validation on simulated data

For the simulated alignments, both the ‘true’ gene tree used to gener—
ate the sequences and the species tree—along which the gene trees
evolved—are known. Consequently, it is possible to directly assess
the accuracy of different reconstruction methods in recovering the
correct gene tree.

As shown in Figure 1a in the online appendix, the number of
possible amalgamations increases roughly exponentially with
increasing sample size in the simulated dataset, but the median re—
construction accuracy achieved by TERA begins to saturate (Figure
1b in the online appendix). To compare the accuracy of our method
to that of others, we reconstructed gene trees using six different ‘spe—
cies tree aware’ methods: (i) the TERA algorithm described here, (ii)
ALE (Széllé’si et al., 2013b), (iii) TreeFix—DTL (Bansal et al., 2014,
submitted for publication, http://compbio.mit.edu/treefix—dtl/), (iv)
MowgliNNI (Nguyen et al., 2013), (v) AnGST (David and Alm,
2010) and (vi) JPrIME—DLTRS (Sjostrand et al., 2014) as well as the
species tree unaware method, PhyML (Guindon et al., 2010).

In Figure 2a, we plot the normalized Robinson—Foulds (defined
as the Robinson—Foulds distance divided by its maximum possible
value, and denoted as n—R—F in the following) distance of the recon—
structed gene trees to the true tree. These results show that all of the
species tree aware methods achieve better accuracy than the species
tree unaware method PhyML, which is to be expected as they are
given additional information in the form of the species tree. Among
the species tree aware methods, with an input of 10000 samples
TERA’s accuracy is statistically indistinguishable from the more
complex maximum likelihood based results from ALE (paired
Wilcoxon test P > 0.1) and is significantly more accurate than
TreeFix—DTL (Bansal et al., 2014, submitted for publication) (paired
Wilcoxon test P<1078) as well as the other species tree aware
method MowgliNNI (Nguyen et al., 2013). TERA also outper—
formed jPrIME—DLTRS, although the accuracy of the latter may
have been limited by the available run time (recall that a time out of
10h per each data set was given). For an input of 1000 samples,
TERA is less accurate than either TERA or ALE with 10000 input
samples (paired Wilcoxon tests P < 1078), statistically indistinguish—
able from jPrIME—DLTRS, slightly more accurate then TreeFix—DTL
(paired Wilcoxon test P : 0.026), and still significantly more accur—
ate than MowgliNNI and AnGST (paired Wilcoxon tests P < 1078).

[310'sp2umofp105xo'sopeuHOJIItotq/ﬁdnq

d.)
a:
c

E
a:
J
C

4..
o

E
an
0
E
m

L.

.Q

'0

“r

I

'c
a:

.5

T“
E
._
o
C

difference of the n-R-F distance to the species
tree of reconstructed and true trees

ALE

ALE

TERA
TERA 1000

 

TERA
TERA 1000

TreeFix TERA PhyML
-DTL AnGST CA=0 Mowgli

 

iPrIME
I :

'tting for single copy universal gene

TreeFix TERA PhyML
E -DTL AnGST 0,50 Mowgli

 

jPrlM

Figure 2

Table 1

/310'S[BHJHOFPJOJXO'SOIJBLUJOJIIIOIq/ﬂdnq

Joint amalgamation of parsimonious reconciled gene trees

847

 

are considered, Mowgli is the fastest method, but it is also the least
accurate (cf. Fig. 2a). For an input size of 1000 samples TERA
achieves comparable accuracy to TreeFix—DTL, but with a seven
fold reduced mean runtime. For an input size of 10000 samples
TERA achieves similar accuracy to ALE and outperforms TreeFix—
DTL, but considering the time to generate the required inputs
TreeFix—DTL is 1.3 times faster on average.

3.2 Results on real data

In order to test TERA on biological data, we again used the dataset
published in Szolliisi et al. (2013b), but focusing on real alignments.
As inputs to TERA we used: (i) the tree samples obtained from real
alignments and (ii) the ML species tree unaware gene trees obtained
using PhyML from the same alignments. Similar to the results of
ALE (Szolliisi et al., 2013b), we find that the number of transfer and
loss events (but not duplication events) in most parsimonious recon—
ciled gene trees is substantially lower than those found in the most
parsimonious reconciliations of PhyML trees: the mean and median
number of transfers per family was 3.914 and 3 compared with
10.38 and 9, respectively; the mean and median number of losses
per family was 5.088 and 4 compared with 7.542 and 7, respect—
ively, while the mean and median number of duplications per family
was 1.071 and 0 compared with 1.042 and 0, respectively.

4 Discussion

We have presented a detailed description of the TERA algorithm, a
parsimony—based species tree aware method of gene tree reconstruc—
tion. We demonstrate that TERA reconstructs gene trees with nearly
identical accuracy as the more complex ML based ALE method and,
at least on the simulated datasets considered here, outperforms the
other parsimony based species tree aware methods.

Examining a subset of single copy universal gene families we
show that TERA does not overfit or underfit the species tree. This
result lends credibility to TERA’s results on biological data, whereby
two thirds of apparent gene transfers in gene trees reconstructed
without taking into consideration the species tree are not recovered
given knowledge of the species phylogeny.

Although parsimony based methods are fundamentally limited in
some aspects compared with model based probabilistic methods, in
the case of species tree aware gene tree reconstruction our results in—
dicate that parsimony based methods can closely approach their ac—
curacy. A further advantage of TERA compared with the
corresponding probabilistic method ALE is that it is faster (if only
up to a constant factor), does not require explicit time—like branch
lengths that are difficult to estimate, and due to its relative simpli—
city, in particular the lack of numerical integration, is more robust
in practice. Compared with parsimony based methods that require
prior assumptions about statistical support, TERA is distinguished
by its ability to estimate a statistical support threshold from its in—
put. In contrast to the methods considered here it does require more
elaborate upstream analysis, taking as its input a sample of trees
from e.g. an MCMC—based tree inference methods, while in contrast
MowgliNNI requires a single tree with branch supports, and
TreeFix—DTL a multiple sequence alignment.

Finally, while we have shown that it is possible to estimate the
cA parameter, we have been less successful in estimating all four
costs (5.1:. A. cA) simultaneously, due to the tendency of the cost esti—
mates to diverge toward a very low transfer cost, and a correspond—
ingly large number of transfers. We expect that relaxing the, in

general, unrealistic assumption of independence between events
could ameliorate this problem.

Acknowledgements

The authors like to thank Eric Tannier, Bastien Boussau and Vincent Daubin
for the constructive discussions.

Funding

C.S. and E.]. were supported by the French Agence Nationale de la Recherche
Investissements d’avenir/ioinformatique (ANR-lO-BINF—Ol—OZ, Ancestrome).
G.].Sz. was supported by the Marie Curie CIG 618438 ‘Genestory’ and the
Albert Szent-Gyorgyi Call—Home Researcher Scholarship Al-SZGYA-FOK-
13-0005 supported by the European Union and the State of Hungary, co—
ﬁnanced by the European Social Fund in the framework of TAMOP 4.2.4. A/
1-11-1-2012-0001 ‘National Excellence Program’. This publication is contri-
bution no. 2014-178 of the Institut des Sciences de l’Evolution de Montpellier
[ISEM, UMR 5554].

Conﬂict of Interest: none declared.

References

Akerborg,O. et al. (2009). Simultaneous Bayesian gene tree reconstruction
and reconciliation analysis. Proc. Nat. Acad. Sci. USA, 106, 5714—5719.

Arvestad,L. (2003). Bayesian gene/species tree reconciliation and orthology
analysis using MCMC. Bioinformatics, 19, 7i—15i.

Bansal,M.S. et al. (2012). Efﬁcient algorithms for the reconciliation problem
with gene duplication, horizontal transfer and loss. Bioinformatics, 28,
i283—i291.

Boussau,B. et al. (2013). Genome-scale coestimation of species and gene trees.
Genome Res. 23, 323—330.

Conow,C. et al. (2010). Jane: a new tool for the cophylogeny reconstruction
problem. Algorithms Mol. Biol. 5, 16.

David,L.A. and Alm,E.]. (2010). Rapid evolutionary innovation during an
Archaean genetic expansion. Nature, 469, 93—96.

Doyon,]. et al. (2011). Models, algorithms and programs for phylogeny recon-
ciliation. BriefBioinform. 12, 392—400.

Doyon,].-P. et al. (2010). An efﬁcient algorithm for gene/species trees parsimo-
nious reconciliation with losses, duplications and transfers. In: Proceedings
of the 2010 International Conference on Comparative Genomics,
RECOMB-CG ’1 0, Springer-Verlag, Berlin, Heidelberg, pp. 93—108.

Felsenstein,]. (1981). Evolutionary trees from DNA sequences: a maximum
likelihood approach]. Mol. EUOl. 17, 368—376.

Guindon,S. et al. (2010). New algorithms and methods to estimate maximum-
likelihood phylogenies: assessing the performance of PhyML 3.0. Syst. Biol.
59, 307—321.

Hallett,M.T. and Lagergren,]. (2001 ). Efﬁcient algorithms for lateral gene transfer
problems. In: Proceedings of the Fiﬂh Annual International Conference on
Computational Biology, ACM, New York, NY, pp. 149—156.

Hohna,S. and Drummond,A. (2012). Guided tree topology proposals for
Bayesian phylogenetic inference. Syst. Biol. 61, 1—11.

Larget, B. (2013). The estimation of tree posterior probabilities using condi-
tional clade probability distributions. Syst. Biol. 62, 501—511.

Lartillot, N. et al. (2009). PhyloBayes 3: a Bayesian software package for
phylogenetic reconstruction and molecular dating. Bioinformatics, 25,
2286.

Le,S.Q. and Gascuel,O. (2008). An improved general amino acid replacement
matrix. Mol. Biol. Evol. 25, 1307—1320.

Maddison,W.P. (1997). Gene trees in species trees. Syst. Biol. 46, 523—536.

Nguyen, T. et al. (2012). Accounting for gene tree uncertainties improves gene
trees and reconciliation inference. In: B.,Raphael and J Tang (eds.)
Algorithms in Bioinformatics, volume 7534 of Lecture Notes in Computer
Science. Springer, Berlin Heidelberg, pp. 123—134.

ﬁm'sreumot‘pquo'sopeuuowtotq/ﬁdnq

848

C. Scornavacca et al.

 

Nguyen,T.H. et al. (2013). Reconciliation and local gene tree rearrangement
can be of mutual proﬁt. Algorithms Mol Biol, 8, 12.

Penel,S. et al. (2009). Databases of homologous gene families for comparative
genomics. BMC Bioinformatics, 6, S3.

Rannala,B. and Yang,Z. (2003). Bayes estimation of species divergence times
and ancestral population sizes using DNA sequences from multiple loci.
Genetics, 164, 1645—1656.

Rasmussen,M.D. and Kellis,M. (2007). Accurate gene-tree reconstruction by
learning gene- and species-speciﬁc substitution rates across multiple com-
plete genomes. Genome Res. 17, 1932—1942.

Rasmussen,M.D. and Kellis,M. (2010). A Bayesian Approach for Fast and
Accurate Gene Tree Reconstruction. Mol. Biol. Evol. 28, 273—290.

Rasmussen,M.D. and Kellis,M. (2012). Uniﬁed modeling of gene duplication,
loss, and coalescence using a locus tree. Genome Res. 22, 755—765.

Ronquist,F. et al. (2012). MrBayes 3.2: efﬁcient Bayesian phylogenetic inference
and model choice across a large model space. Syst. Biol. 61, 539—542.

Sjostrand,]. et al. (2014). A bayesian method for analyzing lateral gene trans-
fer. Syst. Biol. 63, 409—420.

Suchard,M.A. (2005). Stochastic models for horizontal gene transfer: taking a
random walk through tree space. Genetics, 170, 419—431.

Szollo'si,G.]. and Daubin,V. (2012). Modeling gene family evolution and rec-
onciling phylogenetic discord. Methods Mol. Biol. 856, 29—51.

Szollo'si,G.]. et al. (2012). Phylogenetic modeling of lateral gene transfer re-
constructs the pattern and relative timing of speciations. Proc. Nat. Acad.
Sci. USA, 109, 17513—17518.

Szollo'si,G.]. et al. (2013a). lateral gene transfer from the dead. Syst. Biol., 62,
386—397.

Szollo'si,G.]. et al. (2013b). Efﬁcient exploration of the space of reconciled
gene trees. Syst. Biol. 62, 901—912.

Szollo'si,G. et al. (2014). The inference of gene trees with species trees. Syst.
Biol. 64, e42—e62.

Than,C. and Nakhleh,L. (2009). Species tree inference by minimizing deep c0-
alescences. PLoS Comput. Biol. 5, e1000501.

Toﬁgh,A. (2009). Using trees to capture reticulate evolution, lateral gene
transfers and cancer progression. PhD Thesis, KTH Royal Institute of
Technology, Sweden.

Toﬁgh,A. et al. (2011). Simultaneous identiﬁcation of duplications and lat-
eral gene transfers. IEEE/ACM Trans. Comput. Biol. Bioinform. 8,
517—535.

Wu,Y.—C. et al. (2013). TreeFix: statistically informed gene tree error correc-
tion using species trees. Syst. Biol. 62, 110—120.

Wu,Y.—C. et al. (2014). Most parsimonious reconciliation in the presence of
gene duplication, loss, and deep coalescence using labeled coalescent trees.
Genome Res. 24, 475—486.

ﬁm'sreumot‘pquo'sopeuuowtotq/ﬁdnq

