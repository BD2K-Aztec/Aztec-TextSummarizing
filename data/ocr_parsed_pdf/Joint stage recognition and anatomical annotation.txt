Vol. 28 ISMB 2012, pages i16—i24
doi: 1 0. 1 093/bioinformatics/bts220

 

Joint stage recognition and anatomical annotation of drosophila

gene expression patterns

Xiao Cai. Hua Wang, Heng Huang* and Chris Ding
Department of Computer Science and Engineering, University of Texas at Arlington, Arlington, TX, 76019, USA

 

ABSTRACT

Motivation: Staining the mRNA of a gene via in situ hybridization
(ISH) during the development of a Drosophila melanogaster
embryo delivers the detailed spatio-temporal patterns of the gene
expression. Many related biological problems such as the detection
of co-expressed genes, co-regulated genes and transcription factor
binding motifs rely heavily on the analysis of these image patterns.
To provide the text-based pattern searching for facilitating related
biological studies, the images in the Berkeley Drosophila Genome
Project (BDGP) study are annotated with developmental stage term
and anatomical ontology terms manually by domain experts. Due to
the rapid increase in the number of such images and the inevitable
bias annotations by human curators, it is necessary to develop
an automatic method to recognize the developmental stage and
annotate anatomical terms.

Results: In this article, we propose a novel computational model
for jointly stage classification and anatomical terms annotation
of Drosophila gene expression patterns. We propose a novel
lit-Relational Graph (T G) model that comprises the data graph,
anatomical term graph, developmental stage term graph, and
connect them by two additional graphs induced from stage or
annotation label assignments. Upon the TG model, we introduce
a Preferential Random Walk (PRW) method to jointly recognize
developmental stage and annotate anatomical terms by utilizing the
interrelations between two tasks. The experimental results on two
refined BDGP datasets demonstrate that our joint learning method
can achieve superior prediction results on both tasks than the
state-of-the-art methods.

Availability: http://ranger.uta.edu/%7eheng/Drosophila/

Contact: heng@uta.edu

1 INTRODUCTION

The mRNA in situ hybridization (ISH) provides an effective way to
visualize gene expression patterns. The ISH technique can precisely
document the localization of gene expression at the cellular level
via visualizing the probe by colorimetric or ﬂuorescent microscopy
to allow the production of high quality images recording the
spatial location and intensity of the gene expression (Fowlkes
et (11., 2008; Hendriks et (11., 2006; L’ecuyer et (11., 2007; Megason
and Fraser, 2007). Such spatial and temporal characterizations of
expressions paved the way for inferring regulatory networks based
on spatio-temporal dynamics. The raw data produced from such
experiments includes digital images of the Drosophila embryo
(examples are visualized in Fig. 1) showing a particular gene
expression pattern revealed by a gene-speciﬁc probe (Grumbling

 

*To whom correspondence should be addressed.

et (11., 2006; Lyne et (11., 2007; Tomancak et (11., 2002, 2007). The
fruit ﬂy Drosophila melanogaster is one of the most used model
organisms in developmental biology.

Traditionally, such ISH images are analyzed directly by the
inspection of microscope images and available from well-known
databases, such as the Berkeley Drosophila Genome Project (BDGP)
gene expression pattern database (Tomancak et (11., 2002, 2007)
and Fly-FISH (L’ecuyer et (11., 2007). To facilitate spatio-temporal
Drosophila gene expression pattern studies, researchers needed
to solve two challenging tasks ﬁrst: Drosophila gene expression
pattern stage recognition (temporal descriptions) and anatomical
annotation (spatial descriptions). As shown in Figure l, Drosophila
embryogenesis has been subdivided into 17 embryonic stages. These
stages are deﬁned by prominent features that are distinguishable in
living Drosophila embryos (Weigmann et (11., 2003). To recognize
the stages of the Drosophila, embryos provide their time course
patterns. On the other hand, the Drosophila gene expression patterns
are often recorded by controlled vocabularies from the biologist’s
perspective (Tomancak et (11., 2002). Such anatomical ontology
terms describe the spatial biological patterns and often cross stages.
What is more, because the ISH images are attached to each other
collectively becoming bags of images, the corresponding stage label
as well as anatomical controlled terms are the descriptions of the
whole group of images instead of each individual image inside
the bag. A Drosophila embryo ISH image bag belongs to only
one stage, but has multiple related anatomical terms. Previously,
those two tasks are tackled by domain experts. However, due to
the rapid increase in the number of such images and the inevitable
bias annotation by human curators, it is necessary to develop an
automatic method to classify the developmental stage and annotate
anatomical structure using controlled vocabulary.

Recently, a lot of research works have been proposed to solve
the above two problems. They considered the stage recognition
as a single-label multi-class classiﬁcation problem while the
anatomical annotation was treated as a multi-label multi-class
classiﬁcation problem. (Kumar et (11., 2002) ﬁrst developed an
embryo enclosing algorithm to ﬁnd the embryo outline and
extract the binary expression patterns via adaptive thresholding.
(Peng and Myers, 2004) and (Peng et (11., 2007) developed
new ways to represent ISH images based on Gaussian mixture
models, principal component analysis and wavelet functions.
Besides that, they utilized min-redundancy max-relevance to do
the feature selection and automatically classify gene expression
pattern developmental stages. Recently, (Puniyani et (11., 2010)
constructed a system (called SPEXZ) and concluded that the
local regression (LR) method taking advantage of the controlled
term—term interactions can get the best enhanced anatomical
controlled term annotation results. The LR method was proposed
by Ji et (11. and developed based on their previous works

 

© The Author(s) 2012. Published by Oxford University Press.

This is an Open Access article distributed under the terms of the Creative Commons Attribution Non—Commercial License (http://creativecommons.org/licenses/
by—nc/3.0), which permits unrestricted non—commercial use, distribution, and reproduction in any medium, provided the original work is properly cited.

112 /3.Io's[sumo[pJOJXO'sorwurJOJurorqﬂ:duq 11101} papeolumoq

9103 ‘Og anﬁnv uo ::

Drosophila gene expression patterns

 

 

 

 

Stage images anatomical terms

celluar blasloderm
( . .. , .
4 6 1. . “A procephalic ectoderm anlage in 51am nascen
' _ - ’ Anterior endoderm anlagein statJ nascenti
"-
Subset
Posterior endoderm anlage Ill Slatu nascendi
do’sal anoderm primordium
._ ‘
7-3 forcgu: anlage

cwpeolabrum anlage

 

foregu: primordiu m

b -“
9-10 .‘“ ‘ J 'h J ' salivaryglandbody-specifrcanlagc

. anterior endoderni primordium

posterior endoderm urimordium
trunk memderm pl'lillUlljllJlil

head mesoderm prrmordium P2
salivary gland body prilnnrdium

 

11—12 ' . a?“

anterior midgut nromordulm
poiterior midgur primord'um
trunk mesnderm prirnuldium
head mesoderm primordium

hirdgut proper primordium

 

a...“ 'Iu' Embryonirdorsalepiderrris
"- -- -"" enibryonit head epidermis

embry onic ve atral epidermis

 

Fig. 1. Examples of Drosophila embryo ISH images and associated
anatomical annotation terms in the stages 4%. 778. 9710. 11712 and 13716
in the BDGP database. The darker stained region highlights the place where
the gene is expressed. The darker color the region has. the higher the gene
expression level is

(Ji et (11., 2008, 2010; Li et (11., 2009; Shuiwang et (11., 2009).All of
the above methods have provided new inspirations and insights
for classifying or annotating Drosophila gene expression patterns
captured by ISH. However, none of them considered doing those two
tasks simultaneously. As we know, intuitively, anatomical controlled
vocabulary terms provide evidence for the stage label and vice versa.
For example, the early stage range is more likely annotated with the
controlled terms such as ‘statu nascendi’ and ‘celluar’ than the terms
‘embryonic’ and ‘epidermis’. Therefore, besides the image—stage
and image—annotation relationships which have been well studied
and applied in the previous research, it is necessary to take advantage
of the correlations between stage classes and annotation terms.

In this article, we propose a novel Tri-Relational Graph (TG)
model that comprises the data graph, anatomical controlled terms
graph, developmental stage label graph to jointly classify the
stage of images and annotate anatomical terms simultaneously.
Upon the TG model, we introduce a Preferential Random
Walk (PRW) method to simultaneously produce image-to-stage,
image-to-annotation, image-to-image, stage-to-image, stage-to-
annotation, stage-to-stage, annotation-to-image, annotation-to-stage
and annotation-to-annotation relevances to jointly learn the salient
patterns among images that are predictive of their stage label
and anatomical annotation terms. Our method achieves superior
developmental stage classiﬁcation performance and anatomical
terms annotation results compared with the state-of-the-art methods.

We consider each image bag as a data point and extract the bag-
of-word features that are widely used in computer vision research as
the corresponding descriptors. Since the real object is 3D and each

image can only provide 2D observation from a certain perspective,
we integrate the bag-of-word features for different views. We
summarize our contributions as follows:

(1) This article is the ﬁrst one to propose a novel solution to
the questions ‘What is the developmental stage?’ and ‘What
are the anatomical annotations’ simultaneously, given an
unlabeled image bag.

(2) Via the new TG model that we constructed, the relationships
between stage label and anatomical controlled terms as well
as the correlations among anatomical terms can be naturally
and explicitly exploited by the graph-based semi-supervised
learning methods.

(3) We propose a new PRW method to seek the hidden
annotation—annotation and annotation—stage relevances.
Other than only using image-to-image relevance conducted
by existing methods, we can directly predict the stage label
and annotate anatomical controlled terms for unknown image
bags.

2 DATA DESCRIPTORS

As we known, the Drosophila embryos are 3D objects. However,
the corresponding image data can only demonstrate 2D information
from a certain view. Since recent study has shown that incorporating
images from different views can improve the classiﬁcation
performance consistently (Ji et (11., 2008), we will use the images
taken from multiple views instead of one perspective as the data
descriptor. We only consider the lateral, dorsal and ventral images
in our experiment due to the fact that the number of images taken
from other views is much less than that of the above three views. All
the images from BDGP database have been pre-processed, including
alignment and resizing to 128 X 320 gray images. For the sake of
simplicity, we extract the popular SIFT (Lowe, 2004) features from
the regular patches with the radius as well as the spacing as 16 pixels
(Shuiwang et (11., 2009), which is shown in Figure 2. Speciﬁcally,
we extract one SIFT descriptor with 128 dimensions on each patch
and each image is represented by 133 (7 X 19) SIFT descriptors.
Nevertheless, the above SIFT features cannot be directly used to
measure similarity between data points (image bags), because the
number of images in each image bag is different. In order to get a
desired equal length descriptor to release the burden of later learning
task, we need to build codebook for all extracted SIFT features ﬁrst
and then redo the data representations for each image bag based on
the constructed codebook.

2.1 Codebook construction

Usually the codebook is established by conducting the clustering
algorithms on a subset of the local features, and the cluster centers
are then chosen as the visual words of the codebook. In our study,
we use K—means to do the clustering on the training image bags.
Since the result of K -means depends on the initial centers, we repeat
it with 10 random initializations from which the one resulting in
the smallest objective function value is selected. The number of
clusters is set to 1000, 500 and 250 for lateral, dorsal and ventral
images, respectively, according to the total number of images for
each view as shown in Table 1. (Other codebook sizes gave similar
performance.)

 

i1?

112 /3.Io's[sumo[pJOJXO'sorwuiJOJurorqﬂ:duq 11101} papeolumoq

9103 ‘Og isnﬁnv uo ::

X.Cai et al.

 

717175151
34”.
a

I? ‘7 1r

43.43.18,;

. 3 var i'l"VV'1""|?‘"U'I-~t-I
3.“; 5"34'a’sﬁ'n’a’m’sgl '
v. 1

9'1 P"? are r1 r'q r'
1.4“; A'L.1'L.4\.4‘L.4'L.4'L‘.4’

-
- u- vr 1
1.94%.}; 4'; a



 

Fig. 2. Demonstration of the regular patches. We extract one SIFT feature
on one patch. where the radius and spacing of the regular patches are set to
16 pixels

Table 1. The statistics summary of the reﬁned BDGP images with 79 terms

 

 

Stage range #6 778 9710 11712 13716 Total
Size of control term 11 12 12 2O 31 79
No. of image bags 500 500 500 500 500 2500

No. of lateral images 1514 812 727 1356 1004 5414
No. of dorsal images 226 324 431 447 724 2152
No. of ventral images 164 137 81 214 216 812

 

2.2 Data (image bag) representations

After we get three codebooks, the images in each bag are quantized
separately for each view. Features computed from patches on images
with a certain view are compared with the visual words in the
corresponding codebook and the visual word closest to the feature
in terms of Euclidean distance is utilized to represent it. Therefore,
if an image bag encompasses the images from three views, then
it could be represented by three bags of words, one for each
view. We concatenate the three vectors so that the images with
different views (lateral, dorsal and ventral) in one bag can be
represented by one vector. To be speciﬁc, Let x] e R1000,xd ER500
and x" ERZSO denote the bag-of-words vector for images in a bag
with lateral, dorsal and ventral view, respectively. The descriptor for
this image bag can be represented as x: [x] ;xd ; x"] e R1750. Since
not all the image bags enclose the images from all three views, the
corresponding bag-of-words representation is a vector of zeroes if a
speciﬁc view is absent. Moreover, in order to capture the variability
of the number of images in each view and each bag, we normalized
the bag-of-words vector to unit length. At last, each image bag is
represented by a normalized vector x.

3 METHODS

In this section. we ﬁrst construct a TG to model Drosophila gene expression
patterns followed by proposing a novel PRW method. Using PRW on TG, we
jointly make stage classiﬁcation and annotate anatomical terms of Drosophila
gene expression patterns.

For the Drosophila gene expression pattern data. we have n gene
expression images bags X = {x1, - -- ,xn}. where each image bag is abstracted
as a data point xieRl’. Each data point x, belongs to one of Kc stage
classes C={C1,CKC} represented by yfe{0,1}KC, such that yf(k)=1 if
x, is classiﬁed into class ck. and 0 otherwise. Meanwhile. each image
bag x, is also annotated with a number of anatomical ontology terms
A={a1,---,aKa} represented by y?e{0,1}Kﬂ. such that y?(k)=1 if x, is
annotated with term ak, and 0 otherwise. Also, for convenience. we write

yl. = [yfT,y;’T]T e {0, 1}KC+K”. Without loss of generality, we assume the ﬁrst

1 < n image bags are already labeled. which are denoted as T 2 {xi, yi}§:l. Our
task is to learn a functionf :X —> {0, 1}“ +K“ from T that is able to classify an
unlabeled data point x,»(1+ 1 5 i 5 n) into one stage class in C and to annotate
it with a number of anatomical terms in A at the same time. For simplicity, we
write Y6 = [y1, - -- ,yft], Y = [y",---,yjt’]. and Y = [y],  ,yn]. As introduced
in Section 1. the stage class and anatomical terms have some relations. We
utilize the following afﬁnity matrix to model their interrelations. R e RK'? XK” .
where R(i , j) indicates how closely class C,» and term 31- are related. In this
work. we compute it as

 

 

 

 

 

 

 y?) (1)

 

Rri,j>=cos<y§,y;'>=<y§,y;' >/(j

where  is the i-th row of Y6 and  is the j-th row of Y”. Throughout this
article, we denote a vector as a bold lowercase character and a matrix as an
uppercase character. We denote the i-th entry of a vector V as V(i), and the
entry at the i-th row and j-th column of a matrix M as M(i,j). ||V|| denotes
the Euclidian norm of vector V. And the inner product of two vector V1 and
V2 is deﬁned as <V1,V2 >=V1TV2.

3.1 The construction of TG

Given the dataset X . pairwise similarity WX 6 RM” between data points can
be computed using the Gaussian kernel function.

.._ exp(-||Xi—Xj||2/2"2~ i751
WX (l '1) _ 0, otherwise (2)

where the vector x is calculated using bag-of—word features for one image
bag. Regarding the parameter a, we resort to self-tuning method (Zelnik-
Manor and Perona, 2004). WX (i , j) indicates how closely x, and xj are related.
From WX . a graph 9X =(VX ,SX) can be induced, where VX =X and 8X E
VX >< VX. And we use kNN graph. To be speciﬁc, we connect xi,xj if one
of them is among the other’s k nearest neighbor and deﬁne the value of
the edge connecting them by Equation (2). Because 9X characterizes the
relationships between data points, it is usually called as data graph. such
as the middle subgraph in Figure 3. Existing graph-based semi-supervised
learning methods (Kang at 611., 2006; Zha at 611., 2008) only make use of the
data graph, on which the class label information is propagated.

Different from conventional single-label classiﬁcation learning problem in
which classes are mutual exclusive. the anatomical terms are interrelated with
one another. Again. we resort to cosine similarity to calculate the controlled
term afﬁnity matrix WA, where WAG, j) indicates the correlation between
a, and 31-. Thus. a graph QA =(VA,8A) is induced. where VA 2A and 6}; E
VA >< VA. We call QA as annotation label subgraph. which is shown as the
right subgraph in Figure 3. Similarly, stage classiﬁcation label graph shown
as the left subgraph in Figure 3. g5=(V5,85) can be constructed from
stage classiﬁcation labels. where V5 2 C and 85 E V5 >< V5. where we deﬁne
the value of the edge connecting two stage labels as W5(i,j)= “S1,, —S;,j| F.
where || H F means Frobenius norm and S1,, denotes the between class scatter
matrix for stage 1'. Connecting 9X and QA by the annotation associations Via
the green dashed lines, connecting 9X and g5 by the class associations Via
the blue dashed lines and connecting g5 and QA by the stage-term association
Via the purple dashed lines, we construct a TG as following:

 

G=(VxUVcUVA,gXUgAngcUgXAUgCA), (3)

which is illustrated in Figure 3. Obviously. the subgraph QAX = (VX , VA , SXA)
connects GX and GA, whose adjacency matrix is YHT. Similarly, the
adjacency matrix ofg5x =(VX , V5 , 8X5) is Y}. The subgraph (V5,VA,85A)
characterizes the associations between stage classes and anatomical terms
whose adjacency matrix is R deﬁned in Equation (1).

In contrast to existing graph-based semi-supervised learning methods that
only use information conveyed by 9X . we aim to simultaneously classify and
annotate an unlabeled data point using all the information encoded in g . Since
all data points (gene expression image bags). stage terms and annotation
terms are equally regarded as vertices on g, our task is to measure the

 

i18

112 /3.IO'S[BUmOprOJXO'SOIJBLUJOJIIIOIq”Idllq 11101} papeo1umoq

9103 ‘0g anﬁnv uo ::

Drosophila gene expression patterns

 

 

Classification label I
subgraph |

    

 

 

 

 

 

 

 

 

 

 

 

 

 

l
|
|
I |
' |
: |
|
|
U l
Annotation label I
| GA_ A’EA) subgraph )
/ EA
EX
0 — o _ EAX
I — — — ECA
Data
subgraph| - ECX
_ _ _ _/ — -? — Unknown

Fig. 3. The TG constructed from the gene expression data. Solid lines indicate afﬁnity between vertices within in a same subgraph. dashed lines indicates

associations between vertices in two different subgraphs

relevance between a class/anntotation term vertex and a data point vertex.
As each class/annotation term has a set of associated training data points,
which convey the same biological record information as the class/annotation
term. we consider both a class/annotation term vertex and its labeled training
image bag vertices as a group set,

Gk=CkU1thyi(/<)=1}. (4)

which is illustrated as the vertices with orange boundary in 3. As a result,
instead of measuring vertex-to-Vertex relevance between a class/annotatation
term vertex and an unlabeled data point vertex, we may measure the set-to-
Vertex relevance between the group set and the data point. Motivated by Brin
and Page (1998); Tong et a1. (2006). we consider to further develop standard
random walk and use its equilibrium probability to measure the relevance
between a group set and an unlabeled data point.

3.2 Preferential random walk

Standard random walk on a graph W can be described as a Markov process
with transition probability M =D‘1W. where d, zsz(i,j) is the degree
of vertex i and D=diag(d1,--- ,dn). Clearly. MT 75M and ZJ-M(i,j)= 1.
When W is symmetric. it corresponds to an undirected graph. When W
is asymmetric. it corresponds to a directed graph and (1, is the out degree
of vertex i. Let p“) be the distribution of the random walker at time t,
the distribution at t+1 is given by p(’+l)(j)=Zip(’)(i)M(i,j). Thus. the
equilibrium (stationary) distribution of the random walk 1)" =p(’:°°) is
determined by M Tp* :1)". It is well known that the solution is simply given
by p*=We/(Zid,)=d/(Zid,). where d: [d1  ,d,,]T.

It can be seen that the equilibrium distribution of a standard random walk
is solely determined by the graph itself, but independent of the location where
the random walk is initiated. In order to incorporate label information, we
propose the following PRW:

P(’+l’v‘)=(1—a)Zip(”(i)M(i.j)+ah-. (5)

where 0 <0; g 1 is a ﬁxed parameter. and h, called preferential distribution,
is a probability distribution such that h(i) 2 O and Zihﬁ): 1. Equation (5)
describes a random walk process in which the random walker hops on

the graph W according to the transition matrix M with probability 1—01,
and meanwhile it takes a preference to go to other vertices speciﬁed by h
with probability at. The equilibrium distribution of PRW in Equation (5) is
determined by p" =(1 —ot)MTp* +oth, which leads to:

p*=a[1_(1—a)MT]—‘h. (6)

Due to Perron-Frobenius theorem. the maximum eigenvalue of M is less than
maxiZJ-M(i,j)= 1. Thus. I —(1—(¥)MT is positive deﬁnite and invertible.
Equation (5) takes a similar form to two existing works: random walk with
restart (RWR) method (Tong et a1. . 2006) and PageRank algorithm (Brin and
Page. 1998). In the former. h is a vector with all entries to be 0 except one
entry to be 1 indicating the vertex where the random walk could be restarted;
while in the latter, h is a constant vector called as damping factor (Brin and
Page. 1998). In contrast, the preferential distribution vector h in Equation (5)
is a generic probability distribution, which is ﬂexible thereby more powerful.
Most importantly, through h we can assess group-to-Vertex relevance. while
RWR and PageRank methods measure vertex-to-Vertex relevance.

Similar to RWR (Tong et a1.. 2006), when we set the h to be a probability
distribution in which all the entries are 0 except for those corresponding to
gk, p*(i) measures how relevant the k-th group is to the i-th vertex on g.

3.3 Preferential random walk on TG

In order to classify and annotate unlabeled data points using the equilibrium
probabilities in Equation (6) of the PRW on TG, we need to construct the
transition matrix M and the preferential distribution h from g.
Construction of the transition matrix M :

Let

Mx ch MXA
M: Mcx MC MCA . (7)
MAX MAC MA

where MX. M5 and MA are the intrasubgraph transition matrices of gx,
g5 and QA respectively. and the rest six sub-matrices are the intersubgraph
transition matrices among QX. g5 and QA. Let 131 e [0, 1] be the jumping
probability. i.e. the probability that a random walker hops from 9X to Q5
and Vice versa. And let [3; e [0, 1] be the jumping probability from 9X to

 

HQ

112 /3.Io's[Bumo[pJOJXO'sorwuiJOJurorqﬂ:duq 11101} papeo1umoq

9103 ‘0g anﬁnv uo ::

X.Cai et al.

 

QA or Vice versa. Therefore. ﬁl and ﬁg regulates the reinforcement between
9X and one of the other two subgraphs. When both ﬁl =0 and ﬁg :0, the
random walk are performed independently on QX. which is equivalent to
existing graph-based semi-supervised learning methods only using the data
graph gx. Similarly, we deﬁne A as the jumping probability from g5 to Q;
or Vice versa.

During a random walk process, if the random walker is on a vertex of the
data subgraph which has at least one connection to the label subgraph. such
as vertex X] in Figure 3. she can hops to the class label or annotation subgraph
with probability ﬁl or annotation subgraph with probability ﬁg, or stay on
the data subgraph with probability 1— ﬁl —ﬁg and hop to other vertices of
the data subgraph. If the random walker is on a vertex of the data subgraph
without a connection to the class label or annotation subgraph. she stays on
the data subgraph and hops to other vertices on it as in standard random walk

T
process. To be more precise. let (11%2 = Z]. YCT(i,j). the transition probability
from x, to c]- is deﬁned as following:

T . . Y] Y]
p(c,-ixt>=Mxe(i,j>= ﬁchl’JWi ~ 42‘ >0 (8)
0, otherw1se.

Similarly, let (111/C =2]. Yc(i,j). the transition probability from C,» to xj is:

13. mayo”, d,” > 0,
0, otherwise.

p(leci)=MCX(ivj)={ (9)

Following the same deﬁnition, the rest four inter-subgraph transition
probability matrices are deﬁned as:

T . . Y,,T . y]
p<ajixt>=MXAm>= ﬁzYaWWz‘ ~ 0% >0~ (10)
0, otherw1se.
Y(’ 3d“ fit“ 0
P(leai)=MAX(iij)= ’32 (I’d/i ' ’ .i > ' (11)
0, otherw1se.
YaT T - ~ Ya . .
wherea’i zija (i,])anda’i zija(i,]).and
T ~ ~ RT ~ RT
p(cilat>=MAe(i,j>= AR ("D/‘4’ ' W” >0: (12)
0, otherw1se.
_ >_ .._ twin/[15, ifdl.R>0,
p<a,Ic.>—Me1(z,i>—{ 0, otherwise (13)

where diRT = ZjRTU, j) and d}? = Zth', j).

Let d," = zjwirm). d,Y = z,- Ym). d?" = z,- Qamt [1,90 = 2,- (2.011)
where Q, =R+ Y,, and QC =RT + Yo.
The data subgraph intra transition probability from x, to xj is computed as:

. . _ . . _ (1—51—52)WX(itj)/diX7 if €1in >0
P(lexi)—Mx(z.J)—: WX(l-7j)/diX, otherwise
(14)

Similarly, let (1?: ZJ- WA(i,j), the annotation label subgraph intra
transition probability from a, to 31- is:

. . . QT
. ._ --_ (l—ﬂt—MWAkocI-‘ttel-“>0
l_M ’ _ l l 15
walla) A01) l WA(i,j)/d;‘, otherwise ( )

let (11.6221. W5(i,j). the classiﬁcation label subgraph intra transition
probability from C,» to c]- is:

(1 —ﬂi —A)Wc(i.j)/d,0 , if (1,93 > 0

(16)
WCUijl/dic, otherwise

P(cjlci)=MC(itj)=:

It can be easily veriﬁed that. ZjM(i,j)= 1. i.e. M is a stochastic matrix.

Construction of the preferential distribution H .' the preferential distribution
vector speciﬁes a group of vertices to which the random walker prefers
to moving in every iteration step. The relevance between this group and
an vertex is measured by the equilibrium distribution of the random
walk process. Therefore, we construct K =Kc+Ka preferential distribution
vectors, one for each semantic group Gk:

yhﬂc)
h“): (1 Pilaf) emf“ (17)
_y C

where h§)(i)=1/Z,y,(k) if y,»(k) =1 and h‘fgu) :0, otherwise; h‘fln) = 1,
if i = k. y e [0, 1] controls how much the random walker prefers to go to the
data subgraph QX and other two subgraphs g5, QA. It can be veriﬁed that
Zih(k)(i)=1. i.e. W is a probability distribution. Let [K be the identity
matrix of size K ><K. we write

H=[h“),---,h(K)]=[(1)/1:131 ] (18)
_ K

PRW on TG: given the TG of a dataset, using the transition matrix M
deﬁned in Equation (7) and the preferential probability matrix H deﬁned in
Equation (18). we can perform PRW on the TG. According to Equation (6).
its equilibrium distribution matrix P" is computed as:

P*=ot[I—(1—ot)MT]_1H, (19)

P" =[pT,--- ,p’lz] ER(”+K)XK. and p: is the equilibrium distribution of the
PRW taking the k-th semantic group as preference. Therefore. p20) (1+
1 g i g n) measures the relevance between the k-th class and an unlabeled
image bag xi. We can predict the stage class from the sub-matrix P; by
Equation (20) and annotate the controlled terms for x, using the adaptive
decision boundary method (Wang et a1.. 2009) on the submatrix Pig” by
Equation (21).

P*(1+1,1)  P*(t+1,K,)
P36: 5  5 (20)
P*(n,1)  P*(n,Kc)

P*(1+1,Kc+l)  P*(1+1,KC+Ka)
PL:    (21)
P*(n7Kc+1) P*(nth+Ka)

Since the stage prediction is a single-label classiﬁcation problem, we select
the stage label y(i)”* with the maximum probability as the stage label for
image bag xi.

y(i)c*=argmax(g),Vi=1+1,l+2,...,n. (22)
k

where 1)? is the i-th row vector of matrix P2}. Therefore. we can do the stage
classiﬁcation and anatomical controlled term annotation simultaneously.

4 DATA REFINEMENT

In this section, we will introduce the details of the data used in
our experiment. Drosophila embryogenesis has 17 stages, which
are divided into 6 major ranges, i.e. stages 1—3, 4—6, 7—8, 9—10,
11—12 and 13—16 (the stage 17 is usually studied individually), in
the BDGP database (Tomancak et (11., 2002). Each image bag is
labeled with one stage term and many controlled vocabulary terms.
The total number of anatomical controlled vocabulary terms is 303.

We used the following way to reﬁne the dataset. First, we only
keep the image bag data with lateral, dorsal and ventral view
information. And then, we eliminate six common annotation terms,
that is, ‘no staining, ubiquitous, strong ubiquitous, faint ubiquitous,

 

i20

112 /3.Io's[Bumo[pJOJXO'sorwuiJOJurorqp:duq 11101} papeo1umoq

9103 ‘0g isnﬁnv uo ::

Drosophila gene expression patterns

 

maternal, rapidly degraded’, which can be regarded as outliers
because they can neither provide stage-speciﬁc information nor
record anatomical structures. After that, we remove the anatomical
terms whose data sample is <50. We ignore the stage 1—3 data since
the number of anatomical terms after the above procedure becomes
2, too small to be compared with other stages. And ﬁnally we get 79
anatomical annotation terms in total that we will consider to annotate
the unlabeled image bag.

We reﬁne the data mainly based on the following two reasons.
On one hand, the annotation terms which appear in too few image
bags are statistically too weak to be learned effectively. On the other
hand, since we will use S-fold cross-validations in our experiments,
we have to guarantee there is at least one data point associated with
each anatomical term in each fold. Moreover, in order to balance the
number of image bags for different stages, we randomly sample 500
image bags as the data points for each stage. At last, the summary
of the reﬁned dataset is shown in Table 1.

5 EXPERIMENT

In this section, we will conduct experiments to evaluate PRW
empirically on the reﬁned dataset and compare it with other
state-of-art classiﬁcation methods. Since our method can do joint
classiﬁcation, in order to evaluate the beneﬁt of joint learning, we
compare its performance with that of the state-of-art multiclass
single label or multiclass multilabel algorithms which can only
handle either stage classiﬁcation or anatomical term annotation
problem. Our procedure is to train our model with stage labeled
and anatomical term annotated image bags. All testing image
bags are unlabeled with developmental stage and unannotated with
anatomical controlled terms.

5.1 Experimental setup

When constructing PRW on TG, we used kNN graph setting k=9.
We used ‘inverse’ S-fold cross-validation to determine the values
of the following ﬁve parameters, that is, using 1-fold for training
and using the remaining 4-folds for testing to mimic the scenario
in the real application where the number of training data is much
less than the testing data. In our experiment, we found that the
following ﬁve parameters are not sensitive in certain ranges with
good performances. ﬁl, ﬁg and )1 controls the jumping between
different subgraphs and cannot affect the result much if they are
assigned in the range of (01,045). at controls initial preference of
the random walker and will get stable result if it is assigned in the
range of (001). y controls how much the random walker prefers
to go to the data subgraph or to go to two other subgraphs and it is
usually in the range of (0.1,0.3).

Besides those parameters, we also need to initialize the stage
as well as anatomical controlled terms for the testing image bag
xi, where i=1+ 1, ...,n, 1 is the number of training image bag. In
our experiment, we used k-nearest neighbor (KNN) method to do
the initializations for both stage classiﬁcation and anatomical term
annotations tasks because of its simplicity and clear intuition. To
be speciﬁc, we use k=1 and we abbreviate it as 1NN. Our joint
classiﬁcation framework will self-consistently amend the incorrect
labels for stage and controlled terms. We perform 10 random splits of
the data and report the average performance over the 10 trials. Please

note that, in each trial, we still do ‘inverse’ S-fold cross validation
and record the average performance result as the result of that trial.

5.2 Image bag stage classiﬁcation

Drosophila gene expression pattern stage categorization is a single-
label multi-class problem. We compare the result of our method with
that of support vector machine (SVM) with radial basis function
(RBF) kernel (Chang and Lin, 2001). We use the optimal parameter
values for C and y got from cross-validation as well. We also
compare the classiﬁcation result of 1NN that we use to do the
initialization. We assess the classiﬁcation in terms of the average
classiﬁcation accuracy and the average confusion matrices. Since the
data that we used is class balanced, the mean value of the entries on
the diagonal of the confusion matrix is also the average classiﬁcation
accuracy. From the resulting average confusion matrices shown in
Figure 5, we can see that the average prediction accuracy of our
method is better than that of the other two state-of-art methods,
especially in the last stage 13—16, where the number of anatomical
terms is greatly larger than that of the other stages.

5.3 Image bag controlled vocabulary terms annotation

Besides the stage classiﬁcation task, we also validate our method
by predicting the anatomical controlled terms for the Drosophila
gene expression patterns, which can be considered as a multi-class
multi-label classiﬁcation problem. The conventional classiﬁcation
performance metrics in statistical learning, precision and F1 score,
are utilized to evaluate the proposed methods. For every anatomical
term, the precision and F1 score are computed following the standard
deﬁnition for the binary classiﬁcation problem. To address the multi-
label scenario, following Tsoumakas and Vlahavas (2007), macro
and micro average of precision and F1 score are used to assess the
overall performance across multiple labels. We compared four state
of art multi-label classiﬁcation methods: local shared subspace (LS)
(Ji et (11., 2008), local regression (LR) (Ji et (11., 2009), harmonic
function (HF) (Zhu et (11., 2003) and random walk (RW) (Zhou
and Scholkopf, 2004). All of them are proposed recently to solve
the multilabel annotation problem. In addition, we compare the
results of 1NN as well. For the ﬁrst three methods we use the
published codes posted on the corresponding author’s websites. And
we implement the RW method following the original work (Zhou
and Scholkopf, 2004). For HF and RW methods, we follow the
original work to solve the multilabel annotation only. Therefore, we
only evaluate those two methods on data subgraph and annotation
label subgraph without using any information derived from the
classiﬁcation label subgraph such as the stage—term correlation.
Table 2 shows the average anatomical annotation performance of
79-term dataset. Compared to the above ﬁve stat-of-the-art methods,
our method has the best results by all metrics. Figure 6 illustrates
the average Micro F1 score of our method, 1NN, LS, LR, RW and
HF approaches for all the anatomical terms on 79-term dataset. And
again, our method consistently achieves best performance for most
of the anatomical controlled terms.

5.4 The advantage of joint learning

Unlike the traditional work, our proposed method can take advantage
of all the information to do the stage classiﬁcation and anatomical
term annotation simultaneously. Therefore, when the number of
training data is scare, we can resort to both intrarelations and

 

i21

112 /3.Io's[Bumo[pJOJXO'sorwuiJOJurorqp:duq 11101} papeo1umoq

9103 ‘0g isnﬁnv uo ::

X.Cai et al.

 

  

 
 

Anatomical Sta e _
if E: ::e Terms-Stages Correlatlon

” N . \\ 1.Mllallg'h-£|“I1ul “m

I earest Nelghbor \ “mm 3.. EL rill“

I in Data Subgraph I Mr " °

|

I

I

l

I

I Terms 18, 29, 75 all

I have high correlat

: with stage 13-1

| Stage I

I Unknown

I

I

: .l1 dm -

I The similarities with 1511311133 “‘

I the 1St and 2ml Nearest

I Neighbor on the Data

| subgraph is not high

I

I

I

I

|

I

I

2nd Nearest Neighbor “r” .N n
\ i D t 3 br h I m umgﬁﬁgﬁggﬁ
~-: 33-1%-; emitters.

    
       
   
 
 
 
   
  
 
  
      

Terms-Terms Correlation

0

Fig. 4. The middle part demonstrates the termsestages correlation and the right part shows the termseterms correlation of 79 terms. The stage unknown test
data shown in the left part is classiﬁed correctly as Stage 13716. because of the strong correlation between the predicted stage and its predicted anatomical

terms and Vice versa, NOT the similarity of its ﬁrst and second nearest neighboring data induced from the data graph only

Table 2. Annotation prediction performance comparison
on the 79-term dataset

 

 

Method Ma Pre Ma F1 Mi Pre Mi F1

1NN 0.3455 0.3595 0.2318 0.2230
LS 0.5640 0.3778 0.3516 0.1903
LR 0.6049 0.4425 0.3953 0.2243
RW 0.4019 0.3385 0.2808 0.1835
HF 0.3727 0.3296 0.2756 0.1733

Our method 0.6125 0.4434 0.4057 0.2336

 

Ma Pre, Avg. Macro Precision; Ma F1, Avg. Macro F1; Mi Pre,
Avg. Micro Precision; Mi F1, Avg. Micro F1.

interrelations to make the decision for stage classiﬁcation and
anatomical controlled term annotation simultaneously. When there
are strong correlation between those two tasks, we expect that
the performance of both tasks will be enhanced by joint learning
work than treating them individually and independently. Figure 4
shows the pairwise label correlations of the 79 terms and stage—terrn
correlations between 5 stages and 79 terms. As highlighted by purple
arrows, we can observe that there are high pairwise correlations
between the terms ‘embryonic brain’,‘ventral nerve cord’ as well
as ‘embryonic/larval muscle system’. Moreover, all the above three
terms have high correlations with the stage 13—16, which can provide
strong evidence that the given testing image bag could belong to
the last developmental stage besides the induction from the data
graph only. If our joint classiﬁcation framework annotates it with all
those three terms, although from the data similarity we cannot get

(a) (b) (C)
4t06 me 9t010 11t012 13t016 4t06 ms 9mm 11t01213t016 4t06 7to8 9to10 11to12 13t016
0.01 0.01 0.01 0.0-1 0,01 0.00 0.02 "-5? "-93 0W 0-02 04""

   
  

           

    
  
  
 
 

0.02
um “I”, 0.01 0.11 0.02 0.06
0.02 MS
0.05 0.01

0.0? 0.01 0.03 . II.“ 0.01

1NN: acc. 77.40% our: acc. 85.20%

SVM: acc. 84.50%

Fig. 5. Stage classiﬁcation results in terms of confusion matrices on 79-term
dataset: (a) the confusion matrix calculated by SVM (b) the confusion matrix
calculated by 1NN. (c) the confusion matrix calculated by our method. (a)
SVM: acc. 84.50%; (b) 1NN: acc. 77.40%; (c) our: acc. 85.20%

strong evidence for the stage prediction, we can take advantage of
the terrn—term as well as term—stage high correlations to adjust its
stage to stage 13—16. In other words, relevant anatomical terms could
help us to predict the stage label since they provide the spatial and
temporal information of local structure corresponding to a speciﬁc
embryo development stage. Nevertheless, not all anatomical terms
will deﬁnitely beneﬁt stage classiﬁcation, which is consistent with
our stage classiﬁcation result. From Figure 5, we can see that our
method may have competitive result compared with SVM with
respect to some certain stage. However, given more anatomical
term information, the performance of our method will gradually
outperform the other methods, especially for the prediction result of
stage 13—16.

 

i22

112 /3.Io's[Bumo[pJOJXO'sorwuiJOJurorqp:duq 11101} papeo1umoq

9103 ‘0g isnﬁnv uo ::

Drosophila gene expression patterns

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

atrium

 

 

a nIerlor endoderrn ..
dorsal epidermis..
dorsal prothoracicu
embryonic Malpighiam

anterior midgut primordium
embryonic brain
embryonic central nervous ..

embryonic dorsal epidermis
em bryonic midgut

embryonic foregut
em bryanic gastric caecum
em bryonic proventriculus

brain ‘
cellularblasmderm

clypeo—Iabml primordium
embryonic hindgut
embryonic hypopharynx

embryonic esophagus
embryonic large intestine

embryonic anal pad

   

Malplghlantubule
an e in stat" nascendi
embryonic epipharynx
embryonic salivary gland
embryonic sallvarygland..
embryonic ventral epidermis
embryonic/larval mus

em bryonicllarval garla nd .
em hryonic/la Nal poster

dorsal ectoderm anlage ln..
embryonic head epidermis
embryonic/larval fat body

dorsal ectoderm primardium

on.
‘e‘E
nun

 

3': IWI I I I I our

,6 1 .1 1 .

0.5 1. I I I I 1. I

M . 1 .1 .1 .
M | .I

0.2

0.1

    

 

 

 

 

     

 

—' =1: ‘ I. .5 o: =u===-.=>‘. a : e‘ nu:‘
E    '; HE;
R EEaE-g eggggeg =ggi—uﬂ 2:!” :9 wiring-E
1; a,” 1:3 nozoegg "56:3¥=“°3 e z"zz°
E .E“ E; SEWEEE Eoufu£§ 5; N NEHOE
a a antes-asag c.2332"; EA” 53555
2 g Enn.E.3EE_ 7.333231: ﬁcﬂ‘i 211222
\ .uuzwu. .=.= 11": :: “ZEEH
.e g as: 3.5.1.3; ..nn age Eaag 5..an
5 o 8 5 Ear- _._.33 a" E ., >E>>E
r - .. g g —22 E a E -
a a a 14:“ z“ 2 E a 2
a _ ..
5 r. E E: a T: t 2 ,g
g .= a ’ >

 

Fig. 6. The Avg. Micro F1 score of ﬁve methods on each term in 79-term dataset. (It is better to be Viewed in colorful and zoomed in mode.)

5.5 The more meaningful asymmetric correlation
matrix

When we build the TG, at ﬁrst, we assume the terrn—terrn correlation
and stage—term correlation are both symmetric, since we used
cosine similarity to represent their correlations. However, the above
assumption does not always hold in the real data. In Drosophila
embryo gene expression images, we found that the conditional
probability of the occurrence of term ‘ventral nerve cord’ given term
‘embryonic brain’ is higher than that of the ‘embryonic brain’ given
‘ventral nerve cord’, which satisﬁes the biology meaning that ventral
nerve cord occurs earlier than embryonic brain. After learning, our
method can automatically discover the above hidden asymmetric
correlation information, that is,

P*(n+KC+1,KC+1)  P*(n+KC+1,K)
13;}: g  g (23)
P*(n+K,KC+1) P*(n+K,K)

In order to see the learned asymmetric terrn—term correlation
more clearly, in Figure 7, we show the difference matrix got by
PZH—PZ‘HT. Taking those more accurate asymmetric correlation
into consideration, our method can potentially improve both stage
classiﬁcation and anatomical annotation results even more.

6 CONCLUSION

In this article, we proposed a novel TG model to learn the
task interrelations between stage recognition and anatomical terms
annotation of Drosophila gene expression patterns. The stande
bag-of—word features and three major views (lateral, dorsal and
ventral) were used to describe the 3D Drosophila images. A new
PRW method was introduced to simultaneously propagate the
stage labels and anatomical controlled terms via TG model. Both
stage classiﬁcation and anatomical controlled term annotation tasks
are jointly completed. We evaluated the proposed method using one
reﬁned BDGP dataset. The experimental results demonstrated in
the real application, when the number of training data is scarce,
our joint learning method can achieve superior prediction results on
both tasks than the state-of—the-art methods. What is more, we can
discovery more accurate asymmetric terrn—term correlation, which
can potentially improve the results of both tasks even more.

 

Fig. 7. The learned difference matrix. (It is better to be Viewed in colorful and
zoomed in mode.) In order to see the asymmetric entries more clearly. we plot
P3” —P;‘;aT. After PRW, the entries marked as brighter square have higher
conditional probability (positive correlation) than its counterpart which is
marked as darker color. This asymmetric reﬂects more accurate termiterm
correlation than the original symmetric assumption

ACKNOWLEDGEMENT

The author would like to thank Dr Sudhir Kumar for his help in data
collection.

Funding: [This research was supported by National Science
Foundation Grants CCF-0830780, CCF-09l7274, DMS-0915228
and IIS-1117965].

REFERENCES

Brin,S. and Page,L. (1998) The anatomy of a large-scale hypertextual web search
engine. In International Conference on World Wide Web (WWW), Elsevier Science
Publishers, pp. 1077117.

Chang,C. and Lin,C. (2011) LIBSVM : a library for support vector machines. ACM
Transactions on Intelligent Systems and Technology, 2, 1727.

Fowlkes,C. et al. (2008) A quantitative spatiotemporal atlas of gene expression in the
Drosophila blastoderrn. Cell, 133, 3644374.

Grumbling,G et al. (2006) FlyBase: anatomical data, images and queries. NucleicAcids
Res, 34, D48LD488.

Hendriks,C. L. et al. (2006) Three dimensional morphology and gene expression in the
Drosophila blastoderrn at cellular resolution I: data acquisition pipeline. Genome
Biol., 7, R123.

 

i23

112 /8.IO'S[BHmOprOJXO'SOIJBLUJOJIIIOIq”Idllq 111011 papeo1umoq

9103 ‘0g isnﬁnv uo ::

X.Cai et al.

 

Ji,S. et al. (2008) Extracting shared subspace for multi-label classiﬁcation. In ACM
SIGKDD International Conference on Knowledge Discovery and Data Mining
2009, pp. 381389.

Ji,S. et al. (2009) Drosophila gene expression pattern annotation using sparse
features and term-term interactions. In ACM SIGKDD International Conference
on Knowledge Discovery and Data Mining, pp. 407416.

Ji,S. et al. (2010) A shared-subspace learning framework for multi-label classiﬁcation.
ACM Transactions on Knowledge Discovery from Data (TKDD), 4, 1729.

Kang,F. et al. (2006) Correlated label propagation with application to multi-label
learning. In IEEE International Conference on Computer Vision and Pattern
Recognition (CVPR), pp. 171971726.

Kumar,S. et al. (2002) BEST: A novel computational approach for comparing gene
expression patterns from early stages of Drosophila melanogaster development.
Genetics, 162, 203772047.

L’ecuyer,E. et al. (2007) Global analysis of mRNA localization reveals a prominent
role in organizing cellular architecture and function. Cell, 131, 1744187.

Li,Y. et al. (2009) Drosophila gene expression pattern annotation through multi-instance
multi-label learning. In Proceedings of the 21 st International Joint Conference on
Artiﬁcial Intelligence, AAAI press, pp. 144571450.

Lowe,D. (2004) Distinctive image features from scale-invariant keypoints. Int.
J. Comput. Vis., 60, 917110.

Lyne,R. et al. (2007) FlyMine: an integrated database for Drosophila and anopheles
genomics. Genome Biol., 8, R129.

Megason,S. and Fraser,S. (2007) Imaging in systems biology. Cell, 130, 7847795.

Peng,H. and Myers,E.W. (2004) Comparing in situ mRNA expression patterns of
drosophila embryos. In International Conference on Research in Computational
Molecular Biology (RECOMB), ACM, pp. 1577166.

Peng,H. et al. (2007) Automatic image analysis for gene expression patterns of ﬂy
embryos. BMC Cell Biol., 8(Suppl. 1), S7.

Puniyani,K. et al. (2010) SPEXz: Automated Concise Extraction of Spatial Gene
Expression Patterns from Fly Embryo ISH Images. Intell. Sys. Mol. Biol., 26,
i477i56.

Shuiwang,J. et al. (2009) A bag-of—words approach for Drosophila gene expression
pattern annotation. BM C Bioinformatics, 10, 119.

Tomancak,P. et al. (2002) Systematic determination of patterns of gene expression
during Drosophila embryogenesis. Genome Biol., 3, 88.

Tomancak,P. et al. (2007) Global analysis of patterns of gene expression during
Drosophila embryogenesis. Genome Biol., 8, R145.

Tong,H. et al. (2006) Fast random walk with restart and its applications. In IEEE
International Conference on Data Mining (ICDM), pp. 6137622.

Tsoumakas,G. and Vlahavas,I.P. (2007) Random k-labelsets: An ensemble method for
multilabel classiﬁcation. In European conference on Machine Learning, Springer-
Verlag, pp. 406417.

Wang,H. et al. (2009) Image annotation using multi-label correlated Green’s function.
In IEEE International Conference on Computer Vision, pp. 202972034.

Weigmann,K. et al. (2003) FlyMove e a new way to look at development of Drosophila.
Trends Genet. 19, 3107311.

Zelnik-Manor,L. and Perona,P. (2004) Self-tuning spectral clustering. Advances in
neural information processing systems, 17, 16.

Zha,Z. et al. (2008) Graph-based semi-supervised learning with multi-label.
In IEEE International Conference on Multimedia and Expo (ICME),
pp. 132171324.

Zhou,D. and Scholkopf,B. (2004) Learning from labeled and unlabeled data using
random walks. In Annual Symposium of the German Association for Pattern
Recognition (DAGM), Springer, pp. 2377244.

Zhu,X. et al. (2003) Semi-supervised learning using gaussian ﬁelds and harmonic
functions. In International Conference on Machine Learning (ICML), ACM press,
pp. 912919.

 

i24

112 /3.Io's[BumoprOJXO'sorwuiJOJurorq”:duq 111011 papeo1umoq

9103 ‘0g isnﬁnv uo ::

