Motivation: Comparative analyses of gene expression data from different species have become an important component of the study of molecular evolution. Thus methods are needed to estimate evolutionary distances between expression profiles, as well as a neutral reference to estimate selective pressure. Divergence between expression profiles of homologous genes is often calculated with Pearson's or Euclidean distance. Neutral divergence is usually inferred from randomized data. Despite being widely used, neither of these two steps has been well studied. Here, we analyze these methods formally and on real data, highlight their limitations and propose improvements. Results: It has been demonstrated that Pearson's distance, in contrast to Euclidean distance, leads to underestimation of the expression similarity between homologous genes with a conserved uniform pattern of expression. Here, we first extend this study to genes with conserved, but specific pattern of expression. Surprisingly, we find that both Pearson's and Euclidean distances used as a measure of expression similarity between genes depend on the expression specificity of those genes. We also show that the Euclidean distance depends strongly on data normalization. Next, we show that the randomization procedure that is widely used to estimate the rate of neutral evolution is biased when broadly expressed genes are abundant in the data. To overcome this problem, we propose a novel randomization procedure that is unbiased with respect to expression profiles present in the datasets. Applying our method to the mouse and human gene expression data suggests significant gene expression conservation between these species.
INTRODUCTIONChanges in gene expression have been suggested to underlie many differences in gene function or in phenotype. More generally, expression is an important component of gene function, and studying the evolution of gene expression is a key step in evolutionary genomics. While there has been a great deal of research concerning the primary treatment of expression data in general (see, andfor reviews), there has been little investigation into the methods used more specifically to quantify expression evolution (). This can make it difficult to critically assess contradictory results, such as the reports that broadly expressed genes are more conserved () or less conserved () than specifically expressed genes. To assess whether and how much expression has been conserved between two orthologous genes by selection, we need an expectation for expression similarity under neutral evolution. Thus, the estimation of gene expression conservation requires two components: (i) a measure of gene expression similarity; and (ii) the expected value of the divergence level under neutrality. The two most common measures of similarity between expression profiles of orthologous genes are Pearson's correlation coefficient () and Euclidean distance (). The results obtained with Pearson's and Euclidean distances have been reported to be poorly correlated (). This poses the question which of these measures provides a better description of expression similarity. It has been demonstrated that Pearson's correlation coefficient, in contrast to Euclidean distance, underestimates the expression similarity between orthologous genes with a conserved uniform pattern of expression. In consequence, use of the Euclidean distance has been encouraged (). For neutral evolution, one expects that similarity between expression profiles of orthologous genes gradually decreases with time. For species that have diverged for sufficiently long time no detectable similarity in expression is expected to remain; this has been postulated to be the case between mouse and human (100 million years;). It has been suggested that such large neutral divergence could be approximated by calculating the distance between expression profiles of randomly chosen pairs of genes from the species compared. The standard approach used to generate random pairs of genes is to permute the orthology relationship between them (). Here, we show formally and empirically that, in contrast to previous reports (), there exists a relationship between the Pearson's correlation coefficient and the Euclidean distance, which depends on the data normalization. We also extend the previous study ofby considering more than just the uniform pattern of expression. We demonstrate that in fact both distance measures depend on the expression specificity of analyzed genes. Next, we discuss these observations in the context of the assessment of gene expression conservation. We show that the comparison of expression profiles for randomly permuted gene pairs is biased when broadly expressed genes are abundant in the data, a distribution characteristic of many datasets. To overcome this problem, we propose a novel procedure to generate random gene pairs. This procedure is not biased by the over-or underrepresentation of any expression profile in the datasets. Finally, we use our approach to provide clear evidence for constrained evolution of gene expression between mouse and human.
METHODS
Gene expression dataWe used the human and mouse gene expression data from the GNF Gene Expression Atlas ofas a case study. This study was performed on the Affymetrix HG-U133A array as well as on the custom array GNF1H for human, and on the custom array GNF1M for mouse. In total, expression profiles for 79 human and 61 mouse organs were measured, with 44 928 probe sets for human and 36 182 probe sets for mouse. We only took into account organs belonging to the homologous organ groups (HOGs) defined in the Bgee database (). Using the mapping available in the Bgee database we could connect 36 human organs and 30 mouse organs to 27 HOGs. See Supplementaryfor the list of HOGs and their corresponding organs. Microarray data were normalized with the gcrma R package (). To assign the probe sets to their corresponding human or mouse genes we used the mapping available in Bgee. We kept only probe sets which matched to a unique Ensembl gene. A total of 15 121 probe sets corresponding to 13 853 mouse genes, and 23 920 probe sets corresponding to 15 338 human genes were found. To estimate the expected values of distances for gene pairs with conserved expression patterns, we used data from replicated experiments, performed in each species. Thus, for each probe set we had two vectors of values representing its expression over the organs. The datasets contained 36 organs and 23 920 probe set pairs for human, and 30 organs and 15 121 probe set pairs for mouse. The results of the study on mouse gene expression data are presented in the Supplementary Materials. To study gene expression evolution between mouse and human we merged human and mouse organs into 27 HOGs. For every probe set in each HOG the arithmetic mean of the gcRMA normalized expression values was calculated (each HOG was represented by at least two microarrays). We used a subset of 8942 one-to-one orthologous gene pairs (see HumanMouse Orthologous Genes). If the gene was matched by more than one probe set on the microarray, we randomly picked one probe set to represent that gene.
Humanmouse orthologous genesHomology information of human and mouse genes was retrieved from Ensembl release 55 (), using BioMart (). A total of 8942 pairs of humanmouse one-to-one orthologous genes had expression information in the datasets we used.
Normalization proceduresFor a given gene we consider a vector x of expression intensities x i across n different organs indexed by i = 1,...n. The Manhattan normalization of x is calculated by dividing it by its L 1 norm:In some studies () this normalization is called relative abundance. The Euclidean normalization of vector x is calculated by dividing the vector by its L 2 norm:Finally, we introduce a so-called z-like normalization of x which corresponds to the Euclidean normalization of x minus its mean value:
Pearson's and Euclidean distancesThe Pearson's distance (d P ) between two expression profiles is defined as 1r, wherewith notations as for Equation (1).
Organ specificity of gene expressionTo measure the expression specificity of human genes we used the organ specificity index  (). The  of a given gene with an expression vector x is defined as follows:The value of  varies between 0 and 1, with higher values indicating higher organ specificity.
-group compositionTo study the relation between d E and  we used replicated expression data for human genes (36 organs, 23 920 probe sets). We sorted the probe set pairs according to the organ specificity index  [] of the first replicate, and we divided the probe set pairs into three -groups of equal size (e.g. the first group contained 1/3 of the probe set pairs with the first replicate having lowest  ). For each group we recorded the minimum and maximum  value of the first replicate, and used these values to filter out probe sets with the two replicates having  values from different groups. The resulting -groups were of similar, but not equal, size (). An alternative -group composition, with a more balanced distributions of  values (first group containing genes with  [0,0.2); second group with  [0.2,0.6); and third group with  ) leads to unbalanced sizes of three groups. Nevertheless, for both approaches the results are qualitatively the same (Supplementary Figs. S6 and S7).
Correcting for the bias in evolutionary study of expression
Randomization proceduresChanges in gene expression patterns between randomly chosen genes from two species have been suggested as an approximation for the result of neutral expression evolution (). We used two different randomization procedures to create such sets of random gene pairs. First, we permuted the gene order within replicates (or within species). We refer to these as randomly permuted pairs. Second, we performed what we refer to as '-uniform sampling'. We first randomly chose an organ specificity index ( ), uniformly from the interval of ( min ,  max ), where  min and  max are the lowest and the highest values of the observed  , respectively. Next, we picked the gene with the value of  closest to the randomly chosen  within one dataset (i.e. within one replicate, or one species). Then, independently, we repeated the procedure for the second dataset. Thus, we obtained two randomly chosen genes which form a new random pair. Repeating the procedure provides the '-uniform' random gene pairs.
RESULTS AND DISCUSSION
Correlation between Pearson's and Euclidean distances depends on data normalizationTo compare gene expression between species, over many different conditions, it is important to normalize the expression levels between the conditions to obtain a common scale between species. This is distinct from the preprocessing normalization (within condition), which is typically done using methods such as LOESS () or gcRMA (), and is not specific to interspecies evolutionary studies. In the following, we only consider the impact of the between conditions normalization on the evolutionary comparisons. We discuss three normalization procedures commonly used for evolutionary studies: Manhattan normalization [also referred to as 'relative abundance' ()], Euclidean normalization and z-like normalization (see Section 2.3 for mathematical definition of all three normalizations). One can use any of these normalizations before calculating the Pearson's or Euclidean distance between two gene expression profiles. However, the choice of normalization can affect the results. Pearson's distance (d P ) between two expression profiles remains the same, regardless of whether and how the data are normalized, and it ranges between 0 and 2. The reason is that r is defined on the z-scores [see Equation (1) in Section 2.4], which are invariant with respect to linear transformation. In contrast, the Euclidean distance between two expression profiles (d E ) changes its value depending on the normalization used, even though the interval of possible d E values is always between 0 and 2. The correlation between d P and d E is poor for Manhattan (Supplementary; see also) and Euclidean normalizations (Supplementary). In contrast, z-like normalization leads to an interdependent relationship between d P and d E , defined by(see Theoretical Analysis in Supplementary Material, and Supplementary). As d P gives the same results for all three normalizations, and for z-like normalization it is equal to, we focused on the Euclidean distance. If not stated otherwise, the Euclidean distance was calculated for all three normalizations: Manhattan, Euclidean and z-like, referred to as
Commonly used measures of gene expression similarity depend on the organ specificity of the genesIntuitively, one might assume that the distance between two orthologous genes which have conserved the expression profile of their last common ancestor should be close to zero, and that this should hold regardless of the gene expression pattern. To assess if this is indeed the case, we performed an empirical study. We used human microarray data with the expression information from 36 different organs in two replicates (). The replicates were used to 'simulate' pairs of genes with conserved expression profiles. We calculated the organ specificity index  [for each pair of replicates, and then divided them into three groups of similar size (see Section 2.6 for details). The first two groups contained broadly expressed genes (  0.295), and only the third group consisted of genes with more specific expression patterns ( >0.295;were significantly lower for broadly expressed genes than for organ-specific genes (p < 10 16 , MannWhitney U test,and B; Supplementaryand B). In contrast, values of d Z E were significantly higher for broadly expressed genes than for organ-specific genes (p < 10 16 , MannWhitney U test;; Supplementary). See Supplementaryfor the correlation analysis between the Euclidean distances and organ specificity index.The rate of neutral expression evolution is typically approximated by calculating the distance between expression profiles of randomly paired genes. The random choice of the genes is assumed to remove any similarity between them (). The standard approach to generate random gene pairs is to permute the ortholog relationship between the genes in the datasets. We created random probe set pairs by permuting the probe set order within each of the three -groups separately, and we then calculated the Euclidean distances
Thebetween their expression profiles. We found that d M E and d E E were significantly lower for random pairs from the first -group, than for random pairs from the third -group (p < 10 16 , Mann-Whitney U test;and B; Supplementary). This is because the first -group consisted of broadly expressed genes. Consequently, even the randomly matched probe set pairs tended to have similar expression patterns and thus low distances. In contrast, the third -group consisted of genes with
B.Piasecka et al.A B C(B) d E E are significantly lower for broadly expressed genes (group 1) than for organ-specific genes (group 3). For randomly permuted gene pairs d M E and d E E also differ between the three -groups. They are significantly lower for random pairs in group 1 than in group 3. (C) d Z E is significantly higher for broadly expressed genes (group 1) than for organ-specific genes (group 3). d Z E for randomly permuted pairs is high in all three groups, even in the first -group, where random pairs consist of two broadly expressed genes (this is a consequence of low r for uniformly expressed genes). Note that the scale of the x-axis differs strongly between graphs.
1868
Correcting for the bias in evolutionary study of expressionmore specific expression patterns, and so the random pairs were truly different. d Z E between random pairs was not affected by organ specificity, in the sense that in all three -groups the median d Z E was around 1.4 (; Supplementary). Values of d Z E were high even in the first -group, although it consisted of random pairs with similar, broad patterns of expression. The reason is that d Z E = 2(1r) is a decreasing function of r, which for broadly expressed gene pairs reflects mainly the noise of the measurement and is close to 0 (for details seeand Supplementary). Thus, random gene pairs from the first -group tend to have high d Z E values (around  2).
A large fraction of broadly expressed genes leads to an underestimation of expression conservationOur analysis shows that if the fraction of broadly expressed genes is large, the level of gene expression conservation is likely to be underestimated. This is especially important if we consider the fact that housekeeping genes (broadly expressed) are more frequent than organ-specific genes (). We found such skewed distributions not only in the human data considered here (), but also in several other datasets, e.g. most mouse genes are broadly expressed over different organs, most Arabidopsis genes are broadly expressed over different light conditions, and most zebrafish genes are broadly expressed over different developmental stages (Supplementary). To illustrate the extent to which the abundance of broadly expressed genes affects measures of gene expression conservation, we re-analyzed all the human probe set pairs, without dividing them into -groups. We created random probe set pairs by permuting the probe set order within both replicates, and we calculated theboth for the pairs of replicates and for the random pairs. Ideally, one would expect to detect very high similarity between replicates, and very low similarity between random pairs. For Manhattan and Euclidean normalizations, distances for most human random pairs were very small, indistinguishable from the distances between replicates (and B; Supplementary). This contradicts the assumption that differences between randomly paired genes are to approximate well the rate of neutral divergence, with very low similarity (i.e. high distance) expected (). For the z-like normalization, distances between random pairs were high, which is consistent with the assumption of pseudo-neutrality (). However the d Z E values for the replicates were similarly high (; Supplementary), whereas they are expected to be low. Thus, the presence of numerous broadly expressed genes causes systematically low values of d M E and d E E between randomly paired genes, and systematically high values of d Z E between conserved gene pairs. The first is a consequence of the fact that it is easier to randomly choose two broadly expressed genes, and thus to get a low value ofThe second is a consequence of low values of r for uniformly expressed genes, leading to the high values of d Z E (as discussed in the Section 3.3). In all cases, the level of gene expression conservation is underestimated. Although we show this effect using a specific set of human microarray data, our conclusions are very general and hold for any study in which a significant fraction of the genes is uniformly expressed over conditions (seeand its caption for a mathematical explanation).
An alternative construction of random gene pairs improves the estimation of expression conservationTo overcome the limitation of using randomly permuted gene pairs to estimate the expression divergence under neutrality, we propose a new procedure to create random gene pairs. This procedure is unbiased regardless of over-or underrepresentation of any expression profiles in the datasets. Consequently, it provides a better approximation of the expression divergence under neutral evolution between distant species. To generate a single random pair of genes, one randomly chooses two expression specificity values,  1 and  2 , uniformly from the interval of ( min ,  max ), where  min and  max are the lowest and the highest values of the observed  , respectively. Next, one picks the two genes from the two datasets that have the closest  values to  1 and  2 , respectively. The resulting pairs of genes have the two  values uniformly distributed, and not biased as for randomly permuted gene pairs (and C). We applied our new procedure 23 920 times to create as many random probe set pairs for human datasets. Then, we calculated the Euclidean distances (both for replicates and random probe set pairs. We found that, relative to classical randomly permuted pairs, the distribution of d E E and d M E for -uniform random pairs differs strongly from that for replicates (and B), with a high frequency of large distance values, as expected for very divergent pairs. Of note, d M E and d E E give the same shape of distribution (Figs. 1A and B, and 2A and B). While both of these measures could be combined with -uniform sampling to estimate gene expression conservation, for mathematical consistency we prefer the use ofThe estimation of gene expression conservation with d Z E cannot be corrected by creating the set of random gene pairs differently, because d Z E varies significantly with organ specificity for replicates, i.e. for conserved genes, and not for random gene pairs. Thus, we do not recommend using d Z E , and consequently the Pearson's correlation coefficient, in any study which aims to detect similarity between genes expressed uniformly over all conditions. Of note, neither the standard procedure used to generate random pairs, nor our new proposed approach takes into consideration the time passed since the divergence of two organisms. Therefore, the estimated 'neutral' divergence will be the same for closely related species (e.g. human and chimp) and more distant species (e.g. human and mouse).To demonstrate the importance of our novel approach, we investigated how much evidence of selectively constrained gene expression evolution we can detect between human and mouse. We selected 8942 one-to-one orthologous gene pairs from the human and mouse datasets (). We created two sets of random gene pairs, using both random permutation and the procedure of -uniform sampling, and we calculated the Euclidean distance (d E E ) for orthologous gene pairs and for both sets of random pairs (see
Results
B.Piasecka et al.A B Cis small, indistinguishable from the distances between replicates (green). For -uniform random pairs (blue) d E E and d M E are higher, which is more consistent with the assumption about neutral evolution (). (C) d Z E is high both for randomly permuted gene pairs and for the group of replicates. The distribution of d Z E does not change with the new random pairs set.a humanmouse orthologous gene pair is smaller than the fifth percentile of d E E for randomly paired genes, there is some evidence that the expression evolution of this pair has been constrained (). Using randomly permuted gene pairs did not provide clear evidence for constrained evolution (). Only 8% of orthologous pairs were identified to have a conserved expression pattern, which was close to the random expectation of 5%. In contrast,with -uniform random pairs, 29% of orthologous genes were identified to have conserved expression (). The number of detected genes with conserved expression pattern may seem surprisingly low in comparison to, who reported that as much as 84% of genes showed conserved expression between human and mouse. However, we note that Liao and Zhang (2006a) used two different metrics to calculate the distance between orthologous genes and between randomly paired genes  the so called net distance and the Euclidean distance, respectively. We show that this inconsistency caused an overestimation of the expression conservation between human and mouse (see Supplementary Materials and Supplementary). Consequently, we believe that correcting for the randomization process yields more accurate results than a one-sided correction of the distance. We are aware that the alternative way of creating random gene pairs proposed in this article has some weaknesses, such as visible artificial peaks in the d E E distribution (), which are the consequence of the non-uniform distribution of  between 0 and 1. This is because with the -uniform sampling one chooses the genes with less frequent  values more often than genes with more frequent values. For example here, the number of narrowly expressed genes was increased at the expense of decreasing the number of broadly expressed genes. Consequently, when only a few genes have a  value in some non-negligible range, these few genes might repeat many times in the randomized set, and discrete effects may manifest themselves causing artificial peaks. Note that the peaks would disappear if  values were uniformly distributed between 0 and 1, but then there would be no need for -uniform sampling of gene pairs at all. Note also that the peaks do not affect the analysis, as they do not change the overall shape of the distribution of distance values between the randomized gene pairs (). Finally, one may argue that the -uniform sampling contradicts the very purpose of randomization because it makes a probability of choosing a gene higher, if its  value is underrepresented in the dataset. But the aim of the set of randomized gene pairs is not to be 'just random', but to display maximal divergence between gene pairs, i.e. to simulate the neutral evolution defined in. In contrast to the standard approach, the -uniform sampling makes the distribution of distance values between gene pairs actually independent of the  distribution observed in the analyzed dataset. Thus, we believe that the distance between -uniform random gene pairs approximates better a large neutral divergence.
Correcting for the bias in evolutionary study of expression
at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
CONCLUSIONS The Euclidean distance should be used with caution as an estimator of gene expression conservation because it varies as a function of expression specificity. Our results strongly suggest that to assess whether gene expression evolves neutrally, one should use d E E (Euclidean distance preceded by Euclidean normalization) and compare its distribution for orthologous and -uniform random pairs. Importantly, we validated this approach on real data, and recovered clear evidence for gene expression conservation between mouse and human. Previous small differences reported between real and random gene pairs were likely caused by the way the random pairs were constructed (Liao and Zhang, 2006a, b). Although in this study we applied our approach to microarray data analysis, the issues highlighted here are also relevant to data acquired with RNA-seq technology (Mortazavi et al., 2008). We would like to emphasize that while it is possible to verify whether the expression of a given set of genes was under selective pressure, there is no straightforward way to compare the strength of selection acting on two groups of genes with different expression patterns. Indeed, if we compare a group of broadly expressed genes with a group of narrowly expressed genes, with similar high conservation of expression, the latter will always have higher d E E values (and lower d Z E values). This methodological problem suggests a need to re-interpret results from previous evolutionary studies comparing the evolution of broadly and narrowly expressed genes. In particular, studies which have reported higher conservation of organ-specific genes (Liao et al., 2010; Liao and Zhang, 2006b; Movahedi et al., 2011) could have been biased by the fact of using the Pearson's correlation coefficient (equivalent to d Z E ) as a measure of conservation. In this article, we thoroughly analyzed, formally and experimentally, the common measures of expression conservation, and we showed the superiority of the Euclidean distance paired with the Euclidean normalization. We also highlighted the limitation of using randomly permuted pairs to approximate neutrally evolving genes, and proposed a new methodology to better estimate the rate of neutral evolution. With the increase of expression data for many species, our work is likely to become very useful for evolutionary studies of gene expression.
at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
