Motivation: In molecular biology, as in many other scientific fields, the scale of analyses is ever increasing. Often, complex Monte Carlo simulation is required, sometimes within a large-scale multiple testing setting. The resulting computational costs may be prohibitively high. Results: We here present MCFDR, a simple, novel algorithm for false discovery rate (FDR) modulated sequential Monte Carlo (MC) multiple hypothesis testing. The algorithm iterates between adding MC samples across tests and calculating intermediate FDR values for the collection of tests. MC sampling is stopped either by sequential MC or based on a threshold on FDR. An essential property of the algorithm is that it limits the total number of MC samples whatever the number of true null hypotheses. We show on both real and simulated data that the proposed algorithm provides large gains in computational efficiency. Availability: MCFDR is implemented in the Genomic HyperBrowser (http://hyperbrowser.uio.no/mcfdr), a web-based system for genome analysis. All input data and results are available and can be reproduced through a Galaxy Pages document at:
INTRODUCTIONThe development of novel experimental techniques is rapidly increasing the generation of data in many fields in biology, in particular in genomics with the advent of high-throughput sequencing (). Chromatin immunoprecipitation (ChIP) technology combined with nextgeneration sequencing generates high-resolution data along the genome on DNA methylation, histone modifications, transcription factor binding and more (). The large amount of data generated by these techniques opens up for statistical studies of relations between genomic properties, both globally and locally along the genome. An example of such a local analysis is the study of how the relation between histone modifications and repeating elements varies across chromosomes (). A natural approach to such an investigation is to split the genome into bins along the genome, e.g. one bin per chromosome, cytoband or gene, and then perform a statistical test of a null hypothesis H0 versus an alternative hypothesis H1 for each bin. At the same time, due to the complex structural properties of the genome, it is often inappropriate to make simplified assumptions that would enable analytic evaluation of significance (). Instead, Monte Carlo (MC) sampling is often needed, resorting to computationally expensive reshuffling of genomic elements for each MC sample. As a consequence, Monte Carlo in multiple testing settings is rapidly becoming important (). With tests being performed for a large number of bins locally along the genome, the computational requirements may become extremely high, as the effort needed is basically the multiple of a very large number of test by a (possibly also very large) number of MC samples. Several papers have considered ways to reduce the number of samples during MC-based P-value computation for individual tests.propose a sequential MC algorithm for P-value computation, reducing the needed number of MC samples for tests that are anyway insignificant. Other papers consider alternative ideas for P-value estimation, such as controlling resampling risk (), and prediction of P-values using Random Forest models (). Also, there has been some work on Monte Carlo approaches for multiple testing in cases where P-values can be calculated analytically (). In this article, we propose an algorithm that limits the total number of needed MC samples, regardless of how many tests are truly H0. In Section 2, we describe our algorithm, in which MC sampling is stopped either according to the sequential MC stopping rule or when we reach a given multiple testing significance threshold. Then, in Section 3, we show on both simulated and real data that this method can lead to a drastically reduced total number of MC samples. Finally, Section 4 presents a discussion and some conclusions. Further details are provided in the accompanying Galaxy Pages () document.
METHODSA commonly used multiple testing analogue to the classical P-value is the so-called q-value (). The q-value of an individual test is defined as the minimal false discovery rate (FDR) () at which the test is called significant. P-values relate to q-values by a factor which is proportional to the number of tests for which H0 is true. Denote an MC sample of the test statistic as 'extreme' if it is further to the H1-tail of the null distribution than the observed test statistic. When most tests are from H0, the correction factor is large. Then, for an individual test to become significant, many MC samples are needed. Note, however, that in such a situation most tests would have many extreme samples (as they come from H0), implying that for these tests the MC
G.K.Sandve et al.sampling would have been stopped early if a sequential MC stopping criterion were adopted. In the opposite scenario, when most tests are from H1, the multiple testing correction factor is small, and fewer MC samples are needed in order to obtain a significant q-value for each individual test. But then few tests have many extreme samples, and few tests would have been stopped early by sequential MC. Consider testing m null hypotheses H 01 ,...,H 0m with corresponding test statistics T i = t i , i = 1,...,m, where large values of t i constitutes evidence against H 0i. Each test is performed by MC simulation: for test i = 1,...,m, we simulate n i independent datasets under the null hypothesis, yielding simulated test statistics t * ij for j = 1,...,n i. Let k i be the number of simulated test statistics that are greater than or equal to t i. The Monte Carlo P-value p mc () is then given byare equally likely values of T i , and k i +1 of these are greater than or equal to the observed t i. Our concern is with choosing the number of needed MC samples, n i , for each test i [cf. the discussion in. To begin, consider the case of a single test, m = 1, and assume that we observe k 1 = 0. Then P mc = (n i +1) 1 , and for a given significance threshold , we need n i  1  1 to have a possibility of rejecting H 0. Thus, the stricter we make the significant threshold, the more MC samples are needed. For example, for  = 0.05, we only need n i  19, but for  = 0.001 we need n i  999. For a moderate to large number m of tests, computational problems arise for two reasons: first, simply because m itself is large; second, because of the need to correct for multiple testing. As an example, assume that n i = n for each i, and that we use Bonferroni corrected P-values to account for multiple testing, with an overall family-wise error rate of . Then, each test has significance threshold /m, and m m  1 samples are needed in total. For m = 1000 and  = 0.05, this means that nearly 20 million MC samples are needed. Since each MC sample typically involves a complex reshuffling of genomic elements, the computational cost is extremely high.propose a sequential MC method for hypothesis testing. Their basic idea is to stop MC sampling at the point that it becomes clear that the null hypothesis will never be rejected. Assume that large values of the test statistic constitute evidence against H0. Instead of using a fixed MC sample size, sampling is continued until either a pre-determined number h of values larger than the observed test statistic t i (i.e. extreme MC samples according to our definition) has been obtained (at MC sample size l, say), or until some maximum number n of MC samples have been calculated. Let g be number of values exceeding t i when this algorithm terminates. Then, the sequential P-value P smc is given byBesag and Clifford (1991) suggest setting h = 10 or 20. For the multiple testing setting, we propose to augment this procedure by adding a third stopping criterion, namely a q-value threshold , aiming to run just as many samples as are needed to obtain an accept/reject decision for each test. For m tests with observed test statistics t 1 ,t 2 ,...,t m , our proposed Monte Carlo False Discovery Rate (MCFDR) algorithm is as follows:(1) Let A ={1,2,.
..,m} and B =(2) Until A =:(a) For each i  A, calculate/update p i by sequential MC, using an additional MC sample. If a total of h samples exceeding t i are then obtained, move i from A to B.(b) Calculate q-values (see below) q 1 ,q 2 ,...,q m based on the current P-values P 1 ,P 2 ,...,P m. If q i < for all i  A, then move all i  A to B.Instead of adding only a single MC sample in Step 2a, a batch of N > 1 additional MC samples may be added.In Step 2b above, we calculate q-values based on the current P-values. The q-values mainly depend on the proportion  0 of true null hypotheses among the m tests. Let P (1)  P (2)    P (m) be the ordered, observed P-values. For a given estimat  0 of  0 , q (i) = q-value(P (i) ) can be easily estimated asqThus, the main issue is estimating  0. Many methods for estimating  0 have been proposed in the literature (;). Most methods assume that P-values are continuous and uniformly distributed on (0,1) under H 0. However, in the sequential MC case, P-values are discrete and uniformly distributed on the set H ={1,h/(h+1),...,h/(n1),h/n,(h1)/n,...,1/n}.have proposed a very simple estimator of  0 :). This estimator can be shown to give conservative estimates for both discrete and continuous P-values, and we have therefore chosen to use this estimator in our algorithm.
RESULTS
SimulationsIn order to investigate the correctness and efficiency of the proposed scheme, we perform a simulation study. The uniform (0,1) distribution is used to generate P-values from tests for which H0 is true, and a Beta distribution with more mass on lower values is used to generate P-values under H1, giving a Uniform-Beta mixture distribution of underlying P-values for tests (). By definition, the probability that a test statistic randomly sampled under H 0 is more extreme than the observed test statistic is given by the P-value. Let P i be the P-value corresponding to test i. Then, instead of drawing test statistics directly, we may draw Bernoulli variables with parameter P i as indicators of whether a randomly drawn test statistic would be more extreme than the observed test statistic. Accordingly, simulation for a single test i may be performed by drawing n sim MC samples Y ij , j = 1,...,n sim of a Bernoulli variable with parameter P i , with Y ij = 1 corresponding to an extreme sample. For standard non-sequential MC we draw a fixed number of samples for each test. For sequential MC, samples are drawn until a given number of extreme samples is observed or until a maximum number of samples is reached. For the MCFDR scheme, samples are drawn either until a given number of extreme samples is observed or until the estimated FDR-value falls below a given threshold. The simulation procedure is summarized below:(1) Draw m 0 samples from the Uniform distribution, and m(1 0 ) samples from the Beta (,) distribution.(2) For each test i, i = 1,...,m(a) Set g = 0 (b) While g is smaller than a limit specified by the stopping criterion (differently defined in the basic scheme, the sequential MC scheme, and the MC-FDR scheme)As the main simulation, we ran 5000 tests, with  = 0.25, = 25, h = 20, a maximum of 50 000 samples for standard and sequentialMC, and with  0 varying between 0 and 1. The maximum number of samples was chosen to ensure the possibility of significant results after multiple testing correction.shows the resulting total number of samples for sequential MC and MCFDR, respectively, as a function of the number of true H1.shows that the number of rejected tests, as a function of the number of true H1, is very similar across all three schemes. When the number of true H1 is low, stronger multiple testing correction is needed, leading to lower power and under-rejection. When the number of true H1 increases, more rejections can be made, while still controlling the FDR. For example, when 4500 of the 5000 hypotheses are truly from H1, rejecting all 5000 null hypotheses would give an FDR of exactly (50004500)/5000 = 0.1. Note that these are general features of the FDR; this behavior is not specific to our approach.shows that the empirical FDR is also very similar across schemes, and very close to the chosen FDR threshold. In order to inspect the behavior of the schemes more closely, it is necessary to look at the number of samples and estimated P-values at individual settings of true H1.shows underlying and estimated P-values in a collection where 10% of tests come from H1.shows the number of needed samples per test, with tests sorted in the same order as in. A few tests (seen at the left side of the plot) corresponding to very low P-values, need a large number of samples to become significant since they are subject to strong multiple testing correction (due to the relatively high  0 ). However, the remaining (majority of) tests are stopped early by the sequential MC threshold. The other end of the spectrum, with a large proportion of true H1, is shown inand.shows underlying and estimated P-values in a simulation where 80% of tests come from H1. Here, most Pvalues are small, and estimated with reasonable accuracy.shows the corresponding number of needed samples. Only a few of the P-values are large enough to stop early by the sequential MC criterion. However, the mild multiple testing correction (due to the relatively low  0 ) means that a limited number of samples is needed to reach q-values below the chosen threshold (0.1). In order to further investigate the generalizability of the simulation results, we performed additional simulations with varying h (detailed plots are provided in the accompanying Galaxy Pages document). As expected, both the number of samples and the precision of estimated P-values increased as a function of increasing h, for both sequential MC and the MCFDR scheme. Apart from this, the behavior and relation between the schemes were as for the main simulations (using h = 20). We have also tried simulations with a range of different settings for various other parameters, without observing any unexpected behavior. Thus, we are not aware of any setting for which the MCFDR scheme would fail to work as intended.
Real dataThe regulatory role of epigenetic modifications is gaining increasing attention, to a large degree driven by the increased availability of high resolution, genome-wide data on such modifications (). A recent study byinvestigates how profiles of H3K4me2-modifications in T-Cells () are distributed within genes. Based on a clustering of H3K4me2-profiles, five classes of genes are distinguished. A main distinction between these classes is whether H3K4me2 is localized around the transcription start site or to a larger degree spread throughout the gene body.proceed to discuss implications of these patterns for expression and tissue specificity. The distributive aspect of H3K4me2-modifications is inmainly considered on a per class basis, where clustering allows patterns to be seen across a large number of genes. An alternative is to ask, individually for each gene, whether H3K4me2-modifications appears significantly more at the upstream end of the gene. This requires a precise hypothesis to be evaluated statistically for each gene. A natural test statistic is the average relative positioning of modifications within the gene. As histone modifications are connected to nucleosomes, which favor certain inter-spacings along DNA, the empirical inter-point length distribution should be preserved in a null hypothesis (). This requires a Monte Carlo based hypothesis test, where H3K4me2-modifications are permuted while preserving inter-point distances, and where the test statistic is the average relative position within a gene. To focus on genes where there should be enough data to support conclusions to be drawn, we consider the 3466 Ensembl genes that include 10 or more histone modifications. We find that 2747 (79%) of the considered genes have significantly more H3K4me2modifications at the upstream end of the gene, confirming that the H3K4me2-modifications preferentially localize close to the transcription start site. For any particular gene, we may also ask the opposite question: does H3K4me2 localize preferentially at the downstream end of the gene? We find four Ensembl genes with significantly more H3K4me2 modifications downstream in the gene. Although the preferential localization downstream in these genes could represent a distinct regulatory signal targeting this gene set, a more plausible explanation is that the genes in question are overlapping other genes (or gene variants) that drive the association to H3K4me2 modifications. Manual inspection of these particular regions supports this latter explanation. Two of the genes overlapwith an alternative gene variant, where the methylations display a typical pattern in reference to this alternative variant. A third gene is overlapping with another (Ensembl) gene at the opposite strand ().When asking whether H3K4me2-modifications appears significantly more at the upstream end of the gene, there is a high proportion of very low P-values. Therefore, the sequential MC threshold on number of extreme samples does not apply early), visualized by the UCSC Genome Browser. In reference to the above-mentioned gene (corresponding to Ensembl transcript ID ENST00000337049 in the, H3K4me2 modifications occur significantly more downstream in the gene. However, in reference to the gene corresponding to ID ENST00000367220, which is shorter and at the opposite strand, the H3K4me2 modifications are preferentially located close to TSS, occur gradually less frequently throughout the gene body and stop appearing after the gene body.
MC multiple testing
G.K.Sandve et al.where the assumption is clearly wrong. The case with relatively few true null hypotheses leads to the largest computational burden using current algorithms, such as sequential MC. We speculate that such cases will become increasingly common in the future, with the advent of more elaborate study designs and research questionsin particular when doing local analysis of a generic question, such as investigating a specific relation between genomic features in bins along the genome. Our method assumes that the user is mainly interested in an FDRbased accept/reject decision for each test, and aims to stop MC sampling when further sampling would not change the decision. In such a setting, the concept of resampling risk due to Gandy (2009) is relevant. Attempting to control resampling risk for q-values would be an interesting undertaking, though not straightforward as it would require taking uncertainty (variance) of the FDR into account ().aims to improve computational efficiency of P-value estimation in specific MC settings. Although beyond the scope of the present article, it would be interesting to study the adoption of our FDR-based stopping criterion also to the methods of Gandy (2009) and. We have here considered the MC-based P-values as the values of direct interest, as these indeed satisfy the criteria for valid P-values (). An alternative view is to think of the MC computed P-values as estimates of an underlying true P-value. Then, the MC P-value estimate follows a binomial distribution around the underlying P-value (). As new samples are added, this estimated P-value will change, although it will still be highly dependent on the previous estimate. A possible variation of our MCFDR algorithm would be to stop sampling individually as each test reaches the specified q-value threshold: at Step 2b in the MCFDR algorithm as described in Section 2, for each i  A, move i from A to B if q i <. Although even less computationally demanding, this could introduce a bias toward stopping sampling at estimates lower than the underlying P-value. The reason for this is the tendency to stop sampling at 'opportune' times, when the estimate happens to be at left-hand side of the binomial distribution around the underlying P-value. This is less likely to happen when using the global criterion, as it would need to happen for several estimates simultaneously. Simulations (described in the Galaxy Pages document) confirm this empirically. Both simulations and applications of the MCFDR algorithm is available through the Genomic HyperBrowser. A simple web tool allows anyone to run simulations at different parameter settings, providing detailed inspection of the properties of the algorithm. MCFDR is integrated into the main analysis engine of the Genomic HyperBrowser, allowing anyone to make use of the algorithm for analyses on their own data, or reproduce our biological findings (see the Galaxy Pages document referred to in the abstract). Furthermore, due to the inherent simplicity of the algorithm, it is easy to apply to any computational investigation that involves MC and multiple testing. Although modern technologies for data generation and computation is neither a necessity for MC estimation () nor for multiple testing (), it seems clear that their adoption has been driven by increased computer power and data generation technologies such as microarrays. In the same way, although the ideas here presented on MC in multiple testing settings are general, we believe their relevance will increase strongly along with the future developments in e.g. next-generation sequencing, making them an important part of a bioinformaticians toolbox in the future.
at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
for the majority of tests. An unlimited sequential MC run was still running after 2 weeks, having surpassed 1.5 million samples for some tests. We therefore imposed a ceiling on the maximum number of samples for sequential MC, set to 50 000 to ensure the possibility of significant results after multiple testing correction (indeed, using a maximum of 10 000 samples for sequential MC missed all significant results when asking about overrepresentation of H3K4me2 downstream in genes). Many of the tests hit the imposed ceiling on maximum number of samples, with a total number of >30 million samples across tests. In the MCFDR scheme, using a FDR-threshold of 0.1, the total number of samples was <350 000, almost a factor 100 less than with sequential MC (running time were for MCFDR <5 min, as compared to >9 h for sequential MC). As a large proportion of the null hypotheses end up rejected, the number of samples needed to reach q-values below the chosen threshold is limited. When investigating whether H3K4me2 modifications are preferentially located downstream in genes, there is a very low proportion of rejected tests. Most of the tests stop early by the sequential MC threshold, making the two schemes behave very similarly. The few rejected tests are subject to a very strong multiple testing correction, and as discussed above needs >10 000 samples to at all allow any test to beat the FDR threshold. When applying a ceiling of 50 000 samples to both schemes, the total number of samples are essentially similar. If the ceiling is removed, the total number of samples increases only slightly for MCFDR, while it increases substantially for sequential MC (surpassing one million samples for some of the tests). Details are provided in the Galaxy Pages document. 4 DISCUSSION AND CONCLUSIONS We have provided a simple and efficient method for MC-based multiple testing. The method is freely available as part of the Genomic HyperBrowser, an open source, generic web-based system for statistical analysis of genomic annotation data. The method has been shown to work well on simulated data, and also to be highly useful for a realistic example, with computation times reduced by a factor of nearly one hundred. MC-based hypothesis testing is often needed for genomic data. In our example of H3K4me2-modifications, the simplifying assumptions that would be needed to do analytic tests would be highly unreasonable. As discussed in Ewan Birney et al. (2007), assuming Poisson distributed positions of H3K4me2-modifications (as would be needed for an analytic test) gives an unrealistically small variance of the null distribution, and hence leads to false positives. Indeed, the analytic version of the test gave 112 significant findings for the downstream positioning test, as opposed to only four findings when preserving inter-point distances in the MC version. Increasingly, we see applications where the calculation of each single MC sample is quite computationally expensive, and where the problem is further compounded by the need to do thousands of hypothesis tests (Ewan Birney et al., 2007; Sandve et al., 2010). In general, we must consider both statistical and computational efficiency. The FDR was introduced with the aim to improve statistical efficiency (as compared with e.g. Bonferroni correction): reject as many null hypotheses as possible, while controlling a reasonable error rate. As we have shown, taking the FDR into account during MC sampling can also greatly improve computational efficiency when we need to do MC-based multiple tests. As shown by both our simulation study and our real data example, our method is particularly useful in the case where many tests are truly H1, while still giving correct results if few or no tests are truly H1. Much work on multiple hypothesis testing and FDR has (implicitly or explicitly) assumed that the proportion of true null hypotheses is close to one (Efron, 2004). While this may be a natural assumption in the oft-studied case of testing for differential gene expression, we see no reason why it should be made in general. In fact, our study of H3K4me2-modifications provides an example
