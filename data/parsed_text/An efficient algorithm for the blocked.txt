Motivation: Tandem mass spectrometry (MS) has become the method of choice for protein identification and quantification. In the era of big data biology, tandem mass spectra are often searched against huge protein databases generated from genomes or RNA-Seq data for peptide identification. However, most existing tools for MS-based peptide identification compare a tandem mass spectrum against all peptides in a database whose molecular masses are similar to the precursor mass of the spectrum, making mass spectral data analysis slow for huge databases. Tag-based methods extract peptide sequence tags from a tandem mass spectrum and use them as a filter to reduce the number of candidate peptides, thus speeding up the database search. Recently, gapped tags have been introduced into mass spectral data analysis because they improve the sensitivity of peptide identification compared with sequence tags. However, the blocked pattern matching (BPM) problem, which is an essential step in gapped tag-based peptide identification, has not been fully solved. Results: In this article, we propose a fast and memory-efficient algorithm for the BPM problem. Experiments on both simulated and real datasets showed that the proposed algorithm achieved high speed and high sensitivity for peptide filtration in peptide identification by database search.
INTRODUCTIONWith the developments of high-throughput genomics, transcriptomics and proteomics, combining multiple omics data provides a new way for studying complex biological systems. In multiple omics data analysis, tandem mass (MS/MS) spectra are searched against protein databases generated from genomes or RNA-Seq data for peptide identification. These protein databases are often huge. For example, in human microbiome studies, MS/MS spectra are searched against databases containing protein sequences generated from hundreds, even thousands, of genomes (). Most mass spectrometry (MS)-based peptide identification tools match an MS/MS spectrum against all peptides in a database whose molecular masses are similar to the precursor mass of the spectrum (). These tools become slow when the database is large. An alternative approach is based on peptide sequence tags: peptide sequence tags are extracted from an MS/MS spectrum and searched against a database to identify a small number of candidate peptides that match at least one of the tags, then a rescoring function is applied to report the highest scoring candidate peptide (). The trade-off between speed and sensitivity is an important problem in tagbased methods. To increase the sensitivity, it is essential that the set of sequence tags extracted from a spectrum contains a correct one that matches the target peptide. To increase the speed, long sequence tags (length ! 5) are preferred because they are efficient in filtering out incorrect peptides. As a result, correct long sequence tags are extremely useful in tag-based methods because they speed up database searches without losing sensitivity. However, correct long sequence tags may not be found in MS/ MS spectra because of missing and noise peaks (). To utilize long sequence tags,proposed to generate a spectral dictionary containing full-length peptide constructions from an MS/MS spectrum for peptide identification. A drawback of this approach is that a spectral dictionary of an MS/MS spectrum with a large precursor mass may contain billions of peptides.introduced gapped peptides to solve this problem. Since a gapped peptide represents many non-gapped peptides, the use of gapped peptides significantly reduces the sizes of spectral dictionaries and speeds up peptide identification without losing sensitivity. Similar to the method proposed by, replacing sequence tags with gapped tags can achieve both high speed and high sensitivity in tag-based peptide identification. A gapped tag is represented by a sequence of mass values instead of amino acids. Each mass value is the mass of one amino acid residue or the sum of the masses of several consecutive amino acid residues. Many MS/MS spectra do not contain long sequence tags because of missing peaks, but contain long gapped tags. Gapped tags and gapped peptides give rise to the blocked pattern matching (BPM) problem in which a blocked pattern generated from a gapped tag is searched against a text to find matched substrings.proposed an O(m) algorithm for querying a blocked pattern of length m against a text of length n. However, the time and space needed for the preprocessing step of the algorithm is O2 k , where k is the length of the longest substring to identify. When k = 30, the preprocessing step is slow and the space required by the algorithm is huge. *To whom correspondence should be addressed.In this article, we present a fast and memory-efficient algorithm for the BPM problem. The time and space complexity of the preprocessing step of the algorithm is O(n). In the application of MS-based peptide identification, the time complexity for querying a blocked pattern is sublinear in n. Experiments on both simulated and real MS/MS data sets showed that the proposed algorithm achieved high speed and high sensitivity for peptide filtration in peptide identification by database search.
METHODS
The BPM problemLet N be the set of all natural numbers and S a subset of N. A string over N is called a pattern string, and a string over S is called a text string. When a pattern string is searched against a text string, the pattern string is called a blocked pattern. Let S=s 1 ; s 2 ;. .. ; s n be a text string. The mass of a substring s i ; s i+1 ;. .. ; s j of S is the sum of all numbers in the substring, i.e. s i +s i+1 +    +s j. Substrings s i ; s i+1 ;. .. ; s j and s j+1 ; s j+2 ;. .. s k are called consecutive substrings of S. A partition R of S is a sequence of consecutive substrings A 1 ; A 2 ;. .. ; A k of S where A 1 starts from s 1 and A k ends at s n. The mass string of the partition R is a string comprised of the masses of the consecutive substrings of R. For example, when S=f71; 113; 114; 128g; S=71; 113; 114; 128; A 1 =71; A 2 =113; 114 and A 3 =128, the substrings A 1 ; A 2 ; A 3 is a partition of S and the corresponding mass string is 71, 227, 128, where 227 is the mass of A 2. A blocked pattern matches a text string if there is a partition of the text string such that the mass string of the partition is identical to the blocked pattern. In the previous example, the blocked pattern 71, 227, 128 matches the text string 71, 113, 114, 128.
The BPM problem
An efficient algorithm for the BPM problemIn this subsection, we present an efficient algorithm for the BPM problem, in which the text T is represented by a suffix tree. Although the proposed algorithm works for suffix trees in which each edge is labeled with a text string with one or more letters, here we assume that each edge is labeled with only one letter to simplify the following analysis. Before discussing the new algorithm, we review the steps to search a text string against a suffix tree. To find substrings in T matching a text string a 1 ; a 2 ;. .. ; a m , we start from the root N 0 of the suffix tree and find a list of nodes N 1 ; N 2 ;. .. ; N m such that the path from the root to N i , for 1 i m, spells out the prefix a 1 ; a 2 ;. .. ; a i. In addition, the letter a i is the label on the edge connecting N i1 and N i. We cannot search the blocked pattern P against the suffix tree directly since the text T is over S (S & N ), whereas P is over N. Alternatively, we can first convert P into the set of all text strings matching P and then search each text string in against the suffix tree. Let V i be the set of all text strings whose masses equal p i. An example of V i is shown in Supplementary Table S1. Each text string in is the concatenation of a list of text strings v 1 ; v 2 ;. .. ; v m in which v i 2 V i for 1 i m. The number of text strings in is  m i=1 jV i j, which may introduce a combinatorial explosion when jV i j41 for most p i in P. As a result, it is not fast to search P by converting it to explicitly. Prefixes of P are used to speed up blocked pattern searches. A text string S is a prefix text string of P if S matches a prefix pattern string of P. Moreover, if a prefix text string of P is identical to a substring of T, we say it is an identifiable prefix text string of P. For example, when S=f71; 113; 114; 128g, P = 71, 227, 128, and T=87; 71; 113; 114; 128; 97, both 71, 113, 114 and 71, 114, 113 are prefix text strings of P. The string 71, 113, 114 is an identifiable prefix text string of P, but 71, 114, 113 is not. If a prefix text string is not identifiable, then all text strings in with the prefix are not identifiable, making it not necessary to generate and search these text strings. The idea of the BPM algorithm is to speed up blocked pattern searches by removing non-identifiable prefix text strings (). Each identifiable prefix text string corresponds to a unique node in the suffix tree. Let U i be the set of nodes corresponding to all identifiable prefix text strings that match the prefix p 1 ; p 2 ;. .. ; p i of P. Similar to searching a text string, we initialize U 0 as the set containing only the root of the tree and find U 1 ; U 2 ;. .. ; U m progressively. The set U m contains the solution to the BPM problem because the identifiable prefix text strings that match p 1 ; p 2 ;. .. ; p m are substrings in T that match P. To find U i from U i1 , we start from each node u 2 U i1 and search for each text string S 2 V i. If there exists a node v such that the path from u to v spells out the string S, then the node v is added to U i. The total number of searches in the iteration, i.e. finding U i from U i1 , is jU i1 j  jV i j. After the last set U m is found, the BPM problem is solved by reporting all substrings corresponding to U m and their positions in T, which are stored in U m. Since the text T is represented by a suffix tree, the space complexity of the algorithm is O(n).
Time complexityRepresenting the text T as a suffix tree is a preprocessing step for pattern queries. Its time complexity is O(n). Let G be the largest number in the blocked pattern P, that is, G=max m i=1 p i. We denote by W k the set of all text strings whose masses equal k. To obtain V 1 ; V 2 ;. .. ; V m , we generate a lookup table W 0 ; W 1 ;. .. ; W G. The number of operations for computing W 0 ; W 1 ;. .. ; W G is an exponential function of G (see the Supplementary Material). In peptide identification by tandem mass spectra, the value G is not extremely large and the sets W 0 ; W 1 ;. .. ; W G can be computed in a short time (see Section 3.2). Below we focus on the query time complexity of the BPM algorithm (steps 27 of the algorithm in). When prefix text strings of P are long, most of them cannot be found in the text T (i.e. they are not identifiable) and will be removed from further consideration. As a result, the size of U i is often smaller than jU i1 j  jV i j. That is the reason why pattern queries in the BPM algorithm are fast. Let N=max m i=1 jV i j. The running time of searching P against the suffix tree is determined byThe expectation of jY l j is determined by the size of X l and the probability that a length l text string is found in T. As a result, the running time of the pattern query is related to the sizes of Y l and X l. Each length l prefix text string in X l has only one partition A 1 ; A 2 ;. .. ; A k such that the mass string of the partition, which is a length k pattern string, is the same to a prefix of P. Let l i be the length of A i for 1 i k. We say l 1 ; l 2 ;. .. ; l k is the configuration of the prefix text string. For example, when S=f2; 3g and P = 3, 6, 4, we have V 1 =f3g; V 2 = f3; 3; 2; 2; 2g and V 3 =f2; 2g. The configuration of the length 4 prefix text string 3, 2, 2, 2 is 1, 3 because it has only one partition A 1 =3 andThe subset V i;j contains all length j text strings in V i. The size of X C l is  k i=1 jV i;li j. Because the probability that a prefix text string in X C l is found in T is a function of l, we want to represent the upper bound of jX C l j as a function of l. To this end, we introduce an expansion factor r i;j =jV i;j j 1=j for each set V i;j. The largest expansion factor is denoted as r=max i;j r i;j. Since jV i;li j r li for 1 i k,Because the number of configurations of prefix text strings in X l is bounded by 2 l , we can prove that 2r l is an upper bound of jX l j and further give the average-case time complexity of a pattern query in the BPM algorithm. THEOREM 1. When the size of S is a constant and 152r5jSj, the averagecase time complexity of a pattern query in the BPM algorithm is On log jSj 2r N+M, where M is the number of matched substrings in T.A proof of the above theorem is given in the Supplementary Material. The average-case time complexity is obtained by analyzing the expectation of the size of Y l. In the worst case, the size of Y l is bounded by the length of the text. Consequently, the worst-case time complexity of a pattern query in the BPM algorithm is O(mnN).
Peptide identification by BPMIn peptide identification, blocked patterns are often obtained from gapped tags. A gapped tag of a spectrum is represented by a list of masses, each of which is the distance between two peaks in the spectrum, which may correspond to one or more amino acids.gives an example spectrum for the peptide FTALNQVR from which we can generate a gapped tag 71.04, 227.13, 128.06 rather than a sequence tag ALNQ because the peak for the fragment FTAL is missing. A gapped tag is converted into a blocked pattern by rounding each mass in the gapped tag into an integer. Although rounding masses to integers has been successfully applied to analyzing low accuracy mass spectra (), it may introduce large errors in analyzing high accuracy mass spectra. For example, a large error 0.23 is introduced by rounding the mass 426.23 (with an accuracy of 0.01) of the fragment ion ALNQ into 426. To avoid this problem, mass values are multiplied by a scale factor before rounded to integers (). For example, when the scale factor is 100, the mass of the amino acid residue A is converted into 7 104. High-accuracy fragment ion peaks and a large scale factor are important in reducing the number of text strings matched to a blocked pattern and speeding up pattern queries. Since the BPM algorithm is designed for high-accuracy MS/MS spectra with high-accuracy precursors, it may fail to efficiently search blocked patterns generated from low-accuracy MS/MS spectra. Blocked patterns can also be generated from sequence tags when local confidence scores of amino acids in the sequence tags are available (). In general, amino acids with low confidence scores tend to be incorrect. A sequence tag is converted into a gapped tag by replacing neighboring amino acids that have low confidence scores with the sum of their masses and substituting an amino acid that has a high confidence score with its single mass. The gapped tag is further converted into a blocked pattern by rounding its masses to integers. In practice, gaps in gapped tags are no larger than 500 Da (). When a sequence tag contains several consecutive amino acids with low confidence scores such that the sum of their masses is larger than 500 Da, the sequence tag is broken into two short sequence tags by the large gap from which gapped tags are generated. The threshold for confidence scores determines which amino acids in a sequence tag are combined. When the threshold is lower than the smallest confidence score in a sequence tag, every amino acid in the sequence tag is converted to a mass in the gapped tag. When the threshold is extremely high, all amino acids in a sequence tag is combined to a large mass and the search of the blocked pattern is equivalent to peptide identification by using its precursor mass. In peptide identification, the residue mass values of the 20 standard amino acid are converted into integers by using a scale factor. The alphabet S of text strings is the set of the resulting integers. Since leucine (L) and isoleucine (I) have the same mass, they are treated as the same in blocked pattern searches. As a result, the size of S is 19. A protein database is converted to a text over S by replacing each amino acid in the database by its corresponding integer in S. Blocked patterns are generated from a tandem mass spectrum and searched against the text translated from a protein database to find candidate peptides. After the candidate peptides are identified, they are filtered by the precursor mass of the spectrum. The resulting peptidespectrum-matches (PSMs) are further rescored to find the highest scoring one (Supplementary). Any scoring function can be utilized in the rescoring step to improve the sensitivity of peptide identification. Searching blocked patterns against the text generated from a database is an essential step that determines the speed and sensitivity of peptide identification. In peptide identification by tandem mass spectra, the numbers (letters) in P are usually not extremely large. When the largest gap in gapped tags. An example spectrum for the peptide FTALNQVR. A gapped tag 71.04, 227.13, 128.08 is extracted from the spectrum based on the distances between peak pairs, where 71.04 is the mass of the amino acid residue A, 227.13 is the sum of the masses of the amino acid residues L and N and 128.08 is the mass of the amino acid residue Q. A blocked pattern 71, 227, 128 is generated by rounding each mass in the gapped tag to an integer is 500 Da and the scale factor is 100, the largest number in P is 50 000. In this case, the number N in Theorem 1 can be treated as a constant value. In addition, log jSj 2r in Theorem 1 is usually smaller than 1. In this application, the average-case time complexity for a pattern query is sublinear in the size of the database. The numbers in a blocked pattern may have small errors that are introduced in measuring the m/z values of fragment ions. To account for these errors, an error tolerance is allowed when blocked patterns are searched against a text. In the BPM algorithm, a text string is included into the set V i if the difference between p i and the sum of all the numbers in the text string is within a predefined error tolerance.
RESULTSWe implemented the BPM algorithm in Java and tested it on both simulated and real datasets. All the tests were performed on a Linux (64-bit) desktop PC with a 1.4 GHz CPU and 32 GB RAM. We were not able to compare the BPM algorithm with that described inbecause it is not available.
DatasetA dataset generated from human cell lysate () was used to test the BPM algorithm. In the preparation of the dataset, the protein mixture was analyzed on an Orbitrap Velos (Thermo Fisher Scientific) coupled with a high-performance liquid chromatography system. High-accuracy MS and MS/MS spectra were collected at a resolution of 30 000 and 7500, respectively. Triplicate higher energy collisionally activated dissociation datasets were then acquired, of which only one with 37 810 tandem mass spectra was selected to evaluate the BPM algorithm. Details of the experiment can be found in).
Running time analysisThe human proteome database (about 12 MB) was downloaded from the Swiss-Prot database. We constructed a suffix tree from the human proteome database using the Ukkonen's algorithm () implemented by Nelson and ported to Java by Havsiyevych (The source code of the implementation can be found at http://illya-keeplearning.blogspot.com/2009/04/suffixtrees-java-ukkonens-algorithm.html). The running time for the suffix tree construction was about 30 s. In the implementation of the BPM algorithm, the scale factor is 100. Let S be the alphabet generated from the 19 amino acids (the amino acids I and J are treated as the same). In practice, gaps typically do not exceed 500 Da (), and the largest number in blocked patterns is 50 000. For each number k between 0 and 50 000, we generated the set W k of all text strings on S such that the sum of the numbers in the text string is the same to k with an error tolerance of 5. The size of the lookup table
.. ;W k;j ;. . ., where W k;j contains all length j text strings in W k. Let r k =max j jW k;j j 1 j. The histogram of r k shows that r k 5:7 (Supplementary). Since log 19 2  5:7 % 0:83, the average-case time complexity of the BPM algorithm is sublinear in the size of the database in this application. When a blocked pattern of length m is generated from a sequence tag with n amino acids, we define n/m as the gap ratio of the pattern. For example, the blocked pattern 71, 227, 128 can be generated from a sequence tag ALNQ (71, 113, 114, 128), and the gap ratio is 4/3. We tested the BPM algorithm on simulated data to find the relationship between the running time and the gap ratio. Blocked patterns were generated directly from peptides in the human proteome database: A total of 1 million peptides of length 20 were randomly selected from the database.(Supplementary). The blocked patterns were then searched against the suffix tree constructed from the human proteome database. The average query time for blocked patterns was fast for all four gap ratios (Supplementary). When the gap ratio was 4, the average query time was less than 0.003 s per pattern. In addition, the average query time significantly increased as the gap ratio increased, so large gaps should be avoided to guarantee that the query time is fast in practice.
Evaluation on the real datasetTo evaluate the performance of the BPM algorithm, we generated a set of PSMs from the human lysate dataset. MS-GF+ () was employed to search each spectrum in the dataset against a target-decoy concatenated human proteome database. With 1% spectrum level false discovery rate (FDR), MS-GF+ identified 13 135 spectra (in about 18 min), which are assumed correct and used as a gold standard for the following evaluation. The 13 135 spectra are called identifiable spectra. For brevity, the set of 13 135 spectra is referred to as the HUMAN dataset.
Evaluation criteriaIn peptide identification, a set of blocked patterns are extracted from a spectrum and searched against a protein database to find candidate peptides that contain at least one blocked pattern. If one of the extracted blocked patterns is correct (in the target peptide) and the filtration based on the blocked patterns reports a set of candidate peptides that contains the target one, then the spectrum is said to be efficiently filtered. The filtration efficiency is defined as follows: filtration efficiency = Number of identifiable spectra that can be efficiently filtered Number of identifiable spectra :The second evaluation criterion is the query speed of blocked patterns. The speed of peptide identification is also related to the number of the candidate peptides reported by blocked patternbased filtration, which is the third evaluation criterion.
Pattern generationWe performed de novo sequencing on the HUMAN dataset using PEAKS 6.0 () and reported 10 peptides with the highest scores for each spectrum. Each peptide was converted into a blocked pattern as follows. Consecutive amino acids were replaced by the sum of their masses if they all had a local confidence score 5 c (a predefined threshold), whereas an amino acid with a local confidence score ! c was replaced by its single mass. The masses were multiplied by the scale factor 100 and rounded to integers.
Comparison with sequence tagsFor each spectrum in the HUMAN dataset, we generated both ordinary patterns (sequence tags) and blocked patterns from the 10 peptides reported by PEAKS. When ordinary patterns were generated, the confidence score threshold was set as 0, and all amino acids in a peptide were replaced by their single masses. Note that the length of a blocked pattern may not be the same to its corresponding sequence tag. For example, the length of the sequence tag ALNQ (71, 113, 114, 128) is 4, and the length of the blocked pattern 71, 227, 128 is 3. To compare blocked patterns with ordinary patterns, we redefine the length of a blocked pattern as the length of the sequence tag (i.e. number of amino acids) from which the blocked pattern is generated.Both the blocked patterns and ordinary patterns were searched against the suffix tree. The parameter c was fixed as 60 for generating blocked patterns. The BPM algorithm with blocked patterns achieved a higher filtration efficiency than that with ordinary patterns (). The difference in the filtration efficiency increases as the pattern length increases (). By contrast, the running time of the BPM algorithm with blocked patterns is longer than that with ordinary patterns (), especially when pattern length is 4. However, the difference in the running time becomes smaller when the pattern length increases. Particularly, when the pattern length ! 6, the running time is within 20 s for both methods. The experiments demonstrated that replacing sequence tags with blocked patterns improved the filtration efficiency without significant increase of the running time.
Comparison with MASCOTTo further investigate the filtration efficiency of the BPM algorithm, we ran MASCOT () on the whole human cell lysate dataset with 37 810 tandem mass spectra. The error tolerances for precursor masses and fragment ion masses were set as 20 ppm and 0.05 Da, respectively. Using the target-decoy approach, MASCOT identified 10 953 spectra and 9284 distinct peptides with 1% spectrum level FDR in 6.1 min. Without any filtering algorithm, MS-GF+ identified 13 135 spectra and 10 800 peptides with the same FDR. It identified 2141 peptides missed by MASCOT and missed 625 peptide identified by MASCOT. When the BPM algorithm (pattern length = 4, confidence score threshold = 60) was used as a filtering step for MSGF+, a total of 982 peptides were missed because of the filtration, and MS-GF+ identified 11 845 spectra and 9818 peptides. MS-GF+ with the BPM filtering algorithm identified 1456 peptides missed by MASCOT and missed 922 peptides identified by MASCOT. When coupled with the BPM algorithm, the sensitivity of MS-GF+ is still comparable to MASCOT because of the high-filtration efficiency of the BPM algorithm.
Searching spectraagainst the human genome Most existing software tools for peptide identification by database search are slow when the protein database is huge. We evaluated the speed of the BPM algorithm by searching the HUMAN dataset against the six-frame translation of the human genome. This approach has found many important applications in proteogenomics studies (). The complete human genome (Homo_sapiens.GRCh37.74) was downloaded from Ensembl. The translation of each chromosome starts from the first, second and third nucleotide on each strand according to the standard genetic code regardless of the position of the start codon. The HUMAN dataset was searched against the translated putative protein sequences using both MSGF+ and the BPM algorithm. The translated protein database was split into parts of about 100 MB to reduce the memory usage of MS-GF+ and the BPM algorithm. The largest memory usage of the BPM algorithm for searching a 100 MB database was about 12 GB. The average running time for MS-GF+ was 3 s per spectrum while it was 0.3 s for the BPM algorithm when the pattern length was 4 (Supplementary). The running time of the BPM algorithm decreased with the increase of the pattern length. When the pattern length was 6, the running time was about 0.08 s per spectrum.
CONCLUSIONSPeptide identification of MS/MS spectra by database search has been dominated by the approach of comparing a spectrum against all peptides in the protein database whose molecular masses are similar to the precursor mass of the spectrum. However, in the era of big data biology, this approach may become slow with the rapid growth of the sizes of protein databases. An alternative approach based on sequence tags or blocked patterns (gapped tags) is fast for identifying peptides when the database is huge. In this article, we proposed an efficient BPM algorithm for filtering peptides using blocked patterns and tested it on simulated and real datasets. The experiments showed that the BPM algorithm achieved high speed in filtration of peptides, even when the database is huge, e.g. the six frame translation of the human genome. We also compared blocked patterns with sequence tags for peptide filtration and found that blocked patterns outperformed sequence tags in terms of the sensitivity of peptide filtration. Because the BPM algorithm is fast and sensitive, it is a promising tool for searching MS/MS spectra against huge protein databases. In practice, the length of blocked patterns plays an important role in the performance of the BPM algorithm. The experiments on the length of blocked
The Author 2014. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
Algorithm for blocked pattern matching problem at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
F.Deng et al. at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
.3.3 Pattern length and confidence score thresholds We tested the filtration efficiency and speed of the BPM algorithm by varying the two parameters, i.e. the length of blocked patterns and the threshold c for confidence scores, on the HUMAN dataset. To obtain length l blocked patterns, we enumerated all length l substrings of the blocked patterns generated from the dataset. The filtration efficiency of the algorithm decreases and the speed of the algorithm improves with the increase of the length of blocked patterns (Fig. 3). As the patterns become longer, the average number of candidate peptides for each spectrum decreases (Table 1). Particularly, when the pattern length !7, most spectra contain only 0 or 1 candidate peptide. When the pattern length is 5 or 6, the BPM algorithm achieves a good balance between the speed and filtration efficiency. Moreover, when the pattern length is fixed, the filtration efficiency decreases as the parameter c increases, while the running time is almost the same (Fig. 3). Therefore, a relative low cutoff value c should be used in practice. There are three parameters: the pattern length, the confidence score threshold and the number of blocked patterns, which affect the filtration efficiency of the BPM algorithm. When the confidence score threshold is fixed, the number of blocked patterns extracted from a spectrum decreases when the pattern length increases and more shorter blocked patterns can be extracted from a spectrum than longer ones. The high-filtration efficiency of short blocked patterns has two possible reasons: the large number of short patterns and the short pattern length. To find which is the main reason, we tested the filtration efficiency of the BPM algorithm by fixing the confidence score threshold and the number of patterns and varying the pattern length. The experiment results show that the main reason that short gapped tags have high-filtration efficiency is the short pattern length, not the large number of short patterns (see the Supplementary Material). 3.3.4 Comparison with a baseline algorithm We compared the running time of the BPM algorithm with a trivial baseline algorithm. Given a blocked pattern P=p 1 ; p 2 ;. .. ; p m and a text T=t 1 ; t 2 ;. .. ; t n , the baseline algorithm simply examines, for each position i, 1 i n, if there is a prefix of t i ; t i+1 ;. .. ; t n that matches P and outputs matched prefixes. The time complexity of the algorithm is O(nL), where L is the length of the longest text string that matches P. By setting the pattern length as 4 and the confidence score threshold as 60, a total of 170 149 blocked patterns were extracted from the HUMAN dataset using the described method. Although the baseline algorithm took about 9 h to search all the patterns against the human proteome database, the BPM algorithm took only less than 1 min, which is a significant 540 times speedup.
