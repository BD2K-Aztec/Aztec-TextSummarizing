Motivation: Statistical methods for comparing relative rates of synonymous and non-synonymous substitutions maintain a central role in detecting positive selection. To identify selection, researchers often estimate the ratio of these relative rates (d N =d S) at individual alignment sites. Fitting a codon substitution model that captures het-erogeneity in d N =d S across sites provides a reliable way to perform such estimation, but it remains computationally prohibitive for massive datasets. By using crude estimates of the numbers of synonymous and non-synonymous substitutions at each site, counting approaches scale well to large datasets, but they fail to account for ancestral state reconstruction uncertainty and to provide site-specific d N =d S estimates. Results: We propose a hybrid solution that borrows the computational strength of counting methods, but augments these methods with empirical Bayes modeling to produce a relatively fast and reliable method capable of estimating site-specific d N =d S values in large datasets. Importantly, our hybrid approach, set in a Bayesian framework, integrates over the posterior distribution of phylogenies and ancestral reconstructions to quantify uncertainty about site-specific d N =d S estimates. Simulations demonstrate that this method competes well with more-principled statistical procedures and, in some cases, even out-performs them. We illustrate the utility of our method using human immunodeficiency virus, feline panleukopenia and canine parvovirus evolution examples. Availability: Renaissance counting is implemented in the development branch of BEAST, freely available at
INTRODUCTIONQuantifying selective pressures on protein-coding genes is central to the goal of characterizing Darwinian processes in evolutionary biology. Among comparative and summary statistic approaches, the relative rate of silent and replacement substitutions represents one of the most popular measures to detect the molecular footprint of selection. Non-synonymous mutations that offer fitness advantages are expected to become fixed at a higher rate than synonymous mutations, implying that a non-synonymous/synonymous substitution rate ratio !  d N =d S  greater than one provides evidence for diversifying positive selection. Although estimation of ! has led to the identification of positive selection in several systems (e.g.;), there are clear boundaries to the conditions under which it can reveal an unambiguous trace of molecular adaptation. First, an excess of non-synonymous substitutions over synonymous substitutions is almost invariably restricted to a handful of amino acid sites responsible for adaptive evolution. Therefore, sensible ! estimates need to take into account the variation in selection intensity across codon sites (). Moreover, although divergent sequences can yield considerable information to estimate nonsynonymous and synonymous substitution rates, the ratio of these rates may offer little insight when inferred from segregating polymorphisms within a single population (). Finally, it is also important to distinguish between different selective regimes underlying molecular adaptation. Diversifying selection maintains amino-acid diversity at a given site and naturally results in elevated ! values, whereas directional selection may operate through a restricted number of amino-acid replacements, which has less impact on ! but can lead to rapid fixation of a new allele in the population. The former is ubiquitous in antagonistic systems such as pathogen-host interactions (). Not surprisingly, d N =d S estimation methods have been frequently applied to viral gene sequences to detect escape from host immune responses or adaptation to novel hosts. Rapidly evolving viruses benefit from the ability to generate adaptive mutations de novo, whereas other organisms must rely on pre-existing *To whom correspondence should be addressed. variation maintained by population structure or balancing selection (). The impact of immune pressure on the genetic diversity of viruses can be highly dependent on how potent the immune responses are to different viral variants, a concept that has been put forward within the framework of phylodynamics (). For this reason, methods to estimate ! have become an integral part of the 'phylodynamic toolbox' (), which generally refers to recent statistical and computational developments to simultaneously estimate epidemic and spatiotemporal dynamics from viral genes sequences (). In this article, we are interested in site-specific estimation of d N =d S ratios. There are two main classes of methods designed for this task. The first class prescribes to build a model of codon evolution, with the d N =d S ratio as a model parameter that is allowed to vary across sites (). Although we fully endorse these approaches and use them whenever possible, codon-based models become computationally prohibitive when analyzing large datasets that include hundreds, if not thousands, of molecular sequences (). Because of this computational limitation, researchers often turn to a second class of methods that are based on imputing (counting) unobserved synonymous and non-synonymous substitutions (). These substitution counts are then used to construct a test statistic to assess the null hypothesis of neutrality (H 0 : d N =d S  1). Such counting methods enjoy computational efficiency and often work well in practice (Kosakovsky), but have two important shortcomings. First, counting approaches experience difficulties in handling uncertainty about the phylogenetic tree and about other nuisance parameters that play a role in counting unobserved synonymous and non-synonymous substitutions.propose to overcome this problem by combining stochastic mapping, introduced by Nielsen (2002), with traditional counting methods' test statistics as discrepancy measures in a posterior predictive diagnostics framework (). However, posterior predictive diagnostics, undoubtedly useful for visual exploration of model fit, are difficult to calibrate and to use in a semi-automatic fashion. The second limitation, shared by all counting methods, is their inability to provide reliable sites-specific d N =d S estimates and to quantify the relative strengths of selection across amino acid sites.
APPROACHWe propose a new counting method that overcomes both of the aforementioned shortcomings. Our solution arises in two steps. In the first step, we follow Nielsen (2002) andand produce multiple stochastic mapping-based realizations of synonymous and non-synonymous counts while integrating over the posterior distribution of the nuissance parameters including the phylogenetics tree. However, to gain computational tractability, we exploit nucleotide-based codon partition models () in this step. These models can be fit to data in a fraction of the time it takes to fit even the simplest codon-based evolutionary models first introduced byand. Although codon partition models do not account for selective pressures at amino acid sites (d N =d S is one for all sites under these models), emerging probabilistic counting procedures have been shown to be robust to such gross model misspecification (). The second step of our approach is the main novelty of this article. We treat each random realization of synonymous and non-synonymous counts as pseudo-data and shrink these site-specific counts toward their means over all sites. We accomplish this regularization through an empirical Bayes procedure. We then use these regularized synonymous and non-synonymous counts to form site-specific d N =d S estimates. The end result is a posterior distribution of these ratios for all sites in the alignment. This distribution can be used for estimation [e.g. we report the posterior mean and 95% credible intervals (CIs) of site-specific d N =d S values] and for testing diversifying positive selection (e.g. a site is classified as positively selected if the posterior probability of d N =d S 41 at this site is at least, say, 0.95). Empirical Bayes and, similar in spirit, full hierarchical Bayesian methods have been developed before for site-specific d N =d S estimation and for identifying sites under diversifying positive selection (). However, to our knowledge, we are the first to combine empirical Bayes philosophy and counting approaches, providing a revival of these simple methods to confront a formidable inferential problem. By performing the empirical Bayes regularization on the imputed count data, we avoid fitting computationally expensive codonbased models, making our 'renaissance counting' method practical for analyzing large datasets. We assess our method using a simulation study almost identical to the one conducted and validated by Kosakovsky Pond and Frost (2005). The simulations demonstrate that our method's site-specific d N =d S estimates and positively selected site identification are remarkably comparable with the estimates produced by the state-of-the-art codon-based models. We also apply our new renaissance approach to two empirical datasets. First, we reanalyze serially sampled feline panleukopenia and canine parvovirus VP2 capsid sequences. This analysis shows that renaissance counting produces sensible site-specific d N =d S estimates, simultaneously accounting for uncertainty in all model parameters, and highlights important differences between our new and codon-based methods. We conclude by using our method in tandem with conventional approaches to examine differences in adaptive evolution in HIV pol genes in treated and drug navenave patient populations.
METHODS
Probabilistic counting under a codon partition modelLet y  fy il g be a codon alignment matrix, where i spans n sequences, l runs over L sites in the alignment and each y ij is one of 64 nucleotide triplets (codons). We assume that each site y l follows a codon partition model, meaning that each nucleotide position s  1, 2, 3 within a codon evolves independently along a phylogenetic tree , according to one of the standard nucleotide substitution models (). In all our examples and without loss of generality, we use a Hasegawa, Kishino and Yano (1985) model (HKY85) for each nucleotide position, with positionspecific transition/transversion ratio s , substitution rate s and stationary distribution p s   As ,. .. , Ts . Position rates are normalized for identifiability for contemporaneously sampled sequences, but remain free parameters in the case of serially sampled data. We fit the above codon partition model in a Bayesian framework and use Markov chain Monte Carlo (MCMC) integration to obtain a sample from the posterior distribution of model parameters Prhjy, where h  , 1 , 2 , 3 , 1 , 2 , 3 , p 1 , p 2 , p 3 . Let h j be parameter values at MCMC iteration j. At each iteration j, we use stochastic mapping to impute the full evolutionary history of each nucleotide position within each codon site in our alignment (). We capitalize on a uniformization method, a modification of the original approach by, to draw realizations of the HKY continuous-time Markov chains (CTMCs) conditional on the codon data at the tips of the phylogeny j (). See Hobolth and Stone (2009) for an excellent review of different stochastic mapping algorithms. We also use simple forward CTMC simulation to draw the full evolutionary history of each site without conditioning on the data for normalization. For each stochastic mapping realization, conditional (C) and unconditional (U) on the data, we record the numbers of synonymous (S) substitutionsWe explain our empirical Bayes regularization procedure in detail in the next section.
Regularized site-specific d N =d S ratiosWithin each MCMC iteration, we view the realized values of synonymous and non-synonymous substitutions as pseudo-data. As our empirical Bayes regularization procedure is identical for all four types of imputed counts, we use the generic notation C l to denote one of the four possible count types,, at site l. Each of these counts represents the number of specifically labelled jumps of the codon model CTMC. In general, such random variables follow nonstandard distributions that reduce to a Poisson distribution only in special cases (). However, in the phylogenetic context, a Poisson distribution approximates these non-standard distributions very well (). Therefore, we assume thatwhere l is an unknown site-specific Poisson rate. Next, we postulate a hierarchical model by assuming thatwhere the hierarchical prior carries unknown shape and rate. This second model level enables information sharing across sites so that sites with low counts can borrow information from more informative sites. This hierarchical model can be fitted in a fully Bayesian framework by approximating the posterior distribution Pr, , jC, where k   1 ,. .. , L  and C  C 1 ,. .. , C L . Alternatively, one can first obtain estimates ^ and ^ from the marginal probability density PrCj,  and then arrive at site-specific rate estimates in the form of the expectations E l jC, ^ , ^  for l  1,. .. , L ().To execute our empirical Bayes approach, we start with sample means and variancesand match these empirical quantities with the theoretical mean and variance of a gamma-Poisson distribution with parameters and. This method of moments produces the following hyperparameter estimatesGiven these estimated values, we havefrom which we arrive at empirical Bayes estimates! RC 2:5%, l 515! RC 97:5%, l , and under negative selection if 14! RC 97:5%, l. Notice that we can not say anything about frequentist properties of this classification procedure. In other words, our method is not guaranteed to classify a site correctly 95% of the time during repeated replications of the evolutionary process. However, we point out that our new method offers more than merely a classification algorithm. In addition to classifying sites into the three categories above, we can assess the relative strengths of selection at individual sites by comparing site-specific CIs, including their relative rankings and the degree of overlap. To compare the use of a per-site d N =d S posterior distribution with a frequentist counting approach, we also explore a test procedure that only conditions on the expectations for the conditional and unconditional counts,
RESULTS
PerformanceWe conduct an extended simulation study to compare the relative performance of the renaissance approach to the state-of-the-art random effects likelihood codon-based model that accomodates both non-synonymous and synonymous rate variation across sites (DUAL REL) and the fixed effects likelihood (FEL) model approach implemented in HyPhy (). We reanalyze the datasets simulated by Kosakovsky Pond and Frost (2005). Briefly, the simulation procedure considers symmetric bifurcating trees with 8, 16, 32 and 64 tips and generates alignments encompassing 375 codons with a complex distribution of non-synonymous and synonymous substitution rates (resulting in 75 neutral, 335 negatively selected and 75 positively selected sites) (). We further extend this study to the 128-tip case and focus on the more realistic 16, 32, 64 and 128 range. Codon-based model substitution parameters were inspired by HIV polymerase sequence data, and 50 different replicates are generated for each collection of parameters. We first focus on the binary classification problem of identifying sites under diversifying positive selection and map the proportion of misidentified sites (false positive rate) to the proportion of correctly identified sites (true positive rate) for various nominal levels (P-values, empirical Bayes factors based on the ratio of posterior and prior odds of having ! 6  1, or posterior quantiles) of the test procedures we compare. The resulting receiver operating characteristic curves for renaissance counting, DUAL REL and FEL are presented in. For renaissance counting, we focus on the results for the CI coverage test approach (Supplementaryshows the EBin test has a very similar performance). Although the DUAL REL approach performs marginally better for a lower number of taxa, FEL benefits more from a large number of taxa. In general, the renaissance approach competes well with the codon model approaches with a roughly intermediate performance across the different simulation scenarios. Although the renaissance counting receiver operating characteristic curves are similar for CI coverage test and the EBin test (Supplementary), reasonably low false positive rates do not require very low EBin P-values, but they do require relative high posterior quantiles in the coverage approach (Supplementary). The EBin critical P-values also clearly decrease with the number of taxa for the same false positive rate, whereas a similar trend is not so obvious for the posterior quantiles. We anticipate that cut off values sensitive to the number of taxa will also be affected by sequence divergence, and only data-specific simulation provides an objective way to select such values.
Empirical dataWe analyze a feline and carnivore parvovirus dataset to compare renaissance counting implemented in BEAST () to REL codon-based model approaches. This dataset includes 91 VP2 capsid sequences sampled from various geographical regions for a 42-year period and was previously used to demonstrate the rapid adaptation of feline panleukopenia parvovirus to canine hosts ().lists the positively selected sites identified using renaissance counting and REL approaches, and Supplementaryplots the site-specific DUAL REL d N =d S estimates against the renaissance counting d N =d S estimates and their CIs. The REL approaches include non-synonymous (NS REL) and both non-synonymous and synonymous (DUAL REL) rate variation across sites. To model this rate variation, we used generalized discrete distributions with three rate categories. The DUAL REL model provides a significantly better fit when compared with the NS REL model (P50.001), indicating significant variation in d S across sites.originally use a NS REL approach as implemented in PAML [Phylogenetic Analysis by Maximum Likelihood, Yang,] and relied on fairly conservative criteria to identify positive selected sites (underlined in). If we use the criterion of ! RC 2:5% 41 for renaissance counting and a log Bayes factor (for d N =d S 4 1)44.0 for the REL models, which is indeed the cut off that corresponds to a false positive rate of 5% according to data-specific simulations (data not shown), then these three approaches provide support for roughly the same sites as being positively selected with few exceptions. The FEL approach, however, does not yield support for any site under positive diversifying selection unless one is willing to accept high critical P-values as evidence. In Table 1, we also report results of a single-likelihood ancestor counting (SLAC) method (Kosakovsky), a more advanced version of the original counting method of, which performs similarly to the FEL model. The same issues that emerged in the simulation analyses also complicate the site-specific d N /d S estimation by FEL for this dataset, and, for this reason, Kosakovsky Pond and Frost (2005) suggested to use scaled d N minus d S as a measure of selection to compare FEL with other methods. Similar to the FEL and SLAC P-values, the EBin P-values derived from the average counts for each site are of little use compared with a test approach that draws information from the posterior distribution of regularized site-specific d N =d S ratios. The poor performance of these approaches may be attributed to the relatively low diversity in this dataset (mean pairwise diversity of 0.0086 substitutions per site). Between the two clear exceptions to the consistency of renaissance counting and REL results, site 101 is only identified by NS REL to be under positive selection. When also considering rate variation for synonymous substitutions, this site falls under a class with high synonymous substitution rates in DUAL REL, resulting also in a considerably lower d N =d S. So, it appears that despite conservative assignment, site 101 may be falsely identified as being positively selected when synonymous rate variation across sites is ignored. In this respect, renaissance counting is in better agreement with DUAL REL, and, in general, the renaissance estimates are in good agreement with the posterior d N =d S expectations estimated by DUAL REL. Both REL approaches find support for site 491 being under positive diversifying selection, despite the observation that the site also experiences a high synonymous substitution rate (S rate class  3 in DUAL REL), whereas renaissance counting classifies the site as neutrally evolving. For this site, only two unrelated sequences have a different amino acid (histidine and arginine) compared with the wild-type amino acid (glutamine). These amino acid substitutions on external branches could therefore represent (slightly) deleterious substitutions that have subsequently experienced purifying selection (). For renaissance counting, similar to other counting and FEL approaches, we can restrict ourselves to summarizing the substitution history on internal branches only to avoid the impact of such transient mutations. To appreciate the computational efficiency that renaissance counting affords, we first recall that direct run-time comparison with the existing implementation of the REL and FEL models is flawed because these implementations condition on a fixed tree. In this article, we overcome this implementation limitation by averaging results over an arbitrarily sized sample of trees from their posterior distribution, leading to almost arbitrarily long run-times. Alternatively, a slight underestimate of the computational cost to fit a full Bayesian REL model entails a full Bayesian fitting of the codon-based M 0 model. For this example, the codon-based model takes 92 longer to fit than performing renaissance counting using an Intel Xeon E5620 CPU running at 2.4 GHz. Recently, Suchard and Rambaut (2009) introduce massive parallelization for fitting large state-space models through the BEAGLE library (). Even when exploiting a Tesla C2050 graphics processing unit for fitting M 0 , renaissance counting still runs 3 faster on the CPU. A second application of renaissance counting compares the site-specific selection patterns for partial HIV pol gene sequences). In the treatment group, antiretroviral therapy consisted solely of the zidovudine (AZT) nucleoside reverse transcription inhibitor. Sites identified to be under positive diversifying selection by either renaissance counting, DUAL REL and FEL are listed in Tables 2 and 3 for the treated and untreated dataset, respectively. Supplementaryprovides a summary of mean d N =d S estimates with CIs for all sites in both datasets. When considering ! RC 2:5% 41 for renaissance counting, a log Bayes factor 4 4.0 for DUAL REL and a P 5 0.1 for FEL as evidence for positive diversifying selection, all methods identify about 8 to 11 positively selected sites in the treated dataset (). With a 5-fold higher diversity (a mean pairwise diversity of 0.0426 and 0.0413The sites indicated in bold are identified as positively selected by all three methods. EBin P-values were computed using the EBin distribution. M S and M N represent the rate class of the general discrete distribution with three rate classes to accommodate variation in d S and d N rates among sites, respectively. * and ** indicate intervals correspond to the 95% and 99% highest posterior density intervals, respectively, that exclude ! RC  1.), albeit mostly in combination with other substitutions for site 69 (). The presence of specific substitutions at position 207 has also been correlated with reduced AZT susceptibility in biologically cloned HIV-1 isolates [Q207D and Q207E, (, and in vitro evidence confirmed decreased AZT susceptibility owing to Q207D while this substitution also increased the relative fitness of AZT-resistant HIV-1 (). Site 200 also undergoes adaptive evolution in the untreated dataset and most likely reflects selection from the cellular immune response, rather than antiviral therapy (see below). Substitutions at other sites listed inmay also bear some relation to nucleoside analogue resistance and AZT resistance in particular [e.g. V35M (), T39A (), V60I (), R83K (), T200A () and R211K (, but these are generally considered to be 'accessory' substitutions that are supported by indirect evidence with little or no in vitro confirmation. Only two sites are identified as positively selected by all three methods in the drug navenave dataset using the same significance criteria as mentioned above (site 35 and 200). Twenty-three records can be retrieved from the Los Alamos HIV cytotoxic T-lymphocyte (CTL)/CD8 T-Cell epitope database for epitopes that span site 35. Importantly, when patients elicit CTL responses against this epitope, they are generally directed against amino acid variation at site 35 (), which makes this an example of virus evolution to the consensus B sequence (35V). Site 200 is also located in five epitopes listed in the CTL/CD8 T-Cell epitope database, but we could not retrieve any information concerning specific amino acid variation at site 200 that induces different CTL responses. Without such information, it remains difficult to establish a clear role for particular positions in immune evasion. In fact, the collection of reported epitopes covers the majority of Reverse Transcriptase amino acid positions, and it is therefore not surprising that many sites listed incan be mapped to known HIV-1 epitopes.
DISCUSSIONWe present a novel and efficient Bayesian method for detecting positive diversifying selection in molecular sequences. Our method combines the computational speed of counting methods and statistical efficiency of empirical Bayes approaches. A further strength of the method is its simplicity of implementation, thanks to recent algorithmic advances in stochastic mapping (). Stochastic mapping has been used before to speed up MCMC-based Bayesian estimation of codon-based models (), but this and subsequent approaches still operate within the codon-based modeling framework. In contrast, our method uses stochastic mapping to quickly approximate codon-based models that account for rate variation of d N =d S over sites. Our analysis of simulated and real data demonstrates that the proposed approach competes well with more computationally demanding methods in recovering site-specific d N =d S ratios and in accurately identifying sites under positive diversifying selection. The main distinction between renaissance counting and previous attempts to use stochastic mapping to detect diversifying positive selection () is the ability of our renaissance method to directly estimate d N =d S ratios and to quantify uncertainty in these estimates. This advance is important because all counting methods, including stochastic mapping-based ones, can only produce site-specific P-values, resulting from testing a null hypothesis of neutrality. However, it is well known that using P-values has limitations. In particular, as P-values are always calculated by conditioning on the null hypothesis, itwould be inappropriate to use the magnitude of P-values as evidence in favor of the null (). The task of comparing P-values becomes even more challenging in the method ofbecause these authors use notoriously hard-tocalibrate posterior predictive P-values (). Therefore, it is difficult to use previously developed counting methods to quantify relative strength of selection at amino acid sites. Although our method cannot possibly resolve the long-standing statistical controversy of quantifying evidence in hypothesis testing, renaissance counting offers a straightforward estimation alternative by producing site-specific posterior distributions of d N =d S ratios. Importantly, this uniquely positions renaissance counting among other positive selection detection methods as a method that also appropriately quantifies the relative strengths of selection at individual sites. When imputing/counting the unobserved synonymous and non-synonymous substitutions, we produce substitution counts on each branch of the phylogenetic tree and then sum them up for each site. If a scientifically meaningful partition of branches into groups exists, we can easily sum the substitutions within each group separately and apply our empirical Bayes procedure to the site-specific counts in each group. For applications to within-host HIV evolution for example, we can consider synonymous and non-synonymous substitutions only on internal branches of the phylogeny. This partition of branch lengths is motivated by a widely accepted hypothesis that many terminal branches of intrahost HIV phylogenies represent lineages that are weeded out by selection (). Therefore, it is reasonable, if not advisable, to avoid the mutational load on these branches and their impact on substitution rates () by excluding them when identifying positive diversifying selection. Concerning the identification site-specific selection patterns, the development of renaissance counting was clearly not to replace, but to complement existing methodology. Even after a comprehensive evaluation of several counting-based and maximum likelihood methods, Kosakovsky Pond and Frost (2005) found it difficult to make definitive recommendations on which methods to use in particular cases. In fact, they concluded that a consensus of several methods, but each accepting relatively high nominal levels, would be a reasonable approach to rule out spurious results. In many ways, renaissance counting presents an interesting candidate method to include in such a consensus approach. Embedded in a Bayesian inference framework, renaissance counting accounts for phylogenetic error when estimating d N =d S ratios. Perhaps more importantly, our approach uses a test statistic that is very different from both previous counting methods and maximum likelihood methods. For small or less divergent datasets, for example the test used in previous counting methods is notoriously conservative (Kosakovsky), which is also confirmed by our comparison of the EBin test to the CI coverage test. Empirical Bayesian analysis of random-effects models on the other hand can suffer from large Type I error rates owing to excessive errors in the parameter estimates used (Kosakovsky). Renaissance counting avoids the estimation of codon model parameters, and estimation uncertainty will be taken into account by the CI coverage test approach. The nucleotide-model approximation also offers a significant speed-up compared with fitting a codon model, but considerable computation time may still need to be invested in integrating over the posterior distribution of phylogenies. In this respect, we emphasize that renaissance counting is implemented in a Bayesian inference framework] that provides access to an array of flexible models for estimating genealogical history, divergence times, flexible semi-parametric demographic and phylogeographic histories (). Although site-specific selection patterns may not be of prime interest when engaging in such analyses, renaissance counting readily delivers d N =d S ratios for any coding sequence alignment, which may offer a starting point for in-depth characterization of selection pressures involving different methods.
at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
& 7 In summary, to obtain a sample from the posterior distribution of the d N =d S ratios, we (1) Draw M samples from the posterior distribution of model parameters Prhjy under the simple nucleotide-based codon partition model, and then (2) Post-process the MCMC output: (a) For each iteration j  1,. .. , M, impute the numbers of synonymous and non-synonymous substitutions, C S-C jl , C S-U jl , C N-C jl and C N-U jl , with the help of stochastic mapping, (b) Use empirical Bayes regularization to arrive at rates of synonymous and non-synonymous subsitutions, ^ S-C jl , ^ S-U jl , ^ N-C jl and ^ N-U jl , and finally (c) Form site-specific d N =d S ratios ! RC jl using Equation (1). 3.3 Computational considerations Our site-specific d N =d S estimation method has two main steps. This first and the most time consuming step involves obtaining a posterior MCMC sample under the nucleotide-based codon partition model. An analogous step for the simplest codon models with no rate heterogeneity (Muse and Gaut, 1994; Goldman and Yang, 1994) takes at best 61 2 /4 2 /3 % 80 times as long, but in practice, performs worse, as the computational work of matrix exponentiation for the codon model becomes non-negligible. In the second step, we use stochastic mapping coupled with empirical Bayes regularization. Our empirical Bayes regularization of the imputed substitution counts is accomplished almost instantaneously because this estimation procedure does not involve computationally intensive calculations. The imputation step is potentially time consuming, but we draw stochastic mapping realizations for a small number of saved MCMC iterations (10 3  10 4 ), which is typically orders of magnitude smaller than the length of the entire Markov chain (10 6  10 7 ). Therefore, the running time of our two-step procedure is dominated by the first step, making our approach significantly faster than Bayesian site-specific d N =d S estimation under codon-based models. 3.4 Identifying sites under selection To classify sites as negatively selected, neutrally evolving or positively selected, we use for each site l the posterior sample f! RC 1l ,. .. , ! RC Ml g, to estimate the 95% CI ! RC 2:5%, l , ! RC 97:5%, l . Alternatively, we could use a 95% highest posterior density region. We declare site l to be under diversifying positive selection if 15! RC 2:5%, l , neutral if
P.Lemey et al. at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
Next, we investigate the ability of the renaissance approach to estimate site-specific d N =d S values. In Figure 2, we compare the mean relative errors of such site-specific estimation produced by our method, DUAL REL and FEL during the analysis of the 128-taxa simulated dataset. As the total number of simulations is fairly small, owing to the high computational costs of DUAL REL and FEL under phylogenetic tree uncertainty, we also report 95% Monte Carlo error (grey shaded areas). Although the renaissance approach tends to overestimate small d N =d S values, our method performs remarkably well when the true d N =d S values are above or equal to one, the situation in which practitioners are most interested. This error pattern is reversed for the REL method, outperforming the renaissance method on small d N =d S values, but loses to our approach on sites under positive selection. The relative errors of the FEL method are difficult to quantify owing to the fact that this method occasionally produces unreasonably high d N =d S estimates. If we remove infinite d N =d S estimates during the relative error calculations, FEL still produces unreasonably high d N =d S estimates on some of the remaining simulations (bottom left plot in Fig. 2). Only when we remove d N =d S estimates that are above 10 000 do we arrive at reasonable (but now biased) relative errors for the FEL method. Although after this filtering, the FEL approach outperforms both the renaissance and REL methods, the FEL approach remains problematic because for some of the sites, it fails to provide reasonable d N =d S estimates in as many as 11 simulations (22% of all simulations). Fig. 1. Receiver operating characteristic curves comparing classification performance of renaissance counting (RC), DUAL REL and FEL methods in identifying sites under diversifying positive selection. The curves plot true and false positive rates as functions of varying test-statistics. P-values, Bayes factors and posterior quantiles were used for FEL (blue line), DUAL REL (red line) and RC (black line), respectively
