Motivation: Metagenomics is the study of genetic material recovered directly from environmental samples. Taxonomic and functional differences between metagenomic samples can highlight the influence of ecological factors on patterns of microbial life in a wide range of habitats. Statistical hypothesis tests can help us distinguish ecological influences from sampling artifacts, but knowledge of only the P-value from a statistical hypothesis test is insufficient to make inferences about biological relevance. Current reporting practices for pairwise comparative metagenomics are inadequate, and better tools are needed for comparative metagenomic analysis. Results: We have developed a new software package, STAMP, for comparative metagenomics that supports best practices in analysis and reporting. Examination of a pair of iron mine metagenomes demonstrates that deeper biological insights can be gained using statistical techniques available in our software. An analysis of the functional potential of 'Candidatus Accumulibacter phosphatis' in two enhanced biological phosphorus removal metagenomes identified several subsystems that differ between the A.phosphatis stains in these related communities, including phosphate metabolism, secretion and metal transport. Availability: Python source code and binaries are freely available from our website at
INTRODUCTIONWith its focus on ecologically relevant assemblages of microorganisms, metagenomicsthe assessment of randomly collected DNA fragments from a microbial communityhas revealed a new world of microbial diversity and complexity. Metagenomic studies can be motivated by several goals, including the discovery of novel genes of interest (), validation of metabolic hypotheses (), profiling of the relationship between microbial community composition and variation in environmental * To whom correspondence should be addressed. or geographic parameters () and assessment and comparison of the global metabolic complement found in one or more habitats (). Detailed assessment of communities requires intensive sequencing effort and careful experimental design to ensure that experimental questions can be adequately addressed (). A common outcome of a metagenome project is a set of functional predictions for the collected and assembled DNA reads, assigned via homology search and classified using a scheme such as the SEED () or KEGG (). When multiple samples are collected, functional classes can be organized into contingency tables that allow the assessment of statistically significant differences in the relative abundance of these classes. For example,sampled communities from an oxidized and anoxic environment within the Soudan iron mines and found evidence that these two communities preferentially utilize different respiratory pathways. Several dedicated bioinformatics applications have been developed for the statistical analysis of metagenome pairs, including XIPE-TOTEC (), ShotgunFunctionalizeR () and MEGAN (). Packages focusing on the complementary problems of assessing differences between groups of metagenomes have also been developed (). While such comparisons are informative, it is vital to distinguish results that are biologically relevant (i.e. truly different in frequency between two or more sites, due to some underlying taxonomic or ecological phenomenon) from those that are merely statistically significant. Statistical significance is neither a necessary nor a sufficient criterion for biological relevance () but is typically used as a filter to remove uninteresting features where the observed difference can reasonably be attributed to being a sampling artifact. Reasoning about the biological relevance of a feature requires consideration of effect sizes and their associated confidence intervals. Interpretation of statistical results can also benefit from transforming raw P-values to alternative measures with possibly superior interpretations () and by allowing interactive filtering that permits focusing on features with specific statistical properties. Here, we present a discussion of the key statistical concerns in metagenomic data analysis and introduce a new application, STAMP (STatistical Analysis of Metagenomic Profiles), which provides a user-friendly graphical environment for performing the statistical techniques discussed in this article.
METHODS
Input dataThe statistical methods and software discussed here can be applied to any count data obtained from a pair of metagenomic samples. Typically, we are interested in a collection of related features which define a profile (e.g. a functional profile indicating the number of sequences assigned to different biological subsystems or pathways). The statistical assessment of a particular feature can be carried out using a contingency table as shown inFor hierarchical classification schemes, such as a taxonomy or the SEED functional assignments (), we can also investigate the number of sequences within a feature relative to the total number of sequences assigned to a parental category in the hierarchy. In this case, the column sums express the number of sequences assigned to the parental category rather than the total number of sequences in the sample.
Statistical hypothesis testsThe P-value produced by a statistical hypothesis test indicates the probability of an observed difference occurring simply by chance. Features in a profile with P-values below a nominally chosen threshold (e.g. 0.05) are termed statistically significant and can reasonably be assumed to be enriched in one of the metagenomes due to ecological or taxonomic differences as opposed to being the result of a sampling artifact. Rodriguezrecently addressed the need to assess statistical significance by introducing a non-parametric, bootstrap test, XIPE-TOTEC. This test has been applied in several recent studies (). XIPE-TOTEC builds a null distribution for a given feature by drawing sequences randomly with replacement from a set consisting of all sequences from the two metagenomes. Two samples of M sequences are drawn from this pooled set, and the difference in the number of sequences from the feature of interest used as a test statistic. This process is repeated multiple times in order to estimate the null distribution accurately. The difficulty with this approach is that M is a free parameter. Increasing M reduces the width of the null distribution which in turn increases the number of features identified as being significant (Supplementary). A similar approach with the same requirement was recently proposed by. To assess the probability of any observed difference being a sampling artifact, we must consider the number of sequences originally obtained from each sample (i.e. C 1 and C 2 ). Several 'classical' tests meet this requirement and can be classified according to whether they assume sampling with or without replacement. Although these tests aim to produce the same results, in practice there can be considerable variation in the P-values they produce (Supplementary Tables S2, S3 and S4).
Sampling without replacementMonte Carlo permutation tests are a widely used non-parametric technique for modeling the distribution of a test statistic under a given null hypothesisfor a comprehensive treatment]. The null distribution is approximated by calculating values of the test statistic under a sufficiently large number of random permutations of the sample labels. A P-value can then be calculated as the proportion of this approximate null distribution that is equal to or more extreme than the observed data. To exactly model the null distribution, all possible permutations must be considered. A permutation of the sequences within a pair of metagenomic samples can be viewed as drawing sequences without replacement from a finite population consisting of two types of sequences (i.e. those from the current feature of interest and those from other features). This is the definition of a hypergeometric distribution. Fisher's exact test uses this distribution to efficiently calculate the exact P-value without having to exhaustively enumerate all permutations (). The chi-square test and G-test are well-known large sample approximations to Fisher's exact test (). Although these approximations are accurate for equal sample sizes, for unequal sample sizes they can produce P-values substantially smaller than those given by Fisher's exact test (Supplementary Tables S2S4). Yates' continuity correction is often recommended for these approximation methods and has the benefit of making them conservative at the expense of being less accurate (Supplementary Tables S2S4). For contingency tables with 'small' entries, traditionally defined as 5 or 10, these approximations are not recommended (Supplementary;) and have been shown to produce unsatisfactory results under a range of other conditions (Agresti, 1992 and references within). The execution time of Fisher's exact test calculated under the commonly used 'minimum likelihood' methodology (Supplementary) is a linear function of the number of sequences assigned to a feature in either sample (i.e. R 1 ). Our implementation of this approach takes 1 s to compute when the number of sequences assigned to a feature is 10 000 (Supplementary). As such, we recommend Fisher's exact test be used instead of a large sample approximation test because metagenomic profiles rarely contain features with more than a few thousand sequences, typically of unequal size and often have many features resulting in 'small' table entries.also recommended the use of Fisher's exact test after performing a similar analysis of potential hypothesis tests for the enrichment or depletion of gene ontology (GO) categories.
Sampling with replacementThe most appropriate method for calculating exact P-values for 2  2 contingency tables has long been debated (). Opponents of Fisher's exact test argue that the supposition of fixed row and column totals causes the test to be overly conservative (). From the perspective of metagenomics, this amounts to assuming that if we resample our two communities, we would obtain the same number of sequences from each community as in our original dataset (i.e. C 1 and C 2 are fixed) and that the total number of sequences assigned to a feature across the two samples would be unchanged (i.e. R 1 is fixed). We can relax fixing the row totals by performing a bootstrap test, where random samples are generated by sampling with replacement as in the method proposed by Rodriguez. Under this model, we assume that the number of sequences drawn for our two samples always remains the same, but the number of sequences assigned to each feature is free to vary. Drawing sequences with replacement from a finite population consisting of two types of sequences gives rise to the binomial distribution. For large sample sizes, we can approximate these binomial distributions as normal distributions, N 1 and N 2. The normal distribution that results from the difference between N 1 and N 2 forms the basis for the well-known 'difference between proportions' z-test. Despite the stark difference in their formulation, this test is equivalent to the chi-square test () and shares its limitations. To exactly model the null distribution, when sampling with replacement, requires knowledge of the true proportion of sequences assigned to a feature, p, within the two microbial populations being considered. The bootstrap test estimates this population parameter as the proportion of sequences Page: 717 715721
Biological differences between metagenomic communitiesRP is often referred to as relative risk. sampled from the feature of interest (i.e. p hat = R 1 /N). Alternatively, an exact test can be performed by setting p hat to the value that maximizes our Pvalue as suggested by Barnard (1947). Unfortunately, such an approach is computationally prohibitive even for modest sample sizes despite efforts to optimize the method (). As the bootstrap test relies on an estimate of p, it is not an exact test, and when this estimate is poor can produce P-values that are extremely liberal compared with Barnard's or Fisher's exact test (Supplementary). Given that Barnard's test is computationally prohibitive for the majority of features in a typical metagenomic profile, we must decide between an approximation to Barnard's exact test (e.g. bootstrapping) and Fisher's exact test. Our recommendation is to use Fisher's exact test as it is generally conservative compared with Barnard's exact test (Supplementary;), computationally tractable for metagenomic profiles and familiar to the majority of researchers.
Effect sizeTo assess if a feature is of biological relevance, we must consider the magnitude of the observed difference (i.e. an effect size statistic). An arbitrarily small effect can be statistically significant if the sample sizes are sufficiently large (Supplementary), so biological significance must be supported by effect size statistics as well as P-values. Three common effect size statistics are given in(). The most intuitive statistic is the difference in proportions (DPs) of sequences assigned to a given feature in the two samples. Interpreting the ratio of proportions (RPs) is also natural and provides complementary information to the DP. Consideration of multiple effect size statistics is often essential while assessing biological relevance as features can have a small (large) DP, but a large (small) RP. The odds ratio (OR) is widely used and has many desirable mathematical properties (). However, it is often criticized as being difficult to interpret () and we recommend that the RP be preferred to the OR while interpreting and reporting results.
Confidence intervalsA confidence interval (CI) indicates the range of effect size values that have a specified probability of being compatible with the observed data. For example, a 95% CI gives a lower and upper bound in which the true effect size will be contained 19 times out of 20. Knowledge of these bounds is often an important aid in assessing biological relevance. Despite this, we are unaware of any comparative metagenomic studies that report effect size CIs (Supplementary). There is a close relationship between P-values and CIs. A P-value indicates the probability of observing a given contingency table under the assumption that samples come from identical microbial communities. CIs make no such assumption. As such, a CI that encompasses the 'identity' effect size (e.g. DP = 0 or RP = OR = 1) will have a P-value >1 minus the coverage of the CI (i.e. a P-value 0.05 for a 95% CI). If the 'identity' effect size is outside the CI, the P-value will be <1 minus the coverage of the CI. CIs are more informative than P-values, and many proponents of CIs have suggested they make P-values unnecessary (). Nonetheless, P-values are a useful summary statistic and provide a natural way to rank and filter results when multiple hypothesis tests are performed. CIs can vary considerably with sample size (Supplementary; features 1a and 2a). Critically, CIs provide us with a mean to infer the biological relevance of a feature even when it is marginally statistically significant; features 1c and 2c demonstrate that the difference between a statistically significant and non-significant feature can be minimal in terms of effect size and CI bounds. The CI for example 2c indicates that an effect size of 0 is just as likely as the 'counter-null hypothesis' of a true difference between proportions of 8.5% (). This cautions us against making dichotomous decisions about biological relevance based solely on how a P-value compares with a nominal level of significance (i.e. 0.05). Inferring biological relevance is best done in the context of all available information, much of which does not lend itself to numerical analysis of a univariate response, such as the P-value.
Multiple test correctionA typical metagenomic profile consists of several hundred features. When performing multiple hypothesis tests, it is useful to modify the P-values so that they reflect a particular interpretation. For example, if a profile contains 100 features, the number of features with a P-value <0.05 due to chance variation will in general be 5. If we wish to examine a list of features where the probability of observing one or more false positive is less than a specified probability, we can use a correction method that directly controls the family-wise error rate (FWER). Commonly applied FWER methods include Bonferroni, Holm-Bonferrnoi and idk (). Alternatively, during exploratory analysis, we may be willing to accept a specific percentage of false positives. This can be achieved using the BenjaminiHochberg false discovery rate (FDR) procedure () or the Storey FDR approach (). These approaches calculate a q-value for each feature, indicating the expected proportion of false positives within the set of features with a smaller q-value. These approaches complement each other while performing an exploratory analysis. The list of significant features obtained when no multiple test correction method is applied gives us an initial global look at those features which may be differentially abundant between our samples. An FDR approach can be used to refine this initial list and makes the number of expected false positives explicit. Finally, an FWER technique can be applied to focus our attention to only those features where the observed enrichment or depletion is highly unlikely to be a sampling artifact.
IMPLEMENTATIONHere, we introduce our open source software package for performing STatistical Analyses of Metagenomic Profiles (STAMP). Our software provides a user-friendly graphical interface to allow for the easy adoption of the statistical methods discussed in this article.
Implementation detailsSTAMP is implemented in Python (http://www.python.org) and can be executed on all major platforms.
Input dataSTAMP can read the functional and taxonomic profiles produced by MG-RAST () and all of the 'abundance profiles' available at IMG/M (). Custom profiles can be specified in an accessible tab-separated values file format. We are currently developing other parsers for popular community resources such as the nave Bayesian rRNA classifier at RDP ().
Statistical hypothesis testsWe provide an optimized implementation of Fisher's exact test. Although Fisher's exact test is preferred to asymptotic approximations, we have provided implementations of the chi-square and G-test (with and without Yates' continuity correction) for completeness. Based on the discussion in Section 2.2.2, some users may favor using the non-parametric bootstrap test. We also provide an Page: 718 715721
D.H.Parks and R.G.Beiko
Effect size and confidence intervalsAll the effect size statistics inare available within STAMP. CIs for the DP statistic can be constructed using either a standard asymptotic approach, an asymptotic approach with continuity correction, or the NewcombeWilson method (Supplementary;). Standard asymptotic CI approaches are implemented for the RP and OR statistics as these perform well even on tables with small entries (Supplementary;). STAMP also provides a Monte Carlo simulation framework for evaluating the accuracy of a CI method on a particular dataset.
Multiple hypothesis test correctionThe FWER and FDR methods discussed in Section 2.5 are available within STAMP. Storey's FDR approach is based on the bootstrapping approach discussed in
Filtering of featuresFeatures can be filtered based on the number of sequences assigned to each sample or parental category, their observed effect size and their associated P-value. Specific subsets of features can be selected (e.g. all subsystems involved in respiration) and filtering optionally applied to them.
PlotsNumerous publication-quality plots can be produced using STAMP. Bar and scatter plots, indicating the relative frequency of all features, permit an initial exploratory analysis of metagenomic profiles (e.g. Supplementary Figs S7 and S8). Extended error bar plots (e.g.
Extensible architectureSTAMP uses a plug-in architecture in order to allow new statistical hypothesis tests, effect size statistics, CI methods, multiple comparison procedures or plots to be easily incorporated into the software.
Command-line interfaceA command-line interface is provided to facilitate batch processing or 'application linking' as recommended by Kumar and Dudley (2007).
Comparing multiple metagenomesSeveral recent studies have used XIPE-TOTEC to compare multiple metagenomes by performing pairwise tests between all possible pairs of metagenomes (). Such analyses can be performed using the STAMP command-line interface in a manner similar to XIPE-TOTEC or interactively through STAMP's graphical interface. We are currently extending STAMP with additional plots and exploratory tools specifically focused on multiple pairwise tests.
Comparison with available softwareHere and in Supplementary Table S9, we summarize the differences among STAMP, XIPE-TOTEC (), ShotgunFunctionalizeR (), MEGAN () and IMG/M (). XIPE-TOTEC reports only statistically significant features without indicating their calculated P-value. ShotgunFunctionalizeR runs within the R statistical computing environment (http://www.r-project.org) and provides statistical tests for comparing groups consisting of multiple metagenomes. MEGAN is a cross-platform tool with a graphical interface that focuses primarily on taxonomic profiles. The taxonomic hierarchy is displayed as a tree structure, and statistical results are textually and graphically reported for each node in the hierarchy. IMG/M is a web portal that provides a number of tools for comparative metagenomics, including pairwise statistical hypothesis testing. Notably, none of these software packages reports effect sizes or CIs.
Page: 719 715721
Biological differences between metagenomic communities
RESULTS
Soudan iron mine metagenomesTwo samples from distinct habitats within the Soudan Iron Mine in Minnesota, USA, were sequenced and analyzed by. The 'black' sample (pH 6.7, redox potential-142 mV) was taken from water within a borehole, and the 'red' sample (pH 4.37, redox potential-8 mV) was taken a few centimeters from the mouth of a borehole where oxygen in the passageway has significantly reduced the pH and redox potential of the bore water. Functional profiles for these samples were obtained byby comparing the unassembled reads obtained from pyrosequencing against the SEED database (Supplementary Methods). Here, we contrast the statistical results reported byusing XIPE-TOTEC to those obtained using the statistical techniques provided in STAMP. Fisher's exact test identifies 11% fewer statistically significant subsystems than XIPE-TOTEC v2.4 with replicate sample sizes of M = 5000 (). This replicate sample size was used in, presumably as a compromise between the size of the two profiles that contain 2319 and 13 221 sequences in the 'black' and 'red' communities, respectively.report only 69 statistically significant subsystems as it appears manual editing of subsystems containing few assigned sequences was performed. Using the filters provided in STAMP, we determined that 15% of the statistically significant subsystems identified by Fisher's exact test have fewer than five sequences assigned to them from each sample (26% have 10 sequences or less). Performing additional filtering with liberal absolute (DP  0.5%) and relative (RP 2) effect size requirements gives a list of 71 subsystems with sufficient statistical support to warrant further consideration of their biological relevance. Applying Storey's FDR approach with a q-value threshold of 0.05 reduces this list to 60 subsystems and makes it explicit that we should expect three of these to be false positives. Supplementaryindicates the number of sequences in each of these60 subsystems along with their effect size, CI and q-value. Further investigation into the biological relevance of these subsystems will benefit from considering this information. The metabolic analysis performed infocused on the 'respiratory' and 'iron uptake and utilization' metabolic classes. Our analysis supports the hypothesis that the 'red' aerobic and 'black' anaerobic communities predominantly utilize different respiratory pathways (and Supplementary).also proposed that the 'black' community has a greater abundance of genes involved in iron uptake and utilization because ferric iron (Fe 3+ ) is limited in this community compared with the 'red' sample. Although this hypothesis is supported by the number of different subsystems that are overrepresented in the 'black' community (and Supplementary), caution is warranted as the number of sequences assigned to these subsystems is extremely small. Contrasting Figures 1 (Supplementary) and 2 (Supplementary) illustrate the benefit of reporting effect sizes and CIs. We should have more confidence in assigning biological Page: 720 715721
D.H.Parks and R.G.Beikorelevance to subsystems such as 'NiFe hydrogenase maturation', which has a large DP and RP than to a subsystem such as 'ABC transporter ferrichrome' where the DP is small and the RP may be relatively small as indicated by the CI for this feature. In broader terms, the evidence for ecological differences causing preferential utilization of alternate respiratory pathways in these communities is far stronger than the evidence for differing concentrations of Fe 3+ driving an overrepresentation of iron update and utilization genes.
Accumulibacter phosphatis strains in enhanced biological phosphorus removal metagenomesEnhanced biological phosphorus removal (EBPR) is a treatment process in which micro-organisms are employed to remove excessive inorganic phosphate from wastewater which, if left untreated, would result in eutrophication of outfall ecosystems. Although the economic and environmental benefits of EBPR have led to its global adoption in waste water treatment plants (WWTP), the performance of these systems varies over time and location for reasons that are still poorly understood due to an incomplete understanding of EBPR microbiology. Here, we compare the functional profiles of A.phoshatis strains, the dominant EBPR phosphate-accumulating organisms, from two lab-scale WWTP in Australia and the US (). The A.phosphatis genes from these two communities were assigned to 26 functional classes (Supplementary) that contain a total of 491 SEED subsystems (Supplementary). Of these, 142 (29%) were assigned fewer than 10 sequences from either sample and were not considered further. The number of statistically significant features (P-value  0.05) identified using Fisher's exact test was 116 (33%) and varied between 107 and 120 for the other statistical hypothesis tests considered (Supplementary). Application of Storey's FDR and the Bonferroni's FWER approaches reduces this to a list of 77 (22%) and 22 (6%) features, respectively (Supplementary). Those features identified as statistically significant after applying the Bonferroni correction are given in. While 'phosphate metabolism' is significantly overrepresented in the US community, it is not clear that this overrepresentation is related to the key polyphosphate metabolism processes in the EBPR community. Within this group, apolipoprotein N-acyltransferases showed the strongest overrepresentation in the US sample (P = 8.15  10 4 ). Other important systems include 'general secretion pathway', which covers a wide range of putative functions including exopolysaccharide biosynthesis and type II (including pilus assembly) and III secretion systems. Several categories of transport proteins related to metals were identified in each of the two samples; metadata about metal ion concentrations in these systems could reveal links between toxic metals and the systems needed to detoxify or exclude them. Overrepresentation of mobile elements (Tn552) and phage-associated proteins (CBSS-159087.4.peg.2189) may indicate endemic strains of phage and mobile elements ().
DISCUSSIONIt is essential to consider potential sources of error and how they can influence the results of statistical techniques when making inferences about biological relevance. Comparative metagenomics relies heavily on a 'guilt by association' paradigm where the function or taxonomic origin of reads is assigned according to similarity with sequencing from a reference databases. This leads to four notable sources of error in metagenomic profiles: (i) assuming sequence similarity implies functional similarity, (ii) database bias favoring certain functional subsystems or taxonomic units, (iii) misannotations resulting in reads being incorrectly associated with a specific functional or taxonomic category and (iv) reads with no reliable match in a database being effectively discarded. Investigating the seriousness of these sources of errors is an active area of research (). Knowledge of effect size, CI width and number of sequences assigned to a feature is essential when deciding if these sources of error have the potential to explain the observed enrichment or depletion of a statistically significant subsystem or taxonomic unit. For statistical techniques to aid biological inference, they must be interpreted and reported correctly. STAMP provides a graphical environment for performing statistical analyses and interactively exploring results through publication quality plots with sufficient information to inferring biological relevance. These capabilities make STAMP a valuable tool that will aid researchers in interpreting and communicating the results of their statistical analyses.
at :: on August 31, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
