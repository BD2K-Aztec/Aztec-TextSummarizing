Motivation: A basic problem of broad public and scientific interest is to use the DNA of an individual to infer the genomic ancestries of the parents. In particular, we are often interested in the fraction of each parent's genome that comes from specific ancestries (e.g. European, African, Native American, etc). This has many applications ranging from understanding the inheritance of ancestry-related risks and traits to quantifying human assortative mating patterns. Results: We model the problem of parental genomic ancestry inference as a pooled semi-Markov process. We develop a general mathematical framework for pooled semi-Markov processes and construct efficient inference algorithms for these models. Applying our inference algorithm to genotype data from 231 Mexican trios and 258 Puerto Rican trios where we have the true genomic ancestry of each parent, we demonstrate that our method accurately infers parameters of the semi-Markov processes and parents' genomic ancestries. We additionally validated the method on simulations. Our model of pooled semi-Markov process and inference algorithms may be of independent interest in other settings in genomics and machine learning.
IntroductionRecent developments in DNA technology bring personal genomics to reality. This opens up unprecedented possibilities for individuals to learn about their genomic history (e.g. ancestry, family history) as well as their genomic future (e.g. disease risk). A particular aspect of personal genomics that has garnered significant public and medical interest is the ability to precisely quantify the ancestry composition of one's genome (). Consider a Mexican individual as an example. Her genome consists of alternating blocks of DNA sequences, where each block has African, European or Native American ancestry. The length and frequency distributions of blocks from different ancestries reflect the patterns of admixtures over the last several centuries. A substantial fraction of humans today are offsprings of historical mixing between distinct populations and their genomes are such mosaics of ancestry blocks (). The ability to quantify genomic ancestries has important biomedical implications. For example, African ancestry is a risk factor for asthma. This partially explains the high prevalence of asthma inAfrican American as well as Puerto Ricans with larger African genomic ancestry (). In addition, genomic ancestry gives insights into many social science questions, and expands the common notions of ethnicity and race (). Given the genome of an individual, recent machine learning methods can accurately determine the fraction of this person's genome that originates from each ancestry (). However, for many applications in biomedical and social science research, it is important to go beyond the individual's ancestry and to infer the genomic ancestries of the parents (since most genetic datasets do not have genotype information from the parents). In studies of ancestry linked risk factors, genomic ancestry information of parents can be used to investigate how risks propagate through generations. In social science applications, parental genomic ancestry can be used to understand genetic basis of human mate selection, a subject of substantial recent interest. Latino parents, e.g. were shown to have significant correlations in their genomic ancestries ().
i190This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (http://creativecommons.org/licenses/by-nc/4.0/), which permits non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited. For commercial re-use, please contact journals.permissions@oup.comHowever, current methods cannot be used to infer the genomic ancestry of each of the two parents of an individual given only the DNA of the individual. Inferring parental genomic ancestry is challenging since the observed DNA are unordered pools of the DNA from the two parents. We show that this problem of parental genomic ancestry inference can be well modeled as a pooled semiMarkov process. To the best of our knowledge, this is the first method that can accurately infer the parameters of the parental ancestries in admixed populations. We applied the efficient algorithms we have developed for pooled semi-Markov process to infer parental ancestry. On experimental data from 231 Mexican families and 258 Puerto Rican families for whom we know the true genomic ancestry of each parent, we show that our method provides accurate estimates of parental genomic ancestry. Our method applies to any common genotyping data from an individual; importantly, no family or phasing information is needed, and hence it is broadly applicable to existing genetic data. Although in this article, we focus on the application of inferring genomic ancestry, we believe that many other settings can also be modeled as pooled semi-Markov process. For example in a tumor sample, there are many clonal subpopulations of cells, each with its own copy number aberrations which can be modeled as a semiMarkov process (). When we sequence the tumor in clinics, we typically obtain a pooled collection of reads from the various subpopulations.
ContributionsOur main contributions are: 1. We set up the mathematical framework of pooled semi-Markov processes and construct efficient, scalable inference algorithms. 2. Using this framework of pooled semi-Markov processes, we develop a method to infer the parameters of the parental ancestries in admixed populations. This is important because it allows for a better understanding of how certain disease risks are associated with ancestries. 3. We demonstrate the accuracy of our method on a real genotype dataset of 489 families where we can measure the true genomic ancestry of each parent. We further validate it using simulations.
Related workSemi-Markov models have been well studied in literature and have many applications ranging from economics to biology (). A related class of models for sequential data is factorial HMMs (FHMMs) (). FHMMs model outputs that are function of several hidden states where each hidden state evolves according to an independent Markov model. Because exact inference in FHMMs is intractable, a number of approximate inference procedures have been developed. The pooled semi-Markov process differs from FHMM in significant ways. First, the holding time in each HMM state is geometrically distributed, while we allow for arbitrary distributions. Second, the pooling model introduces hard combinatorial constraints that make standard variational inference inapplicable. There is a large body of work on the inference of local ancestry in admixed populations, in which the ancestry of each position in the genome is inferred. These methods typically use hidden Markov chain models, (e.g.) variants such as switch HMMs () and factorial HMMs (). Principal component analysis (PCA) has been shown to correlate well with global ancestry, and variants of PCA have been proposed (). In the case of AfricanAmericans, these models have been applied to show that AfricanAmericans today are an admixture of African and European ancestries in the ratio 0.8:0.2 over the last 610 generations (). Further, it has been shown that local ancestry can be accurately inferred in African-Americans. A limitation of these approaches is that they do not distinguish between the maternal and the paternal contributions to the genetic ancestry. Methods, such as Hapmix (), estimate the unordered pair of local ancestry states at each position but do not assign the local ancestry to each parental haplotype and hence do not tell us the genomic ancestries of each parent.
Methods
Pooled semi-Markov processesA semi-Markov process generalizes continuous time Markov process to settings where the holding time in a state may not be exponentially distributed. We recall the generative procedure for sampling from a semi-Markov process of K states. Definition: Let f denote the probability density function of a random variable parametrized by k (k could represent either a scalar or a vector depending on the form of the density function). To sample from a K-state semi-Markov process parametrized by, we do the following: 1. i 1. 2. Sample the state of the first block, / 1 $ Discretefa k g. 3. Sample the length of the first block,, where L is a specified length: @BULLET i i  1 @BULLET Sample the state of block i,@BULLET Sample the length of block i, L i $ f k / i .We call f k k  the holding distribution of state k and a jump is a transition between two consecutive blocks. For our applications it is sufficient to work with this parametrization of the transitions using a k 's. All results can be extended to general semi-Markov process. The output sample is a chain of length L composed of blocks of distinct states. For the last block, we cut it off so that it stops at L. For x 2 0; L, we denote by /x the state of the block that x belongs to, i.e. /x  / i if x is in block i. If f is the exponential distribution, then the corresponding semi-Markov process is equivalent to a continuous time Markov chain. For state k, the holding time is the time spent in that state and is an exponentially distributed random variable with rate k k. If we observe the states /x for an individual semiMarkov process and L is sufficiently long, then it is straightforward to perform maximum likelihood inference of the parameters fk k ; a k g. In genetics and other applications however, we do not observe each individual process but a pool of multiple semiMarkov processes where the identity of which process a given state is from is lost. Definition:Suppose we have M independent semi-Markov processes, each of length L. The j-th process is parametrized byand the state of the j-th process in position x is denoted by / j x. The pooled semi-Markov process (abbreviated as PSMP) is obtained by the assignment of each x 2 0; L to the K-dimensional vector of counts, Ux, such that the k-th entry is number of. We focus on continuous holding distributions f such that with probability 1 each process has a finite number of jumps in 0; L. Let N denote the sum of the number of jumps across all M processes. Then the continuous observations of the pooled semi-Markov process can be concisely described by the finite set X  fU i ; L i g N i1 , where U i is the counts vector observed at the i-th block across the M processes, and L i is the length of this block. Note that for continuous distributions, the probability that two blocks of two different semi-Markov chains end at the same point x is zero, thus with probability one U i and U i1 differ by one transition. When it is clear from context, we also use the equivalent representationUnder a pooled semi-Markov process, the likelihood of the parameters H iswhere e/ j x is the unit vector with 1 in the / j x th entry and dP/ j  is the measure induced by the jth semi-Markov process. In the above integral, the set of hard constraints 1 X M j1 e/ j x  Ux; 8x 2 0; L h i are finite (there being a single constraint for each of the N blocks). Nevertheless, these constraints make it intractable to exactly compute the likelihood in general. We develop efficient approximations below.
Example:An application of the pooled semi-Markov process naturally arises in the field of population genetics. The diploid genome of an individual consists of one transmitted genome from each parent (the two segments in). The transmitted genome of each parent is a sequence of intervals, where each interval has a different genomic ancestry(E)uropean, (A)frican, (N)ative American, etc. For example, if the mother is African American, then the genome that she passes on to the offspring is a mosaic of blocks of state A of some length distribution and state E of a possibly a different length distribution, and similarly for the father. Hence the genome passed from the mother to the offspring is well-modeled by a semi-Markov process (). When we genotype the offspring, say the one in, we can infer that first region has ancestry AA and the second region has ancestry EA (using method described in the next section); however, we do not know whether the E part come from parent 1 or parent 2, and thus the information about the parents' ancestry is lost. Given the pooled observations of the ancestries (e.g. AA, AE, EE) at every point in the genome, the goal is to infer the parameters fk j k ; a j k g K k1 for both parents. The k's parametrizes the length distribution of each ancestry state in a parent and the a's capture the frequency of the ancestry states. With estimates for these parameters, we can infer the global ancestry of each parent, i.e. the fraction of the individual's genome that is European, Native American or African, as well as the number of generations since the admixture.
Algorithms for inferenceWe first consider the parameter estimation problem for pooled semiMarkov processes with exponential holding distributions (which are equivalent to continuous time Markov processes). Exponential holding distribution captures many of the genetic datasets of interests and can often be used as a reasonable approximation to other more complex distributions. We treat this problem in a Bayesian setting in which we place a prior on the parameter vector H fk j k ; a j k g j1;:::;M k1;:::K and for a given observation X fU i ; L i g N i1 , we compute the posterior probability Pr HjX. We approximate the posterior using a Markov chain Monte Carlo (MCMC). To compute the likelihood as part of the MCMC, we developed a dynamic programming algorithm. In the next section, we show that this method gives accurate posterior estimates of the parameters of the model on genotype data from Mexican and Puerto Rican families. For the non-exponential case, the dynamic programming algorithm needs to keep track of all the possible lengths for which a block of ancestry extends. This becomes expensive when the number of blocks, N, is large. Hence, we develop a more general stochasticExpectation-Maximization (EM) algorithm to perform maximum likelihood inference on general pooled semi-Markov chains, as described in the next subsection. Note that there is an inherent symmetry in terms of which process we label as 1, 2, etc. that is not identifiable. Here we assume that the processes are labeled according to some arbitrary but fixed order, and the goal is to recover the parameters up to permutation of labels.
MCMC inference algorithm for pooled Markov processFor given observations X fU i ; L i g N i1 and parameters H fk j k ; a j k g j1;:::;M k1;:::;K , we use dynamic programming to compute the exact likelihood of the parameters, PXjH. For each i  1; :::; N, we keep track of all the distinct ordered states that are permutations of the observationFor example, if U i  fA; Eg, then the consistent ordered states are (A, E), where state A is generated by process 1, and (E, A), where state A is generated by process 2. Note that we denote ordered states by  and unordered states by fg. For a given unordered set U i , we denote by fpU i jp 2 S i g all the distinct ordered tuples that are consistent with U i. Here S i is the permutations of 1; :::; M that give rise to distinct tuples. For each pU i , let P i pU i jH be the probability of observing fU 1 ; :::; U i1 ; pU i g in a pooled Markov chain parametrized by H. In other words, this is the probability of seeing the unordered observation up to i  1 and then observing the ordered tuple pU i . There are in the worst case K M such P i pU i jH for each i. 1. For i  1, if the ordered state is pU 1   / 1 1 ; :::; / M 1 , thenwhere S i1 p are all the tuples that are one edit distance from p (since we know exactly one jump in one process has occurred between block i  1 and i almost surely) and consistent with U i1 , and p^ pU i1  ! pU i jH is the probability for transitioning from ^ pU i1  to pU i , which can be computed analytically as a product of exponentials and a j k 's.
Given all the probabilities, we use adaptive MCMC to compute the posterior distribution over H. The advantage of this approach is that we obtain full posterior distributions of H, and for several human populations, it gives accurate estimations (next section). A drawback is that computing the exact likelihood is expensive when the state space is large or when there are many chainsthe run time is OK M .
Stochastic EM inference algorithm for general pooled semi-Markov processFor general semi-Markov processes with non-exponential holding times, the dynamic programing would have to keep track of the last ordered state as well as its length, making it prohibitively expensive to compute the likelihood. We therefore propose a stochastic EM algorithm to perform parameter inference in general pooled semi-Markov processes. For each block i, the observation is the unordered set of states f/ i j g M j1
. Let Z be an M-by-N matrix whereZj; i 2 1; :::; M denote the process that generated the state / i j at block i. Z is the matrix of the latent variables.
E-stepGiven the current values of the parameters H and observations X, it is in general intractable to compute the posterior pZjX; H. However we can generate samples fZ s g from pZjX; H using an efficient sequential procedure using the expansionFor the base case, letsubject to the contraint that Z:; 1 is a permutation of 1; :::; M. This can be sampled efficiently using rejection sampling. The vector Z:; i is one edit distance from Z:; i  1, so that given Z:; i  1 there are at most KM-feasible values for Z:; i. If vector W differs from Z:; i  1 in index j, then pWjZ:; i  1; X; H can be computed as a function of the length of the current state for the j-th semi-Markov process and the a j k 's. Therefore we can explicitly compute the conditional probability of Z:; i given Z:; i  1 for all values of Z:; i. To sample Z:; i we just sample from these conditional probabilities.
M-stepGiven samples Z s of the latent variables, we compute the maximum likelihood H by maximizing Y s pX; Z s jH. Given Z, the parameters k j k and a j k are independent for different j 2 1; :::; M. For that r-th semi-Markov process, the optimization problem is arg max Y s pf/ j i s:t:Z s j; irg; fL i g j k r ; a r . For standard distributions, this optimization can be solved analytically. We iterate the E and M steps until convergence.
Results
Mexican and Puerto Rican triosWe used 231 Mexican mother-father-child trios and 258 Puerto Rican trios from the Genetics of Asthma in Latino Americans (GALA) study () For each trio, we have the genotypes of the two parents and the offspring across the entire genome. The trios were genotyped using the Affymetrix 6.0 GeneChip Array, which provides measurements of the genome at over 900 000 positions, called single nucleotide polymorphisms. Subjects were filtered based on call rates >95%, consistency between reported and genetic sex, and the absence of any unexpected identity by descent (IBD) or by state. Familial relationships were confirmed using measures of IBD and Mendelian inconsistencies. We used LAMP-LD, a commonly used method, to infer the local ancestry state at each position in the genome in each individual (). LAMP-LD uses a generative model in which the genome is divided into non-overlapping windows. An admixed genome is generated as an emission within each window from a HMM with K 2 states, where K is the number of ancestral populations.Transitions between the hidden states occur between adjacent windows. LAMP-LD computes a Viterbi decoding of the pairs of local ancestries along the genome. Since Puerto-Ricans and Mexicans have mixed ancestry with (E)uropean, (A)frican, and (N)ative American ancestries, LAMP-LD assigns to each position in the genome one of 6 states: EE, NN, AA, EA, EN and NA, depending on the ancestry of that position (e.g. NA corresponds to the case where one copy originated in Africa and the other in America). In these datasets, we observed that the genomes of each of the parents are well approximated by exponential length distribution and hence by a Markov process. The genome of the child can then be modeled as a pooled Markov process, with M  2 and K  3. Note that in general, the genomes of the parents themselves cannot be modeled as a Markov process but as a semi-Markov process (). However in these data the exponential distribution proved to be a good approximation, likely because admixture occurred many generations ago in these samples and have been continuing ever since. For the validation experiment, we take as input the observed local ancestry blocks of each offspring, and use the MCMC algorithm described earlier, with uniform priors, to infer the posterior distribution over the parameters of the model. In these data, the MCMC estimates are more accurate than estimates from the stochastic EM (not shown). There are six k parameters and four independent a parameters. The global European (or African, Native American) genomic ancestry of an individual is defined to be the proportion of the total genome that is identified to be of European (or African, Native American) descent. For each set of parameters, we infer the global ancestry proportion of the corresponding parent by running a Markov chain with these parameters to equilibrium and computing the fractions. Then we compare the inferred global genomic ancestry of each parent with the true genomic ancestry of the parent computed explicitly by running LAMP-LD. Genomes of Mexican samples contain primarily European (average of 43%) and Native American (49%) ancestries, and a small amount of African ancestry. In contrast, Puerto Ricans genomes contain mostly European (62%) and African (23%) ancestries,
Inferring parental genomic ancestries i193with a minor component of Native American. Moreover the two populations have distinct demographic histories leading to different statistical properties of their ancestries, corresponding to different distributions of k 0 s and a 0 s (). Hence these two datasets are complementary in exploring the performance of our approach under different conditions.contains the r 2 between our estimated genomic ancestries using PSMP and the true genomic ancestries in the 462 Mexican (MX) parents and 516 Puerto Rican (PR) parents. We report the r 2 for each of the ancestry states: European (E), Native American (N), African (A). In Mexican trios, our estimated proportions of European and Native American ancestries agree very well with the ground truth (coefficient of determination r 2  0.84 for both). It performs worse in estimating the African proportion, likely because African blocks are only observed a few times in most samples. In Puerto Rican trios, our estimates for the European and African ancestries closely match the ground truth. It performs worse for the less frequent Native American ancestry (Figs. 2 and 3). In addition to accurately estimating the global genomic ancestries of each parent, our method also infers finer grained information. In particular, since the holding distributions are exponential, 1=k gives the average block length of each ancestry type in a parent. From standard coalescent models of population genetics, these length scales inform us the number of generations since the interbreeding of these populations in the family history of that individual. We compare the inferred length scales for each parent and ancestry type with the ground truth measured on the transmitted allele. In Mexicans, there's strong correlation between length estimates from our method and the ground truth for European and Native American ancestries (r 2 of 0.73 and 0.75, respectively). The estimate is less accurate for the less frequent African block lengths (r 2  0.25). For Puerto Ricans, we find the strongest agreement in the block lengths of Africans (r 2  0.75), followed by Europeans (r 2  0.54) and Native Americans (r 2  0.45).
ScalabilityOur algorithms treat the samples independently and can be run in parallel on all the samples. For each human sample, it required 5 min on a standard desktop.
Comparison to benchmarksIn practice, it is often assumed that the genomic ancestry of the offspring is a good approximation of the ancestry of the parents. This only works if the genomic ancestries of the two parents are very similar, since the offspring's ancestry essentially averages the parents'. This assumption is especially problematic in admixed populations (Latinos, African Americans, etc.) where the two parents may have very different ancestries. We tested this assumption in our trios, where we use the empirically measured genomic ancestry of the offspring as estimations of the parents' ancestries. The correlation with the true genomic ancestries is reported in the second row of, and it is significantly worse than the results of the pooled semiMarkov process. For more heterogeneous populations, we expect the offspring to be even worse estimators of the parent's ancestry. The pooled semi-Markov process explicitly models the spatial correlation of nearby states. A simpler algorithm is to assume that all the observations are independent. The accuracy of this simpler model is reported in the third row of. It performs worsethan the pooled semi-Markov process in all the categories and is especially poor in Puerto Ricans.
Simulations
Random triosAs an additional validation, we tested our algorithm on simulated Mexican malefemaleoffspring trios. In the actual trios, using the genotype of the three individuals, we inferred the transmitted allele from each parent to the offspring. To generate a random trio, we then randomly selected a male and a female parent and computationally combined their transmitted alleles to form a new offspring. This creates realistic offspring genotypes while preserving the complex demography encoded in the parents' transmitted alleles. Using this process, we simulated 100 new trios for which we knew the true genomic ancestry of each individual. As before, we applied our method to the offspring data to infer the ancestries of the parents. Comparison of the inferred ancestries with the ground truth showed very good agreement (). For the European, Native American and African ancestries, we achieved r 2 of 0.9, 0.89 and 0.77, respectively.
Non-exponential chainsWe also investigated how well we can do inference on pooled semiMarkov processes where the distributions are very different from exponential, as these could be relevant for other demographic models and applications. We consider the particular case where the block lengths of each state are Gaussian distributed. We use the more general stochastic EM algorithm given above to perform inference. In the experiments, we varied K  2; :::; 6 and M  2; :::; 5. For each combination of K and M, we simulate 50 pools of semiMarkov processes. We consider unit variant Gaussians with mean k k. For each process, we sampled a uniformly from the K-dim simplex and sample k k uniformly from. Different processes in the same pool have different a's and k's. Each observed dataset is created by pooling M different Gaussian semi-Markov processes. To better match the quantity and noise of realistic genomic data, we use only the first N  500 blocks of the pooled semi-Markov process as observations. This is the input into our stochastic EM algorithm. To evaluate the estimation, we compute the r 2 between the estimated k's and the true k's and between the estimated and true a's, across all pools and all processes. The results are summarized inInferring parental genomic ancestries i195. For M  2, 3, we obtain accurate estimations for even large numbers of states, with r 2 > 0.8. The accuracy of inference declines as the number of processes in a pool increases. In these more complex models, we can improve our accuracy by collecting larger number of observations (N) from each pool ().
at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
Discussion We developed an efficient method to infer the genomic ancestry of the parents from the genotype of an offspring. We applied our method to genotype data of 231 Mexican and 258 Puerto Rican individuals to infer the parents' ancestries. We showed that the method is highly accurate by comparing the inferred ancestries with each parent's true genomic ancestries. We further validated the method on simulated trios. For pooled Markov processes, we showed how to compute likelihood exactly using dynamic programming. For general pooled semi-Markov processes, we developed a stochastic EM algorithm to infer the model parameters. We additionally validated accuracy of our inference algorithm in settings where the semi-Markov length distributions are Gaussians. We tested our algorithm on Latino trios, but it can be applied to other admixed populations and can be used to infer ancestries other than European, Native American and African. The method can be used on general genotype datasets of unrelated, unphased individuals, for which large cohorts exist, to infer the genomic ancestries of the parents. This has immediate applications in investigating assortative mating in human populations. The current approach assumes that the local ancestry of the offspring has been computed from his/her genotype. This is reasonable for large admixed populations such as Latinos and African Americans, where existing algorithms (e.g. LAMP-LD) can accurate infer the local ancestries. For other admixed populations, an interesting direction of future work is to jointly infer the local ancestry of the offspring and the global ancestries of the parents
