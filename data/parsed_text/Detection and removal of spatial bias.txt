Motivation: Multiplex readout assays are now increasingly being performed using microfluidic automation in multiwell format. For instance, the Library of Integrated Network-based Cellular Signatures (LINCS) has produced gene expression measurements for tens of thousands of distinct cell perturbations using a 384-well plate format. This dataset is by far the largest 384-well gene expression measurement assay ever performed. We investigated the gene expression profiles of a million samples from the LINCS dataset and found that the vast majority (96%) of the tested plates were affected by a significant 2D spatial bias. Results: Using a novel algorithm combining spatial autocorrelation detection and principal component analysis, we could remove most of the spatial bias from the LINCS dataset and show in parallel a dramatic improvement of similarity between biological replicates assayed in different plates. The proposed methodology is fully general and can be applied to any highly multiplexed assay performed in multiwell format.
IntroductionA revolution has occurred in the field of Quantitative Transcriptomics in the last 15 years, fueled by a significant drop in the cost of technologies for multiple gene expression profiling (). Such technologies, namely gene microarrays () and RNASeq (), are now standard procedures in biological and medical research, and they are becoming increasingly more popular as robust research and diagnostic tools in all biological fields, spanning from crop research () to drug discovery () and from microbiology () to personalized medicine (). Recently, both gene expression assays and other multiplexed readout assays have been implemented in a multiwell format (microplate), lending themselves to significant microfluidic automation and scale-up. This type of experiments lend themselves to detection and normalization of a variety of potential bias sources, including effects representing 2D spatial bias introduced by the specific microfluidics apparatus. For instance, multiplex gene expression has been recently used as a reporter for large-scale cell perturbation assays, allowing for the quantitative characterization of the corresponding perturbagens as inducers of specific transcriptional responses at the molecular level (molecular phenotypes). This new class of studies, named gene expression high throughput screening (GE-HTS), promise to have significant impact on biomedical research (), and have already shown their potential to accelerate drug discovery for V C The Author 2016. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com 1959doi: 10.1093/bioinformatics/btw092
Advance Access Publication Date: 28 February 2016 Original Paperhuman diseases, such as for leukemia () and muscle atrophy (). Detecting and correcting any systematic bias generated by such large-scale assays is obviously of paramount importance to maximize the value of these studies. Principal component analysis for bias removal has been applied successfully to increase the ability to increase power in eQTL identification (). Spatial biases in the probe intensity levels, commonly observed on oligonucleotide arrays, are removed by normalization techniques such as GC-RMA () or LOESS normalization (). The largest dataset of this kind to date, has been generated by the Library of Integrated Network-based Cellular Signatures (LINCS) effort (). It represents a direct extension of the Connectivity Map (CMAP), the first large-scale GE-HTS study (). LINCS adopted an innovative approach to measuring gene expression at an ultra-low cost, based on medium-throughput profiling of 978 Landmark (L1000) genes across a consistent number of perturbations and cell lines (). The rest of the transcriptome (20 000 genes) is then inferred by a mathematical model built on top of thousands of gene expression measurements from GEO (). The LINCS dataset collects roughly a million experiments where different cell types (primary and transformed human cell lines) are chemically (by small molecule compounds) and genetically (by shRNA knock-down or cDNA over-expression) perturbed (). The LINCS dataset was conducted on 384-well (24  16 format) microplates and is so far the biggest microplate-based experiment ever produced. As such, it offers an unprecedented opportunity to both detect and normalize bias introduced by the experimental setup.
Methods
LINCS datasetThe normalized LINCS dataset was obtained from the LINCS consortium (http://support.lincscloud.org). Specifically, the dataset analyzed in the current manuscript is composed of a total of 1894 microplates of which 963 are perturbed by targeted gene Knock-Downs (KD), 747 by Chemical/Pharmaceutical Compounds (CPC), and 184 by gene Over-Expression (OE). In total, the dataset we analyzed is composed of eight different cell lines (PC3, MCF7, VCAP, HT29, HA1E, A375, HCC515, and A549). The total number of different experiments included in the analysis was comprised of 685 612 gene expression profiles. Following the L1000 procedure (), a total of 978 genes have a direct measurement (landmark genes) while for 22 000 more genes the transcript amounts were inferred.
Bias detectionIn order to detect 2D spatial bias, we formulated the problem through a spatial autocorrelation framework. Spatial autocorrelation is a 2D space measure to assess how variables at neighboring locations in 2D space co-vary (). The most common way to measure spatial correlation is by calculating Moran's I (), which measures the correlation of signal amongst spatial neighbors (Equation 1):where N is the number of samples in an array (e.g. a microplate), each X is a variable (gene), X is the mean of X, and T ij (plate row i and plate column j) is the topology encoded as a weight matrix (i.e. which wells are neighbors). T ij is a symmetric N  N matrix with t ij 2 f0; 1g. t ij is 1 if well i is adjacent to well j and 0 otherwise. Like Pearson's correlation, the values for Moran's I can range from 1 (where the values of the variables are completely correlated to the values of their neighbors) to 1 (a checkerboard-like scenario, where every sample is inversely correlated to its neighbors).
Bias removalThe main assumption in the spatial bias removal is the redundancy of biases across multiple genes. With redundancy we specifically mean that a bias affects all genes with to a certain degree. The observed gene expression ^ e for a gene is composed of the true biological signal e and additive bias components. For a set of genes size G and well (i, j) on a given plate with a set of M biases w m i; j of W and the corresponding coefficient matrix C 2 G  M, the observed gene expression can be noted as:eg; i; j is the true biological gene expression in well (i, j) when all biases are removed from the observed gene expression. w m i; j 2 W is a function, representing a bias and W is the set of all biases that are defined over the coordinates of the plates. In our approach we specifically search for the bias functions in W that result in significant spatial autocorrelation. The coefficients c gm 2 C are defining the impact of the bias n on gene g. The coefficient c gm stays constant for gene g and bias m is not depended on well coordinate (i, j). A larger absolute coefficient represents a stronger effect of the bias on the gene expression. In return the coefficient indicates how much it contributes to the bias with respect to the other genes. For any of the bias functions we assume that multiple genes are contributing, resulting in non-zero coefficients for this bias. This redundancy is a key attribute of the biases, enabling the proposed solution of the problem. To account for spatial biases, we first decompose the expression data into the major orthogonal components of variance by Singular Value Decomposition (SVD) ():where X is the G-gene N-sample matrix (N  I  J, I rows and J columns of the plate) of expression values, D is a diagonal matrix with the positive singular values d 1 > d 2 >. .. > d r > 0 on its diagonal and 0 for all other entries, with r  minG; N, and U and V are the orthogonal left-and right-singular vectors, which represent the basis, eigensamples  genes and eigengenes  samples square matrices, respectively. We compute the principal components on of X t using the R function prcomp, resulting in PCs that are linear combinations of the genes in X. The output is C  UD 2 G  r, containing the scaled eigenvectors and a square N  r matrix V containing the principal component values. The columns of C contain the coefficients describing the linear combination of genes for the corresponding PC. The PC values in V are the expression values of the eigengenes. The original gene expression can be back transformed through X  CV t. Due to the redundancy assumption we expect to find eigengenes that describe bias functions of W. Each column of V represents a PC and the rows represent samples/wells of the plate. As such we calculate the Moran's I spatial autocorrelation for each column of V by mapping its values to the corresponding plate coordinate. If a principal component shows a significant spatial autocorrelation the PC represents a function of W as described above.The autocorrelation score is transformed into a weight determining how much the principal component should be removed from the data. The weight function is defined as Wx; r; b  1  1= 1  e bxr  for autocorrelation score x, b defining the climb of W and r for the function offset. r defines in what range the phase transition from 0 to 1 occurs and b how quickly (Supplementary). For the LINCS data we choose r that maximizes the average increase in RS for the three separate datasets KD, OE and CPC (see Supplementary Methods, Section 6). From V we compute vector ! w of length m by converting the autocorrelation scores x to weights by the weight function Wx; r; b  ! w. The higher the autocorrelation of the column in V the lower the weight applied to it. The function is sigmoidal and ranges from 0 to 1. Unbiased PCs will receive a weight of about 1. We compute the down-weighted PC value matrix V* from V by V* V  diag ! w  , with matrix diag ! w  of size m  m with vector ! w on the diagonal and 0 otherwise. We can build a new gene expression matrix X   CV t with matrix V  from which the biased principal components are removed. The procedure is shown in Supplementary Algorithm 2 and 3.
Reproducibility scoreThe LINCS data is organized in batches of replicate plates. There are 25 plates in each batch in which the cell line, plate layout and measurement time are identical. The LINCS data has no replicates on the same plate, instead the whole plate is replicated. The reproducibility score (RS) is a measure as to how similar replicates are across the plates of a batch compared to all other perturbations. Each well of a batch with N plates can be defined by i 2 fA;. .. ; Pg and j 2 f1;. .. ; 24g and plate index p; k 2 f1;. .. ; Ng. X is the z-score normalized gene expression matrix of all samples in the batch. Xijk is the sample on plate k at well (i, j). We define the unnormalized replicate score (RS*) as follows:To normalize RS  we build a null model for each individual sample of the batch. For this we select one sample from each of the other plates and re-compute the average correlation. We calculate a set of 1000 random RS values and fit a normal distribution Nl; r 2 . The normalized reproducibility score is calculated by RS  RS  =r. We define DRSX; X    RSX    RSX for uncorrected gene expression X and corrected gene expression X . Positive DRS mean increased and negative decreased in reproducibility.
Removal of random principal componentsWe developed a naive method or removing random PC from the data. For this, we apply the bias correction on all plates of all three datasets (KD, OE and CPC). The naive method calculates the principal component decomposition X  UDV t for each plate analog to our method. The singular values on the diagonal of D indicate the amount of variance encoded in the PCs. We iteratively set a diagonal entry of D to zero until we removed the same amount of variance from the plate as the bias removal resulting in D . As not the exact amount of variance can be removed unless we remove the same PCs we allow an error of 6 , for  0:005 of the total variance. Setting entries of D to zero is identical as setting a column of V to zero. X R  UD  V t is the residual gene expression and we can compute the reproducibility scores for all batches for X  and X R with varX    varX R =varX  =  .
Gene set enrichment analysisWe performed Gene Set Enrichment Analysis (GSEA, ()) between the values of each PC heavily affected by bias in the LINCS dataset (weight ! 0.5) and all Gene Ontology (GO) Biological Processes (), as provided by the MSigDB database (). P-values were corrected according to the Benjamini-Hochberg procedure (). The normalized enrichment scores of the GO terms were integrated using the Stouffer procedure (), and the 50 terms showing the highest integrated enrichment across the dataset are shown in
Results
Detection of spatial bias in gene expressionConsistent spatial bias affecting gene expression profiles was identified in 1825 out of 1894 (96%) of the tested microplates of the LINCS dataset, as evident from observing landmark gene expression profiles on a display structure that recreates the original microplate sample positioning (). We could detect apparent effects on gene expression that were dependent on the sample location on the microplate, which supports the hypothesis that cells in the microplate suffered from a non-controlled gradient of external perturbation. Since the visual inspection of gene expression profiles offered such a striking display of 2D bias, we measured its effects across the dataset in terms of spatial autocorrelation. The observed autocorrelation between samples in the LINCS dataset was significantly higher than expected (Wilcoxon test P < 2:2  10 16 ), indicating that the location of a sample on a microplate partially determines the detected transcript abundance of landmark genes (). This is evident in all the three experiment subsets (KD, OE, CPC). We then applied Principal Component Analysis (PCA) on the entire dataset and decomposed the gene expression into X  UDV t. We calculate the autocorrelation for the columns of V analogue to the gene spatial autocorrelation. We detected that most plates have Principal Components (PCs) with significant autocorrelation. 2445 PCs were detected with autocorrelation ! 0.5 (See Supplementary Methods for further details).
Bias correction improves reproducibility scoreWe applied the bias correction on all KD, OE and CPC plates and calculated RS before and after correction. Strict r values can almost entirely negate the bias from the transformed matrix (Supplementary); however, we noticed that this has a negative impact on the experimental quality of the corrected data in terms of agreement between biological replicates (Supplementary). The KD subset achieved the best results with a more stringent correction (r  0:15) than the other two subsets (r  0:35). We then applied these r values to each LINCS subset and used them to correct the entire data matrix to obtain a consistent reduction in spatial bias (). Globally, the dataset presented an average of 3.58 significantly biased PCs per plate with a weight ! 0.5 (i.e. removal of more than 50% of their contribution to gene expression). In terms of total variance, the autocorrelation bias accounted for 22% of the gene expression variability observed in the dataset. Removing spatial bias allowed us to significantly improve the agreement between replicated conditions between plates. Our procedure significantly improved the capability of clustering biological replicates located on different microplates (DRS mostly positive, Wilcoxon Test p  10 100 ). We observed the highest DRS in the KD subset (). Similar results were observed in the CPC Detection and removal of spatial biassubset (Supplementary) and in the OE subset (Supplementary), however with weaker effects, possibly due to these parts of the dataset generally being less responsive to perturbations (Supplementary). To test this hypothesis we compared the strength of KD and OE perturbation with DRS. CPC samples do not have a direct measure of perturbation effect. For knockdown samples we show that the fold change of target genes negatively correlates with RS while in OE the correlation is positive (Supplementary Materials). We used signature strength (absolute sum of z-score values of a sample) and correlated it with DRS. We could show a correlation between signature strength and DRS in all three datasets (Supplementary Materials). In total, 85% of the samples showing significant reproducibility before spatial bias removal (see Supplementary Materials) had improved RS when compared to the original expression matrix. In CPC, the average improvement is not as drastic as in the other two subsets with individual percentages of improved replicate scores at 89% for KD, 81% for OE, and 68% for CPC. Removing spatially biased variance, as proposed, thus clearly improves reproducibility; however, it could be argued that any method that reduces data variance may produce similar results. Therefore, we show that removal of random principal components has no positive systematic effect on the reproducibility score. Specifically, we applied a naive method based on the removal of non-statistically significant principal components from the dataset. The autocorrelation based). Grey wells marked with X are experiments for which no gene expression was available method significantly outperformed removal of equivalent amounts of variance from gene expression data using principal components, when tested for overall replicate agreement in the three datasets (KD, OE and CPC) (Supplementary, Supplementary Algorithm 4). The left three panels show the distribution of fractions # positive DRS/# DRS over all batches. In OE and CPC the random removal of PCs resulted in and average decrease of RS in all batches (fraction 0.5). In KD most batches also show a decrease in reproducibility after correction, with only few plates showing a fraction of ! 0.5.
Biased biological processesTo test whether the bias in gene expression affects enrichment analysis we apply GSEA () on the individual samples of a plate and calculate the autocorrelation of z-scores of each biological process in MsigDB. After correction the autocorrelation of enrichment scores is reduced in all three datasets. We calculate enrichment scores over the landmark gene signatures for all plates for 323 biological processes from MsigDB with at least 5 landmark genes and infer the autocorrelation score. Similar to the biases observed in individual genes biological processes are biased by plate location (Supplementary). Processes sorted by average autocorrelation score are shown in(for a full list see Supplementary). The processes are related to homeostasis and apoptosis suggesting that cells in different plate locations. Enrichment of two commonly biased biological processes for two example plates.  marked wells indicate significant up-regulation andsignificant down-regulation. The left shows enrichment z-scores for uncorrected and the right bias corrected plates. AC is the autocorrelation score for the enrichment scores. Wells marked with X are experiments for which gene expression was not available encounter varying growth conditions resulting in gene expression changes. As shown inthe location of the sample on the plate affects enrichment analysis. Significant down and upregulation in uncorrected gene expression is linked to well coordinate. After correction the biases are resolved. Negatively and positively enriched samples are not spatially separated and there are generally fewer significant enrichments observed. Finally, in order to get additional insights about the source of the spatial bias, we performed the enrichment of functional gene sets on the PCs significantly associated to the spatial bias (with a correction weight ! 0.5) using Gene Set Enrichment Analysis. We noted a few recurring Gene Ontology Biological Processes () that were significantly associated to the biased components across the entire dataset (). Specifically we use the columns of the coefficient matrix C from the singular value decomposition as signatures for the enrichment analysis (see Supplementary Methods). Although not extraordinarily significant (with adjusted p-values reaching a minimum value 10 7 ), the enriched components seem to circumscribe the source of bias into two major groups inversely correlated to each other and characterized by alterations in (i) cell proliferation and (ii) ion channel activity. Furthermore, similar PCs could be observed across distinct microplates and cell lines, indicating that spatial bias affects similar biological processes across different plates and cell lines.
DiscussionThe overarching achievement of transcriptomics is the ability to obtain large quantities of highly reliable gene expression data representing multiple cellular states. Thus, as dataset size increases with microfluidic automation, computational approaches for data processing are becoming more and more important. This study shows that 2D spatial bias, likely associated with gradient driven differential conditions affecting the microfluidic setup, is a significant source of error that can be effectively detected and corrected. Previous studies have dealt with similar problems in contexts other than that of gene expression measurement; however, these studies simply evaluated the issue without proposing a solution () or proposed a solution that involved changing the design layout of the microplates (). In other cases, the systematic bias was observed in high-throughput screening technologies with a reduced set of experimental variables (). No method to our knowledge addresses the spatial bias problem in the context of multivariate assay scenarios, like the LINCS dataset. Therefore, we propose here a pure data-driven solution for multivariate gene expression datasets based on reducing the principal components of the variance most associated with spatial bias. We introduce a tunable parameter that can either be set a priori or can be assessed to optimize biological replicate agreement in a largein the upper cluster (B) and in the lower cluster (C) in their respectively most co-segregating PCs multiplate assay. Our solution significantly improved replicate similarity in the LINCS dataset, an effect that could not be achieved by simply removing equivalent levels of global and non-specific variance from gene expression profiles. The optimal parameters differed between specific portions of the LINCS dataset, but every subset analyzed benefited from the bias removal independently of the analyzed cell line. In fact, these results strongly support the incorporation of spatial bias analysis and removal as a critical step in the normalization of all GE-HTS assays. While spatial bias can occur both before and after cell lysis and nucleic acids extraction presence of spatial bias in biological process enrichment values on most plates and consistent enrichment of a reduced set of biological processes on the most biased principal components suggests that part of such effects are originated prior to cell lysis. Processes most strongly biased on average across all plates in KD, OE, and CPC were associated to homeostasis and apoptosis. Our analysis of the principal component coefficients shows differential cell proliferation associated exclusively with the sample positioning on the microplates, a recurring effect that seems to be independent from the microplate or the cell line affected by the bias. This difference in cell proliferation can be caused by differential growth conditions of the plated cells, perhaps due to a gradient in the evaporation of the medium partially connected to the parallel enrichment of Potassium Channel activity (). No matter how carefully monitored and executed, any GE-HTS experiment can suffer from such operational bias issues. The proposed method allows for the detection and correction of the most significant location-specific undesired perturbation effects, regardless of the experimental stage at which they were introduced. Given that the LINCS dataset is the first of its kind, such spatial bias in multivariate gene expression data has never been observed at this scale before. Our method is similar to PCA-based noise removal techniques () since it operates on the Principal Component space in order to improve the measurement reliability. However, while previous methods remove the low variance components to reduce random noise (), our method is the first that specifically captures location-dependent effects, and decreases their contribution to the corrected dataset.
at University of California, Los Angeles on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
A.Lachmann et al. at University of California, Los Angeles on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
