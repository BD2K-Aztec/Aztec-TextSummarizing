Motivation: Transcriptome sequencing has long been the favored method for quickly and inexpensively obtaining a large number of gene sequences from an organism with no reference genome. Owing to the rapid increase in throughputs and decrease in costs of next-generation sequencing, RNA-Seq in particular has become the method of choice. However, the very short reads (e.g. 2 Ã‚ 90 bp paired ends) from next generation sequencing makes de novo assembly to recover complete or full-length transcript sequences an algorithmic challenge. Results: Here, we present SOAPdenovo-Trans, a de novo transcrip-tome assembler designed specifically for RNA-Seq. We evaluated its performance on transcriptome datasets from rice and mouse. Using as our benchmarks the known transcripts from these well-annotated genomes (sequenced a decade ago), we assessed how SOAPdenovo-Trans and two other popular transcriptome assemblers handled such practical issues as alternative splicing and variable expression levels. Our conclusion is that SOAPdenovo-Trans provides higher contiguity, lower redundancy and faster execution. Availability and implementation: Source code and user manual are available at http://sourceforge.net/projects/soapdenovotrans/.
INTRODUCTIONTranscript sequences and gene expression levels can now be efficiently obtained using RNA-Seq on next-generation sequencing technologies, providing increased throughputs and decreased costs. Applications for RNA-Seq include discriminating expression levels of allelic variants and detecting gene fusions (). To carry out these types of analyses requires an assembler that can reconstruct the transcripts from very short reads (e.g. 2  90 bp paired ends). Assemblers such as Cufflinks (), Scripture () and ERANGE () recover transcript sequences by aligning the reads to a reference genome. However, reference genomes are not always available, especially if the genome is unusually large and/or polyploid, which is often the case for plants. In these situations, de novo assembly is required. The challenge is not only to recover full-length transcripts but also to identify alternative splice forms in the presence of variable gene expression levels. Historically, the first de novo assemblers for next-generation sequencing, like Velvet (), ABySS () and SOAPdenovo (), were developed for genomes. These programs were intended to recover sequences for genomes of a known (estimated) size with a defined number of chromosomes. In contrast, transcriptome assemblers must recover an unknown number of RNA sequences, typically on the order of tens of thousands. Further, transcript sequences are only a few (k)ilobases in length, as compared with chromosomes, which can be hundreds of (M)egabases in length. Adding to the complexity is that gene expression levels vary by many orders of magnitude, so that for any non-zero sequencing error rate the most highly expressed genes will always harbor many discrepant bases, making it impossible to *To whom correspondence should be addressed. y The authors wish it to be known that, in their opinion, the first four authors should be regarded as Joint First Authors. define an absolute threshold for the number of sequencing errors allowed per assembly. Another issue is that most contemporary de novo transcriptome assemblers, like Trans-ABySS (), Multiple-k (Surget), Rnnotator (), Oases () and Trinity (), use the de Bruijn graph (DBG) schema for computational and memory efficiency, which means that alternative splice forms transcribed from the same locus will be combined into a single complicated de Bruijn sub-graph. This then needs to be addressed. In recent years, some important changes have been introduced to improve transcriptome assembly. Oases enumerated all possible transcripts with the simplifying concept of assembly subgraphs and then used a robust heuristic algorithm to traverse these graphs. Trinity introduced a new error removal model to account for variations in gene expression levels and then used a dynamic programming procedure to traverse their graphs. However, there is a lot of room for improvement, e.g. Oases produces more redundant transcripts, possibly due to it lacking an effective error-removal model (), and Trinity produces fewer full-length transcripts, possibly due to it not using paired-end data for scaffold construction. Here we present a de novo RNA-Seq assembler, SOAPdenovoTrans, which builds on these previous innovations to overcome a few remaining issues. SOAPdenovo-Trans incorporates the error-removal model from Trinity and the robust heuristic graph traversal method from Oases. In addition, we use a strict transitive reduction method to simplify the scaffolding graphs, and provide more accurate results. To assess the impact of these changes, we evaluated all three assemblers on rice and mouse, which have established transcriptome data linked to genome annotations produced over the last decade. The results here demonstrated that SOAPdenovo-Trans provides higher contiguity, lower redundancy and faster execution.
METHODSSOAPdenovo-Trans is a DBG-based assembler for transcriptome data, derived from the SOAPdenovo2 () genome assembler, which has an effective scaffolding module thatwith some modificationsis also suitable for transcriptome assembly. However, SOAPdenovo2 was designed for genomes with uniform sequencing depth. Thus, its error-removal model is not applicable to RNA-Seq data. It also does not allow for alternative splicing. Adopting and improving on concepts from Trinity and Oases resolved these issues The SOAPdenovo-Trans algorithm (schema in) consists of two main steps: (i) contig assembly and (ii) transcript assembly, described below.
Contig assemblyDBG construction is done as per SOAPdenovo2, but sequencing errors are removed in two ways: globally (as in the genome version of SOAPdenovo2) and locally (which is an addition specific to SOAPdenovo-Trans). For global error removal, low-frequency k-mers, edges, arcs (direct linkage between contigs in the DBG) and tips are removed, and bubbles are pinched. This is done in SOAPdenovo2 under the assumption that most are the result of sequencing errors. However, for the most highly expressed genes in a transcriptome, sequencing errors often generate k-mers that exceed any reasonable global error removal threshold. These cannot be corrected by global error removal. In contrast, for the most lowly expressed genes, such low-frequency k-mers can legitimately arise in the absence of sequencing errors; hence, in the global error removal, we only applied a weak depth cutoff (by default 2) so that these genes are not mistakenly removed from the graph. We then used Trinity's error-removal method to handle the remaining sequencing errors. It defines a percentage threshold for filtration ( 5% of the total or maximal depth of the adjacent graph element, which can refer to k-mers, arcs or edges), not a constant threshold, and is better suited for highly expressed genes. Finally, we used the same method as SOAPdenovo2 to generate contigs.
Transcript assembly
Scaffold construction Reads are mapped back onto the contigsto build linkages, as per SOAPdenovo2, except that SOAPdenovo-Trans uses both single-end reads and paired-end reads, while SOAPdenovo2 uses only paired-end reads. This is important because transcripts are much shorter than chromosomes, so it is essential to use the information that may only be found in single-end reads. The number of reads is then used to assign weights to these linkages, and insert sizes from the pairedends are used to estimate the distances between linkages.
Graph simplificationContigs that are identified as being ambiguous, with multiple successive linkages or of exceptionally high depth ($two times the mean depth), were masked for scaffold building in the genome version of SOAPdenovo2. This, however, is inappropriate for transcriptome assembly because of alternative splicing and variable gene expression levels. Alternative splicing establishes multiple successive linkages from a unique contig. The data representation of this appears analogous to ambiguities in whole genome assembly. Variable gene expression levels make it impossible to define a contig as repetitive using a single depth constant. One of the methods by which SOAPdenovo-Trans copes with these issues is by unconditional removal of short contigs (default 100 bp). This removes not only sequencing errors but also short ambiguous contigs caused by repeats, which in turn obviates the need for the scaffolding module to resolve complicated ambiguities. As a result, this increases its ability to identify alternative splicing events (). Conversely, unconditional removal of short contigs results in the creation of many small gaps, but this is corrected in the final phase of our algorithm by a gap-filling module described in Section 2.2.4. Linearization of contigs to scaffolds also differs in genome and transcriptome assembly. For genomes, after introducing paired-end reads with multiple tiers of insert sizes, a starting contig may have multiple successive contigs at different distances from the starting contig. The expectation is for these contigs to be linearly integrated into a single scaffold; however, for transcriptomes, conflicts may legitimately arise because multiple alternative splice forms share the same starting contig. To simplify the graphs properly, we used a more stringent linearization method in SOAPdenovo-Trans (): For example, three contigs, c1, c2 and c3, can be linearized if(i) there exists explicit linkage between 'c1 and c2', 'c2 and c3' and 'c1 and c3' and (ii) the distances between c1, c2 and c3 inferred from linkages do not conflict with each other.
Graph traversalContigs were clustered into sub-graphs according to their linkage. Each sub-graph consists of a set of transcripts (alternative splice forms) that share common exons. SOAPdenovo-Trans traverses these sub-graphs using the algorithm from Oases to generate possible transcripts from linear, fork and bubble paths. For the most complex paths, only the top scoring transcripts are retained.
Gap filling/correction As noted in Graph Simplification, manysmall gaps were introduced by masking contigs 100 bp before scaffold construction. To compensate for this, we used the DBG-based gap-filling method from SOAPdenovo2. Paired-end information was used to cluster semi-unmapped reads into the gap regions, and then these reads were locally assembled into a consensus. In instances where multiple consensus sequences were assembled, we selected the sequence that had a length most consistent with the gap size.
Benchmark to genomeFor our first benchmark test dataset, we used rice transcriptome data from Oryza sativa 9311 (panicle at booting stage). Paired-end sequences were generated on an Illumina GA platform (The second benchmark test dataset was mouse transcriptome data from Mus musculus (dendritic cells). Paired-end sequences were generated on an Illumina GAII platform () with 300 bp insert sizes and 76 bp read lengths. Here, the L dataset contained 36.1 M reads totaling 5.49 Gbp (after quality filtering, see the filtering steps in the supplement), and was obtained from the following: http://www.ncbi.nlm.nih.gov/sra/SRX062280 The S dataset was down-sampled from the L dataset (extracting one of every three reads from the L dataset) and contained 12.0 M reads totaling 1.83 Gbp. As Trinity only supports 25-mers, all assemblers were run with k-mer  25, to make the comparisons 'fair'. SOAPdenovo-Trans (version 0.99) was run with the parameters: '-i 20-q 5-Q 2-H 200-e 20-S 48 r-F-L 100-c 2-t 5'. Oases (version 0.2.8) with Velvet (version 1.2.10) was run using minimum-length-of-output-transcripts set to 100. Trinity (version r2013-08-14) was run with minimum-assembled-contig-length-to-report set to 100. The reference genomes and curated annotations were downloaded from the following two Web sites. Rice: MSU Rice Genome Annotation Project Release 7 at ftp://ftp.plant biology.msu.edu/pub/data/Eukaryotic_Projects/o_sativa/annotation_ dbs/pseudomolecules/version_7.0/ Mouse: Mus_musculus.NCBIM37.64 at ftp://ftp.ensembl.org/pub/re lease-64/fasta/mus_musculus/ Note that for rice, our transcriptome data came from the indica subspecies, but our reference genome came from the japonica subspecies. We chose the japonica genome as a reference because these annotations are more extensively (manually) curated than their indica counterparts. Ideally, we should have used japonica transcriptome data, but we used indica transcriptome data instead because there is little japonica data from the Illumina platform that is freely available. The use of these different subspecies is not totally unreasonable because they differ on average by only a fraction of a percent (). We do, however, note that there are local regions of higher variability that will prevent some indica transcripts from aligning to the japonica genome. All of the transcript-to-genome alignments were done in BLAT () using a 95% identity cutoff. We required that 95% of the transcript length be accounted for in one consistent alignment before we deemed the transcript to be correctly assembled. When that alignment criterion was not met, we searched for 'chimeric' assemblies that would account for 95% of the transcript length with multiple alignments that occurred in different orientations, on different chromosomes, or in distal regions of the same chromosome. When a transcript aligned to multiple genome loci, we selected the locus with the longest alignment. We did not determine the 'best' alignment when different genome loci gave the same aligned length because this occurred in 5 1% of the assemblies. When multiple transcripts aligned to the same genome locus and we needed a single representative for our analysis, we selected the largest of these (putative) alternative splice forms.
RESULTSTo compare the performance of SOAPdenovo-Trans, Trinity and Oases, we assembled two sets of paired-end Illumina data, (L)arge and (S)mall, for rice and mouse. As both genomes were sequenced a decade ago, the annotation has been extensively curated, making these appropriate benchmarks to assess the assembly software. We chose to assess both plant and animal transcriptomes because most other studies only assessed animals (or even simpler organisms like yeast), and we wanted to be sure that our assembler could handle the difficulties created by plant data. Plants have larger gene families and more transposable elements (TEs); some of these TEs are also highly expressed. SOAPdenovo-Trans was designed for use in the 1000 plants (1 KP) initiative www.onekp.com, and thus it was essential to manage these difficulties. We first assessed the computational demands of the three software programs with regard to peak memory and time (). For both measurements, SOAPdenovo-Trans was more than competitive with the other two programs. Alignment of the assembled transcripts to the annotated genomes () showed that SOAPdenovo-Trans produced the fewest transcripts, by more than factor of 2 in the most extreme cases, even after removing assemblies that were shorter than 300 bp. However, the number of annotated genome loci recovered was consistent among the three algorithms, differing only by 57%. One might naively attribute the differences in transcript numbers to alternative splice forms, but we would advise caution. There could be, for example, non-overlapping fragments of the same isoform or redundant copies of the same isoform. The following analyses are focused only on those transcripts that aligned to genome loci with annotated genes. We used the terms series-A and series-B to denote the sets of transcripts that included or excluded putative alternative splice forms, respectively. Series-A includes all assembled transcripts, while series-B is a strict subset that includes only the largest assembled transcript for any given gene. To properly assess the differences between assemblers, it is important to first understand how the rice and mouse assemblies differed from each other. Despite the fact that the rice and mouse datasets have similar amounts of raw input data, i.e. S and L datasets (S: rice versus mouse: 1.47 versus 1.83 Gbp; L: 5.98Note: Our analyses generated a successive reduction in the number of assemblies. First, we restricted our analyses to assemblies larger than 300 bp. BLAT alignments to the reference genomes were done at 95% sequence identity. Assemblies were deemed to be correct when !95% of their lengths could be accounted for in one consistent alignment. If not, assemblies were deemed to be 'chimeric' when 95% of their lengths could be accounted for in two or more alignments with different orientations, on different chromosomes or on distal regions of the same chromosome. We then confined our analysis to assemblies that overlapped with annotated genes. Because multiple assemblies could align to the same genome locus, we generated two datasets: series-A and-B, which included or excluded putative alternative splicing forms, respectively. In choosing among the isoforms, whether for series-B or the genome annotations, we always used the longest available sequence. In the case of the rice transcriptome, about 30.3% of the 55 986 annotated genome loci were known to be TEs, but our data showed that this was not a confounding issue. We indicate here the percentage of the assembled transcripts that were not known to be TEs.of the expressed rice genes were non-TEs. Given that many more rice genes had to be recovered from the same amount of sequence data, the read depths per gene were lower; as a result, the rice assemblies were not as high quality as the mouse assemblies. Furthermore, we expected that, given no extensive assembly errors (i.e. ones so extreme that they could not even be defined as chimeric), all but a very small percentage of the assembled transcripts should align to the genome. This was the case for mouse, but not for rice, where close to 10% failed to align because of subspecies differences, i.e. the use of indica transcriptomes and japonica genome annotations. We could eliminate most of the alignment failures by aligning the transcripts to combined genomes of both subspecies; however, to avoid the complications of having two genome annotations, we used only the alignments to the japonica genome. Comparisons of the assembled and annotated transcript can, at least in principle, be complicated if the sequences represent different isoforms created from different combinations of exons. Under those circumstances, the concept of 'full length' cannot even be defined by the ratio of lengths. However, in practice, the overlap between the assembled and annotated transcript is almost always perfect (). Hence, the two sequences almost always represent the same isoform. This allowed us to simplify our calculations for deriving the next plot (), which presents the cumulant for the assembled transcript lengths versus the assembled-to-annotation length ratios. What this is meant to show is the extent to which full-length transcripts are recovered, for any definition of completeness, without having to choose an arbitrary threshold like 95% of 100%. The use of total length on the y-axis is meant to de-emphasize the fact that there are many small assemblies that, even in aggregate, do not amount to much. The ideal is a step function with a rapid increase at ratios near 100%, and SOAPdenovo-Trans came closer to this than did Trinity or Oases. Based on the 'shoulder' in the curve, the data indicated that SOAPdenovo-Trans using only 1.83 Gbp of mouse data outperformed Trinity when it used 5.49 Gbp of mouse data. Note also that the increase begins before ratios of 100%, meaning that in many instances the assembled transcript was longer than the annotated transcript, which is not unexpected because untranslated region (UTR) sequences tend to be poorly annotated. To put a solid number on how many genes or isoforms were recovered, we chose an arbitrary threshold, 100 or 95% of the expected length in. Here, we only counted the isoforms that had been recorded in the genome annotations. While it is possible that the transcriptome data contained isoforms that had not previously been discovered, it is equally possible that these 'putative alternative splice forms' were assembly errors. The only way to avoid a misleading isoform count is to record only what had previously been annotated. Rather surprisingly, we found that Trinity and Oases did not recover more isoforms than, where we showed a distribution, here we plot a cumulant. L(assembly) is the length of the assembled transcript, counting only the portion that aligned to the genome, while L(annotation) is the length of the annotated transcript. Notice that the assembly-to-annotation lengths are plotted in reverse, from large to small. The ideal result is a step function with a sharp rise at 100%, but it begins to increase prior to 100% because the assembled transcripts contain UTRs that were not present in the annotated transcripts. Overlaps between the assembly and annotation. L(overlap) is the length of overlap between the assembled and annotated transcripts, while L(assembly) is the length of the assembled transcript counting only the portion that successfully aligned to the genome. Here, we show the distribution in the number of assembled transcripts as a function of the overlap-to-assembly lengths SOAPdenovo-Trans, even though they produced many more assemblies. To investigate why the assemblers, especially Oases, generated so many putative alternative splice forms, we did a comparison of the submaximal transcripts (i.e. all but the largest of the many transcripts that aligned to a particular genome locus) to the maximal transcript (). In many cases, we saw virtually no overlap between the submaximal and maximal transcripts, indicating that the assemblers produced non-overlapping fragments of the same isoform. In many other cases, the overlap to submaximal ratio was equal to one, which meant no new exons were recovered, unlike what is typically seen with genuine instances of alternative splicing. We noticed that the assemblers often produced multiple artifactual transcripts as a result of minor substitution errors in the raw input data. All had about the same length, in contrast to the common form of alternative splicing where exons are added or subtracted, which would result in 1020% changes in the transcript lengths (e.g. 1 out of 10 exons in an animal gene or 1 out of 5 exons in a plant gene). We tested for artifacts of this type by plotting the cumulant for the transcript lengths as a function of submaximal-to-maximal lengths (). The sharp increase as the ratios approach one showed that all the assemblers created artifacts of this type, but SOAPdenovo-Trans was the least offensive of the tested software.
DISCUSSIONSequence assembly using real-world datasets has always required many subtle algorithmic changes to produce the best results, and it is clear that no single algorithm has a 'magic bullet' that solves all of the problems. We developed SOAPdenovo-Trans by combining novel concepts introduced by Trinity and Oases with concepts developed for the genome version of SOAPdenovo2. On top of this, we added modifications of our own, suitable for transcriptome studies. As demonstrated here, we believe we have produced an algorithm that substantially improves on the currently available tools for transcriptome assembly. Given the complexity of these analyses, however, SOAPdenovo-Trans is unlikely to be the final word in transcriptome assembly. In particular, we tested one of the reference-based assemblers, Cufflinks, and found that it provided even better results than SOAPdenovo-Trans. These results suggest that, perhaps, there is information in these datasets that, with additional algorithm modifications, can be recovered. For example, a multiple k-mers strategy may improve transcriptome assembly. Current multiple k-mers assembly strategies generally fall into one of the two categories: (i) after using different values for k-mer assembly,. Analysis of alternative splice forms. Given a set of assembled transcripts aligning to the same genome locus, L(submaximal) is the length of any transcript other than the largest, while L(maximal) is the length of the largest transcript. L(overlap) is the length of the overlap between the two. As in, we show a distribution for the number of transcripts and then a cumulant for the transcript lengths separately, the resultant assemblies are merged into one final set. This might result in a more complete transcript set, but it may also introduce redundancy; (ii) iterate different k-mer DBG assemblies during contig construction. This strategy could potentially make the best use of reads and paired-end information, but whether it is worth developing such an algorithm depends in part on the ongoing developments in sequencing technology. There is an expectation of improvements in read lengths in the future. If so, it would necessarily alter the types of issues faced by transcriptome analysis. Finally, SOAPdenovo-Trans, unlike Trinity and Oases, does not yet perform strand-specific assembly, and this is planned for a future development to further improve this algorithm.
The Author 2014. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
SOAPdenovo-Trans at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
Y.Xie et al. at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
