Background: It has long been intriguing scientists to effectively compare different microbial communities (also referred as 'metagenomic samples' here) in a large scale: given a set of unknown samples, find similar metagenomic samples from a large repository and examine how similar these samples are. With the current metagenomic samples accumulated, it is possible to build a database of metagenomic samples of interests. Any metagenomic samples could then be searched against this database to find the most similar metagenomic sample(s). However, on one hand, current databases with a large number of metagenomic samples mostly serve as data repositories that offer few functionalities for analysis; and on the other hand, methods to measure the similarity of metagenomic data work well only for small set of samples by pairwise comparison. It is not yet clear, how to efficiently search for metagenomic samples against a large metage-nomic database. Results: In this study, we have proposed a novel method, Meta-Storms, that could systematically and efficiently organize and search metagenomic data. It includes the following components: (i) creating a database of metagenomic samples based on their taxonomical annotations , (ii) efficient indexing of samples in the database based on a hierarchical taxonomy indexing strategy, (iii) searching for a metage-nomic sample against the database by a fast scoring function based on quantitative phylogeny and (iv) managing database by index export, index import, data insertion, data deletion and database merging. We have collected more than 1300 metagenomic data from the public domain and in-house facilities, and tested the Meta-Storms method on these datasets. Our experimental results show that Meta-Storms is capable of database creation and effective searching for a large number of metagenomic samples, and it could achieve similar accuracies compared with the current popular significance testing-based methods. Conclusion: Meta-Storms method would serve as a suitable database management and search system to quickly identify similar meta-genomic samples from a large pool of samples.
INTRODUCTIONMicrobes are everywhere around us on the planet, and the total number of microbial cells on earth is huge: a rough estimation of their number is 10 30 (). Microbes usually live in communities, and each of these communities has different community structures and functions. As such, microbial communities would serve as the largest reservoir of genes and genetic functions for a vast number of applications in 'bio'-related disciplines, including biomedicine in healthcare, bioenergy, bioremediation and biodefense (National Research Council (U.S.). Committee on Metagenomics: Challenges and Functional Applications. and National Academies Press (U.S.), 2007). Because 490% of the strains in a microbial community could not be isolated and cultivated (), the metagenomic methods have been used to analyze the microbial community as a whole. Understanding the taxonomical structure of a microbial community (alpha diversity) and the differences in taxa among microbial communities (beta diversity) have been two of the most important problems in metagenomic research. In contrast to alpha diversity, which measures how many kinds of microorganisms are there in a single community, beta diversity measures how community membership varies over time and space, and is especially important for finding the complex relationships among a large numbers of samples. Understanding the beta diversity is critical for studying microbial ecology. For example, Human Microbiome Projects () and related efforts to study microbial communities occupying various human body habitats have shown a surprising amount of diversity among individuals in skin (), gut () and mouth ecosystems (). Furthermore, the microbial communities would differ significantly even for those from types of similar environment (). Next-generation sequencing techniques have enabled the fast profiling of a large number of metagenomic data. Thus, a rapidly increasing number of metagenomic profiles of microbial communities have been archived in public repositories and research labs around the world. As such, it is becoming more and more important to compare microbial communities in large scale. *To whom correspondence should be addressed.
Comparison of microbial communitiesA number of methods have been proposed for class discovery and comparison of different metagenomic samples. For comparison of multiple metagenomic samples, current researchers would adopt two different approaches: taxon-based (using overlap in lists of species, genera, OTUs and so on) or phylogenetic (using overlaps on a phylogenetic tree), both of which were based on the taxonomical information from the samples. In the first approach, many recent pyro-sequencing studies have been developed to compare samples (). MEGAN () is a metagenomic analysis tool with recent additions for phylogenetic comparisons () and statistical analyses (). MEGAN, however, can only compare single pairs of metagenomic samples based on taxonomy, as is also the case with STAMP (), which does introduce a concept of 'biological relevance' in the form of confidence intervals. Other methods, such as MG-RAST (), ShotgunFunctionalizeR (), mothur () and METAREP (), all process metagenomic data using standard statistical tests (mainly t-tests with some modifications). Those analyses are clear and simple, yet would turn out not to be very accurate (). In the second approach, some researchers have used phylogeny-based methods to compare samples (). Phylogenetic beta diversity measures, such as UniFrac and Fast UniFrac (), are specifically important because, unlike taxon-based measures (), they utilize the similarities and differences among species (). This additional information makes phylogenetic beta diversity measures more effective at showing ecological patterns than taxon-based methods (). Therefore, considerable insight has been gained from applying phylogenetic beta diversity methods to microbes in different environments. The number of samples and sample sizes (e.g. currently the Fast UniFrac online upload restriction is 200 samples) was the current limiting factors for the extension of this approach on the rapidly increasing scale of metagenomic experiments, thus rendering large-scale (e.g. more than 1000 samples) comparison of metagenomic samples difficult.
Databases of microbial communitiesAs metagenomic samples have been rapidly accumulated, it is natural to facilitate the comparison of microbial communities: create a database system with large number of metagenomic samples, and then given a set of samples as queries, find if there are similar metagenomic samples in the database. In other words, 'what does my sample like, how is it similar and different from any known samples?' However, current metagenomic databases, such as MG-RAST () and CAMERA2 (http://camera.calit2.net/), mainly serve as the data repositories, with only some modules for basic alpha and beta diversity analysis but neither full support of comparison nor search functions. Recently, a new database, MeganDB (http://www.megan-db.org/megan-db/home/), has been developed with public metagenomic samples pre-processed and archived, against which query metagenomic samples could be searched. This is an increasingly viable approach for searching for similar metagenomic samples, yet the current approach based on pairwise taxonomical comparison of metagenomic samples still lacks of index supporting for high efficient query.
Efficient search for similar metagenomic communities in a databaseTo facilitate the metagenomic sample comparison and search, it is crucial to design an effective metagenomic database system, primarily based on database creation and search schemes. Such scheme would include key advantages such as efficient indexing of database and accurate search scores, based on which, (i) the metagenomic samples are not only the accumulation of raw data (Supplementary), but a set of well-organized and indexed datasets (Supplementary) and (ii) the focus of the 'comparison of different microbial communities' is not the traditional pair-wise comparison for all possible pairs (Supplementary), but more of the query-based similarity analysis (Supplementary). In this work, we have designed a novel database indexing and searching method, Meta-Storms, based on taxonomical annotations and phylogenetic structure of metagenomic samples. The overall scheme of Meta-Storms is illustrated in. In the database creation part (), all metagenomic samples are pre-computed to parse out their taxonomical structures (community structure), based on which Meta-Storms then generates the index of the database by four alternative methods: scanning sample files to automatically add each sample, inserting single index entry manually, merged with other databases and merged by indices of other databases. In the database query part (), the query sample's taxonomical structure is also parsed out, which is then searched against the samples in the database by very fast indexing to retrieve candidate samples. After that, a quantitative phylogenetic-based similarity scoring function is used to compute the similarity between query and each of these candidates, and candidates with matching scores above thresholds are considered as matches to query. Meta-Storms also has database management part (C) to efficientlymanage the database, which is specifically useful when the database is huge.
METHODSWe have used C/C to implement the Meta-Storms. This software package includes database and index creation, metagenomic data query, database management and other functions which, together, could be beneficial for the maintenance and usage of metagenomic sample management, comparison and query.
Database and index creation
Database creation by taxonomical structureThe taxonomical structure of a metagenomic sample is directly associated with the community structure of the corresponding microbial community. The database is composed of metagenomic datasets, all of which are first analyzed by a highly efficient taxonomy-and phylogeny-based metagenomic analysis pipeline, Parallel-META [(), version 1.3], to obtain the taxonomical structure. Then, a unique ID is assigned to each sample in the database.
Database indexingAn index is created to organize the whole metagenomic database into hierarchical structure, mainly for the purpose of fast look-up for query samples. It is noticed that for many microbial communities (though might not be true for all), an intricate nature of its structure is that each microbial community is dominated by a few genomes (). Based on this general fact, we selected a set of phyla of each sample with high abundance (in the lexicographical order) as the 'index key'. To avoid arbitrary choice of indexing, each selected phylum should have significantly large proportion of reads. Based on previous experience, the abundance threshold of phyla for index key selection was decided to be 15%. We then built a Trie structure for high efficient indexing of the corresponding subdatasets of the samples, which have the same index key.illustrates the hierarchical structure of the index with an example of a Trie. In the index, each character above the branches represents one phylum name in the index key, and the subdatasets are represented by the nodes, such as index key 'BC' is for samples in subdatasetby the factor of 1-Dist ('Dist' is the phylogenetic distance between this species and its ancestor), which indicates how much component they shared with their ancestor. This step is referred to as the 'Reduce' function.We further define that for an internal node X, its two child nodes are X.Left and X.Right. Then the overall similarly score of one whole branch in the phylogenetic tree can be calculated recursively by this function:All branches are calculated in the same way and at the root of the phylogenetic tree, we can get the overall similarity score of two metagenomic samples. For example, the overall similarity score for comparing S1 and S2 is 92.8% ().(3) The properties of scoring function: the scoring function calculates the overall proportion of common components of two metagenomic samples in all phylogenetic level by bottomup analysis of the weighted common phylogenetic tree. This calculation based on weighted sum take into consideration both (a) the evolutionary distances of the species in each sample that are between 0 and 1 and (b) the different normalized abundances of these species in different samples represented by leaf nodes in the common phylogenetic tree, which also make the similarity score of two samples is always between 0% and 100%. Therefore, it realistically reflects the (weighted) structure differences between two different metagenomic samples. As such, the query results could be ranked directly by their similarity values compared with query sample. Moreover, since it depends on only a hierarchical annotation structure, such a scoring function could measure any kind of beta diversity for two samples.(4) Data structure and time complexity: the common binary phylogenetic tree is stored in Newick format () as a character string, and the proportion of read for species in two samples are stored in a hash table for constant-time access. As the similarity score calculation of two metagenomic samples can be completed by scanning the character string of the Newick-formatted phylogenetic tree only once, the algorithm of scoring function is in O(n) time, where n is the total number of nodes in the common phylogenetic tree. In our experiments, more than 10 000 times of execution of scoring function could be finished within minute (refer to(5) P-value calculation: to assess the significance of the similarity between two samples, we further defined a statistically meaningful P-value between two samples: the proportions of species in each sample are randomly permuted for 1000 times, and random similarity scores based on new abundance are calculated by the scoring function, then P-value is the rank of the original real similarity score among the permutated scores. Since two samples are significantly similar, if the real similarity score is significantly higher than would be expected when the sequences were randomly distributed between the two samples (), if the P-value is equal to or lower than an experimental threshold of 10% (refer to Section 3.5 for details), then the two metagenomic samples can be considered as significantly similar.
Exhaustive search Meta-Storms also provide the exhaustivesearch, which is based on comparing the query sample to all samples in the database by our scoring function to get the best match scores (considered as 'golden standard'). As all samples are computed by this method in the database, exhaustive search is much slower than indexed query (refer to Section 3.3 for details).
Index consistencyThe index consistency between indexed query and exhaustive search is calculated by checking the probability that results of these two methods to be equal, which can reflect the reliability that whether the indexed query can find out the same best-match result as the 'golden standard'. We can give the Dominant Genomes Lemma to predict the index consistency. In the database, a sample is considered to have dominant phyla if and only if the total proportion of the phyla which are selected in the index key is 460%. Then, the Dominant Genomes Lemma is described as the following: Dominant Genomes Lemma: If D% samples in the database have dominant phyla, then the index consistency is at least D%.Here, we have two metagenomic samples S1 and S2, their common binary phylogenetic tree with three species X, Y, Z and the proportion of each species (A). The first step is to get the similarity score from leaf node of X and Y. Then the remaining component of X and Y are reduced to their common ancestor by being multiplied by 1-Dist and continue the comparison at both the ancestor node and leaf node Z (B). The remaining component of ancestor node of X and Y and leaf node Z are recursively reduced to the root node and (C) the overall similarity are got after the comparison at root. Finally, (D) the overall similarity of these two samples is 92.8%.
Database managementMeta-Storms also has modules to efficiently manage the database, including index import and export, data insertion and deletion, database merging and so on, which would be especially useful when the database is huge. We have implemented database operations that include (C):(i) index export, to export an index of a database for query after database creation; (ii) index import, to use an index on a database for efficient query; (iii) data insertion, to insert new metagenomic sample(s) into a database; (iv) data deletion, to remove metagenomic sample(s) from a database and (v) database merging, to merge two different metagenomic databases into one.
RESULTS AND DISCUSSIONS
Experiment settingsIn this work, we performed seven experiments with five datasets to evaluate the index consistency, index efficiency, scoring function consistency, scoring function efficiency and so on of Meta-Storms. Tables 1 and 2 (refer to 'Dataset details' in Supplementary Material for more information and availability) show the information of our experiments and datasets. We also built a 'test database' with all 1363 metagenomic samples of dataset Database 1 () for the first two experiments on indexing.
Indexing consistency evaluationIn this experiment, we used dataset Query 1 (, 80 samples in total) as query samples to assess the consistency of indexing in the 'test database'. With 1179 of 1383 samples having dominant phyla, the index consistency of the test database would be 486.50%, as predicted by the 'Dominant Genomes Lemma' (refer to Section 2.2.4). We also tracked the 184 samples that do not have dominant phyla. Among them, 99 samples were from 'Dog Fleas' and 27 samples were from 'Snake Gut' of which the unclassified reads took a percentage of 420%. This made the average of their index keys to be 45.78%. For the other 58 samples, the average proportion of their index keys was 54.82%, which is very close to 60%. Therefore, it is conjectured that the major reason for samples without dominant phyla is largely due to the incompleteness of the taxonomy annotation of these samples, based on current taxa database. In this experiment, as 72 indexed query results of 80 query samples () were the same as those based on exhaustive search, the index consistency was considered to be 90.0%, which verified the Dominant Genomes Lemma. We also checked the rank of indexed query results in the top five best-match results of exhaustive search (). Results have shown that all samples were in top three matches. Such high ranks of indexed queryRefer tofor details of these datasets. results compared with 'golden standard' partially indicated that the results between the two approaches (indexed query and exhaustive search) would be significantly similar. This is also verified by direct comparison: the average difference of best-match results between them are only 0.19% (). Here 'average difference' was calculated by the formula ( P 80 i1 Ei  Ii)/80. In which, Ei represents the similarity score of query sample i and its best-match sample by exhaustive search and Ii represents the similarity score of query sample i and its best-match sample by indexed query.
Indexing efficiency evaluationTo evaluate the efficiency of indexing, we also compared the running time of indexed query and exhaustive search with the test query samples in the last experiment (80 samples of dataset Query 1 as queries against the test database). This is performed for four times to get the average performance. For indexed query, as all samples in the subdataset represented by the query key of query sample are scanned to compute the similarity score with query sample, the running time of indexed query mostly depends on the size of the corresponding subdataset (number of samples, Supplementary) of the database. Additionally, there is no apparent correlation between query sample size (number of reads) and the processing speed by either indexing or exhaustive search (Supplementary). In this experiment, the indexed query had achieved an average speed of 12.02 compared with exhaustive search.
Scoring function analysisThe scoring function module is one of the key components of the Meta-Storms method. To test the reliability of scoring function, we calculated the pairwise similarity score of samples in our database and compared with weighted Fast UniFrac () distance, which has different principles for calculation of pairwise score for metagenomic samples. Limited by the Fast UniFrac online upload restriction of 200 samples, we randomly selected 200 samples from six different kinds of source (dataset Select,, distance values (dots in) were distributing in the diagonal area, meaning that results of the two methods (our scoring function distance and Fast UniFrac distance) are very consistent (Spearman correlation of 0.915) in measuring pairwise similarity (distance) between samples. Having high correlation of pairwise distances with weighted Fast UniFrac, Meta-Storms has three major advantages/differences compared with other methods: (i) Meta-Storms is fully open-source, which could be installed locally as a stand-alone version with no sample number restriction (advantage in software configuration); (ii) Meta-Storms can take input of the 16 s rRNA pyro-sequencing data or Whole Genome Sequencing (WGS) data, so it is independent of any other method to retrieve the community structure of the metagenomic samples (advantage in system integrity) and (iii) Meta-Storms system is a metagenomic data management and search system, rather than a multiple sample comparison method (difference in design principle). Thus, Meta-Storms' scoring function serves as one of the several important components for its advantages and uniqueness.
P-value analysisIn this part, to test P-values, we have used the P-value of 19 900 sample pairs of 200 samples of dataset 'Select' (). To avoid inaccuracy caused by random sampling, permutation of each sample pair was repeated 1000 times. The resultant figure () was divided into four areas by horizontal reference line indicating P-value 10% and vertical reference line indicating similarity score 85%. Sample pairs in area 1 are very few, and they have low similarity scores; Sample pairs in area 2 could be considered as not similar for high P-value but low similarity scores; In area 3, all sample pairs have pairwise similarity !85%, and P-value 10% (significant similar according to P-value). In area 4, although the P-values of sample pairs were 410%, they were still considered to be significant similar because, in-depth analyses have shown that for most of the sample pairs, the leaf nodes of each common phylogenetic tree were quite similar. For 1016 (sample pairs marked by light-colored circles) of 1090 sample pairs in area 4, two samples in the pair were from the same source such as soil, ocean and human, meaning that the structure of two samples were similar, based on which most permutations of the proportion led to high similarity scores.Based on these results, we could provide a recommended threshold of similarity score of 85%, which means that for two samples, if the similarity score is !85%, they could be considered as significantly similar. From the results in, we can observe that in this test, 2570 sample pairs were considered significantly similar (1480 sample pairs in area 3 and 1090 sample pairs in area 4). Among them, 96.61% (1467 sample pairs in area 3 and 1016 sample pairs in area 4, refer to Supplementary Table S3 for details) were with two samples from the same source. On the other hand, there were 4404 sample pairs with two same-source samples in total but only 56.38% of them were considered as significantly similar. Therefore, if two samples are significantly similar, they tend to be from the same source, but samples from same source might not be significantly similar.
Scoring function efficiency evaluationAs stated previously, each similarity score for a pair of metagenomic samples could be calculated in a liner time. Here, we computed distance matrices of 10, 50, 100, 150 and 200 samples randomly selected from the dataset 'Database 1' () by scoring function to test its speed. Results (sub-graph on left top of) have shown that the running time had a linear relationship with the number of sample pairs. For 200 samples, the scoring function had been executed for 19 900 times and could be finished in 1.5 min (). Thus, the running time is quite fast, given the current scale of metagenomic samples. We have also tested Meta-Storms system on a collection of more than 10 000 metagenomic samples (data not shown), and the distance matrix could be computed within several hours. As far as we know, Meta-Storms is one of the first systems that could handle such a large number of samples within a day's time.
An application of Meta-Storms on human microbiome samplesIn this section for application test, Meta-Storms is applied on the human microbiome from different sites and individuals. We used all 60 samples of dataset Database 2 () from three different sites in human gut, palm skin and mouth of two individuals with different genders () to build a metagenomic database. In this database, for each site on host, there are 10 different samples. For these 60 samples in the database, the similarity score of 1770 different sample pairs [C(60,2)  1770] and the pairwise distance matrix are generated using our scoring function (). Based on this distance matrix, a phylogeny tree of samples from each body site in the database has been created using Phylip-fitch () (, right part). From which we could observe that samples were more diverse among different sites on same host, rather than between different individuals. This result is consistent with the research conclusion of. It is also interesting to find out that the oral microbial community structures are more similar to those on palm skin than those in gut, probably due to the fact that Staphylococcus aurous is one of the dominant species both in oral conditions and on skin (). Then, we used all 120 samples of dataset Query 2 (), which were collected from the same three sites of these two people but not in the database, as queries to find the best matches in the database (, left part). Results had correctly identified the location from where the microbial community samples were collected, yet it was not very sensitive to host (, left part).Among the queries, 99.2% (119 out of 120) were matched to the right sites, and 75.8% (91 out of 120) were perfectly matched to the right sites of the right host. This proved that the search accuracy of the Meta-Storms method is very high. As regard to speed, the whole analysis (from database creation to sample query) has taken 55 min.
Functional comparison of metagenomic samplesWith the fast development of next-generation sequencing (NGS) techniques, some of the whole genome sequencing-based metagenomic sequencing projects had been conducted (Muegge). With these data available, it was now possible to profile all functions in a metagenomic sample. In such context, another measure similar to taxonomy-based beta diversity could be measured: hierarchical functional diversity [such as subsystems ()] of different samples. This measure could answer the fundamental question regarding the functional diversities among samples. Previously, we have already mentioned the applicability of Meta-Storms on comparing functional diversity of metagenomic samples. In this part, we have tested Meta-Storms' ability to perform similarity search, which was conducted similar to the taxonomy-based search, except that indexing and searching were both based on functional hierarchy. We have selected functional annotation data from metagenomic samples obtained from a recent study on mouse gut microbiota (). We have selected the Escherichia coli samples from 36 mouse/diet period in total based on 13 mice [refer to () for details]. Results have shown that the microbial communities' functional structures were not sensitive to different hosts, as samples from different hosts could be clustered together (refer to Supplementaryfor more details). Yet these functional structures were quite sensitive to different diet periods: samples of third diet period were more conserved, whereas samples of fourth diet period were more diverse (refer to 'The functional diversity of different metagenomic samples' in Supplementary Material for more details). This might be explained by the microbial communities' exploitation or adaptation for the diet over time. As shown in these applications on real metagenomic samples, because the WGS-based metagenomic studies have been more and more commonly used, it is now possible to have a metagenomic database with both taxonomical and functional profiles of metagenomic samples. The application of sample search and comparison methods such as Meta-Storms could help to discover the intricate relationship among samples, which would lead to great enhancement of metagenomic data analysis and data mining for a wider range of studies of microbial ecology.
CONCLUSIONWith the fast accumulation of metagenomic samples and sequencing data, their comparison becomes very important to illustrate their similarities and differences. As such, the database search for metagenomic samples is becoming more and more important. However, current metagenomic data are not organized well (thus they are only data repositories, but not yet modernized and manageable database), and current metagenomic sample comparison methods are generally based on pairwise comparisons (thus, only comparable in small-scale, and difficult with large-scale analysis) without efficient index supporting. Therefore, we have designed the Meta-Storms system as a system for database creation, indexing and searching for similar metagenomic samples. Meta-Storms is not only a database builder and searcher, but a search-engine-based metagenomic sample comparison system that could organize the database well, and could perform quick and accurate search. Although it is one of the first systems of its kind, Meta-Storms has already been proved to perform well in similarity search for a large numbers of samples. Its main advantages include: ability to handle large number of samples in an integrated system, fast indexing and candidate retrieval, accurate scoring function for comparison, etc. First, Meta-Storms has advantages in system integrity: it can take input of the 16 s rRNA pyro-sequencing data or WGS data, thus is independent of any other method to retrieve the community structure of the metagenomic samples. Additionally, the database could be built based on more than 10 000 metagenomic samples, making it one of the first systems that could handle such a large number of samples. Second, its index is simple, yet quite fast and accurate in clustering different samples. The fast speed comes out of the simple categorization by only using phyla with high abundance as the index key. Therefore, such indexing scheme would be useful, especially when there are many samples, for organizing samples in a metagenomic database. Third, for sample comparison, it was noted that significance tests such as the P-test () and the Fast UniFrac replicated permutation become decreasingly useful as the depth of coverage and the number of samples increase (). However, although our methods based on scoring(B) Phylogenetic tree of human microbiome samples and query results, which were matched to the right body sites. Numbers on left part are samples that were matched to the body sites indicated by the corresponding arrows. function does not need complex computation, it is as accurate as those based on significance tests with fast speed. Therefore, our scoring function might be a better alternative to the traditional time-consuming significance test. Functional comparison of different metagenomic samples have also shown the ability of Meta-Storms to accurately and efficiently identify microbial communities of similar functions, and also help to shed new light onto the functional diversity of the microbial communities. With the advance of WGS of metagenomic samples, it is anticipated that the functional profiling and comparison of metagenomic samples would become more and more important, for which Meta-Storms would be of greater importance. In conclusion, Meta-Storms would provide key methods for metagenomic projects to facilitate the research in metagenomics, and more broadly, microbial communities, including Human Microbiome Projects, Earthmicrobiome Project, etc. Current Meta-Storms method could be updated in index efficiency and consistence. First, current indexing strategy is suitable for searching samples with dominant genomes (which are always the case) against large database. For query samples without dominant phyla, or when samples in the database are quite similar to each other (e.g. from the same source), we recommend the exhaustive search for high reliability rather than indexed query. Second, the statistical model for the database search could be improved by integrating a mixture model. By these refinements, it is expected that the overall performance of Meta-Storms could improve further. All of these issues are expected to be addressed in our future work.
SOFTWARE AND DATA AVAILABILITYThe Meta-Storms software and metagenomic sample data mentioned in this article could be downloaded at http://www.computationalbioenergy.org/meta-storms.html.
at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
X.Su et al. at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
(node 8 in Fig. 2A). Meta-Storms initialized the index by inserting all samples of the database into an empty Trie. Once the index is built, adding new samples in the database is simple: just insert them into the proper position of the Trie by their index keys. For instance, samples with index key 'BCE' (the selected phyla are B, C and E) should be inserted into subdataset 15 (node 15 of Fig. 2A) and sample with index key 'CDH' should be added to a new subdataset (Fig. 2B, node 19 in dashed line). Samples without index keys (i.e. without phylum of high abundance) are stored into the same subdataset named 'others' (node 4 of Fig. 2A). 2.2 Database query 2.2.1 Indexed query and parallel indexed query The 'query key' of the query metagenomic sample is parsed out by the same method as for the index key of samples in the database. Meta-Storms maps the query key in the Trie to the deepest (right-most) level, and fetches the subdataset in which samples have high abundance phyla as candidates, such as query key 'ABD' should be mapped to subdataset 13 (node 13 of Fig. 2A). When the query key cannot be fully mapped in the Trie, the least abundant phylum is removed from the query key, and this updated query key is tried again. If successful, the indexed query compete, otherwise this query key updating and mapping procedure continues until there is a hit, or all phyla are removed from the query key, which means that there is no hit for indexed query. For example, query key 'AEFD' (with abundance A4D4F4E) could be mapping to subdataset 7 (node 7 of Fig. 2A) by removing the two least abundance phyla F and E, and query key 'AGHI' (with abundance G4H4I4A) could be considered as 'not hit'. Then, a quantitative phylogenetic-based scoring function (refer to Section 2.2.2 for details) is used to accurately search for the query sample by pairwise comparison with the candidate samples. As each candidate sample in the subdataset is independent, this comparison can be parallelized based on parallel programing. In this work, we map each pair of comparison with a thread, and on multi-core CPUs, these threads can be processed at the same time. All threads store their results in a shared-memory space which can be accessed by other threads. 2.2.2 Scoring function The scoring function is to compare the microbial communities' structure similarity by quantitative (i.e. the relative abundance of each species in a sample) and phylogenetic (i.e. the evolutionary distances between each species and its parent) (Hamady and Knight, 2009) calculation of their common component's proportion based on the phylogenetic relationship of species in two microbial communities. (1) Preprocessing: initially, a common 'binary' phylogenetic tree of the two metagenomic samples with branch lengths and node weights is built: The branch length between each species and its ancestor represents the number of different nucleotides in every 100 nucleotides between their genome sequences, which reflects their degree of difference and the node weights are the proportion of reads for species of each sample that can be obtained by taxonomical structure analysis. (2) Recursive scoring function: from each leaf node to the root, the similarity score for every single branch in the common phylogenetic tree is calculated by the recursive functions described as below: Suppose for a single species X (represented by a leaf node in the phylogenetic tree), the proportions of this species in the two samples are X.P1 and X.P2, respectively. For example, the proportions of species X are 30% in sample S1 and 40% in sample S2 (node X in Fig. 3A). We define MIN(X) as the similarity score for a single species: MIN X    X:P1 X:P2 ? X:P1 : X:P2; 1 That is, the similarity score of one single species can be interpreted as the common proportion on this species of two samples, such as at node X, the score is MIN(30%, 40%)  30%. After extracting the common proportion, sample with larger proportion is remained of which the new proportion is jX.P1  X.P2j (node X in Fig. 3B). Samples at different nodes in the phylogenetic tree (node X and nod Y in Fig. 3B) cannot be compared directly, but should be reduced to their common ancestor X. Ancestor (if X is not root) by being multiplied Fig. 2. Index structure based on Trie. (A) Characters above branches represent phylum names in index keys, and nodes represent the corresponding subdatasets. (B) is updated from A by adding a new subdataset (node 19) with index key 'CDH'.
Novel indexing scheme and similarity score for metagenomic data at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
