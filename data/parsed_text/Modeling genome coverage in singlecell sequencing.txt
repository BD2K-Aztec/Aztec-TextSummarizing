Motivation: Single-cell DNA sequencing is necessary for examining genetic variation at the cellular level, which remains hidden in bulk sequencing experiments. But because they begin with such small amounts of starting material, the amount of information that is obtained from single-cell sequencing experiment is highly sensitive to the choice of protocol employed and variability in library preparation. In particular, the fraction of the genome represented in single-cell sequencing libraries exhibits extreme variability due to quantitative biases in amplification and loss of genetic material. Results: We propose a method to predict the genome coverage of a deep sequencing experiment using information from an initial shallow sequencing experiment mapped to a reference genome. The observed coverage statistics are used in a non-parametric empirical Bayes Poisson model to estimate the gain in coverage from deeper sequencing. This approach allows researchers to know statistical features of deep sequencing experiments without actually sequencing deeply, providing a basis for optimizing and comparing single-cell sequencing protocols or screening libraries. Availability and implementation: The method is available as part of the preseq software package. Source code is available at http://smith labresearch.org/preseq.
INTRODUCTIONThe capability to sequence the DNA of a single cell is essential to analyzing biological diversity in heterogeneous populations of cells. Single-cell DNA sequencing technology is also necessary in applications like preimplantation genetic diagnosis based on the genotype of an individual cell biopsied from a blastocyst (). Recent efforts have used single-cell sequencing to examine genotypic heterogeneity in tumors (), rates of somatic mutations (), recombination rates in the germ line () and probing of the genetic diversity in unculturable bacterial populations such as those naturally occurring in the ocean () or the human gut (). The challenges associated with single-cell genome sequencing are all due to the fact that the relevant DNA only exists in a single copy. For example, the nuclear DNA of a human cell weighs $80 picograms while most standard library preparations specify a minimum input in the nanogram range (). Special protocols are needed to prepare DNA sequencing libraries in single-cell applications. Whole-genome amplification (WGA) is conducted prior to PCR, with the goal of producing more copies of the genome in the form of long amplicons that uniformly cover the original genome. Biases in WGA can dramatically alter the representations of different parts of the genome in the sequencing library (). Methods have been developed to minimize WGA amplification bias by reducing the limiting volume for multiple displacement amplification (MDA) to avoid exponential preferential amplification () or looping of the amplicons to induce quasi-linear amplification. Despite these advances, whole genome amplification remains far from uniform. A major problem in single-cell and low-input sequencing is the loss of loci in the process of sequencing. There are multiple opportunities for portions of the genome to disappear in the library preparation, making them unavailable for sequencing and subsequent observation. This situation is known as locus dropout and creates significant problems for downstream analysis (). For diploid cells, locus dropout presents the additional difficulty that the dropout of one allele is easily mistaken for homozygosity. New single molecule sequencing technologies still require some form of whole-genome amplification prior to PCR amplification (), suggesting these problems will persist. It is our goal here to investigate for a single cell DNA sequencing library the genome coverage from deep sequencing, which we define as the expected number of bases in the reference genome covered by sequencing using high-throughput short-read technology. The traditional mathematical model of sequencing assumes that all parts of the genome are represented in the sequencing library in uniform abundance, resulting in a simple Poisson distribution for the number of reads covering each base (). The possibility of unknown dropout implies this model is inadequate for single-cell sequencing. Additionally the uniformity assumption is lost due to a myriad of biases inherent to high-throughput sequencing (). These problems still exist for single-cell sequencing experiments but are exacerbated by the low starting material, in addition to biases specific to WGA. One example is the observation that priming efficiency and extension rate of the DNA polymerase 29 used in MDA is dependent on nucleotide content, leading to uneven amplification (The highly non-uniform molecular abundances and unknown dropout in the sequencing library are not the only problems in specifying a model for the genome coverage in single-cell sequencing experiments. The coverage of local bases will be highly correlated. There is the natural correlation caused by nearby bases being covered by the same read. Additionally we expect broad correlations due correlated molecular abundances of nearby regions. One example is local correlations related to nucleotide content due to the uneven amplification of MDA. These all create problems in mathematically modeling the sequencing process, as misspecification can create significantly biased estimates. Our aim in this paper is to present a method for estimating the genome coverage of a reference genome in a deep sequencing experiment, based only on information from a shallow initial sequencing run. One key to our method is treating sequenced nucleotides as independent observations despite the fact that the true unit of sampling is the sequenced read. We show that the loss of information caused by this assumption is acceptable. We adapt the non-parametric empirical Bayes approach we developed previously for estimating library complexity (), which abstracts the sequencing process as a capturerecapture experiment. By applying our method to publicly available human single-cell sequencing data from a variety of sources and technologies, we demonstrate the method to be accurate and widely applicable. We then investigate practical considerations in applying the method, including methods to reduce the running time and ways to reduce the cost of initial experiments. Finally we apply our method to a broad swath of recent shallow single-cell sequencing experiments to show the variability of genome coverage for differing protocols.
THEORYWe assume a sequencing experiment samples molecules from a large pool of DNA fragments in the library. Further, we assume that the number of amplified copies of each DNA fragment is sufficiently large that sampling behaves as with replacement. Each molecule sampled during sequencing corresponds to a sequenced read. Each sequenced read will cover multiple bases in the genome: every sequenced nucleotide covers exactly one base. Our goal is to use information from a shallow sequencing run to predict the number of bases that would be covered after deep sequencing. We call the shallow sequencing run the initial experiment, and we make the essential assumption that the properties of the library do not change between the initial experiment and deeper sequencing. We define the following symbols:Consider the random trial of sequencing an individual read. This can also be considered as L trials, one per nucleotide in the read. The outcomes of these L trials correspond to covering L consecutive bases in the genome. A second read whose origin partially overlaps the first will provide an additional L trials, some of which will cover new bases (). The part of the genome where the two reads overlap, however, will correspond to outcomes observed twice. Although the outcome of each of these LN trials is dependent on L  1 others, this dependence is highly localized. Similarly, for a given base in the genome, the number of trials (sequenced nucleotides) whose outcome corresponds to that base also has a strong local dependence: the number of reads covering any given base is dependent on the number covering 2L  2 others. In adapting the non-parametric empirical Bayes approach of Good and Toulmin (1956) to predict genome coverage, we will follow the compound Poisson formulation elaborated by Efron and Thisted (1976), who applied it to estimating Shakespeare's vocabulary based on his printed works. The way words may be combined in English text follows both grammatical and stylistic constraints. For example, in Julius Ceasar, the word 'thou' precedes 'art' more than twice as often as it precedes 'the', despite the word 'the' appearing 50 times more often than 'art' in the entire play. Efron andargued that this amount of dependence can be ignored in a large enough body of work. Unfortunately, the dependence introduced by sampling nucleotides as contiguous reads is much stronger: by covering the ith base in the genome, one greatly increases the probability that base i + 1 will be covered. For our application, however, the relations N ) L and G ) L both hold in practice, meaning that dependence between events (nucleotides in reads) and outcomes (covered bases in the reference genome) are both of extremely limited reach. When considering the outcomes, since we assume that reads are multinomially sampled, as we previously considered (), the number of reads covering a position depend only on the L  1 positions downstream and L  1positions upstream. Therefore, the set of dependence is 2L  1 bases. We can apply a ChenStein argument to infer that the limited dependence can be well approximated by assuming independence (). Define n j t as the number of bases covered by exactly j reads after sequencing tN reads and let n j denote the number of bases covered by j reads in the initial experiment (i.e. n j =n j 1). We call the full vector n 1 ; n 2 ;. .. the coverage counts histogram. We assume that the number of reads that cover each position follows a Poisson process with rates independently and identically distributed according to , an arbitrary distribution with mean NL=G. This is known as the non-parametric compound Poisson model () and under this model the expected value of n j t is equal toAlthough we know the number of positions in the genome that are not covered by reads, the value n 0 is not known because it refers only to those positions not covered by the current sequencing but might be covered if the same library were sequenced more deeply. This implies that n 0 is non-identifiable in the non-parametric model Link (2003), so analysis must be done with the identifiable portions of the model, the counts n 1 ; n 2 ;. . .. Good andintroduced an empirical Bayes approach that, in our context, provides an estimator for the gain in genome coverage from sequencing an additional t  1N reads. We refer to the following as the GoodToulmin estimator:The way these observed counts are obtained is illustrated schematically in. As we previously discussed (), the GoodToulmin estimator is highly accurate when predicting the gain in coverage for small increases in the experiment. Using the GoodToulmin estimator to predict beyond t = 2 is problematic and suffers from extreme instability. In particular, the estimator will diverge to positive or negative infinity depending on whether the largest observed coverage count is odd or even. We introduced rational function approximations to obtain globally stable estimates that still satisfy the nice local properties of the GoodToulmin estimator (). A rational function approximation to a power series is a ratio of polynomials that asymptotically approximates the power series up to a given degree,To guide the selection of P and Q, we note that the coverage will asymptote as the number of bases sequenced and the sequencing depth goes to infinity. This indicates that we should choose P=Q  1 so that the rational function behaves the same in the limit as the coverage curve which we approximating. Our observation is that this choice gives superior performance to other rational function approximations (Supplementary), allowing for accurate and stable long-range predictions of the genome coverage.
ACCURACY OF PREDICTIONSWe evaluated our method on 19 single-end 100 or 101 nucleotide (nt) single-cell sequencing experiments () that were 'deeply-sequenced', which we defined as at least 100 M reads. We downsampled each library to 5 million (M) reads to simulate the initial sequencing experiment and compared the estimated genome coverage curve to the observed genome coverage curve, calculated by downsampling the library and using BEDTools (). We measure the accuracy of our estimates by the relative error, which we define as the observed genome coverage minus the estimated divided by the observed. Even for long-range extrapolations, the estimates remain stable and accurate (Supplementary Figs S2 and S3). When we use 5 M sequenced reads (0.17  coverage) to predict the genome coverage for 100 M sequenced reads (3.33  coverage), a 20-fold extrapolation, we observed a mean absolute relative error of 53% (, Supplementary Figs S2 and S3). We notice that our choice of order of the rational function approximation tends to give conservative estimates of the genome coverage (Supplementary Figs S2 and S3). Theoretically, the distribution of the curves should be symmetric about the mean, but we observe a downward skew to curves (D'Agostino skewness test (D') on the relative error for the 20-fold extrapolations P53 E-16). We investigated bootstrapping to reduce the skew and lower the variance of our estimates (). The bootstrapped median shows significant improvement over the simple extrapolations and even the bootstrapped mean (Supplementary), indicating that the use of bootstrapping and aggregating the median curve leads to more accurate estimates.
PRACTICAL CONSIDERATIONS
Binning to approximate coverageThe major computational demands in the extrapolation algorithm come from bootstrapping the coverage counts histogram to reduce variance of the estimator (see Supplementary Information). The time required for resampling is a function of the number of possible outcomes for each event, in this case individual genome positions. An approach to reduce the running time is therefore to partition the genome into non-overlapping bins and use the bins as the outcomes of each random trial. If we had an estimate for the number of bins that would be covered after deep sequencing from the library, the genome coverage could be estimated by multiplying that number of bins by their size (or their average size, if the bins had varying sizes). We refer to this approach as a binning based estimator. It is not difficult to see that counts for bins can be supplied to the GoodToulmin estimator in the same way as counts for individual nucleotides as illustrated in. We assume the genome has been partitioned into equal sized bins. There are several possible schemes one may follow to construct a binning based estimator. If we say that a read covers a bin only if it completely covers the bin then we will consistently underestimate the coverage, and this excludes use of bins larger than the read length. Conversely, if we say a read covers a bin if there is any overlap then we will consistently overestimate genome coverage. A reasonable approach is to say a read covers a bin with probability proportional to the number of nucleotides in the read that cover the bin (Supplementary). This ensures that, for a single read, the probability any position is covered by that read is unbiased. Unfortunately one can demonstrate that even for binning based estimators that are unbiased for a single read, they will be biased for multiple reads (Supplementary Information). This also works in the other direction, if a strategy is biased for a fixed number of multiple reads then it will be biased for any other number of reads. The binning-based estimator does indeed slightly underestimate coverage (Supplementary Information, Supplementary). Despite this, we observe that the binned coverage counts histogram is approximately proportional to single base resolution coverage counts histogram (Supplementary). This holds even when the bin size is larger than the read length, so that reads are randomly thrown out or extended to cover whole bin while on average covering the same number of bases (, Supplementary). The gain from binning is a reduction in running time proportional to the bin size (, Supplementary Information). As can be seen from Supplementary, this comes at an acceptable cost in accuracy. The binning procedure naturally introduces variance in the estimated coverage count histogram and therefore also the bin size due to the random nature of the binning. This variance increases with the bin size, as portions of reads are more likely to be thrown out or to be extended with increasing bin size. On the other hand, the binning will group close neighboring bases together and reduce the variance introduced when treating close bases as independent. Accordingly the variance of the estimated coverage should achieve a minimum lying somewhere between single base pair and the read length (, Supplementaryand S9).
Effects of read length on coverage estimatesAt present the vast majority of whole-genome sequencing experiments, including single-cell experiments, use Illumina sequencing technology. Reads from this technology correspond to the ends of DNA fragments. Suppose one sequences L nucleotide reads that map unambiguously back to the reference genome, and that the DNA fragments in the library all have length greater than L. Using information about the genome coverage from that experiment, one could compute what the genome coverage would have been had the reads been of length L + 1. This can be done by 'extending' the reads in silico, which amounts to pretending the reads were longer. The cost of a sequencing experiment is approximately a linear function of (i) the number of reads sequenced, and (ii) the length of reads. For a variety of reasons, including optmization of total throughput at sequencing centers, investigators are often presented with a relatively limited set of options. Often there are options for a few standard read lengths that include both 'short' and 'long' options (at present, e.g. 36 and 100 nt). We asked whether an approach of extending reads in silico could help minimize the cost of the initial experiment while still accurately predicting genome coverage in deeper sequencing with true longer reads. In line with the assumption above, we expect that in silico read extension will work as long as the mapped reads find their correct mapping positions at shorter read lengths. While this places a lower bound on the lengths of reads that can be used, there are only small differences in mappability for reads 436 nt (). To evaluate this approach, we examined four libraries given by Sequencing Read Archive accession numbers SRX151616, SRX202787, SRX204160 and SRX205367, which correspond respectively to an MDA haploid, MALBAC diploid, MDA diploid and MALBAC haploid libraries. We downsampled 5 M reads originally of length 100 bp, and then truncated the original reads at 50 nt prior to mapping. We tested the results for extending the reads by 50 bp in silico versus extending the fold-extrapolation (Supplementary). We see that the artificially extended reads consistently overestimate the genome coverage (mean relative error across all libraries = 0.018). On the other hands, extending the fold-extrapolation on the mapped truncated reads shows an increase in relative error compared to the full length reads (mean relative error of 0.028 across all libraries), not unexpected, as we are estimating further away from the initial experiment. This indicates that artificially extending the reads in silico is the incorrect strategy and we should simply extend the fold extrapolation. We next examined the effect of read length on the estimates while holding constant the total number of nucleotides sequenced. For each of the four libraries, we downsampled 5 M reads at 100 nt, and 10 M reads at 50 nt. The 50 nt read samples consistently yield more accurate predictions of genomecoverage and have lower variance (, Supplementary). This result suggests that any bias associated with mappability and fragment length variance, at least for 50 nt reads and the human reference genome, may be acceptable to reduce costs for library test runs.
Does including duplicate reads impact predictions?It is standard in many sequencing applications to remove all but one read among a set believed to be amplified copies of the same original DNA fragment (). Multiple options are available for identifying when reads are duplicates (). In the context of single-cell genotyping, one often seeks to use duplicates to correct sequencing errors, a concept that has been called 'single-molecule consensus' reads (). For most current methods of identifying amplification duplicates, all duplicate reads for a given molecule will map to the same position in the genome. As a consequence, the genome coverage for a given sequencing experiment will be identical whether or not duplicates are removed. Moreover, in theory the number of distinct reads that cover a particular position should also approximately follow a Poisson process. This observation suggests two possible avenues for using the Good Toulmin genome coverage estimator to predict coverage from deeper sequencing. The direct approach is to ignore duplicate reads when making predictions based on the test run. A different approach would be to make estimates using only unique reads, and then to make predictions based on (i) the number of unique reads in a deeper experiment, using the method of Daley and Smith (2013), and (ii) to then predict genome coverage conditional on the number of unique reads sequenced in the full experiment (Supplementary). This second approach includes two predictive steps, but neither of these steps would be extrapolating as far as the direct approach. And we know that the non-parametric empirical Bayes framework is more accurate when extrapolations are less extreme. Although genome coverage estimates with duplicates and without duplicates should be equal, the variances may differ. Therefore we compare the results from the same library under both cases extrapolated to the same genome coverage achieved at 100 M reads with duplicates included, so that the fold-extrapolation is less for duplicates removed (Supplementary). For some cases (MALBAC libraries), the performance with duplicates removed comparable to including duplicates. But for the MDA haploid libraries, the performance is worse (paired t-test, P53 E-16). We therefore suggest that the genome coverage is predicted with duplicated included, but note that it can also be done with duplicates removed.
COMPARING LIBRARY PREP PROTOCOLSThere is little available data on the performance of specific single-cell library preparation protocols based on deeply sequencing the libraries. Existing information exists only for a few protocols () or for bacterial genomes (). The reason is likely the cost associated with deeply sequencing libraries purely to determine the degree to which they differ. This has almost certainly also been a barrier to advances in single-cell library protocols: evaluating each protocol variation is a major cost. Because of its accuracy, our estimator completely eliminates the cost barrier to developing and refining single cell library protocols. Libraries can be constructed and their deep properties inferred with high accuracy without actually deeply sequencing. To illustrate this concept, we examined a multitude of low-coverage single-cell sequencing experiments from a variety of recent human studies (). We limited our analysis to 209 libraries with at least 500 M total nucleotides mapped to autosomes (equal to 0.17  coverage). Because our error in estimating genome coverage increases with fold-extrapolation, we downsampled all libraries to exactly 500 M nucleotides mapped to the autosomes, avoiding any effects of variable initial sample size. We estimated genome coverage using a bin size of 5. We then compare the estimates at 10 gigabases (% 3:5 coverage) and 30 gigabases (% 10:4 coverage) mapped to the autosomes. A summary of all libraries can be found in. Karyotype and ploidy can have a major impact on the apparent genome coverage in a single-cell experiment. Conceptually, higher copy-number for chromosomes, or large parts thereof, means greater opportunity to observe reads mapping back to the corresponding part of a reference genome. It can be difficult to resolve such issues for an individual cell without prior knowledge of genotype. In terms of our evaluations, these difference mean that cells of differing karyotype or ploidy may not be directly comparable. For examplehad to restrict their comparison to the MALBAC method in diploid data to only a few chromosomes of the original data () and to pooled haploid libraries () due to unusual karyotype of the cell line used to benchmark the method. To test the effect of ploidy we take matching first and second polar bodies from, resulting in 42 paired samples. Every pair was excised, prepared, and sequenced at the same time, which we hope will result in minimal batch effects. We find that the diploid libraries have significantly higher coverage than the haploid libraries for all levels of coverage considered (Supplementary), confirming that ploidy has a significant effect on dropout.We next examine the differences in library preparation protocols, keeping libraries from haploid and diploid cells separate. For the haploid case, two studies have produced data from human sperm cells amplified using MDA () and second polar bodies and female pronuclei amplified with MALBAC (). We observed a significant difference in estimated coverage for both 3.5 extrapolation and 10.4 extrapolation (and b, two-sided t-test P55E  11 for both the 3.5 and 10.4 coverage). With only one study for each group we can not identify if the difference is due to the differing protocols (MDA or MALBAC) or other factors. For the diploid case data from four protocols is available: (i) first polar bodies () and circulating tumor cells () amplified with MALBAC; (ii) neurons () and a single lymphocyte () amplified with MDA; (iii) neurons () amplified with MIDAS; and (iv) breast tumor cells () and neurons () amplified by SigmaAldritch GenomePlex universal oligonucleotide primers (GP). MALBAC and MDA libraries exhibit significantly higher expected genome coverage than those based on MIDAS or GP, at both depths considered (). MALBAC and MDA also exhibit substantial variability in expected genome coverage; these are the only protocols for which data was used from multiple studies. For MALBAC, the three libraries showing lowest expected genome coverage are from circulating tumor cells (the three lowest MALBAC points in). These have the possibility of being polyploid or aneuploid, so by the logic above we would expect these libraries to have predicted genome coverage at least that of the diploid first polar bodies. This indicates that cell type and lab (which would account for slight differences in library preparation protocol) may account for a large portion of the variability and there are opportunities for optimization of protocols to improve whole genome amplification.
DISCUSSIONWe described a method for predicting the genome coverage gained from deeper sequencing of a single-cell genome sequencing library based on a compound Poisson model of sequencing. By ignoring local dependence, we can approximate the number of bases covered by additional sequencing with a non-parametric empirical Bayes estimator. This estimator is extremely accurate for predicting additional coverage from relatively small amounts of additional sequencing but suffers from large instabilities for large amounts of additional sequencing. Applying rational function approximations removes the instability and allows us to make accurate long-range predictions. The running time of the algorithm may be unreasonably long for single base resolution estimates. To facilitate researchers in obtaining quick and accurate estimates, we introduced a strategy to reduce the running time of the algorithm significantly, with a small cost in accuracy, by randomly binning reads. By choosing the bin size, the researcher has the option to control how quickly estimates can be obtained, keeping in mind the trade-off of accuracy and variance. There is appreciable variability in genome coverage both for the deeply sequenced libraries and for the extrapolated lowcoverage libraries; this variability exists even for libraries originating in the same lab using the same protocol. In such cases our method can help for selection of the best libraries to sequence deep. This can help researchers in knowing the trade-off between sequencing depth and observed loci prior to committing resources for deep sequencing. This is particularly important for studies involving single nucleotide variation that require deep sequencing rather than broader variation such as copy number variation. One field where this is becoming increasingly important is full genome pre-implantation genetic diagnosis, which until recently was considered impossible due to technological constraints (). Finally, a major barrier to the development of new technologies or optimization of current protocols is the resources required to compare genome coverage across libraries. Naive use of shallow test sequencing runs to compare libraries is often misleading, as samples that initially appear to be high complexity may suffer from large locus dropout (Supplementary). The method we have presented can provide the information required for deep evaluation of libraries without deep sequencing. Though we presented our analysis to the problem of sequencing single human cells, the method is equally applicable to sequencing projects with a reference genome from low () or highly degraded (Pr  ufer et al., 2014) input, bacterial samples with a reference genome, or when mapping to a reference genome of a closely related species with unknown overlap ().
ACKNOWLEDGEMENTWe would like to thank Manuel Lladser, Michael Waterman and Norm Arnheim for their helpful discussions and insight. We would also like to thank the Smith lab group for their comments, help and patience.n = 90 n = 11 n = 90 n = 11 n = 63 n = 9 n = 3 n = 33 n = 63 n = 9 n = 3 n = 33Conflict of interest: The authors are co-inventors of a patent application related to the topic of this manuscript. Non-commercial use of the method and associated software is free of charge and Open Source software has been provided by the authors.
at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
T.Daley and A.D.Smith at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
Modeling genome coverage in single-cell sequencing at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
