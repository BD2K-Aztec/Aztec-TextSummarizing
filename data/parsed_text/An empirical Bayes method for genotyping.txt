Motivation: The development of next generation sequencing technology provides an efficient and powerful approach to rare variant detection. To identify genetic variations, the essential question is how to quantity the sequencing error rate in the data. Because of the advantage of easy implementation and the ability to integrate data from different sources, the empirical Bayes method is popularly employed to estimate the sequencing error rate for SNP detection. Results: We propose a novel statistical model to fit the observed non-reference allele frequency data, and utilize the empirical Bayes method for both genotyping and SNP detection, where an ECM algorithm is implemented to estimate the model parameters. The performance of our proposed method is investigated via simulations and real data analysis. It is shown that our method makes less genotype-call errors, and with the parameter estimates from the ECM algorithm, it attains high detection power with FDR being well controlled. Availability and implementation: The proposed algorithm is wrapped in the R package ebGenotyping, which can be downloaded from http://cran.r-project.org/web/packages/ebGenotyping/.
IntroductionNext-generation sequencing (NGS) technology produces vast amount of sequencing data at an unprecedented low cost, which totally changes the landscape of identification of genetic variations (). Thanks to its high-throughput capability, NGS provides a direct and powerful approach to the detection of rare variants (). It makes it possible to explore the DNA sequence at nucleotide level and identify mutations through single-sample analysis. However, it is demonstrated that multi-sample sequencing can increase the detection power and has better false positive control than single-sample sequencing (), therefore, multi-sample sequencing is more widely used in the genomic research, and the analysis tools for multi-sample sequencing data are always in high demand. As the most common type of sequence variations, the single nucleotide polymorphism (SNP) plays an important role in genetic evolution. The existence of SNPs changes the genotypes of sequenced sample different from the reference genome, resulting in the nonreference alleles being observed in the alignment data. On the contrary, the genomic positions with frequent non-reference alleles indicate potential SNPs. Nevertheless, the NGS data analysis pipeline is a complex process. Many factors during this process may contribute to the non-reference alleles, including not only the sample preparation, and PCR amplification during the sequencing experiment, but also the algorithms used for base calling and alignment. All the alleles different from the genotype allele due to these factors are called as sequencing errors. The existence of sequencing errors makes SNP detection much more challenging than expected. The main task of SNP detection is to evaluate the sequencing error rate in the data, in order to distinguish SNPs from the sequencing errors. The base calling quality and mapping quality scores are widely used to quantity the sequencing error rate in the NGS data for SNP detection, such as GATK (), SAMtools (), SOAPsnp (), FreeBayes (https:// github.com/ekg/freebayes), Atlas-SNP2 (), etc. With an arbitrary prior, they employ the classical Bayes model to call the genotypes according to their posterior probabilities, and then call SNPs by comparing to the reference genome. Although the quality scores reflect the magnitude of the sequencing error rate to a great extent, they still have some limitations. First, the quality scores may not be able to fully account for the sequencing error rate due to the complexity of NGS data analysis pipeline.propose to incorporate the sample preparation error in single-sample analysis to evaluate the sequencing error rate. Their method, as well as the corresponding multi-sample method MultiGeMS (), outperforms other SNP callers. Second, processing the quality metrics is computationally intensive and those algorithms are usually not applicable across different experimental platforms. Third, using the quality scores to determine the sequencing error rate ignores the common information from repeated alleles, such as the sequencing error rate related to the local DNA content, which is shared by the alleles aligned to that DNA region from different samples (). Recently, more and more SNP callers based on the empirical Bayes method were proposed, where the sequencing error rate is set to be an unknown parameter and empirically estimated from the data.assume that different samples have the same sequencing error rate at each genomic locus, and use the allele frequency data from all of the samples to estimate it.employ a Dirichlet mixture model to fit the frequency vectors of four nucleotides at all the genomic loci of different samples, and combine all the data to estimate the model parameters.decompose the sequencing error rate into three types of variations, i.e. sample effect, positional effect and finite depth, and integrate the data across samples and genomic locations to estimate them. Besides, Zhou (2012) andutilize the empirical Bayes method for pooled sequencing data analysis. Comparing to the classical Bayes models, the empirical Bayes method can combine the information from different samples at different genomic sites to improve the estimation for model parameters (). In this paper, we focus on the multi-sample sequencing data from the diploid organism. At each genomic locus, only three possible genotypes are considered, i.e. homozygous reference (RR), which is non-SNP, heterozygous SNP (RV) and homozygous SNP (VV). Although this may cause the incorrect genotype calls at triallelic sites, it need not significantly affect the results but highly reduces the computational burden (, Supplementary Material). With this assumption, the Binomial model is a natural choice to fit the allele frequency, as didassume the independence between different genomic sites and estimate the sequencing error rate site-by-site, whileintroduce the sample effect and integrate the data not only across samples but also genomic sites to estimate the sequencing error rate. Comparing toimprove the statistical model to admit heterogeneity among samples. However, since their model is built to fit the sequencing error frequency which is not observable, they have to incorporate a pregenotyping step. Besides, due to the complexity of the model, they estimate the parameter using the median method and approximate the logit-normal by Beta distribution to calculate the posterior distribution. We modify the decomposition in Muralidharan et al. (2012a) and propose a novel statistical model for both of genotyping and SNP detection. The model is established to fit the observed allele frequency data, so we do not need any pre-processing analysis. Moreover, benefitting from the modification, instead of the approximation methods, we implement an ECM algorithm () to estimate the model parameters, and utilize the empirical Bayes method to genotype samples and call SNPs with false discovery rate (FDR) control. The rest of the paper is structured as follows. In Section 2, the statistical model and ECM algorithm are introduced. Their performance is illustrated via simulations in Section 3 and two real datasets in Section 4. Finally, we give a short discussion in Section 5.
MethodsConsider there are n sequenced samples and m genome sites. Let N ij be the total number of aligned reads of sample j covering the genomic locus i, and X ij be the number of non-reference alleles among N ij. We assume that X ij $ BinN ij ; p ij ;where p ij is the probability that a non-reference allele is being observed at this position, and BinN; p indicates the Binomial distribution with size N and success probability p. As mentioned previously, both the sequencing errors and SNPs can cause the nonreference alleles. Let Z ij be the genotype of sample j at the genomic site i. In the simple case that there are no sequencing errors, p ij  0 for Z ij  RR; p ij  1=2 for Z ij  RV, and p ij  1 for Z ij  VV. However, the existence of sequencing errors makes the modelling of p ij difficult. Denoting by / ij the sequencing error rate of sample j at genomic locus i, Muralidharan et al. (2012a) decompose logit/ ij  into three components, i.e. logit/ ij  l i  d j  ij , where l i is the positional effect, d j is the sample-specific effect, and ij follows a normal distribution N0; r 2 j  measuring the variation within a sample caused by finite depth. The l i , d j and r 2 j are all unknown parameters and need to be estimated from the data. Due to the fact that the sequencing errors are unobservable, they have to involve a pre-genotyping step to remove the genotype effect on the observed allele frequency data to estimate those parameters. The pre-processing analysis not only involves additional computations, but also may introduce errors. In order to model the genotype effect on the non-reference allele frequency, we define a latent variable Z ij to indicate the unobserved genotype. As stated previously, only three possible genotypes are considered, therefore Z ij is coded as-1, 0 and 1 corresponding to the genotype RR, RV and VV, respectively. When Z ij  1 (RR), the non-reference alleles are sequencing errors, so p ij  / ij. When Z ij  1(VV), the reference alleles are errors, so that p ij  1  / ij. When Z ij  0(RV), the error probability of R being called as V equals to that of V being called as R, resulting in p ij  1=2. In summary, the model is presented as follows:XNote that we exclude the finite sampling effect ij from the decomposition of logit/ ij , since the Binomial distribution accounts for the sampling variation due to finite depth. We assume Z ij , i  1, 2,. .. , m, j  1, 2,. . ., n, are independently and identically distributed with PrZ ij  1  p 1 ; PrZ ij  0  p 0 ; PrZ ij  1  p 1 , and p 1  p 0  p 1  1. The unknown parameters l i , i  1, 2,. . ., m, d j , j  1, 2,. . ., n, p 1 and p 0 are estimated and used to calculate the posterior probabilities ofFor SNP detection, we propose using the posterior probability b z ij;1 as the estimate for local FDR, according to the definition in Efron (2010). Given a pre-specified cutoff a, the positions with b z ij;1 smaller than a are called as SNPs, and non-SNPs otherwise. In order to estimate the unknown parameters in our model, instead of the median method for approximate estimation, we implement an ECM algorithm (). It is clear that the complete log-likelihood function isGiven the parameter estimates from the kth iteration, in the k  1th E-step, we haveIn the k  1th M-step, p 1 and p 0 admit closed-form maximizers, i.e.The other parameters do not have closed-form maximizers. According to the ECM algorithm (), in order to simplify the optimization, we partition the parameter spaceIt indicates that optimizing Q c over l reduces to optimizing Q ci over l i , where Q ci is the ith element of Q c in the summation, i.e.According to this property, we utilize the bisection method to find the unique maximizers l k1 i of Q ci , given thatThe parameter d shows the same property as l, and then is updated similarly,. The E-step and Mstep iterate until the parameters converge. The model has the nonidentifiability problem if we do not set any constraints on the parameter space, as discussed in. It is necessary to restrict / ij < 0:5, i.e. l i  d j < 0. In the above bisection method, we search the interval M;, where M is a large positive constant, being set to be 10 as default in our algorithm.
SimulationsThe performance of our proposed method is investigated via simulations. The numbers of non-reference alleles X ij and coverage N ij of n  300 samples at m  10 000 genomic sites are randomly generated. Without loss of generalization, we set the first m 0  9500 loci not bearing any SNPs and all the SNPs are distributed in the last m 1  500 genomic sites. At the SNP locus, let Q be the probability that a sample carries SNP, and R be the probability that the SNP is homozygous. We set Q  0.05 or 0.8 to reflect the rare or common variant, respectively, and let R  0; 0:8 or 1 indicate different types of mutations. Given Q and R, the genotype indicators Z ij  mn are generated from the binomial distributions Bin1; Q and Bin1; R. The positional effects l 1 , l 2 ,. . ., l m are independently generated from a distribution F and sample effects d 1 , d 2 ,. . ., d n are from a distribution G. We set F and G to be 3  n or the degenerate distribution at-3, corresponding to whether or not there exists the positional effect or sample effect, where n is a random variable following the Gamma distribution with shape  2 and scale  1/2, C2; 2. Note that the distribution of F or G does not affect the performance of our proposed method, since we do not make any assumption on the distribution of l i , i  1, 2,. . ., m, or d j , j  1, 2,. . ., n in the estimation, but treat all of them as unknown parameters and estimate them from the data. Let / ij  expl i  d j =1  expl i  d j . Given the coverage N ij from BinN; 1=2, X ij is generated from the Binomial mixture distribution BinN ij ; p ij , where p ij  / ij when Z ij is RR, 1/2 when Z ij is RV, and 1  / ij when Z ij is VV. We vary F, G, Q, R and N and get a series of simulation experiments with different parameter combinations, as listed in.An empirical Bayes method for NGS multi-sample genotyping and SNP detection
GenotypingWe calculate the genotype-call error rates of the proposed method in all simulation experiments, and compare them to that of. Note that at most positions, where the non-reference allele frequencies are close to 0, 1/2 or 1 with sufficient coverage, no matter which methods are used, their genotype-calls are similar. The differences only happen at the less ambiguous positions. Therefore, even though the absolute differences in the genotype-call error rates may not be so big, it indicates the significant improvement in genotyping, especially at the positions where one often makes mistakes. In order to clearly show the difference in genotype-call error rates of both methods, we present their log 10 (genotype-call error rate) in, where a larger entry indicates a smaller genotype-call error rate. It is shown that, both of our method and Martin et al. (2010) can focus on the genotype estimation for each individual sample, so that decreasing Q from 0.8 to 0.05 does not increase their genotype-call error rates, demonstrating their efficacy for rare variation detection. The experiment with Q  0.05 even presents less genotype-call errors than that with Q  0.8, since smaller Q indicates less samples mutate into RV, that do not make contributions to the parameter estimation. As the coverage determination parameter N increasing from 50 to 100, our genotype-call error rate decreases as expected. In particular, when the sample effect exists, the advantage of our method becomes more significant, as shown in experiments 2,call genotypes independently for each genomic locus, and at each locus, a homogenous sequencing error rate is assumed across all of the samples. In contrast, our model admits the heterogeneity among samples, and integrates the data across both of samples and genome loci to estimate the sequencing error rate, resulting in less genotype-call errors.
SNP detectionGiven different cutoff values a, we identify SNPs according to b z ij;1 in each simulation experiment. For comparison, we implement the method of Muralidharan et al. (2012a) by a naive mixture model for pre-genotyping and the median method for the parameter estimation. After getting the P-values from the Binomial-Beta distribution, they are randomized and analyzed by the FDR method using R package locfdr (,b) for SNP detection. Moreover, in order to illustrate the advantage of ECM algorithm, after getting the parameter estimates from our method, we also calculate the P-values, then randomize them and use locfdr to call SNPs. We denote this procedure by ECM-M. The detection powers and FDRs of our proposed method,and ECM-M are presented in Tables 2 and 3, respectively. We only show the results with a  0:01 for illustration. For more results, please refer to the Supplementary Materials. As shown in Tables 2 and 3, our method performs very similarly to ECM-M across all of the simulation experiments, demonstrating the feasibility of posterior probability b z ij1 for multiple testing adjustment. Both of these two methods achieve high detection powers with FDRs controlled at the nominal level, even with the low coverage when N  50. Except in experiments 12 and 16, their powers are all greater than 0.95. As N increasing from 50 to 100, the detection powers in experiments 12 and 16 rise up to 0.98, too. The FDRs are well controlled across all of the experiments, except in experiments 8, 16 and 24, where both of the positional effect and sample effect exist, and large FDRs are expected. The existence of both the positional effect and sample effect greatly increases the probability to get a too large sequencing error rate, causing RR is very likely to be wrongly called as RV. Although it does not influence the detection power, the number of false positives, therefore FDR, increases. In contrast, the performance ofis not so satisfied. In experiments 7, 9 and 19 when N  50 and experiments 9, 17 and 21 when N  100, it fails in fitting the empiricaldistribution and reports errors while running locfdr, whereas ECMM does not. It seems that the parameter estimation is crucial to the results of SNP detection and ECM algorithm is necessary to be implemented to estimate the unknown parameters. In the successful experiments, the detection power and FDR of Muralidharan et al.(2012a) are not comparable to that of ECM-M and our method, especially in some experiments as shown in Tables 2 and 3, the detection power of Muralidharan et al. (2012a) goes remarkably low and its FDR runs out of control.
Real data analysis
Ovarian cancer transcriptomes dataTo evaluate the SNP detection method developed for single-sample analysis,provide the sequencing data of 16 ovarian cancer transcriptomes, and obtain their genotypes with highconfidence (>0.99) through the Affymetrix SNP 6.0 high-density genotyping arrays. Although there are 9000 genomic loci from each sample and a total of 144 271, we only retrieve the sites overlapped by 16 samples to illustrate our method for multi-sample analysis, consisting of 1715 loci. According to the genotyping arrays,denote by 1 or 0 to indicate whether or not it is a SNP at each genomic locus of each sample. For comparison, we convert the genotype-calls of our method andfrom RR to 0 and both of RV and VV to 1, resulting in 3.13% errors using our method among 16  1715 positions, which is less than the error rate 3.95% of. Given different a, the detection powers and FDRs of our method, ECM-M andare listed in. As similarly shown in the simulations, our results are very close to that of ECM-M, but the detection power of our method is slightly higher. Both of these two methods attain the satisfied detection powers with FDRs being well controlled. Whereas,present significantly lower detection powers and larger FDRs.
Human genome dataIn addition to the ovarian cancer transcriptomes data, we also apply the proposed method to human genome data sequenced from 13 samples (). These 13 samples include NA12878, NA12877 and their 11 offsprings NA12879, NA12880, NA12881, NA12882, NA12883, NA12884, NA12885, NA12886, NA12887, NA12888 and NA12893. A VCF file containing the SNPs identified bycan be downloaded from the FTP server (ftp://ftp-trace.ncbi.nih.gov/giab/ftp/data/NA12878/analysis/RTG_ small_variants_01132014/phasing_annotated.vcf.gz). Besides the coverage and the non-reference allele counts, the ground true genotypes which can be treated as the benchmark are included. For illustration, we only retrieve the data on the first chromosome, where there are 437 414 sites overlapped by 13 samples. According to the benchmark genotypes, the majority of 13  437 414 positions are true SNPs. The percentages of RR, RV and VV are 28.46, 46.68 and 24.86 %, respectively. The genotype-call error rates from our proposed method andare 8.92 and 16.77%, respectively. We make much less genotype-call errors. It seems that the heterogeneity exists among different samples. By taking the sample effect into consideration, our method significantly improves the genotype-calls. The SNPs are called using the proposed method, ECM-M and, respectively. However, both of the last two methods report errors in running locfdr. The FDR method used in locfdr is developed with the assumption that there are only a few SNPs, so fitting the empirical distribution can serve as the null distribution. However, for this dataset, where the positions are SNPs called byand true SNPs dominate, the fitting is more likely to fail. Even if it has not failed, it is risky to use the fitted distribution as null. In, we only present the results of ourAn empirical Bayes method for NGS multi-sample genotyping and SNP detectionmethod. Given a ranging from 0.001 to 0.1, we consistently get over 87% detection power with FDR controlled under 0.01.
DiscussionIn this paper, we propose a novel statistical method for both of genotyping and SNP detection using multi-sample NGS data. Instead of pooling the multi-sample data as single-sample or pooled sequencing data, we build the statistical model to integrate information across different samples and genomic sites, to make the genotype-call and identify SNP at each locus for each sample. This offers our method high detection power for both common and rare SNPs, as illustrated in the simulations and real data analysis. In the proposed model, the sample effect is a constant across all of the genomic sites. Sometimes, it may be not feasible, since as mentioned previously, the sequencing error rate may be affected by the local DNA contents, repetitive regions, etc. We suggest to cut the whole genome into small-pieced regions and analyze them in the piece-wise manner. This not only can solve the heterogeneity issue in the sample effect, but also helps to implement the computation in a parallel way, which will greatly reduce the computation duration for huge data analysis.
FundingThis work was supported by the National Natural Science Foundation of China
at University of California, Los Angeles on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
1 1 9 1 1  17 1 1 1 2 1 1 1 10 .99 .99 .49 18 1 1 1 3 1 1 .99 11 .98 .98 .48 19 1 1  4 .99 .98 .82 12 .88 .87 0 20 .99 .99 .89 5 1 1 1 13 1 1 1 21 1 1 1 6 .99 .99 .99 14 .99 .98 .98 22 1 1 1 7 1 .99  15 .99 .98 .98 23 1 1 1 8 .98 .98 .71 16 .93 .93 0 24 .99 .99 .88 N  100 Exp P P E P M Exp P P E P M Exp P P E P M 1 1 1 1 9 1 1  17 1 1  2 1 1 .99 10 1 1 .36 18 1 1 1 3 1 1 .98 11 1 1 0 19 1 1 1 4 1 1 .96 12 .99 .98 .85 20 1 1 .97 5 1 1 1 13 1 1 1 21 1 1  6 1 1 .97 14 1 1 .98 22 1 1 1 7 1 1 .99 15 1 1 .95 23 1 1 1 8 .99 .99 .92 16 .98 .98 .91 24 1 1 .97  indicates failure to report the result.
