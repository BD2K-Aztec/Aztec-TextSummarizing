Motivation: Advances in analytical instrumentation towards acquiring high-resolution images of mass spectrometry constantly demand efficient approaches for data analysis. This is particularly true of time-of-flight secondary ion mass spectrometry imaging where recent advances enable acquisition of high-resolution data in multiple dimensions. In many applications, the distribution of different species from a sampled surface is spatially continuous in nature and a model that incorporates the spatial correlation across the surface would be preferable to estimations at discrete spatial locations. A key challenge here is the capability to analyse the high-resolution multidimen-sional data to extract relevant information reliably and efficiently. Results: We propose a framework based on alternating nonâ€“negativity-constrained least squares which accounts for the spatial correlation across the sample surface. The proposed method also decouples the computational complexity of the estimation procedure from the image resolution, which significantly reduces the processing time. We evaluate the performance of the algorithm with biochemical image datasets generated from mixture of metabolites.
IntroductionImaging mass spectrometry (IMS) is an increasingly popular approach in the characterization of biological samples (). It is a powerful tool to image surface structure with a mass spectrum measured at each pixel. One IMS technique is time-of-flight secondary ion mass spectrometry (TOF-SIMS) with applications in areas as varied as hair care (), medical implants () and drug delivery systems (). It is primarily applied in monitoring the distribution of targeted chemical species, but can also be employed for imaging surfaces in non-targeted analyses, when surface compositions are not well defined, in particular in the analysis of biological systems (). However, this latter extension poses several challenges with respect to data deconvolution. Multivariate analysis (MVA) methods have been used extensively to map large complex spatio-spectral TOF-SIMS data into factors of single components providing insights into the type and distribution of chemical species on a surface. Popular MVA techniques to describe spatiospectral TOF-SIMS data include principal component analysis (PCA) (), maximum auto-correlation factor (MAF) () and multivariate curve resolution (MCR) (). The PCA is perhaps the most commonly used technique, either as a main analysis step () or an initialization step() for MA approach. MAF is an alternative to PCA which is independent of pre-treatment scaling. The method is based on maximizing the autocorrelation between neighbouring pixels. A comparison of the two methods for TOF-SIMS data analysis is reported in, recommending the use of MAF when images with low spectral intensity are analysed. The presence of negative peaks in the spectrum computed using PCA or MAF makes it more difficult to interpret the resulting factorization. MCR optimized by alternating least squares (MCR-ALS) () overcomes this problem by imposing a non-negativity constraint in an iterative optimization process (). However, these methods can be computationally expensive when applied to large three-way datasets. The fast combinatorial nonnegativity-constrained least squares (FC-NNLS) algorithm (Van) is specifically designed to handle such datasets, allowing for significant gains in the speed and computational demands of the optimization process in ALS applications. Despite a substantial performance increase in FC-NNLS, the estimation of loadings and scores when decomposing large TOF-SIMS data in an MCR-ALS algorithm can still be problematic. One limitation is that the complexity of the scores estimation is coupled with the number of image pixels. Therefore, an increase in the image resolution of the sample surface leads to increases in the uncertainty and computational demands of the score and loading estimates. This is becoming increasingly important as sophisticated TOF-SIMS images with higher spatial resolution are becoming more widespread (). Even for a currently typical TOF-SIMS dataset with 128  128 pixels and a spectral mass range up to 1000 Da, the implementation of ALS algorithm with three spectral basis functions contains the estimation of 128  128 3 values in the scores estimation step. This emphasizes the benefit of decoupling the number of pixels in images and the number of parameters. In addition, the progress towards acquisition of image data in voxels as opposed to pixels confers further demand on the analysis time and efficiency of data processing (). Additionally, in cases where the spatial distribution of compounds in an image is continuous such as chemical samples or samples from a biological cell or a cellular environment, the characteristics at proximate/distant regions on the surface are expected to be highly/weakly correlated. This requires the inclusion of the spatial correlation across the surface in the estimation of scores and loadings from TOF-SIMS data. We propose an approach to MCR-ALS that incorporates a continuous-over-space formulation which accounts for spatial correlation across the sample surface. Additionally, the algorithm does not couple the complexity of the estimation procedure to the resolution of TOF-SIMS images, resulting in a significant reduction in the processing time. We exploit the method of a basis function decomposition of scores images which simplifies the estimation of individual pixel values into a set of weights. These weights scale the continuous basis functions and lie in a significantly lower dimensional space. We set out to examine the algorithm with biochemically relevant model image datasets that were generated from simple mixture of metabolites, as an example.
Methods
Dataset descriptionThree metabolites, tyrosine, phenylalanine, and citric acid (all from Sigma Aldrich, UK) were used in the study. The metabolites were spotted on hexamethyldisilazane (HMDS) (Sigma Aldrich) coated silicon wafers (Compart Technology, UK), prepared as detailed elsewhere (). A focused spot of the sample (individual metabolites or metabolite mixture) was obtained, each spot containing about 125 pmole of the metabolite. TOF-SIMS negative ion spectra and images were obtained using a SIMS V instrument (ION-TOF Inc., Germany). Fifty kiloelectron volt Bi  3 was used as the primary ion source for the high current, bunched mode spectral acquisition, with a target current of 0.11 pA and 500 mm 2 field of view. The images collected contained 128  128 pixels. The vacuum in the analytical chamber was held at 10 9 mbar. Primary ion dose was kept below the static limit of 10 13 primary ions/cm 2 to maintain the static SIMS status. Each spectrum was calibrated using hydrocarbon fragment peaks. Spectral data up to m/z 200 was considered for analysis. Image data were exported in ASCII format to MATLAB where it was analysed. Only the intensities at 100 m/z data points were considered for the image analysis of all samples. This included the m/z corresponding to CN  (m/z  26) and the deprotonated metabolite ions M  H  for the three metabolites (as known signals). Dataset contains measurements for three metabolites, tyrosine (T), phenylalanine (P) and citric acid (C), spotted separately as individual 'pure' species and as mixtures, one containing equimolar proportions of tyrosine and citric acid (TC) and another containing all three metabolites in equimolar proportions (TPC).
MCR modelThe spatio-spectral TOF-SIMS data matrix can be described by the bilinear MCR model Yf ; s  WsB > f   Ef ; s;where f denotes the mass-to-charge ratio and s is the spatial location in the two-dimensional physical surface. The superscript > denotes the transpose operator. Each TOF-SIMS image with the dimension of l pixels by l 0 pixels is reshaped to form a column of the p  v data matrix, Y, where p  l  l 0. The TOF-SIMS measurement is factored into a p  m scores matrix, W, and a v  m loadings matrix, B, comprising of m spectral basis vectors. The p  v matrix of residuals, E, is added to account for unmodelled terms and experimental errors. This way spatio-spectral TOF-SIMS data are decomposed into spatial (scores) and spectral (loadings) data matrices which respectively provide information about the distribution and the identity of the species. Each element of Y at a given spatial location can be written as a sum of weighted loadings at a particular peak, where the weights are scores at that spatial location, that is,where w i  and b i  denote the ith weight and spectral basis vectors, respectively.
Estimation algorithmA solution to the MCR model given in Equation (1) can be obtained by minimizing the following cost functionJW; B  kY  WB > k 2 F ;where k  k F denotes the Frobenius norm. This optimization problem can be solved using the ALS algorithm (). When initialized, at each iteration the estimated scores are used to update the loadings. The resulting estimates of the loadings are then used when estimating new scores for the next iteration. The procedure stops when the convergence is achieved. The ALS algorithm is often combined with a nonnegativity-constrained least squares to provide chemically meaningful solutions. In this case, the cost function (
3) becomesJW; B  kY  WB > k 2 F s:t: W; B > 0 (4)where W; B > 0 indicates that all the elements of W and B are nonnegative. Here, we use the FC-NNLS algorithm with ALS (Van) which efficiently solves the nonnegativity-constrained least squares problem. The knowledge of the system's rank or the number of spectral basis vectors, m, is required prior to the ALS algorithm. Here, we use PCA and the scree test criterion as a guide to determine the number of spectral basis vectors. There are more sophisticated techniques that incorporate smoothing methods or subspace comparisons, in order to reduce the effect of measurement noise in the system's rank identification (). The stopping rule adopted is based on observing the Frobenius norms of the successive estimates of W matrices in Equation (4), that is,where q is a threshold value.
Model decompositionTo facilitate the estimation procedure, we use a decomposition using a finite set of continuous basis functions to represent scores images. The proposed model accounts for the spatial correlation across the sample surface. This is preferable to estimations at discrete spatial locations where the distribution of species in the surface is continuous in nature. The decomposition is described bywhere / are known basis functions scaled by unknown weights, a ji , and n is the number of basis functions used to perform the decomposition. The basis functions used here are two-dimensional Gaussian functions given bywhere r / and m / are the basis function width and centre, respectively. These are standard basis functions often used to approximate continuous fields from sampled observations (). They satisfy all the required conditions for reconstruction functions () and have advantageous characteristics:(i) semi-compact support; (ii) dimensionally factorizable, allowing efficient computation in higher dimension and (iii) a closed form Fourier transform which is also Gaussian (). The latter facilitates the determination of the width of the basis functions using spatial frequency analysis described in the following section. Substituting Equation (6) into Equation (2), we obtain a continuous approximation which can be evaluated at f  f v and s  s p asThis formulation accounts for spatial correlation across the sample surface via sum of weighted Gaussian basis functions. This can be written in a compact form as Y  UAB >  E;where A is an unknown n  m weight matrix and U is a constant p  n matrix given byThis representation allows for a more efficient implementation of the ALS algorithm. The complexity of the scores estimation step in the optimization problem given in Equation (4) is directly linked to the resolution of TOF-SIMS images, limiting the applicability of the ALS algorithm to big datasets. However, in Equation (9), the scores matrix is decomposed into two parts: an unknown weight matrix A nm and a constant matrix U pn depending only on basis functions. Therefore, the estimation problem of the scores matrix is simplified to the estimation of a matrix of weights with a significantly lower dimension. Similarly, the decomposition also simplifies the estimation of loadings matrix. This leads to decreases in uncertainty in the score and loading estimates and also improvement in the convergence property of the algorithm. An example of the decomposition of a score image using an equally spaced grid of 9  9 basis functions is shown in. Using the basis function representation, the cost function for the estimation of loadings, B, becomesand A is fixed. The cost function for estimating the weight matrix, A, is given bywhere B is fixed. The matrix, ~ Y, can be calculated once and stored prior to the commencement of the algorithm. Here, the Frobeniusand B is fixed. This way a detailed estimate of the scores images is obtained, while the loadings are still calculated from the reduced continuous representation of scores images. The complete estimation framework is given in Algorithm 1. The minimization of Equations (11), (14) and(15) can be implemented using the MATLAB m-file fcnnls provided by Van Benthem and Keenan (2004). Note, FC-NNLS uses the solution of the overwriting method () to initialize the algorithm.
Spatial frequency analysisThe spatial frequency response of the ion image can be used to specify the width and spacing of the basis functions. The spatial cutoff frequency of the image, c , can be found by calculating its power spectral density. This can be then used to determine the distance between basis functions such that Shannon's sampling theorem is satisfiedwhere q 2 R!1 is an oversampling parameter (). The width of the basis functions is also governed by the spatial cutoff frequency of scores images. For an attenuation of 3 dB at n c , the width of Gaussian's basis functions should be set to (r /  1 pn c ffiffiffiffiffiffiffiffi ln 2 2 r :The number of basis functions can then be specified by dividing the spatial region of interest into D / intervals. From reciprocal role of n c in Equations (16) and (17), it follows that a high cutoff frequency results into a representation which comprises a large number of basis functions with narrow widths. This results into a computationally more complex estimation procedure as a higher number of weights is required to be estimated. Therefore, a compromise should be made between the accuracy and the computational demands of the estimation algorithm. The number of basis functions can be reduced by limiting the spatial bandwidth of the approximated images to a lower value.
ResultsThe proposed algorithm was first implemented on pure species to extract discriminatory information from the estimated scores and loadings. The extracted information was then used to perform peak assignment in the computed spectra of TC and TPC mixtures. During this process, the spectral information was summarized into three major peaks that can differentiate different species. This information was also used to examine replicate measurements of each dataset to further evaluate the performance of the algorithm. The total ion images for each dataset are depicted in Supplementary. TOF-SIMS images were mapped onto 1 1   in both x and y directions and therefore the spatial aspects of the model can be considered arbitrary. Cross-section of the spatial frequency response along the x-axis for TPC mixture is shown in. From this figure, it can be seen that to capture the full spatial bandwidth, c should be set to a high value (% 5:5, shown by blue dashed line),Algorithm 1 Scores and loadings estimation 1. Decomposition:-determine m using PCA,-define basis function centres l using Equation (16),-define basis function widths r / using Equation (17),-construct ~ Y using Equations (10), (12) and (13). 2. Initialization:-initialize the weight matrix, A 0 , as a random dense matrix. 3. scores and loadings estimation:-define stopping condition threshold q,-set k  1, while jjA k  A k1 jj F > q-update the loadings, B k1 , using FC-NNLS and Equation (11),-update the weight matrix, A k , using FC-NNLS and Equation (14),-set k  k  1, end while-update the loadings, B k1 , using FC-NNLS and Equation (11). 4. Estimation of high resolution scores matrices:-calculate W from Equation (15) and the final estimate of B. resulting into a high number of basis functions (a grid of 44  44 with q  2). Alternatively, the configuration can be chosen to represent the reconstructed images up to a specified bandwidth to limit the number of basis functions and hence computational demand of the estimation algorithm. We set the cutoff frequency to c  0:85, giving approximately 10 dB attenuation from the maximum power spectrum. This is shown by a red circle in. In order to account for the slow roll-off in the frequency response of Gaussianbasis functions, the oversampling parameter of q  2 was chosen. Using these values in Equations (16) and (17) yielded the distance between adjacent basis functions' centres D /  0:3 and the width of basis functions r /  0:22. Given the spatial domain of interest, a grid of 9  9 equally spaced basis functions can be used to satisfy Shannon's sampling criterion. With this arrangement, the number of unknown parameters was reduced from m  16 384 to m  81. The pre-processing stage involved normalizing the data to the total ion counts. This was followed by Poisson scaling () for the system's rank analysis. An initial guess of the number of spectral basis vectors, m, for each Poisson-scaled dataset was obtained using PCA and the scree test. The scree plot for the first few principal components is shown in. The results suggested three spectral basis vectors for each of T, P and C elements and two and three spectral basis vectors for TC and TPC mixtures, respectively. The proposed algorithm was then applied on TOF-SIMS datasets to estimate loadings and the corresponding scores images. In the estimation procedure, we set m  3 for all pure and mixed species despite the suggested rank of two for TC compound in the PCA analysis. The results for scores and loadings estimation for T, P and C components are shown in. The m/z number for dominant peaks are illustrated in the loadings plots where the inset figures show the corresponding ion images in the TOF-SIMS dataset.shows large peaks (sorted in order of decreasing magnitudes) at m=z  180:06, 121.02 and 71.01 for the first factor of component T. For component P, the first factor comprises of large peaks at m=z  164:05, 71.01 and 26.01 (). For component C, significant peaks for the first factor are located at m=z  87:02, 41.01, 111.02 and 191.02 (). As can be seen, the M  H  signals for each of the metabolite predominates, but fragment ion contributions also exist. Peaks at m=z  26:01; m=z  27:98 and m=z  136:93 are common between second and the third factors of all components. Therefore, these m/z values do not contain discriminatory information and can be considered noise in the system. In fact, the corresponding scores images of the second and third factors show noisy structures. Also, the peak at m=z  71:01 presents in the first factors. Score and loading estimates using ALS with non-negativity constraint for TPC mixture. (ac) Score estimates; (df) loading estimates of T () and P () and cannot be used to distinguish these species. From this analysis, the characteristic peak for component P can be identified as m=z  164:05, which would be the deprotonated metabolite ion M  H . The result of the algorithm for TC mixture is illustrated in. Similar to the previous example, we associate the peak at m=z  136:93 into the existence of the noise in the system. The peak at m=z  180:06 of the first factor in component T can be also identified inwith its corresponding scores image illustrated in. The same observation can be made for the component C, where three peaks of the first factor, that is, m=z  41:01, 87.02 and 191.02, can be identified (). However, the peaks at m=z  41:01, 87.02 and 111.02 can be putatively identified as fragment ions CHCO  ; C 4 H 7 O  respectively. There are also strong peaks at m=z  121:02 and m=z  183:02 for T (and e, respectively) and at m=z  111:02 for C (); however, these peaks are not present in TC and TPC mixtures. It should be noted that the peaks at m=z  41:01 and 87.02 () are also present in TC and TPC spectra. Although these peaks can provide discriminatory information for the component C, they are fragment ions of the process. The results using appropriate number of spectral basis vectors, that is, m  1 for T, P and C datasets and m  2 for TC dataset, are also provided in Supplementary, showing successful identification of different components in each case. The extracted information was also used to perform similar analysis on replicate images of T, P, C, TC and TPC to further examine the performance of the algorithm on discerning different species. In this case, we used the correct number of spectral basis vectors, that is, m  1, 2 and 3, respectively, for each pure replicate measurements, TC replicate measurements and TPC replicate measurements. The results are given in Supplementary Data, confirming the ability of the proposed algorithm to identify different components. In the case of pure species, the characteristic peak for the component C at m=z  191:02 is dominated by fragment ions, that is, m=z  41:01 and 87.02 (bottom panels of Supplementaryf). However, this peak can be clearly identified from TC and TPC mixtures as is shown in Supplementary Figures S4 and S5. In each experiment, the algorithm was allowed to run for a maximum number of 100 iterations, although typically the change in the weights matrix Frobenius norm dropped below 10 5 after less than 20 iterations. We compared ion image estimates from the full model and the reduced model with TOF-SIMS data using the mean (over spectra) of the root mean square error (MRMSE) over space. The average MRMSE of the image estimates over three replicate measurements are shown in. The slight increase in the error is due to the low-pass action of the basis functions which attenuates the high frequency details of the scores images during the iterative algorithm. A comparison between the convergence of the algorithms when reduced and full models were used is also shown in. Note that for 128  128 pixels images and m  3, each iteration of the algorithm takes 65.3 ms for the full model. This is 7.8 ms when the reduced model is used. We also generated images using random numbers with different pixel densities to compare the computation time for the full model (FC-NNLS) and the reduced model (Algorithm 1 with n  81) using different number of spectral basis vectors. The computation time is approximately 100 times faster when the reduced model is used as is shown in.). The full and reduced models are shown by dotted and dashed lines, respectively
Efficient TOF-SIMS image analysisThis article has presented a novel framework for solving the alternating nonnegativity-constrained least squares using TOF-SIMS measurement. The novel and key developments of the article include a continuous-over-space formulation which accounts for the spatial correlation across the sample surface and decoupling the computational complexity of the estimation procedure from the number of pixels in the ion images. This results in a significant reduction in the processing time that will translate favourably when high-resolution images are analysed and in the analyses of three-dimensional images, where voxels of information require processing. To demonstrate the new methodology, the proposed algorithm was evaluated using image data from simple mixture of metabolites. Although the algorithm performed well, validating the framework on more complex test datasets is still required. Such datasets can include multiple components with similar mass spectrum but different intensities, patterned samples or images with higher pixel densities.
at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
P.Aram et al. at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
and M  H  CO 2  2H 2 O  , respectively. The algorithm performed well in this case where both T and C species were successfully identified. The analysis suggested m=z  180:06 and m=z  191:02 as characteristic peaks for T and C, respectively. The results for the score and loading estimates for TPC mixture are depicted in Figure 6. The algorithm is able to identify all the species, T (m=z  180:06), P (m=z  164:05) and C (m=z  191:02), as is shown in Figure 6(df). Again, the fragment ions at m=z  41:01 and m=z  87:02 are also present in the spectrum shown in Figure 6e. The algorithm is unable to separate the distribution of T (m=z  180:06) and P (m=z  164:05) as is shown in Figure 6a. We attribute this to the peak at m=z  71:01, which is common between T and P species, making it difficult to separate the two types. However, the algorithm can almost isolate the distribution of C component from the mixture. Note a small peak at m=z  191:02 still exists in Figure 6d. From the above analysis, the important peaks required to identify T, P and C components are m=z  180:06, 164.05 and 191.02,
