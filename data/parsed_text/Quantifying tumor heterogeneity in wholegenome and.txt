Motivation: Most tumor samples are a heterogeneous mixture of cells, including admixture by normal (non-cancerous) cells and sub-populations of cancerous cells with different complements of somatic aberrations. This intra-tumor heterogeneity complicates the analysis of somatic aberrations in DNA sequencing data from tumor samples. Results: We describe an algorithm called THetA2 that infers the composition of a tumor sample—including not only tumor purity but also the number and content of tumor subpopulations—directly from both whole-genome (WGS) and whole-exome (WXS) high-throughput DNA sequencing data. This algorithm builds on our earlier Tumor Heterogeneity Analysis (THetA) algorithm in several important directions. These include improved ability to analyze highly rearranged gen-omes using a variety of data types: both WGS sequencing (including low $7Â coverage) and WXS sequencing. We apply our improved THetA2 algorithm to WGS (including low-pass) and WXS sequence data from 18 samples from The Cancer Genome Atlas (TCGA). We find that the improved algorithm is substantially faster and identifies numerous tumor samples containing subclonal populations in the TCGA data, including in one highly rearranged sample for which other tumor purity estimation algorithms were unable to estimate tumor purity. Availability and implementation: An implementation of THetA2 is available at
INTRODUCTIONSeveral recent studies indicate that most tumor samples are a heterogeneous mixture of cells, including admixture by normal (non-cancerous) cells and subpopulations of cancerous cells with different complements of somatic aberrations (). Characterizing this intra-tumor heterogeneity is essential for several reasons. First, an estimate of tumor purity, the fraction of cancerous cells in a tumor, is necessary for accurate identification of somatic aberrations of all types in the sample. Most cancer genome sequencing studies use a re-sequencing approach to detect somatic aberrations. Reads from a tumor sample (and usually a matched normal sample) are aligned to the human reference genome. Differences in the sequence of aligned reads, the number of aligned reads or the configuration of aligned reads (e.g. split reads or discordant pairs) are used to infer the presence of single nucleotide or other small variants, copy number aberrations or structural aberrations, respectively (). However, the presence of intra-tumor heterogeneity can dilute the signals required to identify somatic aberrations. Second, estimates of the composition of a tumor sample including not only the tumor purity, but also the number and fractions of subpopulations of tumor cellsprovide useful for understanding tumor progression and determining possible treatment strategies (). In particular, clonal somatic aberrations that exist in all tumor cells are likely early mutational events and their identification sheds light on the early stages of cancer. Conversely, subclonal somatic aberrations might reveal properties shared by a subset of tumor cells, such as drug resistance or ability to metastasize. Identification of such aberrations and subpopulations of tumor cells might inform treatment strategies, and/or help predict metastasis/relapse. In the past few years, several methods to infer tumor purity and/or tumor composition have been developed. These methods generally fall into two categories: (i) methods that use somatic single-nucleotide variants (SNVs) and (ii) methods that use somatic copy number aberrations. SNV-based methods such as EXPANDS (), PyClone () and many others () use clustering of variant allele frequencies to determine tumor populations and frequencies. While these types of methods are able to derive multiple tumor subpopulations, they often require estimates of copy number for each region containing SNVs. Deriving such estimates for highly rearranged aneuploid tumors is as difficult as the estimation of intra-tumor heterogeneity itself. Moreover, these approaches require high-coverage sequencing to overcome the high variance in read counts at individual SNVs. For example, both PyClone () and PhyloSub () explicitly require deeply sequenced data. Thus, less expensive low-coverage sequence data as generated in TCGA () is not amenable to these approaches. Copy number-based methods such as ABSOLUTE () and CNAnorm () use observed shifts in read depth due to copy number aberrations to predict *To whom correspondence should be addressed. y The authors wish it to be known that, in their opinion, the first two authors should be regarded as Joint First Authors. tumor purity, but do not explicitly consider multiple tumor subpopulations, and therefore may return purity estimates that only reflect a single subpopulation of tumor cells in a sample. In, we introduced the Tumor Heterogeneity Analysis (THetA) algorithm to infer the composition of a tumor sampleincluding both the percentage of normal admixture and the fraction and content of one or more tumor subpopulations that differ by copy number aberrations. In this article, we present THetA2, which extends the THetA algorithm in several important directions. First, we substantially improve the computation for the case of multiple distinct tumor subpopulations in a sample. Second, we extend THetA to infer tumor composition for highly rearranged genomes using a twostep procedure where initial estimates are made using highconfidence regions of the genome, and then are extended to the entire genome. Third, we devise a probabilistic model of B-allele frequencies (BAFs), which can be used to solve the identifiability issue when read depth alone is consistent with multiple possible tumor compositions. Finally, we extend THetA to analyze whole-exome (WXS) sequencing data. We apply our new algorithm to both whole-genome (WGS) (including low-pass) and WXS sequence data from 18 samples from The Cancer Genome Atlas (TCGA). We find that the improved algorithm is substantially faster and able to analyze highly rearranged genomesidentifying numerous tumors with subclonal tumor populations in the TCGA data. Where available, we compare our purity estimates to published values for ABSOLUTE (). While the purity estimates are largely in agreement for higher purity samples, we find cases where ABSOLUTE fails or underestimates purity, but THetA2 identifies multiple tumor subpopulations. These improvements greatly expand the range of sequencing data and tumors for which we can infer tumor composition.
METHODS
Notation and problem formulationWe assume that the reference genome is partitioned into a sequence I= I 1 ;. .. ; I m  of non-overlapping intervals, according to changes in the density, or depth, of reads aligning to each position in the reference (). Given I, we define a corresponding read depth vector r=r 1 ;. .. ; r m  2 N m where r j is the number of reads with a (unique) alignment within I j. A cancer genome is defined by an interval count vector c 2 N m , where c j is the integer number of copies of interval I j in the cancer genome. A tumor sample T is a mixture of cells that contain different collections of somatic mutations, and in particular somatic copy number aberrations. Each subpopulation has a distinct interval count vector representing the genome of the subpopulation. Following the model introduced in, we represent T by:(i) an interval count matrix C=c j;k  2 N mn where c j;k is the number of copies of interval I j in the k th distinct subpopulation; and (ii) a genome mixing vector; and j ! 0 for all jg where k is the percentage of cells in T that belong to the k th distinct subpopulation. Let the interval count matrix C=c 1 ;. .. ; c n , where c j is the j th column of C. We assume that C satisfies three constraints. (i) The first column c 1 =2 m so that the first component of the tumor sample is the normal genome. (ii) The number n of subpopulations is less than the number m of intervals. (iii) The copy numbers of the intervals are bounded below by 0 and above by a maximum copy number k ! 2. Thus, C 2 f0;. .. ; kg mn. We define C m;n;k to be the set of all such C, and define m;n;k =fC; jC 2 C m;n;k ; 2 " n1 g to be the domain of pairs C;  satisfying all constraints. We model the observed read depth vector r using a multinomial probability distribution with parameter p=p 1 ;. .. ; p m , where p j is the probability that a randomly chosen read will align to interval I j. A pair C;  defines a value for the multinomial parameter p= c C= C jCj 1 . Thus, the negative log likelihood LC; jr=  log Multr; c C is the negative log of the multinomial probability of observing counts r in the intervals given the probability of a read aligning to an interval is defined by c C. The goal is to find the interval count matrix C  and genome mixing vector  that minimize the negative log likelihood: C  ;  =argmin C;2m;n;k LC; ; r  1
Interval count matrix enumerationIn this section, we derive an improved procedure to solve the optimization problem (1). In, we showed that the function LC; ; r is a convex function of. Thus, for a fixed interval count matrix C, the optimal value of can be computed efficiently. In the important special case of a mixture of normal cells and a single tumor population (n = 2), we reduce the domain of the interval count matrix C to a set whose size is polynomial in m and guaranteed to contain the optimal C . This set is easy to enumerate, and we obtain an efficient algorithm. However, when a tumor sample contains multiple tumor subpopulations (n42), the algorithm inenumerates all C 2 C m;n;k and checks whether each such C satisfies a particular ordering constraint that is a necessary, but not sufficient, condition for the optimalIn this section, we derive an algorithm that explicitly enumerates only those matrices C that satisfy a more restrictive necessary ordering constraint for a mixture of any number of tumor genomes. All proofs are contained in the Supplementary Material.
Compatible orderWe say that vectors v=v 1 ;. .. ; v m  and w= w 1 ;. .. ; w m  2 R m have compatible order provided all 1 i; j m; v i v j if and only if w i w j. Inwe proved that if C  ;   is optimal [i.e. satisfies] then d C   and r have compatible order. We define S m;n;k to be the set of matrices C 2 C m;n;k that satisfy this ordering constraint: i.e. S m;n;k =fCjC 2 C m;n;k and 9 2 " n1 such that c C is in compatible order with rg. Thus, to find the optimal solution C  ;  , it is sufficient to examine matrices C 2 S m;n;k. Without loss of generality, we assume that the read depth vector r= r 1 ;. .. ; r m  satisfies r 1 r 2. .. r m. Thus, the set S m;n;k = fC 2 C m;n;k j C   1 C   2. .. C   m for some 2 " n1 g. For a matrix C 2 C m;n;k , the set of that result in a compatible ordering can be calculated using the function  C   as follows:Thus, a matrix C 2 S m;n;k if and only if  C   is not empty. Corollary 2.1 follows directly from Equation (2).2.2.2 Using a graph to enumerate S m;n;k We now present an algorithm to enumerate S m;n;k for n ! 2. Consider a complete (including self loops) directed graph G n;k , with a vertex for each possible row in a matrix in C m;n;k. Paths on G n;k of length m  1 correspond to matrices in C m;n;k (Seeand Supplementary).To enumerate the subset of paths on G n;k that correspond to matrices in S m;n;k , we use a depth-first search. While building paths, we calculate the set  for the matrix implied by the current path, and only proceed down branches that do not result in the empty set (see Supplementary Material for details). As a result, we are guaranteed to enumerate only the matrices in S m;n;k. Corollary 2.1 allows us to reduce the graph G n;k by showing that there are certain edges that will never appear in paths that correspond to matrices in S m;n;k , and thus can be removed from the graph before matrix enumeration. In the case where n = 3, the calculation of  is reduced to a problem in a single variable, 2
Interval selection Weautomate the selection of a subset of high-confidence intervals used to determine the optimal C  ;   for those intervals. Further details are included in the Supplementary Material. Briefly, we partition I into two sets of intervals:(i) I H high-confidence intervals; (ii) I L lower-confidence intervals. I H is selected to contain up to a fixed integer d longest intervals from I such that each interval selected is longer than a predetermined minimum length and is not obviously amplified beyond the specified max copy number k. I L contains all remaining intervals from I. Additionally, I H must represent 410% of the total length of all provided intervals, otherwise the sample is determined not to be a good candidate for analysis using THetA2. Once I H and I L have been selected, we use the improved THetA2 algorithm described in the previous section to calculate C  H and  H for just the intervals in I H .
Determining additional copy numbers: single row GivenC  H ;  H  predicted for high-confidence intervals I H , we infer copy numbers for the remaining intervals I L. We start with the simplifying assumption that jI L j=1. We prove the following theorem. THEOREM 2.1. Let C=c i;j  be an interval count matrix. LC; jr is a convex function of c i;j .We use Theorem 2.1 to find the optimal real-valued solution for the c i;j 's corresponding to the single interval I 2 I L , given C  H and  H. We then check the surrounding integer values to find the integral solution, which, by convexity, is guaranteed to find the optimal integer solution.
Determining additional copy numbers: multiple rows In theprevious section, we showed how to find the optimal copy number for a single additional interval in I L given optimal values C  H , and  H for a set of high-confidence intervals I H. To estimate copy numbers when I 2 I L contains more than one interval, we estimate the optimal copy numbers for each interval in I 2 I L when appended to C H individually as described in the previous section, and then jointly append all inferred copy numbers to C  H to obtain a new matrix C H [ L. We then return the solution C H [ L ;  H . We note that this approach provides no guarantee for finding the optimal copy numbers across all I 2 I L given C  H , and  H. However, in practice, we find that the solutions returned by our procedure are generally similar to this optimum (Supplementary).
Model selectionAs in, we use the Bayesian information criterion (BIC) to select from different sized models (i.e. different numbers n of tumor populations) and their corresponding maximum likelihood solutions. We use the standard BIC of 2logL+alogb where L is the likelihood of a solution, a=m+1n  1 is the number of free parameters in the model and b is the number of data points (the total number of tumor and normal reads). In contrast, Oesper et al. (2013) used a modified BIC that more strongly penalized solutions with more tumor populations. Such a modification is not necessary here, as our improved algorithm considers copy number data across the entire genome, rather than only a small number of intervals, reducing the possibility of overfitting. Thus, we are able to more robustly identify samples with multiple subpopulations of tumor cells.Here 2 i is the observed variance for all heterozygous SNPs in v that lie within interval I j, and j is the expected BAF deviation away from 0.5 given C and. See the Supplementary Material for further details.
Probabilistic model of BAFs
Application to WXS dataFinally, we extend THetA2 for WXS data, where only the coding regions of the genome have been targeted for sequencing. From WXS data we need to infer the following two values: (i) a set of non-overlapping intervals I=I 1 ;. .. ; I m  in the reference genome; and (ii) a corresponding read depth vector r=r 1 ;. .. ; r m . To infer the interval partition I, we rely on recently developed algorithms such as ExomeCNV () and EXCAVATOR () for segmentation and detection of copy number aberrations from WXS data. The segmentation returned by one of these algorithms may contain gaps rather than being a complete partition of the reference genome, but still provides a set of non-overlapping intervals that may be used as input to THetA2. We note that some methods use normalization procedures for GC content, mappability and even exon length and this information is therefore implicitly incorporated into the input provided to THetA2. We compute the read depth vector r=r 1 ;. .. ; r m  for WXS data as follows. Given a set I of non-overlapping intervals in the reference genome, a set E of exons in the reference genome and a read length ', we set r j = xj ' where x j is the total number of sequenced nucleotides that have a unique alignment to some exon e 2 E within interval I j. Thus, r j is approximate count of the number of reads aligning to some exon located in interval I j .
RESULTSWe ran THetA2 on simulated data, WGS (including low-pass data 57 coverage) and WXS data from 18 breast carcinoma, ovarian carcinoma, glioblastoma multiforme, kidney renal clear cell and lung squamous cell carcinoma samples from TCGA (Supplementary). Where available, we compare our estimates of tumor purity to the estimates reported by the ABSOLUTE algorithm () that estimates purity from SNP array data. The rest of this section is organized as follows. First, we discuss results on simulated data. Second, we demonstrate THetA2's performance on WXS data, including comparison of results for samples for which both WGS and WXS data were available. Next, we present in-depth analysis of several WGS samples to demonstrate the efficacy of THetA2 on highly rearranged genomes, using both low-pass and moderate coverage sequence data. Finally, we apply our probabilistic model of BAFs to one sample and disambiguate between two equally likely solutions.
Simulated dataWe tested THetA2 on simulated data to demonstrate the improvements in THetA2 over the original THetA as well as ABSOLUTE. We created simulated mixtures using real sequencing data from an AML tumor sample and matched normal sample (TCGA-AB-2965) from The Cancer Genome Atlas Research Network (2013). This sample was chosen because of its high purity ($95% pure) and lack of copy number aberrations as predicted by array data, providing high confidence that our simulated mixture and implanted copy number aberrations are not confounded by impurity and aberrations in the real data. Simulated mixtures are created by implanting random amplifications and deletions (see Supplementary Material) to create different tumor populations, and then creating a mixture representing different tumor compositions.
Mixtures with three subpopulationsWe find that THetA2 computes the optimal solution orders of magnitude faster than the original THetA (). Using 30 simulated data, THetA2 demonstrates consistent accuracy at estimating (error50.05) and copy numbers in the larger tumor population (error50.1). In addition, the accuracy in estimating copy numbers improves for the smaller tumor population as its proportion increases (). Furthermore, THetA2 has increased performance at estimating copy numbers for both populations when considering only longer intervals. For example, when the smaller subpopulation comprises 0.3 of cells in the sample and we consider only intervals longer than 5 Mb, the error rate for both populations drops 50.06. We see similar trends using 7 simulated data, but the lower coverage results in slightly worse copy numbers estimates (Supplementary). We also directly compare THetA2 with the original THetA on this simulated data. The two-step method enables THetA2 to infer copy numbers for 100% of the genome compared with only 611% of the genome with the original THetA (Supplementary). The expanded fraction of the genome analyzed also translates into a substantial increase in the fraction of genome with correct copy number estimates. In our simulations, THetA2 correctly infers copy numbers for the larger and smaller tumor subpopulation in 8387% and 2872% more of the genome, respectively, than THetA (Supplementary). Using the simulated mixture in, we demonstrate that the improved enumeration procedure in combination with theFig. 2. Runtime comparison and estimation error for THetA2 on simulated data containing a mixture of normal cells and two tumor subpopulations. (a) The ratio of runtimes for the old and new enumeration procedures as a function of the number of intervals used in the first step of the algorithm. (b) Estimation error for both and C for each tumor population (Tum1 and Tum2) as the proportion of Tum2 increases and the proportion of Tum1 is fixed at 0.5. Error for is the Euclidean distance from the true value and error for each tumor population is the fraction of the genome for which the copy number is incorrectly inferred for the all copy number estimates, and when only considering intervals that are longer than 1 Mb and 5 Mb two-step method can lead to improved estimates of both and C. On this mixture, THetA2 is able to reconstruct both tumor populations with accuracy 40.87 () across the entire genome. However, because THetA is only able to consider a small fraction of the genome, when applied to this mixture, it has increased error at estimating and completely misestimates the smaller tumor subpopulation with error of 0.95 across the regions for which copy number estimates were made and error of 0.99 across the whole genome (). We also applied ABSOLUTE () to this mixture, run with default parameters, using the same partition of the genome output by BIC-seq (). ABSOLUTE returns a collection of 12 different solutions, each with a different purity and likelihood (). The most likely solutions returned by ABSOLUTE underestimate purity by at least 0.28 and estimated a tetraploid solution, whereas the true sample has mean ploidy 1.75 and 1.77 in the two tumor populations. Further details are located in the Supplementary Material.
Mixtures with four subpopulationsTo demonstrate the extensibility of the model to greater numbers of subpopulations, we create a simulated 30 coverage mixture containing four distinct subpopulations. Because of the increased runtime when considering larger numbers of subpopulations, we use an alternative segmentation procedure to reduce the total number of intervals (see Supplementary Material for details). We find that on this simulation, THetA2 was able to estimate with 0.05 error, comparable with the accuracy achieved for smaller numbers of subpopulations, and was able to correctly infer copy number for 99.6% of the intervals considered, with the tradeoff of only considering 87.6% of the total genome (Supplementary). Further, we demonstrate how the output of THetA2 changes when the number of subpopulations (n) is fixed below the true number of subpopulations. In particular, we show that in this case THetA2 still provides useful information about the true mixture (Supplementary).
Extension to WXS dataTo demonstrate THetA2's effectiveness on WXS data, we ran THetA2 on Illumina WXS data for the subset of 16 of the 18 tumor samples from TCGA for which WXS data were available (Supplementary). For each sample, we used both ExomeCNV () and EXCAVATOR () with default parameters to determine an interval partition I (see Supplementaryfor the complete WXS workflow). If we assume that the tumor sample is a mixture of normal cells and a single tumor population, then the purity estimates obtained by THetA2 on the ExomeCNV and EXCAVATOR interval segmentations were similar for most samples (Supplementary). The two exceptions were two tumor samples where we find subclonal copy number aberrations (for one example see Supplementary). We found that the presence of subclonal aberrations can result in estimates of purity that are artificially low. For example, a segmentation may not accurately distinguish all the present subclonal aberrations. Thus, in the results below, we use the THetA2 solution with higher purity estimate from the ExomeCNV and the EXCAVATOR segmentations. Further details are in the Supplementary Material.
Comparison of THetA2 with ABSOLUTEOn most samples, THetA2 purity estimates are within 0.08 of the estimates reported by the ABSOLUTE algorithm () (). One example is the glioblastoma sample TCGA-060214, for which we estimate purity of 0.67 compared with 0.66 reported by ABSOLUTE. However, although the purity estimates are similar, THetA2 is additionally able to identify two subpopulations of tumor cells, in 46.4 and 20.1% of cells in sample () and determine which copy number aberrations are part of each subpopulation. There are two samples where THetA2 purity estimates are not in agreement with those reported for the ABSOLUTE algorithm () (). The first is the ovarian carcinoma sample TCGA-29-1768 where we infer multiple tumor subpopulations and report a purity of 0.87 compared with 0.55 reported by. Notably, one of the tumor subpopulations returned by THetA2 is in 54% cells. A possible explanation is that ABSOLUTE reported the purity for the major tumor subpopulation. The second is glioblastoma sample TCGA-060188 which we infer to contain two tumor subpopulations consisting of 43.1 and 20.3% cells. In comparison, ABSOLUTE reports that the sample is highly non-clonal and is unable to estimate purity. Our purity estimate of 0.7 is in the range of 0.60.8 reported by TCGA histopathology reports. We performfurther analysis of this sample and find supporting evidence for our estimated tumor composition (Supplementary). These results demonstrate that consideration of multiple tumor populations may be important for determining tumor purity, especially for samples with large subclonal populations.
Consistency across sequencing platformsTo further validate the results of THetA2 on WXS data, we compared results for the 7 of the 18 TCGA samples for which both WGS (including low-pass with 57 coverage) and WXS sequence data were available. For WGS samples, we partition the reference genome using the BIC-seq algorithm () run with default parameters (see Supplementaryfor WGS workflow). We found that purity estimates for WXS data to be within 0.04 of purity estimates for WGS data for 4 of the 7 samples (). We also compare the copy number aberrations predicted for the different subpopulations between the WXS and WGS data using a similarity measure described incaption. We find that four of the genomes have ! 0.89 similarity under our measure () for the major subpopulation. Notably, we find that THetA2 infers three subpopulations for sample TCGA-06-0214 on both WXS and WGS dataselecting the n = 3 solution over both n = 2 and n = 4 for WGS data (see Supplement) and has similarity 0.92 between the data types for the minor subpopulation. We also found similar copy number similarity results using a less stringent measure that only considers copy number state rather than exact copy number value (Supplementary). These results demonstrate the consistency of THetA2including the inference of multiple tumor subpopulationsacross different types of sequencing data.
Analysis of highly rearranged and heterogeneous genomesOne of the main advantages of THetA2 is the ability to analyze highly rearranged genomes containing many copy number aberrations in one or more tumor subpopulations. We analyze in further detail several highly rearranged genomes that THetA2 predicted to contain subclonal populations from WGS data.
Low-pass breast cancer samples TCGA-A2-A0EU andTCGA-AO-A0JL We used THetA2 to analyze two breast cancer genomes, TCGA-A2-A0EU and TCGA-AO-A0JL, that were sequenced with low-pass (5-7X) WGS sequencing. These are the most rearranged of the breast cancer genomes that we analyzedcontaining many intervals in BIC-seq segmentation (493 and 675 intervals respectively) and more predicted copy number aberrations. We attempted to run ABSOLUTE () on these genomes using the BIC-seq segmentation. However, despite trying a range of values for the parameters, we obtained purity50.3 for both samples. For comparison, we cite the results reported by Yadav and De (2014) on these samples, using ABSOLUTE and a different segmentation. In both samples, THetA2 identifies multiple subclonal populations. We infer that breast cancer sample TCGA-A2-A0EU contains normal admixture with two distinct tumor subpopulations, one with 42.7% cells and another with 34.6% cells (Supplementary). We note that our estimate of tumor purity (0.77) is below the reported histopathology purity of 0.90 for this sample, but closer than the ABSOLUTE estimate of 0.49. We infer that breast cancer sample TCGA-AO-A0JL contains normal admixture with two distinct tumor subpopulations, one with 57.0% cells and another with 30.5% cells (Supplementary). Despite being the most rearranged of the breast cancer genomes analyzed, our estimated tumor purity of 0.88 is near the reported histopathology value of 0.80. In comparison, ABSOLUTE inferred purity of 0.50 for this sample. We are also able to identify a number of clonal and subclonal chromosome arm level events for both genomes (see Supplemental Material), as well as many other small events, thus demonstrating that THetA2 can analyze highly rearranged genomes with low-coverage WGS sequencing data.). With exception of two outlier samples (red triangles; TCGA-29-1768 and TCGA-06-0188), both approaches predict similar estimates on high purity samples: r = 0.9 from Pearson correlation coefficient. Circled sample is TCGA-06-0214, for which both methods agree on sample purity. (b) Tumor composition inferred by THetA2 on glioblastoma multiforme sample TCGA-06-0214. Read depth ratios (dots) within 50 kb bins and the copy numbers (for all intervals 42 Mb) inferred by THetA2 for a mixture of normal cells and two tumor subpopulations. We detect rearrangements common to glioblastoma multiforme () such as amplification of chromosomes 7, and loss of chromosomes 6q, 9p, 10, 13q and 14qWe note that this genome is so fragmented that ABSOLUTE () does not attempt to estimate tumor purity when run with default parameters. Moreover, this sample has so many copy number changes that SNV-based algorithms () would have extreme difficulty in defining regions of normal copy number to analyze. THetA2 infers that sample contains normal admixture with two distinct tumor subpopulations, one with 50.1% cells and another with 18.1% cells (). Using the new two-step procedure, THetA2 also identifies many smaller copy number aberrations (Supplementary) and we find that the read depth predicted using our reconstruction closely matches the observed read depth (). We examine this sample in further detail using B-allele frequency (BAF) information not used by THetA2. We constructed a virtual SNP array defining the BAF at a known germ line SNP to be the fraction of reads containing the minor allele as described in. In diploid regions of the genome that have not undergone any copy number changes, we expect that the BAFs for germ line heterozygous SNPs to be near a value of 0.5, as approximately half of the reads should contain the B-allele. In a pure tumor sample a deletion of a segment on a single chromosome will lead to a loss of heterozygosity (LOH) and BAFs at 0 or 1 in a symmetric double banded pattern centered around 0.5. As the sample become less pure (i.e. more admixture by normal cells), the double banded pattern will shift closer to 0.5. In many of the regions where THetA2 predicted a clonal deletion (i.e. in all subpopulations), such as chromosomes 3, 5q and 18 (), we observe that the BAFs cluster near 0 and 1, as expected for a deletion occurring in a majority of cells in the sample. Similarly, we find that the shifts in BAF are consistent with THetA2's predictions of subclonal deletions in 50.0 and 18.1% of cells (). On chromosome 1p, we observe a discrepancy between THetA2's predictions and BAF. THetA2 predicts that 1p is a clonal deletion; however, the BAFs are clustered tightly around 0.5, indicating an equal number of both parental copies of this region in the tumor sample. One explanation is that 1p is homozygously deleted in one of the tumor subpopulations, rather than a heterozygous deletion in both subpopulations, which would keep the balance of the parental copies of 1p in the tumor sample.
Using BAFsFor glioblastoma sample TCGA-06-0145, THetA2 outputs two possible C;  pairs using only read depth  one largely haploid and one largely diploid. We apply our probabilistic model of BAFs and find that the diploid reconstruction, which includes rearrangements characteristic to glioblastoma such as amplification of chr7 and deletion of chr10 (), is determined to be the more likely tumor composition (Supplementary).
DISCUSSIONWe introduced an algorithm to infer tumor composition  of highly rearranged genomes from WGS (high or low coverage) or WXS DNA sequencing data. These are implemented as improvements to our THetA algorithm. The THetA2 algorithm is able to analyze highly rearranged, aneuploid samples that are beyond the scope of existing algorithms that infer tumor heterogeneity. A recently published comparison of algorithms for inferring tumor purity () showed that our original THetA algorithm () performed well, but sometimes underestimated tumor purity when run to only consider normal cells and one tumor subpopulation. We argue that this purity underestimation is likely a result of not directly considering all tumor subpopulations in the sample. In every sample that we analyzed with the new algorithm, tumor purity was higher when considering multiple tumor subpopulations. Although the improved THetA2 presented here is useful on a wide range of sequencing data from different tumors, some limitations remain. First, THetA2 is unable to distinguish tumor subpopulations that are not differentiated by copy number aberrations. As copy number aberrations are ubiquitous in most solid tumors (), we expect that THetA2 will be applicable to many genomes. However, for some diploid tumors, SNV analysis is preferable. Incorporation of additionaljIWGS j[jIWXS j where I WGS and I WXS are the interval partitions for the WGS and whole-exome data, respectively, and I  is the set of intervals longer than 100 kb contained in both I WGS and I WXS. CNA Sim is the fraction of I  where the copy number estimates are the same between the two data types. *Indicates that the sample did not pass the criteria to be considered for multiple tumor populations (see Supplemental Material). a For sample TCGA-06-0214, WGS data were aligned to hg18 and WXS data aligned to hg19. See Supplementaryfor purity estimates across all genomes analyzed and results using an additional similarity metric. Bolding indicates the sample for which THetA2 can estimate purity, but ABSOLUTE reports as highly non-clonal and is unable to estimate purity. information, such as BAFs for somatic and germ line SNPs, into the model () may also increase the scope of samples for which THetA2 is applicable. Second, while the improvements presented here greatly decrease the computational burden of the algorithm when considering multiple tumor populations, the algorithm remains exponential in the size of the interval partition of the reference genomemaking it impractical to infer tumor composition with more than a handful of subpopulations in many cases. Identification of further mathematical restrictions to the domain of interval count matrices, or use of sampling techniques in place of complete enumeration are future avenues of investigation, which may prove useful in this respect. Additionally, when considering multiple tumor subpopulations, the quality of the results is limited by features of the data including the presence of copy number aberrations that distinguish subpopulations as well as the number of sequence reads available to identify these aberrations. The later is a function of sequencing coverage, aberration length and proportion of cells that have the aberration. While the limited number of tumor subpopulations that THetA2 analyzes may not be sufficient to fully analyze tumor progression, THetA2's ability to recover subpopulations with relatively low-coverage sequencing data can provide some insight into tumor subpopulations in cases where methods that rely on high-coverage data () cannot. Combining THetA2s output with other methods that do explicitly consider the phylogenetic history of a tumor such asmay prove a useful avenue of exploration. The two-step procedure introduced here allows us to infer subclonal copy number aberrations at much smaller scales. However, some care is required to avoid overfitting the data,particularly for small, subclonal copy number aberrations where GC bias or other sequencing artifacts may lead to incorrect inferences. Incorporating more sophisticated segmentation procedures that account for such effects and appropriately scale read counts () are useful directions for future research. Finally, this work focuses on the important first step of quantifying intra-tumor heterogeneity from a single mixed tumor sample. Downstream analysis including the clinical and functional impact of the inferred tumor composition is an important area for future work.
CONCLUSIONWe present a new algorithm, THetA2, to infer the composition of a tumor sampleincluding both the percentage of normal admixture and the fraction and content of one or more of tumor subpopulations that differ by copy number aberrations. The new algorithm builds on our THetA algorithm (), and includes several improvements that allow us to analyze highly rearranged genomes from WGS (high and low coverage) or WXS sequencing data. In addition, the new algorithm is orders of magnitude faster and allows us to use BAFs to distinguish between different reconstructions.
The Author 2014. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
Quantifying tumor heterogeneity at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
. 2.3 A two-step procedure for genome-wide inference of copy numbers In Oesper et al. (2013), we inferred tumor composition using a relatively coarse interval partition I of the reference genome, considering only large copy number aberrations. As a result, the published approach could not readily be applied to highly rearranged genomes that are segmented into many intervals. Moreover, manual selection of a subset of intervals was typically required when analyzing samples containing multiple tumor populations. Even with the improved enumeration procedure described in the previous section, when more than one tumor subpopulation is considered, the number of matrices C that need to be enumerated is exponential in the number m of intervals. Moreover, the number of matrices C is also exponential in the maximum copy number state k considered, making analysis of genomes with extensively amplified regions more difficult. In this section, we present a two-step procedure for interval selection that overcomes the limitations stated above, and allows us to infer the composition of highly rearranged genome that are highly fragmented and/or contains amplified segments with more than k copies. Our twostep procedure consists of the following steps: (i) Select a set of highconfidence intervals and determine the most likely C and for those intervals. (ii) Use the estimates of C and to determine copy numbers for all other intervals in I not used in the first step, thus allowing for analysis of both highly amplified regions and fragmented genomes.
L.Oesper et al. at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
