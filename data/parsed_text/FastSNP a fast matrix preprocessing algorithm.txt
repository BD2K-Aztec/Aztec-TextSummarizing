Motivation: Computation of steady-state flux solutions in large metabolic models is routinely performed using Flux Balance Analysis based on a simple LP formulation. A minimal requirement for thermodynamic feasibility of the flux solution is the absence of internal loops, which are enforced using 'loopless constraints'. The resulting loopless flux problem is a substantially harder MILP problem, which is computationally expensive for large metabolic models. Results: We developed a pre-processing algorithm that significantly reduces the size of the original loopless problem into an easier and equivalent MILP problem. The pre-processing step employs a fast matrix sparsification algorithm – Fast-SNP – inspired by recent results on Sparse Null-space Pursuit (SNP). By finding a reduced feasible 'loop-law' matrix subject to known directionalities, Fast-SNP considerably improves the computational efficiency in several metabolic models running different loopless optimization problems. Furthermore, analysis of the topology encoded in the reduced loop matrix enabled identification of key directional constraints for the potential permanent elimination of infeasible loops in the underlying model. Overall, Fast-SNP is an effective and simple algorithm for efficient formulation of loop-law constraints, making loopless flux optimization feasible and numerically tractable at large scale. Availability: Source code for MATLAB including examples are freely available for download at
IntroductionConstrained-based methods are the most popular methods for exploring the capabilities of genome-scale metabolic models (GEMs) (). GEMs have been reconstructed for many model organisms (), enabling comprehensive study of the genotypephenotype relationship, cellular physiology, metabolic capabilities, among others (). More recently, these reconstructions have included larger and more complex networks, describing different cellular interactions (), microbial communities (), and multi-tissue organisms (). The increased complexity of current metabolic models demands efficient constrained-based methods to compute possible network states, especially thermodynamically feasible ones. Computation of thermodynamically feasible states is computationally hard (), severely limiting its application to large-scale models. Efficient computational methods are thus needed to interrogate the consequences of thermodynamic feasibility on these models.
Associate Editor: Dr. Oliver StegleGEMs are mathematically represented by the stoichiometry matrix, which encodes the mass balances for m internal metabolites involved in n reactions. The capacity of each reaction is phenomenologically constrained by thermodynamics and enzyme kinetics through the use of appropriate lower lb and upper ub bounds on the vector of reac(Eq. 1). Assuming vanishing accumulation of internal metabolites (Eq. 2), the space of feasible steady-state fluxes is defined by the following set of constraints (hereafter referred as mass balance constraints),This typically highly undetermined space is readily explored using Flux Balance Analysis (FBA). Given an optimality criterion, FBA uses linear optimization to compute a steady-state flux solution that maximizes a defined objective such as growth rate, ATP production, among others (). The flexibility of the network under (sub)optimal conditions can be further assessed using Flux Variability analysis (FVA) (). FVA computes the minimum and maximum flux through each reaction capable of supporting a defined network state. Equations (34) describe the LP formulations of the above optimization problems,where c represents the objective vector, zopt denotes the optimal value found by FBA, and  is a parameter describing the degree of optimality w.r.t. FBA, i.e., for suboptimal analysis 0   < 1, whereas  = 1 for alternative optima analysis. While FBA and FVA provide feasible steady-state flux solutions, they are not guaranteed to be thermodynamically feasible. Additional constraints on the flux vector v are needed to ensure this and a minimal criterion for thermodynamic feasibility is the absence of internal loops. Let us define the 'loop-law' matrix,, the matrix containing a null space basis of the stoichiometric matrix of internal reactions int S i i m n  R , and, vint and int the internal reaction and the corresponding chemical potential vectors, respectively. A steady-state flux solution v * is thermodynamically feasible if, 1) the global potential energy of the network is balanced, i.e.,, and 2) reactions proceed in the opposite direction of chemical potential change, i.e., * * int int diag(). These two conditions hold simultaneously true if and only if the net flux around all closed loops is equal to zero, i.e., v * is 'loopless' (). The loopless condition can be enforced by formulating mixed-integer linear constraints on vint (hereafter referred as loopless constraints) (),Addition of Eq. (5) to Eqs. (34) yields two MILP formulations commonly known as ll-FBA and ll-FVA ('ll' stands for loopless). Inclusion of the loopless constraints not only increases the size of the problem (decision variables are now int, v, int), but also yields a harder optimization problem. Computationally, this problem has recently been addressed by recasting ll-FVA into a series of LP problems, in which steady-state flux solutions are computed by conventional FBA and corrected by iteratively blocking all infeasible cycles (). Here, we proposed a different approach where loopless constraints are reduced to a sufficient set of feasible loop laws, enabling efficient computation of loopless flux optimization problems. In this way, once the sufficient set of loop laws have been found, any standard loopless optimization problem can be formulated and solved using a single optimization problem without post-processing. In this work, we present a pre-processing algorithm  Fast-SNP  for efficient formulation of loopless constraints. We note that it is always possible to pre-process the loop-law matrix Nint constrained to known directionalities, so that the reduced set of constraints yields an easier-tosolve, yet equivalent MILP problem. By using a fast sparsification algorithm, Fast-SNP generates a reduced feasible loop-law basis int N % , accounting for these directionalities. Application of Fast-SNP considerably reduced computation times during loopless flux optimization compared to the traditional approach in different metabolic models. Furthermore, our approach identifies key directional constraints, which may enable elimination of unfeasible cycles in the underlying GEM. Altogether, Fast-SNP enables efficient computation of thermodynamically feasible flux solutions in genome-scale metabolic models.
Methods
A useful matrix pre-processing algorithm for efficient loopless flux optimizationThe motivation of our method stems from the observation that not all internal loop laws are feasible given the directionalities defined by Eq. (1) (). We previously exploited this fact to detect 'potentially active or feasible loop-laws' in metabolic models using the conventional representation of Nint (e.g., reduced row echelon form of T int N ), enabling faster discovery of unfeasible random flux samples (). This reduced set of feasible loop-laws cannot immediately be used for loopless flux computation. However, if we are able to derive a reduced basis of Nint containing a minimum set of feasible looplaws, then the computed loopless flux solutions will be accurate (see Supplementaryfor an illustrative example). In addition to minimizing the number of loop-laws, we decided to simplify the laws through sparsification. We developed a fast matrix pre-processing algorithm motivated by recent progress in the matrix sparsification field (). As opposed to sparsification algorithms based on MILP formulations (), our approach relies on an LP formulation that is not guaranteed to find the 'sparsest' null space basis, i.e., least number of non-zero entries, but quickly generates a reduced feasible basis for efficient computation of thermodynamically feasible flux solutions. The general workflow for efficient loopless flux optimization is illustrated with a toy model (). First, the network stoichiometry is formulated and the internal and exchange reaction matrices, Sint and Sext, are defined (). Next, an initial basis Nint is found using Singular Value Decomposition (SVD). Conventional loopless optimization would use this matrix or a reduced row echelon form of T int
Nas constraint for loopless flux computation (Eq. 5). In this example, out of the three possible independent loop laws found using these methods, there are only two                            feasible loop laws  L1 and L2  given the directionalities of v1 and v2, i.e., L3 cannot form a loop (). Thus, a reduced basis int N % can be constructed using just the first two loop laws. This basis is readily found using Fast-SNP by integrating the topology of Sint and directionality constraints. Implementation of this pre-processing step significantly improves computational performance in a diverse family of loopless optimization problems (). In the following, we present our algorithm for pre-processing the loop-law matrix Nint.The resulting basis int N % has r * = 2  r feasible loop laws, enabling more efficient optimization of loopless problems. C) Once a reduced basis for the loop-law matrix is found, a diversity of loopless optimization problems can be performed more efficiently.
A fast matrix sparsification for efficient formulation of loop-law constraintsThe problem of finding the sparsest linear basis of the null space  or the Sparse Null-space Basis problem (SNB)  is motivated by its application to Linear Equality Problems (LEPs) arising in constrained optimization problems (). Coleman anddemonstrated that a greedy algorithm must find the SNB of a matrix Amn in r = n  rank(A) steps, provided that at each step the subproblem of finding the Sparsest Null-space Vector (SNV) can be solved. Since SNV is NP-complete, SNB is NP-hard (), and the use of approximate algorithms to solve SNB is justified. Recently,proposed a convex-relaxation of the SNB  referred to as the Sparse Null-space Pursuit (SNP)  where a sparse basis is computed in rn LP optimization runs. While this formulation is in principle attractive, it does not consider any directional constraints on the basis vectors, which is a key feature of our problem. Moreover, the n LP optimizations per basis vector is excessive. We have developed a more efficient sparsification algorithm  FastSNP  inspired by the SNP formulation. Fast-SNP finds a minimal sparse representation of Nint in at most 2r LP optimization runs. Briefly, starting from an empty null space basis, the SNV is solved by finding the minimum l1-norm steady-state flux solution vint,k that, 1) is consistent with the defined directionalities, and 2) is contained in the orthogonal space of Nint,k derived from the previous (k  1) iterations. The latter constraint ensures that the basis vector computed at iteration k is linearly independent from the previous (k  1) vectors. This condition can be formulated as int,the projection matrix onto null(Nint,k). As this above equation defines neither a convex nor a compact region, we replace it with two equivalent constraints, namely:where w represents a vector of random weights and  is a small positive constant, e.g., 10-3. Here we employed uniform random weights, however other choices can be also used yielding similar results (Supplementary). As w is nonzero, the above constraints are only violated if int,which is the condition to be avoided. The resulting SNV optimization problem can be then formulated as follows,In this way, two LP optimizations are required to determine the SNV at each iteration, and thus 2r runs are needed to complete the null space basis. Notably, after each iteration, the sparsest (i.e., the minimum l0norm) solution is kept for the next iteration. If at one iteration there are no feasible solutions for both SNV problems, then the algorithm terminates as there are no remaining nonzero basis vectors given the current Nint,k and the directionality constraints. The pseudocode of our Fast-SNP is shown in Algorithm 1.
Detection and removal of infeasible loopsGeneration of a reduced loop-law matrix can accelerate other loopless flux optimization problems. Here, we evaluated two of such problems, namely Loop Detection (LD) and Loop Removal (LR). The first problem determines whether a steady-state flux distribution is thermodynamically feasible (i.e., loopless), whereas the second computes the nearest feasible flux solution. Specifically, given a steady-state flux solution v0 with vint,0 denoting its internal reactions, LD tests for thermodynamic feasibility by directly applying the loopless constraints using a LP formulation with a blank objective ((8) v0 is loopless if the previous LP problem admits a solution for int,0. If the flux solution is unfeasible, LR finds the nearest feasible flux solution v * employing the following MIQP formulation (),where  denotes the distance vector from v0 to v *. Thus, the closest feasible flux distribution to v0 is found by minimizing the Euclidean norm of .
Computational implementationFast-SNP and all the loopless flux formulations were coded and implemented in MATLAB 2015b (The MathWorks, Natick, MA). Our implementation relies on third-party solvers to solve LP, MILP and MIQP problems. Optimization runs were performed using Gurobi Optimizer 6.5 (Gurobi Optimization, Inc., Houston, Texas) and IBM ILOG CPLEX 12.5.1 (IBM Corp., NY). All computations were run on a Dell Studio OptiPlex 9020 workstation (Intel Core i7-4790 processor, 16GB ram memory, 64-bit architecture) running on Windows 7.
ResultsThe computational performance of our strategy was compared to the traditional approach in different metabolic models covering a range of sizes. The models considered include the toy model shown in, an E. coli core model (), and six GEMs, namely: iAF692 (), iJN661 (), iYL1228 (), STM (), iJO1366 () and Yeast 6 (). We have assumed growth in minimal medium and growth rate maximization as the objective function for each model. In the case of the toy model, the upper bound of b1 was set to 1 and reaction b3 was maximized (see). The characteristics of each model after removal of blocked reactions are shown in. The models used in this study can be downloaded from the BiGG Models database at http://bigg.ucsd.edu ().
Fast-SNP significantly reduces loop-law constraints enabling efficient ll-FBA computationFast computation of a reduced feasible loop-law matrix is critical for efficient loopless optimization. Even if a reduced basis accelerates optimization, if its computation is too expensive then the approach is simply not useful. Therefore, we first evaluated the computational performance of our sparsification algorithm in the studied models (). The computation of a reduced basis was achieved in less than 25 seconds for all models and Gurobi was approx. 60% faster than CPLEX. The speed depends on both the total number and the number of feasible loop laws. For example, Yeast 6 has considerably less internal reactions and therefore total loop laws than iJO1366 (224 versus 484), but it has almost 3fold more feasible loop laws than iJO1366 (110 versus 34). In this case, the pre-processing time was similar in these two models using both solvers, highlighting the dependence on both factors. We further compared the performance of Fast-SNP against a previous method for generation of a minimal null space basis (). This method is based on the identification of reactions involved in infeasible loops through FVA and extreme pathway analysis. As such, this method would require 2n LP iterations + 1 basis computation for the generation of Nint. In contrast,Fast-SNP requires 2r LP iterations + r basis computations (in the worst case). Considering the greedy nature of Fast-SNP, the high efficiency of SVD algorithms for orthogonal basis generation and that r < n as r = n  rank(Sint), Fast-SNP produces a sparse null basis substantially faster (approx. 10 times) than the latter method (Supplementary). Fast-SNP also yielded substantially reduced loop-law matrices with fewer feasible loop laws in all GEMs (). Reduction of GEMs loop laws varied from 50.9% for Yeast 6 to 94.8% for STM, underscoring the impact of known directionalities on the number of feasible loop laws. In addition to shrinking the loop matrices, the algorithm created much sparser matrices. For instance, the computed loop-law matrix for iJO1366 contained 98.5% less non-zero entries compared to a reduced column echelon of the latter. The above results are encouraging for the potential increase in algorithmic efficiency of loopless optimization algorithms. Whether they actually translate into substantial speedups is evaluated next. Pre-processing the loop-law matrix significantly accelerated ll-FBA optimization (). The runtime reductions increased with the size of the model and Gurobi was approx. 3-fold faster than CPLEX (). For the largest GEMs (STM, iJO1366 and Yeast 6) a runtime reduction of around 20-fold was observed. Importantly, in all the studied models there was a perfect agreement on the computed optimal values (Supplementary).
Reduced loop-law constraints improve computational performance of ll-FVA and related loopless optimization problemsThe computational improvement of Fast-SNP was further evaluated in llFVA setting  = 0.9, i.e., 90% of the optimal growth rate calculated previously. As with ll-FBA, our strategy displays considerably lower runtimes using either solver compared to the conventional approach (). In general, the greater the reduction in the loop-law constraints, the greater the relative acceleration. For large GEMs, reductions in computation time varied from 7-fold in Yeast 6 using Gurobi (13-fold improvement with CPLEX) up to 50-fold in STM (31-fold improvement with CPLEX). Very promising speedups were also achieved in iJO1366; 41-and 47-fold improvements were obtained using CPLEX and Gurobi, respectively. In the case of medium-scale GEMs, speedups were moderate ranging from 2-fold runtime reduction for iAF692 using CPLEX, to approx. 20-fold improvement for iYL1228 using Gurobi. Notably, flux ranges computed with Fast-SNP yielded almost identical results as in conventional ll-FVA with no statistical significant difference (and Supplementary). We further compared the computational improvement of Fast-SNP against recent approaches for efficient loopless flux optimization, namely: fast-tFVA () and CycleFreeFlux (). Overall, Fast-SNP yielded more modest improvements compared to the other approaches though magnitude varied dramatically between problems and solvers used (Supplementary Tables S2-S3). We also evaluated the performance of Fast-SNP in the related loopless flux optimization problems, Loop Detection (LD) and Loop Removal (LR) (see Methods). These optimization problems have been respectively proposed for detection and correction of unfeasible flux distributions generated using random sampling (). Given the large size of samples required for the analysis of GEMs (typically 10 5 ), efficient detection and removal of unfeasible cycles is fundamental (). As for ll-FBA and ll-FVA, pre-processing the loop-law matrix improves runtimes for detection and removal of loops in iJO1366 (). Comparing the performance of LD optimizations with and without pre-processing of iJO1366, runtimes decreased 1.3-and 7.4-fold using Gurobi and CPLEX, respectively. Interestingly, on this occasion CPLEX was faster than Gurobi. The results are even more impressive for the case of LR. Neither Gurobi nor CPLEX were capable of finding a feasible solution within 6 h, when the loop-law matrix was not processed using Fast-SNP (). With Fast-SNP, a solution was found within minutes using either Gurobi or CPLEX. This result highlights that an efficient formulation of the loop matrix might not only be a convenient strategy, but an absolute requirement to solve complex loopless formulations.
Analysis of the reduced loop-law matrix reveals key directional constraints required to avoid infeasible loopsA reduced feasible loop-law matrix can also serve as a valuable source of information for unravelling unfeasible cycles in genome-scale models. The set of vectors encoded in the rows of int N % describes a minimal basis of feasible loop laws allowed by the directionalities in the model, and thus, they can yield useful insights about potential infeasibilities in the model. In the following, we analyzed the topology of these laws in iJO1366 after performing ll-FVA with  = 0.9 (see previous section). Application of ll-FVA yielded 13 blocked reactions and changed the directionality of 728 reactions in iJO1366. Importantly, the resulting model has 18 loop laws out of the initial 34, easing its topological analysis ().depicts the complete set of loop laws found in iJO1366 after definition of growth conditions (minimal medium), optimality criterion (at least 90% of optimal growth rate) and thermodynamic feasibility (loopless condition). The set of feasible loop laws covers 45 reactions (11 reversible) involved in ion and metabolite inter-compartment transport, alternate carbon, acetate and glycogen metabolism (Supplementary). Reactions with the highest participation in loop laws are: NAt3pp (5), PPKr (5), CA2t3pp (4) and Cat6pp (4) (Supplementary). Notably, the latter reaction is also flux-forcing, i.e., it has a strictly non-zero flux, and thus it cannot be removed without rendering the model infeasible.Next, our interest is to analyze the impact of blocking or fixing the directionalities of reactions involved in unfeasible cycles. We have selected three illustrative cases to show different strategies for rational analysis and removal of loops (). Case 1 illustrates a simple loop comprised of two duplicated reactions: ASPt2pp (irreversible) and ASPt2rpp (reversible). In this case, the most sensible action is to remove the irreversible reaction (ASPt2pp) and preserve the reversible one (ASPt2rpp). The resulting model has the same capabilities as the original without the artificial loop L2. Cases 2 and 3 are more subjective and illustrate different modelling rationales. In Case 2, if we are not interested in pyruvate alternate metabolism, reaction HPYRI can be removed from the model effectively eliminating L1. Case 3 illustrates that loops can be also eliminated by fixing the directionalities of reversible reactions rather than deleting a reaction. L7 consists of a loop where the succinyl-CoA synthetase (SUCOAS) operates in reverse. However, under fast-growing glucose-limited aerobic conditions, this reaction proceeds in the forward direction in E. coli (). By fixing its direction to forward, L7 is eliminated as no other reactions in this cycle can be reversed (). In summary, the topology encoded in the reduced loop-law matrix facilitates rational infeasibility analysis of large metabolic models.
DiscussionComputation of loopless steady-state flux solutions is an NP-hard MILP problem (). Recent approaches such as fasttFVA () and CycleFreeFlux () have exploited particular features of the problem and used LP formulations following alternative approaches to solve different loopless flux optimization problems. Although these approaches enabled fast computation of feasible fluxes (acceleration up to two orders of magnitude), they rely on post-processing methods for blocking unfeasible cycles after steady-state flux computation. In the current study, we developed a preprocessing strategy where the conventional MILP problem is reformulated using a minimal set of loop-law constraints, enabling efficient computation of loopless flux solutions as well as topological analysis of infeasible cycles in large metabolic models. All modern MILP solvers use preprocessing to recast MILP formulations into easier-to-solve, yet equivalent representations (). It is often possible to develop superior preprocessing strategies using insights into the specific MILP problem. We have developed a fast preprocessing algorithm, Fast-SNP, which finds a minimal set of feasible loop laws taking into consideration the directionalities of the model. Once the reduced loop-law matrix is found, a smaller loopless MILP problem can be formulated and solved efficiently. Speedups up to 50fold were achieved with preprocessing across diverse types of loopless flux optimization problems (Tables 2+3, Figs. 2-4). Although the computational improvement of Fast-SNP is more modest than previous approaches (Supplementary Tables S2-S3), it is the only strategy capable of efficiently solving loopless related problems (i.e., ll-FBA, ll-FVA, LD and LR) using a single optimization problem based on suitable LP, MILP or MIQP formulations subject to the loopless constraints (Eq. 5). Importantly, such constraints have recently been algebraically proven to always yield thermodynamically feasible flux solutions (Noor, et al., 2012).Finally, we highlight additional and distinctive features of Fast-SNP for the analysis of metabolic models. As shown in the previous section, this approach enables a priori assessment of model complexity in the 'loop law sense', as it explicitly computes a minimal basis describing all the potentially infeasible cycles in the studied model. Formally, these loop laws represent elementary flux modes that do not exchange mass with the surroundings (). These internal cycles have previously been studied in the context of oriented matroid theory () and more recently, infeasible cycles have been enumerated in GEMs using sampling approaches (). However, efficient assessment of the impact of directionality constraints as well as topological analysis of these loop laws for their potential removal, has been lacking in the literature. Fast-SNP aids comprehensive assessment, unravelling simple strategies for removing infeasible loops based on thermodynamic or practical considerations (see). Additionally, we note that the proposed matrix sparsification algorithm in Fast-SNP can also be employed for other useful analyses. For example, this algorithm can readily be modified to explore alternative solutions by incorporating suitable additional constraints (e.g., vi  z * ) using an appropriate objective (e.g., l1-norm minimization). The resulting greedy algorithm would generate a set of linearly independent solutions or pathways (i.e., a basis) consistent with the previous constraints by solving only LP problems. This avoids the need of computing expensive MILP formulations. In conclusion, Fast-SNP complements existing methods in the constrained-based modelling toolbox for exploration and topological analysis of infeasible cycles and metabolic pathways.
R at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
