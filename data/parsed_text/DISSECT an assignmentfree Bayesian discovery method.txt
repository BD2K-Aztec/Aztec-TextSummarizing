Motivation: The multispecies coalescent model provides a formal framework for the assignment of individual organisms to species, where the species are modeled as the branches of the sp tree. None of the available approaches so far have simultaneously co-estimated all the relevant parameters in the model, without restricting the parameter space by requiring a guide tree and/or prior assignment of individuals to clusters or species. Results: We present DISSECT, which explores the full space of possible clusterings of individuals and species tree topologies in a Bayesian framework. It uses an approximation to avoid the need for reversible-jump Markov Chain Monte Carlo, in the form of a prior that is a modification of the birthâ€“death prior for the species tree. It incorporates a spike near zero in the density for node heights. The model has two extra parameters: one controls the degree of approximation and the second controls the prior distribution on the numbers of species. It is implemented as part of BEAST and requires only a few changes from a standard *BEAST analysis. The method is evaluated on simulated data and demonstrated on an empirical dataset. The method is shown to be insensitive to the degree of approximation, but quite sensitive to the second parameter, suggesting that large numbers of sequences are needed to draw firm conclusions. Availability and implementation:
IntroductionDespite its alleged status as a fundamental concept in biology, the species category has lacked a definition allowing explicit testing of particular species limits (e.g.). In recent years however, several methods have been proposed for the task of delimiting species based on molecular data (see Fujita et al.and Miralles and Vencesfor reviews). Multispecies coalescent () species delimitation (MSCSD) methods make use of multi-locus sequence data to make inferences in the presence of incomplete lineage sorting. All current MSCSD methods are either heuristic (e.g. O'), dependent on a guide tree (e.g.; note however that a paper by Yang and Rannalaappeared during the revision of this article, where the requirement of a user-supplied guide tree is eliminated) or are validation methods, which require prior assignment of individuals to clusters or species.devised parametric and non-parametric heuristic methods to simultaneously find an optimal assignment of individuals to species and their tree relationships. Yang and) developed the idea in a Bayesian framework, in which the gene trees are co-estimated with a constrained species tree. In the simplest option, species are inferred by setting a threshold on the posterior node heights of the species tree, with small heights interpreted as evidence for collapsing a node. This is similar to using *BEAST () with each individual in its own 'species' in the XML file, and estimating the actual species afterwards. The dimensionality of the parameter space does not change, and there is no special prior involved. Here, we take a Bayesian approach, which has the advantage that nuisance parameters can be integrated out, and also that prior taxonomic knowledge can be taken to account. Our approach does not require prior assignments of individuals to putative species, and may be viewed as species tree inference while taking uncertainties in MSCSD into account. We present Division of Individuals into Species using Sequences and Epsilon-Collapsed Trees (DISSECT) for species delimitation which requires no prior assignment of individuals to clusters or species, but instead explores the full space of possible clusterings and tree topologies. It is along the lines of the method of Yang and Rannala (2010) which employs a user-supplied guide tree in which some nodes may be collapsed (i.e. all descendants of these nodes assigned to one species). In the most recent version of BP&P (), there is no need for the user to supply a guide tree. Instead, the 'guide tree space' is explored using nearest-neighbor interchange moves. The two operations of collapsing a node, and of setting its height to zero, have the same effect on the likelihood, since the multispecies coalescent density is the same for a single population and a population which has just split at time 0. When a node is collapsed, the dimensionality of the parameter space changes, so a reversible-jump Markov Chain Monte Carlo (rjMCMC) algorithm is needed to sample the species trees. The basic idea behind DISSECT is to sample trees in which each tip represents a single individual (or a cluster of individuals which definitely belong in one species), but replace the usual prior density on node heights with one which includes a spike near zero. The dimensionality of the parameter space is fixed, but nodes whose heights have a high posterior probability of being within the spike can be interpreted as 'probably collapsed'.
MethodsA set of individual organisms will be called a cluster. Each possible cluster of individuals in the analysis is a candidate for constituting a species. A set of clusters which do not overlap one another and which together include all the individuals in the analysis will be referred to as a clustering. In an analysis using DISSECT, some sets of individuals may be grouped by the user as minimal clusters: these may be merged but never split. We use 'gene' in a loose sense, to mean an alignment of a sequence region which is assumed to be homologous and unlinked to other such regions. A 'gene copy' is a single row from such an alignment.
The modelIn Bayesian phylogenetic analysis, a prior distribution over species trees is needed, and for rooted trees as used here, the reconstructed birthdeath process () is most often used. It includes the Yule process as a special case. The process is assumed to begin at some time t in the past with a single species, and is conditioned on producing the observed number of species at present. The time t is called the 'origin time' or 'origin height.' Theorem 2.5 of Gernhard (2008), followingshows that, conditioned on t, the speciation rate k, and the extinction rate l, the density of the unordered node heights are independently and identically distributed and are also independent of the number of tips k. This nice mathematical property makes the present model tractable. Let the density of a node height s be f (sjk, t, k, l)  f(sjt, k, l). In the present model, f (s) is replaced with a mixture of f (s) and another density m(s) for s:where x is a user-chosen weight in, and this density is used for all the n1 node heights in a tree with n tips. The joint density is thenwhere s 1 ,. .. , s n1 are unordered node heights. This can be expanded aswhere C(k) is the set of subsets of {1,. .. , n  1} of size k  1. If m(s) was the Dirac delta function @(s) (), the result would be a distribution in which the trees with k external branches of nonzero length (i.e. the trees with k 'real' tips) have total probability massNote that the product Y i2X f s i jt; k; l  is the density for a reconstructed birthdeath process with k tips whose node heights are the k  1 non-zero s i. In practice one cannot sample from such a distribution without implementing rjMCMC, but it can be approximated it using m s    e 1 1 0;e s;where e is small. Figures 1 and 2 illustrate the densities f and (1  x)f xm, respectively, for the case n  3, where there are two internal node heights. One way of sampling trees from the reconstructed birth death process for n  3 is to pick a point (x, y) from a density such as the one in; then choose a random ordering of the tip labels from left to right; then insert x and y between them; and finally join the nodes to form the tree. The same process is shown infor the mixture density m. If the point (x, y) is in one of the two 'walls' along the axes, one node will be collapsed. If the point (x, y) is in the 'pillar' near the origin, both nodes will be collapsed. The approximation means that there is a possibility that a true speciation which is more recent than e will be missed. This is very similar to a model in which a separate reconstructed birthdeath process is assumed for each k and a rjMCMC is used to sample from the clusterings and trees. Apart from the approximation involving e, the other difference is that the density q(tjk) for t would normally depend on k in the reversible-jump version, whereas in Equation (2) there is no such dependence: a single density for t for all k is needed. It seems reasonable to assume a density for q(t) which mixes q(tjk) using the probabilities from Expression (3). In a normal BEAST or *BEAST analysis using the birthdeath prior, an improper uniform prior on [0, 1) is assumed for the origin time t of the tree, and the process is then conditioned on the number of species k. The conditional density for t is shown in Theorem 3.2 ofto be qtjk  kk k k  l 2 1  e klt  k1 e klt k  le klt  k1 :Using the probabilities from Expression (3), the prior density for t isThis can be simplified as shown in the Supplementary Information.The model was implemented in BEAST by adding a class BirthDeathCollapseModel, which is similar to the usual BirthDeathModel. It contains a parameter for the origin height t as well as for the diversification rate and relative death rate as in the usual birthdeath model. An additional MCMC operator is needed to sample from t. This can be added using one of the existing operators in the XML. We used a ScaleOperator. No new MCMC operators were added to explore the space of species trees: the existing NodeReHeight operator explores the posterior as modified by the prior in Equation (2).
DISSECT workflowThe analysis can be run in BEAST () version 1.8.1 and later, see Supplementary Data for instructions. BEAUTi can be used to set up most of the analysis, as if for a *BEAST analysis. The word 'species,' as it appears in BEAUTi and in the BEAST XML file, is interpreted as a minimal cluster. Two changes need to be made to the XML file. The birthdeath model must be replaced with a birthdeath-collapse model, where e can be set, and an operator must be added for the origin height. The parameter x can either be given a fixed value, or estimated by adding a hyperprior and an operator. The trees sampled from the posterior can be analyzed with a tool called SpeciesDelimitationAnalyser. It is similar to TreeAnnotator, but instead of summarizing the clade frequencies from the BEAST output, it summarizes the posterior frequencies of clusterings, and produces a table X of clusterings Z 1 , Z 2 ,. .. , Z z with corresponding posterior probabilities clusterings p 1 , p 2 ,. .. , p z which sum to 1. The clusterings are sorted in order of decreasing posterior probability. An R script for producing a similarity matrix (see Section 3.4) and detailed instructions on how to use SpeciesDelimitationAnalyser are provided in the Supplementary Information.
Advice on choosing parameters and priorsThe parameter x can be chosen to reflect prior knowledge about the likely number of species. As a consequence of the structure of the model, even when x is fixed, the prior on the number of species k is somewhat diffuse: it is not possible to insist on exactly seven species for example. In the case of fixed x, the number of trees with k 'real' tips in the prior has the distribution of 1  X, where X is a random variable having the binomial distribution with size parameter n  1 and probability parameter 1  x. Its mean is thus 1  (n  1)(1  x). If the individuals have been assigned in previous work to k 0 species, then x  (n  k 0 )/(n  1) seems a reasonable choice. If the value of x is estimated, and a beta prior is used, the prior distribution on k  1 is a beta-binomial distribution, which can be explored using the R package VGAM (Yeesee also Supplementary Information). If a flat prior on the number of species is desired, a Beta distribution with parameters (1,1) will ensure this. If x is fixed at zero, the value of e becomes irrelevant, and the model becomes equivalent to the birthdeath model as used in *BEAST, except that the origin height is estimated instead of being integrated out analytically. The parameter e should be set to a small value such as 1e4 or 1e5. The value is a compromise between exactly matching a particular model and the practicalities of computation. Extremely small values may lead to poor mixing, although we have only observed a substantial effect for e below 1e6. If e is too large it will not be possible to distinguish very recent divergences. For most analyses, there will not be enough data to distinguish speciations with node heights below 1e4, since the expected number of mutations separating the species is only 1 per 5000 sites, so the choice of e will not be at allthe premise that the mutation rate is set to 1, or that one is set to 1, and the others are estimated relative to this. When the number of individuals per species is small, it becomes difficult to estimate the population size parameters in each branch in the multispecies coalescent model. In such a case, care must be taken to use a sensible prior on these parameters, especially the 'species.popMean' parameter. We recommend that the prior should be proper, and diffuse enough to accommodate extreme but possible values, but not absurdly diffuse. This is good advice anyway when using *BEAST, but it becomes more critical when using DISSECT, since it will typically be harder to ensure that the number of individuals per species is not small.
Evaluation
Simulated scenarios and parameter settingsTwo sets of simulations were run. The first set evaluates the performance of DISSECT as the number of genes and the amount of incomplete lineage sorting varies, and assesses the sensitivity of the method to choices of e and x. The second set focuses on the case of one true species. We use N e to mean the effective number of (diploid) individuals in a population. If N e is constant, this means that the expected time for two gene copies to coalesce is 2N e generations. We denote the mutation rate per site per generation by l. Node heights and e are in the same units as the product lN e. Note that the topology and node heights of the gene trees only depend on the product lN e , so a scenario with l  1e8 and N e  50 000 is equivalent to one with l  1e9 and N e  500 000 and so on. There are two sources of 'noise' in the data: one comes from coalescences which are deeper than species tree node height and the other from the randomness of mutations. For a node height of 0.001 and a gene length of 500, the expected number of substitutions separating two species is 1, so around 37% of pairs of gene copies from different species would be identical if they coalesced at the species node height. The first set (SIM-5x5) of simulations all use 25 individuals, 5 assigned to each of 5 species, with one gene copy per individual. The species tree has a comb topology with node heights at 0.001, 0.002, 0.004, and 0.008. These heights are chosen to roughly approximate those in the empirical dataset (see below). The value of 2N e was 69 000 at the tips and at the rootward ends of branches, and 138 600 at the root and tipwards ends of internal branches, varying linearly along the branches. The length of the genes was set to 500 sites, and the number of genes G was set to 3, 9, or 27. The mutation rate l was set to 2e9, 1e8, or 5e8, representing small, moderate, and large amounts of incomplete lineage sorting. In coalescent units 2lN e , the height of the most recent speciation is 5, 1, and 0.2, respectively. The root of the species tree is at 0.008/T generations, and is therefore 4 000 000 generations when l  2e9, 800 000 generations when l  1e8 and 160 000 generations when l  5e8. To get some idea of the amount of signal and noise due deep to coalescences in the data, consider the G  9 case, where there are 4500 sites. For l  2e9, the number of variable sites is about 100. In the case l  1e8, the number of variables site is around 200, and in the case l  5e8, it is around 500. The increase in variable sites as l increases is due to deeper coalescences. We explored the accuracy of the method with respect to changes in e by using a beta prior for x with shape parameters 8 and 2, and setting e to 0.0001  1e4, 3e5, and 1e5. We also explored the behavior with respect to different priors for x by fixing e to 1e4, and setting x to 11/12, 5/6, and 17/24, corresponding to prior means for k of 3, 5, and 8. In addition, two sets of runs performed with a Beta hyperprior on x with parameters (8,2) and (1,1), respectively. The former distribution has a peak at 4, and the latter means that the probability is uniformly distributed. The second set SIM-1 of simulations all use l  1e8 and N e  100 000, meaning that the simulated genealogies span one coalescent unit. In this case a single species was simulated, so the gene trees are all the result of a coalescence process only. The product lN e scales the number of substitutions, and thus affects the accuracy with which genes trees can be estimated, but does not change the underlying 'shape' of the problem. The value of e was 1e4. A beta prior with shape parameters 8 and 2 was used for x, which means that the prior was biased toward more than one species. We used n  4, 8, and 16 individuals and G was set to 3, 9, and 27 to examine how these variables affect the rate of false splits.
Implementation of simulationsThe simulated data was generated and analyzed using R (R Development Core Team, 2011) and the R packages APE () and phangorn (). Gene trees were simulated according to the multispecies coalescent model for each scenario and parameter choice, for 50 replicates. Sequence alignments with 500 sites were generated for these gene trees using Seq-Gen () called with command seqgen.exe-mHKY-t3.0-f0.3,0.2,0.2,0
.3This uses a strict clock and the HKY substitution model, and all genes have the same mutation rate. There is no site rate heterogeneity. These sequences were then incorporated into BEAST XML files, and DISSECT was run for 50 million generations with the first 25 million discarded as burn-in. The priors for species. popMean, meanGrowthRate and the relative clock rates were all lognormals, with means and standard deviations in log space equal to 7 and 2, 4.6 and 2 and 0 and 1, respectively. The prior for relativeDeathRate was uniform in. Species DelimitationAnalyser was run after DISSECT with the first 25 million discarded as burn-in.
Empirical dataSpecies delimitation in the pocket gopher genus Thomomys subgenus Megascapheus has been controversial, with a large number of species described by early taxonomists. Most of these have been reduced to subspecific rank by twentieth century taxonomists inspired by the biological species concept (e.g.). According to opinion of these recent authors, the number of species in the dataset of, also used by, vary between 6 and 8, depending on how the species T. bottae, T. umbrinus and T. townsendii are delimited. We explored the dataset, which consists of 26 individuals which were defined as 'species' and 7 non-coding nuclear sequence regions (), by varying e from 1e7 to 1e3, and by setting x to 0.12 or 0.68 (corresponding to subspecies elevated to species rank, and eight species, as classified in Belfiore at al., respectively). We also used a Beta hyperprior with parameters 4 and 2 (). Each combination of e and x was run for 200 million generations, saving parameter values and species trees every 5000th generation. SpeciesDelimationAnalyser was run with s equal to e. The second dataset is an extension of the data used byfor a group of species in the flowering plant genus Silene L. They used marginal likelihood estimates as well as the software BP&P () to compare species delimitations in section Cryptoneurae Aydin and Oxelman, and concluded that there was strong support for the recognition of the recently described species S. ertekinii Aydin and Oxelman, and most probably four species in total. Here, we use data from 20 individuals and sequence data from the same six loci asto compare results from a Beta(4,2) prior on x, to those from a Beta(1,1) prior, which means that all values of x have uniform prior probability.
Evaluation metricsThe number of possible clusterings of n individuals (known as the Bell number B n ) increases rapidly with n.) The accuracy of the estimated number of species is not a good way to judge the method, since the number may be correct despite false splits and false merges which cancel out, or despite major mis-assignments, or incorrect due to a single individual being incorrectly merged or separated from a cluster. There are approximately 2.4e 15 ways in which 25 individuals can be grouped into five clusters. The situation is similar to that of inferring phylogenies, where we typically do not expect every clade to be correctly inferred if the number of species is large. In order to assess the accuracy of DISSECT, we therefore want a metric analogous to tree metrics such as the RobinsonFoulds distance. Rand index. We chose the Rand index (), which measures the similarity R(X,Y) between two clusterings X and Y of the same set (e.g. the set of individuals). It is convenient to use for accuracy evaluations. The Rand index is always between 0 and 1, and is 1 when the match is perfect. We also define R X; Y  1  R X; Y   which is a metric in the mathematical sense, and which we will refer to as the Rand metric. Firstly, in order to evaluate the posterior distribution as a whole, we weight the Rand metric between each clustering Z m in the table X produced by DISSECT and the true clustering Z* by its posterior probability p m , and thus produce an overall measure of the distance from the posterior distribution to Z*:This is our main tool for evaluating DISSECT on simulated data. In the Supplementary Information, we present several other ways to explore the results.
ResultsResults for the first set SIM-5x5 are shown in. In general, increasing the number of genes from 3 to 9 increases accuracy, and it is almost perfect for nine genes in the easy cases, where the shortest branches of the species trees are five coalescent units (c in). However, with 27 genes, accuracy goes down at least for the easy case. Checking the trace files and effective sample sizes (ESSs) revealed poor convergence of these runs. The effect of varying the prior for x shows no obvious effect on accuracy, except possibly a small increase in the posterior probability with increasing k (see Supplementary Data). Results for the second set SIM-1 are shown in. The point estimates were always correct, except in one replicate with nine genes, medium amount of lineage sorting, and eight individuals. There were no false splits with high posterior probabilities. The posterior probability of the correct clustering increases with G, but shows no clear effect with varying number of individuals I. However, when running the same analyses with x $ Beta(N1,1), meaning that the prior probability of one species is 0.5, accuracy increases with the number of individuals (Supplementary Data).. The boxplots show the values of the error metric over 50 replicates as the number of genes (G  3, 9, or 27), the amount of lineage sorting (shortest branches of species tree a  0.2, b  1.0, c  5.0 coalescent units) and prior on x (B82: Beta $ (8,2) hyperprior, k  3, 5 or 8) vary. Epsilon is 0.0001, and 50 000 000 MCMC generations for each replicate, with first 50% discarded as burn-in. The boxplots show the values of the error metric over 50 replicates as the number of genes (G), and the number of individuals (I) vary when there is only one species. There is a x $ Beta(8,2) hyperprior. Epsilon is 0.0001, and 50 000 000 MCMC generations for each replicate, with first 50% discarded as burn-in
DISSECTVarying e between 1e4 and 1e7 on the Thomomys data did not have any noticeable effects on the similarity matrices generated from SpeciesDelimitationAnalyzer (). Varying x had clear effects, with more and smaller clusters for the small x  0.12. The posterior mean values for x when estimated with a Beta(4,2) prior distribution varied between 0.53 and 0.55 when e was in the range not affecting the posteriors. ESSs for most parameters were well above 300, except for some population size parameters for individual branches, and speciation.likelihood, where the smallest e values gave low ESSs for x  0.68 and x estimated with Beta(4,2). The results of the analyses of the Silene data showed little sensitivity to whether the prior on x was informative or not ().
Discussion
SimulationsAs expected, the accuracy increases with the number of unlinked loci and the ability to detect species increases as the height of the nodes increases. The insensitivity of the method to varying e suggests that the approximation is unlikely to bias the results. The results on the scenarios SIM-1 with one true species show the method does not often infer false splits, but it is also clear that a substantial number of sequences are required in order to draw a firm conclusion even in this simplest of cases. A full evaluation of the method on more complex cases is beyond the scope of this article. Note that even with two true species, there is a four-dimensional space of scenarios to explore (node height, effective population size, number of individuals, and number of loci). In occasional replicates of the simulated data, convergence was poor, something that potentially can affect the accuracy of the method. Therefore, we strongly advice users of the method to carefully review convergence of the MCMC runs. In general, the number of species was over-estimated in the scenarios used here (results not shown). However, one could add very recent nodes to the scenarios which would tend to be falsely merged and result in an under-estimate instead. It would be interesting to evaluate the method on a large number of scenarios produced by sampling from a birthdeath process. For the moment we suggest that estimates of numbers of species are treated with caution.
Empirical examplesThe insensitivity of DISSECT to e suggested by the results from the simulated data seems corroborated by the Thomomys data. In datasets of the size evaluated here, there is far too little information to detect node heights smaller than 0.0001 substitutions per site. On the other hand, the impact of x on the data was noticeable, indicating that the data are not informative enough to be strongly conclusive about species delimitations.The ambiguous assignment of several individuals in the Thomomys dataset may indicate violations to the assumptions of the model (e.g. no hybridizations), or that the data are not informative enough. To assess absolute fit of the data to the model, posterior predictive simulation-based model checks may give clues to the reasons for this (). Indeed, the Thomomys data showed poor fit to the multispecies coalescent model in the survey by, and one possible reason to this might be mis-assignment of alleles to species. The results of our analysis of the data from Silene sect. Cryptoneurae () are in agreement with the conclusions of. The posterior probabilities for clades and MSC membership are almost identical from the analysis with an informative Beta prior () to that with an uninfirmative prior (). However, the support for pairs of individuals belonging to the same species (cluster) is often low. We propose that a possible reason for this pattern, also seen in the Thomomys data, might be structured populations due to for example, gradual speciation (see also below). If that is the case, it might be convenient to use a combination of species tree support for clades and the pairwise similarity matrix to aid further considerations about species memberships. High posterior support for clades in the species and congruence among gene trees, but low resolution below that may indicate occasional migration/hybridization. The multispecies coalescent model assumes no migration after speciation, which is instantaneous. This is probably violated in most cases.found that low rates (<0.1 migrant per generation) of migration had virtually no effect on the accuracy of BP&P in a simulation study. However, at least when sample size is small, a single sampled recent migrant can cause severe effects. The coalescent prior on the gene trees will affect them in a way that single recent introgressions will be 'pushed back' by other gene trees that reflect the 'true' speciation event, such that the coalescent time for the migrant may be biased. More research is needed to evaluate the robustness of the model to hybridization, and in particular perhaps, to gradual isolation of species, which may be the most common form of speciation (e.g.). Recent studies () indicate relative robustness of the MSC model to gradual speciation models when it comes to species tree topology inference, but severe effects regarding polation size and divergence time estimates. The effect on MSCSD methods remains to be explored using both simulated and empirical datasets.
Conclusion'Given the intrinsic theoretical and empirical difficulties of the problem, any success would be surprising.' (O'). We believe that DISSECT is a useful step forward on the theoretical and computational side. The multispecies coalescent model has assumptions that are likely to be violated and it remains to be seen how important these are for empirical data. We have not formally evaluated the accuracy of the species trees produced by DISSECT. However, apart from the approximation involving e, and the slightly different prior on the tree root height, the DISSECT model, when conditioned on a particular clustering Z, is equivalent to *BEAST using Z to assign individuals to species. This means that DISSECT can be used as in a regular *BEAST analysis, taking uncertainties in species delimitation into account. The new version of BP&P, which appeared as advance access () late in the review process of this article has similar properties, and the accuracy of the two approaches may now be compared.
at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
G.Jones et al. at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
