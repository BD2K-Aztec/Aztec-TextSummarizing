Motivation: Alignment of medical images is a vital component of a large number of applications throughout the clinical track of events; not only within clinical diagnostic settings, but prominently so in the area of planning, consummation and evaluation of surgical and radio-therapeutical procedures. However, image registration of medical images is challenging because of variations on data appearance, imaging artifacts and complex data deformation problems. Hence, the aim of this study is to develop a robust image alignment method for medical images. Results: An improved image registration method is proposed, and the method is evaluated with two types of medical data, including biological microscopic tissue images and dental X-ray images and compared with five state-of-the-art image registration techniques. The experimental results show that the presented method consistently performs well on both types of medical images, achieving 88.44 and 88.93% averaged registration accuracies for biological tissue images and X-ray images, respectively, and outperforms the benchmark methods. Based on the Tukey's honestly significant difference test and Fisher's least square difference test tests, the presented method performs significantly better than all existing methods (P 0.001) for tissue image alignment, and for the X-ray image registration , the proposed method performs significantly better than the two benchmark b-spline approaches (P50.001).
INTRODUCTIONImage registration is the process of systematically placing separate images in a common coordinate system so that the information they contain can be optimally integrated or compared. This is becoming the central tool for image analysis, understanding and visualization in both medical and scientific applications (). Time series of images are acquired for various reasons, such as monitoring of bone growth in children, monitoring of tumor growth, post-operative monitoring of healing or observing the passing of an injected bolus trough a vessel tree, and image registration plays an important role for these medical applications. However, alignment of medical images is challenging because of variations on data appearance, imaging artifacts and complex data deformation problems, making existing registration approaches unstable and performs poor (); Section 2 shows the experimental results of four existing registration methods. Although there has also been substantial progress in non-rigid registration algorithms that can compensate for tissue deformation or align images from different subjects, many registration problems remain unsolved (). From literature review (), the raw data tends to be carefully prepared, showing little morphological distortions or stain variation, to simplify the registration task. In addition, they tend to work with low-resolution images without dealing with high-precision tissue or cell-level registration. The aim of this work is to investigate a robust and fully automatic image registration method for medical images. Two types of medical data are included in this study. One is serial microscopic tissue images with conventional histopathological hematoxylin and eosin (H&E) staining, and the other is dental X-ray images acquired using different radiation time from 0.04 to 2.5 s with slightly different capturing views.illustrates challenges with respect to data variations in our experimental data for image alignment. There are various types of image registration techniques (), which can be categorized into area-based methods and feature-based methods. Zitova and Flusser () suggested that feature-based methods are recommended if the images contain enough distinctive and easily detectable objects, which is usually the case of applications in remote sensing and computer vision, and area-based methods are usually used for medical images, which are not so rich in such details. In this study, we first evaluated five existing image registration techniques on the collected medical images. They are one featurebased method, i.e. SURF (), which is popularly adopted for remote sensing and general computer vision applications, and four area-based methods demonstrated to be useful for biological images, including a unidirectional elastic b-spline model (UnwarpJ) (), an improved bi-directional elastic b-spline model (BunwarpJ) (), a state-of-the-art 3D reconstruction system *To whom correspondence should be addressed.(TrakEM2) () and mutual information-based image registration approach () using the MATLAB implementation (MathWorks). The five benchmark methods (SURF, UnwarpJ, BunwarpJ, TrakEM2 and mutual information) are briefly described later in the text. SURF (speeded-up robust features) () is a scale and rotation-nvariant detector and descriptor based on sums of 2D Haar wavelet responses, and the method is a popularly adopted technique and widely applied to general computer vision applications such as remote sensing image alignment () and object recognition task (). However, as for medical images, local image features can appear confusing to one another; SURF does not perform well on corresponding feature identification. Thus, this method tends to fail in our experiment (see Section 2).shows the results of corresponding landmark detection by SURF in application to general computer vision images and in biological images. For general computer vision applications, SURF is able to identify corresponding features (), but for biological tissue images, SURF performs poor on corresponding landmark detection (). UnwarpJ (unidirectional elastic b-spline model) is introduced byby combining and extending some of the best techniques in the context of medical imaging. They use B-splines to model the deformation field and solve the registration problem by minimizing a pixelwise mean-square distance measure between the target image and the transformed source images with vector-spline regularization constraints. This method is demonstrated to be effective on the elastic registration of images of electrophoretic gels and fly embryos. Later, based on UnwarpJ, Argandadeveloped an improved bi-directional elastic b-spline model (BunwarpJ) to perform better registration of histopathological tissue images. However, quantitative evaluations of the method were not provided in () to show the performance of BunwarpJ on alignment of tissue images. TrakEM2 () is a recent development for 2D medical image registration and/or 3D image reconstruction, butpointed out that 'TrakEM2 acknowledges that any automatic procedure (such as image registration and image segmentation) will eventually fail partially or fully and will require manual correction by a human operator'. Mutual information techniques () measure the statistical dependence or information redundancy between image intensities of corresponding voxels in both images and use mutual information or relative entropy as the matching criterion. The method has been validated for rigid body registration of computed tomography, magnetic resonance and photon emission tomography images. Here, recent MATLAB R2013a implementation (MathWorks) of the mutual information-based method is adopted for evaluation. In our experiments (see Section 2), the five existing techniques do not deal with either tissue deformations or stain variation problems and perform poor, obtaining 565% registration accuracies on average for biological tissue images, and for X-ray images, the two b-spline models produce poor results with accuracy 560%. Hence, a robust and fully automatic registration method is highly desirable. In this work, an improved image alignment approach that is a combination of feature-based and area-based elastic registration method and a tissue pattern extraction technique is introduced here, and the presented method is fully automatic and performs consistently well in our experiments for both biological tissue images and X-ray images. Detailed quantitative evaluations with statistical analysis were conducted, showing that the presented method achieves 88.44 and 88.9% averaged registration accuracies for biological tissue images and X-ray images, respectively, and outperforms the benchmark methods. Based on the Tukey's honestly significant difference test (HSD) and Fisher's least square difference test (LSD) tests, the presented method performs significantly better than all existing methods (P 0.001) for tissue image alignment, and for the X-ray image registration, the proposed method performs significantly better than the two benchmark b-spline approaches (P50.001). The outline of this article is as follows. The materials and results are presented in Section 2, and the proposed methods are described in Section 3. Information regarding the(a) For general computer vision applications, SURF is able to identify corresponding features, but (b) for biological tissue images where local features can be confusing, SURF performs poor on corresponding landmark detection implementation of the presented method is provided in Section 4 and a discussion is given in Section 5.
DATA AND RESULTS
MaterialsSerial tissue images. Ninety pairs of serial histopathological slides were produced as the target and source images to be tested on the image registration techniques. The serial histological slides were collected using C57 mice with IgAN [immunoglobulin A (IgA) nephropathy], which is the most common glomerular disorder across the world (D'). IgAN was induced by daily injection of purified IgA anti-phosphorylcholine and pneumococcal C-polysaccharide (PnC) as described previously (). The renal cortical tissue was collected and stored appropriately until analysis. All animal experiments were performed with the approval (permit number IACUC-11-063) of the Institutional Animal Care and Use Committee of The National Defense Medical Center, Taiwan, and were consistent with the NIH Guide for the Care and Use of Laboratory Animals. For histopathology, the tissues were fixed in 10% buffered formalin and embedded in paraffin. Serial sections (4 m) were cut using Leica RM2155 and stained with H&E. Slide images were captured by light microscopy (Olympus, Japan) at the magnification of 400. Dental X-ray Images. Forty-five pairs of source and target dental X-ray images were collected for registration, and each pair was sampled without replacement from 10 dental X-ray images (45  C 10 2  10! 2!8! ), acquired with different radiation time (0.04, 0.06, 0.1, 0.16, 0.25, 0.4, 0.63, 1, 1.6 and 2.5 s) and slightly different capturing views.
Experimental results on biological tissue imagesEvaluation Method. In conventional computer vision applications, the performances of image registration algorithms can be evaluated using sum of squared differences (SSD) between the target image and the transformed source image to represent the registration accuracy level. However, for the biological data, this evaluation result can be misleading, as it is common that the intensity of the pixel in the target image and the one of the wrongly registered pixel in the transformed source image can be similar, and that the intensity of the pixel in the target image and the one of the accurately registered pixel in the transformed source image can be different because of stain variation. Hence, to provide a quantitative evaluation, five corresponding landmarks between target images and the associated transformed source images by each registration method were first manually marked, and an automatic matching system is built to compare the coordinates of the corresponding landmarks. The registration accuracy for each image pair is computed by the matching successful rate over the corresponding landmarks, and the performance of each registration method is evaluated by the averaged accuracies over all image pairs.presents the quantitative evaluation outcomes of biological tissue image registration with ANOVA analysis. Furthermore, using SPSS software (SPSS), the quantitative registration accuracy scores were analyzed with the Tukey's HSD and the LSD (). The experimental results show that the five benchmark techniques do not deal with either tissue deformations or stain variation problems and perform poor, obtaining 565% registration accuracies on average. In comparison, the presented method achieves 88.44% averaged registration accuracy for biological tissue images and significantly outperforms the benchmark methods based on Tukey's HSD and LSD tests (P 0.001).used for medical images, which are not so rich in such details. However,indicated that as area-based direct-matching methods use all available image data, they result in accurate registration if the initialized disparities at the start of the registration procedure are already close to the true disparities. This is consistent to our experimental results; when the target images appear similar to the source images, the three benchmark area-based methods (UnwarpJ, BunwarpJ and TrakEM2) perform well, but when the target image and source images do not appear similar to each other, the three area-based approaches tend to perform poor. Sparse methods have achieved great success in various biomedical applications, such as biomarker selection, biological network construction and magnetic resonance imaging (). The underlying representations of many biomedical data are compressible in the sense that they have concise representation when expressed in a proper basis. Feature-based matching methods as sparse models use invariant features to ensure reliable matching, and widely used framework rely on SURF descriptors () or SIFT features (), which offer invariance to affine transformation (i.e. translation, rotation and scaling) in the image representation. However,pointed out that feature-based methods are not well suited for estimating large transformations, as the matching accuracy and key point localization degrade for large transformations.shows the feature-matching results by SURF, SIFT and the proposed method where SURF produces poor matching, SIFT generates some incorrect matches and the proposed method finds accurate matched key points for fast and higher-level coarse registration. The associated image registration result is displayed in. Hence, to investigate a robust alignment method for both medical and biological images, our goal is to develop a method that integrates the strengths of both area-based approaches and feature-based methods. In this article, we develop a fully automatic, robust and fast registration method for biological and medical data, containing three major parts: (i) data normalization and feature extraction, (ii) sparse approximation of images for coarse and fast global registration, and (iii) optimize and refine local registration by area-based direct-matching approach.Note: The proposed method outperforms the benchmark methods on average.
Data normalization and feature extractionA data normalization process is proposed to reduce variations on image features and enhance tissue patterns, which greatly benefit the following feature-matching process and area-based directing matching results. For biological color images, in conventional histopathological staining (H&E), hematoxylin induces the blue staining of nuclei and eosin induces the red/pink staining of cytoplasm. Based on our previous study (showing that applying histogram equalization in RGB color space performed better in separating the nuclei from the cytoplasm than in HSL color space, both to enlarge the difference between the nuclear and cytoplasmic expression in color space and to further produce more distinctive tissue image features; the normalization is independently applied to the red I r and blue I b channels of each image, producing new image intensities I 0 r , I 0 b ; see Equations (2 and 3). For dental X-ray images, the normalization is applied to the single gray-scale channel. The normalization process is formulated as follows.where r stands for the red channel, h r i is the frequency of intensity value i in the channel r, cfd r i  P i 0 h r i, 0 i 2 c  1, c represents the. The box plot of quantitative evaluation results of tissue image registration where outliers 41:5 interquartile range are marked with a dot and outliers43 interquartile range are marked with an asterisk. The presented methods work constantly well overall and significantly outperform the benchmark methods based on Tukey's HSD and LSD tests (P 0.001) ()where b stands for the blue channel, h b i is the frequency of intensity value i in the channel b, cfd b i  P i 0 h b i, 0 i 2 c  1, c represents the number of bits used to represent each pixel in each channel and M  N is the size of the image. For biological images, although the dyes used are visualized as having different colors, the resulting stains actually have complex overlapping absorption spectra. In the previous studies, color deconvolution was used to achieve color separation in forensic image processing () and to achieve stain separation () in biological image processing. Our goal is to extract the eosinophilic structures, which are generally composed of intracellular or extracellular protein, as image features for image registration, and the color decomposition technique is used to extract independent hematoxylin and eosin stain contributions from individual histopathological images using orthonormal transformation of RGB. In the RGB color-space, every color is defined as ~ c c 1 , c 2 , c 3  r, g, b where r, g, b represent the red, green and blue components, and we can see additive color mixing as the vector addition of RGB components. To model the colors in an image as the vector addition of a desired (D) and undesired (U) components to a background color (P), new unit vectors can be defined as follows.where ~ n is perpendicular to ~ u and ~ d; ~ n, ~ u, ~ d span the 3D space; PU ! and PD ! are alternative unit vectors based on the undesired and desired colors. Then, color ~ c can be transformed to the new unit vectors.where ~ p OP ! ; O is the origin in the RGB 3D space; OP ! is a vector.By setting u  0, we remove the undesired component and obtain theIn the case of three channels, the color) system can be described as a matrix of the form with every row representing a specific stain and every column representing the optical density (OD) as detected by the red, green and blue channel for each stain.For normalization, each OD vector is divided by its total length, such that c c 11  c 11 0 ffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffi. In this study, the normalized OD matrix, b M, to describe the color system for orthonormal transformation is defined as follows:When C is the 3  1 vector for amounts of the stains at a particular pixel, the vector of OD levels detected at that pixel is equal to L  C b M. Therefore, multiplication of the OD image with the inverse of OD matrix results in orthogonal representation of the stains forming the image (C  b M 1 L). Then, the image features of the red channel are extracted as eosinophilic structures for both high-level feature-based coarse registration and local area-based direct-matching registration.displays the flowchart of the presented approach.
Sparse approximation for fast and coarse global registrationGiven I 1 and I 2 as two images for alignment, T as a set of all possible transformations between I 1 and I 2 , and U t I as the function that maps an image I to its transformed image using the transformation t, the goal is to find the optimal transformation t 0 :The transformation invariant distance dI 1 , I 2   jjU t 0 I 1   I 2 jj 2 corresponds to the regular Euclidean distance when the images are aligned optimally in L 2 where images are considered as continuous functions indx51g, but finding the optimal transformation t 0 and the smallest distance dI 1 , I 2  is not easy as the objective function is non-convex and local minima trap solution might occur. Feature-based approaches represent a more efficient class of methods. Considered images can be well approximated by the sparse expansion in a series of geometric functions, we define D  f : 2 T d g & L 2 as a set of geometric features constructed by transforming a generating function 2 L 2 where T d & T represents a finite discretization of the transformations T, and  U   denotes the transformation of thewhere a i , b i are non-negative coefficients. Then, the coarse global image registration problem can be formulated as finding the optimal relative transformation t 00 between the K-sparse approximations with the smallest approximate transformation invariant distance dp, q:There are two notable advantages with respect to sparse approximation and coarse global registration. First, it helps escape from many local minimum traps, and second, it greatly reduces computational time for image alignment. Here, the K-sparse approximations p and q are obtained by the following procedures. Obtaining normalized image features F 1 , F 2 by the method described in Section 3.1, interested points S 1 , S 2 are detected using the difference of Gaussian detector (), and then the corresponding feature points p, q are selected as geometric consensus between S 1 and S 2 using random sample consensus (RANSAC) (). The selected paired feature points p, q are then used for coarse global registration. The registration methodology adapted from() is based on the minimization of an energy function that incorporates three energy terms,where E img is the energy of the similarity error between U t I 1  and I 2 , E mark is the error of the mapping of paired feature points p, q, E cons expresses the geometrical consistency between the elastic deformation in both direction (I 1 ! I 2 ,I 2 ! I 1 ) and w k are the weights for sub-energy terms.
Refine local registration by area-based direct matchingObtaining alignment outputs from the coarse registration process described in the previous section, we then refine registration by an area-based direct-matching method, adapted from the improved bi-directional elastic b-spline model (). The registration methodology is based on the minimization of an energy function that incorporates four energy terms; the calculation of the elastic deformation field, dx, is through the minimization of an energy functionwhere E img is the energy of the similarity error between Iwhere divd  @ x d 1  @ y d 2 represents the divergence of the 2D vector field d, and the divergence of a vector represents the net flow of the vector of a unit volume.where rotd  @ y d 1  @ x d 2 represents the length of the unique component of the curl of 2D vector field d, and where rf  @ x f, @ y f is the gradient of the scalar function f; the curl is usually described as a measure of the circulation of a vector field.where  ,  define sets of relevant pixels common to the target and source imagesthe number of pixels in the masks, and where d  is the elastic deformation in the direction (I 1 ! I 2 ) and d  is the elastic deformation in the direction (I 2 ! I 1 ).
IMPLEMENTATIONThe software implementation of the presented method is developed in JAVA (with jdk 1.7.0.07 installed) and based on ImageJ framework (1.45s version) (). The software and the data are both made publicly available for scientific communities to use (http://www-o.ntust.edu.tw/ $cweiwang/ImprovedImageRegistration/).
DISCUSSIONImage registration is the process of overlaying two or more images of the same scene taken at different times from different viewpoints or using different capturing modules, and a good image alignment method has to take a number of issues into consideration (), including imperfect inputs such as aberrations and artifacts, occlusion issues where many pixels in one image may not match with any pixel in another image and uniqueness issues where each pixel in an image has to uniquely map to a pixel of another image. Alignment of biological images is challenging as local image features may appear confusing to one another, and imperfect inputs are inevitable. In this article, a robust and fully automatic registration method has been presented and demonstrated to be promising for aligning biological tissue images and dental X-ray images. Moreover, for the tissue image alignment, the presented method outperforms five popularly adopted existing approaches (P 0.001) based on Tukey's HSD and LSD tests and performs consistently well for both types of data in our experiments (88.44 and 88.93% averaged registration accuracies for biological tissue images and X-ray images, respectively). The presented image registration algorithm is not limited to tissue images or dental X-ray scans but can also be applied to other anatomically or histologically defined medical data. Moreover, as complex deformation problems are unavoidable in real life data, the presented technique will prove to be a substantial advantage for any application that requires image registration.
APPENDIX: FULL STATISTICAL RESULTSA one-way analysis of variance (ANOVA) is a way to test the equality of three or more means at one time by using variances. The total variation is comprised the sum of the squares of the differences of each mean with the grand mean. There is the between group variation and the within group variation. The whole idea behind the analysis of variance is to compare the ratio of between group variance with within group variance. If the variance caused by the interaction between the samples is much larger when compared with the variance that appears within each group, then it is because the means are not the same. The significant ANOVA result suggests rejecting the global null hypothesis that the means are the same across the groups being compared. Multiple comparison procedures are then used to determine which means differ. Here, Tukey's HSD and LSD are used as multiple comparison tests.
at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
C.-W.Wang and H.-C.Chen at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
Moreover, the box plot of the quantitative evaluation results is provided in Figure 4, showing that the proposed method works constantly well overall, and the four area-based methods (UnwarpJ, BunwarpJ, TrakEM2 and mutual information) perform better than the feature-based method (SURF) for tissue image registration. Furthermore, the modern system TrakEM2 and the B-spline model seem to perform better than the other two benchmark approaches, and thus for the following dental X-ray image registration experiments, the TrakEM2 and the B-spline models are selected for comparison. 2.3 Experimental results on dental X-ray images Evaluation Method. Unlike tissue images, local image features of dental X-ray scans appear better correlated to each other; therefore, a general registration performance measurement method, i.e. the percentage of pixels with similar intensity levels, is adopted to measure the registration accuracy, and an automatic evaluation tool is built to conduct quantitative evaluation automatically. The registration accuracy, r, is formulated as follows. r  #fx : jjI 2 x  UI 1 x5tg # 1 where I 1 , I 2 , UI 1  represent the source, target and transformed source images;  fx 2 1 \ Z 2 : dx 2 2 \ Z 2 g defines a mask common to the source and target images, and # is the size of the mask in pixels; t  50 in our experiments. Quantitative Results with Statistical Analysis. In the Appendix, Table 3 presents the quantitative evaluation outcomes of dental X-ray image registration with ANOVA analysis. Furthermore, using SPSS software (SPSS Inc, 2008), the quantitative registration accuracy scores were analyzed with Tukey's HSD and LSD (Table 4). Moreover, the box plot of the quantitative evaluation results is provided in Figure 5. The experimental results show that the proposed method performs well on registration of dental X-ray images, obtaining 88.93% averaged registration accuracy rate, and significantly better than UnwarpJ and BunwarpJ, which obtain 560% registration accuracy rates on average, based on Tukey's HSD and LSD tests (P50.001). Figure 6 shows registration results of some dental X-ray images. 3 METHODS In (Zitova and Flusser, 2003), the authors pointed out that feature-based methods are recommended if the images contain enough distinctive and easily detectable objects, which is usually the case of applications in remote sensing and computer vision, and area-based methods are usually
Improved image alignment method at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
