Motivation: Recently, new RNA secondary structure probing techniques have been developed, including Next Generation Sequencing based methods capable of probing transcriptome-wide. These techniques hold great promise for improving structure prediction accuracy. However, each new data type comes with its own signal properties and biases, which may even be experiment specific. There is therefore a growing need for RNA structure prediction methods that can be automatically trained on new data types and readily extended to integrate and fully exploit multiple types of data. Results: Here, we develop and explore a modular probabilistic approach for integrating probing data in RNA structure prediction. It can be automatically trained given a set of known structures with probing data. The approach is demonstrated on SHAPE datasets, where we evaluate and selectively model specific correlations. The approach often makes superior use of the probing data signal compared to other methods. We illustrate the use of ProbFold on multiple data types using both simulations and a small set of structures with both SHAPE, DMS and CMCT data. Technically, the approach combines stochastic context-free grammars (SCFGs) with probabilistic graphical models. This approach allows rapid adaptation and integration of new probing data types. Availability and Implementation: ProbFold is implemented in C þþ. Models are specified using simple textual formats. Data reformatting is done using separate C þþ programs. Source code, statically compiled binaries for x86 Linux machines, C þþ programs, example datasets and a tutor-ial is available from
IntroductionObtaining accurate secondary structure predictions is a crucial step toward understanding the physical properties of RNA molecules and the biological roles of structural RNA elements. However, computational predictions based only on the primary sequence are often inaccurate and therefore insufficient for in-depth interpretation. Similarly, structure probing data typically only provides partial structural information (). Directly modeling both types of data in the folding process generally improves structure prediction accuracy (). While most studies have used methods based on energyminimization, the inclusion of probing data in probabilistic folding models has not been fully explored (). Here, we develop and explore a modular probabilistic approach for integrating probing data in RNA secondary structure prediction, which we call ProbFold. The focus is on how to best exploit the structure signal of the probing data, while keeping the models general and easy to adapt to new probing data types or additional layers of probing data. We have not aimed to develop a competitive single-sequence structure prediction method. The main focus is therefore on the use of the probing data signal rather than the overall performance. Probabilistic modeling offers a coherent framework for combining different types of evidence as they are all naturally measured on the same scale. Structure models based on energy minimization do not extend naturally to additional types of data in the same way. For instance, probing data measurements must be translated to pseudoenergy perturbations before they can be included in the models, though they do not have inherent thermodynamic interpretations. Probabilistic approaches have previously been used to incorporate comparative evidence in structure folding (). This is another example of supplementing the primary sequence with partial structure evidence and as such closely related to the probing data modeling problem studied here. Several of these methods exploit that generative probabilistic methods can be combined and their parameters optimized in a unified approach. For instance, pfold combines previously established models of molecular evolution (phylogenetic models) with probabilistic models of RNA secondary structure (stochastic context-free grammars  SCFGs). We aimed to develop a method, called ProbFold, that could be readily extended to disparate data types and could encompass different probabilistic models for these. In particular they should be able to capture correlations both within and between data types. This is achieved by combining SCFGs with probabilistic graphical models (PGMs). The SCFG defines a prior over secondary structures, as it does in most other probabilistic methods (). The PGMs model the sequence and any layers of probing data given the structure. PGMs are flexible and modular models useful for capturing select dependencies in high dimensional data (). In our case, they model dependencies between the sequence and the probing data as well as dependencies along the sequence. Standard algorithms allow efficient training of both SCFG and PGMs as well as prediction of the optimal secondary structure. Importantly, this allows ProbFold to be automatically trained without hand-setting any parameters given a sufficiently sized training set of known structures with probing data. The size of the needed training set depends on the number of free parameters in the model. RNA structure probing has a long history and many different methods exist (), including use of chemical agents (), RNases (,b) and spontaneous cleavage (). Generally these modify bases or the backbone preferentially at either single or paired positions, allowing positional information on base-pair status through gel electrophoresis or sequencing. In the case of the SHAPE reagent (selective 2 0-hydroxyl acylation analyzed by primer extension), it is the flexibility of the backbone that determines reactivity, which is generally higher for unpaired than paired regions (). The interpretation of structure probing data is challenged by incomplete specificity of the methods, noisy or missing data, nucleotide biases, etc., which results in incomplete labeling of the primary sequence into paired and unpaired positions. For instance, in the case of SHAPE, the distributions of reactivities for paired and unpaired bases are largely overlapping (see Section 3). There is therefore a great need for computational methods that can integrate and make optimal use of probing data, beyond interpreting the data as a definite labeling of the primary sequence. Recently, progress have has been made on this problem with both physics-based methods (), sampling based methods () and a probabilistic method (). These are briefly presented below. See Eddy (2014) for a detailed review and discussion of their statistical foundations. In RNAstructure (), SHAPE reactivities are converted to base-stacking pseudo-energy change terms using a linear model optimized by prediction performance on a known structure (23S rRNA from Escherichia coli (E.coli)).extends this approach in the RNAsc method, by also including pseudo-energy change terms for unpaired positions. GTfold provides a fast parallelized multi-core implementation of the energy minimization algorithm and similarly includes SHAPE data (). In an extension of RNAfold, pseudo-energy change terms are optimized for each structure given a loss function to maximize the agreement between the energy-based prediction and the experimental observations. In particular, no change is made when the sequence prediction is in complete agreement with the SHAPE data (). Recently, the ViennaRNA Package has been extended to include several forms of soft constraints and specifically include implementations of theapproaches (). A thorough performance comparison of the three approaches is also provided (). Another class of approaches samples structures from the Boltzmann-weighted ensemble and selects a representative structure with minimal Manhattan distance to a probing data profile (). This has been extended to several layers of probing data by a method that reduces them to a single binary pairing status profile (). The recently proposed probabilistic method, PPfold 3.0 (), extends pfold () by modeling both comparative sequence alignment data and experimental probing data. It uses stochastic context-free grammars (SCFGs) to model secondary structures, phylogenetic models to model alignment columns and fine-grained discrete probability distributions to model SHAPE probing data. The study provides a proof of concept for including probing data in probabilistic methods. Compared to PPfold 3.0, ProbFold offers a more general, extendible and parameter-sparse modeling approach that is evaluated using cross-validation. We develop ProbFold using existing SHAPE data () combined with an extensive set of known RNA structures () and evaluate a hierarchy of increasingly parameter-rich models. We find that including both base-pair stacking interactions and neighbor correlations for the SHAPE data improve performance. We also show how multiple types of probing data can be included in the models and may improve prediction performance. We find that the ProbFold approach exploits the probing data well, generally yielding higher performance gains than other methods, and present automatic procedures for optimizing the models on new data types.
Materials and methods
SCFGsSCFGs are the probabilistic variants of Context-Free-Grammars (CFGs). A CFG defines a formal language used for the generation of strings and is particularly suitable for RNA modeling, as it has the ability to capture nested long-range correlations (). This approach has been widely applied in the context of RNA modeling and structure analysis (). An introduction to the use of SCFGs for RNA structure modelling and how they can be extended to handle the multivariate data of our setting is given in the supplementary material and methods section (Section S1.1). For the current study, we use (and extend) the pfold grammar (), which models RNA secondary structures in terms of individual base pairs and unpaired nucleotides through the set of grammar rules: S ! LSjL; F ! bF b bjLS; L ! ajcFb c, where S, L and F are the nonterminals, a, b and c refer to the terminal symbols. However, the grammar does not explicitly model stacking interactions between consecutive base pairs, as done in nearestneighbor energy models (). Apart from hydrogen bonding between paired nucleotides (base pairing), stacking interactions between adjacent base pairs are the largest contributors to helix stability in nucleic acids (). We model these interactions for consecutive base-pairs by replacing a pair-emitting rule with a stack-emitting rule in the PFold grammar (L ! cFb c), which takes the previous base-pair into account. The resulting grammar has six production rules, three of which emit terminals (). The probability of the terminals given the transition between nonterminals is specified by emission models. When modeling only the RNA sequence, the terminals consist of nucleotides and the emission distributions can be defined simply by multinomials (). To also model probing data, the emission models instead specify a joint distribution over both RNA sequence data and probing data. To achieve the flexibility needed for specifying joint distributions over multiple, potentially heterogeneous data types, we use a probabilistic graphical model framework to define the emission models.
Emission distributions and probabilistic graphical modelsProbabilistic graphical models (PGMs) offer a coherent and expressive framework for specifying and analyzing joint probability distributions (). PGMs are generally used to capture independence assumptions among a set of random variables and to specify their joint distribution as a factorization of local distributions each defined over subsets of variables. PGMs can be represented by mathematical graphs with nodes denoting random variables and edges denoting potential dependencies. A rich set of algorithms exist for doing inference with PGMs, which have proven a powerful tool for simplifying complex problems (). We define the emission models as PGMs using the factor graph formalism () (). In this formalism, the PGMs are specified as undirected bipartite graphs between random variable nodes (represented by circles) and factor nodes (represented by squares). The factors hold potentially unnormalized probability distributions involving neighboring random variables. Our current factor graph implementation of PGMs only handles discrete random variables, which simplifies the implementation and speeds up likelihood calculations. Including continuous random variables generally requires potentially slow numeric integration. Probing data are therefore discretized in a preprocessing step (see below). For a start, ProbFold was developed to take an RNA sequence with a single affiliated sequence of probing data values as input. For each sequence position we thus have observed both a nucleotide and a discretized probing data value. We need to define an emission distribution for each of the single, pair and stack emitting rules (). Single models only a single sequence position; pair models a pair of(a) Grammar rules (see (b) for variable definitions). (b) Pictorial representation of the stacking grammar. The grammar has six production rules involving the four non-terminals S, L, F and. denotes the empty sequence, which cannot be derived further. Three of the rules emit terminals, named single, pair and stack and three are non-emitting, including two bifurcation rules. Each bifurcation rule splits into two parts, consisting of a left (l) non-terminal and right (r) non-terminal. The derivation starts in S. S can use either a bifurcation rule, which transits to L (l-part) as well as back to itself (r-part), or a non-emitting rule, which transits to L. L can use either the single emitting rule, which transits to and emits unpaired terminals (a), or use the pair rule, which transits to F and emits paired terminals (ab a ). Finally, F can use the stack emitting rule, which transits back to F and emits (stacked) paired terminals (b b b ) dependent on the previous base pair, or a bifurcation rule, which transits to L (l-part) as well as to S (r-part)For each emission model, the table gives (i) the joint probability distribution; (ii) its factorization specified by the PGM; (iii) example of short input data sequence with potential input positions highlighted. Note that the probing data has been discretized into six bins (05); (iv) mapping of data from highlighted sequence positions to relevant random variables of PGM sequence positions; and stack models four sequence positions, consisting of two consecutive pairs (). For each of the three emission models, we specify a PGM defining a joint distribution over the relevant nucleotides and probing data values (). Initially, the stack model disregards the probing data of the previous base-pair. The PGM specification should reflect the independence structure of the modeled variables. We let the probing data at a position optionally depend on the observed nucleotides of that position. However, we let the probing data from the two sides of a base pair be independent of each other, given the observed nucleotides of the base pair (). These independence assumptions are evaluated separately as part of the model development below.
DatasetsThe ProbFold models are potentially parameter rich. Optimally we would therefore train and test them on comprehensive sets of known RNA structures encompassing tens of thousands of base-pairs affiliated with consistently generated probing data. As such datasets do not yet exist, we complemented structure sets that include probing data with larger sequence-only sets. Our primary structure probing set consisted of SHAPE data from E.coli 16S and 23S rRNAs () augmented with a set of seven small RNA structures that were downloaded from the RMDB repository (). Altogether, these include a total of 2142 unpaired positions and 1479 base pairs. The SHAPE data was preprocessed by denoting all invalid values (reactivity < 0; n  486) as missing data. For a subset of the small structures from RMDB (n  6), DMS (dimethyl sulphate) and CMCT (1-cyclohexyl-(2-morpholinoethyl) carbodiimide metho-p-toluene) probing datasets were also available () (RMDB set, Supplementary). These structures encompass 287 base pairs and 593 unpaired positions, for which 302 positions had missing data for DMS and 415 for CMCT. We used these to illustrate the use of ProbFold on multiple types of probing data. In addition to the above datasets based on Sanger sequencing, we also included a probing dataset based on Next-generation sequencing (NGS). A set of eight small RNA structures with SHAPE-Seq probing data was downloaded from RMDB (Supplementary) (). In combination, these include a total of 280 base pairs and 490 unpaired positions. The probing datasets were complemented with sets of sequenceonly structures called TrainSet A (3166 structures) and TestSet A (n  697), which were originally compiled by. We preprocess these sets by discarding structures with loops with less than three bases, reducing the size of TrainSet A to 2707 (130 227 base pairs) and TestSet A to 593 (25 596 base pairs). In the sup plementary methods and material (Section S1.4), we describe training, testing and prediction procedures adopted in this work.
Probing data modeling and discretizationThe value of probing data for secondary structure prediction depends on the difference between its distribution in single stranded and paired regions. In ProbFold, these probing data distributions (P single and P pair ) are explicitly modeled as part of the PGMs and may be conditioned on the primary sequence. Given our use of discrete PGMs, we discretize the probing data into k bins and use normalized histogram models (i.e. multinomials), which use k  1 free parameters. Initially we visualized these distributions for 16S and 23S SHAPE data using 15 equi-distant bins (Supplementary). We discuss probing data modelling and discretization including optimal criterion for break points based on KullbackLeibler (KL) divergence in the supplemen tary methods and materials (Section S1.3).
Cross-validation and overfittingUnlike some of the previous approaches (S k sd et al., 2012;), we use cross-validation in our performance evaluation (Section S1.2). We thereby avoid to train and test on the same probing data. For instance, when evaluating the performance on 16S, we train on 23S combined with RMDB and the sequenceonly TrainSet A. This further limits the number of probing data related free parameters that can be learned without overfitting during development. The number of free parameters (fp) in the probing data models is proportional to the number of bins used in the discretization. When the number of free parameters is increased, the models typically learn the properties of the training data well, but generalize poorly to other datasets. To select the optimal number of bins and to illustrate this behavior, we plot the prediction performance on both trainBoth the F-value and the change in F-value (DF) relative to the sequence-only (Seq-only) predictions are shown. The maximal performance score for each structure is denoted in bold. TheSHAPE conversion approach was used for RNAfold (RNAfold.zar). See Supplementary Tables S3S10 for the full set of performance statistics. and test sets when using probing data from 16S and 23S (Supplementary). The test performance is optimal between 3 and 15 bins, whereas train performance continues to increase and approaches perfection due to overfitting. Based on this, we use six bins for the discretization in the model evaluation below, which is the only fixed metaparameter.
Results
Model selectionWe developed and evaluated a hierarchy of models capturing different correlations in the data with increasing number of free parameters (Supplementary). The limited amounts of training data enforces a tradeoff as models with too many free parameters will be overfitted and not be robust.
Sequence-only modelsWe started out with two sequence-only models: The pair model uses the original PFold grammar () and is specified by 18 free parameters (fp). The stack model uses the above described grammar extension, which also includes stacking interactions (fp  258). The stack model showed a modest performance gain over the pair model in the ROC analysis and by F-measure ().
Probing data modelsTo extend the sequence-only models to also handle probing data, we developed emission models that generate both sequence data and SHAPE reactivities. To guide the development of these, we started by analyzing correlations in the 16S and 23S SHAPE datasets. We first evaluated if the SHAPE reactivities were correlated with the primary sequence nucleotides. To control for compositional biases and the different level of reactivities, we did this separately for single (unpaired) and paired regions (,b). In both cases, there were significant differences in the distribution of the SHAPE values for the different nucleotides (P <4.4e03 for single and P <8.6e06 for pair; Kruskal-Wallis rank sum test). We then evaluated if the SHAPE reactivities were correlated between the left and the right side of a base-pair (). Surprisingly no correlation was observed (Pearson correlation coefficient, pcc-0.042; P-value  0.075). This may be explained by the overall low SHAPE reactivities of paired bases, causing experimental noise to dominate any underlying signal. Based on these observations, we defined emission models where the SHAPE reactivities of the left and the right side of a base pair are modeled independently, but with each their own distribution. Altogether, the 25 free parameters are used to model the SHAPE reactivities given discretization in six bins (single model: fp  5; pair models: fp  2  5  10; stack models: fp  2  5  10). Preferably, ProbFold should capture differences in SHAPE reactivities among nucleotides. However, capturing these dependencies requires many additional free parameters (fp  4  25  25  75). Given the limited training data, we therefore model the primary sequence and the SHAPE reactivities independently (e.g. the single model becomes Ps; d  Ps  Pd, as shown in Supplementary). These emission models were combined with the grammar of the sequence-only stack model selected above to give the stacksh (fp  283) model for SHAPE data. The inclusion of SHAPE data dramatically improved sensitivity and overall performance (,c and Supplementary) We finally evaluated if SHAPE reactivities correlate with neighboring positions, again analyzing single and paired regions separately (,e). Significant positive correlations were observed in both cases (P < 0.0001), with an overall higher correlation in single regions (pcc  0.559) than in paired regions (pcc  0.397). The correlations may reflect overall steric constraints, which are likely to be correlated along the primary sequence. For instance, backbone flexibility of loop positions may decrease toward stems. We extended the emission models of the stacksh model to capture these sequential correlations in the SHAPE data (Supplementary), which requires many additional free parameters (fp  125). The resulting model, stackshcor (fp  408), improves performance over simpler models when trained on the 23S dataset, but not when trained on the smaller 16S dataset. We attribute the decrease in performance on 23S (842 base pairs) to overfitting of the parameter rich correlation model when trained on the 16S dataset (468 base pairs). Overall, we recommend the stackshcor model for SHAPE prediction applications. We make a version trained on the combined 16S and 23S datasets available for download together with the other ProbFold models (http:// moma.ki.au.dk/prj/probfold/). We also evaluated the performance of four existing methods, PPfold 3.0 (), RNAstructure v5.6 (), GTFold-3.0 () and RNAfold (), with the SHAPE conversion model from(hereafter termed RNAfold.zar), on the 16S and 23S sequences with and without SHAPE data (Supplementary). For the sequence-only predictions, the ProbFold stack model results in a low sensitivity (<0.30) and a high PPV ($0.80). This pattern is shared by ppfold, though it has somewhat poorer performance, which may be explained by it not modeling stack interactions. RNAstructure, GTFold and RNAfold, which all have richer structure models, have more balanced sensitivity and PPV performance. As a result they have higher F-values for 23S and, in some cases, also for 16S. ProbFold stack has the highest accuracy (ACC) on both sequences. When including SHAPE data, ProbFold continues to have low sensitivity (4762%) and high PPV (7690%) compared to the other methods. However, ProbFold's tradeoff between sensitivity and PPV can be adjusted (). RNAstructure has the highest overall performance both by accuracy and F-value, closely followed by RNAfold.zar and also GTFold in the case of the 16S sequence. However, the 16S and 23S SHAPE datasets used in the development of ProbFold, have also been heavily used for developing the SHAPE models of the other methods. Specifically, PPfold was trained on both 16S and 23S and the RNAstructure parameters were chosen based on parameter-grid analysis of 23S with performanceProbabilistic method for RNA structural data integrationevaluation on 16S (information not available for GTfold and RNAfold.zar; Supplementary). This could lead to overfitting and performance statistics that do not generalize. In contrast, the performance results for ProbFold are based on cross-evaluation, to avoid the effect of overfitting to the train dataset (Supplementary). The performance results are therefore not directly comparable between methods. As an independent test dataset, we evaluate the performance on a set of small RNA structures with SHAPE data (and Supplementary Tables S3S10). On this set, ProbFold achieves the highest F-value and accuracy on five of the eleven structures. It ranks second after RNAfold.zar in terms of overall F-value and accuracy across all structures (and Supplementary). Since our main focus is ProbFold's ability to exploit the probing data, we also evaluated the relative gain in performance when including probing data over sequence-only predictions (and Supplementary Tables S6, S8 and S10). ProbFold showed the highest gain for five of the eleven structures, with an average F-value gain of 0.29. The other methods showed smaller relative gains, with PPfold at 0.11, GTFold at 0.05, RNAstructure at 0.02, and RNAfold.zar at 0.12. We also evaluated ProbFold on an NGS-based SHAPE-Seq dataset (), again using cross-evaluation (Supplementary). The performance is comparable to that of the capillary SHAPE data, if slightly better, with an overall accuracy of 0.76. Again, the gain from sequence-only performance is substantial (Daccuracy of 0.29).
Robustness to noiseExperimental probing data will always include some amount of noise. When ProbFold is trained, it in effect learns the correlation between probing data levels and structure elements. If there is much noise, it should learn that the correlation is weak and that the probing data holds little information. To evaluate robustness to noise, we simulated noisy versions of the 16S and 23S SHAPE datasets (). Scaled random noise was drawn from a standard normal distribution and added to the observed SHAPE value at every position. For each of a range of noise strengths, 30 datasets were generated and the structure prediction performance evaluated for both ProbFold as well as RNAfold.zar (with scoring by), RNAstructure and PPFold (Supplementary). ProbFold was evaluated using cross-evaluation on each simulated dataset and hence retrained on the structure not used for evaluation. Overall, ProbFold shows greater robustness to an increase in noise levels than the other methods. In particular, the fine-grained SHAPE distributions of PPFold appear sensitive to noise, with a fast decay in performance. At high noise levels, ProbFold performance approaches the sequence-only level, as could be expected. This demonstrates the potential advantage of retraining models and learning the signal strength of individual datasets.
ProbFold with other data typesTo illustrate the use of ProbFold on other types of probing data, we retrained and applied the model on publicly available DMS and CMCT datasets covering six small RNA structures (see Section 2.3). We used leave-one-out cross evaluation to train and evaluate the performance of the stacksh model from above. Given the limited amount of training data, we use the KL approach to discretize the probing data into three bins only, which reduces the number of free parameters used to model probing data from 15 to 6. For both types of data, the overall performance improved compared to using only the primary sequence (Supplementary Tables S12, S13). Overall, using DMS resulted in better prediction performance than CMCT (F-values of 0.54 versus 0.48). The lower power of CMCT(b)compared to DMS is also apparent from the smaller separation between the probing signal intensity distributions for paired and unpaired positions (Supplementary). As both DMS and CMCT probing have known strong nucleotide dependencies, we also evaluated a version of the stacksh model where the probing signal distributions depend on the sequence nucleotides (as shown in). For DMS the separation of the paired and unpaired signal distributions conditional on sequence nucleotide appear to improve slightly (Supplementary). Whereas for CMCT no improvement is obvious (Supplementary). However, the prediction performance decreased for both models in cross-evaluation (F-values of 0.40 for DMS and 0.37 for CMCT), likely due to the limited training data and many additional free parameters (n  18) introduced in this model even when discretized into three bins only.
Modeling multiple data typesWhen available, integration of multiple probing data types should increase prediction accuracy. We here show how ProbFold's emission models can be extended to handle multiple data types, using the single model as an example (). Based on the emission models of, we suggest to model multiple types of probing data (d 1 , d 2 , d 3 , d 4 and d 5 ) as independent given the nucleotide of the primary sequence. For the single model, the joint distribution thus beThe other emission models can be simply defined following the same scheme. To demonstrate the advantage of using multiple datasets, we performed a proof-of-principle experiment based on boot-strapped data, given the limited extent of existing real datasets for well annotated structures (see Section S1.5 for details). Performance improved when adding additional datasets, with the largest performance gains for the first two sets and gradually smaller gains for the following (Supplementary). To further demonstrate the benefit of combining multiple probing datasets and to also include different data types, we applied the multiple-data-set model to the six previously described RMDB structures for which CMCT, DMS and SHAPE are all available (). Given the limited extent of the available datasets, each is modeled using only three bins, with KL optimized break points (Section S1.3), to retain the number of model parameters. The experiment is thus still at the proof-of-principle level. As more data become available, more bins can be used to capture the structure signal of the probing data, which is expected to improve performance. The performance was measured using leave-one-out cross evaluation and averaged across all six structures (and Supplementary). Both sensitivity and the overall performance as measured by accuracy and F-value increase when incrementally adding each of the three probing datasets, starting with sequence-only (). A slight decrease of PPV is observed when adding DMS. Integration of SHAPE, DMS and CMCT data have previously been carried out using RNAstructure v. 5.3 and pseudo-energy terms (). For comparison, we evaluate the performance of the multidata version of RNAstructure on RMDB structures (and Supplementary). While RNAstructure performs much better on the sequence-only dataset and achieves the highest overall F-values, ProbFold shows the largest relative gains from including probing datasets. ProbFold also show consistent gains with each added dataset, which is not the case for the RNAstructure model (). This suggests that the ProbFold emission models are able to make good use of the available structure signal. The emission models can be further extended to account for dependencies both within and among multiple datasets (Section S1.6). To further illustrate the signal contribution of the individual probing data types, we plotted the raw activities () () as well as the ProbFold pairing probabilities (, Supplementary Figs S9S14) against the known RNA secondary structures. The reactivities of the different data types generally correlate well, with a few exceptions for CMCT (). The SHAPE reactivities are more auto-correlated than those of CMCT and DMS, with less local variance. As shown by the above performance evaluations, all data types contribute useful structure signal for ProbFold, with an increase in pairing probabilities for paired regions (). In effect,(b). Multi-data version of ProbFold. (a) PGM for single emission distribution that integrates five types of probing data, d 1 , d 2 , d 3 , d 4 and d 5. P(s) is the prior distribution of sequence data, P d i js; i  1::5, are the conditional distributions of the different types of probing data given the sequence data. (b) Prediction performance of the multi-data version of ProbFold with incrementally increasing number of probing data types (CMCT, DMS and SHAPE) on six small RNA structures. Performance evaluated using cross evaluation with same measures as above. (c) Raw probing data reactivities for CMCT, DMS and SHAPE shown for a part of the Glycine riboswitch together with the known structure. (d) Positional pairing probabilities under the ProbFold model given either only the primary sequence; sequence combined with a single probing data type; or sequence and all three probing data types in combination. The pairing probability is defined as the posterior probability of pairing with any other base, which equals one minus the posterior probability of being unpairedProbFold thus averages out the noise in the data given the structure constraints imposed by the primary sequence. Though SHAPE generally contribute the largest individual gains in pairing probabilities, the combination of all three sets further adds to the difference between the paired and unpaired reigons (Supplementary Figs S914).
DiscussionWe have presented a probabilistic method for RNA secondary structure prediction that integrates experimental structure probing data. One of the virtues of our approach is its flexibility. The underlying model was initially developed on a capillary electrophoresis SHAPE dataset, but it can readily be retrained and applied on other data types given sufficient training data as well as extended to handle multiple data types. We demonstrated these extensions with proofof-concept examples on existing datasets and on generated (bootstrapped) data. We developed and trained versions of ProbFold for SHAPE, SHAPE-seq, DMS and CMCT probing data  both individually and in combination. We also evaluated different variants of these models, for instance including nucleotide dependencies. The flexibility is achieved by the use of a highly modular probabilistic model with accompanying efficient algorithms for training and prediction (). As with most other probabilistic RNA secondary structure prediction methods (), we use stochastic context-free grammars to model the secondary structure. We find limited benefit of modeling stacking interactions, as have others (). This may be because individual base-pair parameters already account for most of the stacking interaction effects (). We factorize the grammar rules into transitions and emissions. In contrast to other methods, we explicitly specify the emission distributions using probabilistic graphical models (PGMs), which may be defined over multi-variate input data. The implementation closely reflects this modularity, with separate textual specifications of the overall grammar, the transitions, the PGMs defining the emission distributions; and the mapping of observed data to PGM variables. As part of the model development, we evaluated correlations in the probing data. We found modeling SHAPE probing data correlations along the sequence improved performance, given enough training data was present. In general, detecting and modeling the prominent dependencies in the observed data is expected to improve the fit and the discriminatory power of the emission distributions and hence overall model performance. However, including correlations makes the models more complex with many additional free parameters to learn. Given the limited size of probing datasets for training, overfitting and lack of robustness easily becomes a problem, as shown for parameter-rich versions of ProbFold (e.g. Supplementaryand Supplementary). ProbFold bins the continuous probing data values to allow for the use of discrete PGMs. This simplifies the PGM implementation, for instance by avoiding computationally expensive numerical integration, and avoids use of analytical continuous distributions with a potentially poor fit. As the structural signal of the probing data depends on the differences in its distribution in different structural regions, both the number of bins and their boundaries are important parameters of the model. We show that the number of bins should be kept small given the amount of available training data to avoid overfitting. We suggest to select bin boundaries by optimizing the difference between the single and pair probing data distribution using KL divergence. As an alternative to discretizing the data, parameter free continuous distributions, such as kernel distributions, could be used. These however easily become computationally heavy, as they in principle are specified by the full training dataset. Given knowledge of the uncertainty of the probing data observations, a more satisfying approach would be to explicitly model the uncertainty of the individual probing data values. Such knowledge would be available, e.g. with counts from NGS-based probing data, as some of transcriptome-wide approaches produce (). The RNAstructure method converts SHAPE reactivities to pseudo energy change terms, which are incorporated when predicting the minimal free energy structure (). The conversion is done using a simple linear parametric form, which only requires two free parameters. Using a simple parametric form limits the number of free parameters, but may also introduce bias if the fit is poor in part of the probing data value range. In particular, RNAstructure has been shown to perform extremely well on 16S rRNA when introducing several preprocessing steps and filters, such as (i) selecting parameters performing well on 23S; (ii) limiting the allowed distance between base pairs; (iii) focusing on sites with useful SHAPE data and (iv) disregarding sites with clear incompatibilities with the comparative reference structure (). Though individually helpful, manually selecting parameters and introducing many preprocessing steps risk making the approach more liable to overfitting on a concrete dataset. Direct calculation of pseudo-energy change terms based on log-likelihood ratios of being paired versus unpaired has also been suggested (), which is closer to the approach taken by ProbFold. ProbFold has been designed with the aim of extendibility to multi-variate probing data measurements. This could for instance be the combination of SHAPE with other chemical or enzymatic probing agents, as in the proof-of-concept example using CMCT, DMS, SHAPE data. If the noise in the individual measurements at a site are correlated it becomes important to capture these correlations in the model to retain specificity. Such correlations could for instance be caused by tertiary structure interactions involving single stranded regions, which may affect several types of probing agents, including SHAPE. Specifically, non-canonical base pairs will often give similar signal to canonically paired bases using SHAPE but not DMS. Learning such correlations would therefore be expected to improve prediction performance. As more and more RNA tertiary structures are found, one solution could be to explicitly include tertiaryBoth the F-value and the change in F-value (DF) relative to the sequence-only (seq-only) predictions are shown. The maximal performance score for each combination of probing data types is denoted in bold. See Supplementaryfor the full set of performance statistics. structure aspects into the model (). In the case of SHAPE, we did not observe any correlation between paired bases. However, such correlations may well exist for other types of probing agents, such as double stranded RNases. Even partial evidence for the presence of specific base pairs could significantly improve performance by constraining and simplifying the folding problem. Such evidence would resemble the signal exploited from compensatory base pair substitutions exploited in comparative RNA structure analysis. As suggested by S k sd et al. (2012), additional power could be gained by combining experimental probing data with comparative data, though this would be limited to functional and conserved RNA structures. However, exploring these extensions is beyond the scope of the current study. Through proof-of-principle experiments, we have illustrated the applicability of ProbFold to different types of probing data and to multiple complementary datasets (). The performance evaluations show that ProbFold can make efficient and competitive use of the probing data, both for SHAPE data and when combining multiple datasets (Tables 1 and 2). Retraining aids its adaptation to varying noise levels. However, model performance is limited by the small size of the available training datasets, which restricts model complexity and hence predictive power. We hope the advent of NGS-based high-throughput structure probing techniques, as pioneered by
at University of California, Los Angeles on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
S.Sahoo et al. at University of California, Los Angeles on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
