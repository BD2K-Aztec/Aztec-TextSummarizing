Motivation: In vitro and in vivo cell proliferation is often studied using the dye carboxyfluorescein succinimidyl ester (CFSE). The CFSE time-series data provide information about the proliferation history of populations of cells. While the experimental procedures are well established and widely used, the analysis of CFSE time-series data is still challenging. Many available analysis tools do not account for cell age and employ optimization methods that are inefficient (or even unreliable). Results: We present a new model-based analysis method for CFSE time-series data. This method uses a flexible description of proliferating cell populations, namely, a division-, age-and label-structured population model. Efficient maximum likelihood and Bayesian estimation algorithms are introduced to infer the model parameters and their uncertainties. These methods exploit the forward sensitivity equations of the underlying partial differential equation model for efficient and accurate gradient calculation, thereby improving computational efficiency and reliability compared with alternative approaches and accelerating uncertainty analysis. The performance of the method is assessed by studying a dataset for immune cell proliferation. This revealed the importance of different factors on the proliferation rates of individual cells. Among others, the predominate effect of cell age on the division rate is found, which was not revealed by available computational methods. Availability and implementation: The MATLAB source code implementing the models and algorithms is available from
IntroductionProliferation is essential in many biological processes, ranging from development to wound healing, immune response and stem cell renewal. Due to this eminent role, a key challenge in cell biology is to quantify proliferation dynamics. Nowadays, there are different experimental methods available to assess cell proliferation, e.g. time-lapse microscopy () and proliferation assays based upon carboxyfluorescein succinimidyl ester (CFSE) labeling (). While time-lapse microscopy is highly informative, it is difficult to apply in vivo. CFSE-based proliferation assays can be employed in vivo and in vitro, but the data analysis is more intricate and no single-cell time courses are available. To study proliferation using CFSE, cells are incubated with carboxyfluorescein diacetate succinimidyl ester (CFDA-SE). CFDA-SE can diffuse across the cell membrane and once in the cytoplasm is converted to CFSE, which binds covalently to intracellular proteins. V C The Author 2016. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com CFSE is a fluorescent dye and its concentration is reduced by protein degradation as well as cell division. During cell division, CFSE is distributed approximately equally among daughter cells (); hence, proliferation results in a progressive dilution of the dye (), which can be recorded using flow cytometry. As the individual cells do not, in general, divide with the same rates, an initially unimodal distribution () becomes multi-modal as time progresses (). The modes are related to different numbers of cell divisions (); however, often the cells with different numbers of divisions are not strictly separated. For this reason, the calculation of the number of cells with a certain division number using peak detection and deconvolution methods () is error-prone. Furthermore, even knowledge about the number of cells with a particular division number does not enable the comparison of different hypotheses regarding, e.g. the proliferation rates. The need for quantitative data analysis and hypothesis testing inspired the development of a multitude of model-based approaches. Nowadays, age-structured population (ASP) models (), division-structured population (DSP) models (), label-structured population (LSP) models (), age-and division-structured population (ADSP) models (), and division-and label-structured population (DLSP) models () are used to study CFSE data. These classes of population balance models account for up to two properties of individual cells: @BULLET number of divisions i (! DSP and DLSP model) @BULLET CFSE concentration x (! LSP and DLSP model) @BULLET cell's age a (! ASP and ADSP model)and are mostly written as systems of ordinary differential equations (ODEs) or partial differential equations (PDEs). Population balance models which account for the cell agethe time passed since cell division, i.e. ASP and ADSP, can also be formulated as sets of nested integrals (De). This alternative formulation is employed for the SmithMartin model () and the cyton model (). For the SmithMartin model and cyton model (with progression fraction equal to zero), equivalent PDE formulations are available (). For a comprehensive introduction to structured population models, we refer to the review by De Boer and Perelson (2013). As the population models available in the literature did not capture the complexity of the process, we recently introduced the division-, age-and label-structured population (DALSP) model (). The DALSP model, a system of coupled PDEs, provides a flexible description of proliferation dynamics (), but it has never been used to analyse CFSE data. Accordingly, no parameter estimation, model selection and uncertainty analysis methods have been available for this type of model until now. In this manuscript, we introduce methods to infer the parameters of DALSP models from CFSE distribution time-series data and to assess the dependency of the proliferation rates on factors such as cell age. For this we introduce a statistical model linking predictions of the DALSP model to measure CFSE data and formulate the corresponding inverse problem. As the optimization problem is nonlinear, we compare different optimization procedures. Furthermore, we implement the first identifiability and uncertainty analysis methods for DALSP models. Combined with model selection methods, these methods facilitate an in-depth analysis of CFSE time-series data, which we illustrate for a published dataset.
MethodsTo analyse CFSE data, we combine mechanistic and statistical models of the biological process and the measurement process. In the following we present the different ingredients as well as the inference methods. A more detailed description is provided in the Supplementary Information. Notation: We denote the set of non-negative real numbers by R  : 0; 1 and the set of natural numbers with zero by N 0 : f0; 1; 2;. . .g. The units used in the following equations are number of cells (cells), unit of concentration (UC), unit of fluorescence intensity (UFI) and unit of time (UT). For simplicity, we assume that age and time are measured in the same units, generalizations are straight forward.
DALSP modelThe state variable of the DALSP model is the joint number density of age, label concentration and cell division number, na; x; ijt (in cells/UC/UT). Its dynamics are governed by a system of coupled 2D PDEs,The i-th PDE describes the dynamics of cells with i divisions. The factorization of the initial condition, na; x; 0j0 n 0 ap 0 x, in initial age distribution n 0 a (in cells/UT) and initial label density p 0 x (in 1/UC), is biologically plausible as the labeling efficiency should not depend on the cell age. This factorization will allow for an efficient numerical solution algorithm. In (1)(3), a i t; a and b i t; a denote the rates (in 1/UT) of cell division and cell death for cells with i divisions. The rate of cellular label degradation is denoted by t; x  ktx (in 1/UT), with rate constant k(t) (in 1/UT/UC). Accordingly, the following terms contribute to the temporal change of the density na; x; ijt: @BULLET @t; xna; x; ijt=@x, change of label x with rate t; x, @BULLET @na; x; ijt=@a, increase of cell age a, and @BULLET  a i t; a  b i t; a   na; x; ijt, loss of cells from the ith subpopulation due to cell division and due to cell death, and possess units cells/UC/UT 2. The loss of cells from the i  1th subpopulation due to cell division results in the birth of cells in the ith subpopulation with age a  0, defining the BCs (3). The BCs are obtained by integrating a i1 t; ana; 2x; i  1jt over the age. As the cells double (factor 2) and the label distribution is rescaled due to the halving of the label concentration (factor 2), this integral is multiplied by a factor 4. The rates as well as the initial conditions are usually unknown and have to be estimated from experimental data. Therefore, rates and initial conditions are parameterized in terms of a parameter vector h 2 R nh (see Application section). For a more detailed statement of the model we refer to the Supplementary Information, Section 1.1.1.
Modeled and measured quantitiesThe number density na; x; ijt encodes the properties of the proliferating cell population. By marginalizing na; x; ijt over all cell ages and label concentrations, the number of cells which underwent i divisions,is obtained. The subsequent summation over the division number i yields the overall number of cells, Nt  P i2N0 Nijt. Marginalization over label concentrations and division number and subsequent normalization with the number of cells yields the age distribution,The label distribution, pxjt, is obtained by marginalizing over cell age and division number and normalizing with the overall cell number,Proliferation assays provide information about the overall number of cells as well as the sum of label-induced fluorescence (and C) and cellular background fluorescence. The label induced fluorescence, y (in UFI), is proportional to the label concentration, y  cx with x $ pxjtand proportionality constant c > 0 (UFI/UC). The background fluorescence y b is a random variable, y b $ p b y b  (in UFI), whose distribution (p b ) depends potentially on the biological system, the measurement procedure and technical factors. The distribution of the total measured fluorescence, y m  y  y b (in UFI), obeys the convolution integral,with pyjt  1 c p: x  y c jt (see Supplementary Information, Section 1.1.2). In the presence of outliers, py m jt can be mixed with an outlier distribution, p outliers y o  (see Supplementary Information, Section 2.1).with intervals fI j g J j1 provide a histogram. The probability py m 2 I j jt k  of observing an individual cell at time point t k in bin j is the integral of py m jt k  over I j. The overall cell count measured at time point t k is denoted by
Numerical simulationTo compute the number density na; x; ijt and further model properties, the DALSP model (1)(3) is solved numerically. For this we exploit that the solution of the system of coupled 2D PDEs (1)(3) is factorable (). The first factor is the solution to a system of coupled 1D PDEs describing an ADSP. This solution is computed using an efficient iterative numerical scheme. The second factor is the solution to a set of decoupled 1D PDEs describing the label distribution in cellular subpopulations with similar division number. This solution can be determined analytically. The factorization accelerates the numerical evaluation by several orders of magnitude compared to naive numerical methods. A similar decomposition approach is used to compute the sensitivities of na; x; ijt with respect to the parameters h i , @na; x; ijt=@h i. Given na; x; ijt and its sensitivities, the model properties and their derivatives are determined via numerical integration. The convolution integral defining the measured fluorescence intensity is evaluated using Fenton's approximation (). For further details we refer to the Supplementary Information, Sections 1.21.5.
Parameter estimation and uncertainty analysisWe employed maximum likelihood and Bayesian parameter estimation to determine the unknown model parameters h, with h 2 H R nh , from the collection of binned snapshot dataTo account for measurement noise in the measured overall cell number and the histograms, the likelihood functionis used (). The likelihood Pf H j t k g J j1 jh of observing the histogram f H j t k g J j1 follows a multinomial distribution with category probabilities fpx m 2 I j jt k g J j1. The likelihood P N k jh of observing the overall population size N k assumes a log-normally distributed measurement error. A detailed statement of the likelihood functions is provided in the Supplementary Information, Section 2.1. Prior and posterior distribution for Bayesian parameter estimation are denoted by ph and phjD, with phjD / PDjhph. A log-uniform prior ph is employed. The maximum likelihood estimates h ML and maximum a posteriori parameter estimates h MAP are obtained by maximizing the respective objective functions. To improve the numerical evaluation and the optimizer convergence, we maximize the logarithms of the objective functions, e.g. h ML  arg max h2H
log PDjh:These nonlinear optimization problems are solved using stochastic global optimization () and multi-start local optimization (). For stochastic global optimization the particle-swarm pattern search method PSwarm () is employed. For multi-start local optimization, parameters are drawn from the parameter domain H and used as starting points for the local optimizer. For local optimization the MATLAB routine fmincon.m is used with and without user-supplied gradients. The user-supplied gradients are computed using the forward sensitivity equations of the DALSP model (see Supplementary Information, Sections 1.2 and 2.1.) The estimated parameter values reveal properties of the proliferation dynamics. To assess parameter identifiabilities and uncertainties we calculate profile likelihoods () using our inhouse Parameter EStimation TOolbox (PESTO) and sample the posterior distribution using the Delayed Rejection Adaptive Metropolis sampler developed by. The posterior sample is employed to study parameter correlations and prediction uncertainties (). For details on the optimizer and sampler settings we refer to the Supplementary Information, Sections 2.22.4.
Hypothesis testingCompeting hypotheses regarding the mode of proliferation can be encoded in the rates at; a and bt; a. Each of the resulting models is assessed using the Akaike information criterion (AIC),).
ImplementationAll implementations are available as MATLAB toolbox from GitHub (http://janhasenauer.github.io/ShAPE-DALSP/). As the MATLAB Symbolic Math Toolbox is used to construct the models and sensitivity equations, a variety of alternative rates a i t; a; b i t; a and t; x  ktx can be analysed easily.
ApplicationWe illustrate the proposed model-based quantification method by studying T lymphocyte proliferation. T lymphocytes are part of the adaptive immune system and their pool expands upon pathogen recognition. This expansion is frequently monitored using CFSE labeling ().
Experimental data and mechanistic modelWe considered T lymphocyte proliferation upon treatment with antibodies against CD3 and CD28 receptors. Experimental data for this setting have been collected byand analysed in a series of studies (). This multitude of preceding studies underlines the importance of the dataset and renders it ideal for the evaluation of our approach. In this study, an ensemble of DALSP models is used to study the CFSE data collected on Days 15 post treatment. To capture the observed heterogeneity, the initial CFSE distribution (on Day 1), p 0 x, is modeled by a weighted sum of two log-normal distributions and the distribution of the autofluorescence, p a x a  is modeled by a single log-normal distribution. After considering different alternatives, we set initial cell age to zero, such that the initial condition is given by n 0 a  N 0 da. N 0 is the initial number of cells and d denotes the Dirac delta distribution. We considered rates of cell division which are constant, age-and/or division number-dependent, i.e.and the same holds for the rate of cell death, b i a. The age-dependence is modeled by Hill-type functions with maximal rates k a;i and k b;i which can depend on the division number i. Similar to previous publications the intracellular CFSE degradation is described using Gompertz decay, kt  k deg exp c deg t (). The constants used to model the rates, e.g. k a;i ; k b;i ; k deg and c deg , and the parameters of the initial conditions are part of the parameter vector h and estimated from the data. Lower and upper bounds for these parameters are reported and discussed in the Supplementary Information, Section 3.1. The combinations of different hypotheses regarding a i a and b i a give rise to 16 model alternatives with 1229 parameters. We denote these models with M 1 M 16 and their properties are summarized in. In the following sections, these model alternatives are compared and used to interpret the CFSE time-series data.
Comparison of optimization methodsWe estimated the parameters of all 16 model alternatives using the particle-swarm optimization algorithm implemented in PSwarm and the multi-start local optimization method implemented in PESTO. The latter performs individual deterministic optimizations using gradients obtained by finite differences or sensitivity equations. For all optimization methods we assessed the percentage of converged starts using the likelihood ratio test with a significance level of 0.05 (see Supplementary Information, Section 2.4). This is a weak, statistically motivated measure of convergence and can be checked easily also for complex problems. Beyond converged starts, we considered the distribution of computation times for individual starts as well as the average computation time per converged start. The latter is computed by dividing the overall computation time by the number of converged starts (see Supplementary Information, Section 2.4). This yields a measure for the overall optimizer efficiency. The results for 250 runs of PSwarm, 250 runs of the deterministic optimizers used in multi-start local optimization and 250 random parameter samples for different model alternatives are depicted inand Supplementary. For M 2 all optimizers achieve a significant improvement compared to random samples. For M 2 the percentages of converged starts were for all optimizers comparable (), but deterministic optimizers using sensitivity equations were two orders of magnitude faster than PSwarm (and C) and the only algorithms able to reproduce the global optimum. For model alternatives with more parameters, the difference in the performance of multi-start methods and PSwarm becomes even more apparent (Supplementary). Hence, although PSwarm is known to outperform most available global optimization algorithms (), we found that multi-start local optimization yields better results for DALSP models.
Evaluation of age-dependent proliferation ratesModel M 1 M 16 describe different dependencies of the proliferation rates on cell age and division number. A comparison of the measured distributions and cell counts () with the best fits for these model hypotheses is provided in, Supplementary Figures S4 and S5. We found that already the model M 1 , which assumes constant rates of cell division and cell death, fits a large fraction of the data well (). Model M 2 , which accounts for agedependence of the division rate, already provides a good visual agreement of model and data (). The fit tends to improve further as additional degrees of freedom (i.e. model parameters) are introduced (). To our surprise, we found only a weak correlation between the log-likelihood and the number of parameters of a model (). In contrast, age-dependence of the division rate separates the models in those with high log-likelihood values (! good fits) and those with low log-likelihood values (! bad fits). Taken together, this indicates that missing age-dependence of the rates of cell division cannot be compensated by increasing the number of parameters and the model complexity. To assess the importance of individual dependencies of proliferation rates we computed the AIC and BIC values (). Both information criteria provided identical rankings and revealed the model hierarchy visualized inand C. The best eight models were those with age-dependence of the rates of cell division, including M 2. The best four models were those with age-and division-dependent rates of cell division. The best two models were those possessing in addition a dependence of the rates of cell death on the division number. In the best model the rates of cell division and cell death depend on cell age and division number. Previous studies relying on LSP and DLSP models assumed timeand/or CFSE concentration-dependent division rates. The estimates of these division rates were multi-modal, difficult to interpret and possessed many unknowns [see, e.g. () and (. The DALSP models proposed here possess fewer parameters and the age-dependent rates of cell division are interpretable, e.g. in terms of inter-division times (). Furthermore, age-dependent rates provide a direct link to the cell cycle-dependent gene expression during T lymphocyte proliferation and differentiation (). Accordingly,Rows two to five indicate the dependencies considered in the different models. Dependencies are indicated using fnc, e.g. a  fnca indicates that a depends on a. The values for AIC and BIC are for the maximum likelihood estimate found after 250 runs of a deterministic local optimizer exploiting forward sensitivity equations A B CDALSP models facilitated an accurate description and a meaningful interpretation of CFSE time-series data in terms of model parameters.
Analysis of parameter and prediction uncertaintiesAs estimated parameters and predicted model properties are potentially non-identifiable from available CFSE time-series data, we assessed their uncertainties using profile likelihoods and Markov chain Monte Carlo (MCMC) sampling. We evaluated the optimization procedures and found that only deterministic optimization with sensitivity equations yields accurate profile likelihoods. Furthermore, despite the use of state-of-the-art adaptive MCMC sampling procedures, random initialization of the starting point did not yield a sample within 30 CPU days that passes the Geweke test (), a convergence diagnostic. In contrast, initialization at the MAP estimate resulted after only 2 CPU days in a sample that passes the Geweke test. This demonstrated the importance of reliable and efficient optimization methods for uncertainty analysis. The results of the uncertainty analysis forFor M 2 , the simplest model which provides a good visual agreement of model and data, we found that most parameters are practically identifiable (Supplementary). The maximum rate of cell division, k a , as well as the age at which the half maximum value of the division rates is reached, K a , were tightly constrained (). For the Hill coefficient, n a , we considered the range of 10 6 to 10 2 and found a lower bound of 45.4. Accordingly, the age-dependent division rates, a i a, is close to the scaled Heaviside step function k a ha  K a  which would be reached for n a ! 1 (). This indicates that the upper bound for n a chosen in the study, n a 10 2 , does not influence the estimation results significantly. For the estimated division rate, the inter-division time (in the absence of cell death) is similar to a shifted exponential distribution (). This is the distribution assumed in the SmithMartin model (). The rate of cell death, ba  k b , was significantly smaller than the maximal rate of cell division, k a (). As the rate of cell death is constant, the time to cell death (in the absence of cell division) is exponentially distributed (). The estimated parameters of the rates of cell division and cell death are correlated (Supplementary). The good agreement of profile likelihoods and histograms obtained using MCMC sampling underpin the functioning of the methods. Confidence intervals for all parameters of model M 2 are provided in.Beyond the quantification of parameter uncertainties, we assessed model predictions. As CFSE time-series data are most frequently used to determine the number of cells with a certain number of divisions, Nijt, we used samples from the posterior distribution. Parameter and prediction uncertainties for model M2. Parameterization of (A) age-dependent division rate and (D) death rates along with the uncertainty of the corresponding model parameters. Histograms of the MCMC samples (boxes) and profile likelihoods the individual parameters (line) are depicted along with the statistical threshold for the 95% confidence intervals (dashed black line). Median (lines) and 99% credible interval (semitransparent areas) for (B) the age-dependent rate of cell division, (C) the distribution of the inter-division time (in the absence of cell death), (E) the distribution of the time to cell death (in the absence of cell division), (F) the size of the subpopulations and the overall population and (G) the age distribution on Day 5. Uncertainty assessment reveals that parameter and prediction uncertainties are small. (F, G) Zooms are provided to visualize the uncertainties (Color version of this figure is available at Bioinformatics online.)phjD obtained by MCMC to quantify this property and its uncertainty. The results for M 2 () revealed that the uncertainties are relatively small. A second property providing insight into the proliferation dynamics is the age distribution. While this property could not be assessed with LSP and DLSP models, the DALSP model revealed its structure. Due to the continuous renewal, cells tended to be young with a maximum at a  0 d. Between a  0 d and a  0:41 d the density slowly decreases, mostly due to cell death. At a  0:41 d % K a cell division sets in and results in an accelerated decline. Although CFSE time-series data do not directly provide information about the cell age distribution, DALSP models could be used to quantify it accurately, which is indicated by narrow credible intervals. This is also true for other properties such as intracellular CFSE degradation.
ConclusionIn vivo and in vitro proliferation assays using CFSE require accurate tools for quantifying biologically meaningful parameters (). To meet this requirement, we propose to use DALSP models which account for the age of individual cells. In contrast to the frequently used LSP and DLSP models, DALSP models allow for non-exponential inter-division time. To exploit DALSP models for the analysis of CFSE time-series data, we derived sensitivity equations for gradient calculation, and we developed a tailored numerical scheme exploiting the hierarchical structure of DALSP models. As an accurate model-based analysis of experimental data requires reliable inference, we compared different optimization algorithms with respect to convergence and computation time. Our comparison, which is to the best of our knowledge the first comparison of this kind for structured population models, revealed that multi-start local optimization outperforms stochastic global optimization for this class of PDE models. This confirms results byfor ODE models. Indeed, for some DALSP models the evaluated stochastic global optimizers did not even converge if a large number of function evaluations (> 10 5 ) was allowed. For the same models, multi-start local optimization with accurate gradients provided reproducible results. This underpined the importance of using sensitivity equations, which have so far not been described for LSP and DLSP models. The latter raising questions regarding the reliability of previous estimation results. The efficient deterministic optimizers were used to maximize a likelihood function which accounts for the stochasticity of the acquisition process. This likelihood function is statistically more meaningful than least-squares type objective functions (). We employed the proposed likelihood function for model selection and found evidence for a dependence of the division rate on the cell age. More precisely, the Hill-type division rate with a high degree, n a ) 1, indicated a lower bound for the inter-division time, which could be interpreted as a minimal length of the cell cycle. This seems biologically more plausible than the time-and CFSE concentration-dependent division rates proposed in previous publications (). Furthermore, age-dependent rates of cell division have been reported for similar biological systems using time-lapse microscopy data (). Beyond model selection, we provided the first detailed Bayesian uncertainty analysis for structured population models. This was challenging due to the computational complexity of PDE models and the number of unknown parameters. We established computational feasibility by exploiting tailored numerical methods and an initialization using optimization results. The posterior samples obtained using MCMC methods revealed a low level of uncertainties for latent properties, such as the age distribution and the parameters of the cell division rate. In addition, the marginal distribution of parameters are consistent with the profile likelihoods, which substantiated the results further. All the modeling, simulation, parameter estimation and model selection methods used in this publication are implemented in the open-source MATLAB toolbox ShAPE-DALSP. The availability of the code will facilitate the application of the method and simplify the development of extensions, e.g. toward multiple cell-types (), asymmetric cell division () and alternative DALSP models (). In particular the implementation of a cyton-based model () would be interesting as these models allow for a fraction of non-dividing cells. In addition to extensions, alternative parameterizations can be included, e.g. a parameterization of the probability density functions for a cell to divide and die at age a as used in the cyton models) in contrast to a parameterization of the age-dependent rate of cell division and cell death. The incorporation of the features in ShAPE-DALSP would allow for an even broader spectrum of applications and improve user-friendliness. In summary, this study presents a novel model-based analysis method for CFSE time-series data. Besides a statistical model, we present findings regarding optimizer performance and uncertainty analysis. These findings and the methods we developed can be easily transferred to other structured population models and might also be applicable to other types of population balance models. Accordingly, this study will help to make the most of CFSE time-series data and other data requiring cell-cycle corrections.
S.Hross and J.Hasenauer at University of California, Los Angeles on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
at University of California, Los Angeles on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
