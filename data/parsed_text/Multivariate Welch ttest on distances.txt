Motivation: Permutational non-Euclidean analysis of variance, PERMANOVA, is routinely used in exploratory analysis of multivariate datasets to draw conclusions about the significance of patterns visualized through dimension reduction. This method recognizes that pairwise distance matrix between observations is sufficient to compute within and between group sums of squares necessary to form the (pseudo) F statistic. Moreover, not only Euclidean, but arbitrary distances can be used. This method, however, suffers from loss of power and type I error inflation in the presence of heter-oscedasticity and sample size imbalances. Results: We develop a solution in the form of a distance-based Welch t-test, T 2 W , for two sample potentially unbalanced and heteroscedastic data. We demonstrate empirically the desirable type I error and power characteristics of the new test. We compare the performance of PERMANOVA and T 2 W in reanalysis of two existing microbiome datasets, where the methodology has originated. Availability and Implementation: The source code for methods and analysis of this article is available at https://github.com/alekseyenko/Tw2. Further guidance on application of these methods can be obtained from the author.
IntroductionThe PERMANOVA test (), has been proposed for use in numerical ecology to test for the location differences in microbial communities. The relationships between these communities are typically described by ecological distance metrics (e.g. Jaccard, ChiSquared, Bray-Curtis) and visualized through dimension reduction (also referred to as ordination in numerical ecology literature). The PERMANOVA permutation test based on (pseudo) F statistic computed directly from distances is a widely accepted means of establishing statistical significance for observed patterns. This test and the extension of this paper are related to the multivariate BehrensFisher problem () of testing the difference in multivariate means of samples from several populations. The underlying statistics for both distance-based tests are related to the Hotelling T 2 statistic. The PERMANOVA is more general in allowing for more than two populations to be compared simultaneously.The distance-based geometric approach; however, forgoes the need to estimate the covariance matrices. The cost of these geometric approaches is that they only provide omnibus tests, which are unable to make inferences about individual components of the multivariate random vectors tested. With the revived interest in numerical ecology fueled by the availability of DNA sequencing-based high-throughput microbial community profiling, i.e. microbiomics, the PERMANOVA test is enjoying a new wave of popularity. Several, cautionary articles have been published noting the undesired behavior of the test in heteroscedastic conditions (). A definitive principled solution to this issue is still lacking, however. The consensus is to ascertain the presence of heteroscedasticity using an additional test (e.g. PERMDISP;) in case of positive PERMANOVA results and to report both with a disclaimer that the attribution of positive PERMANOVA test to location or dispersion differences cannot be made whenever both tests yield positive results. In reality, the exactly matching multivariate spread between factor levels can rarely be assumed and the robustness of PERMANOVA to violations of homoscedasticity has not been characterized empirically.
Performance of PERMANOVA in heteroscedastic dataWe demonstrate the adverse behavior of PERMANOVA in unbalanced heteroscedastic case via a simulation. Let sample one consists of observations from 1000-dimensional uncorrelated multivariate normal distribution, where each component is standard normal (mean 0 and SD 1). Sample two is likewise 1000-dimensional uncorrelated multivariate normal with means equal to 1= ffiffiffiffiffiffiffiffiffiffi ffi 1000 p fraction of the desired effect size and standard deviation equal 0.8. Thus sample one has 20% more multivariate spread than sample two. We set the effect size to 0, 2, 4 and 5. We compute the corresponding Euclidean distances for use with PERMANOVA test, using its implementation in the adonis() function of the R (R Core) package vegan (). We repeat the simulation 1,000 times for each set of parameters and compute the average rejection rate at a  0.05.summarizes the type I error and power characteristics for this design with varying sample sizes. First, note that the type I error (left most box, where effect size equal to 0) is only correct when the samples are balanced. Whenever, the number of observations in the most dispersed sample is less than that in the other sample the type I error is inflated. In the opposite case, hardly any rejections are made. When there is true location difference between the samples (effect size greater than 0), the power curves have non-typical sigmoidal shapes corresponding to the loss of power with increasing number of observations in the overdispersed sample. However, the power curves under balanced sample sizes (triangles) are typical. Note that if PERMDISP is used to ascertain heteroscedasticity, only type I error inflation can be detected, while the dramatic loss of power cannot be corrected. When the samples are simulated under homoscedastic scenario, typical values of type I error (around nominal significance threshold) and power characteristics are observed (). These observations suggest that PERMANOVA is robust to violations of either the homoscedasticity or the balanced sample size assumptions, but not both. Simultaneous violation of both assumptions leads to loss of type I error control and loss of power.
ApproachesIn this article, we provide a definitive and principled two-sample solution to heteroscedasticity-related type I error inflation and loss of power with PERMANOVA. We do this by demonstrating that instead of the F-statistic utilized by PERMANOVA, a distance-based Welch t-statistic can be computed. We derive this Welch t-statistic from pairwise distance matrix. We perform an empirical study of type I error and power properties of this statistic in the permutation testing setup. Finally, we perform two applications of this new test in discovery data analysis and small clinical study scenarios.
Materials and methods
Univariate caseIn a two-sample X  fx 1 ;. .. ; x nx g, Y  fy 1 ;. .. ; y ny g independent and identically distributed univariate case, we are concerned with assessing the difference between the population means of the underlying distributions from which x i 's and y i 's are drawn. The square of the corresponding Welch t-statistic iswhere x  1=n x P x i and s 2 x  1=n x  1 P x i  x 2 are the usual estimates of the sample mean and variance for X, with y and s 2 y defined similarly for Y. Observe that the sum of square differences from the mean, which appears in the expression for sample variance, can be written in terms of the sum of squares of pairwise differences.This allows us to write the variance aswhere P nx i < J denotes double summation P nx i P nx ji1. Thus the denominator of (1) can be expressed in terms of only squares of pairwise differences between data points. Likewise, the difference of the means in the numerator of (1) can be expressed in terms of just the pairwise differences. Let Z  x 1 ;. .. ; x nx ; y 1 ;. .. ; y ny . Type I error and power characteristics of the PERMANOVA test with potentially unequal sample sizes. The headers of the boxes indicate the simulated effect size 0 (where type I error rate is determined), 2, 4 and 5. The size of the points corresponds to the number of observations in the least dispersed sample. Points, where the sample sizes are balanced, are indicated by triangles. Plot of a method with ideal type I error characteristics (left box) will be a horizontal line at the significance threshold a  0.05. When effect size is greater than 0, the plots show the power characteristics. Plot of a method with ideal power will be a horizontal line at 1.0, corresponding to perfect power and no type II error z 1 ;. .. ; z nxny  be the concatenation of the observations in X and Y, then z  n x x  n y y=n x  n y  is the sample mean of Z. We can write:n x xn x x  n y y  n y yn x x  n y yNow consider the first term of Equation (16).The combined contribution of the first terms of (21) from x and y terms of (16) can be written in terms of pairwise differences of z i 's:This and Equations (6), (16) and (21) imply that the square of mean difference is expressable in terms of sums of squares of pairwise differences:Finally, Equations (7) and(23) can be put together to form the Welch t-statistic (1) in terms of only the squares of the pairwise differences. The point differences can be thought of as distances. Let D  fd ij g i;j1;...;nxny be the matrix of absolute pairwise differences,The elements of D are in factEuclidean distances between data points in one-dimension. Now the sums of squares can be expressed in terms of d ij 's:In terms of squares of pairwise distances the T 2 W statistic can be written asNote that Equation (24) expresses total sums of squares, and Equations (25) and (26) express the within sample sums of squares in terms of distances, while the term in square brackets of Equation (23) corresponds to between group sums of squares. These are the same terms that appear in the PERMANOVA two-sample (pseudo)F statistic computation. Here we write the PERMANOVA statistic for the two sample case and arbitrary n x and n y :It is easy to check that when the sample sizes are balanced, n x  n y , or within group sums of squares are equal, 1then F A and T 2 W differ by a multiplicative factor that only depends on n x and n y. This means that inference under the two statistics will be different when both unbalanced sample sizes and heteroscedasticity is present, which may help T 2 W correct the adverse behavior of PERMANOVA observed inand.
Multivariate extension. We use these distances in place of their univariate counterpart to compute T 2 W and F A. By extension arbitrary distances (e.g. Jaccard, Bray-Curtis etc.) can be used for this purpose. Note that in contrast to the PERMANOVA statistic the distancebased T 2 W explicitly accounts for potentially unbalanced number of observations and differences in multivariate spread in the two samples.
Permutation testThe exact distribution of the multivariate distance-based T 2 W statistic is dependent on many factors, such as the dimensionality of the underlying data, the distributions of these random variables, the exact distance metric used etc. To make a practical general test, we use permutation testing to establish the significance. To do so we compute T 2 W i on k permutations, Z i , for i  1;. .. ; k, of the original data. The estimate of significance is obtained as the fraction of times the permuted statistic is greater than or equal to T 2 W , i.e.Here 1: designates the indicator function. In practice, the distance matrix D does not need to be recomputed with each permutation, as it is sufficient to just permute the sample labels. This permutation procedure is used by the original PERMANOVA method and is a standard application of permutation testing.
Distance-based effect sizeThe ability to compute pseudo-variances and square mean difference using just pairwise distances allows for estimation multivariate effect sizes in terms of familiar to statisticians Cohen's d. Using derivations (7) and (23) we writen x  n y  2 :The positive square root of d 2 provides an estimate of the absolute value of the distance Cohen's d and adds another potentially interesting effect size measurement for multivariate analysis, in addition to the recently proposed x 2 ().
Results
Simulation resultsIn this section, we extend the simulation study in the Introduction section to compare the performance of PERMANOVA and T 2 W. Again, the n x observations in sample one are independent and identically distributed (i.i.d.) X i $ N 0; I, the n y observations in sample two are i.i.d. Y j $ N 1e= ffiffiffiffiffiffiffiffiffiffiffiffiffiffi ffi 1000 p ; f I, where e controls the effect size and f controls the degree of multivariate spread differences (fraction SD) between the two samples. For each set of n x , n y , e, and f we simulate 1000 independent datasets. For each dataset we compute the p-values using permutation testing with PERMANOVA and T 2 W statistics. We calculate the fraction of rejected nullhypothesis with each test at significance level a  0:05. First, we consider a broad scan over the sample sizes n x ; n y 2 5; 10; 15; 20. Representing, case to control (or treated to untreated) ratios of 1:1, 1:2, 1:3 and 1:4 with relatively small overall sample size. Under the null hypothesis T 2 W maintains the prescribed rejection rate for all examined levels of heteroscedasticity (first column). As we have seen in the Introduction, in the unbalanced heteroscedastic case the PERMANOVA exhibits inflated type I errors (first column). As demonstrated in scenarios where e > 0, unlike PERMANOVA, T 2 W has greater power to detect differences as the sample sizes increase (columns two and three, rows one and two). The power curves for the two tests are similar when multivariate spread in the two samples is the same (bottom row columns two and three). When it is not, however, the curves intersect at approximately the point where the sample sizes in the two groups are balanced (triangles). This suggests that T 2 W overcomes the problematic behavior of PERMANOVA and has similar power under the homoscedastic design (bottom row) and when sample sizes are balanced (triangles). Imagine an experiment in which an investigator aims to compare 10 observations in each group. For reasons beyond their control (e.g. animal dies, subjects drop from protocol, unequal gender ratio) the resulting sample sizes at the end of the experiment may not exactly be 10 versus 10. These conditions are encountered in many common discovery type studies. We examine the effect of heteroscedasticity for PERMANOVA and T 2 W under these conditions. We perform a similar comparison for sample sizes in the vicinity of 50, corresponding to sample sizes in a typical small clinical study. As we have seen previously, when the multivariate spread in the two samples is the same or similar, the power curves for PERMANOVA and T 2 W overlap (and b bottom row). With sample sizes around 10 the violation of homescedasticity leads to loss of power (columns two and three and rows one and two) and inflated type I errors (first column rows one and two) with PERMANOVA relative toT 2 W. With the sample size increasing to approximately 50, PERMANOVA becomes more robust, while the traces of the issue still remain when the effect size is small (second column). Likewise, at these sample sizes the type I error inflation is still present when the unbalance is more extreme and heteroscedasticity is large (top left). Overall, T 2 W has better or similar type I error and power characteristics to PERMANOVA and should be recommended in all two-sample designs.
Application examplesWe apply the T 2 W to two previously published datasets on microbiome differences in the gut () and on the skin (). In both cases we compute the distances using the Bray-Curtis dissimilarity,For each comparison, we compute the P-values with 100 000 permutations under PERMANOVA and T 2 W and quantify the corresponding effect size using x 2 and distance Cohennc d. The difference in the multivariate spread H is measured as the ratio of mean distances within compared groups.
Sub-therapeutic antibiotic treatment microbiome datasetThe gut microbiome dataset consists of measurements of abundances of gut microbes obtained from mice that either received a prescribed antibiotic in their drinking water or none (C). Samples were obtained from two locations of the gut of these mice (cecal and fecal). The target number of samples per location was 10; however, several fecal samples could not be analyzed for technical reasons.summarizes the results of the analysis of these data. At a commonly used significance threshold of a  0.05, both PERMANOVA and T 2 W agree in the statistical decision. However, if we were to use a more stringent a  0.01, the comparison of the control microbiota against microbiota of all the mice receiving antibiotic would not be deemed significant under PERMANOVA, while the P-values under T 2 W are below the significance threshold. The estimated effect size, d, for C. versus All abx. comparison in cecal and fecal samples are 1.28 and 1.42, respectively. Both of these are considered large effect sizes () and given adequate sample sizes would be deemed highly significant. Moreover, when we examine these data using principal coordinates analysis, the separation of the group centroids is evident (). The largest separation along PC1 is observed for the location (fecal versus cecal). The antibiotic versus control groups are separated along PC2. Note that for cecal samples the comparison of the controls against each of the antibiotic treatment groups individually is significant and similar for both tests. This is expected because the design is balanced in these tests.
Skin microbiome in psoriasis datasetThe skin microbiome dataset consists of observations of skin microbial abundances from control subjects and from psoriasis subjects, who contribute two samples from a lesion site and from symmetrical unaffected site. PERMANOVA and T 2 W tests produce similar significance values and inferences (), which is owed to the fact that. Empirical type I error and power characteristics of PERMANOVA (black) and T 2 W (red) tests with varying effect size, degree of heteroscedasticity and number of observations in two samples, for sample sizes typical for (a) a discovery study or (b) a small clinical study. The effect sizes vary in columns of panels. Effect size 0 corresponds to the case where the null hypothesis is true and the plots demonstrate the type I error. Plot of a method with ideal type I error characteristics will be a horizontal line at the significance threshold a  0.05. When effect size is greater than 0, the plots show the power characteristics. Plot of a method with ideal power will be a horizontal line at 1.0, corresponding to perfect power and no type II error. The degree of heteroscedasticity varies along the rows and is represented in terms of ratio of the standard deviations (Frac SD) between two samples. The bottom row corresponds to homoscedastic scenario, the top and middle rows show high and medium heteroscedasticity scenarios, respectively. The number of observations in the least dispersed sample is indicated by the size of the point and the balanced samples are identified by triangles. Principal coordinates analysis of sub-therapeutic antibiotic treatment data. Points correspond to the individual observations in cecal control (black), cecal antibiotics (red), fecal control (gray), and fecal antibiotic (orange) groups. The centroid of each group is marked by the box with the group labels the multivariate spread is similar in all conditions, and sample sizes are larger and closer to being balanced.
DiscussionBy derivation T 2 W inherits the characteristics of the univariate unequal variance Welch t-test. That test is recommended as a replacement for pooled variance t-test in all circumstances. Testing for unequal variances by methods, such as PERMDISP, is not recommended before a choice of the primary test is made. The main disadvantage of the Welch's t-test compared with ANOVA is potential loss of robustness when violations of normality are present (). This issue, however, rests on the limiting distributions of the tests. In our case, the inference is obtained by permutation testing, which alleviates this concern. Thus T 2 W should also become a first line replacement for PERMANOVA in simple two-sample case. Two-sample scenario is a common experimental design, but a general solution for k-level factors is still desirable. The behavior of PERMANOVA under heteroscedastic conditions with k-level factors have not been examined, but is suspected to suffer from similar shortcomings as in the two sample case. When heteroscedasticity is suspected, several remedial strategies can be implemented. First, a variance stabilizing transformation can be applied to the data to remove heteroscedasticity (). If transformation of the data is not desirable for any reason, other strategies could include developing specialized sub-sampling and permutationbased strategies. For example, the data could be re-sampled m times at balanced sample sizes and an average PERMANOVA statisticThis statistic could then be compared with the null distribution generated by permuting the sample labels rtimes and computing the re-sampled F A 1;. .. ; F A r, whereThe significance can be determined by using regular permutation testing approach to compare the number of times the obtained statistic is more extreme than those observed under the null, i.e. p r  P r j 1F A > F A j. This method ensures that the groups are balanced in each comparison, but may still lead to loss of power due to decreased effective sample size in each sub-sampled comparison. This approach is reported here as a suggestion that needs further development and evaluation before in can be implemented in practice. The final strategy for analysis of data with arbitrary number of levels could involve the application of T 2 w to only relevant pairwise comparisons with appropriate multiple comparison controls in place.
A.V.Alekseyenko at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
Fig. 2. Empirical type I error and power characteristics of PERMANOVA (black) and T 2 W (red). The effect sizes vary in columns of panels. Effect size 0 corresponds to the case where the null hypothesis is true and the plots demonstrate the type I error. Plot of a method with ideal type I error characteristics will be a horizontal line at the significance threshold a  0.05. When effect size is greater than 0, the plots show the power characteristics. Plot of a method with ideal power will be a horizontal line at 1.0, corresponding to perfect power and no type II error. The degree of heteroscedasticity varies along the rows and is represented in terms of ratio of the standard deviations (Frac SD) between two samples. The bottom row corresponds to homoscedastic scenario, the top and middle rows show high and medium heteroscedasticity scenarios, respectively. The number of observations in the least dispersed sample is indicated by the size of the point and the balanced samples are identified by triangles 4 A.V.Alekseyenko at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
