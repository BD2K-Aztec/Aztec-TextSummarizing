Motivation: Identifying cells in an image (cell segmentation) is essential for quantitative single-cell biology via optical microscopy. Although a plethora of segmentation methods exists, accurate segmentation is challenging and usually requires problem-specific tailoring of algorithms. In addition, most current segmentation algorithms rely on a few basic approaches that use the gradient field of the image to detect cell boundaries. However, many microscopy protocols can generate images with characteristic intensity profiles at the cell membrane. This has not yet been algorithmically exploited to establish more general segmentation methods. Results: We present an automatic cell segmentation method that decodes the information across the cell membrane and guarantees optimal detection of the cell boundaries on a per-cell basis. Graph cuts account for the information of the cell boundaries through directional cross-correlations, and they automatically incorporate spatial constraints. The method accurately segments images of various cell types grown in dense cultures that are acquired with different micros-copy techniques. In quantitative benchmarks and comparisons with established methods on synthetic and real images, we demonstrate significantly improved segmentation performance despite cell-shape irregularity, cell-to-cell variability and image noise. As a proof of concept, we monitor the internalization of green fluorescent protein-tagged plasma membrane transporters in single yeast cells. Availability and implementation: Matlab code and examples are available at
INTRODUCTIONNowadays, optical microscopy is widely used to quantify singlecell features, such as cell size or intracellular densities of fluorescent markers. Accurate quantification of such features critically depends on the spatial detection of the cells in the image, that is, on cell segmentation (). Although there is a rapid development of imaging hardware and image analysis software platforms (), the development of cell segmentation algorithms is lagging behind. For good segmentation results, current approaches are typically applicable to narrowly defined image acquisition protocols () or cell types (). As summarized succintly by E. von Meijering: 'Rather than converging to a robust, unified solution, it thus seems that the field is diverging, and by now almost as many cell segmentation methods have been developed as there exist cell analysis problems. . .' (). Cell segmentation is challenging () for many reasons. First, segmenting cellular images requires the identification of multiple objects in the image. The objects have heterogeneous shapes that are typically subject to dynamic changes; mathematical shape models are therefore nearly impossible to define. Second, cell compartmentalization as well as intra-and intercell variability induces non-homogeneous marker distributions within and across cells, leading to undesirable image features such as intensity gradients. Third, growing cell populations usually result in dense cell regions; this makes it hard to assign image features to the correct cell, especially among sets of spatially close cells. Finally, different experimental configurations such as cell types or imaging protocols generate images with greatly varying morphological or intensity characteristics. Most current methods use a few basic algorithms for cell segmentation: intensity thresholding, filtering, morphological operations, region accumulation or deformable models (). In particular, region accumulation approaches such as Voronoi-based methods () or the watershed transform () can result in inaccurate cell boundaries by misspecifications of the cell region to be divided or by oversegmentation (and B). Similarly, popular deformable model approaches such as geodesic active contours (), which detect cell boundaries by minimizing a predefined energy functional, can result in poor boundary detection because they use local optimization algorithms that only guarantee to find a local minimum or use the gradient vector field of the image to decode the boundary information (). However, optical microscopy can generate distinctive intensity information across the cell membrane, which, so far, has been algorithmically used to only a small extent. For example, cell segmentation via ring filters () accounts crudely for the intensity profile across the cell membrane and imposes strict cell-shape requirements. Furthermore, certain combinatorial optimization algorithms can guarantee to find the global optimum of a defined energy functional, such as the combinatorial graph-cut algorithms. To segment microscopy images, previous *To whom correspondence should be addressed. y The authors wish it to be known that, in their opinion, the last two authors should be regarded as Joint Last Authors. applications of graph cuts in conjunction with the gradient vector field of the image () were limited to identify the image background () or to separate cell nuclei (). Graph cuts with automatic spatial constraints applied to the cellular segmentation of RNA interference (RNAi) screening images need an additional image (). Other graph-cut-based object detection approaches that do not use the gradient vector field of the image typically only work well when the intensity distributions of the cellular regions and the background are rather dissimilar (). Here, we present a method for cell segmentation that uses a single image, allows for image acquisition with different experimental techniques and copes with various cell shapes and densely populated areas. The method is based on the detection of membrane patterns, and we therefore term it membrane pattern-based cell segmentation (MPCS). The membrane pattern information is cast into a spatially constrained graph-cut framework, which allows us to address the typical challenges in the segmentation of microscopy images discussed above. We demonstrate the applicability and performance of MPCS for diverse synthetic and real biological examples, with significantly improved performance compared with established segmentation methods. Because accurate boundary detection is especially important in quantitative signaling studies, we quantify the internalization of plasma membrane transporters in yeast as a proof of concept.
METHODS
Detection of cell boundariesOverview. MPCS works with microscopy images of cells with a membrane pattern, that is, a characteristic intensity profile across their membrane. Based on the input image, we first specify few biologically intuitive parameters. Then, we detect potential points inside the cells (called seeds). Each seed is processed individually, and an optimal connected boundary for each cell is detected by combining directional cross-correlation operations with graph cuts. Cross-correlation is a signal processing technique that measures similarities between two signals and is used here to decode the membrane pattern information. This pattern information is cast to a graph, and together with automatically defined spatial constraints, we use graph cuts to optimally separate each cell from the background. All individual segmentation results are processed to obtain the final segmentation of the image. Input. The biologically intuitive parameters of MPCS can be set interactively through the graphical user interface of CellX (), set manually, or automatically derived via supervised machine learning approaches from a small training set of segmented cells. For the example image of budding yeast cells with aberrant morphology (), we first estimate the maximal radii of circles in the smallest and largest cells in the image (r min , r max values; blue). Then, we determine the length of the major axis of the largest cell (l m value; green line). We estimate the cells' membrane pattern (vector of intensity values M, shown in the red plot) by averaging the intensities of a set of example membrane profile rays (drawn from the inside of the cell to the outside, as shown by the red arrows). We also define the position of the cell's boundary on the membrane pattern (index m o : Mm o  2 M; shown with the white filled circle). Seeding. In this step, we identify potential points inside the cells (seeds). In most cases, a combination of traditional image processing operations can easily provide us with seeds (see Supplementary Note; Supplementary). Here, we exemplify the process by use of a gradient-based Hough algorithm () on the input image composed of a set of pixels L=W  H, W=f1;. .. ; wg, H=f1;. .. ; hg, where w and h are the image's width and height (measured in number of pixels), respectively. We compute the gradient vector field of the image (blue arrows in) and perform a counting operation for image pixels along each gradient vector. Every time a pixel lies in the direction of a gradient vector (at a distance between r min and r max ), we collect a value proportional to the gradient's magnitude. The counts for all image pixels are stored in the so-called accumulation array (color-coded region in). Typically, lines in the direction of the gradients originating from convex features of the input image intersect the same pixels, thereby generating local maxima in the accumulation array. We detect the image regions with local maxima and use their centers as seeds (green crosses in; see Supplementary Note and Supplementary). For every seed located at pixel s=x s ; y s , where x s 2 W and y s 2 H, we also compute the radial distance r c 2 r min ; r max  that maximizes the gradient information along the perimeter of the circle with center s and radius r c .) followed by a Voronoi-based algorithm (). Regions inside the blue rectangles were used as seeds. (B) Phase-contrast of S.pombe cells. Boundaries were automatically detected by the watershed algorithm (), applied to a smoothed gradient vector field of the initial image. Regions inside the blue rectangles were used as minima during the flooding operation. (C) Bright-field image of alf1" S.cerevisiae cells. Boundaries were automatically detected by active contour-based segmentation [active contour evolution with level sets (); geodesic active contour as the energy model (. Blue rectangles represent the initial state of the active contour Bresenham's algorithm () to find which image pixels lie in every line segment that starts at the seed and ends in each of the border pixels of I. We then compute the intensity profiles along these directed line segments (rays) and use cross-correlation () to quantify their similarity with the reference membrane pattern, M. Cross-correlation values are high in regions consistent with the membrane pattern and low in regions that do not follow the pattern. The cross-correlation values along all rays allow us to construct a cross-correlation image (; see Supplementary Note) that is used for the formulation of the cell boundary-tracing problem on a graph. We further refer to CC(p) as the cross-correlation result assigned to pixel p=x p ; y p  in the pixel set P=X  X, X=f1;. .. ; 2l m +1g of I. Graph cuts and energy minimization. For every image crop I, we use graph cuts to separate the image region comprising the cell from the region outside the cell (background and neighboring cells). This amounts to assigning a binary (cell or background) label A p to each pixel p 2 P. We combine these assignments in a vector A of dimension 1  jPj (where jPj % 10 4 for microscopy images of cells with l m =50 pixels). We first define a directed weighted graph G=V; E; w with vertex set V = P. We define the neighborhood of radius r of a pixel p 2 P by the function Np; r =fq 2 Pj jjp  qjj 2 rg to specify the edge set as E=[ p2Pwhere wp; q measures the cost of assigning two neighboring pixels to different partitions (boundary information), and the function id is 1 if the condition inside the parenthesis is true, and 0 otherwise. We find the optimal vector A that minimizes EN(A) by finding the min-cut on the previously defined image graph. The min-cut/max-flow algorithm () yields the optimal solution in polynomial time. According to (), if we define the weights of the edges asthen the min-cut corresponds to the globally optimal geodesic for the processed cell. denotes the side length of the square pixels (equals to 1 in our case); pq , the vector connecting the graph vertices p and q; ", the angular orientation difference of the grid's characteristic vectors (equals to =4 for our 8-neighborhood system); det, the determinant operation; and D(p) is the metric tensor in pixel p defined asDp=gp  I+1  gp  up  up T ;where I is the identity matrix, u(p) is a unit vector in the direction of image gradient at pixel p and g(p) is the scalar function that maps the magnitude of the boundary information on the weights of the graph. As in (), we use the exponential function and include the cross-correlation values as gp=exp10 CCp . Spatial constraints. To avoid trivial solutions and constrain the number of meaningful cell boundaries, we pose automatic spatial constraints to our graph cut definition by transforming the problem to a multisource/ multisink max-flow problem (). Specifically, we define a circular region around the seed s of radius r c =2, C=Ns; r c =2 & P, that has to be part of the cell (orange region) as well as the pixel set in the cropped image border B=fp 2 P jjNp; ffiffi ffi 2 p j58g & P (green region) as background. By using infinite edge weights to connect the pixels in C and B to dedicated source and sink vertices, respectively, we constrain graph cuts to the region between C and B (e.g. white contour). The assignment of A with minimal energy EN(A) given by the min-cut results in an optimal binary segmentation of the cropped image (blue and red regions). Final segmentation. The single-seed segmentation results are further processed to obtain the final segmentation of the image. First, we eliminate single-seed segmentations that represent statistical outliers with respect to their morphology and cross-correlation values across the predicted membrane pixels. Then, we merge those seeds that claim almost identical regions in the image. Finally, we resolve small overlaps of cell segmentations by assigning the pixels to the closest competing cell. These steps (for more details, see Supplementary Note) ensure that finally every image pixel is uniquely assigned to either the background or to one of the cells. The segmentation result for the input image can be seen inFigure 2E (and for the other examples ofin). Additional full image segmentations are shown in Supplementary Figures S3S10.
RESULTS
ALGORITHMIC FEATURESDiverse types of microscopy images. To evaluate the applicability of our method to different image acquisition techniques, we considered different transmission light and fluorescence microscopy methods. Saccharomyces cerevisiae and Saccharomyces pombe cells were imaged using out-of-focus bright-field and phasecontrast imaging, respectively, whereas fluorescence microscopy of endogenously tagged Mup1-GFP (green fluorescent protein) S.cerevisiae cells was used to generate a nearly uniform intensity pattern around the cell (). An important feature of MPCS is that, despite differences in the characteristic membrane patterns of the imaging methods, similar correlation images are generated (middle). As a result, the cell boundaries can be accurately inferred (Flexible boundary definition. Many segmentation algorithms associate the high intensity gradient information of the image with the cells' boundaries. This is reasonable, for instance, when the background intensity distribution is different from the cells' intensity distribution. However, depending on the image acquisition protocol, high intensity gradients could be present inside a cell (e.g. out-of-focus bright-field image in). Furthermore, the intensity distribution of the background may be different in regions around the cells (locally) than in the rest of the image (e.g. local fluorescence effects in). In such cases, it is difficult to accurately detect the cells' boundaries based on the gradient information or on the identification of the image background. MPCS circumvents these problems by assigning the highest cross-correlation values to the pixels of the cell membrane corresponding to the position m o (white dot in) of the membrane pattern M (red line). Thereby, we can conveniently define the cell boundaries independent of the local gradient information across the membrane profile (). Dense cultures. Our method leads to a successful segmentation in crowded image regions, as illustrated for dense S.pombe culture images acquired in bright field (left) because of the directionality in the cross-correlation step. As every intensity ray traverses from a seed to the border, we analyze an intensity segment that includes the cell's membrane pattern followed by the adjacent cell's mirrored version of the pattern. Along this segment, the cross-correlation is high at the cell's membrane region (red area in; middle) and low immediately afterwards (blue area in); the same effect appears for all basic forms of membrane patterns (Supplementary). This suppression of the neighboring cell's information restricts the graph cut to optimally isolate the currently processed cell from the rest of the image; graph cuts in low-valued cross-correlation regions have an increased cost. As a result, MPCS successfully segments crowded cell regions (right; see Supplementaryfor the full image segmentation). Non-convex shapes and cell types. Cells may have non-convex and diverse shapes, which makes segmentation difficult. MPCS deals with non-convex shapes in two different ways. First, if the seed is placed inside the non-convex object such that all rays cross the membrane region in the correct direction (seed 'S1' in), the cross-correlation image captures the membrane information accurately, leading to accurate segmentation (). However,if the seed is not placed in such a region (seed 'S2' in), the rays may cross a part of the membrane region in the wrong direction, leading to partially inaccurate boundary detection (). Therefore, we place extra seeds at low-valued pixels of each initial membrane result (), and we update the cross-correlation image () to also segment non-convex shapes (). As a result, our segmentation method provides a tool for the analysis of images of different cell types (and K; see Supplementary Figs S8S10 for full image segmentations). Note, however, that MPCS may fail to capture highly irregular parts of the cell boundary (), as the use of the geodesic model leads typically to smooth segmentations.
SEGMENTATION PERFORMANCE ON SYNTHETIC IMAGESWe next aimed at a quantitative characterization of the segmentation algorithm's performance. For this purpose, we generated realistic synthetic microscopy images that represent different cell phenotypes as well as fluorescence, bright-field and phasecontrast imaging (; see Supplementary Note for details). We defined two measures for the cell detection quality (sensitivity, that is, the proportion of true-positive findings, and positive predictive value, the proportion of detected cells that are true), one measure for the spatial accuracy of the segmentation (pixel accuracy of the cell area) and one measure to quantify the error in the detected cell contour (see Supplementary Note for details). Cell-shape irregularity. To evaluate the influence of cell shapes on the segmentation performance, we generated synthetic microscopy images with increasing cell-shape irregularities (). The shape irregularity coefficient is a multiplier of a random term that displaces the pixels of an initial ellipse. For regular shapes, the mean segmentation sensitivity is close to 1 and the contour error below half a pixel; sensitivity only drops below 0.9 at an irregularity value of 0.5 (). Hence, the algorithm captures accurately a large fraction of the cells even for non-convex cell shapes. Importantly, the positive predictive value and the pixel accuracy are barely affected by the shape: their respective mean values are always 40.9 (). Cell-to-cell variability. Because of uneven illumination of bright-field images or through stochastic noise in fluorescent protein expression, intensities within the cell population can vary, which poses additional challenges for segmentation (see Supplementaryfor S.cerevisiae with fluorescence staining). To examine the segmentation performance under such conditions, we generated images with variable cell intensity values (see Supplementary Note for details).shows that MPCS performance is largely unaffected by this variability, indicating high-quality segmentation for all levels of intercell variability investigated.
METHODS COMPARISONTo compare our algorithm with popular methods for cell segmentation, we quantified segmentation performance with respect to the error in the cell contour (for definition, see Supplementary Note) and morphological cell features such as cell area and eccentricity. Accurate membrane identification is particularly crucial for cell-signaling studies, for example, when densities of fluorescent markers on the cell membrane need to be quantified (). Accurate morphological cell features aid substantially in the analysis of cellular phenotypes, for example, to automatically classify subpopulations of cells (). For controlled performance comparison, we used different types of synthetic images with various levels of imaging noiseImages were generated with varying levels of cell-shape irregularity (A) and of cell-to-cell intensity variability (B). Numbers in the images specify the corresponding coefficient values: shape irregularity coefficient (A) and variation for independently drawn random assignments of intensities for each cell (B). Statistics were obtained for 12 randomly generated synthetic images [(A): fluorescence, bright field and phase contrast; (B): fluorescence only] of 150 cells. Graphs show median and quartiles for the segmentation sensitivity (blue), the positive predictive value (green), the pixel accuracy of the cell area (red) and the contour error (black, in pixels). (C) Example of a synthetic image with three cell subpopulations (identified by colored dots in the cells' centroids) with low (green), medium (red) and high (blue) eccentricity and area. (D) Crops of synthetic fluorescence (top), brightfield (middle) and phase-contrast (bottom) noisy images used for comparison. Noise levels (numbers) are measured in decibel (see Supplementary Note). (E) Cell classification by quadratic discriminant analysis based on 'true' cell areas and eccentricities. (FH) Comparison of algorithms: 'MPCS' (our algorithm), 'watershed' (the watershed algorithm), 'ChanVese' and 'geodesic active contour' (active contour evolution with level sets; ChanVese and geodesic active contours as the energy model, respectively). Mean error values for cell contour (F), cell area and cell eccentricity (G) and cell type classification (H) for the fluorescence (blue), bright-field (green) and phase-contrast (red) image sets (and D; see Supplementary Note). Cells were generated such that three distinct subpopulations exist with respect to their area and eccentricity, as verified by quadratic discriminant analysis on these cellular features (E). We compared our method with the watershed algorithm () and with two algorithms that evolve active contours (implemented with levels sets) by use of the ChanVese () and of the geodesic active contour () energy model, respectively (for implementation details, see Supplementary Note). This selection represents the algorithmic basis of numerous cell segmentation approaches. With respect to accurate detection of the cell contour, the mean error of MPCS never exceeds one pixel, but the other algorithms yield large errors because of the high intensity gradients inside the cell and the undesired gradients from imaging noise (). Similarly, for the extracted morphological cell features, MPCS's mean errors are always 50.1, whereas competing algorithms show substantially larger error ranges (). Finally, we quantified the effect of the morphological errors in a classification problem. We built a classifier based on the morphological features of the ground truth cell images and assessed the effect of segmentation errors on the classification accuracy. Segmentation errors of our algorithm lead to low misclassification rates in contrast to wrong assignments of 1575% of the cells for the other algorithms (; see also the distributions in Supplementary).Time courses of total fluorescence (normalized by the cell area and the mean fluorescence of the cells at t = 0 min) in the cell (black), the cytoplasm (blue), the membrane (red) and spots (green, scaling factor 50). Dots denote the population average, and error bars show the standard error parameters need to be carefully set to avoid erroneous segmentations (). A key feature of our algorithm is to combine cross-correlation for detecting membrane patterns with graph cuts for tracing the cell boundary. The cross-correlation operation decodes the cell membrane information, and the result is robust to intensity perturbations or image noise (Supplementary). Furthermore, the directional application of the cross-correlation aids in accurately detecting the cell membrane in dense regions by suppressing the intensity information of touching cells. Graph cuts are a convenient and efficient method to solve the optimization problem posed by image segmentation (), and here they are used to find an accurate boundary for each cell without needing prior knowledge on the cell shape. So far, the use of graph cuts for cell segmentation has not included a formulation with cell membrane pattern information. Automatic placement of topological constraints has been primarily used for cell tracking purposes (), and it can improve the segmentation quality only if each cell is initialized with one seed. An advantage of our segmentation strategy is that it is largely unaffected by the seeding scheme. Other deformable model-based segmentation methods that define the optimization problem on the space of continuous functions, such as level-set methods (), typically use optimization algorithms that guarantee to find a local minimum of the defined energy functional (). As a result, when the gradient vector field of the image is used to detect the cell boundary, good segmentation performance depends substantially on a reliable initial boundary estimate, which is hard to obtain automatically. MPCS, in contrast, requires easily accessible spatial constraints, such as the image border and the region around a seed. To illustrate typical applications enabled by our method, we showed for yeast endocytosis how accurate boundary detection can be successfully performed when GFP intensities are subject to spatiotemporal dynamics. We used only the bright-field images to detect cell boundaries and used a single fluorescence channel to acquire a variety of high-quality single-cell fluorescence measurements. Such a quantification strategy allows for the monitoring of spatially dynamic quantities in all available fluorescence channels, and compared with other approaches (), it does not need additional 4 0 ,6-diamidino-2-phenylindole markers or constitutively expressed markers for the segmentation process. We envisage that the accurate identification of cells and cell membranes will enable the extraction of quantitative datasets that will increase our understanding in many biological applications.
QUANTITATIVE ANALYSIS OF BUDDING YEAST ENDOCYTOSIS
The Author 2014. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
Cell segmentation at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
S.Dimopoulos et al. at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
To test the accuracy and usefulness of MPCS in a real-world proof-of-principle application, we focused on the internalization of plasma membrane transporters. Specifically, we used the budding yeast methionine transporter Mup1 tagged with GFP to monitor the clearance of the protein from the plasma membrane (Fig. 5A, Supplementary Movie). Mup1 is internalized upon the addition of methionine to the media, and it serves as a model in studying ubiquitin-dependent endocytosis (Lin et al., 2008). A time-resolved single-cell quantification of this process clearly requires faithful detection of the cell boundaries and accurate quantification of fluorescence quantities. As expected, shortly after the onset of the internalization process, fluorescence transferred from the cell membrane to the cytoplasm. For such dynamic phenomena, accurate boundary detection of the cells based on the fluorescence image is nearly impossible because at the end of the experiment, fluorescence levels in the membrane are close to zero and because lowexpressing cells are hard to detect in all frames. We performed the segmentation on the bright-field images and used the fluorescence images to properly define the relative position of the cell boundary on the membrane pattern (Fig. 5B). This allowed us to precisely detect the cell boundaries throughout the experiment and hence to accurately capture the GFP information in the membrane and in other cellular compartments (Fig. 5C; see Supplementary Note). Despite using only one of the available fluorescence channels, the quantification process resulted in a wealth of information on the single-cell dynamics of the Mup1 transporter (see Fig. 5D for all cells that were tracked over the entire time course; quantities were normalized by each cell's area and mean initial intensity). Such single-cell quantitative data will allow for future detailed studies of endocytosis beyond existing studies that used bulk measurements of specific regulators involved in vesicle maturation (Zeigerer et al., 2012) or extracted only endosomal intensity properties via confocal microscopy (Collinet et al., 2010). 4 DISCUSSION Accurate detection of cell boundaries is a crucial and challenging step for high-quality single-cell quantification, and, to this date, no general cell segmentation solution exists. Our method allows us to analyze microscopy images taken by diverse acquisition techniques and for a variety of cells types. For the real and synthetic images analyzed here, the segmentation quality is largely independent of cell shape, density, intercell variability and image noise. Compared with popular algorithms used for the detection of the cell boundaries, MPCS shows small errors in the spatial identification of the cells' membranes and their morphological features. Clearly, limitations of our method exist, mainly when cells do not have a single uniform membrane pattern, or when the cell shape is highly irregular. The intensity pattern across the cell membrane or the cell length is intuitive and easily accessible features of the cell population. Our segmentation method can be easily parametrized by annotating example cells through the graphical user interface of CellX [for a detailed user guide, see (Mayer et al., 2013)]. In contrast, boundary detection of cells based on deformable models, such as active contours, involves non-intuitive adjustments of the parameters that control the energy terms, which are typically correlated and problem dependent. These
