Motivation: We introduce a coalescent-based method (RECOAL) for the simulation of new haplotype data from a reference population of haplotypes. A coalescent genealogy for the reference haplotype data is sampled from the appropriate posterior probability distribution, then a coalescent genealogy is simulated which extends the sampled genealogy to include new haplotype data. The new haplotype data will, therefore, contain both some of the existing polymorphic sites and new polymorphisms added based on the structure of the simulated coalescent genealogy. This allows exact coalescent simulation of new haplotype data, compared with other methods which are more approximate in nature.
INTRODUCTIONWe live in an era in which the genome-wide association study (GWAS) is one of the standard tools by which we interrogate the genome for polymorphisms that relate to phenotype. There is also a growing use of next-generation sequence (NGS) data. A large number of new methodological approaches are being developed and published in both areas. There is much discussion about the degree to which the GWAS approach has been successful, for example, see;, but in humans many new associations between genotype and disease status have been discovered. An important part of the process of methods development in the GWAS era is the testing of those methods on both real and simulated test data. Frequently investigators have a single, smaller set of data from a given population, the features of which they wish to mimic when producing multiple, larger datasets for testing purposes. A common example is the HapMap data () or 1000 Genome Project (1000GP) data (1000). In this article, we present an * To whom correspondence should be addressed. exact coalescent method for simulating test sets of new haplotype (or genotype) data, based upon such an existing, smaller, initial sample. The goal is to sample new datasets, D , consisting of n (say) haplotypes, conditional upon some observed, existing data, D, which contains n o << n haplotypes. Under the assumption that the popular coalescent model is a reasonable approximation to the evolution of the data, the goal here is to produce new data, D , conditional on the unobserved genealogy, G, of the existing data, D (since it is through G that the dependence of D on D is expressed). Note that in the presence of recombination G will be a graph, the so-called ancestral recombination graph (ARG), rather than a tree. The problem of sampling G conditional on D is computationally challenging, and for that reason several approximate methods have been proposed, the most relevant here being HAPGEN () and HAP-SAMPLE (), which are based-upon the PAC-likelihood method of (). The algorithm of Li and Stephens is an appealing way to reduce the computational burden involved in calculating probabilities under a full coalescent model. Instead, it uses an approximation scheme, based upon a model in which haplotypes are explained as mosaics of other existing haplotypes. This scheme is shown to (i) reduce computational burden significantly, and (ii) provide a good approximation to probabilities that would be obtained under the full coalescent model. However, it remains the case that one would prefer to sample from the exact coalescent model when such a thing is tractable. In this article, we present software that makes this practical for regions of length up to 500 kb, using as many as about n o = 100 reference haplotypes.
METHODSLet D denote an existing sample of haplotype data, assumed to evolve under an unstructured, neutral coalescent model. The evolutionary parameters for this model, assuming the underlying population has effective size N e , are the per site mutation rate ( = 4N e ), per site recombination rate ( = 4N e r) and exponential population growth rate g, where (r) is the mutation(recombination) rate per generation per site. We refer to these parameters collectively as. We simulate new haplotype data D from the conditional distribution P(D | D,,) using the coalescent model. This process can be written aswhere G is the (unobserved) ARG underlying D, and G is the new ARG that underpins the newly generated haplotypes (so G  G ).
Coalescent simulation from reference haplotypesOur method, RECOAL (REference haplotype simulation using a COALescent approach), proceeds in several steps, each of which we detail below. First we sample an unobserved G, underlying D. Then, using a coalescent prior, we generate a new G that contains G but adds n new tips, each of which will correspond to a new haplotype. The n o original haplotypes are then discarded. The general scheme of RECOAL is represented in. Specifically, we proceed as follows.
Sampling of coalescent genealogy for reference haplotypesAn ancestral recombination graph G for n 0 reference haplotypes is sampled from the conditional distribution P(G | D,,). We use the Metropolis-Hastings Markov chain Monte Carlo method of C.J.Kang and J.Felsenstein (submitted for publication) to sample graphs from this distribution.
Simulation of coalescent genealogy for new haplotypesAfter sampling G, we propose a larger ancestral recombination graph G , containing G and also including n new tips that will lead to the new data D. We let G * denote the newly simulated ancestry, so that G = GG * . G * is sampled using the usual coalescent prior, conditional on G and .
Simulation of data for new haplotypesFor each site, i, types for the new haplotype data at those sites, denoted by D i , are simulated conditional on the types at the same sites in the reference haplotypes, denoted by D i , as well as on G and the mutation rate. We let G i denote the genealogy (a tree in this case) defined by G at site i. We do this using the following procedure. First, the type of the node I a i , corresponding to the root of G i , is sampled from P(I a i | G i ,D i ). We then work our way from top-to-bottom (i.e. root-toleaf) through G i , generating the type of each internal node. Let b denote such an internal node and denote its type by I b i. We sample I b i from P(), where I c i is the (already sampled) type of the parental (higher) node, c, directly connected to b, and d b i is the types of the subset of haplotypes that are descendants of node b. After sampling the types of the all internal nodes, the types for the new haplotype data are sampled. The type of a new haplotype d x i is sampled from P(, where x is the tree tip representing this new haplotype and c is the internal node directly connected to x (and which has type I c i ). Note that RECOAL uses the finite sites model for mutationsallowing for multiple mutation events at each site. In particular, we used the Hasegawa-Kishino-Yano model (HKY85) () as the DNA substitution model.
Ascertained SNPsMany SNP datasets are collected using an ascertainment process in which some kind of bias is likely to be present. An example is the use of a so-called SNP-chip, in which SNPs are often selected to be included on the platform only if they are common. Another example is data from NGS technologies, in which, under a variety of calling schemes, the more copies of a mutant allele that are present, the easier the polymorphism is to call (See Supplementary Material for a full discussion.) This leads to an ascertainment bias in that rarer SNPs are preferentially missing from the reference haplotypes, and the number of polymorphisms is thereby decreased. Applying our algorithm without respecting this ascertainment bias would lead to incorrect performance. For example, we would tend to sample graphs that were shorter, on average, than is correct (since the method would be ignorant of the ascertainment process). Ascertainment is a difficult problem to deal with, but we present an ascertainment-corrected version of our algorithm that allows for ascertainment schemes in which the probability of detecting an SNP is dependent upon its frequency. We give theoretical details of the ascertainment correction in the Supplementary Material.
RESULTSWe demonstrate performance of the proposed method using both data simulated under the coalescent model and data drawn from the 1000 Genomes Project. We begin with examples using simulated data.
Coalescent dataWe used Hudson's coalescent-based simulation program (called ms) () to simulate 1040 haplotypes for a given parameter combination. We then randomly selected 40 haplotypes from those 1040 haplotypes. Using the selected 40 samples as the reference haplotypes, referred to as H ref , we applied our method to simulate 1000 new haplotypes using the same. We refer to these as H new. We then compare properties of H new to the 1000 unsampled haplotypes in the initial coalescent data (referred to as H coal ).plots the the MAF of each polymorphic locus in H coal against the frequency of the same locus in H ref. We then make the same comparison between H new and H ref. The correlation between MAFs is r 2 = 0.905 in the former case and r 2 = 0.903 in the latter, indicating very similar behavior in the actual and generated 1000 haplotypes. We show aggregate results from 100 replicate analyses. In Table 1, we present the results of applying our algorithm to data generated under a range of different mutation rates, and no recombination, across 100 replicates. We show the average number of SNPs over a 10 kb region in H ref , H coal and H new. We also show the results of applying Watterson's estimate of the mutation rate to each dataset (). This shows that the ability of RECOAL to both reproduce SNPs in the reference haplotypes, as well as add new SNPs, leads to a good agreement between the overall polymorphism level in H new and H coal. Tables 2 presents the results of similar analyses, but with recombination included, fora number of different region lengths. In all cases, we see an excellent agreement between the degree of polymorphism in H new and H coal. In, we compare the MAF distribution at polymorphic loci in H coal and H new across 100 datasets. We show this for a variety of population growth rates. We see a good agreement between the MAF spectrum patterns simulated by ms and by RECOAL.
SNP frequency and allele frequency spectrum
Pattern of linkage disequilibriumAs well as preserving the distribution of the number of polymorphic loci and their MAFs,Here = 0.001 and  = 0.0005.it is also important to preserve patterns of linkage disequilibrium (LD). In, we show the pairwise r 2 values between adjacent markers in H ref , H coal and H new across 100 replicate analyses in which data were simulated over a 10 kb region with = 0.001,  = 0.0005. In, the comparison is between each adjacent pair of markers in H ref and the same pair of markers in H coal , and inthe comparison is between pairs in H ref and H new. Again, we see a good agreement between the figures. RECOAL reproduces the LD values from the reference haplotypes with similar variation(an r 2 of 0.93 compared with r 2 = 0.95 for the actual coalescent data), suggesting that data produced by RECOAL are good proxies for the unobserved data in this context. Next, to illustrate the behavior in a single dataset,shows an example of LD patterns, plotted by Haploview (), for data simulated with ms using an overall recombination rate of  = 0.0005 but with the presence of a single hotspot in the middle at which the rate of recombination is 100  greater than in the rest of the region. The LD patterns are well preserved.
0.002
Application to ascertained SNPsWe now give an example of applying RECOAL to ascertained data. Here, we simulate a situation in which the probability of an SNP being reported as polymorphic is a function of the frequency of the mutant allele in the sample at that position, such as might be appropriate for datafrom NGS. We denote the number of SNPs present in H new that were also observed in H ref by S O. S H denotes new SNPs present in H new that will also be present in H ref these are the SNPs added to reflect the ascertainment scheme (Supplementary Material). Finally, S N denotes SNPs which are present in H new as the result of new mutation in G * and which are non-polymorphic in H ref .shows the number of SNPs in the newly simulated haplotypes from the reference haplotypes ascertained with the different SNP calling threshold , in each of these categories, both with and without the ascertainment correction scheme. Without application of the ascertainment correction, the new haplotypes have fewer SNPs than they should. (The results for  = 0 give the correct null behavior, since there the ascertainment has no effect.) When ascertainment correction is used, the new haplotypes have a number of SNPs that is close to the correct value, although we see a slight tendency to introduce too many new SNPs as  increases.
Comparison with other methodsNext, we compare RECOAL to another haplotype simulation method that creates new haplotype data by resampling existing reference haplotypes. There are two such methods: HAPGEN () and HAP-SAMPLE, (). Both these methods simulate new haplotypes using schemes based upon Li and Stephen's elegant PAC likelihood algorithm (). Both methods also perform well in terms of reproducing the pattern of LD in the region considered (results not shown). However, the models do differ in how they treat the mutation process. There is no mechanism for introducing new polymorphic sites in HAP-SAMPLE. As such, HAP-SAMPLE will necessarily under-represent the degree of polymorphism in the newly generatedhaplotypes. For this reason, we focus our comparison on HAPGEN, which introduces new mutations using a mutation rate that decreases as each new haplotype is produced (reflecting the intuition that as more haplotypes are sampled, the probability of detecting new polymorphism will decrease). As before, we examine the number of SNPs that are observed on the haplotypes generated by each algorithm. We show results for a range of sizes for H ref .shows the relationship between the number of SNPs in H ref and the number of SNPs in H new , using both methods. For reference, we also include a comparison between H ref and H coal in the initial data, which were simulated using ms, with = 0.001. We show results across 50 replicates. As a summary, we fit a regression line in each case. We see a good agreement between H coal and H new when using RECOAL, and a good agreement between the regression line for results from RECOAL and those from ms. The agreement is also quite good when using HAPGEN, but there appears to be a systematic tendency to add slightly too few SNPs when using HAPGEN. Tables 4 and 5 show the number of SNPs simulated by HAPGEN and RECOAL for a variety of sizes of H ref. While the 95% confidence interval for RECOAL includes the mean number of SNPs in the simulated population data in each case, and appears to show no systematic dependency upon the size of H ref , we observe that the average number of SNPs in haplotypes simulated by HAPGEN appears to be dependent on the size of both H ref and H new. In defense of the latter algorithm, we recall that it is an approximation designed to improve computational tractability, thereby allowing application of such a resampling scheme in a range of contexts that is broader than is permissible using our own method. Our point in this article is to present an exact coalescent method that can be used when the region of interest is reasonably small (less than 500 kb).
Simulation with 1000 Genome Project dataWe close by showing an example application of RECOAL aimed at simulating new haplotypes from the low-coverageForty reference haplotypes were used. For comparison, we also show results obtained when using ms to simulate a population of the same size in each case (MS).1000GP data. We simulated 1000 haplotypes for a 500 kb region (2121.5 MB) of Chromosome 21 using haplotypes constructed from the 4 coverage 1000GP CEU data. Since the data are low coverage, some SNPs are not called. The rate at which this occurs (i.e. the ascertainment bias), is reported as a function of allele frequency (in the sample) in (1000 Genomes Project Consortium, 2010) (). When applying RECOAL, we used fine-scale recombination rates estimated by the HapMap consortium (). for that region is 0.001 per site (). We summarize the simulation results in. Again, we report SNPs in three classes: S O , SNPs which are also observed in the reference haplotypes; S N , SNPs which appear only on the simulated haplotypes; and S H , SNPs present in H new that will also be present, but were not observed due to ascertainment, in H ref. We see that the ascertainment correction adds 98.4 SNPs on average to correct for the estimated ascertainment probabilities.We also show an example of the LD pattern observed in H new and H ref in. The pattern of LD of the simulated haplotypes shows high agreement.
Coalescent simulation from reference haplotypes
DISCUSSIONIn this article, we introduce an exact coalescent method for the simulation of new haplotype data from an existing set of reference haplotypes. Our method, RECOAL, simulates data from the distribution P(D | D,,) using the full coalescent model rather than using an approximation to that model. In addition to the replication of SNPs present in the reference haplotypes, RECOAL also simulates new SNPs using a coalescent prior. It preserves LD structure well, and we demonstrate that new polymorphism is added at an appropriate level. Because of its exact nature, RECOAL is less computationally tractable than the approximation underpinning HAPGEN, but it is produces data under the full coalescent model rather than the approximation to the coalescent model exploited by HAPGEN. As such, we argue that it is appropriate to use RECOAL when computational considerations permit. Nonetheless, we believe HAPGEN remains an excellent alternative approach. It should be noted that Step 1 of our approach is based on an MCMC method. As such the user must allow the MCMC chain to converge to the stationary distribution of P(G | D,,). The time taken to reach convergence increases with both overall recombination rate and number of reference haplotypes. Thus, the combination of recombination rate and the number of reference haplotypes determine the limits of computational tractability of RECOAL. As an example, the simulation used in this article, which includes 40 reference haplotypes over a 100 kb region with human population parameters, takes 4 h to simulate 1000 new haplotypes on a typical desktop machine. As such, RECOAL is intractable for simulation of regions larger than 500 kb. However, in the context of followup of a GWAS, for example, in which the area being investigated may be quite short, our software allows for the exact coalescent simulation of new haplotypes conditional on the existing data, under the coalescent model, rather than using a more approximate method. When larger regions are desired, or much larger reference samples exist, we recommend the approximate method HAPGEN still be used. Of course, our method is model-based and, as such, is exact in the sense that it samples from exactly the correct distributions conditional on that model. This, then, is a good time to remind the reader of a quote attributed to George Box: 'All models are wrong; some are useful'. The coalescent has proven itself to be widely useful, but it is still, of course, 'wrong'. One example of its 'wrong-ness' in the present context is that we use a neutral model of molecular evolution, ignoring natural selection. There is a literature about the coalescent with selection included (), and some programs () can simulate data with the presence of the selective mutation. But those models are not tractable when one wishes to condition upon the existing data, so, like most other coalescent simulators, RECOAL simulates data under neutrality. Another area in which our model is wrong is that it is based upon an unstructured coalescent. In other words, we assume random mating. While this has proven to be a robust approximation to the behavior of single populations, it has proven necessary to introduce extensions to the coalescent when population structure is present. As such we would recommend caution when applying our method to datasets in which multiple populations are present, or selection is expected to have occurred. In the former context, for example, it might be more appropriate to produce new haplotypes for each subpopulation separately, by dividing the data into its subpopulations and applying RECOAL to each subpopulation in turn. The existing version of RECOAL allows for fine-scale variation of recombination rates and for exponential growth of population size. Extensions to other more complex demographic scenarios such as bottlenecks and population admixture are also possible, and are currently under development. Finally, we also presented an extension of our method to ascertained data in which the probability of ascertainment is a function of allele frequency. Admixture is an extremely challenging problem in coalescent methods and we note in passing that our correction illustrates how sampling of an underlying coalescent genealogy, condition upon observed polymorphism data, can be adapted to respect such an ascertainment scheme. Funding: National Institutes of Health (MH084678) and National Science Foundation (HG005927), as well as improvements due to comments received from the reviewers.
Conflict of Interest: none declared.
The Author 2012. Published by Oxford University Press. All rights reserved. For Permissions, please email: journals.permissions@oup.com at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
