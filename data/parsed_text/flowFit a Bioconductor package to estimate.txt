Herein we introduce flowFit, a Bioconductor package designed to perform quantitative analysis of cell proliferation in tracking dye-based experiments. The software, distributed as an R Bioconductor library, is based on a mathematical model that takes into account the height of each peak, the size and position of the parental population (labeled but not proliferating) and the estimated distance between the brightness of a cell and the brightness of its daughter (in which the dye is assumed to undergo a 2-fold dilution). Although the algorithm does not make any inference on cell types, rates of cell divisions or rates of cell death, it deconvolutes the actual collected data into a set of peaks, whereby each peak corresponds to a subpopulation of cells that have divided N times. We validated flowFit by retrospective analysis of published proliferation-tracking experiments and demonstrated that the algorithm predicts the same percentage of cells/generation either in samples with discernible peaks (in which the peaks are visible in the collected raw data) or in samples with non-discernible peaks (in which the peaks are fused together). To the best of our knowledge, flowFit represents the first open-source algorithm in its category and might be applied to numerous areas of cell biology in which quantitative deconvolution of tracking dye-based experiments is desired, including stem cell research. Availability and implementation:
INTRODUCTIONIn cell proliferation-tracking experiments, cells are stained before being cultured under various conditionswith a fluorescent dye to follow proliferation kinetics. At each mitosis, the dye is roughly equally divided between daughter cells, so that each daughter is about half as fluorescent as the mother. At any given moment, therefore, the fluorescence intensity of a cell bears witness to its divisional history when compared with the intensity of the parental population.In a typical experimental pipeline, cells are first labeled with a tracking dye, then allowed to proliferate (frequently in the presence of specific stimuli) and finally analyzed by flow cytometry by collecting data for (i) unlabeled cells (used as a negative control), (ii) unstimulated labeled cells (the non-proliferating population) and (iii) sample(s) of labeled and stimulated cells (the proliferating populations). If the characteristics of the logarithmic amplifier on the flow cytometer are known, it is possible to derive, from a histogram of fluorescence intensity, the proportion of cells that have undergone any particular number of divisions (. Generally, a flow cytometer with 1024 channels (channels range) represents a nominal range of 4 log decades. Several fluorochromes have been used to track cell proliferation (), including DNA-binding fluorescent dyes (Hoechst 33342, thiazole orange), cytoplasmically distributed fluorescent dyes (calcein, 2 0 ,7 0-bis-(2-carboxyethyl)5(6)-carboxyfluorescein), covalent coupling fluorescent dyes (Carboxyfluorescein succinimidyl ester, fluorescein isothiocyanate) and membrane-inserting fluorescent dyes (PKH26, CellVue Lavander). Although each dye displays advantages and disadvantages for individual experimental purposes [reviewed in (, a common problem is represented by the quantification of the fluorescence signal: under optimal conditions some dyes [e.g. carboxyfluorescein diacetate succinimidyl ester (CFSE)] form separate peaks defining different proliferative generations, whereas others (e.g. PKH26) do not (). A good proliferation-tracking algorithm should be able to give similar results in both cases. Here we introduce flowFit, an R (R Development Core Team, 2012) Bioconductor library () that fits a set of peaks (corresponding to different generations of cells) to the histogram of fluorescence intensity acquired during a fluorescence-activated cell sorting (FACS) experiment. The package is integrated with the Bioconductor libraries used for the analysis of flow cytometry datasets: flowCore () and flowViz (). The performance of flowFit was evaluated by the retrospective analysis of a published dataset of dye-tracking experiments (), in which lymphocytes were stained with three different proliferationtracking dyes: CFSE, cell proliferation dye eFluor 670 (CPD) and CellTrace Violet (CTV). In particular, we meta-analyzed a subpopulation of CD4 lymphocytes labeled with the three different staining reagents. The three samples were allowed to proliferate under identical growth conditions; however, differences in the characteristics of the dyes yielded rather different *To whom correspondence should be addressed. fluorescence histograms with different peak definitions (). FlowFit was able to deconvolute equally well in all situations and to estimate the same percentage of cells per generation under all conditions.
METHODS
ModelThe proliferation-fitting algorithm uses an R implementation of the LevenbergMarquardt algorithm () to fit a set of N peaks to the histogram of the fluorescence intensity from the acquired flow cytometry data file (FCS file). The LevenbergMarquardt algorithm provides a numerical solution to the problem of minimizing a function over a space of parameters. It is an iterative technique that locates the minimum of a multivariate function. The 'minimum' is expressed as the sum of the squares of non-linear real-valued functions (). The algorithm adjusts the function parameters to reduce the sum of squares (residuals) between the real data and the model. When the current solution is far from the initial guess of parameters, the algorithm behaves as a steepest descendent method. When the current solution is close to the correct solution, it becomes a GaussNewton method (). The proliferation-fitting algorithm fits an initial single peak on the parental population (cells labeled and unstimulated), according to this formula:where a 2 is proportional to the height of the peak, is the peak position on the FACS scale and s is proportional to the peak size (for the parental population, it corresponds to the variance in the initial staining). The formula for the next peak (corresponding to the cells that have divided once) will be:where b 2 is proportional to the height of the peak, and D is the distance between two generations of cells. The distance between two cell generations is defined as the distance between a mother cell and its progeny (that contains half of the amount of dye present in the mother). This distance is constant on a logarithmic scale and depends on the number of data points analyzed by the FACS instrument and on the range of log decades. It is possible to convert the FACS fluorescence intensity (FFI) recorded by the instrument into the relative fluorescence intensity (RFI) expressed in molecules of equivalent fluorochrome () using the following formula:The inverse formula can be used to convert RFI to FFI:where:(1) RFI is the relative fluorescent intensity(2) FFI is the fluorescence intensity on the FACS scale(3) l is the number of log decades in the FACS instrument(4) c is the number of data points (channels) in the instrument Using these formulas, it is possible to estimate the spacing between generations of cells on the FACS instrument scale: we first convert the peak position of the parental population (unstimulated population) into RFI, then we calculate the RFI of the first-generation cells (RFI/2) and, finally, we convert back the RFI into FFI; the difference between FFI of the parental population and FFI of the first generation of cells represents the distance between generations (D). In the flowFit library, this spacing is automatically computed with the function generationsDistance. The number of log decades on the instrument can be estimated by converting the linear scale of the detector into a log scale:where R is the acquisition resolution (data range for the detector). The proliferationFitting and parentFitting functions automatically compute the log decades from the keywords in the FCS file or using the logarithm of R[log(R)]. If the functions find a 'log decades' keyword for the current detector in the FCS file, they use the value in the keyword; otherwise, log decades are estimated from the detector acquisition resolution. The algorithm automatically computes the number of peaks to be fitted on the proliferating population using the data range for the detector: first, the distance between two generations of cells is estimated using the generationsDistance function; then the maximum number of peaks that can be fitted on the FACS instrument scale is estimated with the following formula:where:(1) N is the number of peaks to fit on the dataset(2) D is the distance between two generations of cells(3) c is the number of data points (channels) in the instrumentThe formula for a model with three peaks will be:where the parameters a, b and c are proportional to the height of the peaks. In the 'fixed model' (options fixedModel  TRUE), the Levenberg Marquardt algorithm estimates the height of each peak but allows the user to keep one or more of these variables constant: parental peak position (), parental peak size (s) and the distance between two generations (D); the variables added to the list of fixedPars will be kept constant during the algorithm iterations. In the 'dynamic model' (options fixedModel  FALSE), the LevenbergMarquardt algorithm uses as parameters all the variables in the model. In general terms, the dynamic model best suits the analysis of samples showing discernible peaks. Conversely, when the sample features poorly defined or no discernible peaks and the model is unable to accommodate the peaks, it is preferable to keep those variables fixed. Once the height of each peak is estimated, it can be used to estimate the number of cells per generation through a numerical integration of (7):where v and W are the lower and upper limits of the FACS instrument scale, respectively. For each generation, the number of cells in the peak can be computed through another numerical integration:and the percentage of cells in a peak can be estimated as:To evaluate the proliferation in the sample, flowFit uses the proliferationIndex function: the proliferation index is calculated as the sum of the cells in all generationsincluding the parentaldivided by
2061flowFit the computed number of original parental cells theoretically present at the beginning of the experiment (). The proliferation index is a measure of the fold increase in cell number in culture, over the course of the experiment:where i is the generation number (parental generation  0). In the absence of proliferation, when all cells are in the parental generation, the formula becomes N 0 N 0 =2 0  1 12 defining the lower limit of the proliferation index.
ImplementationThe flowFit is distributed in the R software language (R Development Core Team, 2012) as a Bioconductor () package. The package is freely available and distributed under the Artistic 2.0 License (Open Source Initiative, 2013). The flowFit package is composed of two main functions (parentFitting and proliferationFitting) and five secondary functions (logTicks, proliferationIndex, generationsDistance, proliferationGrid and getGenerations). The typical pipeline involves a first step () where the FACS raw data are imported, transformed and gated with the flowCore library (). By applying the function parentFitting to the sample representing the parental population, the position and size of the first peak are then established (). Finally, the estimated parental peak position and size are used to perform a fit on the proliferating population with the function proliferationFitting (). The position and size of the parental population can be used as an initial guess for the LevenbergMarquardt algorithm (dynamic model); in this case, the algorithm will adjust these variables, in the proliferating population, as needed to achieve optimal fitting. Alternatively, position and size of the parental population can be used as constants (fixed model). In general, when the input data have poorly defined cell division peaks, the fixed model is preferable. Because tracking dyes are partitioned roughly equally between daughter cells, it is possible to assume that the size of cell division peaks in the data is mainly due to the variance in the initial staining. For this reason, the proliferation-fitting algorithm uses the width of the parental peak to calculate the size of each peak in the final population [s in. FlowFit depends on flowCore, a Bioconductor package that provides data structures and basic functions to deal with FCS data. The user will load the data and gate them with the flowCore functions to select the correct population and to remove aggregates and debris. After these preprocessing steps, the user will use the flowFit library to perform the proliferation fitting. The algorithm is not able to detect ploidy patterns.
RESULTSThe proliferation-fitting algorithm was tested by retrospective analysis of a published dataset consisting of three samples of mouse lymphocytes stained with CFSE, CTV and CPD (). We focused on the raw data used to generateof the original paper. This subset of raw data contains four samples:(1) CD4 non-stimulated lymphocytes labeled with CFSE, CPD and CTV (parental population)(2) CD4 lymphocytes labeled with CFSE and stimulated(3) CD4 lymphocytes labeled with CPD and stimulated(4) CD4 lymphocytes labeled with CTV and stimulatedThe datasets, already gated for CD4 lymphocytes, were log10 transformed after truncation at 1. Then, we performed three parentFitting on the 'parental sample' to establish the position and size of the parental population for the three dyes (). Using the parental peak position and size as a best guess, we performed a proliferationFitting with the dynamic model on the CFSE and CTV samples. In the CPD sample, the stimulated population did not display well-separated peaks, at variance with the CTV and CFSE samples. Thus, for the CPD sample, we used a fixed model (proliferationFitting with fixedModel  TRUE), keeping the parental peak position fixed (). Finally, we compared the percentage of cells per generation in the three samples and evaluated the concordance among the fittings. Using the chi-squared test, we did not observe any significant difference in the distribution of cells per generation among the three estimates (p  1), arguing that the algorithm is correctly estimating the percentage of cells per generation in the three samples (Supplementary). Altogether, the proliferationFitting analysis performed on the datasets published by Quah and Parish, which yielded similar results compared with those of the original study, argues for the suitability of flowFit to the analysis of cell proliferation in tracking dye experiments with either poorly or well-discernible peaks, based on the dual possibility to fit them, respectively, with the dynamic model or with the fixed model. We also performed an in silico analysis to benchmark the performance of the algorithm with random samples (and Supplementary Materials Section 3, including Supplementary Figs. S7S21) for the dynamic and fixed models. In general, the dynamic model performed well with samples where the parental peak size (that corresponds to the variance in the initial staining) is small and the proliferating population forms wellseparated peaks. The fixed model, on the other hand, performs well also with samples with a poorly defined cell division peaks (cf: Supplementary Figs. S8 and S14).
DISCUSSIONThe objective of this work was to provide an open-source algorithm to quantify the proliferation of cells in tracking dye experiments. Of note, although the proliferation-fitting algorithms currently available for this type of analyses (ModFit LT TM , FCS Express and FlowJO) are commercial software, flowFit is already publicly available and published with the Artistic 2.0 License in the Bioconductor R framework. We provided statistical demonstration of the quality of the fitting with both in silico analysis and real dataset analysis. In particular, we demonstrated the intrinsic versatility of flowFit in providing reliable results in the analysis of samples with both discernible and non-discernible peaks. At variance with ModFit LT TM , which uses a statistical analysis of the fluorescence histogram to identify potential peaks and a Gaussian model for the single peak, flowFit uses a LevenbergMarquadt algorithm to minimize the difference between the observed data and the model, and uses a non-Gaussian formula (1) to define a peak. In addition, flowFit is fully integrated in the Bioconductor R framework. In recent years, several approaches, based on dye tracking, have been developed to identify and isolate adult stem cells (SCs) from normal and tumor tissues (e.g.). These methodologies rely on the fact thatin the normal adult SC compartmentSCs divide asymmetrically to generate two daughter cells with opposite proliferative and differentiative fates: one of the two daughter cells retains the SC fate and withdraws into quiescence, whereas the other becomes a progenitor and enters a tumultuous phase of repeated symmetric divisions, required to expand the progenitor compartment, followed by terminal lineage differentiation. One characteristic of the SC compartment in cancer is that the cancer SCs tend to skip rounds of asymmetric division, in favor of symmetric divisions, after which both daughters divide again (). This leads to an expansion of the SC compartment. The 'rate of skipping' seems to be higher in poorly differentiated more aggressive tumors (). Methodologies to follow the kinetics of SC division in vitro and to compare the rate of symmetric versus asymmetric divisions are needed if we want to understand the biological bases of homeostasis of normal SC compartments and of how expansion of the SC compartment drives cancer growth and aggressiveness. We envision this as one of the major areas of application for flowFit. To this aim, the integration of flowFit with a stochastic model of cell proliferation based on a Gillespie algorithm will likely be required to analyze in real tumor tissues the proliferation kinetics of cancer SCs compared with that of their tumor progeny, and to compare proliferation data from these populations with relevant theoretical models of proliferation (for instance, models of asymmetric versus symmetric mode of division in the cancer SC versus the transient-amplifying compartment of progenitors). This approach will probably be instrumental to identifying parameters in the stochastic model able to yield the best overlap between real data and simulations.Note: Summary of in silico analysis: random samples with different levels of division peak quality (Supplementary Section 2.1). The maximum peak width that gives reliable results (Column: varying peak size, 017) correspond to a parent population with 75% of the events distributed across 25.7 channels (in a FACS with 1024 channels and 4 log decades), a 'peak size' of 0.4 corresponds to a parent population peak with 75% of the events distributed across 61.7 channels (in a FACS with 1024 channels and 4 log decades); random samples with different distribution of cells per generation (Supplementary Section 2.2): the percentage of samples that gives reliable results is depicted (Column: random samples).
The Author 2014. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
D.Rambaldi et al. at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
flowFit at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
