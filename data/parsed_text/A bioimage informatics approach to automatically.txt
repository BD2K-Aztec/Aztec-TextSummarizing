Motivation: Fungi form extensive interconnected mycelial networks that scavenge efficiently for scarce resources in a heterogeneous environment. The architecture of the network is highly responsive to local nutritional cues, damage or predation, and continuously adapts through growth, branching, fusion or regression. These networks also provide an example of an experimental planar network system that can be subjected to both theoretical analysis and experimental manipulation in multiple replicates. For high-throughput measurements , with hundreds of thousands of branches on each image, manual detection is not a realistic option, especially if extended time series are captured. Furthermore, branches typically show considerable variation in contrast as the individual cords span several orders of magnitude and the compressed soil substrate is not homogeneous in texture making automated segmentation challenging. Results: We have developed and evaluated a high-throughput automated image analysis and processing approach using Phase Congruency Tensors and watershed segmentation to characterize complex fungal networks. The performance of the proposed approach is evaluated using complex images of saprotrophic fungal networks with 10 5 â€“10 6 edges. The results obtained demonstrate that this approach provides a fast and robust solution for detection and graph-based representation of complex curvilinear networks. Availability and implementation: The Matlab toolbox is freely available through the Oxford e-Research Centre website: http://www.oerc .ox.ac.uk/research/bioimage/software Contacts:
INTRODUCTIONRapid advances in imaging technologies have heralded a new era of quantitative measurements that offer considerable potential to improve our understanding of complex biological systems, particularly those that need to be considered as integrated functional units (). In particular, enhanced image processing techniques have greatly facilitated characterization of interconnected transport and communication networks in animal systems, including vascular systems, milk ducts, respiratory pathways and neuronal circuitry [e.g. (. In contrast, there has been remarkably little progress to characterize macroscopic microbial network development for an entire taxonomic group of organisms, namely the fungi. Unlike other biological networks, which exist within an organism, the entire growth form of fungi is as an adaptive network. Foraging saprotrophic fungi play a central role in ecosystem biology as they are the only organisms capable of complete degradation of wood in temperate forests. These fungi form extensive interconnected mycelial networks of multi-hyphal cords that forage for scarce resources that are patchily distributed in time and space (). The architecture of the network responds to local nutritional cues, damage or predation and the local structure is continuously remodeled through growth, branching, fusion or regression of the hyphal cords. Despite the absence of any centralized control system, these organisms exhibit complex foraging and decision making behavior as a co-ordinated individual. Unlike animal network models, microbial networks also provide an example of an extremely tractable experimental system that can be subjected to both theoretical analysis and experimental manipulation in multiple replicates (). Early measures of macroscopic mycelial organisation focussed on fractal dimension as a useful tool to capture aspects of the network structure as a metric (). However, a single summary statistic, such as the overall fractal dimension provides little opportunity to characterize the network structure and dynamics further or to explore the underlying mechanism leading to network optimisation. There has been some progress at the microscopic level to extract the physical network structure using (semi)-automated image analysis (). However, to date, delineation of the network architecture from the larger soil-based systems has only been possibly manually (), as basic intensity-based segmentation is not effective in this context (M.D.Fricker, L.Boddy and D.P.Bebber, unpublished data). As a result, the total number of macroscopic fungal networks analysed so far is relatively low. Nevertheless, graph-theoretic analysis of the digitised networks has provided evidence that these indeterminate, de-centralized systems yield adaptive networks with both high-transport capacity and robustness to damage, but at a relatively low cost, through a 'Darwinian' process of selective reinforcement of key transport pathways and recycling of redundant routes (). Furthermore, fungal networks dynamically modify link strengths and local connectivity when subject to experimental attack to readjust the balance between transport capacity, robustness to damage and resource allocation, resulting in increased resilience as the environment becomes more challenging (). Existing image processing approaches for semi-automated fungal network extraction work best if the mycelium is grown on a suitable substrate, such as cellophane () or nitrocellulose () to facilitate acquisition of high-contrast images. The subsequent processing procedure typically involves noise reduction, using median or band-pass filters, intensity-based thresholding, with manual or automated threshold selection, followed by morphological processing to achieve an improved skeletonisation of the colony structure e.g. Barry and Williams (2011). However, these methods require rather specific culture conditions and illumination regimes that cannot readily be adapted for macroscopic networks grown on soil-based media, which is essential to explore the natural behavioural capability of these organisms and the range of their responses. In addition, the branches (termed cords in these systems) are multi-hyphal aggregates and show considerable variation in contrast as the individual cords span several orders of magnitude in diameter from m to mm, within a single colony. Furthermore, the background from the compressed soil substrate is not homogeneous in texture or reflectivity. Under these conditions, automatic characterization of the fungal network is challenging for conventional image processing approaches and more advanced solutions are required. We have developed a high-throughput automated image analysis approach to detect and characterize large complex fungal networks, grown under realistic conditions. We use watershed segmentation to extract the network rapidly, with prior curvilinear feature enhancement to highlight the network structure in noisy or low contrast images. The proposed enhancement method uses a novel brightness-and contrast-invariant approach based on the concept of local phase, called the Phase Congruency Tensor (PCT). The resulting skeleton is then pruned on the basis of local cost functions that incorporate both intensity and tensor direction information. A graph representation of the network is constructed from the pruned skeleton to give the network topology or a weighted network that includes edge lengths. To obtain an estimate of the edge thickness, which is important in predicting the physiological performance of the system, the skeleton is dilated to capture the approximate dimension at each point, and this value is used to set a local sampling region to estimate the reflected cord intensity for comparison with empirically derived calibration curves. This approach ensures that even sub-resolution branches can be analysed correctly. An addition procedure is applied to extract the resource region which is then used to redefine a corresponding part of the graph. Although we apply the method here to fungal networks, it has wide applicability to planar networks in any domain. highlight curvilinear features and reduce background effects. Although other alternatives are available, here we concentrate on methods based on tensors.
Intensity-based tensorsA tensor representation of an image can give information about how much the image varies along and orthogonal to the dominant orientations within a certain neighborhood (). In particular, the Hessian matrix (a secondorder tensor) has been proposed to describe local shape orientation for elongated structures (). Since curvilinear structures observed in the image can appear in different sizes, scale space representations have been extensively used. This is commonly achieved through the use of a family of Gaussian filters, or their derivatives, with multiple scales achieved by varying the value of the variance. One of the most popular Hessian-based approaches to enhance curvi-linear structures is known as vesselness (). For a given image I(p) and scale , vesselness is defined aswhere p  x; y T is the spatial location, ;1 ; ;2 are the eigenvalues of H p (the Hessian matrix at scale ) satisfying j ;i j j ;i1 j; and c are thresholds that control the sensitivity of the line measurement. Multi-scale vesselness, for a given set of scales AE  fg, can be computed as the maximum of the vesselness values calculated at different scales, and the eigenvectors at the same scale can be used to define local orientation (). An alternative measurement of piecewise linear segments that is also based on the Hessian matrix, called neuriteness, has been proposed in ().
MATERIALS AND METHODS
Input imagesThe proposed approach has been tested and validated on images of fungal networks of Phanerochaete velutina or Phallus impudicus that were grown for 3950 days in the dark on compressed soil or sand microcosms and photographed at intervals, as described previously, see().
Phase congruency-based tensorsHerein, we introduce a novel phase concept for curvilinear feature enhancement called the PCT. In general, local tensor-based representations can be produced by combining the outputs from polar separable quadrature filters, applied on several orientations (). Although tensor representations can be built on purely intensity-based filters (like the Hessian), these have the downside of being sensitive to changes in image contrast. Methods based on local phase have been proposed as a contrast-independent alternative for feature detection. In particular, phase congruency () is based on the concept that salient features have similar values of local phase when observed at different scales. We exploit the idea that phase congruency values are high in the direction perpendicular to the structure, while they remain close to zero in the direction parallel to the structure. More importantly, the values of phase congruency are minimally affected by contrast changes. Thus, for a given set of scales fs}, a set of orientations fo} and a given set of phase congruency measures PC o p (for each orientation o) (), the PCT takes the following form ():where n o is the normalized orientation vector in the direction o,  1=m  1, with m being the dimensionality of the image and I is the identity tensor. The local structure can then be described by eigenvectors and eigenvalues of T PC .
PCT vesselness and PCT neuriteness As described inSection 3.2, piecewise curvilinear segments can be detected by analyzing the relations between eigenvalues and eigenvectors of the locally calculated Hessian. In a similar way, the dominant orientation of the surface representing a curvilinear structure is given by the dominant eigenvector of T PC , i.e. the eigenvector corresponding to the eigenvalue of largest magnitude. PCT-based vesselness and PCT-based neuriteness are calculated using the original vesselness and neuriteness equations, with the eigenvalues of T PC substituting those of the Hessian.
General approach for network extraction
Curvilinear feature enhancement Let us consider an imageof a curvilinear network structure I(p) of a size M  N pixels, where p  x; y T represents pixel location. When the curvilinear network is not affected by variations of intensity contrast within the image, then the input image I(p) is directly used in the following procedures (see). Otherwise, one of the curvilinear feature enhancement methods, discussed in (Section 4.2), is applied. An enhanced image I F p as well as the corresponding vector field I VF p are calculated. The size of image I VF p is M  N  2.
WatershedThe watershed transformation was introduced as a tool for segmenting gray-scale images by (), and is now used as in many segmentation procedures using efficient algorithms (). Lets us consider a gray-scale image I(p) (or I F p) as a topographic surface: the gray level of a pixel becomes the elevation of a point, the basins and valleys of the relief correspond to the dark areas, whereas the peaks and crest lines correspond to the bright areas. The watershed line may be intuitively introduced as the set of points where a drop of water may flow down towards several catchment basins of the relief. The watershed algorithm can be used for segmentation by using the calculated catchment basins as segmented regions. In our case, however, we are interested in watershed lines themselves, which delineate ridges in the image and thus correspond to network branches.
Branches and branching points extraction
PruningThe pruning procedure used here is based on a cost function that includes weighted contributions of both intensity information and the alignment of the local vector field, calculated for every branch of the skeleton. The cost of the branch defined by pixels b is computed using the following formula:where C I is a normalized input or enhanced image intensity-based cost defined byand C V is a vector field-based cost that is calculated as follows:and K is a number of pixels in b. 2 0; 1 determines the relative weight of the C I and C V cost components. |||| is the Euclidean norm. The purpose of the vector field cost C VF is to determine branches aligned with the direction of a vector field given by I VF p. Finally, all branches with a cost value smaller than threshold t and their corresponding branching and end points are removed (see
Graph extractionIn order to apply network analysis tools, the morphological structure has to be translated into an appropriate network representation. We assume that the fungal network can be represented as a graph by classifying junctions (branch-points and anastomoses) as nodes and the hyphae or cords between nodes as links (). The graph representation of the networkBioimage informatics approach to extract fungal networks structure is constructed by matching every branch with its two corresponding branching points or with its branching point and endpoint, see figure 1d. The input branches, branching and end points images, I B p, I BP p and I BE p, respectively, are used to construct the graph G. For every branch b in I B p, a set of corresponding branching points fbp} is extracted. When the branch has two branching points then the graph's edge G(i) is defined by fbp(1), bp(2)}, otherwise, G(i) is represented by branching point bp(1) and the end point be. The procedure is given in Algorithm 2.
ThicknessA very important measure used to characterize biological networks, is the cord thickness, as this has a significant impact on the physiological function of the network. The thickness value for each branch is determined by iterative filtering of the center line image using morphological dilation and reconstruction procedures (). The input branches and branching points and ends images, I B p; I BP p and I BE p, respectively, are used to construct the skeleton images I SK p. A copy of I SK p, called I W p, is then dilated using a disk structuring element S with 1 pixel radius. The difference between I W p and the result of dilation is stored in the image I S p that contains the surrounding boundaries of the skeleton. Then, for a given threshold value k, thresholding of the image I F p masked by the image I S p is performed and the image I V p is obtained. In order to reconstruct all pixels in the image I V p which are connected to the skeleton in the image I W p, the morphological reconstruction of the image marker I W p under the image mask I M p, a union of I SK p and I V p, is performed producing I R p. The points in I R p are added onto I W p, and the procedure is repeated. The procedure is repeated until no pixels remain to be reconstructed with intensity I F p above k. The distance map I RD p is calculated as the shortest distance from each of the skeleton points I SK p to the background in the reconstructed image I W p. Finally, the thickness map image I TK p is given by the distance map image I RD p weighted by the mean intensity of I
Application to extraction of fungal networksIn all the fungal network extraction experiments, the following parameters have been used: number of scales and orientations  6, weight  0:5, branch cost threshold t  0.2 and thickness threshold k  0.4. In all cases, the PCT-based vesselness approach (Equation 1) is used. An analysis of the sensitivity to different parameters for the PCT calculation can be founded in (). In the particular case of the fungal networks, the graph representation of the network has to be redefined in the region corresponding to the fungal source of food, as the structure of the network within the food source is not visible, but can be approximated as a single node connected to all cords arising from the boundary.
Fungal food source detectionIn order to extract the fungal food source, the image I(p) is segmented by a global threshold (). The segmented image is then filtered using morphological opening and closing using a disk structuring element S, to produce the binary image I Food p.shows the output of this procedure.
Graph for the fungal networkThe graph G representing the fungal network is finally modified to account for the presence of food resources. The graph is redefined for the vertices that intersect with the segmented resource I Food p. such that they all connect to a single node in the center of the source of food as the underlying network is not visible within the wood block ().
RESULTSSpecies such as P. impudicus produce densely cross-linked networks, with relatively well-defined thick cords. To summarise the complete extraction process, images of this species collected at high-resolution and high-contrast () were rapidly segmented using the watershed method (), with no additional requirement for curvi-linear feature enhancement. Oversegmentation, generally considered as a downside of the watershed transform, allows in this case a rapid delineation of highdensity networks. Pruning based on the average intensity of every branch was then carried out, providing a mechanism to control the overall level of detail of the final network (). The graphrepresentation of the network was then calculated by defining the branch or fusion points and end points throughout the network as nodes, and then determining the edges that link them (). The Euclidean length of each edge was also calculated from the segmented skeleton, and the cord thickness estimated from a sequence of morphological dilations of the skeleton until the threshold criterion was reached, combined with filtered pixel intensities to capture the difference in reflectivity for cords of different dimensions (). The final step for the fungal networks was to identify the initial food resource () and then redefine the graph in this region to connect all cords emanating from the resource with a central node (). The performance of the proposed approach applied to the entire image is presented in. When no enhancement was applied, the watershed and pruning method was less reliable for low-contrast, low-resolution images, such as those obtained for Phanerochaete velutina, which has thinner, more diffuse cords, particularly at the growing margin. With varying levels of threshold, the network was initially over-segmented, but rapidly became dis-connected as the threshold was raised, making the choice of threshold critical (e). In comparison, even these challenging networks were efficiently extracted following intensity-independent PCT enhancement (see Section 4 for details) to give a very clean network over a broad threshold range (j), that greatly facilitated subsequent pruning operations (). To quantify the performance of our approach, five complex regions of interest in the fungal images were selected. Manual tracing of network centerlines was performed exhaustively by an expert, to give a Gold Standard (GS) reference. In total, in all regions of interest, 2256 network branches were annotated. The GS and extracted network were compared using the network network distance measure " d (), defined as the average distance between each point on the GS network centerline and the corresponding closest point on the extracted network centerline, and vice versa. The standard deviation " d of the network-network distance measures was also calculated. The distance error evaluation for each ROI, where the network was extracted using the proposed approach based on PCT vesselness, is presented in. For all annotated regions, the average distance error was " d  0:7393pixel. The recommended setting used to calculate the PCT-based vesselness, can be found in (). Supplementarypresents normalized histograms of distance error values " d for all analyzed regions of interest in fungal images. Additionally, traced lines were identified as true/false Positives depending on whether a line was found in the gold standard at a distance smaller than two pixels. Precision and recall were calculated for a set of comparable approaches, and are shown in. Finally, a comparison of the network thickness estimated using optical microscope and our approach, for 10 randomly selected measurement points, is presented in Supplementary figures S5 and S6.
Runtime performanceThe average runtime spent to extract the fungal networks from the grayscale images of 1000  1000 pixels and $60 K branches (links) is 70s (without enhancement) and 200s (with PCT enhancement). This compares with manual segmentation of 3K branches in about 23 days (). The runtime performance of the implemented methods was tested on a PC with Intel Core 2 Duo (T8300) system with 2GB memory, running Linux and MATLAB R2009b.(a). The red and green squares delimit the region of interest which we have used to illustrate the performance of the method set out in. Scale bar corresponds to 2 cm such as transport efficiency, resilience, cost and control complexity.The assessment of the rate of false positive and false negative segments has been performed within an error diameter of the gold standard segments equal to 2.Bioimage informatics approach to extract fungal networks
The Author 2012. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions.com. at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
EXTRACTION OF NETWORK-LIKE STRUCTURES Recent reviews of image processing methods for network-like structure extraction can be found in Dehkordi et al. (2011). According to this review, most image analysis approaches to extract network-like structures are classified into pattern recognition, model-based, tracking, artificial intelligence and neural networks. To set the current work in context, we outline the basic method and the limitations of each approach below. 2.1 Pattern recognition Many of these methods apply thresholding and object connectivity, followed by a thinning procedure and extraction based on graph description (Kawata et al., 1995). Alternatively, the image intensity is represented as a hypersurface and the curvilinear features are extracted using curvature, with the crest points of the hyper-surface correspond to the center lines of the structure (Prinet et al., 1996). These centerlines can then be used as seeds in a region growing procedure that segments the full curvilinear structure from the images (Higgins et al., 1989). Direct segmentation of curvilinear structures can also be done by multi-resolution segmentation approaches. After segmenting salient structures at low resolution, less prominent network branches can be extracted in the neighborhood of the previously segmented regions at higher resolution (Chwialkowski et al., 1996). Curvilinear structures can also be segmented by mathematical morphology operators using specific structuring elements (Zana and Klein, 1997). 2.2 Model based Model-based approaches apply explicit curvilinear structure models, or templates, to extract the network. In network extraction applications, the template is usually represented in the form of a series of nodes connected in segments and deformed to fit the image (Summers and Bhalerao, 1995). In curvilinear or tubular object segmentation, objects are commonly described as a set of overlapping template ellipses (2D) or ellipsoids (3D) (Krissian et al., 2000). More general deformable model-based techniques find object contours using parametric curves that deform under the influence of internal and external forces (Klein et al., 1994). 2.3 Tracking Tracking-based approaches apply local operators on a specific point known to be in an object of interest and track it. Tracking approaches, starting from an initial point, detect network centerlines or boundaries by analyzing the pixels parallel and orthogonal to the tracking direction (Haris et al., 1997; Meijering et al., 2004). 2.4 Artificial intelligence and neural network-based Artificial Intelligence-based approaches use knowledge to guide the segmentation process and to delineate network structures, e.g. using a general curvilinear model (Smets et al., 1988). A disadvantage of learning methods is that they depend on the quality of the training dataset, which requires significant work and can be susceptible to problems like over-training (Nekovei and Sun, 1995). 3 ENHANCEMENT OF CURVE-LIKE STRUCTURES When the network structure is affected by variations of intensity contrast within the image, image enhancement operators can
Bioimage informatics approach to extract fungal networks at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
DISCUSSION In this article, an image analysis and processing concept for general curvilinear network detection has been introduced. The core method is based on extraction of the network centerline from a watershed segmentation, followed by a pruning procedure. This approach can be directly applied to high-contrast images, but the combination with a curvilinear feature enhancement based on Phase Congruency Tensors provides a contrast invariant solution for more challenging networks. Using the watershed transform to calculate center lines provides several advantages over other more complex networkanalysis routines. First, it guarantees calculation of connected networks. Second, it requires low computation times in comparison with other segmentation methods. By using a standard morphological watershed transformation on raw or PCTenhanced images, we obtain an oversegmented skeleton image which encompasses the entire biological network, but also a contribution of false edges associated with subtle variations in background intensity that still yield basins in the watershed image. These extraneous features can be removed post-segmentation by judicious selection of cost-function weights or reduced by prior network enhancement and noise-reduction using PCT or other image enhancement techniques described in Section 4. Visual inspection of the results (fig. 2 and Supplementary Figs. S13) confirm the robustness of the proposed approach to extract networks from complex and challenging biological specimens. In particular, the PCT-based enhancement is effective at dealing with highly variable intensity levels of the curvilinear features and is capable of providing high detection responses on low contrast edges against a noisy background (fig. 3). These properties are essential to detect structures in low contrast regions of noisy images that are common in a large number of biomedical images (Meijering et al., 2004). The results demonstrate that the proposed approach provides a fast and robust solution to detect and extract a graph representation of complex curvilinear networks and overcomes a critical bottleneck in biological network analysis. This now permits high-throughput measurements with improved resolution and precision. The approach is generic and can be applied to a wide range of biomedical images. One of the major contributors to errors is optimal threshold selection for the pruning procedure. Therefore, future work will be focused on data-driven optimizing approaches to determine optimal local or global threshold selections. Once the network has been extracted, a wide range of network parameters can be calculated (Fricker et al., 2007). As the data are embedded in Euclidean space, a number of basic morphological measures can also be readily derived. These values either have a straightforward biological meaning in their own right or they provide a comparison with network structures in other domains. In particular, the rich network structures extracted by this approach provide a rapid means to examine network features, Bioimage informatics approach to extract fungal networks
