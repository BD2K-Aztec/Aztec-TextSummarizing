Motivation: Expression quantitative trait loci (eQTL) studies have discovered thousands of genetic variants that regulate gene expression, enabling a better understanding of the functional role of non-coding sequences. However, eQTL studies are costly, requiring large sample sizes and genome-wide genotyping of each sample. In contrast, analysis of allele-specific expression (ASE) is becoming a popular approach to detect the effect of genetic variation on gene expression, even within a single individual. This is typically achieved by counting the number of RNA-seq reads matching each allele at heterozygous sites and testing the null hypothesis of a 1:1 allelic ratio. In principle, when genotype information is not readily available, it could be inferred from the RNA-seq reads directly. However, there are currently no existing methods that jointly infer genotypes and conduct ASE inference, while considering uncertainty in the genotype calls. Results: We present QuASAR, quantitative allele-specific analysis of reads, a novel statistical learning method for jointly detecting heterozygous genotypes and inferring ASE. The proposed ASE inference step takes into consideration the uncertainty in the genotype calls, while including parameters that model base-call errors in sequencing and allelic over-dispersion. We validated our method with experimental data for which high-quality genotypes are available. Results for an additional dataset with multiple replicates at different sequencing depths demonstrate that QuASAR is a powerful tool for ASE analysis when genotypes are not available.
IntroductionQuantitative trait loci (QTLs) for molecular cellular phenotypes (as defined by), such as gene expression [expression QTL (eQTL)] (e.g.), transcription factor binding () and DNase I sensitivity () have begun to provide a better understanding of how genetic variants in regulatory sequences can affect gene expression levels (see also). eQTL studies in particular have been successful at identifying genomic regions associated with gene expression in various tissues and conditions (e.g.). Although previous studies have shown an enrichment for GWAS hits among regulatory variants in lymphoblastoid cell lines (LCLs) (), a fulleQTL data are available and will represent a useful resource to functionally annotate genetic variants. However, the number of cell types and environments explored are a small subset of the presumably larger number of regulatory variants that mediate specific GxE interactions. eQTL studies are expensive, requiring large sample sizes (n > 70), which may be difficult to achieve for tissues that are obtained by surgical procedures or are difficult to culture in vitro. Even if biospecimens are readily available at no cost, eQTL studies require large amounts of experimental work to measure genotypes and gene expression levels. As the measurement of gene expression using high-throughput sequencing (RNA-seq) is becoming more popular than microarrays, RNA-seq library preparation is also becoming less expensive ($46/sample), whereas costs of sequencing are also very rapidly decreasing (e.g. 16M reads per sample would cost $49 using a multiplexing strategy). Additionally, the sequence information provided by RNA-seq can be used to call genotypes (), detect and quantify isoforms () and to measure allele-specific expression (ASE), if enough sequencing depth is available (). ASE approaches currently represent the most effective way to assay the effect of a cis-regulatory variant within a defined cellular environment, while controlling for any trans-acting modifiers of gene expression, such as the genotype at other loci (Cowper). As such, ASE studies have greater statistical power to detect genetic effects in cis than a traditional eQTL mapping approach when using a small sample size. Additionally, ASE may also be useful to detect epigenetic imprinting of gene expression if ASE is present but no eQTL is detected (). In the absence of ASE, the two alleles for a heterozygous genotype at a single-nucleotide polymorphism (SNP) in a gene transcript are represented in a 1:1 ratio of RNA-seq reads. To reject the null hypothesis and infer ASE, it is necessary to first identify heterozygous SNPs with high confidence and then conduct inference to detect a departure from a 50% allelic ratio. Although genotyping and ASE are usually considered two separate problems, miscalling a homozygous SNP as heterozygous is likely to induce an error in rejecting the ASE null hypothesis; thus, we argue that the two problems should addressed together. Although it is possible to obtain genotype information from RNA-seq (), to the best of our knowledge, all existing methods for detecting ASE consider the genotypes known and error probabilities associated with genotyping are not taken into account for the ASE step. Although overall genotyping quality can also be modeled within the ASE model (), there is currently no method that for each SNP can jointly genotype and detect allelic imbalances in high-throughput sequencing data. An approach that takes into account base-calling errors was previously proposed for detecting ASE in ESTs data (), but for RNA-seq data, it is essential to also include overdispersion. Here, we propose a novel framework for quantitative allele-specific analysis of reads (QuASAR) that starts from a single or multiple RNA-seq experiments from the same individual and can directly identify heterozygous SNPs and assess ASE accurately by taking into account base-calling errors and overdispersion in the ASE ratio. QuASAR is evaluated with two different datasets that demonstrate genotyping accuracy and the importance of incorporating the genotype uncertainty when performing ASE inference.
Materials and methods
QuASAR approachQuASAR starts with experimental high-throughput sequencing data. Here, we focus on RNA-seq, but the same or similar pipeline can be applied to DNase-seq, ChIP-seq, ATAC-seq or other types of functional genomics library preparations.illustrates the underlying problem: detecting SNPs covered by a number of transcripts with high allelic imbalance and for which homozygosity (in the presence of base-calling errors) can also be rejected. We focus our attention on sites that are known to be variable in human populations, specifically we consider all SNPs from the 1000 Genomes project (1KG) with a minor allele frequency (MAF) > 0.02. We index each SNP with l 2 f1;.. .; Lg and each sample by s 2 f1;.. .; Sg. All samples are from the same individual and may represent different experimental conditions or replicates. We only consider SNPs represented in at least 15 reads across all the samples. At each site l, three genotypes are possible g l 2 f0; 1; 2g being homozygous reference (RR), heterozygous (RA) or homozygous alternate (AA), respectively. For each sample s and site l, N s;l represents the total number of reads and r sl  fr slk g N sl k1 take the value 1 if read k matches the reference allele and 0 if it matches the alternate allele. We can then model the datawhere Pr g l  represents the prior probability associated with each genotype. The probability of the observed reads, Pr r sl jg l , depends on the genotype. For G l  0:where we will only observe reads matching the alternate allele if those are base-calling errors, here modeled by the parameter s .Conversely, for G l  2, we have the following:If the genotype is heterozygous G l  1, we observe reads from the reference allele with probability q l or the alternate allele with probability (1  q l ), resulting in the following model:Considering that R sl  X N l k1 r slk and A sl  N sl  R sl are, respectively, the number of reads from sample s observed at site l matching the reference allele and the alternate allele, the previous equations can be simplified as follows:Prwhere w q;   q1    1  q and makes explicit that homozygotes, g l  2 (or g l  0), are indistinguishable from q ls  0 (or q ls  1) when g l  1. In QuASAR, we resolve this identifiably problem by assuming that those cases with extreme ASE across all replicates are more likely to be homozygous genotypes. To fit the mixture model, we use an expectation maximization (EM) algorithm (see Section 2 for more details) in which we estimate sample-specific base-calling error rates ^ s (q is fixed to 0.5) and posterior probabilities for the genotypes. For the ASE inference step, we wish to test the null hypothesis q sl  0:5. We additionally consider that w in (57) is a random variable W sl sampled from an $Beta a sl ; b sl  distribution with:where the hyper parameter M s controls for over-dispersion and results in a better calibrated test as shown in Section 3. Combining (7) and(8) results in a beta-binomial distribution (13), which we use to model the number of reads coming from the reference allele. Formalized as a likelihood ratio test (LRT), the inference step takes into account over-dispersion and genotype uncertainty:Kwhere the set of parameters f^ s ; ^ M s g S s1 are maximum likelihood estimates under the null hypothesis q ls  0:5 (see Section 2). To calculate a P value, we use the property that 2log K sl  is asymptotically distributed as v 2 1 .
Model fitting and parameter estimationTo use the EM procedure (), we first convert (1) to a 'complete' likelihood, as if we knew the underlying genotypes G  fG l g L l1 :LH  Pr D; GjH  Pr DjG; HPr GjH where G g l 1G l  g are binary indicator variables and H represents the set of all parameters of the model. In log likelihood form we have:During the genotyping step, to maintain identifiability of the model, we fix q sl  0:5 for all loci. Although M s could also be estimated within the EM procedure, we only consider overdispersion on the ASE step. These two choices lead to a much simpler EM procedure and a slightly conservative estimate of s .(12)The prior genotype probabilities PrG l  g are obtained from the 1KG allele frequencies assuming HardyWeinberg equilibrium, but the user can change this.
E step
M stepUsing the expected values from the E step, the complete likelihood is now a function of s that is easily maximizedAfter we run QuASAR to infer genotypes across samples from the same individual, for each site we have a posterior probability of each genotype hG g l i, and a base-calling error ^ s estimated for each sample. From these posteriors, discrete genotypes are called by using the genotype with the highest posterior probability; the maximum a posteriori (MAP) estimate.
ASE inferenceTo detect ASE, we only consider sites with an heterozygous MAP higher than a given threshold (e.g. hG 1 l i > 0:99). We then test the possibility that q sl deviates from 0.5 while also taking into account overdispersion using a beta-binomial model [combining (7)and(8)]:where M s controls the effective number of samples supporting the prior belief that q  0:5 and is estimated using grid search:Pr R sl jN sl ; ^ s ; q sl  0:5; M s  (14)We estimate ^ q sl using (13) with(14) and a standard gradient method (L-BFGS-B) to maximize the log-likelihood functionFinally, all parameters are used to calculate the LRT statistic in (9) and its P value. Additionally, we can provide an estimate of the standard error associated with the parameter q sl using the second derivative of the log-likelihood function (15):Alternatively, we can also recover a standard error from(9) (as is asymptotically distributed as v 2 df 1 ), by using the P value to back solve for the standard error:where Q is the quantile function for a standard normal distribution and p ls is the P value from (9). We use the first form (16) when ^ q $ 0:5 and (17) otherwise, as each provides a better approximation at those ranges. Alternatively, if we do not need ^ r ^ q sl , we can use (15) to obtain a profile likelihood confidence interval for q sl .
Experimental dataLCLs (GM18507 and GM18508) were purchased from Coriell Cell Repository and human umbilical vein endothelial cells (HUVECs) from Lonza. LCLs were cultured and starved according to. Cryopreserved HUVECs were thawed and cultured according to the manufacturer protocol (Lonza), with the exception that 48 h prior to collection, the medium was changed to a starvation medium, composed of phenol-red free EGM-2, without hydrocortisone and supplemented with 2% charcoal stripped-FBS. Cells were washed 2X using ice cold phosphate-buffered saline, lysed on the plate, using Lysis/Binding Buffer (Ambion) and frozen at 80 C. mRNA was isolated using the Ambion
Pre-processingTo create a core set of SNPs for ASE analysis, we first removed rare (MAF < 5%) variants from all 1KG SNPs (see Supplementary Material for an analysis without this step). We also removed SNPs within 25 bases upstream or downstream of another SNP or short InDels as well as SNPs in regions of annotated copy numbers or other blacklisted regions (). Reads were aligned to the reference human genome hg19 using bwa mem (, http://bio-bwa.sourceforge.net). Reads with quality <10 and duplicate reads were removed using samtools rmdup (http://github.com/samtools/). Using a mappability filter (), we removed reads that do not map uniquely to the reference genome and to alternate genome sequences built considering all 1KG variants. Aligned reads were then piled up on the core set of SNPs using samtools mpileup command. Reads with an SNP at the beginning or at the end of the read, or with indels were also removed to avoid any potential experimental bias. Finally, the pileups were re-formatted, so that each SNP has a count for reads containing the reference allele and a count for those containing the alternate allele.
Comparison with other methodsTo assess QuASAR genotyping quality, we focused on the LCL data and compared genotype calls to those of 1KG project. We also compared QuASAR genotyping accuracy to samtools  bcftools () and GATK (). To assess QuASAR ASE inference, we used QQ plots and eQTL derived from the GEUVADIS dataset ().When we compared QuASAR ASE inference to other methods, we used our implementation of the binomial and beta-binomial test by forcing QuASAR to ignore the genotyping uncertainty in the ASE inference step; i.e. in (9) numerator we only consider q sl  0:5. For the binomial test, we further force M s  1. In the Supplementary Material, we also compared QuASAR performance to the method used in (). To make the results comparable, we used QuASAR genotype information and the same pre-processing steps described above up to samtools mpileup.
ResultsWe implemented the QuASAR approach as detailed in Section 2 in an R package available at http://github.com/piquelab/QuASAR. First, to evaluate QuASAR genotyping accuracy, we collected RNA-seq data for two LCLs that already have high-quality genotype calls from the 1KG project (GM18507 and GM18508). As illustrated in, we are able to accurately genotype thousands of loci with lower error rates than other methods commonly used for genotyping DNA-seq data. By design, QuASAR is more conservative in making heterozygous calls than homozygous calls, yet still retains a large number of heterozygous loci compared with GATK () and samtools (). In QuASAR, if there is contention between (i) an heterozygous genotype call with extreme allelic imbalance or (ii) an homozygous genotype call with base call errors, our model will favor the latter (ii). This is a crucial feature for accurate inference of ASE, which will be discussed later in more detail. As we increase the threshold on the QuASAR posterior probability of heterozygosity, we consistently reduce the genotype error rate, Supplementary Table S1.The error rates increase slightly if we include rare variants with MAF < 0.05 () and are minimally affected when 1KG allele frequencies are not used as priors (). An important feature of QuASAR is that the genotyping information is also used for the next inference step. We next sought to characterize QuASAR performance in genotyping and ASE inference from RNA-seq experiments sequenced at different depths. In total, we analyzed 18 samples (three replicates across six different time points) for an individual for which genotypes were not previously available. We combined the 18 fastq files in different ways as input for QuASAR to obtain an empirical power curve (). As expected, we observed that our ability to detect heterozygotes (MAP > 0.99) increases with the sequencing depth. At a more modest sequencing depth of 16 million, we can still detect more than 1,000 heterozygous sites. After obtaining the genotypes, we assessed whether there is evidence of ASE at any of the SNPs determined to be heterozygous. To conduct ASE inference, we used the LRT (9) statistic in QuASAR and obtained P values. We controlled the FDR using the q-value procedure (). As shown in, our ability to detect ASE greatly increased with the number of SNPs we were able to genotype, which in turn is a function of coverage (). Using 100 million reads, we detected roughly 9,000 heterozygous SNPs of which 50 have ASE at 10%FDR. To assess the calibration of the ASE test in QuASAR and to compare it to other ASE inference approaches, we used QQ plots,. A QQ plot compares the quantiles observed from a test statistic to those that are expected under a null distribution (e.g. P values are uniformly distributed between 0 and 1). The shape of the QQ-plot curve is useful to judge how well the P values are calibrated when we expect that a large number of the tests conducted are sampled from the null distribution. In this latter scenario, we expect that the QQ-plot curve would follow the 1:1 line for the range of P values with higher value. For small P values, we expect that the curve starts to depart from the 1:1 line representing the small proportion of tests that are not sampled from the null distribution. Many existing approaches for ASE use either a binomial test () or a beta-binomial test () that does not account for genotyping or base-calling error. To compare QuASAR ASE inference to these alternative. Empirical power in detecting heterozygous SNPs as a function of sequencing depth. Each point represents a single input dataset to QuASAR: either as a single experiment replicate and time point (red dot), combining multiple time points (2  green, 3  blue, 6  purple) or combining replicates (1  dot, 2  triangle). The x-axis represents the total number of RNA-seq reads in the fastq input files. The y-axis represents the log 10 of the total number of SNPs that are determined to be heterozygous QuASARapproaches, we used the RNA-seq data collected on the LCL samples and the genotype calls from QuASAR.clearly shows that the binomial test is too optimistic and will likely lead to many false discoveries. Another binomial test (Supplementary) independently implemented () show a similar behavior to our own implementation. In contrast to the binomial test, the beta-binomial model seems better calibrated but uncertainty on the genotype being a true heterozygote can lead to very small P values and false positives. QuASAR combines the beta-binomial model with uncertainty on the genotype, resulting in the most conservative approach, likely avoiding a common cause of false positives in ASE analysis. To further evaluate the differences between QuASAR and other methods, we focused on the high-coverage LCL samples. This cell type has been part of large sample eQTL studies such as GEUVADIS () including RNA-seq data for more than 600 individuals. From a recent reanalysis of the GEUVADIS dataset (), we selected genes with eQTLs (5% FDR) and a leading SNP with a high posterior inclusion probability (PIP > 0.9), as those are the nucleotides more likely to be causal (i.e. the eQTN). We hypothesized that in our data, genes for which the eQTN was heterozygote would be more likely to show evidence for ASE than those for which the eQTN was homozygote. However, transcripts with homozygous eQTNs could still show ASE, if they have additional personal/rare associations or due to an imprinting mechanism. In any of the methods we tested (Supplementary), there was a significant difference between ASE P values in the expected direction (MannWhitney U-test P < 0.02). The distribution of P values (Supplementary) for ASE signals in transcripts with homozygous eQTNs are much closer to the uniform distribution in QuASAR when compared with other methods, especially those that do not account for overdispersion. In general, the P values obtained across all methods tested are very much correlated to each other, as shown in Supplementary, but there are key differences. The methods that use a binomial test tend to have lower P values than QuASAR, which uses a beta-binomial model. Supplementaryand B show that we may observe more shrinkage for SNPs with deeper coverage. Compared with a test using the beta-binomial distribution but ignoring genotype uncertainty, our QuASAR test leads to similar P values, but SNPs with more uncertainty on being heterozygous are corrected in a higher degree toward a less significant P value (Supplementary Figs. S3C and S4C). In terms of computational complexity, QuASAR is very fast. QuASAR runtime for genotyping with the EM procedure takes less than 20 s on any of our datasets (using a computer with a 6-core 2.93-GHz Intel processor and 8-GB RAM). Each EM iteration in the genotyping step is O(LS) linear with the number of SNPs and samples, and convergence is achieved in less than 20 iterations. GATK with the default options takes a longer amount of time (about 2 h) compared with samtools and QuASAR, as the latter methods focus directly on 1KG SNPs only. Comparatively, for both our pipeline and, more time is spent in data pre-processing (roughly 10 min per sample depending on the sequencing depth and assuming reads are already aligned) than in genotyping or ASE inference.
DiscussionQuASAR is the first approach that detects genotypes and infers ASE from the same sequencing data. In this work, we focused on RNAseq, but QuASAR can be applied to other data types (ChIP-seq, DNase-seq, ATAC-seq and others). Indeed, the more experimental data available from the same individual across many experimental. QQplot comparing the P value distribution of three alternative methods for determining ASE. The x-axis shows the log 10 quantiles of the P values expected from the null distribution. The y-axis shows the log 10 quantiles of the P values computed from the real data using three different methods: (i) binomial (black) assumes M  1 no overdispersion; (ii) beta-binomial (green) considers overdispersion but does not consider uncertainty in the genotype and (iii) QuASAR (blue) uses the beta-binomial distribution and uncertainty in the genotype calls. In all three cases, the same set of SNPs is considered. The shaded area in gray indicates a 95% confidence band for the null distribution samples (data types, conditions, cell types or technical replicates), the more certainty we can gather about the genotype. A key aspect of the QuASAR ASE inference step is that it takes into account over-dispersion and genotype uncertainty resulting in a test that we have shown to be well calibrated. In many cases, the P values obtained from biased statistics can be recalibrated to the true null distribution using a permutation procedure. Unfortunately, this is not possible for ASE inference, as randomly permuting the reads assigned to each allele would inadvertently assume that the reads are distributed according to a binomial distribution. More complicated and computationally costly resampling procedures can be proposed, but it is not clear what additional assumptions may be introduced and if such methods can correctly take into account genotyping uncertainty. If prior genotype information is available, it can also be provided as input to the algorithm. The prior uncertainty of the genotypes should be reflected in the form of prior probabilities for each genotype. In this article, we have shown that we can obtain reliable genotype information from RNA-seq reads, thus making additional genotyping unnecessary if the endpoint is to detect ASE. Instead, sequencing the RNA-seq libraries at a higher depth is probably a better strategy as it greatly improves the power to detect ASE. Furthermore, as sequencing costs decrease rapidly, ASE methods are becoming very attractive in applications where eQTL studies have been previously used. This is of increased importance in scenarios where collecting a large number of samples is expensive or infeasible. Large-scale eQTL studies are still very much necessary for fine mapping, but analysis of ASE can provide unique insights into mechanisms that are uncovered only under specific experimental conditions, e.g. as a result of gene x environment interactions.
at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
C.T.Harvey et al. at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
