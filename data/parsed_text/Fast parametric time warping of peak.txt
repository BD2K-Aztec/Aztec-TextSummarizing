Alignment of peaks across samples is a difficult but unavoidable step in the data analysis for all analytical techniques containing a separation step like chromatography. Important application examples are the fields of metabolomics and proteomics. Parametric time warping (PTW) has already shown to be very useful in these fields because of the highly restricted form of the warping functions, avoiding overfitting. Here, we describe a new formulation of PTW, working on peak-picked features rather than on complete profiles. Not only does this allow for a much more smooth integration in existing pipelines, it also speeds up the (already among the fastest) algorithm by orders of magnitude. Using two publicly available datasets we show the potential of the new approach. The first set is a LC–DAD dataset of grape samples, and the second an LC–MS data-set of apple extracts. Availability and implementation: Parametric time warping of peak lists is implemented in the ptw package, version 1.9.1 and onwards, available from Github (https://github.com/rwehrens/ptw) and CRAN (http://cran.r-project.org). The package also contains a vignette, providing more theoretical details and scripts to reproduce the results below.
IntroductionHyphenated techniques, coupling a chromatographic separation step to a detector, are the norm in the analysis of complex biological samples, e.g. in proteomics and metabolomics. A common problem in all applications is that the separation, i.e. the exact time point at which a compound is measured by the detector, is not quite reproducible, hampering comparative analyses. When all measurements have been done in a single batch and peak shifts are expected to be small this is usually not a big problem, but when experimental difficulties arise during the batch, or comparisons with data from different batches or even different machines or labs need to be made, explicit retention time corrections are necessary. Several procedures have been proposed in the literature, often indicated with the label 'Time Warping' (). These transform ('warp') the time axis of a sample in such a way that the overlap with a reference signal is maximized. Parametric Time), for example, uses a polynomial transformation. This choice has several advantages: first, the allowed transformations are quite restricted, thus avoiding the common problem of overfitting (at least to some extent). Second, the use of such a polynomial warping function often describes processes like column aging quite well. Third, the explicit modeling allows for clever use of resources, like defining the warping using regularly injected quality control samples only, and interpolating to find the warping for the real experimental samples (). Here, we describe a further development in the PTW algorithm: warping is no longer based on complete profiles, such as extracted ion chromatograms in liquid chromatography mass-spectrometry (LCMS) applications, but rather on the peak-picked features. This has several important benefits. First of all, in the new approach the optimal warping is obtained by only considering the relevant, information-containing part of the signal. This increases sensitivity, and decreases the need for extensive preprocessing of the data (e.g. baseline correction). Second, the process is made faster, sometimes by orders of magnitude. Also the increase in calculation time with wider search windows for the weighted crosscorrelation(WCC) optimization criterion () is virtually eliminated.
DataWe show the possibilities of ptw using two publicly available datasets. The first is on carotenoids in grape samples (), measured using diode-array detection coupled to liquid chromatography (LCDAD). Multivariate curve resolution (MCR, de Juan and) was used to finally obtain peak lists, clustered in 14 groups according to spectral characteristics. The mean number of peaks per group varied from 4.4 to 14.6. Although these samples were analysed in a single batch, retention time differences are appreciable, due to the volatile nature of the solvent and the variable temperature conditions in the lab. The second dataset consists of LCMS measurements of 156 apple extracts, divided over seven different apple varieties. In this set, variation in retention times is appreciable, due to a leaking column which was only detected after the completion of all injections. A pooled sample was injected regularly as a quality control (QC). In total, 27 QC injections were measured. Since the apple varieties might have different metabolic compositions, leading to different peaks and peak intensities, it was decided to base the alignment on the warping functions for the QCs only, taking the first QC sample as the reference sample and calculating warping functions for the other 26 QCs. The alignment for the individual apple samples was then obtained by interpolation. This strategy is applicable in all cases where samples with potentially different compositions are compared (e.g. treatmentcontrol experiments). In contrast to the grape data, the raw data for the apple LCMS samples do not consist of continuous profiles over time, but rather of a sequence of mass spectra. It is possible to convert these into equispaced m/z bins, leading to a profile matrix in whose rows a profile-based alignment can be performed. A selection of bins containing relevant signals is usually advised (). In virtually all cases, the data are further processed by software like XCMS () to obtain peak lists for statistical analysis or metabolic network construction. Hence, doing retention time correction on the peaks does not constitute extra work. Both datasets are publicly available from the Metabolights repository (http://www.ebi.ac.uk/metabolights) with identifiers MTBLS85 and MTBLS99, respectively.
ResultsIn all cases in this paper, quadratic warping functions are chosen. The grape DAD data are sufficiently small to be able to zoom in and assess the individual warping functions, yet big enough to present a challenge for the algorithm and to show the type of speed improvements that are possible. Indeed, warping the peaks rather than the profiles led to a decrease in computation time of almost an order of magnitude, whereas the results were identical for all practical purposes. Not only do the warping functions in both scenarios look very similar, also warping the peaks with the warping functions obtained from the continuous profiles leads to virtually the same values for the WCC optimization criterion: 0.164 against 0.170 (on a scale of 01). Aligning the QC samples of the apple data using the new, peakbased PTW algorithm, leads to 26 warping functions, one for every non-reference QC. Interpolating the warping functions for the true apple samples on the basis of injection sequence leads to corrected peak positions for all peaks. Using the same warpings for the TICs, one can visualize the result more easily; this is shown in. The top panel shows the TICs of the uncorrected apple samples, arranged per variety in order of injection (bottom to top). The effect of the leaking column is clearly visible: retention times tend to get much larger later in the injection sequence. In contrast, the corrected TICs shown in the bottom panel only show minor retention time variations, that are largely random in nature. These can typically be handled by the alignment methods available in the data processing softwarethe bigger shifts caused by, in this case, faulty equipment, usually cannot. In cases where a quadratic warping as used here is not sufficient to align the features, one can try higher-order warping functions. The strategy of obtaining warping coefficients using pooled QC samples also provides a structural solution to a common problem in metabolomics: when comparing two very different groups of samples, the number of common features may be too small, or too much concentrated in one part of the chromatograms, to obtain useable alignments (). With technical replicates like the pooled QC samples used here, this problem is eliminated.
ConclusionTime warping using peak lists, as described here, brings the alignment of large numbers of complex samples into the realm of the practically feasible. Instrument breakdown, for example, no longer necessarily forces samples to be remeasured, which is especially important when only small quantities of samples are available.Databases of standards, used for annotation and typically containing only information on peaks and not on raw data, can be used for alignment as well, thereby considerably increasing their usefulness. Conflict of Interest: none declared.
at University of California, Los Angeles on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
R.Wehrens et al. at University of California, Los Angeles on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
