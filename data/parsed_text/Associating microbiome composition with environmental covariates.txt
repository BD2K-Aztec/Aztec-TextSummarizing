
INTRODUCTIONUnderstanding the compositional differences of microbial communities (microbiomes) is essential in microbial ecology. With the development of next-generation sequencing technologies, * To whom correspondence should be addressed. microbiome composition can now be determined by direct DNA sequencing without the need for laborious cultivation (). There has been a great interest in human microbiome studies in different body sites, ranging from skin () to gut () and respiratory tract (). Important insights have been gained from analysis of large-scale human microbiome data, including the discovery of enterotypes () and discovery of the link between diet and these enterotypes (). Although the metagenomic shotgun approach is potentially more powerful and unbiased, 16S rRNA gene targeted sequencing is routinely performed to determine the taxonomic composition. The generated 16S rRNA sequence tags are usually clustered into operational taxonomic units (OTUs) with a specified amount of variability allowed within each OTU (). At 97% similarity, these OTUs represent 'species'. Downstream analysis is then performed on the OTU abundance data. Two central themes in human microbiome studies are to identify potential biological and environmental factors that are associated with microbiome composition, and to define the relationship between microbiome features and biological or clinical outcomes. The goal is to provide a better understanding of the factors that shape our microbiome and, potentially, contribute to the development of new therapeutic strategies to modulate the microbiome composition and affect human health (). Testing the association of microbiome composition with potential environmental factors using OTU abundances directly is difficult due to high dimensionality, non-normality and phylogenetic structure of the OTU data. Instead, distance-based non-parametric testing, in which a distance measure is defined-between any two microbiome samples, is usually used to achieve this goal (). The power of the distance-based test depends on a proper choice of the distance measure. Numerous distance measures have been proposed to compare microbial communities (). Phylogenetic distance measures, which account for the phylogenetic relationship among the species, provide far more power because they exploit the degree of divergence between different sequences. Among these, the UniFrac distances are the most popular ones (Copyedited by:MANUSCRIPT CATEGORY: ORIGINAL PAPER
Generalized UniFracKnight,). There are two versions of UniFrac distances: an unweighted UniFrac distance that considers only species presence and absence information and counts the fraction of branch length unique to either community, and a weighted UniFrac distance that uses species abundance information and weights the branch length with abundance difference. Unweighted UniFrac distance is most efficient in detecting abundance change in rare lineages. When the abundance of a rare lineage falls below a certain threshold, the sequencing machine may not be able to pick it up and it will appear absent in the final dataset. On the other hand, weighted UniFrac distance is most sensitive to detect change in abundant lineages since it uses absolute abundance difference in its definition. However, unweighted/weighted UniFrac distances may not be very powerful in detecting change in moderately abundant lineages. Recently, a variance-adjusted weighted UniFrac distance (VAW-UniFrac), which moderates the branch proportion difference by its variance, was developed to account for the fact that weighted UniFrac distance does not consider the variation of the weights under random sampling (). VAW-UniFrac was shown to increase the power over weighted UniFrac distance for detecting the difference between two microbial communities. In this article, we introduce generalized UniFrac distances that unify weighted UniFrac and unweighted UniFrac distances. The new generalized UniFrac distances cover a series of distances ranging from weighted to unweighted UniFrac by adjusting the weight on the branches. The generalized UniFrac distances are designed to provide a robust and powerful tool for detecting a wider range of biologically relevant changes in microbiome composition. We conduct extensive Monte Carlo simulation studies under various conditions to evaluate their power in detecting environmental influence on microbiome composition using PERMANOVA (), a distancebased non-parametric test. Although each distance in the series can perform the best in certain scenarios, none has the optimal performance under all conditions considered. However, analyses based on the generalized UniFrac distances are shown to be more robust and has overall the best performances across a range of possible scenarios. We demonstrate the power gain of using this distance in detecting the microbiome differences by analysis of two real human gut microbiome datasets related to linking human gut microbiome composition to long-term diet () and testing upper respiratory tract microbiome difference between smokers and non-smokers ().
METHODS
Generalized UniFrac distances between two microbial communitiesConsider two microbiome communities A and B and suppose that we have a rooted phylogenetic tree with n branches. Let b i be the length of the branch i and p A i and p B i are the taxa proportions descending from the branch i for community A and B, respectively. The unique fraction metric, or UniFrac, measures the phylogenetic distance between sets of taxa in a phylogenetic tree as the fraction of the branch length of the tree that leads to descendants from either one environment or the other, but not both. The original definition refers to unweighted UniFrac (), which is mathematically defined asis the indicator function and only presence/absence of species of branch i, I(p A i > 0) and I(p B i > 0), are used in the definition. The distance definition d U completely ignores the taxa abundance information. In contrast, the (normalized) weighted UniFrac distance () weights the branch length with abundance difference and is defined asNote that d W cannot be reduced to d U even if we convert abundance data into presence/absence data. Also note that d W uses the absolute proportion difference p A i p B i in its formulation. The consequence of using the absolute difference is that the value of d W is determined mainly by branches with large proportions and is less sensitive to the abundance changes on the branches with small proportions. To attenuate the weight on branches with large proportions, we may instead use the relative difference() in the formulation. We denote this distance measure aswhere n i=1 b i in the denominator is the normalizing factor so that d (0) . Now if we dichotomize the abundance data using the indication function I(.), d (0) is reduced to d U. So d (0) can be seen as the 'weighted version' of d U. Using the relative differences, we place equal emphasis on every branch and the distance is not dominated by the branches with large proportions, since the relative difference does not depend on the magnitude of p A i ,p B i. However, the low-abundance branches may be more noisy and the relative difference may amplify such noises. To strike a balance between relative difference and absolute difference, we weight the branch length both by the relative difference and its importance indicated by the branch proportion. We propose the following generalized UniFrac distanceswhere  controls the contribution from high-abundance branches, and n i=1 b i (p A i +p B i )  is the normalizing factor so that d () . Branches with zero proportions for both communities will not be included in the calculation. As  changes from 0 to 1, more emphasis is placed on highabundance branches. When  = 1, d () is reduced to d W. When  = 0, we get d (0) defined above. Therefore, by varying  from 1 to 0 , we achieve a series of distances ranging from d W to d (0). Note that d U is obtained by dichotomizing the abundance in d (0) , but is different from d (0). We are particularly interested in d (0.5) , the distance in the middle of the distance seriesWe also compare d W ,d (0.5) ,d (0) and d U with VAW-UniFrac distance d VAW (), which is defined as:,
J.Chen et al.where m i is the total number of individuals/reads from both communities on the ith branch and m is total number of individuals/reads.
Statistical test based on UniFrac distancesWe study the power of generalized UniFrac distances using the distancebased non-parametric test for association of microbiome composition with environmental covariates. Suppose we have a set of m environmental covariates. We assume that we have collected microbiome data and the mdimensional covariates data X on n samples. We apply the PERMANOVA procedure (McArdle, 2001) [Permutational Multivariate Analysis of Variance Using Distance Matrices, 'adonis'function from R package 'vegan'(, which partitions the distance matrix among sources of variation, fits linear models to distance matrices and uses a permutation test with pseudo-F ratios to obtain the P-values. The pseudo-F statistic is defined aswhere tr(.) is the trace function of a matrix,control the familywise Type I error rate, a more powerful approach is to take the maximum of pseudo-F statistics for d U and d W as a new test statistic. The significance of the pseudo-F statistics is assessed based on permutations.
Simulation strategiesWe use two simulation strategies to evaluate the power of the generalized UniFrac distances under various conditions. The first strategy is a modification of the simulation method proposed by, where we draw points (16S rRNA sequences) from a 2D circle with known densities (). This strategy facilitates simulations of different community characteristics such as species evenness and species richness. The Euclidean distance between points is analogous of the genetic distance between the sequences. The diameter of the circle represents the maximum genetic divergence between any pair of sequences within a sample. The area of the circle is proportional to the richness and the density distribution of the circle is proportional to the evenness. By varying the centroid positions (o) and their radius (r), it is possible to vary the fraction of shared membership and species richness within each sample (). By varying the point distribution on the circle (density proportional to r  , where  controls the degree of evenness and  = 0.5 for uniformly distribution), it is possible to change the species evenness (). We also simulate scenarios where lineages of different abundance levels change by a k fold (G). These are achieved by simulating the community with point mass concentrated at the circle center (r 1.0 ) and varying the point density in different regions of the 2D circle corresponding to abundant lineages (00.2r from the center;), moderately abundant lineages (0.4r0.8r from the center;) and rare lineages (0.8r1.0r from the center;). We further bin the sampled points into small hexagons as 'OTU's before calculating the UniFrac distance ['hexbin' function from the R package 'hexbin' (. The phylogenetic tree of these 'OTU's is built using NJ algorithm (Neighbor Joining, 'nj'function in R) and rooted by midpoint rooting method. Generalized UniFrac distances are then calculated based on the NJ tree and 'OTU' abundances. Each replication consists of drawing 400 points from each community, a bin size of 0.015 units to form 'OTUs' (300 OTUs per sample), and the maximum distance between any two points is 0.3 units (r = 0.15), corresponding to typical phylum level divergence of 30% for 16S rRNA gene. These conditions allow us to simulate the sampling intensity and biodiversity found within a typical 16S rRNA gene targeted sequencing experiment (). The second set of simulations utilize a real upper respiratory tract microbiome dataset consisting of 60 samples and 856 OTUs from Charlson et al. (2010) (). A common way of modeling multivariate count data is to use the multinomial model. However, the multinomial model assumes fixed underlying proportions for each sample, which do not hold for real microbiome data due to high degree of heterogeneity among the samples. The real OTU count distribution (Supplementary) exhibits more variance than expected from a multinomial model (Supplementary). To realistically simulate the data, it is important to model extravariation or overdispersion of the OTU counts. This can be achieved by using the Dirichlet-multinomial (DM) model (), which assumes the underlying proportions of the multinomial model come from a Dirichlet distribution. The density function of a DM random variable N is given aswhere n = j n j is total count, k is the OTU number and proportion meanand dispersion  are parameters. When  = 0, it is reduced to multinomial model. We estimate the DM parameters , using maximum likelihood method ('dirmult' function from R package 'dirmult'). We then generate OTU counts using the DM model with the estimated parameters and 1000 counts per sample. Supplementaryshows an OTU heatmap generated by the DM model, in which the overdispersion is similar to that of the real data. To study the power of UniFrac variants for identifying potential environmental factors, we let the abundance of a certain OTU cluster change in response to environment. We use the UPGMA tree of the OTUs based on the OTU distance matrix calculated under the K80 nucleotide substitution model (), QIIME () and partition the 856 OTUs into 20 clusters using Partitioning Around Medoids (PAM) ('pam' function from R package 'cluster') based on patristic distances (the length of the shortest path linking two OTUs on the tree). These OTU clusters are highlighted in different colors in. We call the first strategy 2D circle-based simulation and the second treebased simulation. For power calculation, we use 2000 replications.
RESULTS
Comparison of the power of different UniFrac variants using 2D circle-based simulationsWe use PERMANOVA to test for environmental effect and compare the power ofSpecifically, we simulate two environmental conditions (e.g. smoking versus non-smoking) under which we draw 10 samples each. We then vary the degree of community difference under these two conditions and produce the power curve over a grid of 10 for each UniFrac distance. We investigate six scenarios, where the environmental factor affects the community membership, species evenness, species richness, most abundant lineages moderately abundant lineages and rare lineages (G). For each scenario, we vary one community characteristic (SupplementaryThe microbial community is represented by a 2D circle. Points are drawn from the circle to simulate the 16S-based sampling process. These points are further binned into small hexagons as OTUs. UPGMA or NJ method is used to build the OTU phylogenetic tree. Six scenarios are investigated, where the difference occurs in: community membership (B), evenness (C), richness (D), most abundant lineages (E), moderately abundant lineages (F) and rare lineages (G). The affected lineages are indicated by a red circle or ring. H, tree-based simulation of microbial communities based on the phylogenetic tree and DM model. A real OTU phylogenetic tree from a throat microbial community dataset is used. These OTUs are roughly divided into 20 clusters (lineages) by performing PAM method using the OTU patristic distance matrix. Each cluster is subjected to abundance change in response to the environment. Counts are generated from a DM model. characteristic value x ij  Uniform(x j s,x j +s) for i = 1...10 and j = 1,2, where s controls the variation within each condition and takes different values for different scenarios (see Supplementary). Each community is sampled once. Initially, we let x 1 = x 2 (no difference) and then increase the difference between x 1 and x 2 to simulate stronger environmental effect. PERMANOVA is then performed on the distance matrices and the power curve is created over a grid of 10 using Type I error  = 0.05.showsis the most powerful for detecting change in moderately abundant lineages (Panel 5). They are also the most robust among the distances investigated: its power is close to the best UniFrac distance under all scenarios. The performance of d (0) lies between d (0.5) and d U and is also very robust. Finally, under the 2D circle simulations, the performance of d VAW is almost identical to that of d (0.5). In the above simulations, we use a bin size of 0.015 to form 'OTU's (300 OTUs per sample). To study the effect of bin size, we compare the power curves of the generalized UniFrac distances using a smaller bin size of 0.01 (700 OTUs per sample) or a larger bin size of 0.03 (80 OTUs per sample). The bin size does not change the general conclusion (Supplementary). To study the effect of tree construction methods, we also construct thephylogenetic tree using UPGMA. The general conclusions still hold (Supplementary).
Generalized UniFrac
Comparison of the power of different UniFrac variants using tree-based simulationsWe also compare the power of different UniFrac distances for detecting environmental effect using tree-based simulations that mimic the throat microbiome data (see Section 3.4 for details). A recently proposed variance adjusted UniFrac distance (d VAW ) () is also compared in this setting. d VAW was developed to moderate the branch proportion difference by its variance and was shown to increase the power of detecting the difference between two microbial communities. We use the phylogenetic tree of the 856 OTUs from the throat microbiome dataset and divide them into 20 clusters (). The mean OTU proportions and the dispersion parameter are estimated from the real data by fitting a DM model. We assume that the environmental factor causes an increase of the abundance of a particular OTU cluster. Specifically, suppose that the proportion of the ith OTU cluster under Condition 1 is p i. For Condition 2, the proportion of ith OTU cluster is increased by k fold where k varies from 1 (no difference) to 1/  p i (strong effect) on a grid of 10. The proportion vector is re-normalized to sum to 1. Next, 10 samples are simulated for each condition with their OTU counts generated by the DM model with the corresponding proportion vector and the common dispersion parameter. As expected, the five UniFrac distances differ in their power for detecting environmental effect for the 20 OTU clusters tested. Except for d (0) , all the UniFrac distances have their best-performance scenarios. d W , d (0.5) , d U and d VAW achieve the highest power in seven, six, three and one cases, respectively. For the remaining three cases, d W and d (0.5) are equally the most powerful (Supplementary). The results are consistent with the 2D circle-based simulation: d W is most powerful in detecting the environmental effect on most abundant lineages, d (0.5) is most powerful for moderately abundant lineages and d U is most powerful for rare lineages. In contrast, performance of the test with d (0) and d VAW is generally between d U and d (0.5). The power of d W and d U has a reciprocal relationship and neither of them is as robust as d (0.5) .shows the power curves of four representative cases. As the proportion of the affected cluster decreases from 19.7% to 0.9%, d W becomes less powerful and the power of d U has the opposite trend. In the simulations presented above, the power is calculated assuming the affected cluster is known. Since the affected cluster can be abundant or rare, we randomly choose an affected OTU cluster in each replication and calculate the power over 2000 replications. We also report the power for the test combining d W and d U by taking the maximum of their pseudo-F statistics. We denote this method as d MAX .(left plot) shows that d U has the lowest overall power and d (0.5) and d MAX have the best power, indicating combining d U and d W can lead to power gain. In contrast, the power of d (0) , d VAW and d W is in between. As the environmental effect becomes stronger, d (0) becomes as powerful as d (0.5) and d MAX. Finally, we assume that the environmental factor affects a random set of 40 OTUs instead of a random OTU cluster. At this extreme where the phylogenetic relationship is no longer important, d (0.5) has even higher power than the other distances, followed byVAW (see, right plot). Overall, d (0.5) has a better power than other UniFrac distances including the one that combines d W and d U .
Results from analysis of a dataset linking long-term diet to gut microbiome compositionDiet strongly affects the human health, partly by modulating gut microbiome composition.studied the habitual diet effect on the human gut microbiome, where the diet information was converted into a vector of micro-nutrient intakes. A total of 98 healthy volunteers were enrolled in this cross-sectional study. Habitual long-term diet information was collected using food frequency questionnaire (FFQ). The questionnaires were converted to intake amounts of 214 micro-nutrients. Nutrient intake was further normalized using the residual method to standardize for caloric intake. Stool samples were collected and DNA samples were analyzed by 454/Roche pyrosequencing of 16S rRNA gene segments of the V1-V2 region. The pyrosequences were denoised () prior to taxonomic assignment yielding an average of 92653864(SD) reads per sample. The denoised sequences were then analyzed by the QIIME pipeline (
Generalized UniFrac
ABimpact on the gut microbiome composition. We use PERMANOVA to test for association of microbiome composition with nutrient intake based on different UniFrac distance matrices. We compare d (0.5) with d U , d W , their combination d MAX and d VAW. We plot the number of selected nutrients against different P-value cutoffs to create a ROC-like curve (). For P < 0.01, all distances except the d U identify the same number of nutrients. For P > 0.03, the curve for d (0.5) is above all the other four curves. Wilcoxon signed-rank tests show that d (0.5) results in smaller P-values than other distances (P < 0.05), indicating that d (0.5) is most powerful in selecting the relevant microbiome-associated nutrients. Using d W or d U alone could miss important associations when the nominal P-value of 0.030.05 is used. Although using a relatively large nominal Pvalue can certainly lead to inclusion of possible false-positive nutrient-microbiome associations, there are situations when one might want to include all possible associations for further validation or replications. d VAW performs the second best. Interestingly, d MAX ,
Results from analysis of a throat microbiome dataset of smokers and non-smokersCigarette smokers have an increased risk of multiple diseases, including upper respiratory tract infections. Previous studies had linked smoking to specific respiratory tract bacteria, but the consequences of smoking for global airway microbial community composition had not been fully clarified., investigated the smoking effect on the oropharyngeal and nasopharyngeal bacterial communities using 454 pyrosequencing of 16S sequence tags. Specifically, a total of 291 swab samples from the right and left nasopharynx and oropharynx of 29 smoking and 33 non-smoking healthy asymptomatic adults were collected. The variable region 1-2 (V1-V2) of the bacterial 16S rRNA gene was PCR-amplified using individually barcoded primer and subject to multiplexed pryosequencing. The pyrosequences were denoised () prior to taxonomic assignment and yielded an average of 1335603(SD) reads per airway sample. The denoised sequences were then analyzed using the QIIME pipeline () with default parameter setting. We use the left oropharyngeal samples in this study. After removing two samples with read number < 500 and discarding singleton OTUs, i.e OTU with only one read, we finally have an OTU table of 60 samples (28 smokers versus 32 non-smokers) and 856 OTUs. We test the smoking effect on the throat microbial community composition by applying PERMANOVA (10000 permutations). All the five UniFrac distances achieve statistical significance at  = 0.05 level, indicating smoking alters the community composition. However, test using d (0.5) produces the smallest P-value of 0.006, followed by 0.008 from d (0). The P-values based on d W , d U and d VAW are 0.012, 0.019 and 0.043, respectively. We also perform a principle coordinate analysis using the distance matrices and plot the samples on the first two principle coordinates (). The distance d (0.5) separates the samples better than the otherThe ellipse center indicates groups means, its main axis corresponds to the first two principle components from principle component analysis and the height and width are variances on that direction. three distance measures. This indicates that smoking might affect not only the predominant lineages but also these less abundant lineages in the throat microbial community. We then perform Wilcoxon rank-sum or Fisher's exact test to select the differential OTUs. At  = 0.05 level, we identify 32 OTUs. These OTUs belong to genera Prevotella (8), Lachnospiraceae (5), Veillonella(1) and four genera from Actinobacteria. Most of the selected OTUs are moderately abundant or rare, so we expect d (0.5) and d (0) to have better power.
DISCUSSIONMicrobiome data are multivariate count data in their original form and are statistically challenging to analyze due to their high dimensionality, phylogenetic constraints among species/OTUs, overdispersion and excessive zeros. To circumvent the difficulty, the data are often summarized in the form of distance matrix. Testing association of microbiome composition with environmental covariates is performed using the distance matrix. We have demonstrated in simulations that the weighted and unweighted UniFrac impose large weight either to abundant lineages or to rare lineages; they can be underpowered in detecting change in moderately abundant lineages. Since microbiome composition change could occur in any lineages, our generalized UniFrac distances, which unify the weighted and unweighted UniFrac in a common framework, enable us to detect a much wider range of biologically relevant changes. Our simulation studies have clearly demonstrated that the generalized UniFrac distance d (0.5) is more robust than d W or d U , and its performances are in general comparable to the best UniFrac distances among the scenarios we considered. In addition, the generalized UniFrac distances are very robust to tree constructing methods. We suggest the use of d (0.5) for testing association of microbiome composition with environmental covariates to avoid missing important findings. Both weighted and unweighted UniFrac distances are sensitive to sampling depth (). Inflated distances at a low sampling depth are caused by sampling variation especially for the rare lineages. The generalized UniFrac distances are also sensitive to sampling depth (Supplementary). However, as the sampling depth increases, the distance stabilizes. For the gut microbiome dataset, we found a sequencing depth of 1000 reads is sufficient to stabilize the generalized UniFrac distances. To overcome the potential adverse effects of uneven sampling, rarefaction is usually used to subsample the samples to the same depth. However, when the sampling depth varies greatly across the samples, rarefaction throws away a significant portion of the 16S reads and increases the sampling variation. We found that rarefaction is not necessary, at least, in the context of testing the association of the microbiome composition with covariates (Supplementary). The power of UniFrac variants can also be compared in the context of testing whether two microbial communities differ significantly as in (). Instead of comparing power for detecting the difference between two communities, we focus our evaluations on the performance of UniFrac distances for associating microbiome composition to environmental covariates by collecting multiple independent samples. The rational is that as the sequence depth increases, two sample comparison will have increased power to detect differences due to sources that we are not interested in (random noises), such as the individual-to-individual variability, day-to-day variability, sampling location variability or even technical variability (e.g. sample preparation). Multiple samples from a population coupled with multivariate statistical methods such as the distance-based PERMANOVA provide powerful design and analysis methods to overcome these potential random noises (). As more and more large-scale microbiome datasets are being collected, we expect that our generalized UniFrac distances can help to identify important covariates that are associated with the microbiomes that could be missed using the commonly used UniFrac distances. In addition to identifying environmental covariates that may be determinants of microbiome composition, our approach would be equally suited to identifying microbiome features associated with biological or clinical outcomes, which is needed to begin to understand the impact of the microbiome on health.
The Author 2012. Published by Oxford University Press. All rights reserved. For Permissions, please email: journals.permissions@oup.com at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
