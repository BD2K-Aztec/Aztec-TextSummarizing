Motivation: Multiply correlated datasets have become increasingly common in genome-wide location analysis of regulatory proteins and epigenetic modifications. Their correlation can be directly incorporated into a statistical model to capture underlying biological interactions , but such modeling quickly becomes computationally intractable. Results: We present sparsely correlated hidden Markov models (scHMM), a novel method for performing simultaneous hidden Markov model (HMM) inference for multiple genomic datasets. In scHMM, a single HMM is assumed for each series, but the transition probability in each series depends on not only its own hidden states but also the hidden states of other related series. For each series, scHMM uses penalized regression to select a subset of the other data series and estimate their effects on the odds of each transition in the given series. Following this, hidden states are inferred using a standard forward–backward algorithm, with the transition probabilities adjusted by the model at each position, which helps retain the order of computation close to fitting independent HMMs (iHMM). Hence, scHMM is a collection of interdependent non-homogeneous HMMs, capable of giving a close approximation to a fully multivariate HMM fit. A simulation study shows that scHMM achieves comparable sensitivity to the multivariate HMM fit at a much lower computational cost. The method was demonstrated in the joint analysis of 39 histone modifications , CTCF and RNA polymerase II in human CD4þ T cells. scHMM reported fewer high-confidence regions than iHMM in this dataset, but scHMM could recover previously characterized histone modifications in relevant genomic regions better than iHMM. In addition, the resulting combinatorial patterns from scHMM could be better mapped to the 51 states reported by the multivariate HMM method of Ernst and Kellis. Availability: The scHMM package can be freely downloaded from http://sourceforge.net/p/schmm/ and is recommended for use in a linux environment.
INTRODUCTIONThe hidden Markov model (HMM) is an important tool for learning probabilistic models of sequential data with a local correlation pattern, as exemplified in many engineering applications such as speech and handwriting recognition (). In an HMM, it is assumed that the system has a series of unobserved (hidden) states following a Markov process. The observed data are considered as output from the hidden states and follow specific distributions. In recent years, HMMs have been successfully applied to many problems in computational molecular biology () and statistical genetics (). In these applications, they were used to model spatial patterns such as genomic features on the chromosomes, similar to temporal patterns in time series data. HMM analysis is already common in genome-wide location studies. For example, the chromatin immunoprecipitation (ChIP) protocol, coupled with microarray (ChIP-chip) () or next generation sequencing (ChIP-seq) (), is a method of choice for identifying genomic loci enriched with various histone modification marks. In ChIP-seq data, sequence reads are aligned to the target genome and data are summarized by counting the aligned reads in non-overlapping contiguous windows (e.g. 200 bp windows). Because data manifest a clear spatial correlation, an HMM is frequently used to infer the binding status of each window (), where the hidden state space consists of binding state and background state. With the declining experimental cost, it has become increasingly common for genome-wide location analysis to be conducted on multiple regulatory proteins or epigenetic marks (). Because many factors interact with each other to carry out biological processes, it is of great interest to understand the correlation among these factors as reflected in the shared binding sites or modification marks. In the context of HMM analysis with two hidden *To whom correspondence should be addressed.  The Author 2013. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions.com states in each series, one can formulate N separate HMMs by assuming independence between every pair of series, as illustrated in(referred to as iHMM hereafter). Alternatively, one can formulate a single HMM with 2 N hidden states (, referred to as fullHMM), where 2 N is the number of hidden states when there are two states in each series. They represent two opposite extremes in the sense that iHMM completely ignores the correlation between series, whereas fullHMM incorporates the correlation in the multivariate model for the hidden states. Both approaches have advantages and shortcomings: iHMM may feature low statistical power, but it is computationally efficient. In contrast, fullHMM embodies the correlation directly; however, not all hidden state combinations necessarily appear in the data and it is computationally expensive, if not intractable. Practically, however, estimation of an HMM with 2 N hidden states is computationally intractable when N is large because 4 N possible transitions need to be followed. Here we present a novel statistical model that represents a compromise of these two, termed sparsely correlated HMM (scHMM). The scHMM approach captures a small subset of non-ignorable correlations among data series to avoid modeling all pairwise correlations. This sparsity property is achieved by adopting a regularization regression strategy.illustrates our proposed method. The dashed-line arrows connecting the hidden states between series indicate the significant correlations captured by scHMM. For example, the hidden states at windows t  1 and t in the first series, but not the third, are used to estimate the transition probability between windows t  1 and t in the second series, and vice versa. Under this framework, there is no need to consider combinations of hidden states across all series (as N-tuples) as in fullHMM, and hidden states can be inferred considering just four types of transitions in each series separately (solid lines). The scHMM algorithm is able to take advantage of the interactions between correlated series to improve the inference of hidden states. Moreover, we also reduce the computational cost by iterating through N series and inferring the hidden state vectors one series a time, conditioning on the current hidden state vector estimates of all other series. Note that the goal of scHMM is different from that of the multivariate HMM method developed byfor the analysis of combinatorial patterns of histone modification using ChIP-seq data. scHMM aims to infer the hidden states in the multiple chains simultaneously, whereas the multivariate HMM attempts to identify a small subset of representative combinatorial patterns and annotate the genome with respect to such patterns. Nevertheless, the ChIP-enriched windows identified by scHMM can be used to facilitate the multivariate HMM analysis, potentially improving the quality of genomic annotation.
METHODS
OverviewSuppose that data have been collected from multiple genomewide experiments that are related to each other, for example, DNA-binding proteins that are part of a protein complex, or the same DNA-binding proteins profiled under different treatment conditions or different cell lines. Each experiment yields a data series measured across the genome. Assume that there are N series, denoted by O  fO j, t g for t  1,. .. , T and j  1,. .. , N, where O j, t denotes the observed datum (emission) at window t. The observed data O are associated with binary hidden states H  fh j, t g indicating the status of either true binding site (state 1) or background site (state 0). We also use O t and h t to denote the observed data and hidden states, respectively, at window t across all series. The goal of HMM analysis is the estimation of H. As mentioned above, iHMM is a straightforward approach where each series j has an independent HMM with the two states. Standard HMM for a single data series has three components: (i) the probability mass function of the first window h j0  1; (ii) the transition kernel K j , K j  1  p j p j 1  q j q j where p j  h j, t  1jh j, t1  0 q j  h j, t  1jh j, t1  1,Given the three components, the forwardbackward algorithm can be applied to infer the hidden states quickly (). Although iHMM is fast and straightforward, it is unable to capture the correlation between related data series. This correlation can be explicitly incorporated in the model to increase statistical power and remove noise. The most intuitive approach is fullHMM, a single HMM with 2 N hidden state combinations and 2 N  2 N transition kernel K. The likelihood of fullHMM isHere we assume that the emission is independent of the hidden states in other series, i.e. O jt jh t   O jt jh jt  for all j and t. Similar to iHMM, the forwardbackward algorithm can be applied to infer the hidden states as well.
Sparsely correlated hidden Markov modelsAlthough fullHMM accounts for the Markovian dynamics between hidden state combinations, not all combinations necessarily occur in the data and, more importantly, the order of computation for the forwardbackward algorithm is OT  4 N  as opposed to ON  4T in iHMM. This clearly limits the applicability of fullHMM to cases with small or moderate N. When the goal of analysis is inference of hidden states in each series, fullHMM will be computationally inefficient. This motivated us to develop scHMM, a compromise between the two methods. In the scHMM algorithm, we allow different series to be correlated as in fullHMM. At the same time, we apply two strategies, which reduce the computational cost to a level similar to that of iHMM. First, instead of considering all series simultaneously, we iteratively infer parameters by cycling through each series individually. For each individual series, inference is performed conditioning on the current hidden state vectors in all other series. Second, in each series, we assume sparsity when incorporating correlations between the current series and all other series. The correlation imposed is of the form of an inhomogeneous transition kernel. To be specific, we denote the transition kernel of scHMM for series j at window t by K j t  1  p jt p jt 1  q jt q jt , which has an additional index (t) because the transition probability varies by window t. Here, we define p jt and q jt to incorporate the input from other series as follows:That is, the transition probability in series j is adjusted by the hidden states in other series fl : l 6  jg. Here we consider two logistic regression models in each data series:where Equations (2) and (3) hold on windows ft : h j, t1 50:5g and ft : h j, t1 ! 0:5g, respectively. In the equations, the superscripts p and c indicate 'previous' and 'current' windows, respectively. In this setup, each regression coefficient carries a straightforward interpretation. For example, the intercept term p j0 is the baseline log odds for 0 ! 1 transition in series j when all other correlated series are in the background state (state 0) at windows t  1 and t. p jk and c jk are the increase in the log odds of 0 ! 1 transition in series j when previous and current windows are in binding/modification state (state 1) in series k (k 6  j), respectively. In the current form, however, the number of regression coefficients will keep growing as more series are incorporated in the analysis. To address this concern, we impose a sparsity constraint using a LASSO penalty () such that X k6 j j p jk j  j c jk j and X k6 j j p jk j  j c jk jThe details of the estimation procedure, including the coordinate descent algorithm by, are provided in the Supplementary Information. Lastly, because our major application of interest is read count data from ChIP-seq experiments, we used a flexible class of distributions for emission, including zero-inflated mixture model for the background sites (state 0) and generalized Poisson distribution for the binding/modification sites (state 1). These distributions were previously used in the HPeak software (). We remark that the computational time of scHMM is significantly less than that of fullHMM. To see this, note that there are two elements in the total computation time of scHMM: one for inferring hidden states and the other for learning the regression coefficients. For the former, the complexity is no more than ON  4T, where is the additional time to compute the odds using 2N  1 hidden state predictors at each transition, which should be trivial unless N is very large ( should be close to 1). For the latter, the computational complexity is the time it takes to fit 2N logistic regression models with LASSO penalty in datasets with 2N  1 covariates and T data points, and thus this can be time-consuming in large datasets (large T) like genome-wide ChIP-seq data, and thus we randomly sample genomic regions of a sufficient size (as shown in section 4.1) and fit the model using the subset to save time. Therefore, the computation should be much more efficient than fullHMM.
SIMULATION STUDIESTo evaluate the performance of scHMM, we conducted simulation studies. Because typical quantitative data reported from sequencing experiments are read counts, we used Poisson distributions to generate the count data with varying signal-to-noise ratios. scHMM is applicable to a wide range of scenarios, but we considered the representative cases where scHMM is deemed beneficial. Three different models are compared side by side: iHMMs, scHMMs and fullHMM, and the performance was evaluated in terms of receiver-operating characteristic (ROC) curves (Supplementary Figs S1 and S2). Datasets were generated 10 times owing to computational time constraints in fullHMM in each simulation, and ROC curves were averaged over them.
Independent experimentsWe first simulated three data series where there was no systematic correlation between series. This simulation was conducted to assess whether scHMM picks up false positives, in which case scHMM should underperform iHMM. On a dataset with 10 000 windows in 3 series, we planted mound-shaped signals (state 1), of average length 5 consecutive windows, at random positions in all series, and regarded all other windows to be in the background state (state 0). The read counts in the background state were generated from Poisson distribution with mean 5, whereas the read counts in the real binding state were generated from Poisson distribution with mean 7.5, 10 and 15.shows that, as expected, all three HMMs yield nearly identical ROC curves in the case of 2-fold data (Poisson mean 10 for signal), and the results were the same in 1.5-and 3-fold data as well (data not shown).
Replicated ChIP experimentsWe then considered the scenario of replicate experiments. We assumed that ChIP experiments for a transcription factor were repeated three times, each giving one data series. We planted signals of average length 10 windows centered at every 50th window (with 75% chance at each position), and regarded all other windows to be in the background state. Read counts were generated the same way as described above (1.5-, 2-and 3 fold). In all cases, because the mounds were planted in shared binding sites across replicates, hidden states were expected to be highly correlated between all three series. Indeed, the between-series coefficients fg and fg were mostly positive, indicating an increase in the log odds of the 0 ! 1 and 1 ! 1 transitions when other series are in binding states in the past and current positions. The ROC curves inclearly demonstrate that scHMM improved the sensitivity and specificity over iHMM, but not as good as fullHMM.
Groups of experiments with shared binding sitesNext we considered a more realistic scenario with six ChIP experiments. We used the same emission distributions (Poisson) forgenerating the simulation data as above. Here we assumed two and three groups of correlated experiments. In the two-group case, the windows containing signals were shared across the series within each group, but not between the groups. In the three-group case (each with two series), windows containing signals were mutually exclusive between the first two groups, but both groups shared such windows with the third group. As expected, the regression coefficients for the 0 ! 1 transition were positive within each group in both two-and three-group cases, but they were zero for the between-groups coefficients. For the three-group case, there were additional positive coefficients between the first and third groups and between the second and third groups, in accordance with the data generation mechanism. In both examples, the ROC curve for scHMM showed improved sensitivity over iHMM at all points, at times almost identical to that of fullHMM (). Interestingly, fullHMM sometimes showed slightly poorer specificity compared with scHMM in some simulations because fullHMM picked up too many signals from the background regions. Moreover, even in this mini-scale data, the computational time for fullHMM was 10 15 minutes, whereas scHMM took 510 seconds, indicating a significant improvement in computational efficiency for achieving a similar ROC profile.
ANALYSIS OF HISTONE MODIFICATIONS IN HUMAN CD4 T CELLSIn eukaryotic organisms, DNA is packaged into a chromatin structure by wrapping DNA around histones. It has been discovered that the cellular state is closely related to the modification patterns of the histone, or chromatin state (). For this reason, it is of great interest in biology to construct a genome-wide map of chromatin states in different cell types. An increasing number of studies have reported genome-wide data for multiple histone modifications using ChIP-chip () or ChIP-seq (). Because multiple histone modification marks are involved in transcriptional regulation and many of them are closely related, it is highly desirable to analyze these datasets jointly; scHMM is an ideal method for such analysis. In this study, we applied scHMM to a large-scale ChIP-seq dataset, which surveyed 39 histone acetylations and methylations in the human genome, in addition to RNA polymerase II (RNA Pol II) and insulator binding protein CTCF ().
Data processing and model fittingWe downloaded the raw sequence read data from the SRA database ($243 million reads) and performed preprocessing of data, including alignment against the most recent release of the human genome (hg19) using the bowtie software (). Then we extracted read count data in 15.4 million 200 bp windows (contiguous non-overlapping). See Supplementary Information for details. Using the processed data, we fit iHMM and scHMM for each chromosome separately. fullHMM did not finish a single iteration in 2 days for any of the 24 chromosomes. In contrast, it took $20 minutes to fit scHMM for each chromosome; thus, fullHMM was excluded for further analysis. For scHMM, fitting a penalized regression for the entire data (millions of windows in 41 data series) is computationally demanding, and hence we randomly sampled 100 blocks of 500 windows (each ranging 10 kb) from each chromosome and used them to train the regression coefficients, which were later used to estimate the posterior probability (pp) of enrichment across the whole chromosome. As expected, the regression coefficients were similar across chromosomes. Overall, both iHMM and scHMM reported a various number of ChIP-enriched windows with pp ! 0:9. In both analyses, the six histone methylations H2BK5me1, H3K4me1, H3K4me3, H3K9me1, H3K36me3 and H4K20me1 were the most abundant modifications across the genome, followed by various acetylations of H3 and H4, RNA Pol II and CTCF, for which pp was above 0.9 in more than 40 000 windows. In total, scHMM reported fewer ChIP-enriched windows than iHMM (see Supplementary). To see whether scHMM effectively incorporated the correlation, we computed two correlation matrices of the histone modifications using the estimated probabilities (pp) reported by scHMM and iHMM, respectively, and performed agglomerative hierarchical clustering on each correlation matrix. Both correlation matrices showed a large acetylation block mainly consisting of acetylation marks, suggesting that histone acetylations are more concerted than histone methylations across the genome. Both blocks contain the 17-member 'modification backbone' described in the original study by. By close inspection, we found that the acetylation block generated from scHMM contained 26 marks, four more than that generated from iHMM. The four additional marks are all acetylation marks: H4K12ac, H4K16ac, H2AK9ac and H2AK5ac. The inclusion of these four marks is supported by observing the histone acetylation patterns in the transcription start site (TSS) region and across the gene bodies of 1000 highly active or silent genes reported in. Moreover, the scHMM output showed increased correlation among closely related modifications over the iHMM output across the data. For example, in the large group of 26 modifications clustered together by scHMM (), 299 pairs showed increased correlation and 26 pairs showed decreased correlation in scHMM compared with iHMM.
Histone modifications in actively transcribed genesFor real datasets, we cannot directly evaluate the sensitivity and specificity of the two HMM algorithms. Instead, we examined the modification patterns of well-characterized histone modifications. We learned fromthat 17 modifications in the backbone module tend to co-localize at gene promoters, and genes associated with these modifications tend to have higher expression. In particular,also found from the ENCODE data () that H3K4me3, a member of the backbone module, accumulates in the promoter region of actively transcribed genes. In contrast,observed that another key modification H3K36me3 peaks toward the 3 0 end of actively transcribed genes. By examining whether the similar pattern holds in our genome-wide data, we can indirectly assess the sensitivity and specificity of the two methods. To this end, we first obtained the gene expression profile of the same human CD4 T cells from, and identified 1206 genes with the highest expression level. This number corresponds to 10% of the genes that could be mapped to the Ensembl transcripts we considered in the ChIP-seq data. We refer to these genes as 'actively transcribed' genes (ATGs) hereafter. For each modification in the backbone module, we counted the number of genes with at least one ChIP-enriched window in the TSS (promoter) and transcription end site (TES) regions to evaluate the sensitivity and specificity, respectively (Supplementary). The TES regions serve as controls because the backbone module is expected to co-localize at the promoter region of ATGs. When considered together with RNA Pol II or H3K36me3 in the gene body, scHMM reported 49% more H3K4me3 marks than iHMM in the TSS region but not in the TES region. Supplementaryalso shows that scHMM identified more modifications in the backbone module than iHMM in the TSS region of ATGs, whereas scHMM identified fewer or as many of those modifications as iHMM in the TES region of ATGs. We also compared the modification pattern of H3K36me3 mark in the half gene body toward the 3 0 end versus two other control regions: 5 0 proximal region defined as 2 kb to 500 bp upstream region of TSS of ATGs and intergenic regions that are at least 10 kb away from gene bodies (TSS to TES of all genes). For the H3K36me3 mark, we considered the mark to be enriched for a gene if 10% of the half gene body is covered by high-confidence ChIP-enriched windows. Supplementaryshows that scHMM identified H3K36me3 enrichment in 8% more genes than iHMM in the half gene body, while identifying as few as iHMM in the 5 0 proximal region and mere 2% more in the random intergenic region, preserving the specificity high. In addition, Supplementaryshows that scHMM identified H3K36me3 marks not called by iHMM in the TES region of 16% more ATGs, without the increase in the TSS regions of the genes. Therefore, the results above suggested that the additional gain from scHMM was real in ATGs, consistent with Koch et al.
Combinatorial pattern analysisIn addition to the comparison above, we also compared iHMM and scHMM in terms of the resulting combinatorial patterns of all histone modifications. In the data, there are $1.98 million and $1.59 million windows with at least one active modification in iHMM and scHMM, respectively. Again, each modification was considered to be 'on' if pp ! 0:9 and 'off' otherwise. We mapped these combinations of 39 modifications (and RNA Pol II/CTCF) to the 51 representative states reported by Ernst and Kellis (2010) (termed EK states hereafter), who provided the first multivariate analysis of combinatorial patterns. In their work, the authors used binarized data summarized in 200 bp windows and constructed a multivariate HMM with 51 states, where each state is represented by a unique 41-dimensional emission probability vector. Hence, their multivariate HMM is an HMM with multivariate binary data. For the mapping, we computed Euclidean distance between the vector of estimated probabilities pp (from scHMM or iHMM) and the emission probability vectors of the 51 EK states, and assigned the closest EK state to each window. We gave the assignment only when the (Euclidean) distance was 50.3, leaving some windows unassigned (unmappable). In sum, we treated the 51 states defined by Ernst and Kellis as the gold standard, and used the mapping rates to EK states to compare the performance of scHMM and iHMM. To minimize this discrepancy between genomic annotation for each window and its assigned state, we first categorized the windows into the promoter region (AE500 bp around TSS), gene body (TSS to TES), 5 0 proximal region upstream of the promoter region (2 kb to 500 bp upstream of TSS) and intergenic region (10 kb away from any gene body). For each group, we then mapped the windows to the biologically relevant subsets of 51 states based on biological relevance. Specifically, we limited our mapping of the windows from the promoter region to the 'promoter' states only (states 111), the windows from gene body to the 'transcribed' states (states 1228), the windows from 5 0 proximal region to 'active intergenic' states (states 2939) and theH2BK5me1) appeared in the intragenic regions at least twice as much as in the intergenic regions. In contrast, the methylations associated with transcription repression (H3K27me2, H3K27me3, H3K9me2, H3K9me3) appeared more frequently in the intergenic regions compared with the intragenic regions. Moreover, a few modifications associated with actively transcribed genes dominated the intragenic region, whereas various modifications appeared as frequently as each other, indicating the chromatin states might be either complex or sporadic in the intergenic region than the intragenic region. This result is also reflected in the distinct correlation patterns in the two regions (Supplementary). In the intragenic region, the modification backbone and the methylations associated with actively transcribed genes (e.g. methylations of H3K4 and H3K9me1) formed a tight cluster, and the remaining histone modifications were not well correlated. In contrast, the methylations associated with repressive genes (e.g. H3K9me3, H3K27me3, H4K20me3) formed a strong cluster in the intergenic region.
at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
H.Choi et al. at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
Sparsely correlated hidden Markov models at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
CONCLUSION In this work, we presented a computationally efficient method termed scHMM for inferring hidden states in correlated HMMs with sparsity constraints. We used an expectation-maximization-type procedure to infer the hidden states and other model parameters. The advantage of scHMM is that it takes the inter-sample correlations into account in the hidden state inference, and thus is more efficient and powerful than iHMM when the data series are related. This situation arises frequently in epigenetic studies because many of the acetylation and methylation marks are part of a large complex. Although there is no guarantee that the iterative procedure will converge eventually, our experience with both simulated data and real data suggests that scHMM works well in all cases we have tested. As in many other complex problems, finding the exact global maximum(a) in the likelihood function is neither possible nor necessary. Nevertheless, it is possible to develop efficient algorithms that can achieve close-to-optimal results within a reasonable amount of time. Our study gives such an example. By applying scHMM, we can make interesting and insightful biological findings even though our algorithm cannot be guaranteed to find the exact optimal solution across all possible hidden paths. Our method is related to the factorial HMM (Ghahramani and Jordan, 1997) in the literature, but the two methods are different in the sense that factorial HMM incorporates the inter-series correlation by marginalizing hidden state model for each series with homogeneous transition probabilities and using multivariate emission, whereas scHMM achieves the same goal using the same model for hidden states but with conditionally independent emission and inhomogeneous transition probabilities. In genome-wide location studies, it is not intuitive to assume that the observed data, e.g. read count data, themselves are correlated given their hidden states, and it is difficult to find a standard probability distribution to represent such correlation. Therefore, we believe that scHMM is better suited for this type of applications. We demonstrated the utility of scHMM for improved genome-wide mapping of histone modification sites. In this application, the goal of scHMM is to identify the regions of ChIP enrichment in multiple ChIP-seq dataset simultaneously. Typically, genome-wide binding patterns are inferred individually without considering the correlation between the data series. In this work, we showed that scHMM establishes a statistically principled framework to deliver this goal by borrowing statistical strength from related factors to improve the power of site detection. In closing, we remark that scHMM offers great flexibility for extensions. For example, the method can be immediately extended to higher-order HMMs by adding more covariates (adjacent loci) in the penalized logistic regression model. It is apparently impossible to fit such models in a multivariate form in genome-wide datasets owing to rapidly rising complexity. Furthermore, additional covariates can be easily added to the regression model for the purpose of incorporating previous knowledge of signal patterns such as known binding sites from the genomic annotation database. However, such extensions are beyond the scope of this work and we leave them for future work.
