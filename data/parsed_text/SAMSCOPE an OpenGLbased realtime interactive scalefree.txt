Existing SAM visualization tools like 'samtools tview' (Li et al., 2009) are limited to a small region of the genome, and tools like Tablet (Milne et al., 2010) are limited to a relatively small number of reads and may fail outright on large datasets. We need to visualize complex ChIP-Seq and RNA-Seq features such as polarity as well as coverage across whole 3 Gbp genomes such as Human. We have addressed these problems in a lightweight visualization system called SAMSCOPE accelerated by OpenGL. The extensive pre-processing and fast OpenGL interface of SAMSCOPE provides instantaneous and intuitive browsing of complex data at all levels of detail across multiple experiments. Availability and implementation: The SAMSCOPE software, implemented in C++ for Linux, with source code, binary packages and documentation are freely available from
INTRODUCTIONNext-generation sequencing (NGS) workflows often involve mapping reads onto reference genomes using tools such as SHRiMP2 (), Bowtie () and others. Mapping determines the likely point of origin (or origins) of a given read. Despite the multitude of different mapping methods and software, the SAM (Sequence Alignment/Map) format () and the associated binary encoding (BAM) have emerged as the lingua franca of NGS mapping file formats. For many projects using SAM data, it is desirable to visually inspect the results of mapping for quality control and exploration. However, because a single NGS run can provide millions of reads from billions of bases of genome sequence, simply opening up a SAM file and making sense of the content is a non-trivial problem. The two main problems in visualization of a SAM dataset are:(1) Sam files are structured in terms of reads. To calculate coverage of a given base, we have to look at each read and see which bases it maps to, then count how many times that base has been mapped.(As visualization is a common need, a variety of tools have been introduced to view SAM data in different ways. For example 'samtools tview' () provides an interactive textbased viewer which shows each base of each read and reference genome as a character in a text terminal. This can be useful for inspecting narrow regions (100 bases) with fewer reads than terminal rows (30), but not helpful for examining larger regions or deeper coverage. 'Tablet' () and its close cousin 'IGB' () both provide Java-based graphical interfaces for drawing reads against a reference sequence where each base is represented as a colored rectangle. Both can summarize overall coverage with a secondary visualization track. However, both Tablet and IGB draw each read similar to 'samtools tview', limiting their speed and effectiveness when a large number of reads would be in view. 'Integrative Genomics Viewer' (IGV;) can load SAM/BAM files providing detailed inspection capabilities, and provides a 'mean coverage' track given proper pre-processing, which can scale to arbitrary genome sizes. For applications like ChIP-Seq () or RNA-Seq however, 'mean coverage' is not necessarily helpful and hard to use at large scales, as most coverage values are at zero or near zero. We needed a flexible method to visualize and interactively inspect various features from large numbers of reads across mammalianscale genomes while addressing the problems above, so we developed our own approach in SAMSCOPE. 3D computer graphics addresses a similar problem when drawing textures on distant 3D objects: how to efficiently generate a reasonable approximation of millions of points of color data into one screen pixel. A solution known as MIP mapping () has become a mainstay of modern 3D rendering; in it a series of filtered copies of each texture are pre-calculated at exponentially decreasing resolutions. Thus, when a distant object is rendered, rather than sampling millions of points to calculate the combined contribution to one screen pixel, an approximation is achieved with just a few samples from a lower resolution copy. We apply the MIP map concept to genome visualization in SAMSCOPE.
METHODS AND IMPLEMENTATION
SAMSCOPEfor different applications. For example, in ChIP-Seq the difference in number of reads mapped to the forward strand compared with the reverse strand (what we term 'polarity') results in a characteristic zero-crossing invertedpeak pair which, in conjunction with coverage, often reflects protein binding sites (). SAMSCOPE allows easy composition of data layers into compound data layers, such as polarity; 'forward' and 'reverse' count layers are generated, from which overall 'coverage' (the sum) and 'polarity' (the difference) are derived (shown in). This design allows for fast and memory efficient pre-processing of huge datasets, as data primitives can be stored on disk and accessed at random as needed. To generate BIPs we adapt the traditional graphics MIP map approach to sampling 1D data series. The pre-processing algorithm is as follows:(1) Calculate the full resolution series with one value for each base of reference genome, forming a series of columns with one value each.(2) Merge data from adjacent columns generating half the number of composite columns. To merge two columns, combine values from each column as value/frequency tuples. For example, if the value '3' occurred twice in each column, a single tuple {3,4} would be retained.(3) If the number of value/frequency tuples in the current column exceeds a user adjustable maximum, retain a subset; the most frequent values are prioritized, along with the extreme maximum and minimum values.(4) The merged column data and an index reference for fast random lookup are stored to disk.(5) Steps 24 are repeated until only one column remains.To render a given region of data, a set of columns is selected to match the pixel width of the display window. For example, if rendering a 50 Mbp region in a 1024 pixel wide window, data from the 16th 'column merge' iteration is selected, such that each column represents a sample from the underlying 2 16 = 65 536 bases. Thus, the display can be rendered with data from 763 precomputed columns. This approach has some practical benefits: @BULLET To draw one screen of P pixels, at most O(P) values must be read and drawn. Fast rendering allows us to abandon scroll bars, and adopt an intuitive mouse-based 'pan and zoom' interface familiar to users of Google Maps (http://maps.google.com). @BULLET The pre-processed data retains multiple values per column, allows SAMSCOPE to change the rendering style at runtime to a representative spectrum of values at each column, or an average value, or maxima and minima or other arbitrary effects.@BULLET Complex features (such as peaks in ChIP-Seq and RNA-Seq) are visible at genome-scale, and not obscured by techniques like averaging as used in previous tools like IGV and MAQ (). @BULLET Just as BIP display only needs a few columns in memory at a time, BIP generation only needs the values of two pairs of columns. Thus SAMSCOPE can run perfectly well on an average laptop computer. @BULLET Finally, because empty columns do not need to store any data values, and because BIP files are stored as 'sparse files' on disk, BIP files are well suited for sparse data like exomes or ChIP-Seq.Sequence parameters (such as chromosome name and length) are obtained from the source SAM/BAM file itself, eliminating any additional sequence setup steps as are required in programs like IGV. Annotation data from GFF/GTF files are displayed if available (). As a practical benchmark on human reference, a coverage BIP file can be generated from 54 M 120 bp mapped reads on a server with 96 GB of RAM in 12 min, or on an ordinary desktop with 6 GB of RAM in 19 min.).
The Author 2012. Published by Oxford University Press. All rights reserved. For Permissions, please email: journals.permissions@oup.com at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
DISCUSSION SAMSCOPE's BIP format is similar in its goal to the BigBed and BigWig (Kent et al., 2010). However where BigBed/BigWig use B-trees and a complex data layout suitable for remote access over HTTP, SAMSCOPE uses a much simpler flat file format designed for local access through the POSIX mmap function. This design allows the entire process to run efficiently on commodity hardware. SAMSCOPE can be more efficient for its purpose because where BigBed is designed to contain any arbitrary annotation (e.g. scores from overlapping alignments etc.), SAMSCOPE focuses on per base aggregate statistics (e.g. coverage, polarity etc.). We find the BigBed and BIP formats to be complementary in this sense.
at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
