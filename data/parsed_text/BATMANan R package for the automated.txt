Motivation: Nuclear Magnetic Resonance (NMR) spectra are widely used in metabolomics to obtain metabolite profiles in complex biological mixtures. Common methods used to assign and estimate concentrations of metabolites involve either an expert manual peak fitting or extra pre-processing steps, such as peak alignment and binning. Peak fitting is very time consuming and is subject to human error. Conversely, alignment and binning can introduce artefacts and limit immediate biological interpretation of models. Results: We present the Bayesian automated metabolite analyser for NMR spectra (BATMAN), an R package that deconvolutes peaks from one-dimensional NMR spectra, automatically assigns them to specific metabolites from a target list and obtains concentration estimates. The Bayesian model incorporates information on characteristic peak patterns of metabolites and is able to account for shifts in the position of peaks commonly seen in NMR spectra of biological samples. It applies a Markov chain Monte Carlo algorithm to sample from a joint posterior distribution of the model parameters and obtains concentration estimates with reduced error compared with conventional numerical integration and comparable to manual deconvolution by experienced spectroscopists. Availability and implementation
ABSTRACTMotivation: Nuclear Magnetic Resonance (NMR) spectra are widely used in metabolomics to obtain metabolite profiles in complex biological mixtures. Common methods used to assign and estimate concentrations of metabolites involve either an expert manual peak fitting or extra pre-processing steps, such as peak alignment and binning. Peak fitting is very time consuming and is subject to human error. Conversely, alignment and binning can introduce artefacts and limit immediate biological interpretation of models. Results: We present the Bayesian automated metabolite analyser for NMR spectra (BATMAN), an R package that deconvolutes peaks from one-dimensional NMR spectra, automatically assigns them to specific metabolites from a target list and obtains concentration estimates. The Bayesian model incorporates information on characteristic peak patterns of metabolites and is able to account for shifts in the position of peaks commonly seen in NMR spectra of biological samples. It applies a Markov chain Monte Carlo algorithm to sample from a joint posterior distribution of the model parameters and obtains concentration estimates with reduced error compared with conventional numerical integration and comparable to manual deconvolution by experienced spectroscopists.
INTRODUCTIONNuclear Magnetic Resonance (NMR) spectroscopy is widely used in metabolomics to provide information on metabolite profiles of complex biological mixtures, such as biofluids or tissue samples. These spectra commonly contain around a thousand peaks from possibly hundreds of metabolites. The concentrations of metabolites are useful in biomarker discovery, investigating the aetiology of disease and in understanding fundamental biological processes. Quantitative measurement of metabolite abundances from NMR spectra is complicated due to shifting peak positions, peak overlap, noise and effects of the biological matrix.
METHODSAn NMR spectrum, y, can be considered as a linear combination of metabolite peaks plus noise. Metabolite peaks can be labelled catalogued or uncatalogued, according to whether their characteristic peak patterns are known to the user. We propose a two-component joint model for the catalogued y c and uncatalogued y u metabolites as follows:where I is the identity matrix and  is a scalar precision parameter. The signal from the catalogued metabolites, y c , can be modelled as a weighted summation of M metabolite templateswhere vector t mu is a template spectrum of the uth multiplet belonging to the mth metabolite,  mu is the chemical shift parameter for the corresponding multiplet and  m is proportional to the concentration of the mth metabolite. The priors for  mu and  m are truncated normal distributions. The template spectrum, t mu , in turn is generated as a weighted summation of Lorentzian peaks. By default, BATMAN obtains this prior information on the peak pattern from the Human Metabolome Database (). We model the Lorentzian peak widthCopyedited by: SKwhere  represents the spectrum wide average and  m is a random effect, representing metabolite specific deviations from . Our priors for  and  m are both Gaussian. Signal generated by uncatalogued metabolites, y u , is modelled as a linear combination of wavelet basis functions (W). This alleviates difficulties associated with the incompleteness of the spectral library that can influence other methods (). A probability density model is specified in the wavelet domain of the data, i.e.  W y u. We use symlet-6 wavelet basis functions as they are well suited to modelling Lorentzian peaks (). The distribution of  is modelled by a truncated Gaussian, whose parameters are specified by the parameters ,  and . The hyperparameter vector   Gamma(c,d/2) allows the prior precision associated with each wavelet deviate from the global precision   Gamma(a,b/2).  is a truncation limit vector where each  i has a Gaussian distribution left truncated at a small negative value h.
Automated quantification of metabolites
IMPLEMENTATIONA Markov Chain Monte Carlo (MCMC) algorithm is proposed to sample from the joint posterior distribution of the model parameters. We temper the likelihood and penalize the wavelet component of the model stringently to move the chain into a region of good posterior support in the burn in stage of the MCMC. We introduce block updates for  jointly with , and for  mu jointly with  to allow the chain to make global moves. The details are described in. Adaptation techniques are used to update the peak shift  mu and width parameters  m. The core algorithm is implemented in C++ language with support for parallel processing between spectra to improve the processing speed. R version 2.12.1 (or higher), together with the R packages described in the documentation, is required. BATMAN runs on Windows, Mac OS X and Linux/Unix operating systems and supports text file, R data format and 1DBruker spectral data files as input. Processing 8 spectra on an Intel 3.0GHz Quad-Core 2 processor machine with 11 catalogued metabolites region from 2.3 to 4.1 ppm took approximately 22 min. The MCMC procedure ran for 2000 iterations following a 4000 iteration burn in. The time required scales linearly with the number both of metabolites and spectra (on a multicore machine, multiple spectra can be analysed in parallel with the same run time as a single spectrum analysis).shows an example result of a BATMAN fit of a 1 H NMR spectrum of normal rat urine. The catalogued metabolite peaks are correctly fit by the algorithm, with uncatalogued peaks absorbed by the wavelet component. The unimodality of peak position and concentration distributions indicate no ambiguity in the assignments. The BATMAN deconvolution has been shown to have reduced mean estimation error compared with conventional numerical integration methods and its results on an example dataset fitting 26 metabolites are comparable with the manual deconvolution by five experienced NMR spectroscopists as described by.
RESULTS
* To whom correspondence should be addressed. Excellent solutions to manual peak fitting exist (Weljie et al., 2006); however, this option is time consuming and is subject to human error and bias (Tredwell et al., 2011). The R package BQuant (Zheng et al., 2011) attempts to quantify metabolites from NMR spectra using Bayesian model selection. However, it is a two-step procedure that requires spectra to be pre-aligned and partitioned into bins. Consequently, it is awkward to apply as it is not fully automated. Peak shifts are not incorporated into the statistical model, which may lead to suboptimal estimates of metabolite concentrations, especially in crowded regions. Herein, we present the R package Bayesian automated metabolite analyser for NMR spectra (BATMAN) that implements a Bayesian model for 1 H NMR spectra (Astle et al., 2012) and a Markov chain Monte Carlo (MCMC) algorithm to automate metabolite quantification from NMR spectral data. BATMAN is able to automatically assign peaks to metabolites given a target metabolite list and chemical shift region(s) specified by the user.
The Author 2012. Published by Oxford University Press. All rights reserved. For Permissions, please email: journals.permissions@oup.com at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
