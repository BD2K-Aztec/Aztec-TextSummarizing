Motivation: Structural information of macromolecular complexes provides key insights into the way they carry out their biological functions. The reconstruction process leading to the final 3D map requires an approximate initial model. Generation of an initial model is still an open and challenging problem in single-particle analysis. Results: We present a fast and efficient approach to obtain a reliable, low-resolution estimation of the 3D structure of a macromolecule, without any a priori knowledge, addressing the well-known issue of initial volume estimation in the field of single-particle analysis. The input of the algorithm is a set of class average images obtained from individual projections of a biological object at random and unknown orientations by transmission electron microscopy micrographs. The proposed method is based on an initial non-lineal dimensionality reduction approach, which allows to automatically selecting representative small sets of class average images capturing the most of the structural information of the particle under study. These reduced sets are then used to generate volumes from random orientation assignments. The best volume is determined from these guesses using a random sample consensus (RANSAC) approach. We have tested our proposed algorithm, which we will term 3D-RANSAC, with simulated and experimental data, obtaining satisfactory results under the low signal-to-noise conditions typical of cryo-electron microscopy. Availability: The algorithm is freely available as part of the Xmipp 3.1 package [http://
INTRODUCTIONSingle-Particle Analysis (SPA) techniques can obtain 3D maps of biological complexes at near-atomic resolution by combining tens of thousands of projection images obtained with a transmission electron microscopy (TEM) (). In general, the reconstruction process leading to the final 3D map requires the use of an approximate initial model. The fully automatic and efficient determination of this initial volume, either for symmetric or asymmetric structures, is still an open and challenging problem in SPA, as indicated by the existence of an ample literature on this matter. Many previous attempts to the 'initial model problem' have been reported. On the one hand, in the Random Conical Tilt and orthogonal tilt methods (), the alignment problem is simplified by acquiring micrographs as tilt pairs, or by using multiple different tilts with known tilt angles. On the other hand, we observe a large variety of methods based on common lines () that, in principle, they allow for an initial model estimation without tilting of the specimen. Computer-generated shapes (), or reconstructions from one image of a particle assuming a certain symmetry (), have also been used to define initial volumes. Another line of research is based on the introduction of a 'random model' strategy based on first assigning random orientations to class averages (). In this latter case, an initial 3D reconstruction is obtained from these random angular assignments, which is finally refined by a projection matching strategy. Following this approach, Sanzpresented a random-model method that allows ab initio generation of starting models from raw experimental images. Several initial models were generated, assigning initially a random orientation to each imaged particle. Recently,, have presented a method based on a probabilistic initial 3D model generation procedure, which uses projection images instead of class averages. Furthermore, in, it presented OptiMod, a method that incorporates multiple automated algorithms for determining orientations using common-lines methodologies and, at the same time, provides criteria for scoring their results. This approach generates multiple maps using algorithm-specific randomization. The 'initial model problem' is still, and in spite of the multiple algorithms so far proposed, widely accepted as a real issue in SPA (), with methods demanding no trivial choices of input parameters and being computationally expensive. Indeed, in the way of defining highthroughput approaches in 3D-EM, we really need fast, simple and accurate methods, which are, indeed, the motivation of this *To whom correspondence should be addressed.  The Author 2014. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com work. In this way, we will describe in detail 3D-RANSAC, presenting its good performance on a wide range of specimens, using the same parameters for all cases (making the case of 'simplicity'), and obtaining final results in a matter of minutes on a typical laptop computer. Our proposed approach consists in a novel random modelling strategy based on an initial dimensionality-reduction method together with the RANSAC algorithm, which makes this approach efficient from a computational point of view. The method can be used to produce lowresolution initial volumes of symmetric or asymmetric biological complexes.
METHODS
Class average imagesFirst, a set of class average images are obtained from the particle dataset using any image classification algorithm [in this article, we will use CL2D (), included in the Xmipp 3.1 package]. Observe that the classification process is required in any usual SPA processing workflow and is not a special requirement of the proposed approach. Electron microscopy datasets commonly contain more than one different structures, as projections of different conformations of a given molecule, or projections of different molecules in the specimen preparation. These class images are then the input of the new proposed method and, typically, $2050 class images are sufficient. There is nothing in the algorithm that precludes using experimental projections instead of classes. However, we find that using a sufficient number of class average images has several practical advantages, such as (i) increasing the signal-to-noise ratio of the input images, (ii) introducing a desired smoothing (a 'de facto' regularization) in the landscape of solutions and (iii) reducing the total processing time. Of course, we note that we are only interested in a low-resolution initial model.
Random model generation strategyOur random model generation strategy is based on the following eight steps:(1) The class averages are low-pass filtered, and their size is reduced according to user parameters (basically, the desired resolution in the initial model).The local tangent space alignment (LTSA) non-linear dimensionality reduction approach () is applied to automatically select a random, smaller and appropriate (in the sense that contains the most of the structural information of the biological complex under study) subset of class images. This approach non-linearly projects the class averages onto a lower-dimensional space [in our case, two-dimensional (2D)], where the projections of the structure at similar orientations appear close. LTSA method is essentially a local principal component analysis (PCA) approach that can efficiently 'learn' about non-linear manifolds by taking into account that non-linear manifolds can be considered to be locally linear in small neighborhoods. Observe that PCA cannot deal with non-linear manifolds, as it is a linear method, and the 2D projection of a 3D structure is, intrinsically, a non-linear process (). Additionally, we note that the computer time required for LTSA and PCA are comparable, making LTSA clearly the method of choice for this task. As an example, in, we show a projection of a set of image class averages into a 2D space. As can be seen from, and as intuitively expected, similar projections of the biological object appear close in the 2D space, whereas different ones appear far apart. We can now use this 2D space to select a We will refer to these 'good' initial classes as 'inliers', and we say that they support this 3D model. The rest of the initial classes are referred to as 'outliers'. The practical way in which this selection is done is by establishing a threshold in the correlation coefficient obtained as the percentile p of all obtained correlations, with p typically between 75 and 80%. We define the score of each random 3D map as the sum of the correlations of its inliers. In steps 25, we are using Random Sample Consensus (RANSAC) approach () to capture 'correct' models. RANSAC is an iterative method to estimate a model (in this case a 3D map) from a set of observed data that contains a large amount of outliers. RANSAC approach consists in the following steps: (i) Randomly selecting a subset of the dataset. (ii) Fitting a model to the selected subset. (iii) Determining a score to each model, typically the number of outliers/inliers. (iv) Repeating steps 13 for a prescribed number of iterations. A basic assumption is that the data consist of inliers, data that can be explained by the model, though they may be subject to noise, and outliers, that are data that do not fit the model. The outliers may come, e.g. from extreme values of the noise, from erroneous measurements or incorrect hypotheses about the interpretation of data, for instance, wrongly assigned Euler angles. RANSAC also assumes that, given a (usually small) set of inliers, there exists a procedure that can estimate the model that optimally explains or fits this data. Additionally, this algorithm is probabilistic and non-deterministic, in the sense, that it produces always good results with a certain probability if the number of inliers is larger than the number of outliers, with this probability increasing as more iterations are allowed (). Our RANSAC approach is performed using the following combination of steps: (i) Automatic selection of a small number of class averages following a dimensionality reduction approach.In the Supplementary Material, we show that with the number of RANSAC iterations 4380, the probability of finding a better model is 50.01.(6) The k random 3D models (k $ 510) with largest number of inliers (largest score) are selected and new 3D reconstructions are obtained using as input classes only the inliers.(7) The previous k 3D random models are now refined against all initial classes through a model refining strategy. In this article, we have used a projection matching approach (de la Rosa-Trev n et al., 2013), using typically 10 iterations for refinement. However, other approaches can be used as well, such as the recent method of. Observe that we refine the best K models independently through projection matching to add more robustness to our approach. As the previous angular assignment is random, refining K models improves the probability of getting at least some good structures at the end.(8) The resulting k volumes are scored taking into account the sum of the inliers correlation coefficients. Finally, the model with highest score is automatically selected. In, we show a diagram of the different processing steps.
RESULTSIn this section, we provide results obtained with simulated and experimental data that show the effectiveness of the proposed method.
SimulationsIn the first simulation, we used the structure of the Bacteriorhodopsin as a phantom (PDB entry: 1BRD,) that is projected at 200 unknown and random orientations. The projections are affected by a Gaussian noise with a signal-to-noise ratio (SNR) of 0.1. The size of the images is 100  100 px and the sampling rate is 1 A  /px. Note that, in this case, we did not obtain class averages and we use our proposed method directly with the noisy projections to show its robustness. In, we present 7 of the 200 noisy projections used, together with the phantom (left) and best obtained initial (right) 3D maps at three different orientations. The initial volume was obtained with the following parameters, N = 380, n = 9, P = 0.77 and k = 10. We used an angular sampling rate for retroprojection of 7. The projections were low-pass filtered to a resolution of 5 A . The required processing time for obtaining the k = 10 volumes is of 35 min with a 2.5 GHz laptop and using two processors. To quantize the resolution of the obtained initial volumes, we have obtained the Fourier Shell Correlation (FSC) curves using the PDB volume as reference. The resolution at FSC = 0.5 and FSC = 0.143 are 4.6 and 4.5 A  , respectively (), that is consistent with the previously performed low-pass filtering, and shows that using perfectly aligned projections in presence of moderate noise, the proposed method can retrieve high-resolution models. This situation is not usual in experimental cases. However, with this simulation, we want to show that there is no theoretical restriction that limits the proposed method in high-resolution analysis.), from which 32 classes were determined using CL2D (). These classes were low-pass filtered to a resolution of 5 A . In, we show eight experimental projections (a) and the 32 obtained classes (b). The parameters used to obtain the initial volume by the proposed method are the same ones as in the case presented before. In, we show the best 3D-RANSAC map at three different orientations. The processing time for obtaining the k = 10 volumes is of $20 min, with the same computer as before using two processors. Observe that the processing time of CL2D is of 330 min, and then the total time CL2D + 3D-RANSAC is of 350 min.
Case 2: Eukaryotic ribosomeMoreover, we have also performed an asymmetric reconstruction using $5000 cryo-EM projections of an eukaryotic ribosome, obtained from the EMDB test image data (http://www.ebi.ac.uk/pdbe/emdb/test_data. html) and originally used in the work of. The images have a size of 130  130 px. We initially obtained 16 class average images using CL2D, which were then low-pass filtered to a resolution of 25 A . We obtained the 3D-RANSAC map with the same parameters as in the cases before. In, we show eight initial experimental projections of the ribosome (a) and the low-pass filtered class averages (b). Finally, in, we also show the 3D reconstruction using PRIME () and one obtained using 3D-RANSAC at three different orientations. The FSC curves between the PRIME and the 3D-RANSAC maps at FSC = 0.5 and FSC = 0.143 are 19 and 12 A  , respectively, which means that both structures are similar, as visually suggested already in, certainly enough for any of them to be used as a low-resolution initial 3D map. However, the processing time for obtaining the 3D-RANSAC map with the same parameters and the same laptop computer than in previous cases is only 50 min. The processing time of CL2D is of 435 min, and then, the total timeThe phantom 3D map at three different orientations is presented on the left-hand side, whereas the best obtained volume, using the proposed approach, is on the right-hand side. FSC curve between the Bacteriorhodopsin phantom of the best initial 3D map obtained (highest score) using the proposed approach CL2D + 3D-RANSAC is of 485 min, whereas PRIME (or virtually any other method so far proposed) requires more than 4 days of computation (5760 min) in a laptop setting. To present the good agreement between the obtained initial volume and the used class averages, we show in, the experimental class averages (labeled as 'image'), the corresponding initial 3D map projection at the same orientation ('imageRef') and the normalized cross correlation between both images ('maxCC'). As can be seen from, there is a good agreement between the class averages and the corresponding projections.
Case 3: GroELAdditionally, we have used a GroEL dataset, kindly made available by Dr Ludtke (), composed by 26 micrographs of size 4082  6278 pixels. The sampling rate is 2.10 A  /pixel and the microscope voltage is of 200 kV. From this dataset, we have detected 4123 particles of size 128  128, using the method presented in (), and 16 classes were determined using CL2D (). In, we show the obtained 16 classes and the best volume (b) recovered by 3D-RANSAC map using default parameters, as before. In this case, the required processing time is $5 min with the same computer as before. The processing time of CL2D is of 318 min, and then, the total time CL2D + 3D-RANSAC is of 324 min. The FSC curves between the phantom EMDB (EMDB code 1081,) and the 3D-RANSAC map at FSC = 0.5 and FSC = 0.143 are 10.2 and 9.7 A  , respectively, which means that both structures are similar. To further show the good agreement between the obtained initial volume and the used class averages, we present in, the experimental class averages in the first row labeled as 'image', the corresponding initial volume projections at the same orientation in the second row ('imageRef') and the normalized cross correlation between both images in the third row ('maxCC'). As can be seen from, there is a good agreement between the class averages and the corresponding projections.
Case 4: MCM467 Finally, forthe sake of completeness, we show the behavior when dealing with small complexes in theorder of a half million daltons using negative staining. This is an internally acquired dataset, corresponding to a certain MCM467 complex. The microscope is a JEOL JEM-1230, and the accelerating voltage is 100 kV. The nominal magnification is 40 000 and the sampling rate 2.28 A  /pixel. We have obtained $6000 particles from 200 micrographs, using the method presented in (). From the picked particles, we obtained 128 class averages using CL2D (), which are manually curated to a smaller homogeneous dataset of 20 class averages. In, we show the obtained class averages, after the curation process. As in the cases shown before, we have used the same input parameters for the determination of the 3D-RANSAC map. In this case, the required processing time is of 6 min with the same computer as before. The processing time of CL2D is of 720 min, and then, the total time CL2D + 3D-RANSAC is of 726 min. Inwe show the 3D-RANSAC map at different orientations. As in the case before, to show the good agreement between the obtained initial volume and the used class averages, we present in, the class averages, the corresponding projection of the initial volume at the same orientation and the normalized cross correlation between both images. As can be seen from, there is a good agreement between the class averages and the corresponding projections.
DISCUSION AND CONCLUSIONObtaining a reliable low-resolution initial map is a well-known current challenging problem in single particle electron microscopy. This statement can easily be supported considering the large number of recent publications about this topic (). Existing current approaches are mainly based on common lines () or random model generation (). However, in general, these methods are not easy to use, in term of the selection of input parameters, and are computing intensive. Naturally, the combination of a non-easy choice of input parameters together with long execution times complicates their practical use, requiring expert processing. Aware of these problems, we have set our aim at developing a simple-to-use method for which default parameters work well in most cases, at the same time as when the required computing time is minimized to minutes on a standard laptopcomputer. Naturally, most methods can be trapped into local minima, and 3D-RANSAC is not an exception, but in this case, the landscape of solutions is particularly smooth, the use of RANSAC algorithm and, additionally, its short execution time reduce considerably this risk and also open the venue to future developments involving close-to-global optimization techniques for particularly challenging problems. Finally, we have developed 3D-RANSAC for the case of homogenous image populations, and at this stage this may be considered a limitation of the method. Observe that the input of the algorithm are homogeneous class average images, and therefore, the problem of separating structurally heterogeneous image sets into homogeneous classes has to be already solved in the previous classification approach. The extension of 3D-RANSAC to the non-homogenous case will be considered in future works, requiring a far from trivial extension of many concepts behind RANSAC. In this article, we have presented a fast and efficient approach to obtain a reliable low-resolution initial volume from sets of macromolecular projection images without a priori information. The proposed method, instead of trying to explore the entire space of projection orientations, a task that is computationally intractable even for a few hundred images, uses a novel random modeling strategy based on an initial non-linear dimensionality reduction and RANSAC algorithm, which makes this approach efficient from a computational point of view. Observe that the probability of assigning the correct orientation to one projection corresponds to a standard uniform distribution. As the process of assigning the orientation to projections is statistically independent, the probability of giving correctly the angles to n particles corresponds to p n (with P the probability to assign correctly the orientation to one projection). Therefore, if the number of images is high, this probability is low. Therefore, to increase this probability, we have used smaller sets of images (of typically nine projections) but at the same time capturing most of the structural information of the volume (note that this process is accomplished by the dimensionality reduction approach). 3D-RANSAC is a two-step survival algorithm. In the first step, a large number of models are generated ($380) but only the best k survive, which are the ones with the highest number of inliers (largest score). After this first selection process, these k models are refined again using all the initial classes by a projection matching approach, and at the end of this second selection step they are ranked again so that there is only one winner. We have tested our proposed method with synthetic (Bacteriorhodopsin) and experimental data (BPV, Eukaryotic Ribosome, GroEL and MCM467). In all cases, we have obtained fast and satisfactory results. The algorithm is freely available as a part of the
at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
smaller image dataset containing the most of the structural information, and then assign random orientations to these images. To automatically select a representative image set, the 2D map is partitioned by a 2D regular grid of dimensions (with typically n = 9), and only one image class average is randomly selected each time from any of the grid squares. In Figure 1, we show an example of a smaller image dataset with a red square, and the 2D regular grid appears in gray color. Therefore, n class images are randomly selected in this way. Obviously, there is a trade-off with respect to the number of images composing this reduced dataset. As the number of images gets smaller, the processing time of subsequent steps is reduced and, additionally, the probability of assigning correct angles by random assignment is higher. However, if this number is too small, we can lose important structural information. In our algorithm, this number (n) is an input parameter and normally ranges between 4 and 9, with 9 being the 'default' value (all results presented in this article have been obtained with n = 9). (3) A 3D reconstruction is performed from the smaller image subset (n = 9) by random angular assignment. The reconstruction algorithm takes advantage of symmetry information when available. Reconstruction is made by interpolation in Fourier space. For each experimental image, the Fourier Transform is computed and placed in the corresponding plane in the 3D space as well as in all planes related by symmetry. This random 3D model is then projected at regular angular intervals determined by the angular step-size, which is an input parameter with a default value of 7. Each initial class average is now compared with the projections of the 3D random model, and the best assignment is determined looking for the largest correlation coefficient. (4) Steps 23 are repeated N times producing N different 3D random models. Therefore, N is also an input parameter of the method, but in the Supplementary Material, we present a statistical derivation for an informed selection of N. In this way, we set the default value of N to 380, as in this way, we know that the probability of obtaining a still better 3D model by increasing N is50.01. This value of N = 380 has been used in all the examples presented in this article. (5) For each generated random model, we define its inliers as the initial class average images that have a large enough correlation coefficient with respect to the reprojections of the random 3D map. Fig. 1. Projection of a set of unsorted image class averages of a certain MCM467 complex into a 2D space using the LTSA dimensionality reduction approach. In this figure, x and y are the axis of the feature space learned from the input
J.Vargas et al. at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
Efficient initial volume determination at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
