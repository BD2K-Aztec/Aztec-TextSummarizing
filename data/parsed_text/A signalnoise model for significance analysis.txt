Motivation: ChIP-seq is becoming the main approach to the genome-wide study of protein–DNA interactions and histone modifications. Existing informatics tools perform well to extract strong ChIP-enriched sites. However, two questions remain to be answered: (i) to which extent is a ChIP-seq experiment able to reveal the weak ChIP-enriched sites? (ii) are the weak sites biologically meaningful? To answer these questions, it is necessary to identify the weak ChIP signals from background noise. Results: We propose a linear signal–noise model, in which a noise rate was introduced to represent the fraction of noise in a ChIP library. We developed an iterative algorithm to estimate the noise rate using a control library, and derived a library-swapping strategy for the false discovery rate estimation. These approaches were integrated in a general-purpose framework, named CCAT (Control-based ChIP-seq Analysis Tool), for the significance analysis of ChIP-seq. Applications to H3K4me3 and H3K36me3 datasets showed that CCAT predicted significantly more ChIP-enriched sites that the previous methods did. With the high sensitivity of CCAT prediction, we revealed distinct chromatin features associated to the strong and weak H3K4me3 sites.
INTRODUCTIONWith the advances of ultra-high-throughput sequencing technologies in the past 3 years, ChIP-seq is becoming the main approach to the genome-wide study of proteinDNA interactions and histone modifications (). In ChIP-seq analysis, the biologically interesting sites are identified by searching for the genomic loci where the reads sequenced from ChIP DNA are over-represented. A number of ChIP-seq analysis tools have been developed for this purpose (; * To whom correspondence should be addressed.). All these tools perform well to extract strong ChIP-enriched sites. However, two questions remain to be answered: (i) to which extent is a ChIP-seq experiment able to reveal the weak ChIP-enriched sites? (ii) are the weak sites biologically meaningful? To answer these questions, it is necessary to establish a signalnoise model to separate the weak ChIP signals from background noise. In a ChIP-seq experiment, majority of the unbound DNA fragments are washed out in the immune-precipitation procedure. The ChIP-processed library is enriched by the fragments pulled down from the genomic loci with high chance of proteinDNA interactions or histone modifications. However, considerable 'nonuseful' fragments remain in the library due to the random protein DNA or antibodyDNA contacts that are not position-specific. Reads sequenced from these fragments are widely spread in the genome, and are considered background noise in addition to the real signal of ChIP enrichment. In early ChIP-seq application without a negative control, distribution of the noise was assumed to be uniform (). However, recent studies showed that the uniform model is too ideal due to the existence of sequencing and mapping biases, chromatin structure and genome copy number variations (). Adjustment of these intrinsic biases requires a negative control, which could be generated using non-specific antibody or input DNA. To utilize a negative control in ChIP-seq analysis,suggested normalizing the control to a level equivalent to the background noise of the ChIP library. They incorporated the normalization factor into the Bernoulli probability of a binomial distribution for statistical test, and computed false discovery rate (FDR) by P-value correction. We extended their idea to a linear signalnoise model, in which a noise rate was introduced to represent the fraction of noise in the ChIP library. We developed an iterative algorithm to estimate the noise rate using a control library, and derived a library-swapping strategy for the FDR estimation. With spike-in simulation datasets, we showed the proposed iterative algorithm can well estimate the noise rate with relative error <5% under practical sequencing depth. Moreover, spike-in simulation also indicated that the library-swapping approach outperformed the P-value correction method in FDR estimation. We integrated our approaches in a general-purpose framework, named CCAT (Control-based ChIP-seq Analysis Tool), for the significance analysis of ChIP-seq. The CCAT framework wasPage: 1200 11991204
H.Xu et al.applied to the H3K4me3 and H3K36me3 datasets (), and identified significantly more ChIP-enriched sites than previous methods did. Quantitative RTPCR and comparison to gene annotation validated the reliability of CCAT predictions. With the high sensitivity of CCAT prediction, we revealed distinct chromatin features associated to the strong and weak H3K4me3 sites. In summary, our results imply that the weak sites detectable in a ChIPseq experiment were under-estimated in previous studies, and the identification of these weak sites may lead to novel discoveries of biological interest.
METHOD
The signalnoise model of ChIP-seqConsidering a control library with M uniquely aligned reads that were mapped to a genome of length L, the control profile can be represented as a vector of independent observations, where c  x refers to the number of control reads mapped to the genomic location x in direction  (x ; {+,}). Due to the random sampling process in ChIP-seq experiment, c  x approximately follow a Poisson distribution ():where u  x is a normalized factor such that x, u  x = 1. Next, we consider a ChIP library with N uniquely aligned reads. Similarly, the number of ChIP reads mapped to the genomic location x in direction , denoted d  x , follows a Poisson distribution:We modeled v  x to be the linear combination of the signal s  x and the noise n  x , such that:To employ the control library as independent observations of background noise, we made an assumption that the normalized control vectorfollow the same multivariate hyper distribution , which models the intrinsic read bias of ChIP-seq. The variation of  reflects slight differences of read bias between ChIP and control libraries, which could be introduced to the experiment prior to random sampling. Note that  is conditional on the chromatin structure, mapping bias and copy number variations. Therefore, the ChIP and control libraries need to be generated on the same cell type, with the same chromatin preparation procedure and identical configurations of alignment software. A line of evidence supporting the above assumption was given by. They generated scatter-plot of ChIP and control read counts on a list of genomic regions with no detectable ChIP enrichment. As the result, a linear and nearly symmetric scatter pattern was observed. For the convenience of description, we denote E to represent the set of genomic locations with real ChIP signal, hence E refers to the background with s + x = 0 and s  x = 0. Based on the signalnoise model and the assumption of intrinsic read bias, we have the following proposition:Proposition 1. Given a genomic region r =, and r  E, the observationfollow the same multivariate distribution under the hyperprior , if M = N. Proof of Proposition 1 is given in Supplementary Material of this article. This proposition indicates that the read counts from the control library provide unbiased measurements of the noise level in the ChIP library when the sample sizes satisfy the condition M = N. In this context, the parameter  is called noise rate, which ranges from 0 to 1 and refers to the fraction of noise in the ChIP library. Theoretically, the noise rate is associated with the normalization factor r 0 in, such that  = r 0 M/N.Generally speaking, a smaller noise rate implies better ChIP quality in the experiment. In the worst situations where the noise rate approaches 1.0, all the ChIP reads are noise hence no ChIP-enriched site is detectable. Therefore, estimation of the noise rate provides an assessment of the data quality (see Supplementary Material for more details), and further facilitates the subsequent significance analysis.
Estimating noise rateIf a set of background regions R is known in prior and there is sufficient reads in R, the noise rate can be approximated as the ratio of ChIP read counts to control read counts in these regions, normalized against the sequencing depths:Unfortunately, a predefined background region set is unavailable for most ChIP-seq applications.selected the background to be the regions with small read counts. However, due to the intrinsic bias of ChIPseq, the read counts may also be small for some ChIP-enriched regions and may be relatively large for some background regions. Therefore, a better solution is to determine the background by comparing the ChIP and control libraries, rather than by using the absolute read counts. In our approach, we first partitioned the whole genome into non-overlapping 1 kb bins. The background regions were then selected to be the bins with ChIP read counts less than the expected noise read counts estimated from the control. That is:Based on Equations (1 and 2), we propose an iterative algorithm for estimating noise rate. In our algorithm, the ChIP and control data were divided into two subsets: D + consisting of sense reads, and D  consisting of antisense reads. All the reads were shifted by l/2 bp towards their orientations, where l is the average DNA fragment length and could be approximated either experimentally or computationally (). In each step of iteration, a set of background regions were selected using D + , followed by updating noise rate using D . The iterative algorithm is described as follows. Initialization: divide the datasets into D + and D  ; partition the whole genome into non-overlapping 1 kb bins; set  0 = 1.0. The i-th iteration:(i) count the reads from D + for the bins, and select a set of background bins R * i based on Equation (2), where  0 =  i1 ; (ii) count the reads in D  for the bins in R * i and compute  i based on Equation (1). Termination:  i >  i1 or i larger than a threshold. In our test with real datasets, the above algorithm converged very fast within 10 iterations (Supplementary).
FDR estimation by library swappingSeveral tools have been proposed in the literature for ChIP-seq analysis with negative control (). In general, these tools perform three steps: (i) select candidate sites; (ii) rank sites based on certain significance measurement; and (iii) determine the cutoff threshold. Most methods predict ChIP-enriched sites based on the read counts in a local region. For these cases, steps (i) and (ii) can be represented as a function f that maps the read count vectors of a local region to a significance measure. Preferentially, the threshold in step (iii) is determined with FDR control. In this article, we take the form of pFDR (also called Bayesian FDR) proposed by. Given a significance function f , and a list of non-overlapping regions determined based on a threshold t, the pFDR is represented as: pFDR(t) = Pr(r  E|fIn Equation (3), r represents a genomic region, and c r and d r are the corresponding read count vectors, as defined in Proposition 1.Page: 1201 11991204
Signalnoise model for analysis of CHiP-seqBased on Proposition 1 and Equation 3, we have: Proposition 2. Under the conditions:(b) M = N;The pFDR for a threshold t can be approximated by:where the operator #{} is defined to be the total number of regions satisfying the condition. For the proof of Proposition 2, readers may refer to Supplementary Material of this article. Proposition 2 underlies a library-swapping strategy of FDR estimation, in which the null distribution of significance measurement is empirically estimated by exchanging the ChIP and control libraries, i.e. control versus ChIP. The library-swapping strategy was first introduced byin the software MACS (Model based Analysis for ChIP-Seq). However, as mentioned by, the estimated FDR would be biased if the read sample size from ChIP and control are not balanced. In Proposition 2, we give two necessary conditions for the correctness of library-swapping strategy. The first condition indicates that the significance function f need to be defined such that the distributions of fare wellseparated for the ChIP-enriched regions. For example, if we define fis the magnitude operator), the library-swapping strategy is not applicable since the distributions of fare identical. On the other hand, if we define flibrary-swapping is applicable for t >0 since we expect ffor most ChIP-enriched regions. The second condition, M = N, applies a constraint of sample size for ChIP and control, which explains the estimation bias with unbalanced sample size. When M = N, the constraint condition can be simply satisfied after a re-sampling procedure by which a subset of reads were randomly retrieved for processing. In detail, if N > M, we retrieve M/ ChIP reads and M control reads; otherwise, N ChIP reads and N control reads are retrieved.
The CCAT frameworkIn this section, we propose a general-purpose framework, named CCAT (Control based ChIP-seq Analysis Tool), for the significance analysis of ChIP-seq with negative control. The CCAT framework started with the estimation of noise rate  using the iterative algorithm, followed by a random re-sampling procedure to retrieve a subset of data that satisfies the condition M = N, as described in Section 2.3. Next, we exchanged the ChIP and control libraries of the re-sampled data to generate a swapped dataset. Both the re-sampled dataset and the swapped dataset were processed by a region identification module and a region scoring module (see below). A ranking list of candidate ChIP-enriched sites and a list of control sites were generated from the re-sampled dataset and the swapped dataset, respectively. Following Proposition 2, FDRs were estimated for the candidate sites using the control sites as reference. The flowchart of CCAT is shown in. In our implementation of region identification module, the ChIP-seq reads were first shifted by l/2 bp toward their orientations, where l is the average DNA fragment length. A sliding window was then applied to scan the whole genome. The size of the window was set to be 2l for applications to motifspecific transcription factors, and ranged from hundreds to thousands base pairs for histone modification study. The shifted ChIP reads and control reads were counted within the window in each step of sliding. We flagged the genomic position at the center of the window if the ChIP read count was more than twice the control read count, corresponding to a minimum expected signalnoise ratio of 1.0. Consecutive flagged positions were merged into non-overlapping candidate regions. Although the ChIP-enriched sites were defined in term of regions in CCAT, we also applied a peak-finding algorithm () to each candidate region for a high-resolution), Poisson P-value (), and normalized difference score (). Details of these scores are given in the Supplementary Material.
a
RESULTS
Spike-in simulationTo define a standard that is comprehensive enough for the evaluation of computational approaches, we generated spike-in datasets to assess the accuracy of noise rate estimation and FDR estimation. The idea of 'spike-in' here is to computationally add ChIP-enrichment signal to a control background, so that the spike-in loci can be referred as standard in the evaluation (). Two Nanog ChIP-seq datasets published by different groups () were included for generating spike-in
H.Xu et al.the spike-in ChIP and control libraries were retrieved from different sources in order to better simulate the real ChIP-seq experiment, in which the control was prepared with a different antibody or simply input DNA without antibody. All the libraries used for the spike-in dataset were prepared on mESC (mouse embryonic stem cell), and were mapped by Eland software with identical configurations (26 bp, 2 mismatches). In addition to the Nanog data, we also generated H3K4me3 spike-in data in the same manner. A total of 19 631 spikein regions were defined based on Marson et al.'s H3K4me3 dataset (2008), and 3 171 004 spike-in reads were retrieved from another dataset published by. A summary of the libraries included for the spike-in data generation is provided in Supplementary Table S1. To assess the accuracy of noise rate estimation, different proportions (10%, 20%,  ,100%) of GFP library were used as the background for spike-in. Therefore, the real noise rate equals to the fraction of GFP reads in the spike-in ChIP library. In, the relative estimation error of the iterative algorithm was plotted against the actual noise rate. We found the errors are positive in most of the cases, implying over-estimation of noise rate. The explanation is that some of the background regions determined by Equation (2) contain weak but undetectable signal due to the issue of sequencing depth. Nevertheless, the relative errors are <5% under the practical sequencing depth, indicating the proposed iterative algorithm reasonably estimated the noise rate. Comparing to the noise rate derived from Ji et al.'s normalization factor, our estimation also achieved better accuracy (Supplementary). Next, we compared the library-swapping based FDR estimation with previous methods. To date, the approaches of FDR estimation for control-based ChIP-seq data mainly fall into two categories:(i) correcting binomial P-values using BenjaminiHochberg (BH) correction () or Storey's method (); (ii) estimating expected fraction of false positives by generating empirical background. The library-swapping approach mentioned in Section 2.3 belongs to the latter. Another example of the second category is the eFDR proposed by. To calculate eFDR, control library were randomly split in two halves. The eFDR was estimated as the ratio of the number of control-enriched regions (control 1 versus control 2) to the number of experimentally observed enriched regions (ChIP versus control2). To assess the accuracy of FDR estimated by different approaches, we employed a spike-in datasets configured as follow: 3 million GFP reads were randomly retrieved and were merged with the Nanog or H3K4me3 spike-in reads to generate ChIP library; 3 million WCE reads were used as control (for eFDR, additional 3 million WCE reads were used as an alternative control). By this configuration, the sample sizes of ChIP and control were balanced. The whole genome was partitioned into 1 kb non-overlapping regions and the FDR were calculated on the region basis. For a fair comparison, we used binomial P-values as the significance score for all methods. Prior to calculating P-value, we followedsuggestion to exclude the regions with read counts smaller than 10. This filtering step is necessary for P-value correction methods, which assume that the P-values are uniformly distributed under null hypothesis. The accuracy of FDR estimation was compared in a dynamic range from 0.001 to 0.2. The results are largely consistent for Nanog () and H3K4me3 () spike-in datasets. We found that the empirical approaches significantly outperformed the
P-value correction methods, for which the FDR was constantly overestimated. Although both empirical approaches performed well when FDR >0.01, eFDR appeared a non-linear characteristic of estimation bias, and under-estimated when FDR <0.01. This may ascribe to slight bias between GFP and WCE libraries prior to random sampling. Such bias could not be modeled using the empirical background that was generated by control splitting. On the contrary, the library-swapping approach seemed to reasonably compensate this type of bias and achieved satisfactory performance both in accuracy and linearity.
Application to histone modification datasetsWe applied CCAT to the mESC H3K4me3 (K4) and H3K36me3 (K36) histone modification datasets (). The GFP library published bywas used as the Page: 1203 11991204negative control. In literature, K4 was known to be a promoter marker and K36 has been shown to occupy the gene region as a hallmark of elongation (). Our previous study also showed the gene expression is potentially predictable from K4 and K36 marks (). Based on a better measurement of ChIP-seq background level and more reliable FDR estimation, the purpose of our application is to study the weak K4 and K36 sites that may not be predictable by previous methods. In CCAT configuration, we used the normalized difference score () as the significance measure. The FDR cut-off was set to be 0.05. The size of sliding window was set to be 500 bp for K4 and 2 kb for K36. This setting was determined due to the fact that K4-enriched sites usually appear peak patterns, while K36 signals spread broader regions. As the result, we identified 64 012 K4 regions, corresponding to 75 620 individual peaks (Supplementary). For K36, 19 042 K36 regions were identified (Supplementary). To assess the sensitivity, we overlapped CCAT identified regions with the UCSC histone modification track (http://genome.ucsc.edu/) predicted by, as well as the predictions by a recently published tool PeakSeq (), with FDR = 0.05. As shown inand b, CCAT predicted 100% more K4 sites and 70% more K36 sites than these two methods did. We further extended our comparison to include MACs () and SICER (). Again, pair-wise comparison showed that the CCAT prediction is highly sensitive and almost forms a superset of the predicted sites by the other methods, for both K4 and K36 datasets (Supplementaryand Supplementary Material). Next, we tested the reliability of our predictions, i.e. specificity. For K4, we randomly selected 15 sites from 32 600 regions exclusively identified by CCAT in, and validated them using quantitative real-time PCR (qPCR). Ten negative control sites were selected from the genomic regions outside the predicted K4 regions. The qPCR validation results showed that 14 out of 15 predicted sites are ChIP-enriched with >3-fold-change against the median value of controls (Supplementary). For K36, we employed annotated gene regions as reference since K36 is known to mark transcription elongation. A total of 8176 K36 regions exclusively identified by CCAT in, which are mostly weak in intensity, were compared to three gene annotation databases: RefSeq, Ensembl and MCG. We found 7556 (92.4%) of these regions overlap with the genes annotated by at least one database (Supplementary), implying that the weak K36 signal is biologically meaningful and may reflect low-abundant gene expression. By traditional arguments, H3K4me3 sites are markers of promoters. Surprisingly, only 26 902 (35.6%) out of 75 620 predicted K4 peaks overlap with known promoters (1 kb from TSS), and majority of the promoter-associated K4 peaks are in the top 20 k of the ranking list. To understand the chromatin features associated with weaker K4 sites, we ranked the K4 peaks in descending order of intensity (ChIP read counts within 1 kb), and compared the list to other two histone modification types: H3K27me3 and H3K4me1 (). The ChIP-seq datasets published bywere employed for the comparison. We found H3K27me3 signals are enriched for the K4 peaks ranked from 10 to 20 k, corresponding to the K4K27 bivalent domains that have been proven to be crucial to maintain to pluripotency of ESC (). Meanwhile, H3K27me3 intensities of the top 10k peaks are relatively low in average. We also observed that H3K4me1, an enhancer marker in mammalian cells (), is enriched for the peaks ranked after 20 k, and is almost depleted for the top-ranking peaks. Therefore, in addition to the traditional arguments on H3K4me3, these lines of evidence suggest distinct chromatin features associated with strong and weak K4 sites. As a hypothesis, the weak K4 signals in the enhancer regions may ascribe to the DNA-loop-mediated interactions of enhancers and promoters.
Signalnoise model for analysis of CHiP-seq
DISCUSSIONThe goal of the research work presented in this article is to investigate the extent to which the weak ChIP signals are detectable in a ChIP-seq experiment. For this purpose, we proposed a linear signalnoise model for ChIP-seq analysis with negative control. The noise rate defined in the model provides a measurement of the data quality, which determines the capability of ChIP-seq to detect weak ChIP-enriched sites. We developed an iterative algorithm to estimate the noise rate using control library, and derived a library-swapping approach for FDR estimation. The performance of the proposed approaches was demonstrated with spike-in datasets. These approaches, integrated in the CCAT framework, were further applied to H3K4me3 and H3K36me3 datasets, and identified significantly more weak sites than previous predictions. Two reasons count for the improvement of sensitivity: first, the estimation of noise Page: 1204 11991204
H.Xu et al.rate led to a better measurement of background noise level, which was overestimated by commonly used approach of 'normalization against sequencing depth'; secondly, as shown in the spike-in simulation, the library-swapping approach improved the accuracy of FDR estimation, for which the previous P-value correction methods are too conservative. Our results showed that the weak ChIP-seq signals may correspond to different genomic features from that of strong signals. Therefore, studying the weak signals could extend the scope of biological discoveries made from ChIP-seq data. Besides our example on histone modifications, another interesting topic is to study the weak transcription factor binding sites (TFBS), which possibly implicate the indirect binding mediated by TFTF interactions. We expect the CCAT framework would facilitate such study in the future. A major drawback of CCAT is that only a portion of the original dataset was utilized due to the re-sampling procedure. One solution to this problem is to use a bootstrapping strategy in the region scoring module. The option of bootstrapping is provided in the software package of CCAT. In detail, the original dataset is re-sampled using different random seeds, and the scores of candidate regions are recomputed for a number of bootstrapping passes. The final score for a region is the median of the scores computed in all the bootstrapping passes. By this, the sensitivity and specificity of the ranking list can be improved. A point of note is that the FDR could be slightly over-estimated when the bootstrapping strategy is used.
The Author 2010. Published by Oxford University Press. All rights reserved. For Permissions, please email: journals.permissions@oxfordjournals.org 1199 at :: on August 31, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
at :: on August 31, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
