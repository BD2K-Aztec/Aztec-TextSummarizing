Motivation: Simulation under the coalescent model is ubiquitous in the analysis of genetic data. The rapid growth of real data sets from multiple human populations led to increasing interest in simulating very large sample sizes at whole-chromosome scales. When the sample size is large, the coales-cent model becomes an increasingly inaccurate approximation of the discrete time Wright-Fisher model (DTWF). Analytical and computational treatment of the DTWF, however, is generally harder. Results: We present a simulator (ARGON) for the DTWF process that scales up to hundreds of thousands of samples and whole-chromosome lengths, with a time/memory performance comparable or superior to currently available methods for coalescent simulation. The simulator supports arbitrary demographic history, migration, Newick tree output, variable mutation/recombination rates and gene conversion, and efficiently outputs pairwise identical-by-descent sharing data.
IntroductionThe coalescent () can be constructed as an approximation of the discrete time Wright-Fisher process (DTWF,), and leads to simplified analytical and computational treatment. Simulators based on the coalescent process (e.g.) have been extensively adopted in computational methods. The coalescent approximation, however, relies on the assumption that the sample size is small compared with the effective population size, and violations of this assumption may result in substantial distortions of key genealogical properties (). Until very recently, coalescent simulators did not scale up to long chromosomes and the very large sample sizes of modern day data sets, which now comprise hundreds of thousands of individuals. The recently developed simulators COSI2 () and SCRM () enable fast simulation under approximate coalescent models. The COSI algorithm uses a standard backwards-in-time approach, while SCRM adopts a 'sequential' approach (). Both can be also used to simulate large sample sizes and chromosomelong regions under the 'exact' coalescent process with reasonable time and memory requirements. Here, we present ARGON, an efficient simulator of the DTWF process that scales up to very large chromosomes, and hundreds of thoudsands of samples. The simulator offers substantially improved performance compared with recent DTWF simulators, e.g. GENOME (), and is comparable or superior to current coalescent simulators in terms of speed and memory usage. population structure and migration. Each individual is represented as a list of regions for which not all samples have found a common ancestor. Crossover and non-crossover recombination events are sampled in genetic space and rounded to the closest physiscal base pair position based on the desired uniform or variable recombination rate. Whenever a coalescence occurs, regions within individuals are annotated with links to descendant nodes in the ancestral recombination graph (ARG). When compared with other DTWF implementations (e.g. GENOME), ARGON offers substantially improved speed and memory usage (see Supplementary Materials). In ARGON, large regions are represented as intervals with arbitrary boundary values, and hash map data structures are extensively used to take advantage of sparsity, avoiding explicit representation of all individuals. ARGON can run in approximate mode, so that recombinations breakpoints are rounded to blocks of a user-specified genetic length, as implemented in the GENOME simulator. This reduces the granularity of the recombination process, improving speed and memory usage, at the cost of slightly inflated correlation of nearby markers. ARGON can efficiently output a list of identical-by-descent (IBD) segments, which are delimited by the occurrence of recombination events that change the most recent common ancestor for pairs of samples. In ARGON, these events are detected by visiting internal ARG nodes, while previous approaches to output simulated IBD sharing data (e.g.) required comparing recent ancestry for all pairs of individual at each marginal tree.
Results
Accuracy for small sample sizesWhen n ( N e , the coalescent is a good approximation of the DTWF. We performed extensive testing for several scenarios including population size variation, migration across multiple demes, and gene conversion. We report detailed results in the Supplementary Materials. We find good agreement between ARGON and MS. We also tested the accuracy of COSI version 2.0, SCRM version 1.6.1, and MSprime version 0.1.6 (), a new efficient simulator for which a preliminary version was released at the time of writing. All simulators were found to be well calibrated against MS.
Deviation of the coalescent from the DTWFThe coalescent becomes a poor approximation of the DTWF process when the sample size is not substantially smaller than the effective population size (). We verified that ARGON matches the theoretical prediction for the number of singletons and doubletons described infor the DTWF (see). We simulated populations of effective size N e  1000 and N e  20 000 haploid individuals, and sampled all present-day individuals. While ARGON matches the prediction ofin both exact and approximate mode, coalescent simulations substantially deviate from the DTWF model.
Scalability to large sample size and wholechromosome lengthWe tested the run time and memory usage of ARGON and two recently developed programs that enable simulating very large sample sizes and long chromosomes: COSI2 and SCRM (see). We find that for large parameter values SCRM generally performs worse than ARGON. COSI2 is generally faster, but scales poorly for memory usage as the size of the region and the sample size grows. Additional tests, including a pre-release version of MSprime, are detailed in the Supplementary Materials. We further tested the performance of approximate algorithms for the same set of simulation parameters (see). We compared ARGON with a minimum recombination block size of 10 lm (AR 10 ), SCRM with the 'l' flag set to 0 (SC 0 ), and COSI2 with the 'u' flag. Comparison of simulation algorithms with respect to chromosome length (Mb), exponential expansion rate (q), sample size (n), and ancestral population size (A)Simulation parameters and setup are detailed in the Supplementary Materials. DTWF and coalescent algorithms: AR, ARGON; SC, SCRM; CS, COSI2; approximate algorithms: AR 10 , ARGON with minimum recombination block of size 10 lM; SC 0 , SCRM with; 'l' set to 0; CS 0 , COSI2 with 'u' set to 0;  represents runs terminated due to insufficient memory (>60Gb) or a memory error; * indicates that the program took longer than 100 h to complete.Errors are obtained as 100  h s  h t =h s , where h s is the average simulation result and h t is the theoretical expectation. The 6 sign introduces a SE. set to 0 (CS 0 ). We find that ARGON's speed and memory usage is substantially improved, at the cost of slightly inflated correlation for neighboring markers (see Supplementary Materials). For a constant population of size N e  20 000, for instance, squared correlation (r 2 ) of markers 0 to 50 Kb apart (using 1 cM/Mb) was increased by $27% for AR 10 , but remained unchanged for markers at a larger distance. For CS 0 and SC 0 , r 2 was decreased by $5% for markers at a larger distance. AR 10 is faster than SC 0 , and approximately as fast as CS 0 , and uses less memory than both simulators for the large values of the test parameters. Comparison to other simulators and additional tests are detailed in the Supplementary Materials.
Approach ARGON proceeds backwards in time one generation at a time, occasionally sampling coalescent and recombination events subject to V C The Author 2016. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com 1 Bioinformatics, 2016, 13 doi: 10.1093/bioinformatics/btw355 Advance Access Publication Date: 16 June 2016 Applications Note Bioinformatics Advance Access published July 19, 2016 at University of California, Los Angeles on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
P.F.Palamara at University of California, Los Angeles on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
at University of California, Los Angeles on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
