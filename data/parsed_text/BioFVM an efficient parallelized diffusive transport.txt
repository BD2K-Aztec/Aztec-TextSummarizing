Motivation: Computational models of multicellular systems require solving systems of PDEs for release , uptake, decay and diffusion of multiple substrates in 3D, particularly when incorporating the impact of drugs, growth substrates and signaling factors on cell receptors and subcellular systems biology. Results: We introduce BioFVM, a diffusive transport solver tailored to biological problems. BioFVM can simulate release and uptake of many substrates by cell and bulk sources, diffusion and decay in large 3D domains. It has been parallelized with OpenMP, allowing efficient simulations on desk-top workstations or single supercomputer nodes. The code is stable even for large time steps, with linear computational cost scalings. Solutions are first-order accurate in time and second-order accurate in space. The code can be run by itself or as part of a larger simulator. Availability and implementation: BioFVM is written in C þþ with parallelization in OpenMP. It is maintained and available for download at http://BioFVM.MathCancer.org and http://BioFVM.sf.net under the Apache License (v2.0).
IntroductionMathematical modeling of many biological systems requires solving for secretion, diffusion, uptake and decay of multiple substrates in three dimensions. Cells change phenotype (division rate, metabolism, secretions, etc.) in response to their microenvironment; the spatial distribution of cells (and their uptake and secretion of substrates) alters the substrates' distribution, affecting later cell behavior (with zero flux conditions on oX. Here, X is the computational domain with boundary oX; ~ q is the vector of substrate densities, ~ q  are the substrate saturation densities, ~ D are the diffusion coefficients, ~ k are the decay rates, ~ S and ~ U are the supply and uptake rates (may vary throughout the domain), f~ x k ; W k ; ~ S k ; ~ U k ;~ q  k  : 1 k Ntg is a collection of cells centered at ~ x k with volume W k , supply and uptake rates ~ S k and ~ U k and saturation densities ~ q  k. 1 k ~ s is defined by 1 k ~ x  1 inside cell k and 1 k ~ x  0 otherwise. All products of vectors are element-wise. While most multicellular models [e.g. Morpheus (), Chaste (include diffusion solvers, they generally are not designed to scale well to large 3D domains with more than a few substrates. Most are not designed for multithreaded parallelization on multicore desktops. The solvers tend to use explicit time steppings (require strict stability restrictions on Dt) or implicit time steppings (stable but require inverting large matrix systems).
1256This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (http://creativecommons.org/licenses/by-nc/4.0/), which permits non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited. For commercial re-use, please contact journals.permissions@oup.com
Method and implementationWe use a first-order, implicit (and stable) operator splitting, allowing us to create separate, optimized solvers for the diffusion-decay, cell-based source/sinks and bulk source/sinks (). We solve the diffusion-decay terms using the finite volume method (), further accelerated by an additional firstorder splitting into separate solutions in the x-, y-and z-directions via the locally one-dimensional method (LOD) (). For each dimension, we solve the resulting tridiagonal linear systems with the Thomas algorithm (). We use OpenMP where loops can be parallelized (e.g. many instances of the Thomas solver when solving x-diffusion across multiple strips of domain). Other optimizations include storing pre-computations and overloading vector operations. The C  implementation is described in further detail in the supplementary materials.
Examples
Oxygen and VEGF diffusion in a large tissueIn, we simulated 1 hour of diffusive transport in 125 mm 3 of vascularized tissue (red curves, panel A) with a large irregular tumor (green cells, panel A) at 20 lm resolution (15 625 000 voxels) and Dt  0:01 min. Oxygen is released by the vessels (a series of cell-centered sources), diffuses through the tissue and is consumed by tumor cells. For technical illustration, tumor cells release VEGF where pO 2 < 15 mmHg, which diffuses through the domain. Further biology, parameter values and references are discussed in the supplementary materials. In panel A, the vasculature is rendered up to the gray clipping plane for clearer illustration. Panel B shows the tumor cells and vessels in the gray clipping plane. Panels CD shows the concentration of oxygen and VEGF in this plane. The red contour marks the tumor boundary. This simulationwith 2.8 million cell source/sink termsrequired $ 80 minutes on a quad-core desktop computer (Intel i7 4790, 3.60 GHz, 16 GB of memory); similar problems on 1 million voxels require 510 min.
Convergence testingTests for several 1D and 3D problems showed first-order accuracy in time, second-order accuracy in space and stability even for large time steps. Using Dt  0:01 min gave reasonable accuracy for most problems. The convergence tests are fully detailed in the supplementary materials.
Performance testingWe tested diffusion of N  1 to 128 substrates with D $ 10 5 lm 2 = min (typical magnitude for cancer biology) in a 1 mm 3 domain at 10 lm resolution (1 million voxels) with Dt  0:01 min. Computational cost (wall time for 4 min of diffusion) scaled linearly with N; increasing from 1 to 10 substrates increased computational cost by $ 2:6. In other tests, computational cost scaled linearly with the number of voxels (domain size) and the number of cells. Full results are in the supplementary materials.
at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
Obtaining software and licensing BioFVM is available from BioFVM.MathCancer.org and BioFVM. sf.net under the Apache License (v2.0). A tutorial on using the code is included with the BioFVM download, along with several examples. 5 Discussion BioFVM can efficiently and accurately simulate several diffusing substrates in large 3D domains, with both bulk and cell-based source and uptake terms. While it can run on its own (with minimal software dependencies), it is well-suited for inclusion in larger modeling packages. Beyond simulating the transport of drugs and growth substrates, BioFVM's ability to simulate dozens of compounds should make 3D simulations of multicellular secretomics and multiscale cell responses feasible. In future releases, we plan to add upwinded advective solvers, more adaptive time stepping for cell-based source/sink terms and support for general Voronoi meshes.
