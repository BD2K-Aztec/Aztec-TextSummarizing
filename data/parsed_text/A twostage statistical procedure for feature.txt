Motivation: With the advance of new sequencing technologies producing massive short reads data, metagenomics is rapidly growing, especially in the fields of environmental biology and medical science. The metagenomic data are not only high dimensional with large number of features and limited number of samples but also complex with a large number of zeros and skewed distribution. Efficient computational and statistical tools are needed to deal with these unique characteristics of metagenomic sequencing data. In metagenomic studies, one main objective is to assess whether and how multiple microbial communities differ under various environmental conditions. Results: We propose a two-stage statistical procedure for selecting informative features and identifying differentially abundant features between two or more groups of microbial communities. In the functional analysis of metagenomes, the features may refer to the pathways, subsystems, functional roles and so on. In the first stage of the proposed procedure, the informative features are selected using elastic net as reducing the dimension of metagenomic data. In the second stage, the differentially abundant features are detected using generalized linear models with a negative binomial distribution. Compared with other available methods, the proposed approach demonstrates better performance for most of the comprehensive simulation studies. The new method is also applied to two real metagenomic datasets related to human health. Our findings are consistent with those in previous reports. Availability: R code and two example datasets are available at
INTRODUCTIONRecently next-generation sequencing technologies are able to produce high volumes of data at an affordable cost (). The power of next-generation sequencing makes it possible to explore microbial environments, opening a new era of genomics study, called metagenomics (). Metagenomics is the study of genomic contents of microbial communities sampled directly from environments (e.g. soil, water, human gut) without prior culturing to understand the true diversity of microbes, their functions, cooperation and evolution in different microbial communities (; Wooley and Ye 2010). Importantly, because only $1% of all microbial organisms can be isolated and cultured in a laboratory, metagenomic analysis enables to reveal the genome contents of the majority of microorganisms that cannot be obtained in traditional genomic analysis based on pure culture (). Metagenomics is broadly applicable to many areas, including ecology and environmental sciences, chemical industry and biomedicine (). In metagenomic analysis, one important aim is to assess whether and how two or more microbial communities differ. To perform metagenomic comparison, researchers can conduct an experiment to compare genomic features based on either taxonomic compositions or functional components obtained from different microbial communities. In this study, we focus on comparison of functions in metagenomes under various conditions. The applications of this research include detection of biological threats and discovery of new bioenergy and new medicine, and so on. For example, comparing microbial communities from human gut corresponding to different phenotypes (e.g. diseased and healthy, or different treatments) can help us determine the activities of microbes related to the disease, resulting in understanding the reactions of microbes that respond to different biochemical products. This may lead to drug development or treatment selection that specifically affects either a particular activity or a group of activities that the disease-related microbes might perform. Statistical procedures play a critical role in detecting differentially abundant features across different microbial conditions. The features here may refer to taxa, functional roles, pathways, or subsystems. Several statistical methods or tools have been developed to compare various microbial communities in terms of detecting differentially abundant features, e.g. SONs (), XIPE-TOTEC (), Metastats () and MEGAN (). However, all of these methods/tools are designed to compare exactly two microbial conditions; ShotgunFunctionalizeR uses a regression method on comparing multiple samples () but it assumes Poisson *To whom correspondence should be addressed. distribution on the count data. It is well known that Poisson model lacks flexibility for over-dispersed count data (). Another method, metagenomeSeq (), has been recently developed to assess differential abundance in sparse high-throughput microbial marker-gene survey data. Even though it can compare multiple conditions, metagenomeSeq is designated for comparison of taxonomic compositions of different metagenomes, rather than functional compositions. In this research, we focus on statistical comparison of functions in metagenomes under various conditions. Statistical methods developed for RNA-Seq analysis may be applicable to metagenomic analysis also, as both RNA-Seq experiments and metagenomic experiments use sequencing technologies and produce count data. A number of statistical tools have been developed for RNA-Seq data analysis, such as edgeR () and DESeq (). However, there are differences between RNA-Seq data and metagenomic data. Different from RNA-Seq data, one of the common characteristics of metagenomic data is the presence of many features with zero counts. It is because metagenomic samples consist of a mixture of microbes, the species-specific functions may only appear in some microbial conditions, while in typical RNA-Seq experiments the genes are the same for different experimental conditions, and only expression levels change. Thus, metagenomic sequencing data may be more sparse than the RNA-seq data. Our research was motivated by (i) the limitations of existing methods developed for metagenomic analysis, (ii) the increasing focus of metagenomic projects on wide applications in various areas [e.g. Human Microbiome Project (HMP,and (iii) the limitations of applying current methods developed for RNA-Seq analysis to metagenomic analysis. In this article, we propose a two-stage statistical algorithm for selecting informative features and detecting differentially abundant functional features (e.g. pathways, subsystems, functional roles) between different microbial conditions. In the first stage of our algorithm, the informative features are selected using elastic net () resulting in dimensional reduction of the metagenomic dataset. In the second stage of our approach, we detect differentially abundant features using generalized linear models (GLMs) with a negative binomial (NB) distribution (). In sparse data, elastic net is a satisfactory variable selection method in the case that the number of predictors (p) is much bigger than the number of observations (N), that is, when p 4 4 N. In addition, another advantage of elastic net is that it is well suitable to data containing a grouping effect, i.e. strongly correlated predictors tend to be in or out of the model together (). The NB distribution is widely used to model count data. The novelty of our two-step method is that we take the common characteristics of metagenomic data into account and combine the feature selection and feature comparison in metagenomic study to improve the power of feature detection. Our method can be directly applied to comparison of more than two microbial conditions. Therefore, our method can be applicable to more general situations, e.g. in clinical trials where the goal is to compare multiple treatment conditions or in natural environmental studies where multiple conditions are compared and investigated.
METHODSOur approach requires (i) a metagenomic dataset corresponding to two or more conditions/phenotypes (e.g. diseased and healthy human guts, or different locations of sea water); each condition/phenotype consists of multiple individuals (or samples), and (ii) each sample/individual consists of count data representing the relative abundance of features, or number of shotgun reads mapped to a specific biological pathway or subsystem. Our goals are to determine a set of informative features associated with a particular phenotype and to identify statistically significant features whose abundance is different among different conditions/ phenotypes.
Data normalizationDue to the high-throughput sequencing technologies, an arbitrary number of reads with large variation across samples is generated under the sampling process. That is, a common source of bias in a metagenomic count data is owing to different sequencing depths or various magnitude of the read counts across multiple individuals (or samples). To proceed with any statistical analysis, a preprocessing of the metagenomic count data is necessary to account for this source of bias, i.e. normalizing the samples to make them comparable. For the data normalization, we used the trimmed mean of M-values (), which is implemented in the edgeR Bioconductor package.
Two-stage statistical procedureIn the proposed two-stage statistical algorithm, informative features are simultaneously selected in the first stage, and then the selected features obtained from the first stage are used as the input for the second stage. Differentially abundant features between metagenomic conditions/phenotypes are detected in the second stage.
First stagefeature selection using elastic netThe first stage aims to detect informative features associated with a particular phenotype. This results in the dimensional reduction of the metagenomic data. As outlined in the introduction, the metagenomic data consist of relative abundances where low abundant microorganisms may be missed owing to the sampling process. A statistical method is needed to deal with a sparse data with the presence of a large percentage of zero counts. Elastic net, an algorithm for estimation of GLMs with elastic-net penalties, enables to deal efficiently with sparse features (). For the first stage, assume there are p features and N samples. Let a T s =a 1s ; a 2s ;. . .; a ps  represent the vector of count values for p features in the sample s (s = 1,. .. N), and the phenotype of sample s is denoted by g s , which takes values from {1, 2,. .. , K} and K is the total number of phenotypes or categories. For example, when there are only two phenotypes (e.g. diseased and healthy), K = 2 and g s 2 f1; 2g.
Algorithm for elastic netIn a linear model, let G represent the response variable (e.g. phenotype status) and A represent the predictor variables, then the regression function is typically determined by EGjA=a= 0 +a T , where a is a realization of the predictors. For N observation sets a T s ; g s  s = 1,. .. , N, the elastic net solves the following problemis the elastic-net penalty () and is a compromise between the ridge regression penalty ( = 0) and the lasso penalty ( = 1). The elastic net model with = 1  " for some small " (" 4 0) performs much like the lasso, but ignores behavior caused by extreme correlations. This model will tend to pick one feature and ignore the rest if the features are correlated. On the other hand, the elastic net model with = 1  " for some large " (" 4 0) performs much like the ridge regression, which is known as a regression model to shrink the coefficients of correlated predictor variables toward each other, resulting them to borrow strength from each other. The coordinate descent step used to solve (1) is detailed in Friedman et al. (2010).
Regularized multinomial regressionWhen the response variable is binary (K = 2), the linear logistic regression model is often used. When the categorical response variable G takes multiple values (K42), the linear logistic regression model can be generalized to a multi-logit model. The class-conditional probability is represented through a linear function of the predictors:Here l is a p-vector of coefficients, and the parameters (s) are computed by solving the penalized multinomial log-likelihood problem:where is a tuning parameter and will be determined as below.Selecting the tuning and parameters for regularization path As shown in (1), two types of constraints (lasso and ridge constraints) on the parameters are used in the elastic net. The parameter controls the relative weight of these constraints. The lasso constraints allow for the selection/removal of variables in the model, while the ridge constraints can deal with correlated predictor variables. In our approach, as the second step can deal with feature detection, in the elastic net step we put more weight on the ridge constraints to deal with correlated features. We use grid search for in, and for each parameter , the corresponding was determined by cross-validation (CV) (). The values for the parameters and that yield the lowest CV error were selected.Second stagedifferentially abundant feature detection The second stage of our algorithm is to detect features, which are statistically differentially abundant in two or more conditions. From examining real metagenomic count data, we discovered that the variance exceeds the corresponding mean of the feature abundance (detailed in Supplementary S1S4). NB distribution, a commonly used model for count data with overdispersion, is used to take the overdispersion into account ().
NB modelAssume r of p features are selected from the first stage. Let Y be the vector of the numbers of reads for feature i in all samples where i = 1, 2,. .. , r. Each element (y s ) in Y can be modeled by NB distribution:with mean Ey s = s and variance vary s = s 1+ s =. The variance is quadratic in the mean. The NB distribution can also be reparameterized in the term of dispersion by letting =1=. Then, the count y follows NB with mean = s and variance = s (1 + s ), where denotes the dispersion parameter. The farther falls above 0, the greater the overdispersion relative to Poisson variability. Clearly, when ! 0, the NB distribution reduces to the usual standard Poisson distribution with parameter s. In GLMs, the most convenient way to link the mean response of NB variable to a linear combination of the predictors X is the log link, as in Poisson loglinear models, for each feature i (i = 1, 2,. .. , r), log s =x T s , where x T s is 1  K row vector of indicator variables for the phenotypes, s = 1, 2,. .. , N, K represents the number of phenotypes in the dataset and is the corresponding K  1 column vector of unknown regression parameters (note: here is different from the coefficient(s) in the first stage. We still use the same symbol for the purpose of regression models). The covariates can be introduced into a regression model based on the NB distribution via the relationship log s = X K j=1
x sj j1 6In the NB model for mean s =expx T s , and are estimated by maximizing the log-likelihood function:More details on regression models for NB responses can be found inHypothesis testing of model parameters in phenotype comparison for each feature To test the null hypothesis H 0 : 1 = 2 =. .. = K-1 = 0, denote the maximum value of likelihood function by ' 0 under H 0 , and ' 1 under H 1 , which states that at least one coefficient j 6  0. H 0 stands for no phenotype effect, i.e. the feature is not differentially abundant across different phenotypes. The likelihood ratio test statistic is:where L 0 and L 1 are the logarithms of maximum likelihood functions. Under H 0 this test statistic has an asymptotically chi-squared distribution with K  1 degrees of freedom.Multiple test correction A typical metagenomic dataset consists of several hundreds or thousands of features. After comparing multiple metagenomic groups using GLMs with the NB canonical logarithmic link function for simultaneous comparison, we used BenjaminiHochberg's procedure () to control the false discovery rate (FDR) at significance level of 0.05.
SIMULATION STUDIESBecause of high similarity between RNA-Seq and metagenomic data, the statistical methods developed for RNA-Seq data in detecting differentially expressed genes may be applicable to the analysis of metagenomic data. For this reason we compared our method with two widely used statistical packages for RNA-Seq analysis, edgeR and DESeq, in addition to metagenomeSeq. As Metastats approach can only be used to compare two conditions/phenotypes, we also evaluated its performance in the following designs of two-condition or-phenotype comparison.
Experimental dataTo make simulated data to reflect the nature of real metagenomic data we examined several types of real datasets from various environmental sources, including human gut, ocean, soil and fresh water (Supplementary), and obtained the means and variances of feature abundance in these studies. Interestingly, we observed strong linear relationships between the log 10-transformed means of the feature abundances and the log 10-transformed variances of abundances (Supplementary Figs S1S4). Experimental Design 1 (two-condition comparison + fixed parameters for simulating data) We designed a metagenomic simulation study in which samples are drawn from two conditions. Because the sample size affects the performance of statistical methods, we designed metagenomic datasets with various sample sizes, including 10, 25 and 50 subjects drawn from each population. For each dataset, counts were generated using NB distributions, with different means () and variances ( 2 ). The means () of the NB distributions were selected by random sampling from the ranges of the means for the abundances in four simulation settings (), and then the corresponding variances were computed from the following function: log 10  2 = 0 + 1  log 10   9 (In the first experiment let 0 = 0.6 and 1 = 1.8, which are from the observation of four real metagenomic datasets; details can be found in the supplementary file. In next two experiments, we will relax these two values). In each dataset, we simulated 1000 features for each sample of two conditions from NB distributions; 950 of them were generated from the same NB distribution, i.e. 1 = 2 with the corresponding variances computed by (9), and the rest 50 were generated from two different NB distributions, i.e. a  1 = 2 , where the parameter a (i.e. multiplier) is selected from the set of 1.5, 2.5, 5, 7.5 and 10. To prevent bias arising from a specific partition, we simulated the datasets 100 times for each sample size. The performance of four methods were compared using the 'area under the curve' (AUC) metric of a receiver operator curve (ROC), and the true-positive rate (tpr, i.e. power) were calculated at each level of FDR. Experimental Design 2 (two-condition comparison + varied parameters for simulating data) Different from the first experimental design where the values of 0 and 1 are fixed, the second experiment allows these two parameters to vary. They were determined by random sampling from the ranges ofand, respectively. These ranges of the estimates for 0 and 1 were obtained from observing real metagenomic data (details in Supplementary). As the setting 4 resembles most to the nature of real metagenomic dataset, in the second experiment we flexed the 0 and 1 on this setting. Similar to the first experiment, we simulated 1000 features for each sample of the two conditions from NB distributions: 950 of them were generated from the same NB distribution, and the rest were from two different NB distributions. Experimental Design 3 (three-condition comparison + varied parameters for simulating data) In this experiment the samples were drawn from three conditions. The parameter settings for 0 and 1 are as same as the Experimental Design 2. For each sample under different conditions we simulated 1000 features from NB distributions: 950 of them were generated from the same NB distribution, and the rest 50 features were from different NB distributions. That is, at least two NB distributions (representing two conditions) of three distributions are different for each of these 50 features.
Simulation resultsResults from Experimental Designs 1 and 2 ROC curve is usually used in measuring signal detection. It is created by plotting the true-positive rate versus the false-positive rate. AUC shows an overall performance of detection methods. The higher the AUC value, the better the method is.displays the AUC results for four methods with different sample sizes (10, 25 and 50) under four simulation settings. AUC values generally increase when the sample size increases; AUC values are greater for higher mean setting. The proposed approach outperforms the other methods in the Setting 2 for small sample size (n = 10) and in Setting 1 for large sample size (n = 50) and is well comparable with other methods in the rest of the settings. In addition to the AUC, which shows an overall performance of the methods, we also compare our method with other methods in terms of power in detecting truly differentially abundant features, while the FDR is controlled at different levels.shows the power for sample size of 10, 25 and 50 in each simulation setting in Experimental Design 1. For the Settings 24 our proposed approach either outperforms other methods or is well comparable with other methods. In the Setting 1, the new method surpasses other methods for sample size of 50, and is comparable with metagenomeSeq for sample size of 25 while much powerful than the rest. Interestingly, for sample size of 10, metagenomeSeq shows much higher power than the new method. We examined the true (i.e. realized) FDR at adjusted P-value of 0.05. The boxplots of true FDR across 100 replications for this experiment show that the FDR cannot beNotes: Settings 14 reflect the count data of feature abundances with low means, intermediate means, high means and a combination means, respectively. Setting 4 most resembles to the nature of real metagenomic dataset. controlled well for metagenomeSeq for any sample size in Setting 1 and 4 (Supplementary). The same conclusion can be obtained for true FDR plots at adjusted P-value of 0.01 (Supplementary). The AUC plots and power plots for Experimental Design 2 can be found in the Supplementary Figures S7 and S8. Both types of plots demonstrate that the new method outperforms others, in particular, when the sample size is small. The true FDR plots (Supplementary) indicate that FDR is not controlled by metagenomeSeq for any sample size in the Experiment 2.displays the AUC results, andshows the power detection of truly differentially abundant features obtained from each method for sample size of 10, 25 and 50 in the simulation setting in the Experimental Design 3. The AUC results show that the proposed method and edgeR outperform other methods in situations with sample size of 10 and 25 and are comparable with DESeq and Metastats in a situation with large sample size. The proposed approach has highly similar performance with edgeR when both of them are compared in terms of AUC as shown in. However, our proposed method outperforms edgeR and other methods in terms of the power in detecting the true differentially abundant features as shown in, in particular, when the sample size is small. For FDR, metagenomeSeq is the only method that is a little above the reference horizontal line (0.05, Supplementary).Computational time A comparison of computational time for five methods on one simulation dataset of Setting 4 is shown in. The simulation was done on a PC with 2.33 GHz and 4.00 GB RAM. Two-stage, edgeR and metagenomeSeq are comparable while DeSeq and Metastats take 30300 times longer. The computational time for other settings are similar. Note the results shown in4 are for 100 repetitions, while theshows the time for one repetition.
Results from Experimental Design 3
Real data analysisHuman mucus versus saliva data We performed our proposed method on metagenomic shotgun sequence data in the HMP project () focusing on the functions of microbes in human health and disease through the characterization of microbial communities for two human body sites: nasal mucus and oral saliva. Of 42 samples, 30 samples are obtained from human nasal mucus microbial metagenomes and 12 samples from human oral saliva samples. The dataset was downloaded from MG-RAST. Differentially functional abundances between human nasal mucus and human oral saliva were identified with multiple comparison correction of FDR50.05.shows the top 25 most significant differentially abundant functions. Five of them get involved in a biological process of phosphate metabolism, and their abundances are more presented in microbial metagenomes of cystic fibrosis (CF) lung patients compared with microbial metagenomes of healthy human saliva individuals. These functions are Pyrophosphate-energized proton pump (EC 3.6.1.1), Geranyltranstransferase (farnesyldiphosphate synthase) (EC 2.5.1.10), Geranylgeranyl pyrophosphate synthetase (EC 2.5.1.29), Fructose-bisphosphate aldolase class I (EC 4.1.2.13) and Maltose-6 0-phosphate glucosidase (EC 3.2.1.122).conducted the first metagenomic study of DNA viral communities in the airways of CF diseased and non-diseased individuals and discovered that Guanosine-5 0-triphosphate, 3 0-diphosphate pyrophosphatase are over-representation in CF diseased compared with non-diseased individuals. Several studies, including, discovered that these enzymes are linked to bacterial stringent response, bacterial virulence, antibiotic resistance, biofilm formation, quorum sensing and phage induction in a variety of bacteria. These findings imply that a unique metagenomic environment of the CF airway might contribute to functional adaptations, resulting in shifts in metabolic profiles (). Moreover, we found that Putative peptidoglycan bound protein (LPXTG motif) Lmo0159 homolog is enriched in mucus but rare in saliva metagenomes. This finding is correspondent to the discovery of, which conducted an experiment to assess how CF lung microbes respond to the biochemistry of the lung environment by identifying pathways, obtained from KEGG classification hierarchy, whose presence enriched in microbial metagenomes of CF lung patients compared with healthy human saliva microbial metagenomes from the HMP.reported that peptidoglycan biosynthesis pathway is enriched in human mucus metagenomes of CF lung patients,displays the top 25 most significant functions whose abundance differs among the four groups. We found that two cytochrome c biogenesis involved functions Cytochrome c-type biogenesis factor and Cytochrome c-type biogenesis protein CcmE in obese only group are significantly differentially abundant comparing with healthy group or IBD and obese group. And their abundances are marginally significantly different from IBD-only group. This may imply that even though, in general, obesity increases the risk of IBD, obesity caused by lack of cytochrome c may not increase the risk of IBD. Hence, the alteration of cytochrome c can potentially be used as a biomarker to help stratify obese patient by the risk of developing IBD. The top significant COGs (adjusted overall P-value50.01), along with the adjusted P-values for each pairwise comparison, are given in the SupplementaryBy pairwise comparison in this table, we also found the count of asparaginase in IBD and obese group is significantly different from IBD-only group, obese-only group and healthy group, respectively, whereas, the other pairwise comparisons for asparaginase did not yield any significant result. This suggested that asparaginase might only contribute to IBD when the patient is obese.showed that obesity impaired L-asparaginase treatment due to the fact that adipocytes work in conjunction with other cells of the leukemia microenvironment. For IBD patients, it is possible that adipocytes play a role in the interaction between IBD cells and asparaginase, which explains why the count of asparaginase only differs in the IBD and obese group.
DISCUSSIONCurrently, there has been an increasing interest in metagenomic projects with various applications. One typical aim is to assess whether and how two or more microbial communities differ. Comparing microbial genetic contents on the basis of functional features (e.g. pathways, subsystems, functional roles) obtained from different microbial communities with different phenotypes (e.g. diseased and healthy, or different treatments) enables us to identify the gnomic contents of microbes contributing to human health and disease, which can in turn lead us to understand how the microbes affect human health. We proposed a two-stage statistical procedure for sequentially selecting informative functional features and detecting differentially abundant functional features between two or more microbial communities/conditions. The proposed method accounts for the specific characteristics of metagenomic data, which are highdimensional complex datasets consisting of a large proportion of zeros, non-negative counts with skewed distribution and a large number of features, but limited number of samples. From the results of various simulations, we showed that our proposed method more effectively selects the informative functional features and therefore more efficiently detects the differentially abundant functional features between metagenomic datasets. Owing to the existence of large proportion of zeros in metagenomic data, we also fitted the Zero Inflated Negative Binomial(ZINB) on the filtered data through elastic net for the Experiment 1. Comparing the results from NB and ZINB methods, NB approach exceeds the ZINB fitting for most of the cases according to the AUC plots and power plots (shown in the Supplementary File, Supplementary Figs S9 and S10); otherwise these two methods are comparable. However, the computational time for ZINB is $200300 times longer than for NB fitting due to more parameters in the ZINB models. We also applied the proposed method on two real metagenomic datasets related to two human diseases. One of them is related to obesity and IBD, and the other one is related to CF lung disease. In the gut data, there are four phenotypes/groups owing to the combination of the two diseases. Our method is directly applied to this multiple-group comparison and our findings are consistent with previous reports. Compared with other existing methods on metagenomic studies, the proposed twostage method is more powerful and flexible.
The Author 2014. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
A two-stage statistical procedure for functional metagenomics at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
N.Pookhao et al. at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
