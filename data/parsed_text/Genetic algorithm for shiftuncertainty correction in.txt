Motivation: The analysis of metabolic processes is becoming increasingly important to our understanding of complex biological systems and disease states. Nuclear magnetic resonance spectroscopy (NMR) is a particularly relevant technology in this respect, since the NMR signals provide a quantitative measure of the metabolite concentrations. However, due to the complexity of the spectra typical of biological samples, the demands of clinical and high-throughput analysis will only be fully met by a system capable of reliable, automatic processing of the spectra. An initial step in this direction has been taken by Targeted Profiling (TP), employing a set of known and predicted metabolite signatures fitted against the signal. However, an accurate fitting procedure for 1 H NMR data is complicated by shift uncertainties in the peak systems caused by measurement imperfections. These uncertainties have a large impact on the accuracy of identification and quantification and currently require compensation by very time consuming manual interactions. Here, we present an approach, termed Extended Targeted Profiling (ETP), that estimates shift uncertainties based on a genetic algorithm (GA) combined with a least squares optimization (LSQO). The estimated shifts are used to correct the known metabolite signatures leading to significantly improved identification and quantification. In this way, use of the automated system significantly reduces the effort normally associated with manual processing and paves the way for reliable, high-throughput analysis of complex NMR spectra. Results: The results indicate that using simultaneous shift uncertainty correction and least squares fitting significantly improves the identification and quantification results for 1 H NMR data in comparison to the standard targeted profiling approach and compares favorably with the results obtained by manual expert analysis. Preservation of the functional structure of the NMR spectra makes this approach more realistic than simple binning strategies. Availability: The simulation descriptions and scripts employed are available under:
INTRODUCTIONThe quantitative profiling of metabolites and the mathematical modeling of metabolic networks is set to make a major contribution to our understanding of complex biological systems, including the processes underlying development and tissue homeostasis (). The most commonly used methods for metabolite detection are mass spectrometry (MS) and nuclear magnetic resonance spectroscopy (NMR). While each has its specific advantages, the inherently quantitative nature of NMR makes it most attractive for providing data for the development of mathematical models. However, the current challenge is to extract reliably quantitative data from experimental spectra, which are often complex and subject to background variability. Here, we focus on the exact extraction of metabolite information from 1 H NMR measurements. The general strategy involves pre-processing steps such as phase-and baseline correction, smoothing and data reduction (), followed by the identification of distinct metabolite signatures in the signal and the estimation of metabolite concentrations with respect to the original biological samples. Details of the basic pre-processing used in this work are provided in (). A number of approaches have been reported to help in the subsequent identification and quantification of individual metabolites from pre-processed data (). However, none of the methods currently available can be applied in the reliable, automated fashion necessary for the high-throughput processing of complex biological samples (). As an initial step toward automatic processing, targeted profiling (TP) () employs a set of known and predicted metabolite signatures (targets) fitted against the signal. However, an accurate fitting procedure for 1 H NMR data is complicated by small but significant shift uncertainties in the peak systems, caused by even minor variations in parameters such as temperature and pH (). These uncertainties have a large impact on the accuracy of identification and quantification and currently need to be compensated by very time consuming manual interactions. Independent correction of the shift followed by fitting of the corrected target descriptions against the signals is not generally feasible because of the strong overlaps typical of 1 H NMR spectra. Generic methods for the compensation of peak shifts are typically based on a specific or average reference signal taken from thePage: 525 524533
Genetic algorithm for metabolite identification and quantificationdata (). If such a reference is available, then the NMR spectra are locally aligned to it such that the final set of spectra is reasonably aligned and corresponding peaks match. The used optimization techniques commonly employed include partial least squares approaches (), genetic algorithms () and procedures based on the fourier transformation (). This type of alignment problem is relevant not only to NMR but also to other data, including MS (). While the proposed approaches are promising and reasonably fast, they assume the availability of a reference spectrum to be used as the objective goal. Sometimes it is merely assumed that a set of common reference peaks is available so that an alignment function can be estimated based on these data (). However, this is often not realistic and in the setting considered here we do not assume the existence of a (global) reference spectrum. Furthermore, even for the aligned spectra one can not ensure that the peaks are aligned to their true position, only they are aligned to one another. If the chosen reference is not an undisturbed signal, then there is no guarantee that the aligned spectra show correct ppm or mass positions for the peaks. In the case of metabolic profiling, this leaves the problem of correct identification and quantification of the metabolites in a spectrum with potential peak shifts. Our approach focuses on this special problem. The prior mentioned alignment methods can be used as a potential pre-processing only if the analyzed spectra are reasonably similar, as it should be the case for replicates. In this case, it is possible to align the spectra first before using the approach, presented below. The targets consist of a set of parametrized peak models showing uncertainties in their positions with respect to a true measurement, as described in more detail below. A typical NMR signal from a biological sample containing a variety of targets contains around 100 erroneous shift parameters. Local shift uncertainties need to be corrected within a given tolerance for all these parameters and often within the context of overlapping targets. Furthermore, NMR data show very spiked peaks so that both the correct peak positions and accurate target height estimates are decisive to the accuracy of metabolite concentration estimates. This makes a complete evaluation of all possible solutions unfeasible and the problem is ill posed. We present here an approach designed to improve this situation by semiautomatic analysis of the spectra such that only minor, simple interaction steps are necessary to allow the processing of large datasets. We developed an approach estimating shift uncertainties based on a genetic algorithm (GA) () combined with a least squares optimization (LSQO) (). Genetic algorithms are known to be very effective in finding local optimal solutions for ill-posed problems and have already been applied to spectroscopic data (). The estimated shifts are used to correct the known metabolite signatures, leading to significantly improved identification and quantification results. The shift uncertainties are generally corrected with sufficient accuracy that little or no subsequent manual interaction is necessary to generate the final quantifications. The method has been tested on a range of NMR spectra obtained from cell culture experiments. We have evaluated the models obtained in comparison to a standard targeted profiling approach as well as to the defacto standard of a careful manual analysis. We have also studied the observed shift uncertainties with respect to their influence on the concentration estimates during the multiple steps of the GA.
APPROACH AND METHODS
NMR spectroscopyAll 1 H NMR-spectra were acquired on an AVANCE 700 MHz NMR spectrometer (Bruker, Rheinstetten, D) equipped with a 5 mm cryo-probe. A pulse acquire sequence was used with 512 accumulations, 65 536 complex points, 8389.2 Hz sweep width corresponding to 11.982 ppm on the chemical shift axis (0.002 ppm , 0.13 Hz nominal spectral resolution, respectively) and a repetition time of 20 s (> five times the T1 of the reference and metabolites) ensuring fully relaxed, quantifiable signals. NMR samples were prepared by resuspending lyophilized cell extracts in 500 l D 2 O (99.9 atom %, Sigma Aldrich, Steinheim, D) potassium phosphate buffer (0.05 M, pH 7.4) containing a known concentration (60120 M) of 2, 2 dimethylsilapentane-5-sulfonate (DSS, 99.0%, Fluka, Taufkirchen, Germany) as a reference for chemical shift and quantification. Each extract was then mixed vigorously by vortexing and centrifuged for 4 min at 10.000 g. The supernatants ( 500 l) were transferred to 5 mm NMR tubes (Wilmad, Vineland, NJ USA). All samples were subject to NMR analysis at 298 K within 12 h.
Data pre-processingWe focus on the analysis of 1 H liquid NMR spectra obtained from extracts of cultured stem/progenitor cells, detailed subsequently. Each spectrum was pre-processed using in-house Matlab () routines. Spectra were phased, baseline corrected and referenced using DSS as a chemical shift and shape indicator (CSI). 1 Furthermore, the region around (4.55.9 ppm) was set to zero for each spectrum to remove the water resonance contributions. Further details on the basic pre-processing are given in Schleif (2007);).
Dataset descriptionWe employed a set of six NMR spectra from cells cultured under a range of conditions to provide biologically realistic degrees of sample complexity and variation. The expected metabolites in the signal (subsequently referenced as targets) were as follows: Alanine (Ala), Asparagine (Asn), Aspartate (Asp), Citric Acid (Cit), Cysteine (Cys), Glutamate (Glu), Glutamine (Gln), Glycine (Gly), Histidine (His), Iso-Leucine (Ile), Lactate (Lac), Leucine (Leu), Malate (Mal), Methionine (Meth), Myo-Inositol (Myo), PhenylAlanine (Phe), Proline (Pro), Pyruvate (Pyr), Serine (Ser), Succinate (Succ), Threonine (Thr), Tryptophan (Trp), Tyrosine (Tyr), Valine (Val), Fumarate (Fum) and DSS as the standard reference. The signal is also expected to contain some unspecified metabolites. The murine multipotent hematopoietic progenitor cell line FDCPmix (Factor-Dependent Cells Paterson mixed potential) was grown in IMDM supplemented with 5 mM d-glucose, 2 mM l-glutamine, 1 mM sodium pyruvate, 20% horse serum and 10 /ml IL-3. Six independent cultures were analyzed and generated separately over a period of 18 months under the same culture conditions. The cells were maintained at 37 @BULLET C in 5% CO 2 in air at densities between 6  10 4 and 5  10 5 cells per ml by passaging every 23 days. At the final passage, the cells were transferred to a fresh medium and cultured for 3 days. Between 1  10 8 and 2  10 8 , cells from each experiment were harvested by centrifugation and washed four times with ice cold phosphate-buffered saline (PBS) to remove medium constituents. The cell pellets were shock frozen in liquid nitrogen and extracts prepared by addition of 800 l ice cold methanol:acetonitrile:water 1 : 1 : 1 mixture. To ensure efficient cell disruption, the cells were subjected to 2  1 min bursts of Page: 526 524533
F.-M.Schleif et al.ultrasound in an ice-cold ultrasonic bath. The samples were then transferred to a 70 @BULLET C water bath for 10 min to denature the proteins before being diluted 1 : 7 with water and lyophilized. Additionally, we analyzed a set of four spectra of wet-lab mixtures of the five metabolites (Ile, Leu, Glu, Val, Meth) and DSS as a standard with known concentrations.
Manual NMR expert analysisThe metabolites of interest were first measured individually by NMR to provide reference spectra. A known concentration of the metabolite (120 mM) together with DSS (0.12 mM) was prepared in 500l buffered D 2 O solute (see Section 2.1) and measured under the same conditions as those used for the cell extracts. This allowed the determination of all chemical shifts () and coupling constants (J) of each signal-generating metabolite proton as a basis for the reliable identification of metabolites in subsequent experiments. Metabolite identification and quantification was achieved using purposedeveloped NMR software (NMRj, () allowing for the interactive subtraction of a simulated from a measured NMR-spectrum. The chemical shifts and coupling constants from the simulation were carefully adjusted within a range of < 0.01 ppm to enable stringent fitting of the frequency pattern of the individual spin systems to the cell extract spectrum. The criteria for an acceptable fit were firstly that all of the simulated peaks be present in the measured NMR-spectrum (i.e. identification of the metabolite) and secondly that the difference spectrum resulting from subtraction of the simulation from the measurement exhibited a smooth baseline at the position of metabolite frequencies. The latter step requires that the simulated signal is folded by a line broadening function that is as close as possible to that of the measured spectrum. This was achieved by using up to three exponential broadening functions, independent in amplitude, damping and frequency offset, for folding the simulated spectral time signal. Metabolite concentrations were calculated from the identified metabolite's NMR time signal amplitude relative to the time signal amplitude of the known DSS reference concentration, taking into account the relative number of contributing protons.
NMR and targeted profilingHigh resolution 1 H NMR spectra consist of a large number of relevant signals. Metabolite signatures are represented in general by multiple narrow peaks located on top of a wide underlying complex baseline. The NMR signal s() can be approximated as a super composition of Lorentzians (), Gaussian functions or mixtures thereof. However, such assumptions are highly idealized. In practical measurements, the line shape of the peaks is much more complex and inhomogeneous due to measurement imperfections. This poses multiple challenges in the analysis because almost all relevant signals in the NMR measurement show strong overlapping components. Without an appropriate model of the signal structure and line shape, a deconvolution is extremely complicated. This is especially true for signal components at low concentrations, which may otherwise be easily overlooked. The TP approach () analyses metabolites by referencing to a set of known signatures. Taking some relatively strong assumptions concerning the line shape and knowledge about the structure of the targets, TP tries to identify and quantify these target metabolites in the complex NMR spectrum. The TP approach assumes an almost perfect knowledge of the peak or line shape, which is typically modeled as a Lorentzian or a Gaussian function. It is also assumed, that the number of candidate signatures in the mixture s() is small and restricted to a specific subset of known metabolites, the targets. Furthermore, it is assumed that for all targets, their peak sequence, i.e. the signal signature defined by the position and height of the peaks, is known perfectly beforehand. In practice, it is often very difficult to provide such a description analytically for complex mixtures with extensive overlaps. For this reason, the peak system is constructed (manually) by adding appropriate peaks at the correct ppm position and height. The targets are subsequently fitted against the measurement. TP is being adopted as a standard technique in metabolite analysis and has already been employed in a number of studies see e.g. (). While TP has been found to be very effective in a range of applications, it remains suboptimal in many cases: (i) due to variations in the measurement conditions (e.g. temperature, pH), the position of the g i in a target (groups of peaks) may shift in a non-linear manner. (ii) A specific line shape has to be chosen for the fitting of the candidate targets against the signal. Since the actual line shape may deviate from the chosen forms, this assumption can lead to further problems especially for strongly overlapping signals as depicted in(iii) The simple fit of individual targets against the signal s() may fail for strongly overlapping structures, while the use of lower constraints on the fitting commonly leads to incorrect identifications of targets. In the later case, it can happen that lines are fitted into regions without signal. The TP approach also lacks the formal and mathematical derivation and modeling basis which would simplify adaptations, for instance to accommodate moderate changes in the device settings such as alternative measurement frequencies or to incorporate alternative peak shape models. In the following section, we formalize targeted profiling and detail our extension thereof. We provide an appropriate mathematical modeling for the fitting and parameter estimation approach, taking the functional characteristic of the measurements into account.
EXTENDED TARGETED PROFILINGAn arbitrary metabolite may formally be given by a functional description f () for a target signal as f () = G j g j () with g j () as a peak pattern or a function of delta functions with non-zero entries only on the appropriate peak positions as detailed below and G as the number of such peak patterns. Using the TP approach, f () may be folded with an appropriate line shape e.g. a Gaussian. A reconstruction of alanine using the functional description is given in. An alternative compact description of a target e.g. alanine is given by its 1 H NMR spin system classification as A 3 X spin system (see e.g. (), with the associated values for the chemical shifts of (H A ) = 1.46 ppm, (H X ) = 3.76 ppm and an A-X coupling constant of J AX = 7.2 Hz see. Using the above spin system classification, we can employ a NMR simulation environment () to simulate the alanine spectrum while taking the physical properties of our measurement system (such as device frequency) into account. This simulation yields transition tables providing information on the peak positions and heights of each peak for the target. A transition table for L-alanine is shown in. From this line spectrum, we can generate a profile spectrum, similar to a true measurement by folding the line spectrum with an assumed line shape, leading to our functional description f () of a given target (see). Taking this approach, we can model the phased and baseline corrected signal s() asPage: 527 524533the functional description. The xaxis is given in ppm and the y-axis shows the intensities. (left) the quartet generated by the H x proton with a shift parameter (H x ), and (right) the doublet caused by the three magnetically equivalent H A protons with shift parameter (H A ).
Genetic algorithm for metabolite identification and quantification = e.g.exp(...) line shape (4)We employ a non-negative Least Squares Fit over all J identified targets f j () using the functional description and the subsequently generated peak information. Thereby o represents a global shift that can be compensated by a reference shift correction and represents noise. The target f j can be approximated as a super composition of its component functions or peak groups g i defined by the number G j of chemical shifts in the molecule's spin system. A small local shift   i + typically within a range of || 0.005 ppm can be expected for each peak group. Each component k () of g i () can be considered as a delta function, contributing to a line spectrum with non-vanishing amplitude for one peak position only. We denote such a single position  as  j,i,k to specify peak k caused by group i in metabolite j. K is the multiplicity of a component function g i. The origin of the chemical shift group components k () lies in the spinspin interaction characterized by the scalar coupling constant J AX and can be deduced from the quantum mechanical calculations for the spin system parameters describing the target metabolite. Subsequently, this line spectrum is folded  by a line shape function  to mimic the line shape of the real measurement. In the following, we will use G for G j and K for
F.-M.Schleif et al.K j,i if the indices are known from the context. In NMR, the position of the g i is known as chemical shifts. The estimates of these shift positions need to be as accurate as possible and are the main error source in the TP approach. An accurate peak shape estimate is the key to an appropriate subtraction of signal components from s() in order to reveal potentially hidden components. We approach this issue by taking the shape of the DSS reference signal added to the sample, as a template for . This shape is used to estimate the expected peak width present in the signal. To tackle the shift-uncertainty problem, we estimate values for the disturbances shown in Equation (2) and present an initial solution to optimize the g i positions in potential targets using a grid search strategy. This approach leads to a general improvement in position estimates for the true chemical shifts of the subpatterns g i of potential targets f i and hence to more accurate identification and quantification estimates as shown below. Whereas standard TP identifies signatures in NMR mixtures by employing known database references of (manually) specified peak patterns, the Extended Targeted Profiling approach (ETP) described here modifies this concept by modeling the targets based on their theoretical spin system model (see). This model provides the peak information (transition tables). The physical model easily deals with measurement variables such as different device frequencies and is known to provide very accurate peak lists. The parameters of the targets are optimized with respect to the measurements at hand. Each target description T (generating a signal f j ()) is characterized by a set of spin system descriptors T d  S. S describes the theoretical aspects of the spin system of T and can be used in combination with a model of the measurement system (NMR system) to simulate the spectrum f j for T. A spectrum representation of T can be divided into multiple parts, one for each spin system descriptor T d , known as the peak group (g). A peak group may consist of multiple or single peaks and is potentially overlapping. For each group, a potential (limited) shifting uncertainty i can be expected. New targets can be added to the ETP approach very easily by specifying the spin system model, outlined above, based either on knowledge available in the literature or by own measurements of the pure target substance under the previously defined measurement conditions. In the latter case, the obtained spectrum is analyzed manually to define the spin-system model. Hereby an NMR expert constructs a spin system model such that the reconstructed spectrum, based on this model, fits best to the observed data. The three steps of ETP required to obtain an optimized fit based on this new encoding strategy are detailed below.
Line representation of a NMR spectrumNMR spectra can be described by means of a set of overlapping peaks, which provides a compact representation of the signal and can also reveal quickly whether or not an expected target is likely to be present in s(), since all simulated target peaks must also be present in the peak list of s(). The peak picking process is rather complicated, and a number of heuristic approaches have been proposed to improve the situation (). Here, we focus on a simple parametric hill-climbing approach (). We further assume that for each measurement a known CSI signal is available, in our case this is DSS. This signal has a known position of 0 ppm, which can be used to compensate the global shift offset of the spectrum. We look for a maximum within a window of 0.05 ppm at the expected CSI position. From this position, we then go down (to lower intensities) on the left and the right flank of the peak as long as the signal is a descending monotone. The peak is then truncated at a predefined maximal width. The center position and the peak width at half maximum (PWHM) are then calculated for this peak. The PWHM is used as a rough estimate of the peak width. Due to effects such as imperfect phasing, shimming or baseline correction, a direct inverse deconvolution of s() with the CSI reference is not generally feasible. Instead, we employ a hill-climbing algorithm and look above a predefined threshold (the expected noise level) through the whole signal for local maxima, whose flanks are sufficiently steep and for which the obtained peak has a sufficient width. By application of this algorithm, we obtain a list of peaks in a spectrum. This list is subtracted from s() and the algorithm is repeated until no further peaks are detected. This approach can also resolve peaks in an overlap, although not in every case. Alternatively, the strategy described in () can be used with an underlying Lorentzian support, the particular peak picking algorithm is not of much relevance here as long as it discovers the peaks in the spectrum to a sufficient degree of accuracy. The list of peaks is subsequently denoted as P. These peak lists are compared with those of the potential targets. If a sufficient number of peaks (e.g. 30%) in a target can be matched within a tolerance of 0.01ppm to the peaks P, we consider the target to be identified and proceed with the analysis steps for this target. We now have the target as a functional line spectrum f j () with  as the fitted line function.
Genetic algorithm for shift-uncertainty estimationA major feature of our approach is the shift-uncertainty correction performed by means of a Genetic Algorithm (GA). The genetic algorithm software was written in-house in Matlab running on an Intel Xeon multiprocessor system with 8 3.20 GHz processors and 16 GB memory using the parallel processing, signal processing and optimization toolbox with Matlab 2008b. We made use of the GA implementation in the optimization toolbox but replaced some of the core methods with our own purpose-developed implementations. Specifically, we replaced the methods used to generate the initial population and the mutation function and provided a specific fitness function as described below. The basic algorithm and parameters for the GA are shown inand the overall workflow is depicted in. Briefly, we generate a large number of chromosomes P, each chromosome has the same length Z = J j G j , equal to the number of groups over all analyzed targets, and each of which contains the currently estimated, or randomly determined shift values for the i. These i are optimized by the GA. Furthermore, the smallest shift is limited by the ppm-axis resolution. We have found that a reduction of the original spectrum to 16k points corresponding to 0.5 Hz spectral resolution is possible, while maintaining structural information of sufficient quality for the subsequent identification task. In this case, up to 25 valid shift positions are possible for a given shift uncertainty of 0.01 ppm. 2 Page: 529 524533The distance measure is either euclidean 0 or a functional distance 1.
Genetic algorithm for metabolite identification and quantification
Fig. 4. Workflowof the genetic algorithm used to obtain optimal i. The first (outer) folded corner is repeated until K generations are analyzed or one of the alternative standard stopping criteria is met. The inner folded corner is repeated until a new population of the same size as before is generated.
Fitness function and evaluation measuresThe fitness function is the core element of the GA and is evaluated for each single chromosome separately. It consists of three procedures: (i) the spin system classifications of all identified metabolites are used to generate the corresponding spectral representation. Thereby, the shifts given by the chromosome are applied to the corresponding groups g i , and the reconstructions folded with the prior estimated line shape. We denote the matrix of all reconstructions f * j (), given as row vectors, as the matrix R(ii) These reconstructions are reduced to a range representation such that a compact form of R denoted as R is obtained. In R not all values for  are used but only a limited set of  in the form of potentially overlapping range vectorswith l as an index of a peak positions in . We collect all peak center positions of the metabolites denotedHere, we also incorporate the i and take the peak positions from the transition tables extended to a range of twice the assumed ppm-uncertainty PPM-E for each peak. A reduced test spectrum s () is constructed, accordingly. (iii) The matrix R and the vector s () are subsequently used in the LSQO, as the third step, to calculate the  i for all targets. The reduction to a range-based representation is useful to avoid very large and extremely sparse matrices, which would complicate the subsequent  estimations. This step has no detrimental effects on the estimates.
Non-negative least squares fittingThe targets f j () are now given in the functional description of (2) with optimized i , using the known k and our functional shape estimation for all peak groups. The function to fit is our reduced spectrum s (). We add constraints for non-negative  i and allow for user definition of  j fixed on a target f j by employing standard optimization modeling techniques. Solving the optimization problem by use of a standard constrained linear least squares algorithm we obtain the  j in a column vector , which can subsequently be used to calculate the concentration estimates. To this end, the area under the -scaled target is calculated and associated to the area of the -scaled reference signal (here DSS). A scaling step is then performed, based on the number of protons 1 H present in the reference, nine for DSS, compared with the number of protons present in the metabolite e.g. four for Ala. This leads to the following equation for the concentration c in mol: c(Ala) = area(Ala)c(DSS)9 area(DSS)4 with area as an appropriate estimation function for the area under the curve. One can also calculate estimates of the lower concentration limits by scaling the target intensities of f j to the noise level and repeating the procedure. The reconstruction s * is obtained as:To judge the fitness of this solution, we may now either use the quality of fit provided by the LSQO algorithm or evaluate the reconstructed spectrum s * () with respect to s() using a problemspecific distance measure. Here, we use either the standard Euclidean distance (EUC) or a functional distance measure as an extension of the L p norm proposed in () (FUNC). The functional distance measure has the advantage of taking the functional nature of the spectra into account. The standard EUC considers the individual features of the NMR spectrum to be independent, so that a change in the order of the ppm positions does not affect the calculated distance. However, the features or measurement points in NMR spectra are not independent, so that a distance taking this aspect into account can be considered to be more appropriate for this type of data. Lee proposed a distance measure taking the functional structure into account by involving the previous and next values of a signal v i in the i-th term of the sum, instead of v i alone. Assuming a constant sampling period , the proposed norm (FUNC) is:Page: 530 524533. Illustration of the L p-norm. Plot (a) indicates the case in which the distance between two functions is equal, both for Euclidean or L p-norm. In plot (b), parts of the functions are interchanging (crossing). The distance using EUC is still the same as in plot (a) but for the L p-norm the distance is changed, giving a more realistic measure of the distance of the two functions.
F.-M.Schleif et al.representing the triangles on the left and right sides of v i and D being the data dimensionality. For the data considered in this article, v takes the position of . As for L p , the value of p is assumed to be a positive integer. At the left and right extremes of the sequence, v 0 and v D are assumed to be equal to zero. The concept of the L p-norm is shown in. The calculation of this norm is slightly more complex than that of the standard Euclidean but, as is shown below, significantly improves the fitting results as well as the convergence speed of the GA. 3
RESULTS AND DISCUSSION
Identification and quantificationWe have tested our approach using measurements of metabolites in lysates of cultured cells as well as a small test set with known concentrations of defined metabolites. Rather than focusing on a specific biochemical question, we aim to compare the range and concentrations of metabolites detected using TP and ETP with those obtained by manual expert profiling.
Wet lab metabolite mixture experimentThe wet-lab mixture datasets (M-DS) can be considered to be an artificial dataset with known concentrations. In, the known concentrations (weighted sample) and the concentration estimates as obtained by the expert, TP and ETP using the functional distance measure are given. We observe that the ETP approach is closer to the expert estimation than is TP. The DSS concentration was given with 77.05  mol for all spectra.
Cell culture experiment Detailsof the analyzed cell extract data are shown in. The optimized approach provides results, which are much closer to the expert analysis, for 16 of the 21 targets. Eth, Cit, His, Myo and Mal were noted as being absent by the expert but by ETP and TP with very low concentrations.shows a reconstruction of a signal part with respect to the original signal to illustrate the effect of the shift correction. Fromwe observe that the EUC measure in the fitness function is indeed less effective than the FUNC measure, consistent with our expectation that the FUNC norm is more appropriate to data which are themselves functions. 4 We subsequently restrict our analysis to the FUNC norm and the standard TP approach. In, we show Box-Whisker Plots of the relative concentration errors with respect to the expert of the metabolite concentrations using the standard TP and the ETP (FUNC) approaches. It can be seen that the relative error of ETP is much smaller than that of TP in the large majority of the metabolites. Also the variance of the results is smaller. Median errors of TP versus ETP are shown in. Significance of an improvement is indicated by a + using a t-test on a 5% level, with significances of P  0.03. We observe that  25% of the differences are significant and all these are positive.
Shift-uncertainty properties and influenceThe shift-uncertainty estimates change over time with respect to the GA evolution and the underlying constraints. The GA can only determine a local optimal solution, which is expected to correspond to the global optimum in only a very few cases. An analysis of the number of updates per shift-uncertainty estimate reveals parameters which are likely to be incorrect either because they have not been updated at all or because they have been updated very frequently. An example for Spec 1 is shown in. Taking this statistic into account, the expert can be assisted by an indicator that highlights peak group shifts that are likely to be incorrect. Considering the values of the shift uncertainties for the analyzed spectra, we found around 34% of the i to be 0 after convergence. Analyzing the shift updates also provides information about potentially unreliable modeled regions, indicated by either very few or very many updates, as shown in. The relative number of changes by the GA with respect to the total number of generations until convergence is shown over all spectra. The various metabolites are indicated by different symbol shapes and shadings. One can clearly see that for most (indicated by the symbols), around 40% of the GA generations are sufficient to obtain a stable solution. Even if this solution may not be a global optimum, it can still be considered as a stable local optimum. For some of the (e.g. those for pyruvate and aspartate), a (much) larger number of updates is necessary and it can be expected that these shifts are not well optimized, but that no better solution could be found by the GA. For some of the other metabolites, one can also see that only a single group is optimized very frequently as is the case for the group of Val (valine) around 0.98 ppm or Ser (serine) around 3.83 ppm. The concentration estimates for these two amino acids compare quite well with the expert estimates. Very few updates can be observed e.g. for Succ (succinate) around 2.39 ppm, Gly (glycine) around 3.55 ppm or Glu (glutamate) around 2 ppm and 3.75 ppm. Interestingly Succ, Gly and Glu are optimized very well and the estimated concentrations correspond reasonably to those obtained by the expert. However, it should be borne in mind that the concentration estimate is not equally split over the groups.Considering the median relative error () of the concentration estimates, the ETP approach is best in all cases. In a case by case comparison, ETP is almost always the best, withThe plot inprovides an initial indication of which metabolites are most likely to have been poorly optimized and should therefore be manually corrected by the expert. This provides a basis for the focused and guided manual interaction avoiding the inspection of all metabolites. In the example shown, the optimizations appear to have been reasonably effective and correct for those metabolites for which the number of updates for the corresponding lies within a range of 2040%. The plots inshow the effect of the genetic evolution with respect to the concentration of the metabolites and the parameter modifications. One can see that most of the optimization of GA parameters andThe expert concentration is assumed to be optimal (0 error), the values for TP and ETP are then compared with the expert using the mean square error, normalized by the number of metabolites. It can be seen that the new approach clearly improves the concentration estimates. The number of generations until convergence is shown in brackets. hence of concentration changes occurs in the first 1020 generations. The plot also shows that even relatively small errors in the i may have large impact on the concentration estimates, with very high values at the beginning of the optimization and comparatively small values at the end for some metabolites. Median relative error estimates of single metabolites using TP and ETP (FUNC) are shown in the Box-Whisker plot 8. The relative error is calculated as the absolute concentration error compared with the expert value. In terms of the median errors, we find that Page: 532 524533Change judged in the row labeled by Imp: 1 (improvement/optimal), 2 (worse estimate), 0 (no improvement). The rows labeled with Sig indicate if the change was significant by the use of a t-test.
Page: 531 524533
Genetic algorithm for metabolite identification and quantification
F.-M.Schleif et al.ETP provides a clear improvement over TP but has still problems with some metabolites such as Leu, Meth, Phe and Pyr. In these cases, however, we note that even the manual fit by the expert is challenging. On average, the median error improved from 0.78 to 0.64 with 0 as the perfect agreement. These findings show that ETP is superior to TP in providing reasonable estimates for metabolites on a magnitude level. However, the accuracy attainable from single measurements is still low. This highlights the need for both the use of experimental replicates and for the analysis of multiple spectra of the same sample.
CONCLUSIONIn summary, this work has shown that an approach combining GAs with LSQO leads to highly effective error estimates for the shift uncertainties in 1 H NMR measurements. The simultaneous fit outperforms the standard TP approach with respect to identification and quantification accuracy and compares favorably to the expert analysis. We have further shown that the usage of a data-specific(functional) distance measure to calculate the fitness values is preferable to a standard Euclidean measure. It also significantly improved the convergence rate of the GA. The interpretation of the obtained shifts over time with the best model allows an in-depth analysis of the optimization, revealing potentially unreliable fits. This provides initial guidance for the expert to focus further manual improvement of the obtained fit where necessary, reducing the demand for extensive shift corrections in order to generate correct uncertainty estimates. Furthermore, the approach also allows the manual specification of concentration values in the fit for known concentrations by additional constraints. Overall, the combined approach can improve the identification and quantification accuracy of NMR-based targeted profiling to allow a semiautomatic high-Page: 533 524533
Genetic algorithm for metabolite identification and quantification
... 10 usingthe median over 10 generations. throughput analysis. Further improvements are to be expected from improved pre-processing of the spectra. Variations in the baseline and slightly incorrect line shapes being the main sources of error in the automatic identification and quantification of metabolites in NMR measurements.
ACKNOWLEDGEMENTWe thank Prof. Thomas Villmann (University of Applied Sciences Mittweida) for discussions about functional signal processing, the METASTEM team and Peter Tino, University of Birmingham for a very effective research stay during the preparation of this manuscript.
Funding:This work was supported by the Federal Ministry ofEducation and Research: FZ:0313833 A (NMR Metabolic Profiling of the Stem Cell Niche, METASTEM) and the German Research Fund; (DFG), HA2719/4-1 (Relevance Learning for Temporal Neural Maps).
Conflict of Interest:none declared.
The Author 2010. Published by Oxford University Press. All rights reserved. For Permissions, please email: journals.permissions@oup.com at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
Other choices for the CSI e.g. trimethylsilyl propionate (TSP) are also possible. The ideal CSI is only one peak with no overlap to other peaks.
at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
If we assume a spectral resolution of SR = 0.5 Hz, a device frequency of F = 700 MHz and an error of PPM-E=0.01 ppm, the number of valid positions V is V  2PPM-E/(SR/F).
The additional effort in the calculations is almost negligiblethe time to calculate a generation is changing only minor, by a few seconds.
Using the median in Figure 6 gives similar results with respect to TP but comparing FUNC and EUC, the results are less pronounced due to the dominance of the (many) small metabolites.
