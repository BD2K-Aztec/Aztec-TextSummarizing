Motivation: Comprehensive 2D gas chromatography-mass spec-trometry is an established method for the analysis of complex mixtures in analytical chemistry and metabolomics. It produces large amounts of data that require semiautomatic, but preferably automatic handling. This involves the location of significant signals (peaks) and their matching and alignment across different measurements. To date, there exist only a few openly available algorithms for the retention time alignment of peaks originating from such experiments that scale well with increasing sample and peak numbers, while providing reliable alignment results. Results: We describe BIPACE 2D, an automated algorithm for retention time alignment of peaks from 2D gas chromatography-mass spectrometry experiments and evaluate it on three previously published datasets against the MSPA, SWPA and GUINEU algorithms. We also provide a fourth dataset from an experiment studying the H 2 production of two different strains of Chlamydomonas reinhardtii that is available from the MetaboLights database together with the experimental protocol, peak-detection results and manually curated multiple peak alignment for future comparability with newly developed algorithms. Availability and implementation: BIPACE 2D is contained in the freely available Maltcms framework, version 1.3, hosted at http://maltcms.sf. net, under the terms of the L-GPL v3 or Eclipse Open Source licenses. The software used for the evaluation along with the underlying datasets is available at the same location. The C.reinhardtii dataset is freely available at
INTRODUCTIONComprehensive 2D gas chromatography (GC  GC) has developed into a de facto standard analytical technique to resolve complex mixtures of volatile chemical compounds in various areas of research. It is often used for the separation and characterization of petrol and gasoline mixtures (). It couples two chromatographic columns, with possibly different characteristics, to achieve an improved separation of complex mixtures over one-dimensional gas chromatography. However, identification of analytes in GC  GC with a one-dimensional detector such as a flame ionization detector is often limited to the use of retention index calculations () and can be improved by coupling a mass spectrometer to the chromatograph (GC  GC-MS). In the field of metabolomics, which studies the multitude of organic molecules produced, modified and consumed by living organisms (metabolites), both GC  GC and GC  GC-MS have been successfully used to characterize and quantify volatile metabolites in different organisms (). The variability of retention times (RTs) in both GC  GC and GC  GC-MS requires sophisticated algorithms for automatic alignment of corresponding analyte signals between different samples. Additionally, the size and number of acquired sample data pose a significant challenge to automated methods and effectively prevent large-scale manual intervention by human experts (). Preprocessing of GC  GC-MS data involves the filtering and noise reduction of the raw signal, the localization, deconvolution, integration and normalization of analyte signals of interest (peaks) (), as well as downstream matching of peaks to create a multiple alignment of related signals from different samples. Then, statistical methods like analysis of variance, principal components analysis (), partial least squares () and variants thereof may be applied to compare samples for significant differences and similarities within and between experimental factor groups. A more complete overview of current data processing methods and programs for GC  GC and GC  GC-MS data may be found in. In this article, a novel automated method for the multiple alignment of GC  GC-MS peaks is introduced: bidirectional best-hit peak assignment and clique extension for 2D chromatograms (BiPACE 2D), which is based on comparing peak mass spectra and RTs in two dimensions between a large number of samples.
METHODS
Peak alignment for GC  GC-MSFor GC  GC-MS peak alignment, the mass spectrum behind each time point on the 2D chromatographic plane can be used as an additional *To whom correspondence should be addressed. y Present address: Proteomics and Bioanalytics Research Group, TU Munich, 85354 Freising, Germany. criterion for peak similarity or identity. The use of electron ionization in GC  GC-MS produces rich fragmentation spectra that are comparable with fingerprints of each analyte. However, electron ionization is known to lead to identical or similar spectra (due to detector noise) for certain classes of analytes, especially structural isomers. Thus, an additional criterion for their distinction is required, such as the RT information of the mass spectrum in the first and second dimensions of separation. A peak in GC  GC-MS may encompass many mass spectra, so that a reduction to a representative mass spectrum is advisable for improved signal-tonoise ratio and better spectral database search results (). If those results are reliable and return few false-positive identifications, one can subsequently use the assigned names to associate peaks across samples. However, the results of database searches may consistently associate a spectrum erroneously with an analyte that happens to be just above the identification threshold used by the database, whereas the true analyte is missing from the database. Typically, peaks should be aligned between samples that were measured under identical (homogeneous) separation conditions. However, the algorithms of, Kim et al. (2011b) andalso support alignment of peaks that were measured under different (heterogeneous) conditions (e.g. different temperature gradient) that lead to non-linear shifts especially in the first RT of the GC  GC chromatogram. The MSORT algorithm () sorts and associates peaks based on their absolute RT difference for each separation dimension and mass spectral similarity using Pearson's correlation coefficient. It successively builds a sorted peak table created from unassigned peak tables and matches peaks from a reference table, a search table with the highest number of merged peaks, against the remaining peaks using a sorting criterion until all searchable peaks have been processed. The algorithm DISCO () uses landmark peaks in each sample that are mapped to landmark peaks in a reference sample using Euclidean distance to calculate RT similarity and Pearson's correlation coefficient to determine the similarity of mass spectra. Based on the landmark peaks, the method determines a local linear interpolation that is applied to non-landmark peaks, thereby correcting for non-linear RT distortion.) have introduced two different algorithms to approach the peak alignment problem in GC  GC-MS. The SmithWaterman peak alignment (SWPA) approach uses variants of dynamic programming to find a peak matching with maximal score for pairwise alignments. Their mixture similarity peak alignment (MSPA) method includes the optimization of a likelihood function based on a parameterized mixture similarity, which involves the dot product as mass spectral similarity and RT deviation calculation with different distance metrics. Both of their approaches extend the pairwise alignments transitively to a multiple peak alignment, based on a prior chosen reference peak list. GUINEU () uses the SCORE ALIGNMENT algorithm, which is based on a combined score, using predefined windows for first and second dimension RT deviations and retention index deviation. The method scores neighboring peaks against potential target peak groups, building candidate paths of related peaks. The weighted cosine product is used to avoid alignment of mass spectra with low pairwise scores, with a user-defined minimum threshold. Path generation and evaluation is performed in parallel and followed by a subsequent postprocessing phase, where peaks that were assigned to multiple groups are reassigned to the peak group with highest score until all such conflicts are resolved.use a statistical model to align the peaks, based on pairwise peak scores calculated from mass spectral similarity (cosine score) and RT deviation score functions. Their approach uses landmark peaks with a high posterior probability according to their model to calculate an RT correction for the remaining peaks, which fall below a specific posterior probability threshold. They additionally calculate a corrected RT for aligned peaks. The BIPACE and BIPACE RT algorithms were introduced in, showing their applicability for peak alignment of one-dimensional gas chromatography-mass spectrometry data. BIPACE 2D is a novel extension of BIPACE that uses the 2D RT information in addition to mass spectral similarity to align peaks across multiple chromatograms without requiring a user-defined reference chromatogram.
BiPACE 2D pairwise peak similarity functionGiven a chromatogram C  fp 1 , p 2 ,. .. , p ' g as an ordered set of peaks, we define a 2D peak p  m, i, t 1 , t 2  as a tuple of a mass vector m, an intensity vector i, both with the same dimensions, a first column RT t 1 and a second column RT t 2. For two peaks p and q, represented by their binned mass spectral intensity vectors with first column RTs t 1, p , t 1, q , second column RTs t 2, p , t 2, q and RT tolerances of D 1 and D 2 , for the first and second column, respectively, we define a similarity function following Robinson et al. (2007) as follows:where s(p,q) is an arbitrary similarity function between the mass spectral intensity vectors, such as the cosine, the weighted cosine (), the dot product, Pearson's linear correlation coefficient or Spearman's rank correlation coefficient. The f 2d ,  can be interpreted as a likelihood function that independently scores the proximity and mass spectral similarity of its arguments. It is maximized by peaks that have low deviation in RTs and a high mass spectral score. The impact of deviations in either RT dimension can be individually adjusted via the RT tolerance parameters D 1 and D 2 of the Gaussian RT penalty terms, where a higher value allows for larger RT deviations. To prune the search space early during the pairwise all-against-all peak similarity calculation phase of our algorithm, each RT penalty term has an additional threshold parameter (T 1 and T 2 , respectively) that allows to effectively stop any further evaluation of f 2d ,  if the value of the threshold for that term is not attained or exceeded. Thus, the mass spectral score function may not need to be evaluated at all, resulting in a large speedup at the expense of reduced sensitivity toward peaks with larger RT deviations.
Peak pair matchingGiven K chromatograms C 1 ,. .. , C K , let S  V, E be a complete K-partite, weighted graph with vertex set V  P 1 [ ::: [ P K , where partition P i consists of all peaks from chromatogram C i , and edge set E represents the similarity values between all peak pairs from different chromatograms. Finding all peak groups with maximal pairwise similarity in S is equivalent to enumerating all cliques of S, a problem that relates to the classic NP-complete problem CLIQUE (with a runtime exponential in the size of the input, in this case the number of peaks. Then, for each pair of peaks p 2 C and q 2 C 0 from distinct chromatograms C and C 0 , the peak with highest similarity to p in C 0 , denoted q 0 , and the peak with highest similarity to q in C, denoted p 0 , can be assigned as bidirectional best hits (BBHs) of each other, if p  p 0 and q  q 0 (). All peak similarities of p to other peaks in C 0 and of q to other peaks in C are set to a minimum similarity value, effectively removing the corresponding edge in S, whereas the similarities of the BBHs p and q are retained.
Merging and multiple alignment constructionBased on the reduced set of BBHs, let V 0 be the set of all vertices that are part of at least one BBH and S 0  V 0 , E 0  the reduced K-partite BBH graph with V 0 as its vertex set and E 0 as its unweighted BBH edge set. The S 0 has, by construction, a polynomial bound on the number of maximal cliques contained in it. These cliques can be enumerated in polynomial time (). Then, starting from the initial bicliques (the BBHs), the cliques in S 0 are merged into larger cliques, if all peaks within the potential clique are BBHs of each other. Otherwise, the largest peak group that is also a clique is retained, whereas all peaks that are not BBHs of at least one of the retained peaks in the group are removed. Merging is continued until all cliques have been processed. After completion of the merging phase, cliques with at least k peaks, as controlled by the minimum clique size (MCS) parameter, are reported in a multiple alignment table, ordered by their median RT. Peaks that are not included in any of the final cliques are optionally reported in the automated mass spectal deconvolution and identification system (AMDIS)-compatible mass spectral program (MSP) format () with their mass spectrum, RT, originating file and a unique ID for manual inspection. Following, the time and space complexity of BIPACE 2D and BIPACE are equivalent to OK 2 ' 2  in time and OK 2 ' in space, where K is the number of chromatograms and ' the upper bound of the number of peaks in each chromatogram. The lower asymptotic space complexity results from the BBH selection process that stores for every peak in one chromatogram only its best corresponding peak in every other chromatogram.
Reference dataset generationTo evaluate their 2D RT alignment algorithm MSPA,use the raw peak lists as created by the ChromaTOF software (LECO Corp, St Joseph, MI, USA) and create reference multiple alignments based on the assigned peak names. Because each peak list can contain multiple peaks with the same name, the authors use a method to resolve such potential conflicts by selecting the peak with the largest recorded area as the representative for a group of otherwise identically named peaks. This approach is referenced in the remainder of this article as 'grouping by maximum area' (GMA). As we have investigated, GMA may lead to arbitrary and spurious assignments of peaks to the same alignment row (with identical names across peak reports), hampering the clear definition of what true and false positives as well as negatives are. Examples of potentially problematic assignments for MSPA dataset I (see Section 3.1 for details) are the compounds (naphthalene), (naphthalene, 2-methyl-), (anthracene), (benzoperylene), (indenopyrene), (phenol, pentachloro-) and (phenol, 2,3,5,6-tetrachloro-), all of which appear to have been assigned the wrong name in a number of cases, as is shown in Supplementaryof Supplementary File S1. Corresponding plots for the other datasets are available as Supplementary Figures S2S4 in the same supplementary file. The complete data comparing the GMA reference creation approach to our proposed approach for all datasets used in this work are contained in Supplementary File S2 for each dataset.
The MGMA approach To addressthe issues with the approach used by, the reference generation method was modified to remove spurious assignments that relate back to potentially false assignments of peak names by the ChromaTOF software. As mentioned previously, additional problems may arise from the selection process that relies solely on picking the peak with the largest area as the representative for a group of identically named peaks within each report. The new method 'modified grouping by maximum area' (MGMA)calculates, for all equally named peaks (peak groups) in all peak reports, the standard deviation of the RTs in the first and second dimension of separation. For an arbitrary group of peaks P with the same name, x : t 1 P and y : t 2 P are defined as the standard deviations of the peak group RTs in the first (t 1 ) and second (t 2 ) dimension of separation. An elliptical function centered at x 0  0 and y 0  0 and with a major radius defined by a (maximum allowed standard deviation for t 1 ) and minor radius defined by b (maximum allowed standard deviation for t 2 ) is then used to calculate the decision criterion z:If z 1, the group is retained. Otherwise, if z41, the group at x, y is outside of the bounds of the ellipse defined by x 0 , y 0 , a, b and is marked as a potential outlier group. The parameters used for a and b for the different datasets examined in Section 3 are given in. Peaks belonging to outlier groups are removed by MGMA without further consideration, as a large deviation in one or both RT dimensions may be a strong hint toward wrongly assigned peak names. An approach to further discriminate the members of such groups may lead to additional sources of false peak assignments and has thus not been considered at this stage. Additionally, all peaks that occur only once throughout all peak reports are removed, as they cannot provide any reliable grouping information and may again have resulted from spurious identifications by the vendor software due to different sample quality and/or non-optimal parameter settings used during peak detection and putative peak identification. The final reference multiple alignment is then created using GMA on the remaining peaks. MGMA thus reports a completely contained subset of the original peaks as reported by GMA. An example for this is given in Section 3.3.
Peak alignment performance evaluationA reference alignment peak group defines whether a peak, represented by its index in the original peak list, is present in a sample or absent. Each column in the reference alignment corresponds to one sample's peak list, whereas each row represents an aligned peak group, spanning multiple samples. The results of each alignment algorithm are tested against each reference alignment group until either a match is found or the group is reported to be non-assignable to a counterpart in the reference alignment. If a reported peak group can be positively assigned, all of the group's peaks that are present in the corresponding reference alignment group are counted as true positives (TP). Peaks that are absent in both the reference and reported alignment peak group are counted as true negatives (TN). A peak that is reported as absent in the reference alignment group, but as present in the alignment algorithm's reported group, is recorded as a false positive (FP). A false negative (FN) is counted if a peak is present in the reference alignment group but not reported by the alignment algorithm's corresponding peak group. The following commonly applied measures are used to assess the quality of a multiple alignment:For each multiple alignment result obtained from a method, all unmatched peaks of the reference alignment, excluding absent ones, are added to the number of FN to normalize Recall and F1 score with respect to the size of the reference alignment. We discuss the advantages and disadvantages of our row-wise multiple alignment evaluation over the pairwise alignment evaluation as used by) in Supplementary File S1. In the remainder of this work, we refer to the value of the average F1 score based on pairwise alignment evaluation for each algorithm parameterization as F1 p. Differences in the resulting numbers for F1 p to the numbers published inare due to the evaluation scheme that we use. We compare all possible unique pairwise combinations of alignment column pairs against the corresponding reference alignment columns. Thus, our absolute TP, FP, TN and FN numbers are higher, and the F1 p tends to be generally lower.
RESULTS AND DISCUSSIONThe GNU R scripts available with) were carefully adapted to be able to run them within an automated evaluation pipeline. The MSPA and SWPA dataset peak lists were used unaltered as input to all evaluated programs, keeping peaks that were split across multiple modulations, while removing peak artifacts with an identical area. To make the gap-less multiple alignment output of MSPA and SWPA comparable with the gapped multiple alignment of BIPACE 2D, we modified the corresponding R-code to not remove incomplete peak groups. GUINEU was modified to parse the ChromaTOF peak file format with separate fields for first and second column RTs and was further adapted to run without a graphical user interface and to record the original row index of each peak in the original peak list for later evaluation. The algorithms BIPACE, BIPACE RT and BIPACE 2D were evaluated against GUINEU's score alignment (), MSPA () and its variants PAD, PAS, DW-PAS, SW-PAD and PAM, as well as against SWPA () and its variants SWRM, SWRE, SWRME and SWRME2. The MSPA, SWPA and GUINEU methods used the ChromaTOF peak lists as input directly. For the BIPACE methods, we converted the ChromaTOF peak lists to a backwards compatible extended netCDF format (), supporting first and second column elution time. BIPACE also supports mzML input files (), containing the standardized spectrum attributes first_column_elution_time and second_column_elution_time. The parameterizations reported as optimal by both the OP-PAM and the likelihood-based parameter optimization for the SWPA methods were explicitly included in the evaluation for each of the respective methods. The results for the MSPA SW-PAD variant using Pearson's correlation between spectra and Euclidean distance for RT matching correspond to the results of the DISCO algorithm (). A detailed overview of the best results for each dataset and variant is available in Supplementary Tables S1S4 of Supplementary File S1. Each algorithm was run and evaluated for a range of different parameter values. The user-configurable parameters (penalty terms, mass spectral score function, RT distance function) for MSPA and SWPA were taken from the corresponding publications (). We tested all viable combinations of score function (dot product, linear correlation) and RT distance functions (Manhattan, Euclidean, Canberra, Maximum). Kim and Zhang (2013) provide a recent comparison of MSPA using an additional set of similarity functions that were not evaluated here. For BIPACE and its variants, the varied parameters included the mass spectral score function, RT penalty terms (BIPACE RT and BIPACE 2D) and RT penalty threshold (BIPACE RT and BIPACE 2D). The parameter values for all methods are available for each dataset individually within Supplementary File S2. Plots of the runtime and memory usage of each parameterized method are included in Supplementary File S1. They reflect only the peak alignment phase, not the data import and filtering phases of the algorithms.
MSPA datasetsThe authors of the MSPA publication () evaluated their algorithms on two different datasets. The first one, here termed MSPA dataset I, consists of 10 samples of 106 standard compound mixtures, measured throughout with the same temperature gradient. It contains 1672 peaks in total, of which 752 in 81 rows were used in the GMA reference alignment. These were further reduced to 592 peaks in 64 rows by MGMA. The second dataset, MSPA dataset II, contains five samples of rat plasma with spiked-in 6compound standards, also measured under identical temperature gradient conditions. The original peak reports contained 3575 peaks. These were reduced to 1682 peaks in 493 rows by GMA's reference alignment generation, and further reduced by MGMA to 1081 peaks in 320 rows.shows the F1 score obtained for each of the methods under consideration, against both GMA and MGMA reference alignments. For both references, BIPACE 2D achieves the highest F1 scores (0.9296 for GMA and 0.9472 for MGMA reference), followed by BIPACE RT (0.9181 and 0.9322). The GUINEU (0.9082 and 0.9165) and MSPA-PAM (0.905 and 0.9169) variants follow closely behind. BIPACE 2D also has a consistently better precision value (0.9551 and 0.9607) than any of the other methods. On both references, the best BIPACE 2D instance uses RT penalty parameters of D 1  10, D 2  0:5, MCS  2, the dot product as mass spectral similarity and RT penalty thresholds of T 1  0 and T 2  0:99, effectively allowing only small differences in the second dimension RT. BIPACE 2D also achieves the best average pairwise F1 p). The best instances use the weighted cosine or cosine mass spectral score function, or Pearson's linear correlation, and not the dot product, in comparison with the results in MSPA dataset I, where the dot product was more competitive. The best BIPACE 2D instance on the GMA reference also achieves the highest F1 p value (0:6857 AE 0:0264) with parameters D 1  25, D 2  0:5, MCS  2 and RT penalty thresholds of T 1  0:75 and T 2  0, effectively allowing only small differences in the first dimension RT, whereas allowing larger differences in the second dimension RT. BIPACE RT scores the highest F1 p value of 0:8231 AE 0:0201 on the MGMA reference with D  30, T  0:9 and MCS  2. The F1 and F1 p values for GUINEU, MSPA and the SWPA variants do not fall far behind in this case on either reference alignment in comparison with the other datasets (see Supplementary File S1, Section 4 for more details).
SWPA datasetThe SWPA publication () used two different datasets for evaluation purposes. However, SWPA dataset II (spiked-in) was excluded from this evaluation because it was identical to MSPA dataset II. SWPA dataset I is a combination of 16 samples, measured using three different temperature gradients. Therefore, it should be a significant challenge for RT-based algorithms. The dataset originally contained 2499 peaks, which were reduced to 1201 peaks in 83 alignment rows by GMA, and to 1090 peaks in 75 rows by MGMA. The parameters for the MGMA reference alignment are given in.3.2.1 Results for SWPA dataset I For this dataset, the MSPAPAM variant using dot product as pairwise spectral similarity and maximum distance for RT difference performs best when considering F1 score, with values of 0.8366 (GMA reference) and 0.8517 (MGMA reference). The best GUINEU instance achieves values of 0.7061 and 0.7148, whereas the best BIPACE instance achieves F1 values of 0.6966 and 0.7136, respectively. More details are shown in. Considering the F1 p score, the order is unchanged, with MSPA-PAM achieving 0:7942 AE 0:0914 and 0:8101 AE 0:0882, GUINEU scoring 0:5142 AE 0:314 and 0:529 AE 0:309 and BIPACE trailing with 0:4772 AE 0:248 and 0:4995 AE 0:2479, on GMA and MGMA references. The comparatively low F1 score for all BIPACE variants can be explained by many peaks that are reported as being absent, while they are present in either reference alignment. Those absent peaks are counted as FNs and thus lead to a low Recall value (Supplementary File S1, Section 5). However, the BIPACE variants perform better when considering TN and FP values. They report fewer peaks per peak group, resulting in a more conservative alignment when compared with either the MSPA or SWPA variants, at the expense of more TPs. BIPACE achieves high precision values for either reference (0.9049 and 0.9146), but lacks in Recall (0.5174 and 0.5397), leading to the comparatively low F1 and F1 p scores, whereas BIPACE 2D has slightly lower precision values (0.8588 and 0.8631) but higher Recall (0.5841 and 0.607). Detailed numbersscore for all parameterizations of the evaluated algorithms for MSPA dataset I. BIPACE 2D using the weighted cosine as similarity function between mass spectra outperforms all other methods for the best instances are given in Supplementary File S1,. A more detailed table including individual parameterizations of the best instances is contained in Supplementary File S2.
Chlamydomonas reinhardtii datasetThe C.reinhardtii dataset (CHLAMY dataset I) was originally analyzed in. The experiment explored the difference in H 2 production yield between the C.reinhardtii wildtype strain cc406 (WT) and the high H 2-producing strain Stm6Glc4 (MUT) at two different time points, namely, before (T1) and during (T2) the H 2 production phase, with three replicates for each of the factor combinations WT-T1, WT-T2, MUT-T1, MUT-T2, yielding a total of 12 samples. For this article, the stored original samples of that experiment were prepared according to the protocol in Doebbe et al. (2010) and then reanalyzed using a LECO Pegasus 4D time-of-flight mass spectrometer (LECO, St Joseph, MI, USA). The Pegasus 4D system was equipped with an Agilent 6890 gas chromatograph (Agilent, Santa Clara, CA, USA).
Sample acquisitionSplitless injection of 1 ml sample volume was conducted at 275 C injector temperature. The gas chromatograph was equipped with a 30 m  0.25 mm  0.25 mm film thickness, Rtx-5 ms (Restek Corp., Bellefonte, PA, USA) capillary column used as the primary column and a BPX-50 (SGE Incorporated, Austin, TX, USA) 2 m  0.1 mm  0.1 mm capillary column used as the secondary column. The temperature program of the primary oven was set to the following conditions: 70 C for 2 min, 4 C/min to 180 C, 2 C/min to 230 C and 4 C/ min to 325 C hold 3 min. The temperature program of the secondary oven was set with an offset of 15 C to the primary oven temperature. The thermal modulator was set 30 C relative to the primary oven and used a modulation time of 5 s with a hot pulse time of 0.4 s. The mass spectrometer ion source temperature was set to 200 C, and the ionization was performed at 70 eV. The detector voltage was set to 1600 V and mass spectra were recorded at 200 scans/second using a scanning range of 50750 m/z.
Sample processingThe samples were processed automatically by the LECO ChromaTOF software v.4.22 at a signalto-noise ratio of 100. The baseline offset was 0.8 and the two peak widths were set to 0.2 s (as measured from baseline to baseline) and 15 s (first dimension). By using the classification feature of the software, background peaks originating from column bleed or solvent tailing were removed. Analytes were putatively identified by database searches using the Golm Metabolome Database, version 20100614 (). The minimum required similarity threshold for assignment of a compound name was set to 600. The original ChromaTOF peak lists contained a total of 31 695 peaks for the 12 samples. All peaks with best matching library spectrum similarity 5600, flagged as 'Unknown', were removed from further consideration. The original peak lists were exported from ChromaTOF using one field [R.T.for the first and second column elution time. Therefore, we introduced two separate columns for first and second column elution time ('1st Dimension Time (s)' and '2nd Dimension Time (s)') to make them suitable as input to both MSPA and SWPA. The resulting peak lists for each sample were further rectified by removing all peaks with unclear Golm Metabolome Database identifications containing an 'NA'. These steps were required to make the peak lists compatible to MSPA's and SWPA's peak merging preprocessing step, which was needed for the generation of the evaluation reference alignments with GMA and MGMA. These unknowns would otherwise have lead to false peak group assignments based on the peaks' non-unique names. The removal of 'Unknown' peaks and rectification of 'NA's reduced the number of peaks to a total of 4860. The final GMA reference alignment contained 2723 peaks in 369 rows, whereas the MGMA reference, using the parameters given in, contained 1629 peaks in 224 rows.
Results for CHLAMY datasetI All three BIPACE variants using either the cosine or Pearson's linear correlation as similarity functions between mass spectra perform better than either GUINEU, MSPA or SWPA variant (). BIPACE 2D achieves F1 scores of 0.6692 (GMA reference), 0.7662 (MGMA reference) and 0.7429 (MANUAL reference), with D 1  100, D 2  0:5, thresholds T 1  0:99 and T 2  0:99, together with an MCS value of 2. The F1 values are visualized in. BIPACE 2D also achieves the highest Recall values of 0.5752 (GMA), 0.7079 (MGMA) and 0.7596 (MANUAL), whereas still maintaining reasonable values for Precision between 0.72 and 0.835 (Supplementary File S1, Section 6). The considerably low values for Recall achieved by the different methods may be due to the complexity of the biological samples and the large number of closely related peaks and associated peak areas. The best average pairwise F1 p scores are also achieved by BIPACE 2D (GMA: 0:7198 AE 0:0335, MGMA: 0:8293 AE 0:0247, MANUAL: 0:864 AE 0:0606), with GUINEU (GMA: 0:6434 AE 0:0419, MGMA: 0:7766 AE 0:0338, MANUAL: 0:8481 AE 0:0528) placing second and different MSPA variants placing third (GMA, MSPA-PAM: 0:5976 AE 0:1283, MGMA, MSPA-DWPAS: 0:6907 AE 0:1296, MANUAL, MSPA-SW-PAD: 0:7475 AE 0:1741). Supplementary File S1, Supplementary
CONCLUDING REMARKSWe have introduced BIPACE 2D, an algorithm and software for RT alignment of peak data from GC  GCMS experiments. It is implemented in the platform-independent Java programming language and aligns peak data in vendor-independent formats, such as mzML () or netCDF. ChromaTOF peak lists can be converted to netCDF files using the software Maui (also available at http://maltcms.sf.net). We have shown that BIPACE 2D is a competitive algorithm that is able to achieve better precision and recall, as well as F1 and average pairwise F1 p score values in comparison with MSPA, SWPA and GUINEU on three of the four evaluated datasets. These three datasets were all acquired under homogeneous conditions, whereas the dataset where BIPACE 2D did not outperform MSPA and GUINEU was acquired under heterogeneous conditions. Thus, BIPACE 2D should ideally be applied to data acquired under the same conditions, but due to its low FP rate, it may still be a valid alternative for data acquired under heterogeneous conditions as well. Concerning the parameters for BIPACE 2D, the weighted cosine appears to be the most sensitive mass spectral similarity and should therefore be used as the default. The MCS parameter was set to the minimum size of two in all evaluated parameterizations, thus leading to all cliques being reported by BIPACE and its variants. The D1 and D2 parameters should be set according to the expected RT standard deviation of the samples under comparison, in separation dimensions one and two, respectively. Finally, the threshold parameters T1 and T2 allow for fine-tuning of the sensitivity of the algorithm, where higher values exclude potential matches earlier during the pairwise similarity calculation phase of BIPACE. It is further notable that BIPACE 2D was on average 310 times faster than any of the MSPA or SWPA variants for the larger and more complex datasets (SWPA dataset I and CHLAMY dataset I, see Supplementary File S1 for details), while consuming less memory. GUINEU achieved comparable speed but required more memory. We have demonstrated the applicability of BIPACE 2D to small datasets with a few compounds, as well as to larger datasets with hundreds to suspected thousands of different compounds. BIPACE's pairwise similarity calculation can be run in parallel using multiple CPU cores to speed up its runtime. It has been successfully tested on 250 files containing 100 000 peaks on commodity hardware within 9 GB of random access memory. This qualifies BIPACE 2D as a good candidate for automated medium to high-throughput applications in the field of metabolomics and analytical chemistry.
ACKNOWLEDGMENTS
BiPACE 2D at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
N.Hoffmann et al. at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
MGMA BiPACE BiPACE w/ 2D RT BiPACE w/ RT Guineu mSPA DWPAS mSPA PAD mSPA PAM mSPA PAS mSPA SWPAD SWPA SWRE SWPA SWRM SWPA SWRMe SWPA SWRMe2 F1 Similarity Cosine of Angle Dot Product Pearson's Corr. Weighted Cos.
.3.3 Manual reference To define the manual reference alignment, the reduced peak lists without 'Unknown's and 'NA's were inspected and only peaks were kept that could be positively confirmed by assigned name and RTs within two of the three samples within each factor combination of the experiment. For a number of unclear cases, we additionally compared the mass spectra of the questionable peaks manually to check for common characteristic mass fragments. The final manual reference alignment contained 436 peaks grouped into 68 distinct rows. The overlap of the three reference multiple alignments is visualized in Figure 4. As expected, the MGMA reference is a perfect subset of the GMA reference. More interestingly, there is a large overlap of the manual reference with the automated methods' reference alignments, supporting the claim that these automated methods for reference generation based on the assigned compound names capture most of the peak alignments contained in the manual reference alignment. A small proportion of 28 peaks (6.4% of peaks in the manual reference) occurs exclusively within the manual alignment and not within any of the automated methods. Of these, 24 peaks were differently assigned in the automated methods versus the manual reference, whereas four peaks were not reported at all by those methods. In all, 149 peaks were found missing from the manual reference in comparison with the GMA reference generation method, due to the stricter selection criteria that were used to exclude potential FP peak assignments. The manual reference alignment, the peak reports for each sample as exported from ChromaTOF and the raw data files in netCDF format are available as dataset MTBLS37 from the MetaboLights database (Haug et al., 2013). Fig. 4. Venn diagram of the peak set overlap for CHLAMY dataset I for GMA, MGMA and manual multiple alignment reference generation
MANUAL MGMA BiPACE BiPACE w/ 2D RT BiPACE w/ RT Guineu mSPA DWPAS mSPA PAD mSPA PAM mSPA PAS mSPA SWPAD SWPA SWRE SWPA SWRM SWPA SWRMe SWPA SWRMe2 F1 Similarity Cosine of Angle Dot Product Pearson's Corr. Weighted Cos. Fig. 5. F1 score for all parameterizations of the evaluated algorithms for CHLAMY dataset I. BIPACE 2D performs clearly better than any of the other methods using the dot product as pairwise similarity between mass spectra
