Motivation: Huge genetic datasets with dense marker panels are now common. With the availability of sequence data and recognition of importance of rare variants, smaller studies based on pedigrees are again also common. Pedigree-based samples often start with a dense marker panel, a subset of which may be used for linkage analysis to reduce computational burden and to limit linkage disequilibrium between single-nucleotide polymorphisms (SNPs). Programs attempting to select markers for linkage panels exist but lack flexibility. Results: We developed a pedigree-based analysis pipeline (PBAP) suite of programs geared towards SNPs and sequence data. PBAP performs quality control, marker selection and file preparation. PBAP sets up files for MORGAN, which can handle analyses for small and large pedigrees, typically human, and results can be used with other programs and for downstream analyses. We evaluate and illustrate its features with two real datasets. Availability and implementation: PBAP scripts may be downloaded from http://faculty.washington. edu/wijsman/software.shtml.
IntroductionTechnical advances have allowed the acquisition and use of tremendous amounts of marker data for both population-and pedigreebased genetic studies (). For human population-based studies, multiple computational tools and workflows already exist for file manipulation, quality control (QC) and basic analysis of genotype data (). For pedigree-based studies, preparation and manipulation of files is similarly crucial for downstream analyses. Some tools used to format files and perform QC in population-based studies can also be used in pedigree studies, but additional pedigreespecific preparations are also necessary in the search for rare, high risk sequence variants. Pedigree-based designs are again being used in the search for rare disease-causing variants. Pedigree-based datasets are a useful resource (), and diverse analysis programs exist that can handle smaller pedigrees (e.g. Merlin) () and large pedigrees (e.g. Simwalk2, MORGAN) () with extensive marker data. For computational reasons, smaller pedigrees are typically less than 27 bits,) with followup on sequence data in the linkage regions from the same families. Considerable software exists for carrying out computations on pedigrees to extract maximal information on identity-by-descent (IBD) (;; Tong and). Smaller pedigrees can be analyzed with exact computation, while larger pedigrees require Markov chain Monte Carlo (MCMC) sampling (). It is important to note that full pedigree analysis based on IBD probability estimation can be substantially more powerful than approaches that split the pedigrees followed by exact IBD computation, thus emphasizing the need for use of MCMC sampling methods in the context of large pedigrees (). Careful sub-selection of markers is necessary for some analyses when dense markers are available on pedigrees (). In a multipoint analysis, it is important to minimize linkage disequilibrium (LD) between markers to avoid inflated type I error rates () and to comply with intrinsic assumptions in the computational algorithm () used by most programs that carry out multipoint analyses. It is also important to minimize the number of markers used to reduce computational time, while retaining enough markers to achieve high information concerning inheritance patterns. It is not necessary to use all markers (). The block-based approach, which was developed for smaller pedigrees to circumvent the LD problem, is no longer as effective as it originally was due to the density of current marker panels coupled with the constraints on the block size (). All three goals can be achieved by judicious selection of a subset of markers from a dense panel of markers. Most modern linkage analysis programs make use of inheritance vectors (IVs), which represent the flow of chromosome positions through pedigrees (). IVs are typically used internally for linkage analysis using the LangeSobel estimator (). MCMC estimation is employed by several linkage analysis programs [e.g. MORGAN, Simwalk2 and Superlink-Online single-nucleotide polymorphism (SNP)] for large pedigrees (; Tong and). IV probabilities can also be used to estimate IBD sharing between pairs of individuals (). These probabilities may be stored for later reuse, providing significant computational advantages in downstream analyses. IVs may also be used to augment sequence data by genotype imputation () and subsequently evaluated by family-based single-SNP or SNP-set association analyses (). Despite the availability of various computational tools for pedigree analyses, we still lack a unified comprehensive system that eases the crucial steps needed to work with dense markers. Older file manipulation and QC tools exist that were developed for use with sparse microsatellite or SNP panels () but are not always suitable or accurate for use with current, dense genotyping. File manipulation tools for dense data are available (), but preparing files can be challenging especially when studies involve data for large pedigrees or when they entail combining data from multiple file sources. At least two programs exist that begin to address selection of a subset of markers for linkage analysis: MArker SElection for Linkage (MASEL) () and LINKDATAGEN (). MASEL selects SNPs based on a user-specified LD threshold and weights for several parameters () but does not impose a minimum intermarker distance (MID) and requires prior steps to filter SNPs. LINKDATAGEN performs error checks, removes all Mendelian inconsistent errors and selects SNPs based on user-specified bin size, minimum distance between markers and HapMap populationspecific allele frequencies () but does not specifically use LD to select SNPs. Neither programs have options to force inclusion nor exclusion of specific markers. It is therefore possible to perform file manipulation, marker selection and QC checks by using multiple existing tools, but a unified system that performs all desired functions would be useful. We have developed a pedigree-based analysis pipeline (PBAP) suite of programs that carry out file manipulations and QC checks prior to downstream analyses, with a focus on human data. PBAP prepares data files in a MORGAN-compatible format, carries out marker and pedigree QC analyses and automates marker selection for a good linkage panel while allowing the user considerable flexibility for inclusion or exclusion of markers. Results obtained after running programs of the MORGAN package () on the formatted files can be used for various downstream analyses.
Methods
Description of PBAP
Data input filesPBAP, schematically illustrated in, uses two project data input files: a pedigree file and a genotype file. An optional phenotype file may also be present. For the genotype file, two formats may be used: (i) a normal file format, e.g. PLINK *.ped (), has the genotype data for individuals in rows (i.e. row: subject), as is typical in linkage analysis software (), while (ii) a transposed file format has genotype data for each individual in columns (i.e. row: marker), as is used in genotype imputation and in GWAS software (). PBAP carries out further steps with the transposed file format, which allows processing of dense genotype data. Input files that are in the normal file format are first converted into the transposed file format. Details of these two file formats and ancillary files are provided in the PBAP documentation. We note that although the emphasis here is on use of SNP arrays, PBAP also allows inclusion of short tandem repeats (STRs) in a marker subpanel (described further below). PBAP uses two main types of reference data input files: map files [e.g. PLINK *.map (and main population genotype files [e.g. derived from the 1000 Genomes Projectdata (. We have constructed such files from public data, although PBAP users may construct and use any reference files of their choice that contain the necessary information. These reference files should be prepared prior to using PBAP. For the reference map files, we combined the Rutgers smoothed framework map and the Rutgers map of all dbSNP Build 134 variants (). On the merged map files, we converted PBAPKosambi distances between markers to Haldane distances, thus providing Haldane genetic locations (cM). For the reference genotype files, we downloaded 1000 G data. We used a custom Perl script, which is included in the PBAP release, to pre-process the 1000 G genotype files (i.e. to exclude indels and duplicate entries) for the different main populations [African (AFR), Admixed American (AMR), East Asian (ASN) andEuropean EUR)] (). In all examples presented here, we used the genotype data for the European population. In selecting marker subpanels described below, PBAP requires pedigree files, these pre-processed reference genotype files, and uses PLINK () to calculate main population allele frequencies and to generate LD estimates.
Marker subpanelsWe define a marker subpanel to be a subset of markers selected from an original dense marker panel. From a dense panel, one or more non-overlapping marker subpanels are selected in a stepwise manner. The goal is to obtain good marker subpanels, which contain highly informative markers for linkage analysis or IBD estimation (). These markers are chosen with three constraints: (i) to minimize LD among selected markers (), (ii) to be spaced at a distance that is compatible with MCMC-based approaches () and (iii) to minimize the number of markers chosen within constraints 12 to minimize computational time while retaining overall IBD information. For pedigree structure validation, which may be necessary as simple sample QC, only one marker subpanel across all chromosomes is needed. For linkage analysis, two or more additional non-overlapping marker subpanels may be useful as a check that undetected genotype errors are not influential (). PBAP can select five or more marker subpanels depending on the size of the dense panel. PBAP users may also pre-specify markers that should be excluded from the marker subpanel (i.e. exclusion markers) and/or included in the marker subpanel (i.e. inclusion markers). Inclusion/exclusion options are particularly useful when troubleshooting, comparing results from other studies or combining sparse STR marker panels with denser SNP panels. For the inclusion markers, users should specify whether a marker should always be included in the marker subpanel (i.e. core inclusion marker) or will be given priority but should pass thresholds for minimum MAF (in the reference dataset), minimum marker completion and should not be monomorphic in the dataset (i.e. auxiliary inclusion marker). PBAP users should specify the direction in which the markers will be processed [i.e. from upstream to downstream markers (forward direction) or from downstream to upstream markers (reverse direction)] and starting marker (i.e. markers upstream or downstream of this marker will be excluded when user chooses forward or reverse directions, respectively). The selection of marker subpanels for pedigree structure validation comprises three processes. The first process excludes markers upstream or downstream of the user-specified starting marker and uses a fifth of the user-defined MID in centimorgans (cM) to create a distance-based reduced pre-subpanel to improve computational efficiency. For LD-based SNP pruning on this pre-subpanel (), PBAP uses a maximum LD threshold (r 2 ) value specified by the user and a window size spanning 1 cM that allows the user to obtain an LD-reduced pre-subpanel. The second process returns inclusion markers to this LD-reduced pre-subpanel. Core inclusion markers are permanently added into the marker subpanel, while auxiliary markers must pass thresholds specified above. The third process selects a set of markers for each of the marker subpanels using following criteria: (i) choice of main reference population to allow PBAP to use population allele frequencies appropriate for the dataset, (ii) minimum and maximum MAF in the reference population, (iii) minimum marker completion threshold of genotyped subjects, (iv) inclusion/exclusion of monomorphic markers in the dataset, (v) direction in which markers will be processed, (vi) starting marker and (vii) MID. In a real pedigree dataset, the realized MAF may be lower than it is in the reference population. PBAP selects markers based on criteria (i) through (iv) before using criteria (v) through (vii). The same processes are also used for selecting marker subpanels for linkage analysis or marker IBD estimation with one additional step. This step identifies regions where adjacent markers in the presubpanel currently have a distance of 2 MID (i.e. gaps). These gaps are then filled in by allowing use of slightly less common variants (i.e. minimum MAF used is 0.05 lower than user-defined minimum MAF) and a slightly smaller MID (i.e. 0.1 cM smaller than the user-defined MID) but still using the same maximum MAF and same thresholds for marker completion and r 2. Filling in these gaps minimizes loss of information that may be important for downstream analyses. PBAP cumulatively stores markers selected and excludes them in subsequent subpanels to obtain non-overlapping subpanels. These criteria or parameters are listed in.
Pedigree structure validationRelationship or sample errors are identified by comparing theoretical coefficients based on pedigree structure (with thecoefficients estimated using genotype data. PBAP uses a likelihoodbased estimator for computing kinship coefficients (^ u) and genotype-based identity by descent probabilities of sharing one allele ( ^ k 1 ) (). Likelihood estimators are more efficient than moment estimators (), and unlike moment estimators that require dense arrays to achieve equivalent accuracy, a likelihood estimator is reasonably accurate for use even with SNP arrays that may sometimes consist of only sparse linkage panels (). In the process of calculating u and k 1 based on the pedigree structure, PBAP also identifies all pairs of simple relationships as close as or closer than great-grandparent-great-grandchild. Using empirical confidence intervals (CIs; see below) for both ^ k 1 and ^ u for a particular pair of individuals, PBAP compares pedigreebased pairwise k 1 and u and genotype-based pairwise estimated ^ k 1 and ^ u to detect possible relationship errors. Once a potential error is detected, the user must decide whether or not to correct it in the pedigree and genotype input files (). To generate empirical CIs for both ^ k 1 and ^ u, we performed several steps. First, we created a dataset that contains all pairs of simple relationships, i.e. as close as or closer than great-grandparent-greatgrandchild. Second, we used allele frequencies of Illumina 6K array markers from a real dataset () and simulated 10 000 replicates of full marker panels genome-wide on multiple copies of the dataset using the program genedrop from the MORGAN package (). We represented 3 K, 6 K and 9 K panels, respectively, by 2819, 5624 and 8924 markers chosen from this Illumina 6 K array. For the additional 3300 markers in the 9 K panel, we randomly selected allele frequencies of markers from the same Illumina 6 K array. We used the three panels to have good representation of a genome-wide evenly spaced linkage panel (i.e. contains 50006000 markers). Third, we estimated the three identity coefficients ( ^ k 0 , ^ k 1 and ^ k 2 ) from these simulated genotypes, where ^ k i is the probability of sharing i alleles IBD. Using these three identity coefficients, values for ^ u were estimated (). Last, the empirical CIs of ^ k 1 and ^ u for different numbers of panel markers in each of the relationship categories were estimated based on the minimum and maximum values obtained for the three panels above (; Supplementary Figs S1 and S2) using a linear model with quadratic coefficients. The combined set of empirical CIs for each pair of simple relationships mentioned above for k 1 and u, whose expectations are the pedigree-based coefficients, are unique and are therefore sufficient to distinguish these relationships from one another.
Sampling realizations of IVsFor each marker subpanel generated, PBAP prepares MORGANcompatible files and executes the program gl_auto of the MORGAN package () to sample realizations of IVs at each subpanel marker location and to check for Mendelian inconsistencies. When found, PBAP zeroes out the genotypes of all individuals in that pedigree for that particular marker. There are three major advantages to use MORGAN for pedigree computations. First, use of gl_auto for preliminary analyses dramatically speeds up subsequent analyses. Second, MORGAN handles large and complex (e.g. with cross generational marriages, inbreeding or marriage loops) pedigrees with MCMC-based computations faster and more accurately than other programs (). Third, MORGAN combines exact and MCMC computation, allowing exact computation for smaller pedigrees without user intervention. The sampled IVs are then available for use in a multitude of possible downstream analyses. As part of the file preparation with PBAP, the user specifies conditions required for gl_auto (). PBAP calculates an appropriate number of burn-in iterations and executes gl_auto to perform the analysis. Sampled IVs are pedigreeand chromosome specific.
Evaluation of PBAPTo illustrate the performance of PBAP, we used two real autism spectrum disorder (ASD) datasets that comprise (i) 71 small to large pedigrees (ASD1) (29 generations) () and (ii) a five-generation large pedigree with evidence of linkage to chromosome 22 () (ASD2). We used genome-wide data of ASD1 and ASD2 to demonstrate pedigree structure validation and chromosome 22 data of ASD2 to demonstrate marker subpanel selection. For ASD1, we had SNP data comprising markers in the Illumina 6 K and Illumina OmniExpress arrays where we used the latter array for pedigree structure validation in the presence of sample swaps described below. For ASD2, we had dense marker panel. Empirical CIs for genotype-based identity ( ^ k 1 ) and kinship (^ u) coefficients. Horizontal lines represent the expected k 1 and u for each of the different pairwise relationships. PO, parentoffspring; FS, full sibling; HS, half sibling; AV, avuncular. Dash-dots, dashes and long dashes represent the 95%, 99% and 99.5% CIs, respectively. See Supplementary Figures S1 and S2 for more comprehensive set of close relationships) took only 5 min and 18 s using a single core on a multi-core 2.26 GHz Intel Xeon computer, respectively, execution time is proportional to the number of markers and to the square of the number of genotyped individuals and thus increases rapidly with sample size. Second, selection of one marker subpanel from the ASD2 panel of 3500 markers on chromosome 22 used here took 39 s but execution time increases with each additional non-overlapping subpanel generated (e.g. obtaining five non-overlapping subpanels from this panel took about 4 min). In all of the analyses where PLINK was needed, we used PLINK v1.07. For comparison to an alternative, we also carried out marker selection using the marker subpanel selection tool, MASEL ().
Pedigree structure validationWe performed pedigree structure validation on ASD1 and ASD2. For each dataset, we selected one marker subpanel using the following criteria: (i) MID 0.5 cM, (ii) marker completion 80%, (iii) r 2 0.25 (less stringent since kinship estimation is not strongly affected by LD), (iv) 0.3 MAF 0.5 in 1000 G data since more common variants provide better kinship estimates and (v) starting marker. In all subpanel selections performed in this article, we excluded markers that were monomorphic in the dataset. Based on the specified pedigree structures of ASD1 (Illumina 6 k panel) and ASD2, we used PBAP to calculate the pedigree-based u and to identify close relatives. We then computed genotype-based ^ k 1 and ^ u for all pairs with genotype data. Pedigree-and genotype-based coefficients were compared to detect possible relationship errors. In addition, we created four different sample swaps simultaneously in three families of ASD1 (Illumina OmniExpress array) to further illustrate pedigree QC with PBAP. The relationship errors introduced were (i) parentoffspring, (ii) first-cousin, (iii) full-sibling-unrelated and (iv) parent-avuncular sample swaps. We created a full-siblingunrelated swap between a full-sibling (FS) and a sister-in-law, and a parent-avuncular swap between an FS pair where at least one of the siblings has one or more offspring.
Generating marker subpanels and performing linkage analysisUsing PBAP, we selected three non-overlapping marker subpanels to probe possible influential errors. We used the same MID and marker completion criteria used for pedigree structure validation but with r 2 0.04 (more stringent to minimize LD between markers), 0.2 MAF 0.5 in 1000 G data (common variants with lower minimum to allow inclusion of more markers) and different starting markers (any number from 1 to 10) to facilitate variability. Since chromosome 22 spans 80 cM, a target intermarker distance of 0.5 cM results in a maximum of 120160 markers, as was achieved using PBAP. Since MASEL also uses LD as a criteria in selecting marker subpanels, we compared MASEL with PBAP. To achieve a fair comparison, we pre-filtered the SNPs prior to using MASEL through the same MAF and marker completion criteria as for PBAP. To select marker subpanels for linkage analysis using MASEL,used four different weighting(1,1,2), representing different choices for weighting heterozygosity, intermarker distance and set size (i.e. number of SNPs removed due to LD or distance when a particular SNP is selected), respectively, in selecting markers. For example, for the first weighting scheme, MASEL uses equal weights for heterozygosity, intermarker distance and set size. Although distance is one of the parameters used by MASEL, the program does not allow the user to choose a specific MID. Using the same set of four weighting schemes and an r 2 0.04 (as for PBAP), we selected four different marker subpanels using MASEL. This resulted in 400 500 markers spanning chromosome 22 with many very close adjacent markers (0.002 cM). To obtain a sparser marker subpanel with MASEL, we used a lower maximum r 2 of 0.01 to select another set of three and four marker subpanels using both PBAP and MASEL, respectively. For each of these 14 marker subpanels (seven with r 2 of 0.04 and seven with r 2 of 0.01), we used PBAP and gl_auto to perform computations. For every marker subpanel, each analysis included 2500 burn-in iterations, sampling by scan, generation of 50 000 MCMC iterations, 50% L-sampler and saving 1000 realizations of IVs for inference. To compare the impact of marker subpanels generated by MASEL versus PBAP, we carried out linkage analysis with the IVs obtained from gl_auto by running PBAP using each marker subpanel, followed by the use of gl_lods of the MORGAN package (). For this purpose, we used data from a genome scan that identified positive evidence of linkage (lod max  1.8) in linkage analysis on chromosome 22 for the ASD2 dataset and used the same reduced-penetrance dominant model used previously (). The program gl_lods makes use of equivalence classes of locus-specific IVs (Koepke and) to avoid redundant calculation, thus dramatically increasing speed in the lod score computations.
Results
Reference data files and pedigree structure validationWe used the reference map files together with the 1000 G reference genotype files to select a set of non-overlapping marker subpanels with PBAP (). We also used the allele frequencies from the pre-processed 1000 G data in analysis with gl_auto to obtain IVs. We compared the pedigree-and genotype-based ^ k 1 and ^ u of the ASD1 and ASD2 datasets using PBAP. For FS pairs, there was one detected MZ twin pair in ASD1, while no relationship errors were detected in ASD2. For the four different sample swaps created in ASD2, PBAP flagged extreme points outside the empirical CIs for these parameters in all cases as shown in the different k 0 k 1 plots (), illustrating its ability to detect these types of errors.
Marker subpanels generated through PBAP or MASELCharacteristics of the marker subpanels that were generated using PBAP and MASEL are listed inas ranges of values from three and four subpanels, respectively. Marker completion and MAF for all 14 marker subpanels from ASD2 are 95% and 0.15, respectively. Minimum MAFs of marker subpanels with MASEL (0.200.21) are relatively higher than with PBAP (0.150.17), since PBAP lowers MAF in regions that require gap filling. MAF (ASD2 dataset) for all 14 marker subpanels is 0.012, which is lower than the user-specified minimum MAF. Since we used the same threshold for pre-filtering SNPs, dataset marker completion and MAF were all within the ranges specified for both types of panels. However, we obtained differences in the mean intermarker distances between marker subpanels obtained by PBAP and MASEL. For an r 2 of 0.04, the mean intermarker distances of PBAP and MASEL marker subpanels are 0.530.65 cM (range: 0.391.83 cM) and 0.160.17 cM (range: 0.0021.49 cM), respectively. After thinning, these MASEL marker subpanels mean intermarker distances increased to 0.480.51 cM (range: 0.011.98 cM) similar to that from PBAP, but there are markers that are still near each other even after thinning. For an r 2 of 0.01, the mean intermarker distances of PBAP and MASEL marker subpanels are 0.570.69 cM (range: 0.41.96 cM) and 0.941.0 cM (range: 0.044.15 cM), respectively. Note that the mean intermarker distances of the PBAP marker subpanels are near 0.5 cM for both r 2 of 0.04 and 0.01, while that of the MASEL marker subpanels varied from 0.16 to 1.0 cM. Moreover, maximum intermarker distances (cM) of the PBAP marker subpanels are <2 cM, with the larger gaps due to regions where there are no markers in the dense panel, whereas the larger gaps of MASEL marker subpanels had maximum intermarker distances >4 cM () with no way to prevent this.
Linkage analysis using sampled IVsBoth PBAP and thinned MASEL subpanels generated by using a maximum r 2 of 0.04 performed well in the region with the linkage signal (4053 cM) (). Among all panels, PBAP subpanel 3 almost matched the original linkage signal obtained with STRs, which was fully informative at the STRs in the peak. Although most of the panels give similar lod scores across the chromosome, PBAPcM compared with the original linkage lod scores in regions between two STRs. A similar trend was observed in marker subpanels obtained by PBAP and MASEL using a maximum r 2 threshold of 0.01 () where almost all subpanels performed relatively well at the linkage signal. However, with fewer markers, there was no longer a subpanel that almost matched the original linkage signal. From position 2640 cM, where there was a small set of negative lod scores with portions that are less negative in the original signal: the PBAP marker subpanel 3 has two of this type of small set, one of which has positive lod scores. In addition, all marker subpanels also have more negative lod scores from 1222 cM and 5360 cM compared with the original linkage lod scores. At this r 2 threshold, MASEL marker subpanels generated with different weighting schemes give more variable linkage results at the highest original linkage signal (4053 cM), while the non-overlapping PBAP subpanels still gave relatively consistent results.
DiscussionThe use of dense markers in pedigree-based data analyses is challenging and requires nontrivial file manipulation. Selection of subsets of markers, i.e. marker subpanels, from a dense panel can be a complex process based on joint optimization across several parameters. Here, we introduce PBAP, a pipeline of programs that automatically selects ideal subpanel(s) of markers from the complete available panel and performs basic QC steps. One advantage of PBAP is its flexibility, unlike some other existing programs that allow file preparation and analysis of pedigrees but have constraints in how they select marker subpanels from dense panels. Finally, PBAP prepares files in a format suitable for pedigree-based analyses (i.e. MORGAN file format) and accesses software (i.e. gl_auto) () to generate information suitable for pedigree-based analyses involving IBD information. This is particularly useful when samples include large pedigrees where estimation through MCMC is necessary, adding additional constraints to selection of marker subpanels. It is important to select an informative marker subpanel from a dense panel of SNPs to perform pedigree-based analyses involving IBD. PBAP automatically selects a subpanel with adequate flexibility for the user so that differences in dense panels and evolving genotyping technologies should not dramatically affect the results. In particular, PBAP includes specification of constraints needed to use methods that allow analysis of extended, as well as smaller, pedigrees. One of the main goals in selecting marker subpanels is to minimize significant LD between SNPs. The strategy used by PBAP avoids the need for considerable data and computing resources imposed by trying to model LD during the analysis and also scales easily to use of much denser data, such as is present in high throughput sequencing. A second goal was to facilitate use of computational methods that allow intact large pedigrees. As this currently requires MCMC, PBAP controls the MID and MAF chosen. Moreover, PBAP internally pre-filters SNPs based on user-specified MID, dataset marker completion and MAF range. With minute intermarker distances, MCMC-based methods suffer (). Similar results were observed from linkage analysis using both MASEL and PBAP marker subpanels. A difference was the amount of
at University of California, Los Angeles on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
A.Q.Nato et al. at University of California, Los Angeles on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
prior manipulation required to use MASEL for selecting subpanels, which is done internally by PBAP based on user-specified parameters. Comparable linkage results for both PBAP and MASEL subpanels may, in part, be due to the fact that ASD2 is an example of well-genotyped complex pedigree, where problematic MCMC mixing due to very small intermarker distances, and loss of information due to very large intermarker distances may not have a large impact on the linkage results. An important additional feature of PBAP is that it allows generation of non-overlapping subpanels, which may facilitate detection of influential genotyping errors based on the linkage results (Cheung et al., 2014). In addition, achieving similar linkage results from non-overlapping subpanels strengthens the evidence for a linkage signal and absence of a genotype error on a particular genomic region. A dataset may or may not have already undergone some level of QC before using PBAP. Our pipeline performs basic QC checks to ensure detection of errors that may have been missed by other QC procedures. When the dataset has relatively few genotyped individuals, there are advantages to the use of external population allele frequency estimates, and when the number of available markers common across subjects is modest, a more accurate likelihood-based estimator is a safer choice for relationship estimation than is a moment estimator. Pedigree structure validation in PBAP is useful in distinguishing close relationship errors, which is sufficient (in most cases) to detect sample swaps and misspecified relationships. Some caution is needed to interpret flagged relationships since these may or may not indicate a true relationship error. Confirmed relationship errors should be corrected by the user and may entail dropping certain individuals, editing the pedigree and/or genotype files and going back to the beginning of the pipeline. Although optimized for human pedigrees, PBAP may also be used for other organisms as long as there is no selfing involved. The pedigree structures of other organisms may be larger and more complex than in humans but this does not provide a barrier. Except for the pedigree structure validation step, which would require use of other existing software, PBAP may be applied. We have presented a unified comprehensive pipeline that performs critical steps to handle dense genotype data and prepare files for family-based downstream analyses. PBAP selects a good panel of sparse markers and samples IVs. This framework allows the development of additional modules that will carry out a variety of computations given the sampled IVs as illustrated though our computation of lod scores. PBAP thus enables a variety of analyses on large pedigrees with dense markers with the opportunity to extend to other programs for downstream analyses.
