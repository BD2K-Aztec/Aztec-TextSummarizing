Motivation: It is well known that the accuracy of RNA secondary structure prediction from a single sequence is limited, and thus a comparative approach that predicts a common secondary structure from aligned sequences is a better choice if homologous sequences with reliable alignments are available. However, correct secondary structure information is needed to produce reliable alignments of RNA sequences. To tackle this dilemma, we require a fast and accurate aligner that takes structural information into consideration to yield reliable structural alignments, which are suitable for common secondary structure prediction. Results: We develop DAFS, a novel algorithm that simultaneously aligns and folds RNA sequences based on maximizing expected accuracy of a predicted common secondary structure and its alignment. DAFS decomposes the pairwise structural alignment problem into two independent secondary structure prediction problems and one pairwise (non-structural) alignment problem by the dual decomposition technique, and maintains the consistency of a pairwise structural alignment by imposing penalties on inconsistent base pairs and alignment columns that are iteratively updated. Furthermore, we extend DAFS to consider pseudoknots in RNA structural alignments by integrating IPknot for predicting a pseudoknotted structure. The experiments on publicly available datasets showed that DAFS can produce reliable structural alignments from unaligned sequences in terms of accuracy of common secondary structure prediction. Availability: The program of DAFS and the datasets are available at
INTRODUCTIONMany functional RNAs form secondary structures that are related to their functions such as gene regulation and maturation of mRNAs, rRNAs and tRNAs. Therefore, analysis of RNA secondary structures can lead to unraveling their potential functions. Since experimental determination of RNA secondary structures is expensive and time consuming, computational prediction of RNA secondary structures has been frequently used. The most successful methods for predicting RNA secondary structures from a single sequence are based on minimizing free energy, such as Mfold () and RNAfold (). Alternative methods are based on probabilistic frameworks including stochastic context-free grammars that can model RNA secondary structures without pseudoknots (crossing base pairs on primary sequences). Several computational methods based on stochastic context-free grammars have been developed for modeling and analyzing non-coding RNAs (). Nonetheless, the accuracy of RNA secondary structure prediction from a single sequence is known to be limited, and thus, a comparative approach that predicts a common secondary structure from aligned sequences is a better choice if homologous sequences with reliable alignments are available. Comparative methods based on alignment folding include RNAalifold (), Pfold (), PETfold () and CentroidAlifold (). However, we require correct secondary structure information to produce reliable alignments of RNA sequences in turn, which is a 'chicken-and-egg' problem. To tackle this dilemma, Sankoff (1985) has proposed a dynamic programing (DP) algorithm for simultaneously aligning and folding RNA sequences whose computational complexity is OL 3N  time and OL 2N  space for N sequences of length L. Since a navenave implementation of the Sankoff algorithm is impractical because of unrealistic computational complexity, various algorithms have been developed to reduce the computational complexity of the Sankoff algorithm. Several pioneering studies including the first versions of FOLDALIGN () and Dynalign () have implemented restricted Sankoff algorithms; FOLDALIGN disallows bifurcated structures, and Dynalign assumes the maximum distance of aligned nucleotides (note that later versions of both methods do not have such restrictions). Several succeeding methods have reduced the search space of the Sankoff algorithm by *To whom correspondence should be addressed. using precomputed posterior probabilities of base pairs and/or aligned columns (). Sampling-based approaches, instead of reducing the search space, have also been developed (). Zivhave proposed a sparsification technique for the Sankoff algorithm that speeds up computation by a linear factor. Although various techniques for reducing the computation time have been developed, the Sankoff-style algorithms are still computationally expensive. Alternatively, several heuristic-based algorithms that do not strictly perform simultaneous aligning and folding of RNA sequences have been proposed such as sequence alignment with a structural scoring function () and stem-based alignment (). LARA proposed byformulates the problem of RNA structural alignment as a graph theoretical model for sequence alignment with additional simple structure information. Lagrangian relaxation is applied to relax the constraints for the structure information, then the problem is solved as sequence alignment with iterative updates of penalty scores. Note that LARA was not designed to predict common secondary structures since no folding model is explicitly considered. In this article, we present a novel algorithm DAFS that performs Dual decomposition for Aligning and Folding RNA sequences Simultaneously. First, on the basis of the maximizing expected accuracy (MEA) principle, we design an objective function for a pairwise structural alignment as the expectation of the sum of the numbers of correctly predicted base pairs in a common secondary structure and those of correctly aligned columns in its pairwise alignment. Then, to maximize the objective function under several constraints for consistent pairwise structural alignment, we use the dual decomposition technique, which decomposes the pairwise structural alignment problem into two independent secondary structure prediction problems and one pairwise (non-structural) alignment problem. The algorithm maintains the consistency of a pairwise structural alignment by imposing penalties on inconsistent base pairs and alignment columns, and updates them iteratively by performing the Nussinov-style secondary structure prediction and the NeedlemanWunsch-style pairwise alignment with the penalized scoring function. We easily extend the algorithm to perform multiple alignment by applying a standard progressive alignment technique. Furthermore, we integrate the IPknot model () instead of the Nussinov model so that DAFS can simultaneously align and fold RNA sequences with pseudoknots. Major advantages of DAFS are summarized as follows: (i) DAFS is a fast and accurate implementation that simultaneously aligns and folds RNA sequences. Compared with the other Sankoff-style algorithms, DAFS achieves comparable accuracy, and even more importantly, runs much faster. Compared with the heuristic-based approaches such as sequence alignment with structural scores, DAFS is more accurate, especially in terms of common secondary structure prediction; (ii) DAFS is flexible and extensible because of the dual decomposition, which enables us to integrate state-of-the-art folding models such as the IPknot model for pseudoknotted secondary structures.
METHODSWe present a novel method DAFS for simultaneous aligning and folding of RNA sequences by dual decomposition by which an integer programing (IP) problem for this task is solved. DAFS calculates a pairwise structural alignment, that is, a pairwise alignment that considers RNA secondary structures, by the following two steps when two unaligned sequences are given: (i) compute two base-pairing probability matrices and an alignment-matching probability matrix for the two sequences to factorize a probability distribution of structural alignments (Section 2.2,), and (ii) solve the IP problem (Section 2.3) of simultaneously aligning and folding the given sequences by dual decomposition (Section 2.4) to maximize the expected accuracy of the prediction. Then, the pairwise alignment algorithm is extended to compute a multiple alignment by a progressive alignment approach (Section 2.5). Furthermore, we describe an extension of our algorithm to perform RNA structural alignment that can consider pseudoknots (Section 2.6).
PreliminariesLet AE  {A,C,G,U} and AE  denote the set of all finite RNA sequences consisting of bases in AE. For a sequence a  a 1 a 2. .. a n 2 AE  , let jaj denote the number of symbols appearing in a, which is called the length of a. Given two RNA sequences a, b 2 AE  , let Aa, b be a set of all possible alignments of a and b, and Sa be a set of all possible secondary structures of a. An alignment z 2 Aa, b is represented as a jaj  jbj binary-valued matrix z  z ik , where z ik  1 if and only if the base a i is aligned with b k. A secondary structure x 2 Sa is represented as a jaj  jaj binary-valued triangular matrix x  x ij  i5j , where x ij  1 if and only if bases a i and a j form a base pair. Let SAa, b be a set of all possible structural alignments of a and b. We write  x, y, z, which means that a structural alignment 2 SAa, b consists of an alignment z 2 Aa, b, and two secondary structures x 2 Sa and y 2 Sb.
MEA-based scoring functionOne of the most promising techniques to solve discrete high-dimensional problems on sequences such as RNA secondary structure prediction and RNA structural alignment is the MEA-based approach including centroid estimation (). Given unaligned RNA sequences, the goal of RNA structural alignment is to produce a reliable alignment, as well as to predict a reliable common secondary structure. To this end, we define a gain function of a structural alignment ^   ^ x, ^ y, ^ z with regard to the correct structural alignment  x, y, z as the weighted sum of gain functions G s x, ^ x and G s y, ^ y of respective secondary structures and a gain function G a z, ^ z of the alignment as follows:where 40 is a parameter that controls the weight of the secondary structures and the alignment. The gain function G s x, ^ x of the secondary structure ^ x is defined as follows:Gis the number of true negative predictions and 2 0, 1 is a balancing parameter between true positives and true negatives. Here, I(condition) is the indicator function that takes a value of 1 or 0 depending on whether the condition is true or false. The gain function G s x, ^ x can be regarded as a kind of 'accuracy' that represents the weighted sum of the number of true predictions in ^ x, which is correlated to balanced accuracy measures such as Matthews correlation coefficient (MCC) and F-measure. Note that G s x, ^ x is equivalent to the gain function of the-centroid estimator used in CentroidFold () for  1=1  . Similarly, the gain function G a z, ^ z of the alignment ^ z is defined as the number of true predictions in ^ z as follows:G a z, ^ z  1   TP a z, ^ z  TN a z, ^ z where TP a z, ^ z  P i, k Iz ik  1I ^ z ik  1 is the number of true positive predictions and TN a z, ^ z  P i, k Iz ik  0I ^ z ik  0 is the number of true negative predictions. Here, 2 0, 1 is a balancing parameter between true positives and true negatives. In accordance with the MEA principle, we find a structural alignment ^ that maximizes the expectation of the gain function (1) under a given probability distribution over the space SAa, b of structural alignments:where Pja, b is a probability distribution of RNA structural alignments. Unfortunately, computation of Equation (2) requires Ojaj 3 jbj 3  time and Ojaj 2 jbj 2  space even if we assume only pseudoknot-free secondary structures. Therefore, we assume independence of structure and alignment, and factorize the probability distribution of the structural alignments as follows:Pja, b % PxjaPyjbPzja, b  3 where Pxja and Pyjb are probability distributions of RNA secondary structures over Sa and Sb, respectively, and Pzja, b is a probability distribution of alignments over Aa, b (). We can then approximate the expected gain function (2) by the following:are base-pairing posterior probability distributions,Pzja, bIz ik  1 is an alignment-matching posterior probability distribution and C is a constant independent of ^   ^ x, ^ y, ^ z (see Section S1 in Supplementary Material for the derivation). If we assume pseudoknot-free structures for a and b, calculation of the
IP formulationOur objective is to find an RNA structural alignment that maximizes the approximate expected gain (4), satisfying the consistency of the RNA structural alignment. This optimization problem can be formulated as the following IP problem that maximizes:where w ijkl is a binary-valued variable such that w ijkl  1 if and only if a base pair a i , a j  is aligned with a base pair b k , b l . The constraint (6) means that each base a i can be paired with at most one base (), and the constraint (7) allows no pseudoknots in the secondary structure x 2 Sa (). Similarly, the constraints (8) and(9) maintain the consistency of the secondary structure y 2 Sb. The constraints (10)and(11) state that each base in a and b can be aligned with at most one base (and d), and the constraint (12) allows no crossing match in the alignment z 2 Aa, b (). The constraints (13)(15) represent agreement between x, y and z that must be satisfied by the common secondary structure  x, y, z 2 SAa, b. If we can drop the constraints (13)(15), each component x, y and z of the structural alignment can be solved separately and efficiently. This means that the constraints (13)(15) make the problem of RNA structural alignment extremely complex. Consider the condition for w ijkl  1. Because of the constraints (13)(15), w ijkl  1 implies x ij  y kl  z ik  z jl  1. Therefore, to maximize the objective function (5), the contribution of w ijkl  1 should be positive:Therefore, it is no longer necessary to consider w ijkl that does not satisfy the conditions (16) and (17). We call this the threshold cut technique, which accelerates our algorithm as we will describe in the next section.
Dual decompositionRecall that the main difficulty of solving the IP problem of RNA structural alignment arises from the constraints (13)(15). To circumvent this difficulty, we deal with these constraints using Lagrangian relaxation (). First, we define the Lagrangian dual by moving the constraints (13)(15) to the objective function (5):where  f ij ji5jg,  f kl jk5lg and  f ik j ik ! 0g are Lagrangian multipliers. We can then rewrite Equarion (18) as:meaning that we can calculate each term of Equation (19) independently and efficiently by using the DP techniques: the Nussinov-style algorithm () for the first and second terms and the Needleman Wunsch-style algorithm () for the third term; and by simply finding positive coefficients for the last term. This technique is called dual decomposition (). Since the dual objective function L, ,  gives an upper bound of the primal objective function (5), we aim to minimize Equation (19) with respect to the multipliers to obtain a better upper bound. The Lagrangian function L, ,  is convex, but not differentiable (). Thus, to minimize the dual objective function (19), we can apply the subgradient optimization in which the Lagrangian multipliers ij , kl and ik are iteratively updated by using their subgradients P k5l w ijkl  x ij , P i5j w ijkl  y kl and z ik  P j5i, l5k w jilk  P j4i, l4k w ijkl , respectively. As a result, we can obtain an algorithm similar to the gradient descent as shown in, where t 40 is a step size at each update. It has been proven that if lim t!1 t  0 and P 1 t1 t  1, the Lagrangian dual L, ,  always converges to the optimal value. The update is iterated until the solution is found or the number of iterations reaches the predefined maximum number of iterations T, which is sufficiently large. The Lagrange multipliers can be regarded as penalty scores against inconsistency between alignments and secondary structures for the constraints (13)(15). The computational complexity of the algorithm inis dominated by that of the subproblems and the number of w ijkl , which is at most jajjbjjaj  jbj=2 by using the threshold cut technique described in Section 2.3. If we approximate jaj % L and jbj % L, the time and space complexities of the algorithm are OTL 3 = and OL 3 =, respectively. See Section S2 in Supplementary Material for details.
Extension to multiple alignmentWe can easily extend pairwise alignment described in Section 2.4 to multiple alignment by the progressive approach (with the average base-pairing probability matrix and the average alignment-matching probability matrix. Let A and B be two alignments of RNA sequences. We define the average base-pairing probabilities p A ij to be the average of p a ij over all sequences a 2 A, remapped to the coordinates of the alignment A. Similarly, we define the average alignment-matching probabilities p A, B ik to be the average of p a, b ik over all pairs of sequences a 2 A and b 2 B, remapped to the coordinates of the alignments A and B. We can predict the optimal structural alignment of two alignments A and B by the dual decomposition algorithm (Given a set of unaligned sequences, we first build a guide tree by clustering the sequences with a UPGMA using the expected accuracy similarity measure (). We then perform progressive alignment by aligning alignments of the sequences according to the guide tree.
Extension to structural alignment with pseudoknotsAs described in Section 2.4, our algorithm decomposes the master problem of RNA structural alignment into the three slave problems: two secondary structure prediction problems and one pairwise (non-structural) alignment problem, each of which can be solved independently. This allows us to easily take pseudoknots into account by replacing the Nussinov-style DP algorithm with the IPknot model (Sato et al.,. The algorithm for predicting RNA structural alignments using DD. T is the maximum number of iterationsFig. 2. An illustration of the constraints of the IP formulation. The diagrams (a) and(b) correspond to the constraints (6) and (7), respectively. Note that at most one variable shown by a broken curved line can take a value 1. The diagrams (c), (d) and (e) correspond to the constraints (10),(12), respectively 2011) for predicting secondary structures with pseudoknots. To the authors' knowledge, this is the first implementation that can simultaneously align and fold RNA sequences considering pseudoknotted secondary structures, except for SimulFold () and RNASampler (), which are based on a sampling algorithm. See Section S3 in Supplementary Material for details.
RESULTS
ImplementationOur algorithm was implemented as a program called DAFS. To calculate base-pairing probabilities, we used the McCaskill model () in the Vienna RNA package (), using the free energy parameters estimated by the Boltzmann likelihood-based method (). To calculate alignment-matching probabilities, we used the ProbCons model (). We implemented DAFS with two decoding algorithms for Lines 4 and 5 in: the Nussinov decoding and the IPknot decoding. DAFS with the IPknot decoding can handle pseudoknotted secondary structures, whereas DAFS with the Nussinov decoding cannot. Part of the IPknot decoding in DAFS was implemented using the CPLEX IP solver (http://www-01.ibm.com/software/integration/optimization/cplex-optimizer/). In this study, we used empirically determined parameters:  4:0,  0:2,  0:01 and T  600.
DatasetsFor the benchmark, we created new datasets from Rfam 11.0 (). Only manually curated seed alignments with consensus structures published in literature were used. We produced 691 pseudoknot-free alignments (PKfree dataset) and 82 pseudoknotted alignments (PK dataset). Each alignment contains 10 sequences from the Rfam families. Furthermore, to avoid selective bias in evaluation, we also used four datasets of RNA sequences that have been established in previous studies (). See Section S4 in Supplementary Material for more details.
Evaluation metricsWe evaluated the accuracy of predicted structural alignments through two measures for alignments and three measures for common secondary structures. To evaluate produced alignments, the following measures were used: (i) sum-of-pairs score (SPS) (), which is defined as the proportion of correctly aligned matches in the predicted alignment, and (ii) structure conservation index (SCI) (), which is defined as SCI  E A = " E, where E A is the consensus minimum free energy computed by RNAalifold () and " E is the average minimum free energy over all RNA sequences in the predicted alignment. These measures can be calculated directly from produced alignments. To evaluate predicted common secondary structures, we first mapped a predicted (reference, respectively) common secondary structure to each sequence according to the predicted (reference) alignment. Then, the predicted secondary structure mapped to each sequence was evaluated by the following three measures:(iii) sensitivity (SEN), which is defined as the proportion of correctly predicted base pairs in the reference secondary structure, i.e. SEN  TP=TP  FN, (iv) positive predictive value (PPV), which is defined as the proportion of the correctly predicted base pairs in the predicted secondary structure, i.e. PPV  TP=TP  FP, and (v) MCC, which is defined as:where TP is the number of base pairs appearing in both the reference and predicted structures, FP is the number of base pairs that appear in the predicted structure but not in the reference, TN is the number of base pairs that appear in neither structure and FN is the number of base pairs that appear in the reference but not in the predicted structure. Note that there exists a trade-off between SEN and PPV, and MCC is a balanced evaluation measure between them.
Effectiveness of dual decompositionWe first validated on the Murlet dataset () that our algorithm can yield the optimal solution or a good approximation close to the optimal solution.shows the average number of constraints that are not satisfied at the maximum number of the iteration, T in, ranging from 1 to 1000, indicating that satisfiable solutions can be achieved at T ! 600.and c show elapsed time to process all the sequences in the dataset and accuracy, including SPS, SCI and MCC, at the maximum number of the iteration, respectively, comparing the results of the dual decomposition with the counterparts achieved by the CPLEX IP solver. These results clearly indicate that SPS, SCI and MCC sufficiently converged to the optimal at T ! 600 even though the dual decomposition with T  600 performed extremely faster than CPLEX. Therefore, we set T  600 in subsequent experiments.
Structural alignments without pseudoknotsWe conducted several computational experiments of predicting RNA structural alignments on the PKfree dataset, comparing DAFS with the following state-of-art aligners for structural alignment: (i) CentroidAlign version 1.00 (), (ii) RAF version 1.0 (), (iii) LARA version 1.3.2a (), and (iv) LocARNA version 1.6.1 (). RAF and LocARNA, as well as DAFS, perform simultaneous aligning and folding of RNA sequences. CentroidAlign and LARA perform sequence alignment with structural scores. We also used the following standard alignment tool that does not consider any secondary structure as baselines in the comparison: (v) ProbConsRNA version 1.1 ().and Supplementary Tables S2S6 in Supplementary Material show the results on the datasets that do not contain pseudoknotted reference structures. These results indicate that DAFS achieved high accuracy in the measures for common secondary structures, especially in MCC that is a balanced measure between SEN and PPV, and is much faster than RAF, one of the most accurate competitors, although the accuracy of DAFS in the measures for alignments is not remarkable. Since accurate prediction of RNA secondary structures is crucial for unraveling potential functions of non-coding RNAs as mentioned in Section 1, fast and accurate structural alignments of DAFS shown in the results are preferable.
Structural alignments with pseudoknotsWe conducted the experiment of predicting RNA structural alignments with pseudoknots on the PK dataset that contains pseudoknots in the reference structures, comparing DAFS with RNASampler version 1.3 () with the option of '-X 1' that allows us to consider simple pseudoknots. Note that there is no existing practical structural aligner that can consider pseudoknots, except for RNASampler. Since RNASampler cannot recover common secondary structures with pseudoknots, we used IPknot with default parameters to predict common secondary structures from produced alignments.clearly shows the advantage of DAFS with the IPknot decoding that can simultaneously align and fold RNA sequences with pseudoknots. Furthermore, the comparison between the Nussinov decoding and the IPknot decoding indicates that IPknot is successfully integrated into DAFS, meaning that DAFS is flexible and extensible because of the dual decomposition.
DISCUSSIONWe developed a fast and accurate RNA structural aligner called DAFS that simultaneously aligns and folds RNA sequences by dual decomposition. Specifically, our method decomposes the RNA structural alignment problem into three subproblems, then respective problems are solved by simple and efficient algorithms such as the Nussinov-style DP and the Needleman Wunsch-style DP. This means that DAFS can explicitly take the folding model into account, whereas LARA that has also used Lagrangian relaxation cannot. In fact, we showed that the dual decomposition technique enables us to integrate state-of-the-art folding models such as the IPknot model for pseudoknotted structures. This flexibility to adapt the folding models to our algorithm would lead us to further improvement by using an extended secondary structure model such as RNAwolf (zu), where base-pairing probabilities for extended secondary structures are used. One of the other differences between DAFS and LARA is the scoring system in the objective function. The scoring system of DAFS is based on the MEA principle, which has been successfully applied to various problems in bioinformatics (,TIME means the total computation time in seconds measured on a Linux workstation with Intel Xeon E5450 (3.0 GHz). The bold values indicate the best score in each evaluation measure. For all the methods except DAFS, SEN, PPV and MCC, are calculated using common secondary structures predicted by CentroidAlifold with default parameters from produced alignments. See Section S4 in Supplementary Material for the results using RNAalifold and intrinsic predictions.). The MEA-based scoring function not only improves accuracy in prediction but also makes DAFS run fast by the threshold cut technique, which is derived from the IP formulation based on the MEA-based scoring function described in Section 2.3. The threshold cut technique has also been applied to RactIP () and IPknot (), and has contributed to their accuracy and efficiency. Prediction accuracy of DAFS depends mainly on its scoring functions even though the method uses the approximate probability distribution for RNA structural alignments that assumes independence of alignment and structure. In fact, experimental results shown in Section S5 in Supplementary Material revealed that when we adopted the exact posterior probabilities for RNA structural alignments, a significant improvement was confirmed, though much computation time was spent on the predictions. Considering these results, there is room for further investigation into refinement of the scoring functions that make prediction accuracy compatible with practical running time.
The Author 2012. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
K.Sato et al. at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
