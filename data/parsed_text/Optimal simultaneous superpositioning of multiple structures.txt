Motivation: Superpositioning is an essential technique in structural biology that facilitates the comparison and analysis of conformational differences among topologically similar structures. Performing a superposition requires a one-to-one correspondence, or alignment, of the point sets in the different structures. However, in practice, some points are usually 'missing' from several structures, for example, when the alignment contains gaps. Current superposition methods deal with missing data simply by superpositioning a subset of points that are shared among all the structures. This practice is inefficient, as it ignores important data, and it fails to satisfy the common least-squares criterion. In the extreme, disregarding missing positions prohibits the calculation of a superposition altogether. Results: Here, we present a general solution for determining an optimal superposition when some of the data are missing. We use the expectationâ€“maximization algorithm, a classic statistical technique for dealing with incomplete data, to find both maximum-likelihood solutions and the optimal least-squares solution as a special case. Availability and implementation: The methods presented here are implemented in THESEUS 2.0, a program for superpositioning macromolecular structures. ANSI C source code and selected compiled binaries for various computing platforms are freely available under the GNU open source license from http://www.theseus3d.org.
INTRODUCTIONHow should we properly compare and contrast the 3D conformations of similar structures? This fundamental problem in structural biology is commonly addressed by performing a superposition, which removes arbitrary differences in translation and rotation so that a set of structures is oriented in a common reference frame (). For instance, the conventional solution to the superpositioning problem uses the least-squares optimality criterion, which orients the structures in space so as to minimize the sum of the squared distances between all corresponding points in the different structures. Superpositioning problems, also known as Procrustes problems, arise frequently in many scientific fields, including anthropology, archaeology, astronomy, computer * To whom correspondence should be addressed. vision, economics, evolutionary biology, geology, image analysis, medicine, morphometrics, paleontology, psychology and molecular biology (). A particular case we consider here is the superpositioning of multiple 3D macromolecular coordinate sets, where the points to be superpositioned correspond to atoms. Although our analysis specifically concerns the conformations of macromolecules, the methods developed herein are generally applicable to any entity that can be represented as a set of Cartesian points in a multidimensional space, whether the particular structures under study are proteins, skulls, MRI scans or geological strata. We draw an important distinction here between a structural 'alignment' and a 'superposition.' An alignment is a discrete mapping between the residues of two or more structures. One of the most common ways to represent an alignment is using the familiar row and column matrix format of sequence alignments using the single letter abbreviations for residues (). An alignment may be based on sequence information or on structural information (or on both). A superposition, on the other hand, is a particular orientation of structures in 3D space. Calculating an optimal superposition normally requires a one-toone correspondence (a bijection) between the atoms in the different structures (). For instance, a sequence alignment is necessary to superposition protein molecules. In many real cases, however, certain residues (and their atoms) are 'missing' in some of the structures. As a case in point, one crystal structure of a protein may omit loop regions that are present in another crystal structure of the same protein.shows a sequence alignment of four protein structures that we wish to superposition. In this example, the protein sequences are identical except that several residues are missing from some structures; only about half of the atoms to be superpositioned are shared among all four proteins (indicated by blue asterisks). An analogous situation exists when we wish to superposition a set of homologous proteins, which in general will have different sequences, various lengths, and gaps and insertions in the alignment (). In both cases, particular columns in the alignment will have gaps, and immediately the question emerges of how to properly incorporate these positions into a global superposition. Current multiple superposition methods explicitly require complete data (), and hence current superposition implementations deal with missing data crudely, usually by excluding many atoms from the calculation (;proteins, each of known structure, from seven different species. The gaps can be considered as 'missing data' in a likelihood framework. As in, the subset of residues completely shared among all four proteins is indicated by asterisks(a) A sequence alignment of four identical proteins, except that different residues are missing in each of the proteins. This could, for instance, correspond to the case of superpositioning different crystal structures where different regions of the protein are disordered in different crystal forms. The subset of residues completely shared among all four proteins is indicated by asterisks. (b) A second alignment of the same four proteins with different missing data. (c) A third alignment of the same four proteins with no 'common core,' in which no residues are completely shared among all four proteins). For the proteins inand 2, standard practice would calculate the superposition based on only the small subset of fully shared residues, often referred to as the 'common core' (indicated above the alignment by blue asterisks). This method, which corresponds to superpositioning based only on columns in the alignment that contain no gaps, is therefore inefficient as it disregards much of the observed data. Atoms that are not shared among all structures are nevertheless informative, and ideally they should be considered in calculating an optimal superposition. In the most extreme case, no residues are completely shared among the macromolecules (). Here, the practice of disregarding positions with missing data prohibits the calculation of a superposition altogether, because there is no common core and consequently nothing to include in the calculation. Ignoring some atoms in the superposition also clearly fails to satisfy the least-squares criterion, where the object is to minimize the sum of squared distances among all corresponding atoms, not just among a subset of the atoms. Despite the popularity of ordinary least squares as an optimality criterion for determining the best superposition, other criteria are better justified both theoretically and empirically (). According to the GaussMarkov theorem, two basic assumptions must be met to justify the use of least squares. In terms of a superposition, these two assumptions require that all atoms have the same variance and that none of the atoms are spatially correlated. Both of these assumptions are strongly violated with biological macromolecules, as certain regions of a structure are more variable than others (due to a combination of experimental imprecision, dynamics and conformational heterogeneity) and because atoms physically communicate with each other (e.g. via electrostatic, Van der Waals and covalent interactions). We previously presented a maximum-likelihood superposition method that addresses these problems with the least-squares criterion by explicitly allowing individual atoms to be correlated and to have different variances (). As is often true with Gaussian distributed data, the conventional leastsquares superposition solution falls out as a special case of the likelihood analysis (namely, when assuming uncorrelated data with equal variances). Most importantly for the present work, likelihoodbased methods can elegantly handle cases of missing data via the expectationmaximization (EM) algorithm (). Here, we present solutions for finding the optimal superposition with incomplete structural data. We use the EM algorithm, a classic statistical technique for dealing with missing data, to find maximum-likelihood solutions, which include the conventional least-squares solution as a special case. For completeness, we present two different classes of solutions, listed in decreasing order of generality, complexity and computational requirements:
Superpositioning with missing data(i) the 'non-isotropic' solution, which allows for heterogeneous atomic variances but assumes that there are no correlations; and (ii) the 'isotropic' solution, which corresponds to the least-squares solution and assumes that all atomic variances are equivalent and no atoms are correlated. This manner of presentation should allow for the straightforward modification of existing least-squares superpositioning routines to handle missing data.
APPROACH
A Gaussian statistical model for the superposition problemTo analyze the superposition problem within a likelihood-based framework and to use the EM algorithm, one must choose a statistical model for the observed data. We assume a perturbation model in which each structure is distributed according to a Gaussian (or Normal) probability density (;). The EM algorithm is frequently used in likelihood analyses to determine maximum-likelihood estimates of parameters of a model when some data are missing (). The EM method involves cycling between two steps: (i) the'E-step' in which the expected likelihood function is calculated, conditional on the observed data and the current estimates of the model parameters; and (ii) the 'M-step' in which the expected likelihood function is maximized over an unknown parameter.
D.L.Theobald and P.A.Steindel
METHODS
Representation of structures with missing atomsConsider the case of superpositioning r different structures (X i , i = 1,...,r), each with a total of k corresponding atoms. We represent each structure as a k 3 matrix of k rows of atoms, where each atom is a 3-vector. Some of the atoms in each structure may be missing (or unobserved). For each structure X i , there are m i missing atoms and a complementary number of n i observed atoms, so that m i +n i = k. To represent structures with missing points, we imagine that the complete data are given in the matrix X i. A portion of this data is missing or unobserved. The complete data matrix can then be represented as the sum of the observed data and the unobserved data:where  i X i is the observed data and  i X i is the unobserved, missing data. The complementary indicator matrices  i and  i are square, symmetric, diagonal, k k matrices. The 'observed' indicator matrix,  i , contains a one on the diagonal if the corresponding atom in the structure X i is observed (i.e. not missing) and zeros otherwise. For example, the following three 'observed'  indicator matrices correspond to the three small protein fragments in the alignment in:1 0 0 0 0 0 0 0 0 0 0 0Conversely, the 'unobserved' indicator matrix,  i , contains a 1 on the diagonal if the corresponding atom in the structure X i is missing, and 0s otherwise. Both indicator matrices, though redundant, are useful for simplifying the presentation of the solutions. If no data are missing for structure X i then  i equals the identity matrix and  i = 0, the square matrix of zeros. The following useful properties hold for the indicator matrices:where I k is the k k identity matrix and trA is the trace of matrix A (i.e. the sum of the diagonal elements of A).
The Gaussian perturbation modelIn our probabilistic model, each structure X i is considered to be a randomly rotated and translated Gaussian perturbation of a mean structure M:shows the reference superposition using all of the data; this can be thought of as the 'true' superposition before regions of the structures were deleted. For ease of comparison, in these images, the missing residues are not displayed, even though all of the original data were included in the superposition calculation. The right-most column,shows conventional superpositions based on only the subset of fully shared residues. The structures used in these superpositions were derived from four NMR models of a zinc finger domain, PDB ID 1zfd where t i is a 31 translational row vector, 1 k denotes the k 1 column vector of ones and R i is a proper, orthogonal 33 rotation matrix. The k 3 matrix E i is a matrix of Gaussian random errors with mean 0, being a random variate from a matrix Gaussian distribution i.. Here, is a k k covariance matrix for the atoms, which describes the variance of each atom and the covariances among the atoms. For simplicity, we assume that the variance about each atom is spatially spherical. Extensions to higher (and lower) dimensions are trivial (e.g. 4D data would be represented by a k 4 matrix and use 44 rotation matrices and 41 translation vectors). For the non-isotropic solution, the covariance matrix is diagonal, with all offdiagonal, covariance elements constrained to 0. For the isotropic solution, which corresponds to least squares, the covariance matrix is constrained to be diagonal and to have identical diagonal elements (i.e. =  2 I).
The superposition likelihood functionThe full joint PDF for our likelihood superposition problem is thus obtained from a multivariate matrix normal distribution () corresponding to the perturbation model described by equationwhere
Superpositioning with missing dataandWith the likelihood function in hand, the ML estimate of a parameter can be derived straightforwardly by taking the derivative of the log-likelihood with respect to the parameter (producing the 'score function'), setting the derivative to zero, and solving for the parameter. Note that columns of the alignment that contain all gaps except for one lone sequence have no influence on the likelihood and should be excluded from the maximization calculations. For the E-step of the EM algorithm, one first finds the expected log likelihood, where the expectation is over the missing data conditional on the observed data and current estimates of the other parameters. In practice, these conditional expectations can be cast in terms of the current parameter estimates, and hence the expectations can be combined with other terms in the log likelihood containing those parameters. For the M-step, the expected log likelihood is maximized over a given parameter by taking the derivative as explained above. In the following sections, the conditional ML estimates are provided for both the complete data and missing data cases. Detailed derivations are provided in the Supplementary Material.
The translationsML estimates of the translation parameters are given below.
Complete data solutionWher t i is the estimate of the translation:
Missing data solutiontFor the remaining solutions, it will be convenient to define a centred structure:
The rotationsThe optimal rotations are calculated using a singular value decomposition (SVD). Let the SVD of an arbitrary matrix A be UV. The ML rotationsR rotations rotationsR i are estimated byR by byR i = VPUwhere rotoinversions can be avoided by constraining the determinant ofRof ofR i to be 1 by using P = I if |V||U| = 1 or P = diag(1,...,1,1) if |V||U| =1.
Complete data solutionIn the non-isotropic case, the U and V matrices are determined from the SVD as follows:and in the isotropic case, fromMX from fromMfromM fromMX i = UV (17)
Missing data solution For the non-isotropic caseand for the isotropic caseCopyedited by: CK MANUSCRIPT CATEGORY: ORIGINAL PAPER
D.L.Theobald and P.A.Steindel
The mean structure
Complete data solutionThe mean structure is estimated as the arithmetic average of the optimally translated and rotated structuresM
Missing data solutionMBoth of these solutions are independent of the covariance matrix.
Covariance matrix and superposition varianceThe following equations for the covariance matrix estimates are only valid when the translations are known (). In general, this is not the case, and thus a constrained (regularized) estimator of the covariance matrix is necessary. For instance, the estimates given below may be modified to give a hierarchical estimator as shown in equation (6) of () or equation (10) of (). The estimators of the isotropic variance are already adequately constrained and do not need to be adjusted. To simplify the following formulae, we first define the matrix D i :
Complete data solutionThe unconstrained estimate of the diagonal, non-isotropic covariance matrix isUwhere I k is the k k identity matrix and '' is the Hadamard operator for elementwise matrix multiplication. The Hadamard operation simply sets all offdiagonal elements of the covariance matrix to 0. For a least-squares analysis, which is equivalent to assuming that =  2 I, the ML estimate of the variance isNote that in equation (24), one needs to only calculate the diagonal elements.
Missing data solutionThe ML estimate of the non-isotropic, diagonal covariance matrix isUThe estimate of the isotropic covariance matrixIn both isotropic cases, calculation of the isotropic variance  2 can often be omitted, as it is not needed to estimate any of the other parameters. The summation terms may be calculated easily by noting that
ALGORITHMThe simultaneous solution of the optimal parameters must be solved numerically, as each of the unknown parameters is a function of some of the others. Our iterative algorithm is an extension of similar algorithms proposed previously, and it is based on nested rounds of EM cycles and conditional maximization (; Theobald and Wuttke, 2006a, b). As with all superposition algorithms, this algorithm requires a priori knowledge of the alignment (the one-to-one correspondence among atoms/points in the structures):(1) Initialize: Set=Set Set= I for all i. Estimate the mean structur M by embedding the average of the distance matrices, including gaps, for each structure (). Rather than embedding, one may simply choose one of the structures (preferably with the fewest gaps) to serve as the mean for the first iteration, setting missing coordinates to zeros (convergence may be hindered in cases with a large fraction of gaps).(2) Translate: Translate (i.e. centre) each X i. For the first iteration, the  i MR i term can be omitted from equations (12)(13).(3) Rotate: Calculate each rotationRrotation rotationR i and rotate each translated structure:(For each residue in the structures, the -carbon standard deviation is plotted. The reference superposition ('complete data') is plotted as the green line, a superposition using the conventional algorithm (based on only the subset of fully shared residues) is plotted as the blue line, and the superposition from our EM algorithm, which includes all data, is plotted as the red line. The reference data (green line) is in fact the same in all three panes; it is re-plotted in each for convenience.
Superpositioning with missing data
RESULTS AND DISCUSSIONTo demonstrate the advantages of the method, we constructed three test sets of structures based on four NMR models of a zinc finger domain protein. In each of the three test sets, different portions of the the four structures were removed. In the first test set, the C-terminal helix of the zinc finger is the only region fully shared among all four partial structures (indicated by asterisks above the alignment columns in). In the second test set, the N-terminal -sheet is the only region fully shared (). For the third test set, no regions of the protein are fully shared among all four structuresin this set, there is no 'common core' (), and hence this test set is impossible to superposition using conventional algorithms. The four original, unmodified zinc finger structures were superpositioned with THESEUS (using both the conventional least-squares criterion and non-isotropic maximum likelihood) to provide a 'complete data' superposition. For comparison, the modified structures (with various portions deleted) were then superpositioned using the EM algorithm and using the traditional method which omits columns with gaps. The superpositions with the modified structures can then be compared with the 'complete data' superposition, which serves as a reference. The EM method produces a least-squares superposition much closer to the 'true' complete data superposition than the conventional method (). The EM superposition is also largely independent of which portions were fully aligned. The EM variances are much lower for the entire structure than the conventional method variances, and they are generally much closer to the 'true'variances (). Results for the non-isotropic ML superpositions are similar to those of the
D.L.Theobald and P.A.SteindelLS superpositions (Figs. 5 and 8). The EM method can easily handle the 'impossible' situation seen in, with results similar to the true superposition (Figs. 6, 7c and 8c). Because the conventional superpositions ignore regions of the structure that have missing data, they are biased to closely superposition only the regions that are fully shared. For instance, in Figures 4c and 5c, the superposition is biased to closely orient the -helix at the expense of the -sheet, as the -helix is the only region of the protein fully shared among the three structures. Similarly, the conventional superposition is biased toward the -sheet in panels 4f and 5f, since the -sheet is the only region of the protein fully shared among this set of structures. Our test sets represent somewhat extreme cases, and we expect the effect of accounting for missing data in real proteins to be more subtle. In practice, the effect of missing data will vary from case to case, depending on which regions are missing and on the patterns of structural variability in the proteins. We have found, however, that in many cases, properly handling missing data is an important concernwith significant effects on the superposition. One salient example is given in, which shows the effects of accounting for missing data in the superpositions of the NMR structure families of two different scorpion toxins. Using both ML and LS superposition methods, significant differences are seen when the missing data are accounted for properly. In all cases, our EM method results in a closer superposition for the unaligned regions (shown in cyan) that would conventionally be excluded from the analysis. The fully aligned regions (shown in dark blue) also exhibit changes in relative conformation, as seen clearly in the per residue RMSD plots.
CONCLUSIONWe have developed a method for superpositioning multiple structures when some of the structures have residues that other structures lack. Our algorithm uses the EM algorithm to find the optimal superposition by treating the gaps in an alignment as 'missing data.' To our knowledge, this is the first superposition solution proposed for cases with incomplete or missing structural information. The use of indicator matrices allows our EM method to be incorporated easily in conventional LS superpositioning procedures. Programs need only be modified to keep track of these matrices and to adjust the calculations accordingly. Hence, our method should be widely applicable to the diverse superposition problems found throughout molecular biology.
at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
IMPLEMENTATION The algorithm described above for calculating optimal superpositions with missing data is implemented in the command-line UNIX program THESEUS (Theobald and Wuttke, 2006a, b). THESEUS functions in two modes: (i) one mode for superpositioning structures with identical sequences [such as different (NMR) models] and (ii) an 'alignment mode,' which superpositions structures with different sequences (i.e. with missing data) conditional on a known alignment. THESEUS does not attempt to determine structure-based sequence alignments, which is a distinct bioinformatics problem (Bourne and Weissig, 2003). When superpositioning homologous proteins with different sequences or identical proteins with missing portions, a sequence alignment must be provided to THESEUS. We provide a wrapper script, theseus_align, to perform this latter procedure transparently for the user. The theseus_align wrapper script will automatically extract the proper sequences from the Protein Data Bank (PDB) files, align them with a sequence alignment program of the users choice and superposition the structures based on this alignment with THESEUS. THESEUS will superposition any number of structures within the limits set by the operating system and memory capability. Via command line options, users can choose to superposition assuming an isotropic covariance matrix (i.e. the conventional LS (least squares)-method) or using the non-isotropic model. Specified alignment columns can also be excluded from the calculation. On modern personal desktop computers, convergence is usually very fast (within seconds for even very large problems). 1976 at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
