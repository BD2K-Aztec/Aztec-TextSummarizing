Motivation: DNA sequencing of multiple samples from the same tumor provides data to analyze the process of clonal evolution in the population of cells that give rise to a tumor. Results: We formalize the problem of reconstructing the clonal evolution of a tumor using single-nucleotide mutations as the variant allele frequency (VAF) factorization problem. We derive a combinatorial characterization of the solutions to this problem and show that the problem is NP-complete. We derive an integer linear programming solution to the VAF factorization problem in the case of error-free data and extend this solution to real data with a probabilistic model for errors. The resulting AncesTree algorithm is better able to identify ancestral relationships between individual mutations than existing approaches, particularly in ultra-deep sequencing data when high read counts for mutations yield high confidence VAFs.
IntroductionCancer is a disease resulting from somatic mutations that accumulate during an individual's lifetime and lead to uncontrolled growth of a collection of cells into a tumor. The clonal theory of cancer () predicts that all cells within a tumor have descended from a single founder cell and that subsequent clonal expansions occur from additional advantageous mutations. As a result, the cells within a tumor may differ in their complement of somatic mutations, with each cell being a descendant of a clone from a clonal expansion (). High-coverage sequencing of tumor genomes allows one to study this intra-tumor heterogeneity by measuring the frequencies of mutations within a tumor (). Characterization of intra-tumor heterogeneity and inference of the clonal evolutionary history of somatic mutations within a tumor provide useful insight in the tumor's development and may help inform treatment. Somatic mutations are typically measured in human solid tumors only at a single time point, when the patient undergoes surgery. Therefore, clonal evolution is not directly observed and one is faced with the problem of inferring the ancestral relationships between cells in a tumor from measurements at one time point. This is the problem of phylogenetic tree reconstruction, a well-studied problem. The direct application of phylogenetic methods requires that we measure mutations in individual cancer cells that correspond to the leaves (species) of the phylogenetic tree. However, because of technical limitations and financial considerations, single-cell sequencing of tumors remains uncommon () with nearly all cancer sequencing studiesincluding studies such as TCGA and ICGCsequencing a small number of samples from a bulk tumor, each containing potentially millions of cells. Thus, the data one obtains represent the mutations in a mixture of cells with potentially distinct evolutionary histories. Given sequencing data from a single sample, a number of methods have been developed to determine the set of clones and their frequencies in a tumor. Some methods analyze changes in the variant allele frequencies (VAFs) of single-nucleotide mutations; i.e. the fraction of tumor cells that contain each mutation (). Other approaches analyze differences in read depth due
i62This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (http://creativecommons.org/licenses/by-nc/4.0/), which permits non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited. For commercial re-use, please contact journals.permissions@oup.com, i62i70 doi: 10.1093/bioinformatics/btv261 ISMB/ECCB 2015 to copy number aberrations (). More detailed inference of clonal evolution from a single sample requires additional assumptions about the evolutionary process, such as parsimony (). Recently, several studies have sequenced multiple samples from the same tumor. These studies measure somatic mutations in multiple spatially distinct regions from the same tumor at a single time point () or measure a tumor at multiple time points (). Multi-sample data allow for the direct observation of branched evolution when mutations are present in only a subset of the sequenced samples. Although standard phylogenetic techniques have been used to construct trees that relate these samples, such trees do not directly show the relationships between mutations, as each sequenced sample may itself be a heterogeneous mixture of cells (). Several methods have recently been introduced to infer tumor composition and evolution from VAFs of somatic mutations in multi-sample sequencing data. Clomial () infers the set of clones present in the tumor and their frequencies in each sample but does not describe the evolutionary relationships between the clones. Three recent approaches infer a tree describing the evolutionary history of a tumor. PhyloSub uses a Bayesian approach to sample trees using a tree-structured process (). CITUP () enumerates all rooted trees and for each one solves a quadratic program. LICHeE, which recently appeared on the arXiv preprint server (), uses a graph construction similar to one we describe below but does not provide a rigorous mathematical justification for it. All these approaches are data driven and focus on the construction and optimization of models that minimize the error between the observed and inferred mutation frequencies. However, they do not address the combinatorial structure of the problem. Stated more directly: given error-free VAF data, under what conditions is it possible to reconstruct the clonal evolution of a tumor? We formalize the problem of reconstructing the clonal evolution of a tumor as the VAF factorization problem (VAFFP). The input to this problem are the VAFs for individual somatic mutations from one or more samples. The problem is to determine the composition of each sample, including the number and proportion of clones in each, and a tree that describes the ancestral relationships between all clones under the infinite sites (perfect phylogeny) assumption.We prove necessary and sufficient conditions for the VAFFP to have a solution in the case of error-free data. Using these conditions, we provide a combinatorial characterization of the space of all solutions. We show that the VAFFP is NP-complete and give an integer linear programming formulation. We extend the characterization and formulation to noisy data and use a graph clustering approach to cluster mutations by their putative ancestral relationships. We show that our resulting AncesTree algorithm is better able to identify ancestral relationships between individual mutations than existing approaches on simulated data. On real data, we highlight the advantages of our probabilistic model by comparing whole-exome and deep sequencing data from the same tumor, identifying successive clonal expansions and diverse mixing of clones within sequenced samples.
Methods
Model for clonal evolution and inferenceIn this section, we describe a model for the accumulation of singlenucleotide somatic mutations in a tumor and the generation of sequencing data from the tumor. This leads us to the definition of the VAFFP at the conclusion of the section. Following the clonal theory of cancer, we assume that all cancer cells in a tumor are descendants of a single founding clone; i.e. the tumor is monoclonal. In this work, we model only somatic singlenucleotide mutations and assume that these are unaffected by copy number aberrations or rearrangements in the cancer genome. We will use mutation to refer specifically to these events. We assume, as in previous work (), that mutations satisfy the infinite sites assumption, which states that a mutation occurs at a single genomic position, or locus, at most once during the clonal evolution of the tumor. We encode the state of a specific locus in a clone as a binary valuewhere 1 indicates a somatic mutation at that position and 0 indicates no mutation. Thus, each clone corresponds to a binary vector in f0; 1g n , where n is the total number of loci affected by mutations. Under these assumptions, the ancestral relationships between clones are described by a phylogenetic tree where (i) vertices represent different tumor clones that have existed during the tumor's evolution and (ii) edges represent the direct ancestral relationships between clones and are labeled with the mutation(s) that. Model for clonal evolution and inference. (A) An example of the evolution of a tumor containing seven distinct clones. Passenger mutations (white) occurring before the first clonal expansion will be indistinguishable from mutations driving the growth of the founding clone (light blue). Each subsequent mutation (green, purple, dark blue, orange, red and tan) creates a new clone. (B) Three sequenced tumor samples. Some clones may no longer exist at the time of sequencing (orange). Samples 1 and 2 each contain a single clone (purple and blue respectively), whereas Sample 3 is a mixture of three clones (light blue, red and tan).The frequency matrix F observed for the three sequenced samples indicated in part B. (D) The usage matrix U and clonal matrix B that generate F. Even though some clones existing at the current time may not be contained within a sequenced sample (green), their existence in the evolutionary history of the tumor may be recovered. (E) Tree of the inferred tumor clones. Solid black edges are the clonal tree T corresponding to the clonal matrix B. Gray dashed edges indicate internal vertices used in the mixing of some sample. The number next to each clone in each sample indicates the fraction of cells in the sample from that clone. (F) The ancestry graph for the observed data. The bold arcs indicate the spanning arborescence corresponding to T Reconstruction of clonal trees and tumor composition i63 distinguishes the child from its parent (). In practice, we will group individual mutations into sets that satisfy the second condition and consider these as individual mutations. Thus, we describe the mutational process that produced a tumor by an n-clonal tree T, which we define as follows.
DEFINITION 1:A rooted tree T on n vertices is an n-clonal tree for a mutation set n  f1;. .. ; ng provided each edge is labeled with exactly one mutation from n and no mutation appears more than once in T. Let T n be the set of all n-clonal trees. We denote the root vertex of an n-clonal tree by v r where r 2 n is the mutation that does not label any edge in T. We denote the remaining vertices by v j where j 6  r is the mutation on the last edge of the path from v r to v j. Note that the set of mutations present in a clone v j is the set of mutations of all vertices on the path from v r to v j. The root vertex v r contains only mutation r and thus represents the founding clone. Alternatively, we may describe the n-clonal tree T by an n  n binary matrix B. We label the vertices of T by binary row vectors indicating the mutations present in each vertex (clone). Each vertex v j corresponds to a binary row vector b j with 1's at the rth position and positions indicated by the edge labels of the unique path from v r to v j and 0's at the remaining positions. Let B be the n  n binary matrix whose jth row is b j. As the mutations adhere to the infinite sites assumption, it follows that B is a perfect phylogeny matrix (). That is, for a column j of B, let I(j) be the positions of the 1 entries. Then for any pair of columns j and k of B either I(j) and I(k) are disjoint, or one contains the other. Not every n  n perfect phylogeny matrix corresponds to a n-clonal tree T. For example, a perfect phylogeny matrix may have a row and/or column of all 0's or have duplicated rows and/or columns. We define a subset of n  n perfect phylogeny matrices, which we call n-clonal matrices that are in 1-1 correspondence with n-clonal trees T.
DEFINITION 2:A matrix B 2 f0; 1g nn is an n-clonal matrix provided: 1. There exists exactly one r 2 n such that P n j1 b rj  1. 2. For each j 2 nnfrg there exists exactly one k 2 n such that b k b j and P n l1 b jl  b kl   1. 3. b jj  1 for all j 2 n. Let B n be the set of all n-clonal matrices.The second condition above ensures that every n-clonal matrix is a perfect phylogeny matrix. We have the following lemmas, which we prove in the Supplementary Appendix. LEMMA 1:There is a one-to-one correspondence between T n and B n .LEMMA 2:Any B 2 B n has rank n.and E show a clonal matrix together with its corresponding clonal tree.
Measurement of clonal treesWe do not directly observe the clonal tree T relating the clones in a tumor. Moreover, unless we perform single-cell sequencing, we do not directly measure the presence/absence of mutations in individual clones. Rather, each sequenced sample is a mixture of cancer cells (clones) and normal cells. We obtain VAFs or the fraction of reads covering a position that indicate the variant/mutation at each of the mutation sites in each of the samples. The VAF for a mutation is proportional to the cellular prevalence or fraction of cells in the sample that contain the mutation. Suppose we sequence m samples from a tumor with n mutations sites. Our observations are then described by an m  n frequency matrix F  f pi , where f pi indicates the observed VAF in sample p for the ith mutation (). The observed mutation frequencies (entries of F) are related to the tree T by the proportions of normal cells and tumor clones that define the mixture in each sample. We define an m  n usage matrix U  u pi , where u pi indicates the fraction of cells in sample p that come from clone v i , as follows.
DEFINITION 3:An m  n matrix U  u pj  is a usage matrix provided u pj ! 0 and P n j1 u pj 1. Let U m;n be the set of all m  n usage matrices U. Since each sequenced sample is a mixture of clones from T with proportions defined in the usage matrix U, the observed frequency matrix F  f pj  satisfies F  1 2 UB:The coefficient 1 2 arises because, by the infinite sites assumption, all mutations are heterozygous, and thus each f pj 2 0; 0:5. Assuming no errors in F, our goal is to find U and B satisfying (1). We define this problem as follows ().
VARIANT ALLELE FREQUENCY FACTORIZATION PROBLEM:Given an m  n frequency matrix F, find a usage matrix U 2 U mn and a clonal matrix B 2 B n such that F  1 2 UB.Without loss of generality, we assume that the rows and columns of any frequency matrix F are distinct, as duplicated rows or columns can be collapsed. The VAFFP formalizes and generalizes several problems that have previously been considered in the literature. In the case of m  1 sample,introduce the Perfect Phylogeny Mixture Problem, which can be described as a variant of the VAFFP where F is binary (a mutation is either observed or not) and additional constraints are placed on the usage matrix U. In the case of m > 1 sample, PhyloSub () and CITUP () minimize the distance between the observed and inferred F while adhering to the VAFFP. Below we provide further details of the relationships between the various approaches.
Solving the VAFFPIn this section, we derive a characterization of the solutions of the VAFFP (Theorem 1 below) as constrained spanning arborescences of a directed acyclic graph (DAG) called the ancestry graph (Definition 4 below). From this characterization, we prove that the VAFFP is NP-complete (Theorem 2 below) and give an exact algorithm for solving the problem.
A necessary condition and the ancestry graphWe say that B (or T) generates F if and only if there exists a matrix U 2 U mn such that F  1 2 UB. To obtain a characterization of all solutions of the VAFFP, we first define several properties that relate the observed values of F to any clonal tree T that generates F. We start by observing that any T induces a partial ordering on the vertices. That is, for j; k 2 n; j0 T k if and only if vertex v j is an ancestor of vertex v k. Conversely, we say that j and k are incomparable if and only if neither v j nor v k is an ancestor to the other. Because B is a perfect phylogeny matrix, there is a partial order on the columns of B (). That is, for j; k 2 n, we have j0 B k if and only if Ij Ik. Similarly, j and k are incomparable if and only if Ij = Ik and Ik = Ij. From Lemma 1, it follows that j0 T k if and only if j0 B k for all j; k 2 n. Therefore, we will use 0 to denote either one. We now prove the following condition.
ANCESTRY CONDITION:If T generates F and j0 T k then f pj ! f pk for all samples p 2 m.
PROOF:Since j0 T k and j0 B k are equivalent, then Ij Ik. Moreover, because every entry in U is non-negative, we have the following for all samples p 2 m:The contrapositive of the Ancestry Condition for two distinct samples yields the following corollary which is equivalent to the 'crossing rule' stated inWe summarize all possible ancestral relationships between mutations in F in a graph ().
DEFINITION 4:Given an m  n frequency matrix F, the ancestry graph G  V; A is the directed graph with vertices V  fv 1 ;. .. ; v n g and arcs A  fv j ; v k jf pj ! f pk ; for all p 2 mg.The following observation which will be useful in the following section.
OBSERVATION 1:If all columns of a frequency matrix F are distinct then the ancestry graph G is a DAG.A spanning arborescence of the ancestry graph G is a subgraph G 0  V; A 0  with A 0 A, such that there exists a unique path from the root vertex v r to every vertex v 2 V.
LEMMA 3:If T generates F then T is a spanning arborescence of G. PROOF: Let T be a tree that generates F. Suppose for the sake of contradiction that T is not a spanning arborescence of G. Thus, there exists an edge (v j , v k ) in T with j 0 k such that v j ; v k  = 2 A. By definition of A there must exist p; q 2 m such that f pj < f pk and f qj > f qk. By Corollary 1, j and k are incomparablea contradiction. Hence, T must be a spanning arborescence of G.If an ancestry graph G  V; A does not have a spanning arborescence then there exists no tree T that generates F. Checking whether G has a spanning, arborescence can be done in OjAj time since by definition A contains all transitive arcs.shows an example of a frequency matrix whose ancestry graph has no spanning arborescence. Furthermore, not all spanning arborescences T of G generate F.shows such an example, where the matrix U obtained from T and F has negative entries and thus is not a usage matrix. Hence, the existence of a spanning arborescence in G is a necessary but not a sufficient condition for a solution to the VAFFP.
The sum condition and sufficiencyIn the previous section, we saw that the ancestry condition is not sufficient to produce a solution to the VAFFP. Sufficiency will be obtained through a second condition, which we refer to as the sum condition. This condition was stated as the 'sum rule' inIf T generates F then for all samples p 2 m and mutations j 2 n,See the Supplementary Appendix for the proof of the sum condition. For a clonal tree T, sample p and mutation j, we define the deficit d pj  f pj  P v k 2dvj f pk. Thus, the Sum Condition states that if T generates F, then the deficit d pj is non-negative for all samples p and mutations j. It turns out that the deficits for all samples and mutations determine the matrix U. In particular, we have the following lemma. LEMMA 4:Given an m  n frequency matrix F and an n-clonal matrix B, the m  n matrix U  u pj  defined asis the unique matrix such that F  1 2 UB.
PROOF:Lemma 2 tells us that there is a unique U 2 R mn such that F  1 2 UB. It suffices to show that f pj  1 2 P n k1 u pk  b kj for any sample p and mutation j. Let T be the corresponding clonal tree of B and j 2 n. Since b kj  1 for all k 2 Ij, we haveNote that I(j) is the set of indices of all vertices in the subtree rooted at v j in T including v j itself. Since T is a tree, for any k; l 2 Ij with k 6  l, we have dv k  \ dv l   ;. Thus, in the last line. Spanning arborescences of the ancestry graph. (A) F cannot be factorized as its ancestry graph does not admit a spanning arborescence. (B) Red arcs indicate a spanning arborescence T of the ancestry graph of F with corresponding matrix B. B does not generate F as the matrix U  2FB 1 = 2 Umn
A B
Reconstruction of clonal trees and tumor composition i65of the above derivation, we subtract f pl exactly once for all vertices v l 6  v j that are in the subtree rooted at v j. The set of such vertices is Ijnfjg. Hence,Note that by Lemma 2, any B 2 B n is full rank and therefore invertible. Therefore, for any frequency matrix F, there is a unique U 2 R mn such that F  1 2 UB, namely U  2FB 1. Thus, the above lemma gives an explicit formula for the entries of U  2FB 1. For the single sample case, a similar formula was derived byWe need only to show that U created according to Equation (3) is an element of U mn. Thus, we need to show that u pj ! 0 for all p, j and P n j1 u pj 1 for all p. The condition that u pj ! 0 follows directly from our assumption that f pj ! P v k 2dvj f pk for all p and j, as defined in Equation (2). By definition, column r of B consists of only 1-entries. Moreover, every entry f pj 0:5 and thusk1 u pk 0:5. Hence,Using this lemma, we obtain the following characterization of those spanning arborescences of the ancestry graph G that generate F.T generates F  f pj  if and only if T is a spanning arborescence of G such that Equation (2) holds for all f pj .
PROOF:The forward direction follows from Lemma 3 and the sum condition. For the reverse direction, we know that T spans all vertices of G and therefore is a valid clonal tree with corresponding clonal matrix B. Lemma 5 tells us that B, and hence also T, generate F. Thus, there is a 1-1 correspondence between spanning arborescences in G that satisfy the sum condition and solutions to the VAFFP. Note that this characterization allows us to focus on finding B (equivalently T) without considering U in solving the VAFFP. In contrast,try to identify the usage matrix and clonal tree simultaneously. Moreover,do not exploit the 1-1 correspondence between clonal trees and clonal matrices and instead optimize over both. Although a spanning arborescence can be found efficiently, deciding whether G admits a spanning arborescence satisfying the sum condition is NP-complete.In summary, the following procedure gives a solution to the VAFFP for a frequency matrix F: (i) Build the ancestry graph G for F. (ii) Find a spanning arborescence T of G that satisfies the sum condition. (iii) Compute U according to Equation (3).
An integer linear programming solutionWe formulate an integer linear program (ILP) to find the largest arborescence in an ancestry graph G that adheres to the sum condition. If this is a spanning arborescence, then we have found a solution to the VAFFP. First, we introduce an artificial root vertex v r that has an outgoing arc to every other vertex in V. Let A 0  A [ fv r ; wjw 2 Vg denote this extended arc set. For v 2 V [ fv r g, we define d  v  fw 2 Vjv; w 2 A 0 g to be the set of vertices connected to v by an outgoing arc. Similarly, we define d  v  fw 2 Vjw; v 2 A 0 g to be the set of vertices connected to v by an incoming arc. Let variables x 2 f0; 1g jA 0 j be binary variables indicating the presence/absence of arcs in a solution.x jk 2 f0; 1g 8  v j ; v k  2 A 0Constraint (5) enforces that the arborescence T has only one root vertex. Constraint (6) states that for every outgoing arc (v k , v l ) in T, there is an incoming arc (v j , v k ) in T. The arborescence constraint (7) enforces that every vertex v k has at most one incoming arc (v j , v k ) in T. Constraint (8) is the sum condition. Thus, these constraints encode that any arborescence satisfying the sum condition is a feasible solution and vice versa. The objective function (4) maximizes the number of edges in the arborescence. Note that because G is a DAG (Observation 1), our formulation of the ILP does not have to consider cycles. Lastly, note that this ILP only allows us to determine whether a solution to the VAFFP exists but provides no way to discriminate between multiple solutions something we consider in the following section.
VAFFP with errorsThus far, we have assumed that the observed frequency matrix F is error-free. That is, there exists some B 2 B n and U 2 U mn such that F  1 2 UB. However, this may not be the case for real sequencing data where the entries of F are obtained from integer read counts and thus are approximations of the true frequencies. We address this uncertainty in the frequencies by relaxing both the ancestry condition and the sum condition.
Approximate ancestry graphWe use a probabilistic model for the observed read counts. Let X pj be a random variable describing the VAF for a sample p and mutation j. For any pair of mutations j, k and sample p, let PrX pj ! X pk  denote the posterior probability that X pj ! X pk. The sample p with the smallest such probability represents the weakest evidence that mutation j preceded mutation k in the evolutionary history of the tumor. Thus, we define the posterior probability Pr j 0 k as min p PrX pj ! X pk . If this probability is close to 1 then mutation j is likely to be ancestral to mutation k. We build the approximate ancestry graph G  V; A in two steps: (i) cluster mutations whose posterior probabilities indicate that they likely occurred together. The groups of mutations form the set of vertices V. (ii) Retain high-confidence ancestral relationships among the clusters of mutations. The retained relationships form the set of arcs A. Specifically, in the first step, we want to cluster mutations whose posterior probability distributions are similar across all samples. If mutations j and k have identical posterior probability distributions across all samples, then Prj 0 k  Prk 0 j  0:5. Thus, given a parameter a 2 0; 0:5, we define the directed graph H  n; A H  whose vertices are the mutations and whose arcs are given by A H  fj; kj0:5  a Prj 0 k 0:5  ag. The arcs in A H correspond to ancestry relationships where the posterior probability that j 0 k and k 0 j is within a of 0.5. We group such mutations into clusters by computing strongly connected components in H. Thus, the parameter a controls how much we cluster, with a  0 having very little clustering and a  0:5 clustering all mutations together. Then, in the second step, we determine ancestry between clusters/ components by including an arc between two components only if there exist mutations k and l in the corresponding clusters such that Prk 0 l ! b for some specified parameter b 2 0:5; 1. Formally, let S  fS 1 ;. .. ; S t g be the set of strongly connected components in H. We define the approximate ancestry graph G  V; A whose vertices V  S and whose arcs A  fi; jj 9k 2 S i ; l 2 S j s:t: Prk 0 l ! bg. We note there is no theoretical guarantee that the resulting graph G is a DAG because cycles may exist containing one or more arcs with a posterior probability of at least 0:5  a. However, as increasing b reduces the number of arcs in G, we find in practice that setting b sufficiently large generally produces a DAG. We compute the distribution of X pj for a sample p and mutation j as the posterior probability of the VAF given the observed read counts. The observed VAF ~, where ~ c pj and ~ d pj are the number of reads from sample p that cover mutation j and that contain the variant and reference alleles, respectively. The distribution of X pj is the posterior distribution of the binomial proportion when one observes ~ c pj 'successes' on ~ c pj  ~ d pj trials. Assuming a flat prior on the proportion, we have X pj $ Beta~ c pj  1; ~ d pj  1. In other words, we use a generative model for VAFs with ~ c pj $ Binomial~ c pj  ~ d pj ; q and q $ Beta1; 1. For j; k 2 n, we use the method described into compute PrX pj ! X pk . Finally, as the vertices in the approximate ancestry graph G correspond to strongly connected components that typically include more than one mutation, we compute the frequency matrix F  f pj  for the approximate ancestry graph G by combining read counts for all mutations in the same component. That is, for a vertex v j 2 V and sample p 2 m, we defineWe emphasize that our approach clusters mutations according to the uncertainty in their ancestry as determined by the uncertainty in the frequency of individual mutations. We compute the latter from the overlap between the posterior distributions of the binomial parameters. This is very different from existing approaches such as CITUP () and SciClone () that cluster mutations according to VAFs alone. Moreover, in some methods, the uncertainty in the VAF of each mutation is considered to be fixed, rather than a function of the observed read counts. Our approach allows us to distinguish mutations whose observed VAFs may be similar, but which are likely contained within distinct clones, according to their relationships to other mutations in different samples.
An MILP for arborescence with errorsOur construction of the approximate ancestry graph relaxes the ancestral relationships in the case of errors in VAFs. However, errors in the observed VAFs may also result in violations of the sum condition. Thus, we formulate a mixed ILP (MILP) that finds the largest arborescence on the approximate ancestry graph while allowing for the inferred frequencies to differ slightly from the observed frequency values. We create a confidence interval f  pj ; f  pj  as the 1  c equal-tailed posterior probability interval of the Beta distribution with parameters c pj  1; d pj  1 where c is a fixed parameter. This interval will provide lower and upper bounds on the inferred frequency values in the MILP. It is possible that G may not contain any spanning arborescence that satisfies the sum condition since G only consists of high confidence arcs. Therefore, we choose to return a partial solution to the VAFFP by returning the largest arborescence T in G that adheres to the sum condition. This arborescence represents a subset of mutations for which we can confidently infer the ancestral relationships. We note that this is a departure from other methods such as CITUP () and PhyloSub () that require that all mutations be placed on a single tree. There may be multiple such maximal trees T in G. Rather than considering all such trees, we return the clonal tree T (corresponding to a clonal matrix B) and associated usage matrix U that minimize the average deviation between entries in the inferred frequency matrix F  1 2 UB and the observed frequency matrix ~ F. As we have clustered mutations, we need to define a map r which relates individual mutations to their respective cluster. That is, rj  k when mutation j occurs in cluster k. The MILP is as follows.s:t: 5; 6; 7; 8 and 9We model the absolute value in 10 and the product f pk x jk in (8) using standard linearization techniques (). We call the resulting algorithm AncesTree.
ResultsWe implemented AncesTree in C using CPLEX v12.6. We analyze 90 simulated datasets and 22 real tumor datasets. The real data consist of chronic lymphocytic leukemia (CLL) (), lung adenocarcinoma () and renal cell carcinoma tumors (). The lung and renal tumors have undergone multi-section sequencing, whereas the CLL tumors were sequenced over multiple time points. For 14 of the 22 tumors, we have both whole-genome/whole-exome sequencing data and targeted deep resequencing data of either the same or a subset of mutations for all sections of the tumor (Supplementary). For all analyses, we set a  0:3; b  0:8 and c  0:01. See the Supplementary Appendix for results as a and b are varied.
Reconstruction of clonal trees and tumor composition i67
Comparison of AncesTree to PhyloSub and CITUPWe compare AncesTree to two other recent algorithms that infer trees from multi-sample sequencing data: PhyloSub () and CITUP (). We were unable to compare to LICHeE () as the software only provides a graphical user interface with no way to easily export results. We created 90 synthetic tumor datasets. Each dataset contains 100 mutations grouped into 10 clones that accumulated following the infinite sites assumption. For each dataset, we simulated between four and six samples sequenced at a coverage of 50X, 100X or 1000X. Further details of the simulated data are contained in the Supplementary Appendix. We ran AncesTree, PhyloSub and CITUP on each dataset and compared the results using five measures: (i) the fraction of ancestral relationships between pairs of mutations that were correctly identified (); (ii) the fraction of clustered relationships between pairs of mutations that were correctly identified (); (iii) the fraction of incomparable relationships (i.e. neither ancestral nor clustered) between pairs of mutations that were correctly identified (Supplementary); (iv) the average error 1 mn jj ~ F  Fjj 1 between the simulated ~ F and inferred frequency matrix F () and (v) the error between the simulated usage matrix ~ U and the inferred usage U using the same metric as Malikic et al.). We note that we compute these measures only on the set of mutations that are included in the output of all methods, which equates to the set of mutations output by AncesTree (median of 69 of the 100 total mutations) since CITUP and PhyloSub include all mutations. We find that AncesTree has higher accuracy in determining ancestral, clustered and incomparable relationships with median accuracy more than 0.05, 0.03 and 0.08, respectively, higher than the median accuracy of the other methods. Further, we find that AncesTree achieves a median error on F and U that is 0.01 and 0.03 lower than the median error of the other methods. See Supplementary Appendix for further details on all five metrics. We also compare the output of AncesTree, CITUP and PhyloSub on the sequencing data from 22 tumor samples and find that AncesTree produces results that are more consistent with the input data in terms of our probabilistic model (see Supplementary Appendix).
Whole-exome versus deep sequencingA key difference between AncesTree and other approaches is that we use a graph clustering approach to group mutations by their putative ancestral relationships across all samples, rather than clustering VAFs directly. We demonstrate the advantages of this approach on a lung tumor] that had multiple samples sequenced using both whole-exome and targeted deep sequencing (higher coverage) data. One would expect that deep sequencing data should provide a more accurate measurements of the VAF for each mutation due to the higher read counts. However, in aggregate, there is very little difference between the VAF histograms for whole-exome versus deep sequencing (). Thus, methods that first cluster mutations according to their VAF without considering the variance in the VAFs of individual mutations from the observed read counts, including CITUP () and LICHeE (), will not recognize differences in clustering between the low and high coverage data. Examining the posterior probabilities of ancestral relationships between individual mutations () reveals a striking difference between the low and high coverage datasets. The higher coverage targeted sequencing data have a much clearer distinction in ancestral relationships with many more pairs of mutations having posterior probability Pri 0 j, the probability that mutation i precedes mutation j, close to 1 or 0, indicating high confidence in the ancestral relationships. The approach used by AncesTree exploits this higher confidence in individual ancestral relationships, both in grouping mutations and in determining the tree. For example,shows the posterior probabilities of the VAF for three mutations. With lower coverage whole-exome sequencing, the distributions overlap, and there is no clear ancestral or grouping relationship between the mutations. With deep sequencing data, the variance of VAF for each mutation is smaller and relationships between the mutations become apparent. The red mutation has a strong probability to be ancestral to both the blue and green mutations as Prred 0 green]  1:0 and Prred 0 blue]  1:0. In contrast, the blue and green mutations overlap significantly suggesting that these mutations should be clustered together. We find Prblue 0 green]  0:45 and Prgreen 0 blue]  0:22, both of which are within the interval 0:5  a; 0:5  a   that we use for clustering. Thus, these mutations will be found in the same strongly connected component when building the approximate ancestry graph.. Comparison of whole-exome (top) and deep sequencing data (bottom) for lung patient 330. (A) Histogram of observed VAFs for all mutations for both datatypes does not reveal a significant difference between lower (201X) coverage (top) and higher (674X) coverage (bottom) sequencing data. (B) A heat map showing the posterior probability Pr i 0 j for all pairs of mutations i and j. The asymmetry in the matrix reveals high confidence ancestral relationships, which become much clearer with higher coverage. (C) The posterior distribution of the VAF for three mutations given the observed read counts. In higher coverage data, the distributions become much tighter, revealing that the red mutation is ancestral to the blue and green mutations i68 M.El-Kebir et al.shows the clonal tree inferred by AncesTree for CLL patient 077 previously analyzed with both PhyloSub and CITUP. The structure of our clonal tree closely resembles the trees reported by the other algorithms (); in particular, both trees have two branching lineages containing mutations in the same genes. Furthermore, AncesTree returns purity estimates within 0.04 and 0.05, respectively, of those reported by PhyloSub and CITUP across all five tumor samples. However, there are also important differences between the trees. PhyloSub and CITUP group together multiple pairs of mutations that AncesTree separates into successive clones. For instance, PhyloSub and CITUP cluster MAP2K1, HMCN1 and NOD1 into a single clone, whereas the tree produced by AncesTree shows these mutations as the result of three successive clonal expansions. The extremely high read counts (>450 K) for these three mutations across all five samples give high confidence in the posterior probability of the ancestral relationships: the minimum posterior probabilities over all samples are 0.86 and 1 for the two edges. Similarly, PrPLA2G16 0 EXOC6B  1 as is reported in AncesTree's clonal tree (). In addition to the differences in ancestry, the clonal tree output by AncesTree contains only a subset of the mutations, whereas the tree output by PhyloSub contains all mutations. We find that three of the missing mutations (in genes BCL2L13, NAMPTL and SAMHD1) have VAFs that are significantly higher than 0.5. Indeed the 1  c confidence interval used by our ILP implementation is strictly larger than 0.5. It is likely that these mutations occur in regions affected by copy number aberrations, thus violating the assumptions of our model. We examined the approximate ancestry graph for this sample (Supplementary) to determine why other mutations were missing from the tree output by AncesTree. We find that mutations in SLC12A1 and GPR158 only have incoming arcs from the three genes listed above whose VAFs exceed 0.5. Thus, there is no subtree of the ancestry graph that contains both SLC12A1 and GPR158. The other missing mutations (KLHDC2, COL24A1, DAZAP1, GHDC and OCA2) are all descendants of SLC12A in the ancestry graph. Of these missing mutations, all except for GHDC are also descendants of GPR158, but each violates the sum condition if added to the tree output by AncesTree.
A B
Uncovering high-confidence ancestral relationships
Heterogeneity within samplesAs AncesTree directly computes the usage matrix U, we obtain estimates of the amount of mixing, or intra-tumor heterogeneity, of clones within each analyzed sample. Specifically, for a given sample, the number of clones that are inferred to be mixed in a sample is the number of non-zero entries in the corresponding row of U. For each tumor, we compute its mixing proportion to be the fraction of entries in U that are non-zero (see Supplementary). Using the deep sequencing data, we find that the CLL tumors have on average a mixing proportion of 1.0. This is much higher than the renal and lung tumors which have on average mixing proportions of 0.22 and 0.5, respectively. The higher mixing proportions for CLL are consistent with it being a liquid tumor, where mixing between clones is likely to be more common than in solid tumors. We further analyzed one renal tumor, EV006, for which we obtained a relatively low mixing proportion of 0.21 (). Samples R6 and R7 from this tumor were found to be the mixture of two and three distinct clones, respectively, that do not appear in other samples. This shows that AncesTree can infer the composition of individual samples containing clones distinct from all other samples. The remaining samples in this tumor all include a clone that appears in at least one other sample. Notably, the two lymph node samples, LN1a and LN1b, are inferred to be mixtures of the same two clones. The only difference between these two samples appears to be that LN1b contains a higher admixture with normal cells (0.45) than LN1a (< 0.01), and indeed the two lymph node samples are grouped together in the original analysis of this tumor by
DiscussionReconstructing the evolutionary history of a tumor given VAFs measured in multiple sequenced samples for a single tumor is a A B C. Analysis of CLL patient 077 shows AncesTree's ability to infer successive clonal expansions. (A) The clonal tree output by AncesTree is indicated by the black solid edges whose weights correspond to the posterior probability of the ancestral relationship. Dashed edges are used to indicate ancestral clones which exist at the time of sequencing. The blocks labeled 'a' through 'e' each represent a sequenced sample, with colored edges indicating the inferred composition of clones and their fraction in each sample (only edges with usage at least 0.05 are shown). (B) The 1  10 6 confidence intervals of VAF for the sample with the weakest ancestral evidence for each of the edges connecting gene GPR158 to LRRC16A. (C) The tree reported by PhyloSub, which is identical to the tree reported by CITUP except for the addition of SAMHD1. Mutations indicated in blue are those present in part A. Mutations indicated in red likely occur in regions affected by copy number aberrationsReconstruction of clonal trees and tumor composition i69 challenging task. In this work, we formalize this problem as the VAFFP. We derive a combinatorial characterization of the solutions to this problem and prove the problem is NP-complete. We present the AncesTree algorithm for solving an approximate version of the problem which allows errors and demonstrate the advantages of AncesTree relative to existing approaches. There are a number of avenues for further investigation. First, we have ignored the effect of copy number aberrations on VAFs, meaning that AncesTree may not currently be applicable to some datasets. Second, AncesTree only outputs the single largest rooted subtree of the approximate ancestry graph that satisfies the sum condition. The algorithm may be applied iteratively by removing the clonal tree found at each step from the ancestry graph and rerunning, thus returning a forest. However, it is unclear how the trees in this forest relate to each other or if there is an approach for joining them. Third, the theoretical results may be strengthened. For example, as the number m of samples is much smaller than the number n of mutations, it would be interesting to see if the problem is fixedparameter tractable. Finally, our use of the binomial distribution to model read counts may underestimate the variance; e.g. due to factors such as PCR artifacts. More realistic models of read counts may improve the performance of AncesTree. Finally, we note that the kidney and lung datasets analyzed here contain multiple sections of a solid tumor obtained at a single time point, whereas the CLL datasets contain samples obtained at different times. Future work will include handling multi-section samples and multi-time-point samples separately to account for time related dependencies.. Analysis of renal patient EV006 reveals distinctive sample composition. The clonal tree output by AncesTree. Some sequenced sections (R6, R7) are mixtures of clones appearing only in those sections. In contrast, other sequenced sections (LN1a, LN1b and R3) are mixtures of clones that each appear in more than one section. In particular, both lymph node samples (LN1a and LN1b) are mixtures of the same two clones but in different proportions
Funding
at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
M.El-Kebir et al. at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
