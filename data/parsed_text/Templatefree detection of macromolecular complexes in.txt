Motivation: Cryo electron tomography (CryoET) produces 3D density maps of biological specimen in its near native states. Applied to small cells, cryoET produces 3D snapshots of the cellular distributions of large complexes. However, retrieving this information is non-trivial due to the low resolution and low signal-to-noise ratio in tomograms. Current pattern recognition methods identify complexes by matching known structures to the cryo electron tomogram. However, so far only a small fraction of all protein complexes have been structurally resolved. It is, therefore, of great importance to develop template-free methods for the discovery of previously unknown protein complexes in cryo electron tomograms. Results: Here, we have developed an inference method for the template-free discovery of frequently occurring protein complexes in cryo electron tomograms. We provide a first proof-of-principle of the approach and assess its applicability using realistically simulated tomograms, allowing for the inclusion of noise and distortions due to missing wedge and electron optical factors. Our method is a step toward the template-free discovery of the shapes, abundance and spatial distributions of previously unknown macromolecular complexes in whole cell tomograms.
INTRODUCTIONCryo electron tomography (cryoET) enables the 3D visualization of a cell's interior under close to live conditions (). Such tomograms are essentially 3D representations of the entire proteome providing a snapshot of the distributions of protein complexes and their interaction networks (). However, retrieving shape information and distributions of macromolecular assemblies is not trivial due to the low signal-to-noise ratio (SNR), missing data and nonisotropic resolution, and the fact that individual macromolecules are difficult to recognize in a highly crowded environment (). So far, the identification of macromolecular complexes is accomplished mostly by template matching methods (where the signals representing the density map of a known protein complex structure are correlated to the signals in the cryoET map. * To whom correspondence should be addressed.The cross-correlation between the template and tomogram is calculated for each position and every possible orientation. Peaks in the resulting cross-correlation function across the whole tomogram may indicate positions occupied by the particular complex. A major drawback, however, is that template matching cannot discover yet structurally unknown complexes. So far only a relatively small fraction of large protein complexes have been structurally resolved. Furthermore, recent work has shown that the quaternary structure of large protein complexes varies considerably across different organisms () and available reference structures might therefore not be applicable to the desired organism. Even if a template structure is available, the template-based methods may fail if the template structure is in a different conformation or is bound to additional proteins than the target complexes in the tomogram. As a consequence, template-based methods may fail in detecting an unbiased atlas of the spatial arrangement of all complexes in a cell (i.e. a cellular proteome 'atlas'). It is, therefore, of great importance to develop template-free methods for the detection of macromolecular complexes in cryo electron tomograms. Such methods will allow not only the discovery of the shapes of unknown macromolecular complexes but also allow detecting their positions and orientations in the cryo electron tomograms. The key problem in a template-free approach is to identify frequently occurring density patterns in cryo electron tomograms. A pattern is defined by voxel regions with similar intensity structures, which appear multiple times at different position in the tomogram. Such frequently occurring patterns represent objects of biological interest. In this article, we focus on patterns that correspond to protein complexes. Once identical complexes are discovered, their subtomograms can be locally aligned and their density distribution averaged producing a density map of the complex with improved SNR. Identifying recurrent patterns in cryo electron tomograms is challenging because neither the composition nor the total number of the patterns is known. Moreover, cryo electron tomograms are of very low resolution (4 nm), low SNR and are subject to distortions due to electron optical effects. Therefore, traditional methods in computer vision derived for high resolution and high SNR 3D object recognition usually cannot be directly applied to cryo electron tomograms (). Here, we propose a step-wise approach for classifying cryo electron tomograms into recurrent density patterns (). First, an initial classification is generated based on rotation-invariant features of the tomogram. In the second step, this initial classification is refined using a Gaussian Hidden Markov Random Field (GHMRF) model. As an inference method, GHMRF models have shownrobustness in 2D image segmentations at relatively high noise levels (). Here, we extend the GHMRF framework to the classification of recurrent patterns in 3D cryoET maps, which contain high levels of noise and distortions. In this article, we provide the first proof of principle of the method, and demonstrate its applicability for the detection of frequently occurring protein complexes in noisy density maps with relatively high accuracy. We test our approach on realistically simulated cryo electron tomograms including low resolution, high levels of noise and distortions due to missing wedge effects and electron optical factors.
M.Xu et al.
METHODSOur method consists of three steps (): first, we identify candidate patterns (i.e. objects) by segmenting the tomogram into high intensity regions. This step reduces the search space to the most promising density regions. Second, the similarity between all the objects is compared. To calculate similarities between all the objects efficiently, each tomogram voxel (i.e. the 3D equivalent of an image pixel) is represented by a feature vector that describes the local intensity distribution in the proximity of the voxel in a rotationally invariant manner. The similarity between objects is then determined efficiently by comparing the distances between the corresponding feature vectors. Then the segmented objects are clustered based on their feature vector similarity. All voxels in objects of the same cluster are assigned to the same pattern class. Third, the resulting initial voxel classification is refined by an GHMRF approach. The GHMRF approach reclassifies the voxels into recurrent patterns by maximizing the probability to observe the classification for the given tomogram.
Problem formulation and definitionsA tomogram is described by a 3D grid of voxels that are associated with values of electron optical density. Let T ={1,2,...,N} be the set of indices of all voxels in the density map, and let x i  R 3 be the location of voxel i  T in the map. Intensity vector: then, a tomogram is represented by a N-dimensional vector of the ordered list of intensity values for all voxels.where N is the total number of voxels and f i is the intensity value of voxel i. Class label vector: a pattern in a density map is defined as a collection of voxels that may have different intensities but are assigned to the same pattern class. Let us define the set of all pattern classes in a tomogram as C ={1,2,...,C}, with C as the total number of classes. Each voxel in the density map can be assigned to one of the classes in C. Similar to an intensity vector, we therefore define a class label vectorwhere l i  C is the class label of voxel i. Whereas the intensity vector f is known, the class label vector l is unknown and to be inferred. The task of identifying recurrent patterns in a density map is therefore equivalent to determining the class label vector l  L. To achieve this goal, we apply a two-step procedure, combining a heuristic approach generating an initialtomogram classification with a subsequent refinement using a statistical inference method that maximizes the joint probability of the class assignment l and the intensity f .
Initial tomogram classificationThe goal of the following section is to define an initial class label vector l, which serves in a later step as an input in the GHMRF-based refinement process.
Identification of segmented objects. First, Gaussian filtering is applied to generate a blurred density map f blur reducing the influence of noise in the segmentation. Then a seed growth approach is adapted from the watershed segmentation () as follows. All local intensity maxima in the filtered map are identified. Local maxima with low intensity values are likely a result of noise and are discarded. The remaining local maxima with high intensity voxels are used as seeds for an extended watershed segmentation procedure. During the seed growth segmentation, a voxel rank r is introduced that captures the order at which voxels are included to a region. A segmented region S s is defined, where the watershed algorithm is terminated at a given voxel rank r max s. Let v s,r be a specific voxel index, of segment s and voxel rank r, then the set of voxels in a region of segmented object S s is defined asfor all s. Note that the filtered tomogram is only used to identify the indices of voxels in the segmented objects. Classifications are performed using the unfiltered intensity values of these voxels.
Rotation-invariant feature vectors.To introduce an efficient way to compare the similarities between all the distinct objects, we introduce rotation-invariant feature vectors (). Rotation-invariant feature vectors p(x i ) describe the intensity distribution of the tomogram in the neighborhood of a voxel located at x i. To construct a feature vector at the voxel location x i , we divide the neighborhood of the voxel x i into M concentric shells (),...,M}.where V j (x i) is defined as the set of voxels that fall into the concentric shell centered at x i and is defined by the two radii r j1 and r j , where with r j = jR/M and R is the largest chosen radius. If a concentric shell V j (x i ) is thin i70Page: i71 i69i76
Template-free complex detection in tomograms(i.e. r j+1 r j  voxel length), then the voxel intensities f (x k ) with k  V j (x i ) can be approximated by a spherical function g that is defined on the surface of a sphere in spherical coordinates., and ,  are the colatitude and longitude angles, respectively. g can then be approximated by a sum of its spherical harmonics ():where L is a given bandwidth, and a lm is a coefficient associated with the complex spherical harmonics function Y m l , which is independent to g.Based on such a decomposition, the intensity distribution of all the voxels in shell V j (x i ) can then be described by a set of L rotation-invariant features {s jl |l = 1,...,L}() as follows:Such features are calculated for all the M shells. The rotation-invariant description of the density distribution around the location of a voxel x i is then defined by the following feature vector:whose elements consist of the ordered sequence of s jl for all consecutive shells {V j (x i )|:j = 1,...,M}. These feature vectors are rotation invariant, which means that they are independent of the relative orientation of the local density distribution. Therefore, feature vector-based similarities between density regions can be calculated even if these regions are at different relative orientations to each other. Previously, we have shown that such rotational invariant features are also robust against noise in maps ().
Comparing the similarity of segmented objects.The goal is to cluster segmented objects based on their feature vector dissimilarity. The dissimilarity o a,b between objects a and b is defined as one minus the fraction of voxels with similar feature vectors in both objects S a and S b .where N sim Sa,S b is the number of similar feature vectors that appear both inN fea i is the set of feature vectors that are most similar to feature vector i, but are located spatially apart from i in the tomogram. N tot Sa and N tot
S bare the total number of feature vectors in S a and S b , respectively. N sim Sa,S b is the sum of the total number of feature vectors in object a for which a similar feature vector exists in object b and the number of feature vectors in b with a similar feature vector in a. To determine N fea i , the voxels in the tomogram are clustered based on the Euclidian distance between their feature vectors. Cryo electron tomograms are generally so large that not all feature vectors can be stored in computer memory at the same time. We, therefore, employ a large-scale clustering technique, (BIRCH) (). The clustering cutoff is chosen heuristically by sampling the similarities between randomly selected feature vectors. Good performances have been achieved when the cutoff comprises the top 5% of sampled feature vector similarities. Then all voxels are detected that are in the same cluster but are apart in grid space so that they are not direct neighbors in the tomogram. For each voxel i in each cluster A a voxel set is defined as U i ={k ::x k x i > r d ,k  A}, where r d is a predefined grid distance. It is computationally beneficial to restrict N fea i to only a fixed number of the closest voxel neighbors. Here, N fea i is defined as the subset of U i with the 20 voxels whose feature vectors are most similar to the feature vector of i. Slight variations of this number do not affect the outcome of our calculations.
Clustering of segmented objects. Next, all segmented objects are clustered using hierarchical clustering with the dissimilarity measure o a,b. The clustering cutoff is determined as the global minimum in a penalty function that seeks to simultaneously minimize the number of clusters and the variation within each cluster according to. All objects in the same cluster define the same frequently occurring density pattern. Because we are only interested in frequently occurring patterns clusters with less than three objects are discarded. The number of all density pattern classes C is then defined as the number of all clusters n and a 'background' class, which comprises all the voxels in the tomogram that are not part of any segmented object. All the voxels in objects that are part of the same cluster are assigned to the same class label l  C, with C ={1,2,...,n}. All remaining voxels in the tomogram are assigned to the background class. The assignment of all the voxels to the pattern classes defines the class label vector l = (l 1 ,...,l N ), which is the initial classification of the tomogram and serves as input information for a refined reclassification described in the following section.
Classification refinement by Gaussian Hidden Markov Random Field ModelIn this section, the initial classification is refined using an GHMRF model. In the GHMRF framework, class labels are not directly observable variables and are modeled as a hidden random field. The class labels are determined by maximizing the joint probability P(l,f ) of class labels l and the intensity vector f. GHMRF has been used for image analysis and segmentation (). Here, we apply and extend the method to 3D density maps for the classification of frequently occurring macromolecular complexes in cryo electron tomograms.
Gaussian Hidden Markov Random Field Model.In the GHMRF framework, the voxel labels are modeled as a hidden random field. Their conditional independence follows the Markov property and can be described by an undirected graph where each node corresponds to a voxel.are the labels of neighbor voxels of i. In standard GHMRF models, the voxel neighborhood is defined by an undirected graph with voxels as vertices and edges as the cubic grid connecting the vertices (). In our method, this graph is augmented by additional edges between those voxels that share similar feature vectors but are at far distance in the tomogram grid. In other words, for a given voxel i, its neighborhood list N i includes all direct grid neighbors in the tomogram and all voxels that have a similar density environment even if they are located at far distance (). By augmenting the list of grid neighbors, we are able to connect those voxels in the graph that have the same class label, even if these voxels are part of different copies of the same complex located at different regions of the tomogram. The neighborhood N i of voxel i is, therefore, defined as(12) where N map i is the set of all voxels that are adjacent to i in the tomogram grid and N fea i is the set of voxels that have similar feature vectors. Voxel intensities f i form an observable random field. Given the class label l i = l, the voxel intensity f i is assumed to follow a conditional probability distributionthe maximization, we use an iterative approach () that consists of two steps. First, for a given estimation of the parameter setset set (t) at iteration t, a classification is performed to obtain updated class labelslabels (t+1). Then expectation maximization determines the optimal parameter setset set (t+1) given given (t+1) obtained from the first step.Step 1: classification. GivenGiven Given (t) , we want to obtainAccording to, the minimization problem can be formulated as aswith the energy functionswhere  is the set of all cliques on the graph. Following, we choose V c = l i l j , where  is the Kronecker delta function. Calculating the global minimum of Equation (17) is computationally infeasible. However, because both U(f |l) and U(l) can be expanded into sums over all voxels i  T , the optimal solution can be approximated using the iterated conditional modes (ICM) algorithm (), which is popular in solving such optimization problems. This method optimizes U(l i |l T \{i} ,f ) for each i  T , while keeping all other labels l T \{i} fixed.Following Li (2009) and given the class labels l N i obtained from the classification step, the probability for a voxel i to be assigned to class label l is calculated asThe iterations between expectation and maximization step are repeated until convergence is reached, leading to the newly refined class label vector l. Finally, a class label can be defined for each object as the label that is assigned to the majority of voxels in the object. The classification performance is increased, if all the voxels with labels different to the corresponding object label are reassigned to the background class.
Generating simulated cryo electron tomogramsFor a reliable assessment of the method, tomograms must be generated by simulating the actual tomographic image reconstruction process, allowing the inclusion of noise, tomographic distortions due to missing wedge and electron optical factors such as contrast transfer function (CTF) and Modulation Transfer Function (MTF) (). We follow a previously applied methodology for simulating the tomographic image formation mechanism as realistically as possible ().The electron optical density of a macromolecule is proportional to its electrostatic potential and the density map can be calculated from the atomic structure by applying a low pass filter at a given resolution. Here, density maps are generated at 4 nm resolution using the PDB2VOL program of the Situs 2.0 package () with voxel length of 1 nm. These initial density maps are then used as samples for simulating electron micrograph images at different tilt angles. In cryoET, the sample is tilted in small increments around a single-axis. At each tilt angle, a simulated micrograph is generated from the sample. We set the tilt angle rotating from 70 to 70 @BULLET with steps of 2 @BULLET , which is a typical procedure for experimental tomograms. As a result, our data contains a wedge-shaped region in Fourier space for which no data have been measured (missing wedge effects), similar to experimental measurements. The missing wedge effect leads to distortions of the density maps along the tilt-axis. To generate realistic micrographs, noise is added to the images and the resulting image map is convoluted with a CTF, which describes the imaging in the transmission electron microscope in a linear approximation. Any negative contrast values beyond the 1st zero of the CTF are eliminated. We also consider the MTF of a typical detector used in whole cell tomography, and convolute the density map with the corresponding MTF. The CTF and MTF describe distortions from interactions between electrons and the specimen and distortions due to the image detector (). Typical acquisition parameters that were also used during actual experimental measurements of whole cell tomograms () were used: voxel grid length = 1 nm, the spherical aberration = 210 3 m, the defocus value =410 6 m, the voltage = 200 kV, the MTF i72Page: i73 i69i76corresponded to a realistic electron detector (), defined as sinc(/2) where  is the fraction of the Nyquist frequency. Finally, we use a backprojection algorithm to generate a tomogram from the individual 2D micrographs that were generated at the various tilt angles (). To test the influence of increasing noise, we add different amount of noise to the images, so that the SNR levels range between 5 and 0.5, respectively ().
Template-free complex detection in tomograms
Benchmark setThe classification is tested on simulated tomograms containing 40 complexes of four different classes (). To assess bias arising from specific combinations of complexes, a set of 24 types of complexes of variable sizes were selected from the PDB databank (). From this pool, 52 benchmark sets were generated that each contained four randomly chosen types of complexes. To generate a tomogram for each of these combinations, 10 instances of each complex were randomly oriented and placed into a grid of size 150 nm150 nm100 nm (). For two of the 52 benchmark sets (set 1 and set 2), 50 independent density maps were generated each with randomly placed complexes. For each density map, a tomogram was simulated at four different signal-to-noise ratios (SNR = 0.5, 0.1, 5, ) () leading to a total of 200 simulated tomograms per set. Set 1 contains GroEL, heat-shock protein ACR1, carboxipeptidaseand propionylCoA carboxylase(PDB ID in squared brackets). Set 2 contains ornithine carbamoyltransferase, octomeric enolase, RNA polymeraseand ClpP). For the remaining 50 benchmark sets of complexes, tomograms were generated at SNR = 0.5.
AnalysisFor the simulated tomograms, l is compared to the known ground truth l true. A true positive match is defined when a voxel's predicted class label l i is identical to the true class label l true i. To assess the performance, the precision and recall of the classification is calculated. The precision is a measure of exactness defined as the fraction of the correctly predicted voxels,where #TP is the number of true positives and #TP+#FP is the total number of voxels with the same class labels. The recall is a measure of completeness defined as the number of true positives divided by the total number of voxels of that class in the ground truth.where #FN is the number of false negatives, i.e. the number of voxels that were not identified as class members. In addition, the precision and recall for classifying segmented objects is calculated. Here, class labels are defined for complexes (i.e., segmented objects) instead of individual voxels.
RESULTSFirst, we analyze the effectiveness of the rotation-invariant feature vectors in detecting pattern similarities in a tomogram. Then we describe the performances of the initial pattern classification and the refined pattern classification based on the GHMRF approach.
Analysis of feature vectorsWe now determine the locations of the most unique feature vectors in a complex. For each of the 24 benchmark complexes, a simulated density map is generated at 4 nm resolution () and its rotation-invariant feature vectors are calculated. For each voxel in a complex, the distance is calculated between its feature vector and all the feature vectors in the other complexes. For each of the 24 complexes, the minimum distance is determined. For the given voxel, the average of all minimum distances is a measure of the feature vector's uniqueness with respect to the feature vectors in all the other complexes. The average minimum distance correlates strongly with the position of the voxel from the mass center of the complex (average Pearson's correlation 0.680.05). Voxels at the complex center have feature vectors that are most different from those in other complexes and are therefore most discriminative for classification purposes (). Moreover, larger complexes have generally a greater number of unique feature vectors (). These findings provide an important guide for increasing accuracy and computational efficiency of the method. Instead of processing all feature vectors in a tomogram, one should focus only on those vectors that are located at the central regions of a complex. Considering only the most informative feature vectors will not only increase the accuracy of the method but also greatly increase the computational efficiency and reduce the necessary computational memory consumption. Noise and distortions in a map will reduce the number of unique feature vectors, however, also then the central regions are most discriminative for classification. Accordingly, the similarity between the segmented objects in a tomogram is calculated by using only its central core regions.
Parameter definitionThe classification accuracy is increased, if the similarity between segmented objects is calculated from their core regions. Here, the core region is set to be 500 nm 3 and is defined by the termination of the adapted watershed algorithm after 500 voxels are selected:The good performance for using a fixed rather than a relative sized core region is presumably a result of the limited size range of soluble complexes in a cell, which ranges typically up to  2700 nm 3 (ribosome) with a mean of  656 nm 3 in our sample. A slight variation of the core region size does not change the outcome of our analysis. However, using more extended regions will not improve but often decrease the classification accuracy while reducing computational efficiency significantly.While the object similarities are determined from the core regions (S core ), the determined class labels are assigned to all voxels in an extended region S ext
i73
M.Xu et al.
Classification performanceWe now analyze the performance of the method and distinguish between the assessment of individual voxels and segmented objects. In addition, the performance is analyzed with respect to different combinations of complex types and their relative placements in the tomograms.
Voxel-based classification. To comparethe influence of noise, we have generated 50 tomograms for four different SNR levels (Tables 1 and 2). For benchmark set 1, the average precision of the initial classification is 0.44 with an average recall of 0.54 for tomograms without noise. With increasing noise levels,the precision and recall, respectively. As expected, the GHMRF model improves significantly the precision and recall. For tomograms with the highest noise level, the average precision is improved from 0.39 to 0.44 in comparison to the initial classification (and). These observations indicate that about 40% of all voxels can be predicted as members of the correct pattern class, even when significant noise and distortions are present in the tomogram. This excellent performance is in a similar range as classifications based on template matching. For benchmark set 2, precision and recall for the initial classification is substantially higher for tomograms with low noise levels in comparison to set 1. However, the initial classification is more affected by noise in the tomogram in comparison to benchmark set 1. The differences in performance presumably reflect the variable number of unique feature vectors in different complexes. The average precision decreases from 0.5 for tomograms without noise to 0.31 for tomograms with an SNR level of 0.5 (). Again, the GHMRF model improves the performance dramatically, in particular for tomograms with high noise levels. For tomograms with the highest noise level, the precision is improved from 0.31 to 0.51 in comparison to the initial classification (Tables 1 and 2). As a statistical inference method the GHMRF-based refinement appears more robust against the distortions in the tomogram due to missing wedge, electron optical factors and increasing noise levels. To further test different combinations of complexes, 50 additional sets of randomly chosen complexes were tested. For all of these sets, tomograms were generated with SNR of 0.5. The average precisions, recall and their SDs are very similar to those of sets 1 and 2 [voxelbased GHMRF classification, averaged over all sets: precision 0.45 (0.12), recall 0.51 (0.12); object-based GHMRF classification: precision 0.62 (0.14), recall 0.62 (0.14)] (Supplementary).
Object-based classification Assessmentof the classification can also be performed based on segmented objects rather than individual voxels. A true positive match is then defined if a segmented object is classified correctly even if not all of i74
M.Xu et al.crowded cell cytoplasm. Moreover, a number of limitations to visual proteomics might be overcome by further technical developments. In future, it may be possible to improve the moderate SNR level in cryoET, for instance, by improving the contrast in tomograms through phase plates (). Furthermore, specimen thinning techniques through focused ion beams () will be crucial for improving SNR and imaging larger cell types, such as eukaryotic cells. Finally, direct electron detection systems promise to largely improve SNR of cameras (), which will be highly beneficial for cryoET. In summary, our results demonstrate the detection of frequently occurring complexes in tomographic maps, even at low SNR levels and without the need of available template structures. Our method can facilitate the discovery of new complexes in cryo electron tomograms. This task provides a step toward unbiased visual proteomics of cells, which aims to discover the shapes, abundance and spatial distributions of all large protein complexes in a cell.
at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from [19:50 6/6/2011 Bioinformatics-btr207.tex] Page: i70 i69i76
at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
i76 at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
