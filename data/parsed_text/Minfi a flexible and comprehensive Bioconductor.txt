Motivation: The recently released Infinium HumanMethylation450 array (the '450k' array) provides a high-throughput assay to quantify DNA methylation (DNAm) at 450 000 loci across a range of genomic features. Although less comprehensive than high-throughput sequen-cing-based techniques, this product is more cost-effective and promises to be the most widely used DNAm high-throughput measurement technology over the next several years. Results: Here we describe a suite of computational tools that incorporate state-of-the-art statistical techniques for the analysis of DNAm data. The software is structured to easily adapt to future versions of the technology. We include methods for preprocessing, quality assessment and detection of differentially methylated regions from the kilobase to the megabase scale. We show how our software provides a powerful and flexible development platform for future methods. We also illustrate how our methods empower the technology to make discoveries previously thought to be possible only with sequencing-based methods. Availability and implementation:
INTRODUCTIONDNA methylation (DNAm) is a chemical modification of DNA that plays a key role in regulating gene expression. Epigenetic mechanisms, including DNAm, allow a single genome to give rise to hundreds of phenotypically diverse cell types. In addition to its importance in normal development, DNAm is thought to play an important role in diseases when dysregulated. Chemically, DNAm involves the addition of a methyl group to a cytosine base (C), forming methylcytosine. In adult mammalian cells, this modification occurs almost exclusively at Cs immediately followed by a G in the 5 0 3 0 direction, denoted by CpG. CpGs are depleted in mammalian genomes and those that remain tend to cluster in regions termed CpG islands (Gardiner) that are enriched near gene promoters. The health implications of deciphering the DNAm code have recently received much attention (). DNAm is best understood in the context of cancer biology, where it is clear that aberrant gains and losses of DNAm almost universally accompany the initiation and progression of tumors (). Much of the excitement surrounding epigenetics relates to the promise of therapies that reverse disease-associated epigenetic alterations, thereby activating or silencing aberrantly expressed diseaserelated genes. As a result of DNAm's role in developmental and disease biology, there is great interest in measuring DNAm at a comprehensive genomic scale. Although next-generation sequencing technologies offer several promising new approaches (), currently, Illumina Infinium arrays are the most widely used technology for this purpose. For example, The Cancer Genome Atlas (TCGA) project is using this array and has already processed 46000 samples (as of) and made the data publicly available (http://cancergenome.nih. gov/). Furthermore, large cohort studies are becoming interested in measuring methylation and are expected to use cost-effective arrays with some studies already published (). This work introduces a software development framework for the analysis of Illumina Infinium methylation arrays. Although the design is general, the current version of our software focuses on the Illumina Infinium HumanMethylation450 Bead array (the '450k' array), their most recent product. This array has been extensively described (), but we include a *To whom correspondence should be addressed.short description here for completeness. The two-color array interrogates the methylation status of 485 512 methylation loci (mostly CpG sites, but a small number of cytosines outside of the CpG context are also present), using bisulfite-converted DNA. For each methylation locus, two signals of interest are recorded. One signal measures the amount of methylated DNA (Meth), and the other signal measures the amount of unmethylated DNA (Unmeth). In principle, the proportion Meth/ (Unmeth  Meth) is the methylation ratio (referred to as beta value by Illumina's software) in the population of cells from which we extract DNA. The methylation ratio, or its logit transform, is the quantity used in downstream analysis. In the scientific literature related to the 450k platform, logittransformed beta values are referred to as M-values. The Meth and Unmeth signals do not relate to the green and red channels in a straightforward way. The 450k platform includes two different methylation assay designs, referred to as Infinium I and Infinium II, or type I and type II. Each methylation locus is interrogated by one of these designs. For a type I locus, the Meth and Unmeth signals are measured by two paired probes, with a given locus using either the red or green signal from these probes. Type II loci are assayed using a single probe, with Meth and Unmeth signals derived from the green and red channels, respectively. In addition to the methylation loci, the array contains a small number of control probes and 65 probes measuring common single-nucleotide polymorphisms (SNPs), intended for sample tracking. The reasoning behind using two different probe designs is simple, but illuminating for potential developers. Type II probes use only one probe per methylation locus and hence allow more loci on the array, at a fixed array size. However, owing to the chemistry used by the type II probe design, type II probes can only tolerate up to three CpGs within the 50-bp probe. The type I design tolerates more CpGs within the 50-bp probe, but assumes that all methylation loci in the probed sequence are in the same state, i.e. the probe measuring Meth assumes all CpGs within the probed sequence to be methylated, and the probe measuring Unmeth assumes all CpGs in the probed sequence are unmethylated. The ability to tolerate more CpGs in the probe allows type I probes to be used in regions of high CpG density, such as CpG islands (CGI). Until recently, studies of DNAm have focused largely on CGI. For example, the Illumina products that preceded the 450k included the widely used Infinium 27k array exclusively targeted CGI, primarily at gene promoters. However,, using a nonCGI-centric array design, referred to as comprehensive arrays for relative methylation (CHARM), demonstrated that greater variability is present in regions outside CGI and coined the term 'CGI shores' for regions within 2 kb of CGI. The 450k array design includes a set of regions identified as tissue-or cancer-specific using CHARM data, including CGIs and CGI shores, as well as probes in other regions, which Illumina refers to as shelf and open sea (). Here we present a software suite containing an assortment of new functionality for the analysis of this array, but also containing an infrastructure useful as a development platform for the research community. We note that Subset-quantile Within Array Normalization (SWAN) (), one of the first alternative preprocessing methods, was developed by another group using our infrastructure. Among the tools developed by our group, we specifically describe bump hunting () and block finding () capabilities. Although current data analyses for these arrays have relied on single probe analysis (), we have previously pointed out the advantages of borrowing strength across neighboring loci (). Furthermore, a recent finding related to cancer was the observation of large genomic [101000 kb] hypomethylated blocks (). We introduce an approach that permits the discovery of hypo-and hypermethylated blocks with 450k data. We illustrate the advantages of our software with publicly available data.
y
METHODS
AnnotationMeaningful analysis of 450k data depends on annotating probes with genomic location and their relationship to islands, genes and other genomic features. Although probe sequence is fixed as part of the array design, annotation can change for a number of reasons, such as a change of the human genome build. For this reason, our software package separates data from annotation and annotation from array design. By annotation we mean how methylation loci are associated with genomic locations and nearby features. By design we mean how probes on the array are matched with relevant color channels to produce the Meth and Unmeth signals. At the time of writing, the annotation information was stored in a separate Bioconductor () package IlluminaHumanMethylation450kanno.ilmn12.hg19, and the array design was stored in IlluminaHumanMethylation450kmanifest. The annotation package will change, but we will use careful version control such that any given analysis can be reproducible. We also maintain independence by defining two types of data classes for the experimental data: one stores data independently of annotation and the other includes genomic annotation. The two types of classes are distinguished by the presence or absence of the word Genomic in their class name as explained in detail in the next section.
Representing methylation data in RTo enable flexible development of preprocessing and analysis methods, we operate with a number of different representations of the array data through S4 classes (). Our software starts with .idat files, a binary format containing the raw red and green channel intensities. The 'RGChannelSet' class organizes these data into an object for whichGenomicRatioSet. This design provides a flexible framework for method development and analyses. The natural starting point for analysis is usually the GenomicRatioSet class. Note that although our software makes it particularly easy to import raw data from the primary .idat files, it is also possible to import processed data exported from GenomeStudio (Illumina's default software), which is often encountered in public data repositories. These data can also be conveniently stored in GenomicRatioSet objects.
Preprocessing/normalizationPreprocessing raw microarray intensities into usable methylation measurements is an important step in data analysis (). Several successful techniques have been developed for gene expression arrays, with quantile normalization being one of the most popular techniques (). Illumina developed a new procedure that did not take full advantage of these previous developments (our software includes preprocessIllumina: an implementation of this procedure that can be applied to RGChannelSets). Several groups have found that this procedure can be improved upon by borrowing ideas from normalization techniques developed for expression arrays (). However, quantile normalization was not used in part because these groups noticed that the empirical distributions of type I and type II were different (). We implemented a version of subset quantile normalization () that takes into account this characteristic. This normalization procedure is essentially similar to the one previously presented (), but has been independently reimplemented owing to the present lack of a released supported version. We apply our procedure to the Meth and Unmeth intensities separately. We force the distribution of type I and type II to be the same by first quantile normalizing the type II probes across samples and then interpolating a reference distribution to which we normalize the type I probes. Because probe types and probe regions are confounded () and we know that DNAm distributions vary across regions (), we stratify the probes by region before applying this interpolation. For the probes on the X and Y chromosomes, we normalize males and females separately. Sex is determined by the getSex function using copy number information. The stratified quantile normalization method is implemented by the preprocessQuantile function (the function does no background correction and removes zeros using the fixMethOutlier function). Note that this algorithm relies on the assumptions necessary for quantile normalization to be applicable and thus is not recommended for cases where global changes are expected, such as in cancernormal comparisons. We also note that whereas most currently available methods (e.g. Illumina, Beta MIxture Quantile dilation (BMIQ), SWAN) are within-array procedures, our stratified quantile normalization procedure involves both within-and between-sample normalization.
Quality assessmentQuality assessment is an important step in microarray analysis. Detecting and removing low-quality samples that normalization cannot correct has been shown to improve downstream results (). As larger datasets using the 450k array have become available, our ability to detect low-quality samples has improved. Our infrastructure permits the development of such statistical tools. We have found it useful to inspect the median of the Meth and Unmeth signals for each array. We demonstrate this feature in Section 3 using a publicly available dataset composed of 100 arrays hybridized to DNA from whole blood.
Annotating probes affected by genetic variationIt has been noted that the manufacturer's array design manifest contains incomplete annotation of SNPs at probed sites and that these polymorphisms may affect DNAm measurements (). Therefore, we have included a more comprehensive SNP annotation in minfi. We obtained all common SNPs from dbSNP137 (minor allele frequency41%) within each 450k probe and identified whether SNPs were at the single base extension site (position 0), at the proximal CpG on the probe (positions 12) or within the probe body (positions 350). Using this SNP annotation, which is available in the package, users can decide the stringency of probe filtering appropriate for their analysis. We have developed scripts for this purpose, which are included in minfi.
Bump huntingFrequently, the goal of a study involving DNAm profiling is to identify regions of contiguous CpGs associated with a phenotype of interest. For example, we may find a CGI showing higher methylation levels in cancer cells compared with normal controls. We have developed an approach for identifying and attaching statistical uncertainty to such regions. These methods are implemented in the bumphunter Bioconductor package. The minfi package interfaces seamlessly with bumphunter and provides a more robust method for detecting differentially methylated loci than the standard approach of analyzing each CpG individually (). Many of the loci on the 450k array are clustered into regions similar to those found on CHARM arrays, with 315 420 being locatedTherefore, we can apply the original bumphunter implementation as described in (). To do this, the bumphunter package includes the clusterMaker function, which, given a maximum gap between probes, groups them into clusters. We perform a probe-level regression and smooth the coefficient of interest within clusters to identify bumps along the genome. We demonstrate the advantages of identifying regions in Section 3.
Block findingBecause bump hunting focuses on methylation changes on the scale of gene promoters (12 kb), it is not designed to find long-range alterations such as the recently identified hypomethylated blocks (). Blocks have, to date, only been detected using whole-genome bisulfite sequencing because microarrays include only select regions of the genome. However, we have developed a method that uses 170 000 open sea probes on the 450 k to detect longrange changes in the methylation status. To do this, we first use the cpgCollapse function to group adjacent open sea loci into clusters with a default maximum gap of 500 bp and a maximum cluster width of 1500 bp (). The loci within each cluster are then averaged, resulting in a single mean estimate per cluster. The resulting cluster centers are then grouped into large regions () in which the bump hunting procedure is applied with a large (250 KB) smoothing window. In Section 3, we demonstrate that published hypomethylated blocks identified from whole-genome bisulfite sequencing data can be recovered with this approach. However, estimating the precise boundaries of these blocks is constrained by the resolution of the array.
RESULTS
Preprocessing/normalizationTo compare preprocessing algorithms, we hybridized the same liver DNA and the same placenta DNA to 58 plates, giving us 124 technical replicates (69 liver and 55 placenta, GEO GSE52731). We then preprocessed these data with Illumina's default method, SWAN (), BMIQ (), wateRmelon DASEN () and our implementation of stratified quantile normalization (preprocessQuantile) after dropping one low-quality liver sample. To assess precision, we computed the standard deviation across the technical replicates for each probe. Because of the known meanvariance relationship with these measurements, we also computed the average methylation across probes. We then computed a smoothed curve to summarize the scatterplot of standard deviations versus means for all probes (and Supplementary) and for probes stratified by region type (Supplementary). Most methods perform similarly, although our preprocessQuantile procedure and DASEN generally outperform other methods in terms of reducing variability among technical replicates. We also performed the analysis on the M-scale to confirm that results were similar (Supplementary Figs. S3 and S4). To confirm that these gains in precision were not due to reduced sensitivity, we compared the across-replicate average difference between liver and placenta (E). We also observed that our procedure makes type I and type II loci comparable (Supplementary).
Quality assessmentWe read and processed the raw data from 100 randomly selected individuals from a DNAm study of aging () such that men, women, Caucasians and Hispanics were equally represented. We processed these data with the Illumina default procedure. Principal component analysis and multidimensional scaling plots are useful for exploring distances between samples (). A multidimensional scaling plot of the methylation values reveals (not surprisingly) that sex is the biggest source of variability (). Note that our getSex function automatically classifies the samples into two groups. We compute the median for both Meth and Unmeth signals for each array and display these in a scatterplot (). This quality control measure clearly identifies two samples as outliers. Notice that 495% of the samples have median log (base 2) intensity values above 11.5. DNAm density plots () show that
SNPs influence probe behavior in small samplesFor the blood data described above, we selected eight 68-year-old individuals. Four of these were Caucasian and four Hispanic. We computed the difference in average methylation between the two ethnicities. Probes with SNPs showed larger differences (Supplementary). We then found the closest probe to each of these SNP-affected probes and removed any pair separated by 4500 bp or where both probes were SNP affected. We observed much larger differences at the SNP-affected probes than at the neighboring probes (Supplementary).
Bump hunting differentially methylated regions are more likely to be near a differentially expressed gene than CpGs identified by single probe analysisWe downloaded and preprocessed raw data from 17 normal colon and 19 normal lung TCGA samples. We used preprocessQuantile and normalized all samples together. Note that in this case, batch is confounded with tissue type. We identified differentially methylated loci using single probe analysis to identify differentially methylated positions (DMPs) () and bump hunting to identify differentially methylated regions (DMRs) (). To assess the biological relevance of the two sets of loci, we used the assumption that a subset of differentially expressed genes (DEGs) are epigenetically regulated and associated with changes in DNAm. Therefore, a candidate differentially methylated locus is more likely to be a functionally relevant true positive if it is in proximity to a DEG. We note that this evaluation only considers in cis; it does not assess changes in trans such as methylation changes over distant regulatory regions. In the absence of a dataset where the truth is known, this evaluation provides an objective measure for which we have an a priori expectation. We downloaded gene expression data from normal lung [n  20, Gene Expression Omnibus GSE31210 (and colon samples [n  54, GEO GSE20916 and GSE41328 (and preprocessed these with frozen robust multiarray analysis (). We associated genes with methylation loci located within 2 kb of the transcriptional start site. We found that genes located in proximity to hypermethylated DMRs had a larger decrease in expression level than genes located near loci identified through single probe analysis (). Further, using proximity to a DEG as one metric of functional relevance, we also assessed the fraction of differentially methylated loci located within 2 kb of a DEG transcriptional start site. We used a t-test to test for differential expression between the tissue types and classified probes with a nominal P50.05 and a fold-change 41.5 as differentially expressed. We found that regardless of the significance threshold used to identify differentially methylated loci, DEGs were consistently more likely to be located near DMRs than DMPs ().
Block finding with 450k can identify hypomethylation blocksTo assess the effectiveness of the block finding method in minfi, we compared blocks identified in colon cancer on the TCGA data (including the cancer samples that go with the normal samples described above) with those reported in (). Using default parameters (see Section 3 above), we identified 1540 hypomethylation blocks in colon cancer containing five or more collapsed CpG clusters (P50.01). Although the regions identified using minfi are based on completely independent colon normal and tumor samples, we found high agreement with methylation blocks identified). Specifically, 99.8% of the top 500 regions identified in the TCGA samples using minfi, sorted by area, overlap a block identified inby at least 1000 bp (). Note thatshows a gap in the inferred blocks caused by the lack of probes on the array.
DISCUSSIONWe have demonstrated several downstream advantages of using the minfi package. Several preprocessing algorithms are available and the infrastructure provides a convenient way for developers to easily implement their techniques as Bioconductor tools. In our experience, 510% of samples are of unusable quality, and visualization utilities provided by minfi permit users to identify these samples at the earliest stage of the analysis. By making SNP annotation available, users can choose to be cautious about probes that may behave unexpectedly due to the inclusion of a SNP in the probe sequence. We have demonstrated that DEGs are more likely to be located near DMRs than CpGs identified by single probe analysis. Existing methods for identifying DMRs typically use fixed-size or dynamic windows to group individually significant DMPs into regions (http://www2.cancer.ucl.ac. uk/medicalgenomics/champ/). Our software is unique in that it provides both bump hunting and block finding capabilities, and the assessment of statistical significance for the identified regions. Finally, because the package is implemented in Bioconductor, it gives users access to the countless analysis and visualization tools available in R.
A B
The Author 2014. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com
at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
M.J.Aryee et al. at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
Minfi at :: on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
