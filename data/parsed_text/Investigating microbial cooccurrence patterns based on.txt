Motivation: The high-throughput sequencing technologies have provided a powerful tool to study the microbial organisms living in various environments. Characterizing microbial interactions can give us insights into how they live and work together as a community. Metagonomic data are usually summarized in a compositional fashion due to varying sampling/sequencing depths from one sample to another. We study the co-occurrence patterns of microbial organisms using their relative abundance information. Analyzing compositional data using conventional correlation methods has been shown prone to bias that leads to artifactual correlations. Results: We propose a novel method, regularized estimation of the basis covariance based on com-positional data (REBACCA), to identify significant co-occurrence patterns by finding sparse solutions to a system with a deficient rank. To be specific, we construct the system using log ratios of count or proportion data and solve the system using the l 1-norm shrinkage method. Our comprehensive simulation studies show that REBACCA (i) achieves higher accuracy in general than the existing methods when a sparse condition is satisfied; (ii) controls the false positives at a pre-specified level, while other methods fail in various cases and (iii) runs considerably faster than the existing comparable method. REBACCA is also applied to several real metagenomic datasets.
IntroductionMicroorganisms coexist with highly diverse patterns in different environments. Studying the microbial inter-organism relationships may provide us important insights to the underlying properties of the ecosystem. It has been shown that symbiosis of microbes is responsible for important metabolic processes such as pesticide degradation (), biogeochemical cycling in seawater () and dental plague development (). With recent development of high-throughput sequencing technologies, metagenomic studies based on uncultivated microbial samples have allowed us to survey the compositions of microbial communities. Although numerous microbes have been identified, our understandings of the relationships among microbes have been much less fruitful. One of the reasons is that we lack of tools to analyze the correlation structure in metagenomic data due to its high dimensions and complex distributions. After annotating/binning of metagenomic sequencing data, the outputs are usually recorded as counts for downstream analysis. Because metagenomic samples usually cannot be collected at the same scale, after identifying the taxa or operational taxonomic units (OTUs) in a sample, the count of each OTU is usually then converted into relative abundance such as proportion or percentage bydividing its count by the total. This implies that the metagenomic relative abundance data follow a compositional fashion (). It is well known that applying conventional correlation coefficient methods on compositional data may lead to biased results (), although the compositional effect may be weaker on datasets with larger number of components (), such as the metagenomic compositional data. To take advantage of the existing statistical methods and also avoid producing spurious correlations, various types of data transformations have been applied in many compositional data studies. These transformations include the additive and centered log ratio transformation (), isometric log ratio transformation (). Chen and Li (2013) modeled the metagenomic data directly using Dirichlet-Multinomial distribution. Recently,studied the microbial ecological networks using the concept of conditional independence. These studies provide us tools to handle compositionality, however, using these tools to infer pair-wise correlations has been a challenge. Some computational techniques have been developed to mitigate the compositional effect. To evaluate the significance of Pearson correlation coefficient calculated based on compositional data,used a permutation-renormalization bootstrap method (ReBoot) to mitigate the compositional bias. Using simulation studies, we find that while ReBoot shows some improvement over the conventional method, its performance is not consistent and depends on data structure. By assuming unobserved basis abundance, SparCC was proposed to infer the pair-wise correlations of basis abundance rather than their proportions (). Basis abundance is defined as a positive unconstrained quantity which forms the composition. Although basis abundance is conceptual, it does not involve any relative information as opposed to relative abundance, and thus analysis based on it is free of the compositional bias. SparCC estimates correlations based on basis abundance but is not efficient due to its high computational complexity. Therefore, these methods have their limitations and have not been investigated thoroughly against compositional data with various types of structures. We propose a method, regularized estimation of the basis covariance based on compositional data (REBACCA), which estimates the correlations between pairs of basis abundance using the log ratio transformation of metagenomic count or proportion data. Estimating the basis covariance structure from compositional data is equivalent to solving a linear system with a deficient rank. Difference between REBACCA and SparCC can be summarized as: (i) we construct a linear system that is exactly equivalent to the log ratio transformations and (ii) we use the popular l 1-norm shrinkage method to solve the system under a sparsity assumption. Our simulation studies show that REBACCA achieves higher accuracy in general and has better asymptotic performance with large sample size as compared with other methods. Its performance is more consistent on datasets of various structures. It is also computationally efficient and can be used to analyze large-scale metagenomic data.
Materials and MethodsThe REBACCA scheme is designed to infer covariance structure of the basis abundance, given observed count or proportion data. To evaluate the method we perform simulation and real data analyses. The simulation process mimics the sampling procedure in obtaining real data from collecting to sequencing microbiome samples. The real metagenomic datasets are from, where microbial data are collected from three groups of mouse skin samples.
Regularized estimationof the basis covariance based on compositional data REBACCA assumes that the basis abundances of the microbes in a microbiome population are unknown, and the observed data are either counts or proportions of the taxa or OTUs contained in a metagenomic sample. REBACCA mainly consists of two parts. It first constructs a linear system using log ratios between pairs of compositions, and then utilizes l 1-norm penalty to solve the system, which is rank-deficient due to the log ratio transformation.
Estimating log basis covariance structureSuppose the unobserved basis abundances of D taxa x  x 1 ;. .. ; x D  are random variables and let   r ij   DD be the variance-covariance matrix of logx. For any two taxa, i and j, we have var log x i =x j      r ii  r jj  2r ij :As the basis abundances are unobserved we cannot estimate r ij directly. However, we can estimate var log x i =x j     using the observed count or proportion data. To avoid undefined log ratios, zero values in the data are replaced by a small value equal to 1/10 of the minimum of non-zero values. While our goal is to estimate  in (1), it is generally impossible to find a unique solution without knowing the structure of . Aitchison studied the independent case where  is of a diagonal structure (). Friedman and Alm (2012) introduced sparse assumption on  in SparCC, however they did not clearly specify the sparse structure of . Yet, SparCC estimates  by refining its solution recursively using a correlation threshold, which is computationally inefficient. Here, we develop a different framework to utilize the fast l 1-norm shrinkage method to estimate . We also discuss the sparse condition under which the estimation is accurate. We consider that the off-diagonal elements of  are unknown variables, and our goal is to identify and estimate the non-zero ones. We construct such a system as follows. Summing up (1) on both sides, we haveLet s x    P i6 j var log x i =x jd  1,. .. , D, and the corresponding variance-covariance matrix X d x    var y d  : It can be seen that s x    P d2f1; ... ;Dg traceX d x. Denote by x t the random variable x excluding the tth taxon. Then similarly we can define X d x t  for d 6  t and s x t    P d6 t traceX d x t . Based on equation (2), it can be shown by some calculation,where hz is the sum of the off-diagonal elements of a square matrix z and  t is the matrix  removing its tth row and tth column. Then combining (3) and (4) we can haveInvestigating microbial co-occurrence patternsSimilarly, choosing r 6  t, we can haveNote that the right hand side of equation (7) is a linear combination of off-diagonal elements of  whereas the left hand side can be estimated using log ratios of the observed data.v  Av:Since equation (7) is derived from the rank-deficient system based on (1), the linear system (9) has a rank ofwhere k is a tuning parameter controlling the amount of non-zero solutions in v. The penalized least-square method (10) is well-known as the LASSO (). Note that a rank-deficient system usually has infinite solutions, but we show that the system (9) has a unique solution under certain sparse condition (Supplementary file).
Accessing significanceSince the above penalized solution (10) does not give proper P-values for selected variables, to access the significance of the selection we use a stability resampling method (). This method controls the expected number of selected variables with low selection probability, or family wise errors (FWE), while achieving higher power than the original stability selection method (Meinshausen and B hlmann, 2010). The stability selection method derives a stability score s for each variable based on the frequency at which the variable is being selected over a number of times. To be specific, we randomly split samples into two datasets B times, apply LASSO independently on the 2B datasets, and then obtain each solution and calculate the ratio of average number of selected over the total variables q. To control the rate of FWE at a (i.e. given data of D taxa, the expected number of low selection probability variables being selected is DD1 2 a), we choose the minimum s a for selecting a variable based onwhere g is a function without explicit form but can be evaluated numerically.
AlgorithmREBACCA can be summarized into the following steps:(1) Input: count or proportion data X 2 R Dn for D taxa 1. Construct matrix A and compute w as in (9). 2. Compute LASSO path K for (10).(2) For k  1 to B do 1. Randomly split samples into two partscutoff s a to control for FWER at a based on (11). (4) Obtain estimation for  1. Obtain fr ij : s ij > s a g and solve (9) by the least-square fit with the remaining variables constrained to be zero. 2. Calculate diagonal elements of  according to equation (1).
Methods for generating compositional dataTo simulate a metagenomic compositional data set, we consider the count data are drawn with two steps. We first generate basis abundance and proportion for each taxon, and then generate count data given a sequencing size. To be specific, the first step is called 'basis sampling'. We assume that basis proportions vary from sample to sample, and they are generated from one of three different underlying distributions, namely, log ratio normal (LRN), Poisson log normal and Dirichlet log normal distributions (Supplementary file). The second step is called 'sequencing sampling'. Count data are drawn from a multinomial distribution using the proportions obtained from the first step and a given total number of reads (i.e. library size) as parameters. The second step of sampling reflects a random process that all sequences are equally likely to be selected in a microbial community sample.. In the second step, the count data are drawnfor each sample given a sequencing size of x   P D i1 x i .
Metagenomic datasetWe use a real metagenomic dataset from a previous study on mouse skin microbiota (). The dataset contains 131 core OTUs. We analyze their abundance data from 261 mouse skin samples, including 78 non-immunized and 183 immunized individuals (of which 64 developed epidermolysis bullosa acquisita or EBA, a skin blister disease). The most abundant phylum is Firmicutes (44 OTUs), accounting for 49% of abundance on average, followed by Proteobacteria (35 OTUs), Bacteroidetes (26), Actinobacteria (17), Cyanobacteria (4) and others (5).
Simulation studiesWe generate synthetic samples under different conditions. We compare results obtained from REBACCA with other three methods including the conventional correlation method [bootstrapping method (BP)], ReBoot () and SparCC (), in terms of their sensitivity and specificity. Results show that while REBACCA is highly efficient as compared with SparCC, it outperforms other methods with its high sensitivity as well as its control for false positives.
Simulation strategyTo evaluate REBACCA comprehensively, we consider that count data are generated from basis abundance with three cases of covariance structures (Supplementary). The three cases represent three different sparse network structures, such that Case 1 has a hierarchical structure, Case 2 has a group of four highly connected taxa and Case 3 is larger (20 taxa) than the first two cases (10 taxa for each case) and has three independent sub-network groups. Besides the three cases, we also simulate data for 100 taxa (see Section 3.3). However, we mainly focus on the small-scale synthetic data for two reasons. First, the issue of artifactual correlation tends to be more severe with smaller number of components (). Second, inaccuracy in estimating correlations can be due to low strength of signals or small magnitudes of correlations, which can obscure the results when dealing with artifactual correlation. In each of Case 1, 2 and 3, the magnitudes of correlations for the correlated pairs ranged from 0.3 to 0.6. Besides the structures of basis covariance, we also consider two types of distributions of counts over the taxa, such as whether all taxa are 'equal' or 'unequal' in terms of their mean basis abundances. In a real dataset, counts are usually not distributed evenly for different taxa, and as a consequence the effect of spurious correlations cannot be ignored even on datasets with large number of taxa (). In each of the six small-scale situations (3 covariance cases  2 mean types), we simulate different sizes of microbiome samples (n  50; 100; 200), with the total number of counts equal to 3000 per sample. Finally, to compare the results from different methods, we simulate each situation 100 times.
Results on small-scale studiesWe compare REBACCA with other three methods including the Spearman's correlation with BP, ReBoot and SparCC. All these methods assess significance of pair-wise correlations based on a resampling size of 100. For REBACCA, we use one minus stability score as the pseudo P-value. We obtain the receiver operating characteristic (ROC) curve based on the P-values of all pair-wise correlations for each simulation result, and summarize it with the area under the curve (AUC). In general, higher AUC indicates that the corresponding method has overall higher ratio of power over Type I errors. For the synthetic datasets generated using LRN method with a sample size of 100, the medians of AUC obtained by REBACCA are higher than all other methods in Case 1 and 3, whereas they are at least 0.875 in Case 2 (). SparCC and ReBoot have higher AUC than BP in Case 1 and 3, but lower in Case 2. It is possible that the accuracies of these methods depend on whether the estimated correlations are positive or negative, because there are more negative correlations in Case 2 than other two cases (Supplementary). We obtain the mean ROC curve separately for positive and negative correlations in Case 1, and we find that the accuracies of ReBoot and SparCC are comparable to REBACCA when identifying positive correlations but substantially lower when only considering the negative ones (Supplementary). BP has the lowest accuracy of all when identifying positive correlations. When calculating correlations between components with unequal proportions, conventional methods can lead to incorrect inference on their relationships (). We show thatgenerated using LRN method with 100 samples based on three cases of structures of basis covariance including 'Case 1' with a hierarchical structure, 'Case 2' consisting four inter-correlated taxa and mostly negative correlations and 'Case 3' with three clustered groups. Two types of mean basis abundance are used in simulation such that average basis abundance are 'equal' or 'unequal' for different OTUs. Four methods are compared including the conventional correlation measure with resampling (BP), ReBoot,SparCC and REBACCA Investigating microbial co-occurrence patternscorrelations measured by BP and ReBoot are not consistent between two types of mean basis abundance where counts are more evenly distributed over taxa in one than the other (). REBACCA performs consistently well on different types of mean distributions. Given larger sample size, REBACCA always yields higher AUC (Supplementary), while in Case 3 other three methods do not gain better accuracies when samples are more than 100. We also compare these methods based on their error controls. Given a pre-specified significance level of 0.05, only REBACCA controls false positives consistently at a rate <0.05 in all situations (). BP and ReBoot result in larger number of errors than targeted in all situations. SparCC controls errors well in Case 1 but fails when many negative correlations are present as in Case 2 or a large number of pairs (45) are correlated as in Case 3. Remarkably, REBACCA can identify correlated pairs while controlling the minimum false positive rates (FPR) lower than 0.005 in all situations (). In Case 1 and 3, it identifies correctly more than 70% correlated pairs with FPR <0.01. Other three methods can identify correlations only when FPR is allowed higher than 0.01 in most situations. The conclusions from these simulation studies are summarized as follows. First, REBACCA has higher accuracy in identifying correlated taxa in five of the six situations, while offering the best control of FPR (). Second, its estimated correlation structure converges to the true one provided larger number of samples (Supplementary). Third, it has the most consistent performance regardless of equal or unequal mean situations, and whether the estimated correlations are positive or negative. Fourth, note that although count data can be simulated through different schemes rather than LRN, we obtain similar results on datasets generated by other two methods (SupplementaryS5).
Results on large-scale studiesWe examine REBACCA and other methods on data generated with 100 OTUs and two covariance structures, which are based on a scale-free network model and a clustered network with three subnetworks (similar to Case 3). While the average AUC for REBACCA is only slightly higher than other methods for the scale-free network model, it is substantially higher in the clustered case (Supplementary). Remarkably, REBACCA gains higher AUC for the clustered network when sample size increases from 100 to 200 (with almost exact recovery at a sample size of 200), whereas other methods fail to achieve better accuracy. It is possible that the solutions by BP, ReBoot and SparCC depend on either mitigating the compositional bias or compensating the approximation rather than exact estimation of the correlation structure. The results for the scale-free and clustered models indicate that REBACCA is also promising when analyzing large datasets.
Analysis of mouse skin dataWe apply REBACCA to identify pair-wise correlations on a mouse skin data including three groups of individuals: groups of nonimmunized (Control), immunized-healthy (Healthy) and immunized-diseased (EBA) individuals. To assess the significance and control the error rate, we randomly split samples into two datasets, identify their non-zero basis covariance independently, and merge the results (Section 2). We do this 500 times, and thus the estimated covariance between a pair of OTUs is assigned with a stability score. Correlated pairs are identified based on stability scores with cutoffs of 0.954, 0.951 and 0.954 for the Control, Healthy and EBA groups, respectively. These cutoffs correspond to a FWER of 0.03, that is, the expected number of falsely identified correlated pairs is <255 out of 8515 possible pairs. Different cutoffs for stability scores are also chosen to verify our results.
Within-phylum correlations are more commonBased on the Control group, we identify 606 pair-wise correlations among the 131 core OTUs controlling the FWER at 0.03. The largest number of taxa correlated with a taxon is 40 (Supplementary), whereas on average a taxon correlates with 9.3 taxa. There are 416 positively correlated pairs and 190 negative ones. We first investigate whether our results support the finding from a previous study that phylogenetically related species are more likely to be co-occurred in their abundances, whereas the diverse species are more likely to be co-excluded (). We group the OTUs based on four major phyla (Firmicutes, Proteobacteria,Bacteroidetes and Actinobacteria), and compare the amount of associated OTUs within each phylum and between the phyla using the fraction of identified associations over the total number of possible pairs. Among the 122 OTUs from the major four phylum clades, there are 253 pairs of associations or 13% of all possible pairs within the same phylum (and), whereas there are 354 associations or 3% of all possible pairs between different phyla. Within each clade, there are much more positive associations than the negative ones, whereas between different clades the difference between number of positive and negative ones is not substantial (). Together the large proportion of OTU associations and the amount of positive ones within each phylum clade suggest that co-occurrence relationships are more common in closely related species than those are distantly related. We are also interested in whether the co-occurrence patterns indicate ecological relationships between bacteria species. A biofilm is usually formed by a group of interacting bacteria and can protect its members from hostile environments (), and thus it may exhibit co-existing relationships between the members. Biofilms formed by Staphylococcus species on skins have been known for multidrug resistance (), and biofilms formed by Corynebacterium species can potentially cause infections (). Our result shows that among top 61 ($10%) strongest positively correlated pairs of OTUs, 38 are pairs between Staphylococcus species and 6 are between Corynebacterium species. Another interesting relationship is that Staphylococcus aureus and Enterococcus faecalis are positively correlated ($0.34), reflecting the fact that the former species can secrete a sex pheromone specific to the latter one and thus promoting the reproduction of E. faecalis (). To compare our result with the correlated OTUs identified by SparCC (), we choose the significance level at 0.003 for SparCC, so that we obtain a comparable number of correlated pairs (608 as compared with 606 by our method). Under SparCC, there are 369 positively correlated pairs and 239 negative ones. Notably, there are only 91 ($25%) positive correlated pairs identified by SparCC that are considered uncorrelated by REBACCA, whereas 133 ($56%) negative ones do not agree with the result from REBACCA (Supplementary). This may be due to the lower accuracy of estimation by SparCC on negative correlations than the positive ones (Supplementary). Nevertheless, SparCC agrees with REBACCA on that co-occurrence relationships are more common within the same phylum than between phyla (Supplementary Table S3).
Correlation patterns are more similar between two types of immunized samplesWe investigate whether the correlation patterns among the 131 OTUs are different depending on the three types of samples, namely, Control, Healthy and EBA. We compare correlated pairs that are identified independently from the three datasets, and we consider that a correlated pair of OTUs is consistent between two datasets if the pair has the same signs of correlations in both datasets. We find that correlations from the non-immunized individuals are much less consistent with other two immunized groups than between the two groups (). Although there are 532 consistent pairs between the two immunized groups, there are only 236 consistent pairs between the Control and Healthy and 212 between the Control and EBA groups (). The similarity of the correlation patterns between two immunized groups indicates a common change in skin microbiota due to immunization. A network consisting of positive correlations among 12 Bacteroidia of phylum Bacteroidetes and 6 Clostridia of Firmicutes is found in both immunized groups whereas absent in the Control group (). Bacteroidia and Clostridia are anaerobic bacteria known for their antibiotic resistance (). Positive correlations among these bacteria may promote their survivals and cause polymicrobial infections to their host (). Although the number of identified correlations depends on the choice of the FWER control, it is worth noting that regardless using more or less stringent choices (FWER  0.01, 0.03 and 0.05), the patterns of dominant positive within-phylum correlations and the presence of inter-phyla correlation patterns exclusively in the immunized individuals are consistent on all these results (Supplementary Figs S8 and S9). The pattern of positive correlations among the Bacteroidetes and Clostridia is also observed in the results obtained by SparCC (Supplementary), although the correlations in the two immunized groups are weaker than those estimated by REBACCA.
DiscussionWe propose a method to study pair-wise microbial relationships for metagenomic data. Applying conventional measures directly on proportion data can lead to incorrect inference on the pair-wise relationship due to spurious correlation. By assuming the underlying basis abundance, REBACCA infers pair-wise relationships of basis abundance and thus is free of compositional bias. In general, it provides higher power on identifying correlated pairs than other existing methods while controlling false positives. Another major advantage of REBACCA as compared with SparCC is the computational efficiency. SparCC solves the system (2) relying on recursively refining its solution by identifying strong correlations, and its computing time and accuracy depends on the number of strongly correlated pairs. The computing time for REBACCA does not depend on the complexity of the data and is nearly independent of the size of samples. For the mouse skinControl dataset, running SparCC with 1000 bootstraps on a cluster of 20 cores of Intel Westmere X5650 processors (2.66 GHz, 4 GB memory per core) requires more than 10.5 h, whereas running REBACCA with B  500 (equivalent to 1000 bootstraps) on the same cluster takes only about 30 min. A fast implementation of SparCC reduces the computing time (). Nevertheless, both the original and improved version of SparCC require setting a maximum number of recursions (the default is 10), which can reduce their computing time but also lower their accuracy when there are quite a few strong correlations between OTUs such as the clustered cases (and Supplementary). We show that the rank-deficient system (9) is identifiable or can be solved exactly, provided a sparse condition that each taxon correlates with less than a quarter of the total number of taxa (Supplementary file). In the case where a component is positively correlated with all other components with the same magnitude, none of these correlations can be identified no matter how large the sample size is. However, based on our experiments, if some correlations are positive and some are negative, REBACCA can find the exact solution despite that the sparse condition is violated. Above all, the sparse condition is derived from an ideal, noise-free case, and thus in reality, even if the sparse condition is satisfied, there still can be an issue of identifiability for the system in (9). This is because that given small sample size, correlation can be substantially influenced by uncertainties. The noise and identifiability issues may be the main reason that we obtain lower AUC for REBACCA in Case 2 than other two cases (). Nevertheless, it should be noted that the sparse condition applies to the model in (9), which is equivalent to (2) and thus the condition should also apply to SparCC. In the high-dimensional setting of a real metagenomic dataset, the sparse condition should usually hold, because bacterial interaction network is highly sparse (). Although it is possible to solve the system (2) with some regularization such as constraining the diagonal elements of  to be positive, the error distribution in the linear system is unlikely to be normal and thus further transformation may be required. TheThere are significantly more correlated pairs consistent between the immunized groups than other comparisons construction of the linear system in (9) is not unique; however, the system constructed by equation (7) is optimal because the right hand side of (7) contains information of all variables, and the homogeneity assumption of error variance is satisfied if the distributions for upper diagonal variables in  are exchangeable. Calculation of P-values in high-dimensional variable selection methods is an open problem. Stability selection offers a way to control for FWER using a sample-splitting resampling method (Meinshausen and B hlmann, 2010), however, based on our experiments we find that this method is too conservative for the mouse skin data. Instead, we use the modified stability selection method proposed by Shah and Samworth (2013). This method has much better power while also controlling for FWER. Change of bacteria abundance in mouse skin microbiota is linked to the cause of skin disease (). We show that the microbial correlation patterns in immunized samples are different from the non-immunized ones. The difference highlights the response of a group of Bacteroidetes and Clostridia to immunization (). These species have been reported associated with anaerobic infections. Further analysis of the difference of bacterial correlations between the healthy and diseased groups may reveal the link between microbial factors and disease susceptibility.
FundingThis work was supported by National Science Foundation
at University of California, Los Angeles on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
Y.Ban et al. at University of California, Los Angeles on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from
