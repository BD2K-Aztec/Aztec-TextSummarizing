
<?xml version="1.0" encoding="UTF-8"?>
<TEI xmlns="http://www.tei-c.org/ns/1.0" 
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
xsi:schemaLocation="http://www.tei-c.org/ns/1.0 /home/joey/Project/grobid/grobid-home/schemas/xsd/Grobid.xsd"
 xmlns:xlink="http://www.w3.org/1999/xlink">
	<teiHeader xml:lang="en">
		<encodingDesc>
			<appInfo>
				<application version="0.4.2-SNAPSHOT" ident="GROBID" when="2017-08-10T23:46+0000">
					<ref target="https://github.com/kermitt2/grobid">GROBID - A machine learning software for extracting information from scholarly documents</ref>
				</application>
			</appInfo>
		</encodingDesc>
		<fileDesc>
			<titleStmt>
				<title level="a" type="main">Error filtering, pair assembly and error correction for next-generation sequencing reads</title>
			</titleStmt>
			<publicationStmt>
				<publisher/>
				<availability status="unknown"><licence/></availability>
			</publicationStmt>
			<sourceDesc>
				<biblStruct>
					<analytic>
						<author>
							<persName>
								<forename type="first">Robert</forename>
								<forename type="middle">C</forename>
								<surname>Edgar</surname>
							</persName>
							<affiliation key="aff0">
								<address>
									<postCode>94920</postCode>
									<settlement>Tiburon</settlement>
									<region>CA</region>
									<country key="US">USA</country>
								</address>
							</affiliation>
						</author>
						<author>
							<persName>
								<forename type="first">Henrik</forename>
								<surname>Flyvbjerg</surname>
							</persName>
							<affiliation key="aff1">
								<orgName type="department">Department of Micro-and Nanotechnology</orgName>
								<orgName type="institution">Technical University of Denmark</orgName>
								<address>
									<postCode>DK-2800</postCode>
									<settlement>Lyngby</settlement>
									<country key="DK">Denmark</country>
								</address>
							</affiliation>
						</author>
						<title level="a" type="main">Error filtering, pair assembly and error correction for next-generation sequencing reads</title>
					</analytic>
					<monogr>
						<imprint>
							<date/>
						</imprint>
					</monogr>
					<idno type="DOI">10.1093/bioinformatics/btv401</idno>
					<note type="submission">Received on March 26, 2015; revised on May 28, 2015; accepted on June 27, 2015</note>
					<note>Sequence analysis *To whom correspondence should be addressed. Associate Editor: Inanc Birol Supplementary information: Supplementary data are available at Bioinformatics online.</note>
				</biblStruct>
			</sourceDesc>
		</fileDesc>
		<profileDesc>
			<abstract>
				<p>Motivation: Next-generation sequencing produces vast amounts of data with errors that are difficult to distinguish from true biological variation when coverage is low. Results: We demonstrate large reductions in error frequencies, especially for high-error-rate reads, by three independent means: (i) filtering reads according to their expected number of errors, (ii) assembling overlapping read pairs and (iii) for amplicon reads, by exploiting unique sequence abundances to perform error correction. We also show that most published paired read assemblers calculate incorrect posterior quality scores. Availability and implementation: These methods are implemented in the USEARCH package. Binaries are freely available at http://drive5.com/usearch.
			</abstract>
		</profileDesc>
	</teiHeader>
	<text xml:lang="en">
		<body>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="1">Introduction</head><p>Next-generation sequencing (NGS) machines produce reads of lengths tens to thousands of bases. In an NGS read, the base call at position i is assigned an estimated error probability p i represented as an integer-rounded Phred (quality) score Q i ¼ –10 log 10 p i. Typical base call error rates for current machines range from 0.1 to 10% (<ref type="bibr" target="#b5">Glenn, 2011</ref>). When coverage is high, error detection and correction can be achieved by aligning reads to each other (de novo assembly) or to a closely related well-known sequence (reference-based assembly). When coverage is low or a complete set of reference sequences is not available, sequencing error is difficult to distinguish from true biological variation. Errors can be reduced by quality filtering, i.e. by discarding or truncating reads with low-quality base calls, by merging overlapping paired-end reads and, in the case of amplicon reads, by clustering. Quality filtering is often used in data analysis of next-generation reads but is rarely regarded as a method in its own right which should be designed and validated as a separate step. Published methods for quality filtering typically use ad-hoc criteria such as imposing a maximum on the number of bases with less than a given Q score (<ref type="bibr" target="#b0">Bokulich et al., 2013</ref>). That article focuses on filtering but does not attempt to measure error rates. Other articles describing analysis pipelines for amplicon reads (e.g.<ref type="bibr">Kozich et al., 2013;</ref><ref type="bibr" target="#b19">Schloss et al., 2011</ref>) report the mean error rate but do not consider the tail of the error distribution, which we believe to be important due to the spurious clusters and consequent inflated estimates of diversity (spurious 'rare biosphere') obtained when the tail is not adequately controlled (<ref type="bibr" target="#b7">Huse et al., 2010</ref>). When paired-end reads overlap, an improved prediction of the sequence in the overlapping region can be obtained by aligning the forward and reverse read. Previously published paired-read mergers include SHERA (<ref type="bibr" target="#b18">Rodrigue et al., 2010</ref>), FLASH (<ref type="bibr" target="#b12">Magoč and Salzberg, 2011</ref>), PANDAseq (<ref type="bibr" target="#b13">Masella et al., 2012</ref>), COPE (<ref type="bibr" target="#b11">Liu et al., 2012</ref>) and PEAR (<ref type="bibr" target="#b21">Zhang et al., 2014</ref>). Of these, only PANDAseq included quality filtering in addition to merging. Error correction methods for amplicon pyrosequencing reads include PyroNoise (<ref type="bibr" target="#b14">Quince et al., 2009</ref>), AmpliconNoise (<ref type="bibr" target="#b15">Quince et al., 2011</ref>) and an unnamed method (<ref type="bibr" target="#b16">Reeder and Knight, 2010</ref>) that uses a greedy algorithm based on an abundance sort. These methods all require flowgrams and therefore cannot be applied to other technologies such as Illumina. Single-linkage pre-clustering (<ref type="bibr" target="#b7">Huse et al., 2010</ref>) and the pre-clustering method of (<ref type="bibr">Kozich et</ref>2013) also use abundance differences between closely related sequences to correct errors. In this work, we use the expected number of errors in a read as a measure of quality for filtering and show that this method is effective at reducing error rates, especially in the tail of the distribution. We show how to calculate the posterior quality scores when read pairs are merged and demonstrate that most previous merging methods calculate incorrect scores. We also describe and validate UNOISE, a new amplicon error-correction method which can be applied to any type of NGS read.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="2">Methods</head></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="2.1">Quality filtering</head><p>Filtering is commonly used in amplicon sequencing applications such as marker gene metagenomics (<ref type="bibr" target="#b3">Edgar, 2013</ref>) and immune system repertoire analysis (<ref type="bibr" target="#b8">Jiang et al., 2013</ref>) where it is generally not possible to identify reads derived from the same template sequence, ruling out error detection and correction by assembling contigs as typically done in genome sequencing.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="2.2">Expected errors</head><p>For a given read, the expected number of errors (E) is defined to be the mean number of errors that would be observed in a very large collection of sequences where the error rate at each position is given by its quality score, assuming that errors at different positions occur independently. We prove below that E is the sum of error probabilities:</p><formula>E ¼ X i p i ¼ X i 10 –Qi=10 : (1)</formula><p>E is a real rather than integer value and may be less than 1. We will also show that the most probable number of errors is well approximated by floor(E), i.e. the largest integer E. A natural approach to quality filtering is to impose a maximum value E max on the expected number of errors so that reads with high E (low quality) are discarded. Motivated by the goal of suppressing reads with larger numbers of errors, we could also consider setting a threshold on the probability P þ (kjp 1. .. p L ) that a read of length L has at least k errors. For example, 97% is a commonly used identity threshold in marker gene sequencing (<ref type="bibr" target="#b7">Huse et al., 2010</ref>), and we might therefore wish to discard reads which have a relatively high probability of having !3% errors. It turns out (proof below) that a P þ filter is equivalent to an E max filter to a good approximation. The threshold E max ¼ 1 is a natural choice as the most probable number of errors is zero when E &lt; 1, and we therefore used E max ¼ 1 for the tests reported here.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="2.3">Proofs</head><p>For an informal, intuitive proof that E is the sum of error probabilities, consider a large collection of M reads, all having the same set of Q scores. Let K i be the total number of errors found at position i. Then by definition p i ¼ K i /M and hence K i ¼ M p i. The total number of errors K in all positions is:</p><formula>K ¼ R i K i ¼ R i Mp i and</formula><p>in the limit of very large M the expected number of errors (E) is, by definition, the mean over the collection:</p><formula>E ¼ K=M ¼ ð1=MÞ X i ðMP i Þ¼ X i p i :</formula><formula>(2)</formula><p>For a more formal analysis, we obtain the probability of exactly k errors by summing over all possible ways of distributing k errors into L positions, i.e. over all combinations of k positions selected from L. The probability of a given combination occurring is the product of the probabilities for each position, i.e. p i for an error or (1 – p i ) for a correct call. This gives the so-called Poisson binomial distribution (<ref type="bibr" target="#b20">Wang, 1993</ref>):</p><formula>B Pois ðk; p 1; ... p L Þ ¼ X 1 k1¼0 X 1 k2¼0 Á Á Á X 1 kL¼0 d k; P L i¼1 ki Y L j¼1 p kj j ð1 À p j Þ 1Àkj :</formula><formula>(3)</formula><p>Here, k i is zero or one, giving the number of errors at position i. The Kronecker delta</p><formula>d k; P L i¼1 ki</formula><p>is zero unless k equals the sum of k i , in which case it is one. By summing over the possible number of errors, which ranges from 0 to L, and rearranging the sums in Equation (3), we again find that the expected number of errors is the sum of error probabilities:</p><formula>hki ¼ X L k¼0 kB Pois ðk; p 1. .. p L Þ ¼ X 1 k1¼0 X 1 k2¼0 Á Á Á X 1 kL¼0 X L i¼1 k i ! Y L j¼1 p kj j ð1 À p j Þ 1Àkj ¼ X L i¼1 X 1 ki¼0 k i p ki i ð1 À p i Þ 1Àki ¼ X L i¼1 p i :</formula><formula>(4)</formula><p>We consider the regime E ( L to cover all cases of practical interest. A theorem due to<ref type="bibr" target="#b10">Le Cam (1960)</ref>states that in this limit the Poisson binomial distribution is well approximated by the simpler and more familiar Poisson distribution with parameter E:</p><formula>B Pois ðk; p 1 ;. .. p L Þ ! Poisðk; EÞ ¼ e ÀE E k k! for X L i¼1 p 2 i ! 0: (5)</formula><p>The Poisson distribution satisfies the following relation:</p><formula>Poisðk; EÞ Poisðk À 1; EÞ ¼ E k : (6)</formula><p>It follows from Equation (6) that as long as k &lt; E, Pois(k; E) increases with k, and it decreases with k for k &gt; E. Thus, Pois(k; E) has its maximal value as function of k at floor(E) (i.e. the largest integer E), and floor(E) is therefore the most probable number of errors when E ( L. It follows from Equation (5) that when E ( L, the probability B Poiss (k) that k errors occur is a function only of E and k, and P þ (k) ¼ P j ! k P(j) is therefore also a function of E and k. A filter which applies a threshold to P þ (k) is therefore equivalent to an E max filter. The equivalent value of E max can be calculated from k and the threshold value of P þ using Equation (5).</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="2.4">Posterior error probability for a merged base call</head><p>The most probable correct base call and posterior error probability for an aligned pair of bases is calculated as follows. Define p x and p y</p><p>Error filtering, pair assembly and error correction for NGS readsto be the error probabilities and X and Y to be the letters in the forward and reverse reads, respectively. The five possible outcomes are: both base calls correct (C), forward correct and reverse wrong (F), forward wrong and reverse correct (R), both wrong and disagree (W) and both wrong and agree (G). The prior probabilities of these outcomes are as follows:</p><formula>PðCÞ ¼ ð1–p x Þð1–p y Þ; PðFÞ ¼ ð1–p x Þp y ; PðRÞ ¼ p x ð1–p y Þ; PðWÞ ¼ 2p x p y =3;</formula><p>PðGÞ ¼ p x p y =3:</p><formula>(7)</formula><p>(For proofs see Supplementary Equations S8–S12 and<ref type="figure">Fig. S1.</ref>) We observe that the base calls agree (A, i.e. a match) or disagree (D, i.e. a mismatch). Agreement is C or G, disagreement is F, R or W. Note that P(A) ¼ P(C) þ P(G), P(D) ¼ P(F) þ P(R) þ P(W), P(AjC) ¼ 1, P(AjG) ¼ 1. By Bayes' theorem,</p><formula>PðGjAÞ ¼ PðAjGÞPðGÞ=PðAÞ ¼ PðGÞ=PðAÞ ¼ PðGÞ= PðCÞ þ PðGÞ ¼ ðp x p y =3Þ=ð1–p x –p y þ 4p x p y =3Þ:</formula><formula>(8)</formula><p>(Proof: see Supplementary Equation S21 and<ref type="figure">Fig. S2</ref>). P(GjA) is the probability that X is incorrect given agreement between the two base calls, i.e. the posterior error probability for a matched position in the alignment. For the case where we observe a disagreement (mismatch), we use the convention that p x &lt; p y, so that the merged base call is X. By similar reasoning, the mismatch error probability is</p><formula>(9)</formula><p>(Proof: see Supplementary Equation S26 and<ref type="figure">Fig. S3</ref>).</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="2.5">Incorrect PANDAseq posterior calculation</head><p>Let X and Y be calls of unrelated bases with true bases X* and Y* and error probabilities p x and p y , respectively. Suppose the predicted bases are the same in the two calls, i.e. X ¼ Y, and the true bases are also identical (X* ¼ Y*). This happens if (i) both base calls are correct or (ii) both calls are incorrect and the true letters are identical, hence</p><formula>PðX Ã ¼ Y Ã jX ¼ YÞ ¼ ð1–p x Þð1–p y Þ þ p x p y =3: (10)</formula><p>(Proof: see Supplementary Equation S28 and<ref type="figure">Fig. S5</ref>). Similarly, if the true bases are the same but the predicted bases are different, the cases are (i) X is correct and Y is wrong while the true base is the same or (ii) Y is correct and X is wrong while the true base is the same or (iii) both calls are wrong but the true bases are the same, so</p><formula>PðX Ã ¼ Y Ã jX 6 ¼ YÞ ¼ ð1–p x Þp y =3 þ ð1–p x Þp y =3 þ 2p x p y =9: (11)</formula><p>(Proof: see Supplementary Equation S29 and<ref type="figure">Fig. S7</ref>). PANDAseq calculates posterior Q scores using error probability p ¼ 1 – P(X* ¼ Y*) using Equation (10) for a match and Equation (11) for a mismatch. This is incorrect. P(X* ¼ Y*jX ¼ Y) is not the probability that the base calls are correct if a match is observed; rather, it is the probability that the true bases are the same, which includes the error case X* ¼ Y* and X ¼ Y and X = X*. Also, those equations are derived assuming that the bases are independent of each other, but in fact X and Y in the overlapping segment of a paired read are observations of the same base. Therefore, P(X* ¼ Y*) ¼ 1 when merging, regardless of whether a match or mismatch is observed. The typical effect of the calculation made by PANDAseq is to reduce Q scores at positions where the base calls in the forward and reverse reads match, when in fact scores should increase to reflect that two independent observations of the same base agree on the prediction (<ref type="figure">Fig. 1</ref>, Supplementary Equation S22). Thus, the quality of a high-quality pair decreases after merging by PANDAseq when in fact it should increase. This will degrade the effectiveness of quality filters and SNP callers that assume quality scores are predictive of error frequencies.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="2.6">UNOISE algorithm for amplicon error correction</head><p>When amplified libraries are sequenced, reads derived from a given biological template can be visualized as an 'error cloud' surrounding the correct sequence. An amplicon may contain polymerase chain reaction (PCR) errors including point errors and chimeras (<ref type="bibr" target="#b6">Haas et al., 2011</ref>), producing a 'daughter cloud' connected to the correct biological sequence (<ref type="figure">Fig. 2</ref>). Thus, if a sequence B has a small number of differences (d) compared with a more abundant sequence R, this may be because B has d errors and is derived from the same amplicon as R, and R is probably the correct sequence of that amplicon. This observation has previously been exploited to attempt error correction. For example, the preclustering step of (<ref type="bibr">Kozich et al., 2013</ref>) uses d ¼ 1%. However, it is the small minority of outliers in the tail of the error distribution that are responsible for inducing spurious operational taxonomic units (OTUs) obtained by clustering the reads and thus inflating estimates of diversity (<ref type="bibr" target="#b3">Edgar, 2013</ref>). These outliers (call them 'harmful') will not be corrected if d is less than the OTU threshold. If errors occur at random, then almost all of the harmful outliers will be singletons, and discarding singletons have been shown to be an effective filter (<ref type="bibr" target="#b3">Edgar, 2013</ref>). Here, we introduce a new denoising algorithm (UNOISE) which allows larger d if the abundance skew, defined as w ¼ abundance(R)/abundance(B) (<ref type="bibr" target="#b4">Edgar et al., 2011</ref>), is sufficiently large. UNOISE was implemented as a variant of UCLUST (Edgar, 2010) as follows. A database of putatively correct sequences (D) is initially empty. Unique read sequences are compared with D of decreasing abundance. If a read (B) matches a database sequence (R), i.e. if d d max and w ! w min , then the abundance of R is<ref type="figure">Fig. 1</ref>. Paired read merging. The forward read is aligned to the reverse-complemented reverse read. If both reads agree on a base call, the Q score increases due to the increased confidence in the base call per Equation (8). If there is a mismatch, the base call with higher Q is chosen and the posterior Q score is reduced according to<ref type="bibr">Equation (9)</ref>increased by that of B, and B is discarded; otherwise, B is added to D. For this work, we chose d max ¼ 5 and w min ¼ 10. These were our first guess at intuitively reasonable and conservative values; we did not try other values because we do not believe valid parameter tuning is possible on the available data. To tune parameters, we need data for which correct sequences are known, i.e. reads of clones or a mock community. However, we expect the biological sequences in such data to be less diverse and more widely separated in sequence space (i.e. to have more differences with their closest neighbors) compared with samples collected in vivo. On mock data, an optimal value of d max will tend to be large because this will include more sequences with larger numbers of errors in the inferred cloud without including the nearest true sequence. In contrast, in reads of in vivo samples, we expect nearest neighbors with correct sequences to be closer. Thus, larger values of d max would increase the number of false positives because neighbors that are correct biological sequences with low abundance would be misidentified as having errors. By the same reasoning, we expect tuning of w min on mock data to favor small values, which would again increase the number of false positives with in vivo data.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="3">Results</head></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="3.1">Test data</head><p>For testing, we used three sets of overlapping paired reads and named them MOCK1, MOCK2 and PHIX, respectively. MOCK1 contains amplicon reads of the V4–V5 region of the 16S rRNA gene in the artificial ('mock') community samples in run 130403 of<ref type="bibr">Kozich et al. (2013)</ref>. MOCK2 contains amplicon reads of the V4 region of the 16S gene from (<ref type="bibr" target="#b0">Bokulich et al., 2013</ref>). The MOCK1 and MOCK2 reads were filtered by UCHIME (<ref type="bibr" target="#b4">Edgar et al., 2011</ref>) to suppress reads of chimeric amplicons, which require specialized detection algorithms. PHIX is a subset of reads containing PhiX bacteriophage sequences in the data of<ref type="bibr" target="#b17">Reveillaud et al. (2014)</ref>. Reads of the PhiX spike-in library were identified as hits to the PhiX genome sequence (GenBank accession NC_001422.1) with at least 90% identity covering at least 90% of the read. These reads have no bases with Q &lt; 12, suggesting that quality filtering using this threshold was performed prior to posting. We would have preferred to use unfiltered reads but were unable to identify a published, unfiltered dataset containing PhiX spike-in reads. MOCK1 and MOCK2 appear to contain unfiltered reads.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="3.2">Tested methods</head><p>We implemented our own methods in USEARCH (<ref type="bibr" target="#b2">Edgar, 2010</ref>) and compared quality filtering and merging with two popular software packages, QIIME (<ref type="bibr" target="#b1">Caporaso et al., 2010</ref>) and PANDAseq. We also validated the posterior Q score calculations of COPE, FLASH, PEAR and SHERA. At the time this work was performed, QIIME did not support merging and we therefore tested its filtering script on paired reads after merging by USEARCH. See Supplementary Material for software versions and command lines. We also tested using the forward reads alone, simulating an experiment where paired reads are not available or do not overlap.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="3.3">Measurement of error rates</head><p>We measured errors by aligning reads (or merged read sequences) to the appropriate reference sequences, i.e. the PhiX genome and the known 16S sequences in the mock communities. We used global alignments to ensure that all bases in the read were included and considered mismatches to be errors. We calculated the mean error rate after filtering as the number of mismatches divided by the number of bases. We also considered the tail of the distribution, which is especially important in marker gene sequencing experiments where reads with high error rates induce spurious clusters and inflate estimates of diversity, even if present only in very low abundance (<ref type="bibr" target="#b3">Edgar, 2013</ref>). We considered &gt;3% errors to be the tail as a 3% clustering threshold is conventionally used in marker gene sequencing (<ref type="bibr" target="#b2">Edgar, 2010;</ref><ref type="bibr">Kozich et al., 2013</ref>) in which case a read with &gt;3% errors is certain to induce a spurious cluster, noting that reads with fewer errors may also do this. Results are summarized in Tables 1 and 2.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="3.4">Correlation of measured and expected errors</head><p>Figure 3a and b shows that E is predictive of the number of measured errors in the MOCK1 forward and reverse reads, respectively. These results show that E tends to be an underestimate on MOCK1; for example, the median number of measured errors for reads with 4.5 E &lt; 5.5 is 18. We obtained similar results on the PHIX reads, and with MOCK2, we observed a correlation where E tends to overestimate rather than underestimate the number of errors (Supplementary<ref type="figure">Fig. S10</ref>). This reflects that the accuracy and biases of Q scores may vary between sequencing runs.<ref type="figure" target="#tab_1">Table 1</ref>summarizes results obtained by QIIME, PANDAseq and USEARCH on the test datasets, showing that merging by USEARCH followed by filtering with E max ¼ 1 achieves a dramatic reduction in the number of reads with &gt;3% errors compared with QIIME and PANDAseq. UNOISE achieves a further substantial improvement in the number of reads with zero errors in the case of amplicon reads.<ref type="figure">Figure 3b</ref>and c shows the head (&lt;3% errors) and tail (&gt;3% errors) of the measured error distribution after pairedread merging and filtering of the MOCK1 reads. We obtained similar results for MOCK2 and PHIX (Supplementary<ref type="figure">Fig. S2</ref>).</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="3.5">Error rates after merging and filtering</head></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="3.6">Posterior Q scores</head><p>With the exception of PANDAseq, the equations used to calculate posterior Q scores by the tested read mergers are not specified in their publications. We therefore reverse engineered the calculation by generating sets of simulated read pairs of length 150 nt with<ref type="figure">Fig. 2</ref>. Conceptual structure of the 'error cloud' due to a given biological template sequence R. Circles represent unique read sequences, the size of a circle indicates its abundance (i.e. frequency in the reads). Errors are due to amplification (polymerase chain reaction<ref type="bibr">[PCR]</ref>point errors and chimeras) and sequencing. With typical error rates, most incorrect sequences are singletons with a single difference; a few have more differences (indicated by tick marks). C is an amplicon containing a PCR error, e.g. a chimera. Amplicons with PCR errors have 'daughter' clouds due to sequencing error. In the tail of the distribution, reads are &gt;3% diverged from R (black circles) 50 bp overlaps having exactly one mismatch. The sets were generated such that all pair-wise combinations of Q occur with both matches and mismatches. The merged reads from each program were used to construct tables giving the posterior Q for all possible combinations of forward Q, reverse Q and agreement (match or mismatch). Of the tested programs, only SHERA correctly calculated the posterior Q scores in the aligned region. It was readily apparent from the tables that FLASH and PEAR use simple heuristics: FLASH takes the maximum Q score at a position with a match and the difference Q max –Q min at a position with a mismatch, while PEAR uses the sum of the Q scores at a position with a match and the minimum at a position with a mismatch. We were unable to deduce the rules used by COPE, noting that source code is not provided, contrary to the paper's statement that the software is open source. However, it is clear from the reverse-engineered tables that the posterior Q scores generated by COPE are sometimes badly wrong (Supplementary<ref type="figure" target="#tab_1">Table S1</ref>).</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="3.7">PANDAseq false-positive merges</head><p>We noticed that PANDAseq sometimes merged read pairs that did not overlap, i.e. generated false-positives merges. To investigate this systematically, we generated simulated read pairs containing unrelated random sequences with all Q scores set to 20 (p correct ¼ 0.99). PANDAseq merged 74% of these pairs with implied overlap lengths ranging from 2 to 26 bases. The other tested mergers generated no false positives on this dataset.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="3.8">PANDAseq quality filtering</head><p>PANDAseq implements quality filtering by setting a minimum value for the geometric mean (t) of the posterior probabilities p i correct ¼ 1 – p i that the base calls are correct. The default value of the threshold is t ¼ 0.6, corresponding to p ¼ 0.4 or Q ¼ 4. The motivation for this measure of quality is not stated by the authors and was not clear to us, and we also noted that a threshold of p ¼ 0.4 would allow many errors in low-quality reads. We therefore asked whether using a more stringent t threshold could achieve comparable filtering performance to E max ¼ 1. To answer this, we tuned t to retain as close as possible to the same number of reads as USEARCH with E max ¼ 1. On all three datasets, PANDAseq with the tuned threshold produced fewer reads with zero and one errors and more reads with two or more errors than USEARCH, showing that E max is a superior measure of quality (Supplementary<ref type="figure">Fig. S3</ref>).</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="4">Discussion</head><p>We introduced the expected number of errors as measure of read quality. We showed that imposing a maximum value on expected errors is an effective quality filter. We showed that most current paired read mergers do not correctly calculate the posterior quality scores and that PANDAseq will align unrelated random pairs, potentially causing a high rate of false-positive merges in biological data. We suggest that measurements of Q score accuracy and the correlation of E with the true error rate should be a standard step in anyFwd indicates forward reads only. Method is one of raw reads (no processing), UNOISE, QIIME/F (QIIME quality filtering only), merged (merge by USEARCH only, no filtering), USEARCH/F (USEARCH filtering by E max ¼ 1), USEARCH/MF (USEARCH merge and filtering by E max ¼ 1), PANDAseq (merging and filtering with default parameters) and QIIME/MF (QIIME quality filtering of reads merged by USEARCH). Reads is the number of reads after any merging and/or filtering. Err. rate is the number of measured errors divided by the total number of bases and &gt;3% errs. gives the number of reads with at least 3% measured errors. UNOISE assumes amplicon data, so is not applicable to PHIX.Reads that were predicted to be chimeric by UCHIME were discarded prior to this analysis (because chimera detection is a specialized task, and chimeras account for a large majority of the unique amplicon sequences, obscuring the underlying biological diversity). The reads contain 21 species, plus a few contaminants (Edgar, 2013). Ab. is minimum abundance (1 ¼ all reads, 2 ¼ singletons discarded), Den. is n (no denoising) or Y (UNOISE), Reads is the number of reads after processing, Uniques is number of unique read sequences after processing and OTUs is the number of clusters at 97% identity (made by running UCLUST on the unique sequences sorted by decreasing abundance). next-generation read analysis where Q scores are used, especially when coverage is low. This will enable informed setting of parameters such as the E max threshold. With Illumina amplicon sequencing, a control sample such as a mock community would be ideal, but the additional cost and effort may be prohibitive. However, a PhiX spike-in is often added to amplicon libraries before Illumina sequencing (<ref type="bibr">Kozich et al., 2013</ref>), and our results here show that PhiX reads can function as an informative control sample for Q score analysis. We suggest the default value E max ¼ 1 as a filtering threshold as the most probable number of errors is zero for the filtered reads. More or less stringent thresholds may be appropriate to correct for biases in the Q scores or to make trade-offs between sensitivity and error rate in downstream analysis. We believe that these methods will enable improved accuracy of biological inferences in a broad range of NGS experiments. Conflict of Interest: none declared.</p></div><figure xmlns="http://www.tei-c.org/ns/1.0" type="table" xml:id="tab_0" validated="false"><figDesc>al., V C The Author 2015. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com 3476 Bioinformatics, 31(21), 2015, 3476–3482 doi: 10.1093/bioinformatics/btv401 Advance Access Publication Date: 2 July 2015 Original Paper</figDesc><table></table></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" type="table" xml:id="tab_1" validated="true"><figDesc>Table 1. Summary of results on the test datasets</figDesc><table>Dataset 
Method 
Err. rate (%) Reads 
&gt;3% errs. 

MOCK1 (Fwd) Raw reads 
1.2 
737 660 
79 481 
QIIME/F 
0.99 
737 134 
70 319 
USEARCH/F 
0.22 
392 917 
2687 
UNOISE 
0.092 
611 176 
1042 
MOCK1 
Merged 
2.4 
737 660 196 035 
QIIME/MF 
2.0 
737 102 165 642 
PANDAseq 
1.9 
717 064 157 797 
USEARCH/MF 
0.23 
186 695 
562 
UNOISE 
0.046 
354 220 
491 
MOCK2 (Fwd) Raw reads 
0.54 
7 420 628 237 274 
QIIME/F 
0.33 
7 033 106 
73 228 
USEARCH/F 
0.19 
2 912 861 
401 
UNOISE 
0.009 
6 565 970 
251 
MOCK2 
Merged 
0.35 
7 420 628 144 584 
PANDAseq 
0.34 
7 393 489 138 297 
QIIME/MF 
0.33 
7 352 181 126 909 
USEARCH/MF 
0.19 
6 736 514 
1609 
UNOISE 
0.016 
7 017 279 
1226 
PHIX (Fwd) 
Raw reads 
0.25 
1 201 502 
8179 
QIIME/F 
0.68 
1 201 435 
8179 
USEARCH/MF 
0.20 
1 044 123 
3945 
PHIX 
Merged 
0.22 
1 094 091 
4681 
QIIME/MF 
0.22 
1 094 091 
4681 
PANDAseq 
0.22 
1 139 895 
4375 
USEARCH/MF 
0.17 
983 832 
550 

</table></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" type="table" xml:id="tab_2" validated="true"><figDesc>Table 2. Results of merging, filtering, discarding singletons and denoising on the MOCK2 dataset</figDesc><table>Pairs? 
Filter 
Ab. Den. Reads 
Uniques 
OTUs 

Fwd only (No) 
1 
n 
7 420 628 1 414 383 378 537 
Y 
7 420 628 
439 597 
52 452 
2 
n 
6 158 319 
152 086 
203 
Y 
6 158 319 
5055 
66 
E max ¼ 1 1 
n 
2 912 861 
147 539 
110 
Y 
2 912 861 
141 
35 
2 
n 
2 803 435 
38 113 
29 
Y 
2 803 435 
51 
18 

Merged 
(No) 
1 
n 
7 371 922 
888 089 177 972 
Y 
7 371 922 
278 196 
5939 
2 
N 
6 592 326 
108 493 
110 
Y 
6 592 326 
1688 
42 
E max ¼ 1 1 
N 
6 728 314 
410 712 
75 
Y 
6 728 314 
22 443 
39 
2 
N 
6 407 439 
89 837 
534 
Y 
6 407 439 
619 
159 

</table></figure>

			<note place="foot">at University of California, Los Angeles on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from</note>

			<note place="foot">R.C.Edgar and H.Flyvbjerg at University of California, Los Angeles on August 30, 2016 http://bioinformatics.oxfordjournals.org/ Downloaded from</note>
		</body>
		<back>
			<div type="references">

				<listBibl>

<biblStruct   xml:id="b0">
	<analytic>
		<title level="a" type="main">Quality-filtering vastly improves diversity estimates from Illumina amplicon sequencing</title>
		<author>
			<persName>
				<forename type="first">N</forename>
				<forename type="middle">A</forename>
				<surname>Bokulich</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Nat. Methods</title>
		<imprint>
			<biblScope unit="volume">10</biblScope>
			<biblScope unit="page" from="57" to="59" />
			<date type="published" when="2013" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b1">
	<analytic>
		<title level="a" type="main">QIIME allows analysis of high-throughput community sequencing data</title>
		<author>
			<persName>
				<forename type="first">J</forename>
				<forename type="middle">G</forename>
				<surname>Caporaso</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Nat. Methods</title>
		<imprint>
			<biblScope unit="volume">7</biblScope>
			<biblScope unit="page" from="335" to="336" />
			<date type="published" when="2010" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b2">
	<analytic>
		<title level="a" type="main">Search and clustering orders of magnitude faster than BLAST</title>
		<author>
			<persName>
				<forename type="first">R</forename>
				<forename type="middle">C</forename>
				<surname>Edgar</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Bioinformatics</title>
		<imprint>
			<biblScope unit="volume">26</biblScope>
			<biblScope unit="page" from="2460" to="2461" />
			<date type="published" when="2010" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b3">
	<analytic>
		<title level="a" type="main">UPARSE: highly accurate OTU sequences from microbial amplicon reads</title>
		<author>
			<persName>
				<forename type="first">R</forename>
				<forename type="middle">C</forename>
				<surname>Edgar</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Nat. Methods</title>
		<imprint>
			<biblScope unit="volume">10</biblScope>
			<biblScope unit="page" from="996" to="998" />
			<date type="published" when="2013" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b4">
	<analytic>
		<title level="a" type="main">UCHIME improves sensitivity and speed of chimera detection</title>
		<author>
			<persName>
				<forename type="first">R</forename>
				<forename type="middle">C</forename>
				<surname>Edgar</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Bioinformatics</title>
		<imprint>
			<biblScope unit="volume">27</biblScope>
			<biblScope unit="page" from="2194" to="2200" />
			<date type="published" when="2011" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b5">
	<analytic>
		<title level="a" type="main">Field guide to next-generation DNA sequencers</title>
		<author>
			<persName>
				<forename type="first">T</forename>
				<forename type="middle">C</forename>
				<surname>Glenn</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Mol. Ecol. Resour</title>
		<imprint>
			<biblScope unit="volume">11</biblScope>
			<biblScope unit="page" from="759" to="769" />
			<date type="published" when="2011" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b6">
	<analytic>
		<title level="a" type="main">Chimeric 16S rRNA sequence formation and detection in Sanger and 454-pyrosequenced PCR amplicons</title>
		<author>
			<persName>
				<forename type="first">B</forename>
				<surname>Haas</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Genome Res</title>
		<imprint>
			<biblScope unit="page" from="494" to="504" />
			<date type="published" when="2011" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b7">
	<analytic>
		<title level="a" type="main">Ironing out the wrinkles in the rare biosphere through improved OTU clustering</title>
		<author>
			<persName>
				<forename type="first">S</forename>
				<forename type="middle">M</forename>
				<surname>Huse</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Environ. Microbiol</title>
		<imprint>
			<biblScope unit="volume">12</biblScope>
			<biblScope unit="page" from="1889" to="1898" />
			<date type="published" when="2010" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b8">
	<analytic>
		<title level="a" type="main">Lineage structure of the human antibody repertoire in response to influenza vaccination</title>
		<author>
			<persName>
				<forename type="first">N</forename>
				<surname>Jiang</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Sci. Transl. Med</title>
		<imprint>
			<biblScope unit="volume">5</biblScope>
			<biblScope unit="page" from="171" to="190" />
			<date type="published" when="2013" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b9">
	<analytic>
		<title level="a" type="main">and (b) show the correlation between E and measured errors before filtering in the forward and reverse reads respectively. E is rounded to integers and binned so that, e.g. the bin for E ¼ 2 contains reads with 1.5 E &lt; 2.5. For each bin, the top and bottom of the box indicates the upper and lower quartile, respectively, and the line inside the box indicates the median value. The upper and lower whiskers indicate the maximum and minimum measured errors, respectively. In all cases, the maximum value is &gt;25 and is probably explained by a read that is a polymerase chain reaction (PCR) artifact, such as an unfiltered chimera, with true number of sequencing errors much less than 25. The upper histograms in panels (a) and (b) show the numbers of reads falling into each E bin. This shows that the reverse reads have more reads with lower quality, as is typically seen with Illumina sequencing. However, the correlation seen in the box/whisker plots appear similar between the forward and reverse reads, suggesting that the Q score accuracy is comparable. These results show that E tends to underestimate the number of errors for larger values of E. The histograms in panels (c) and (d) report the distribution after merging and filtering of the observed numbers of errors per read in the head (&lt;3% errors) and tail (&gt;3% errors), respectively, showing that E max ¼ 1 allows most reads with no errors and a majority of reads with one error, and further dramatically reduces the frequency of reads in the tail compared with QIIME and PANDAseq Kozich</title>
		<author>
			<persName>
				<forename type="first">Mock2</forename>
			</persName>
		</author>
		<author>
			<persName>
				<forename type="first">Phix</forename>
				<surname>See</surname>
			</persName>
		</author>
		<author>
			<persName>
				<forename type="first">Supplementary</forename>
				<surname>Figures</surname>
			</persName>
		</author>
		<author>
			<persName>
				<forename type="first">S9</forename>
			</persName>
		</author>
		<author>
			<persName>
				<forename type="first">S10</forename>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="m">Fig. 3. Results on the MOCK1 datasetindex sequencing strategy and curation pipeline for analyzing amplicon sequence data on the MiSeq illumina sequencing platform</title>
		<imprint>
			<date type="published" when="2013" />
			<biblScope unit="page" from="5112" to="5120" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b10">
	<analytic>
		<title level="a" type="main">An approximation theorem for the Poisson binomial distribution</title>
		<author>
			<persName>
				<forename type="first">Le</forename>
				<surname>Cam</surname>
			</persName>
		</author>
		<author>
			<persName>
				<forename type="first">L</forename>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Pacific J. Math</title>
		<imprint>
			<biblScope unit="volume">10</biblScope>
			<biblScope unit="page" from="1181" to="1197" />
			<date type="published" when="1960" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b11">
	<analytic>
		<title level="a" type="main">COPE: An accurate k-mer-based pair-end reads connection tool to facilitate genome assembly</title>
		<author>
			<persName>
				<forename type="first">B</forename>
				<surname>Liu</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Bioinformatics</title>
		<imprint>
			<biblScope unit="volume">28</biblScope>
			<biblScope unit="page" from="2870" to="2874" />
			<date type="published" when="2012" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b12">
	<analytic>
		<title level="a" type="main">FLASH: fast length adjustment of short reads to improve genome assemblies</title>
		<author>
			<persName>
				<forename type="first">T</forename>
				<surname>Magoč</surname>
			</persName>
		</author>
		<author>
			<persName>
				<forename type="first">S</forename>
				<forename type="middle">L</forename>
				<surname>Salzberg</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Bioinformatics</title>
		<imprint>
			<biblScope unit="volume">27</biblScope>
			<biblScope unit="page" from="2957" to="2963" />
			<date type="published" when="2011" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b13">
	<analytic>
		<title level="a" type="main">PANDAseq: paired-end assembler for illumina sequences</title>
		<author>
			<persName>
				<forename type="first">A</forename>
				<forename type="middle">P</forename>
				<surname>Masella</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">BMC Bioinformatics</title>
		<imprint>
			<biblScope unit="volume">13</biblScope>
			<biblScope unit="page">31</biblScope>
			<date type="published" when="2012" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b14">
	<analytic>
		<title level="a" type="main">Accurate determination of microbial diversity from 454 pyrosequencing data</title>
		<author>
			<persName>
				<forename type="first">C</forename>
				<surname>Quince</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Nat. Methods</title>
		<imprint>
			<biblScope unit="volume">6</biblScope>
			<biblScope unit="page" from="639" to="641" />
			<date type="published" when="2009" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b15">
	<analytic>
		<title level="a" type="main">Removing noise from pyrosequenced amplicons</title>
		<author>
			<persName>
				<forename type="first">C</forename>
				<surname>Quince</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">BMC Bioinformatics</title>
		<imprint>
			<biblScope unit="volume">12</biblScope>
			<biblScope unit="page">38</biblScope>
			<date type="published" when="2011" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b16">
	<analytic>
		<title level="a" type="main">Rapidly denoising pyrosequencing amplicon reads by exploiting rank-abundance distributions</title>
		<author>
			<persName>
				<forename type="first">J</forename>
				<surname>Reeder</surname>
			</persName>
		</author>
		<author>
			<persName>
				<forename type="first">R</forename>
				<surname>Knight</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Nat. Methods</title>
		<imprint>
			<biblScope unit="volume">7</biblScope>
			<biblScope unit="page" from="668" to="669" />
			<date type="published" when="2010" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b17">
	<analytic>
		<title level="a" type="main">Host-specificity among abundant and rare taxa in the sponge microbiome</title>
		<author>
			<persName>
				<forename type="first">J</forename>
				<surname>Reveillaud</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">ISME J</title>
		<imprint>
			<biblScope unit="volume">8</biblScope>
			<biblScope unit="page" from="1198" to="1209" />
			<date type="published" when="2014" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b18">
	<analytic>
		<title level="a" type="main">Unlocking short read sequencing for metagenomics</title>
		<author>
			<persName>
				<forename type="first">S</forename>
				<surname>Rodrigue</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">PLoS One</title>
		<imprint>
			<biblScope unit="volume">5</biblScope>
			<date type="published" when="2010" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b19">
	<analytic>
		<title level="a" type="main">Reducing the effects of PCR amplification and sequencing artifacts on 16S rRNA-based studies</title>
		<author>
			<persName>
				<forename type="first">P</forename>
				<forename type="middle">D</forename>
				<surname>Schloss</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">PLoS One</title>
		<imprint>
			<biblScope unit="volume">6</biblScope>
			<date type="published" when="2011" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b20">
	<analytic>
		<title level="a" type="main">On the number of successes in independent trials</title>
		<author>
			<persName>
				<forename type="first">Y</forename>
				<forename type="middle">H</forename>
				<surname>Wang</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Stat. Sin</title>
		<imprint>
			<biblScope unit="volume">3</biblScope>
			<biblScope unit="page" from="295" to="312" />
			<date type="published" when="1993" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct   xml:id="b21">
	<analytic>
		<title level="a" type="main">PEAR: a fast and accurate Illumina paired-end read merger</title>
		<author>
			<persName>
				<forename type="first">J</forename>
				<surname>Zhang</surname>
			</persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Bioinformatics</title>
		<imprint>
			<biblScope unit="volume">30</biblScope>
			<biblScope unit="page" from="614" to="620" />
			<date type="published" when="2014" />
		</imprint>
	</monogr>
</biblStruct>

				</listBibl>
			</div>
		</back>
	</text>
</TEI>