Motivation: Flux variability analysis (FVA) is an important tool to further analyse the results obtained by flux balance analysis (FBA) on genome-scale metabolic networks. For many constraint-based models, FVA identifies unboundedness of the optimal flux space. This reveals that optimal flux solutions with net flux through internal biochemical loops are feasible, which violates the second law of thermodynamics. Such unbounded fluxes may be eliminated by extending FVA with thermodynamic constraints. Results: We present a new algorithm for efficient flux variability (and flux balance) analysis with thermodynamic constraints, suitable for analysing genome-scale metabolic networks. We first show that FBA with thermodynamic constraints is NP-hard. Then we derive a theoretical tractability result, which can be applied to metabolic networks in practice. We use this result to develop a new constraint programming algorithm Fast-tFVA for fast FVA with thermodynamic constraints (tFVA). Computational comparisons with previous methods demonstrate the efficiency of the new method. For tFVA, a speed-up of factor 30–300 is achieved. In an analysis of genome-scale metabolic networks in the BioModels database, we found that in 485 of 716 networks, additional irreversible or fixed reactions could be detected. Availability and implementation: Fast-tFVA is written in Cþþ and published under GPL. It uses the open source software SCIP and libSBML. There also exists a Matlab interface for easy integration into Matlab. Fast-tFVA is available from page.mi.fu-berlin.de/ arnem/fast-tfva.html.
INTRODUCTIONFlux Balance Analysis (FBA) is a widely used method to analyse the capabilities of a metabolic network (). The strength of FBA is that it allows predicting growth rates of cells accurately (). FBA is based on the steady-state assumption, i.e. every metabolite that is produced, must also be consumed at the same rate. Flux through the network is enabled by exchange reactions, such as uptake of nutrients and production of biomass. Usually, next to bounds on the fluxes, stoichiometric constraints are the only constraints given, and optimal production of biomass can be computed by solving a linear program (LP). Frequently, there is not only one optimal flux distribution that achieves optimal biomass production. FBA, however, computes only one such solution. Elementary flux modes () or extreme pathways () are commonly used tools to analyse the whole flux space. But, in practice, the number of elementary flux modes grows exponentially with the number of reactions in the network. Hence, enumeration of elementary flux modes becomes infeasible for genome-scale networks. In addition, we are usually not interested in the raw data of all elementary flux modes (resp. extreme pathways), but only in specific properties (). Therefore, sampling methods (), elementary flux patterns () and flux variability analysis (FVA) () have been developed. FVA determines the maximum and minimum values of all the fluxes that will satisfy the constraints and allow for the same optimal objective value. For example, it is known that FBA is unreliable in predicting the flux value of by-products (). In such cases, FVA can be applied to predict the range of possible by-product production rates under maximal biomass production, which can be linked to gene expression data (). Variations of FVA can also be used to determine blocked or unessential reactions (). In FVA, however, the following problem arises: It can happen that the network contains internal cycles, i.e. there exist non-zero steady-state fluxes involving only internal reactions. In most metabolic models, only bounds on the flux value of exchange reactions are given (in addition to the zero bounds for the irreversible reactions). This leads to unbounded fluxes through reactions contained in such internal cycles, which is of course not realistic. To remove this issue, a general form of thermodynamic constraints can be added to the model *To whom correspondence should be addressed.  The Author 2013. Published by Oxford University Press. All rights reserved. For Permissions, please e-mail: journals.permissions@oup.com (), extending the standard non-negativity constraints for thermodynamic irreversibility of individual reactions. It has been shown that the flux values computed with thermodynamic constraints are more consistent, for example, with respect to gene expression data (). In recent years, there has been increasing interest in thermodynamic constraints, as they can also be used to link metabolite concentrations to flux modes (). In this article, we present a new method for efficient thermodynamically constrained FBA and FVA. We will work with the relaxed form of thermodynamic constraints, as it was introduced by. There, thermodynamic constraints are formulated as follows:SJ  0 steady-state assumption 1 ' J u flux bounds, e:g: irrev: 2  i J i 50 _ J i  0 8i 2 I thermodynamic constraint 3Here S denotes the stoichiometric matrix, J the flux vector, M the set of metabolites, R the set of all reactions, E the set of exchange reactions, I  R n E the set of internal reactions and the chemical potential of each metabolite (Gibbs free energy of formation). The operator  T denotes transposition. If the concentrations and equilibrium constants are known (), it is possible to further constrain. However, because this information is often not available, we will work here without additional constraints on. In a thermodynamically constrained flux balance problem, we maximize a linear objective function c T J, where c 2 R R , with respect to the constraints (1)(4). In thermodynamically constrained flux variability analysis (tFVA), we analyse the flux variability within the feasible (respectively optimal) solutions of a thermodynamically constrained flux balance problem, i.e. for all i 2 R, we solve the optimization problems maxfAEJ i j14g (respectively maxfAEJ i j14, c T J  optg). To simplify notation, we do not only use reactions as indices (e.g. J i to denote flux through reaction i) but also sets of reactions to index sub-vectors. For example, J I denotes the flux vector on the internal reactions only and S I contains only the columns corresponding to internal reactions. DEFINITION 1 (Thermodynamically Feasible Flux). A flux vector J is called thermodynamically feasible if there exists a vector such that (1), (3) and (4) are satisfied. If additionally (2) holds, J will be called a thermodynamically feasible flux that satisfies bounds ' and u. By multiplying T from the left side with S I , the potential differences for internal reactions are obtained. This is equivalent to the often found formulation K  0, where K is the null-space matrix of S I. The motivation behind Equation (3) is that normally a chemical reaction carries flux if and only if it reduces Gibbs free energy (). Since many reactions are catalysed by enzymes, however, it can happen that an enzyme is not present, for example because of regulatory control and hence, the corresponding reaction is not possible and does not carry flux, even if there is a negative potential difference. Thus, zero flux in Equation (3) is always allowed as well. Note that other formulations of thermodynamic constraints, for example the one used by, do not have this property. Hence, the different results have to be applied with care. Using Boolean variables a 2 f0, 1g I , a sufficiently large constant M40 and a small constant "40, this formulation can be translated into a mixed integer linear program (MILP), where a i  0 indicates that a forward flux J i 40 on reaction i is not allowed, and a i  1 forbids a backward flux J i 50. This is done by replacing (3) with the inequalities (5) and (6):This formulation is used in a similar form byfor the COBRA toolbox and many others (). It can be shown that if S does not contain any zero-columns, this MILP formulation is equivalent to the original one (). Although solving MILPs is NP-hard in general, practical tests have shown that current MILP solvers are able to optimize flux with respect to the above formulation also on genome-scale networks like the iAF1260 reconstruction of Escherichia coli ().observed that a steady-state flux vector J [i.e. which satisfies] is thermodynamically feasible if and only if there is no internal cycle contained by J. A sketch of the proof using oriented matroids can be found in (). A detailed version using LP-duality is available in Muler (2012) and was also recently published by. This result is used byto detect reactions that are irreversible due to thermodynamic constraints. In particular, one of their methods simply runs tFVA. This article is organized as follows: In Section 2.1, we show that the thermodynamically constrained flux balance problem is NP-complete, and thus, MILP is an appropriate tool. In Section 2.2, we derive a tractability result and analyse how much this applies to current genome-scale models. These theoretical results are the backbone of a new algorithm, which is described in Section 3. In Section 4, we apply our new method to study the importance of thermodynamic constraints in the analysis of genome-scale metabolic networks.
DISCUSSION
CONCLUSIONWe presented a new algorithm for thermodynamically constrained FVA. Compared with previous implementations, an enormous speed-up was obtained. tFVA can now be performed for a large number of networks and as a subroutine for other methods. As shown in our experiments, many network reconstructions, in particular also well-curated models, may be improved by executing our algorithm.FVA was performed on the whole flux space and on the subspace of the fluxes with optimal biomass production rate. The COBRA implementation used the Gurobi solver. The COBRA method sometimes failed to produce a solution, because Gurobi returned infeasible for problems that are actually feasible.Opt. fixed and Opt. irrev. denote the number of additionally fixed, resp. irreversible, reactions in the space of fluxes with optimal biomass production.