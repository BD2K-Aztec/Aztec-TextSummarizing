Motivation: Functional enrichment testing facilitates the interpretation of Chromatin immunoprecipitation followed by high-throughput sequencing (ChIP-seq) data in terms of pathways and other biological contexts. Previous methods developed and used to test for key gene sets affected in ChIP-seq experiments treat peaks as points, and are based on the number of peaks associated with a gene or a binary score for each gene. These approaches work well for transcription factors, but histone modifications often occur over broad domains, and across multiple genes. Results: To incorporate the unique properties of broad domains into functional enrichment testing, we developed Broad-Enrich, a method that uses the proportion of each genes locus covered by a peak. We show that our method has a well-calibrated false-positive rate, performing well with ChIP-seq data having broad domains compared with alternative approaches. We illustrate Broad-Enrich with 55 ENCODE ChIP-seq datasets using different methods to define gene loci. Broad-Enrich can also be applied to other datasets consisting of broad gen-omic domains such as copy number variations. Availability and implementation: http://broad-enrich.med.umich.edu for Web version and R package.
INTRODUCTIONChromatin immunoprecipitation followed by high-throughput sequencing (ChIP-seq) identifies transcription factor (TF) binding sites and the locations of histone modifications (HMs) across the genome (), and is a step toward better understanding the gene regulatory programs of living organisms. Numerous algorithms, termed peak callers, have been developed to detect the genomic regions of significant signal (peaks) within the millions of aligned reads resulting from ChIP-seq experiments (). Some of these peak callers are geared specifically to HMs, which are known to exhibit broader enriched domains on average compared with TFs (). HMs are numerous and varied, and like TFs, often drive the regulation of a specific biological program, such as cellular differentiation () or growth (). Specific signatures often occur at HM intersections, such as the bivalent domains observed for H3K4me3 and H3K27me3, which mark genes expected to be activated on cellular differentiation (). Other histone changes occur in disease progression () or in response to environmental signals (). Such signatures are likely often cell-type and context specific, and therefore, assessing the biological commonalities among the targeted genes is a question of intense interest. Gene set enrichment (GSE) is a common approach to infer biological function given a set of experimentally derived genes (). GSE was originally developed to biologically interpret lists of differentially expressed genes derived from microarray studies () in terms of particular biological functions, processes or pathways [e.g. Gene Ontology (GO) () or KEGG Pathways (. An early enrichment tool is DAVID (), which uses a slightly modified Fisher's exact test (FET) to determine whether experimentally derived genes significantly overlap a gene set representing a biological concept, relative to the remaining genes. Under the null hypothesis of no more overlap than expected by chance, FET assumes that each gene has the same probability of being detected as significant. In the context of GSE with ChIP-seq data, FET assumes that each gene has an equal probability of being associated with a peak. Although FET has been used with ChIP-seq data (), it is typically used only with peaks within or near gene promoters. When all peaks are used, the presence of a peak in a gene locus is often correlated with the length of the locus (), thereby violating the FET assumption. We refer to this correlation as the locus length bias. Given that some gene sets contain genes that have, overall, significantly longer (e.g. nervous system, development and transcription related) or shorter locus length (e.g. metabolic processes and stimulus responses) than the average locus length, the possibility of confounding exists when no correction is made for locus length (). Using FET with only peaks near gene promoters removes nearly all of the length bias, but also ignores a large portion of the data. Recent GSE tools for ChIP-seq experiments have attempted to correct for this length bias. One such tool, Genomic Regions Enrichment of Annotations Tool (GREAT), uses a binomialbased test to test whether the total number of peaks within the loci in a gene set is greater than expected relative to the total number of peaks, the total locus length of the gene set and the non-gapped length of the genome (). In contrast to FET, the binomial test of GREAT assumes that the number of peaks in a locus and the locus length are proportional. Thus, FET and the binomial test have opposing assumptions regarding the relationship between the presence of a peak in a *To whom correspondence should be addressed.  The Author 2014. Published by Oxford University Press. This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (http://creativecommons.org/licenses/by-nc/3.0/), which permits non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited. For commercial re-use, please contact journals.permissions@oup.com genomic region and the length of that region. Although FET is typically used after classifying each gene as either (i) having at least one associated peak or (ii) having no peak, the binomial test uses the total number of peaks. Both methods typically use a single nucleotide point, the midpoint or mode of the peak, to represent the entire peak region. We examined 100 TF and 55 HM ChIP-seq experiments from ENCODE (ENCODE Project) for differences between peak sets from transcription factor-and histonebased ChIP-seq experiments. HM peak sets have been observed to have broader peak regions than TFs, with individual peaks often spanning multiple genes (). We hypothesized that an enrichment method using such relevant regulatory information rather than simply the midpoint of each peak, as both FET and the binomial test do, would improve performance for HMs and other experiments resulting in broad domains. To incorporate the properties of broad-domain peak sets into functional enrichment testing, we developed Broad-Enrich to functionally interpret large sets of broad genomic regions. A unique feature of our method is that we score gene loci according to the proportion of the locus covered by all peaks overlapping the locus, which we will refer to as the coverage proportion. BroadEnrich then uses a logistic regression model that empirically adjusts for any bias in gene locus coverage relative to locus length, avoiding the pitfalls of either FET or binomial-based tests. We show that Broad-Enrich exhibits the correct type I error rate across 55 permuted ENCODE ChIP-seq datasets. We then illustrate the benefits of Broad-Enrich across the same set of 55 datasets, concentrating on H3K4me1,-2 and-3, H3K9me3, H3K27me3 and H3K79me2 in the GM12878 cell line.
DISCUSSIONFunctional enrichment testing leverages our collective biological knowledge together with high-throughput genomic technologies in a statistical framework to functionally interpret new biological data. Unique properties observed in ChIP-seq data for HMs have led to the use of specialized peak-calling algorithms. These properties, combined with the bias observed in gene loci coverage relative to locus length, present challenges to existing functional enrichment methods. We have developed Broad-Enrich to address these issues in functionally interpreting large sets of broad genomic regions. Our approach uses the proportion of a gene locus covered by all peaks overlapping the locus, and a correction accounting for the locus length in a logistic regression model with gene set membership as the outcome. Inflated type I error rates result in an overabundance of falsepositive results, while well-calibrated type I error rates result in accurately reported FDRs. We demonstrate that Broad-Enrich has a well-calibrated type I error rate across 55 HM ChIP-seq datasets representing a wide variety of technical and biological characteristics. In contrast, the binomial-based test consistently exhibits inflated type I error, while FET has the correct type I error for only 16 of the 55 datasets. These 16 HMs represent transcriptional activators, or HMs occurring in actively transcribed genes. Even for these 16 HMs, Broad-Enrich tends to provide stronger enrichment signal than FET. Compared with GREAT, Broad-Enrich finds more biologically relevant terms in the top ranked gene sets, as illustrated with immune functionrelated terms for H3K4me1 and H3K27me3 in the context of lymphoblastoid cell line GM12878. While rank comparisons are not ideal, in the absence of a gold standard, we rely on known biological roles for the HMs combined with known characteristics in cellular context. Finally, we examined the effect of locus definition on the enrichment signal from Broad-Enrich. We see the strongest enrichment signal by using the locus definition closest to the known locations of the HM. For two HMs, we observe differences in the optimal locus definition. For H3K27me3, the exons locus definition performs best in all cell lines except for H1-hESC, where 5 kb performs best. This difference could be explained by the role H3K27me3 plays in embryonic stem cells, where it is known to often occur in promoters of genes having CpG islands to regulate differentiation of ES cells (). For H3K4me1, we observe that nearest TSS performs best for GM12878 and HepG2, whereas 5 kb performs best for the remaining cell lines. This might indicate that GM12878 and HepG2 cells rely more heavily on long-range enhancer activity for gene activation than the other three cell lines. These results emphasize that the definition with strongest enrichment signal tends to mirror the currently understood location of HM binding. Our implementation of Broad-Enrich allows users to define their own custom locus definition to fit their own experimental contexts. In addition to functionally interpreting single HM experiments, it is also possible to examine bivalent or trivalent HM signatures together (e.g. H3K4me3 and H3K27me3) with BroadEnrich and compare the results with the HMs individually to determine if bivalency leads to unique biological function. Broad-Enrich is also applicable to other types of broad domain experiments, such as copy number variations. As the regulatory programs of living organisms are better understood, Broad-Enrich may be improved with distal regulatory information from Hi-C experiments, allowing for more accurate locus definitions. The significance or strength of each peak region reported by peak callers may also be incorporated in the enrichment model. Such future changes may bring functional interpretation of broad genomic regions closer to making optimal use of peak information.