Alignment of peaks across samples is a difficult but unavoidable step in the data analysis for all analytical techniques containing a separation step like chromatography. Important application examples are the fields of metabolomics and proteomics. Parametric time warping (PTW) has already shown to be very useful in these fields because of the highly restricted form of the warping functions, avoiding overfitting. Here, we describe a new formulation of PTW, working on peak-picked features rather than on complete profiles. Not only does this allow for a much more smooth integration in existing pipelines, it also speeds up the (already among the fastest) algorithm by orders of magnitude. Using two publicly available datasets we show the potential of the new approach. The first set is a LC–DAD dataset of grape samples, and the second an LC–MS data-set of apple extracts. Availability and implementation: Parametric time warping of peak lists is implemented in the ptw package, version 1.9.1 and onwards, available from Github (https://github.com/rwehrens/ptw) and CRAN (http://cran.r-project.org). The package also contains a vignette, providing more theoretical details and scripts to reproduce the results below.
IntroductionHyphenated techniques, coupling a chromatographic separation step to a detector, are the norm in the analysis of complex biological samples, e.g. in proteomics and metabolomics. A common problem in all applications is that the separation, i.e. the exact time point at which a compound is measured by the detector, is not quite reproducible, hampering comparative analyses. When all measurements have been done in a single batch and peak shifts are expected to be small this is usually not a big problem, but when experimental difficulties arise during the batch, or comparisons with data from different batches or even different machines or labs need to be made, explicit retention time corrections are necessary. Several procedures have been proposed in the literature, often indicated with the label 'Time Warping' (). These transform ('warp') the time axis of a sample in such a way that the overlap with a reference signal is maximized. Parametric Time), for example, uses a polynomial transformation. This choice has several advantages: first, the allowed transformations are quite restricted, thus avoiding the common problem of overfitting (at least to some extent). Second, the use of such a polynomial warping function often describes processes like column aging quite well. Third, the explicit modeling allows for clever use of resources, like defining the warping using regularly injected quality control samples only, and interpolating to find the warping for the real experimental samples (). Here, we describe a further development in the PTW algorithm: warping is no longer based on complete profiles, such as extracted ion chromatograms in liquid chromatography mass-spectrometry (LCMS) applications, but rather on the peak-picked features. This has several important benefits. First of all, in the new approach the optimal warping is obtained by only considering the relevant, information-containing part of the signal. This increases sensitivity, and decreases the need for extensive preprocessing of the data (e.g. baseline correction). Second, the process is made faster, sometimes by orders of magnitude. Also the increase in calculation time with wider search windows for the weighted crosscorrelation(WCC) optimization criterion () is virtually eliminated.
ConclusionTime warping using peak lists, as described here, brings the alignment of large numbers of complex samples into the realm of the practically feasible. Instrument breakdown, for example, no longer necessarily forces samples to be remeasured, which is especially important when only small quantities of samples are available.Databases of standards, used for annotation and typically containing only information on peaks and not on raw data, can be used for alignment as well, thereby considerably increasing their usefulness. Conflict of Interest: none declared.